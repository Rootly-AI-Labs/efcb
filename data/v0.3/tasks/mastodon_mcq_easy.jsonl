{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThe `with_connection` wrapper here (which was unused) was removed prior to Rails 8 - https://github.com/rails/rails/pull/52131 - so this is a mix of minor optimization to skip something we are not using, and housecleaning to keep this aligned to what it's overriding.\r\n\r\nSeparately, I wonder if in addition to the coverage we have for the behavior on this and other monkey patches, we could contemplate a gem version check along the lines described in this (truly thorough!) post: https://blog.appsignal.com/2021/08/24/responsible-monkeypatching-in-ruby.html#monkeypatching-responsibly\r\n\r\n\n\n---\n\nChoice A:\napp/controllers/concerns/web_app_controller_concern.rb\n@@ -8,6 +8,7 @@ module WebAppControllerConcern\n \n     before_action :redirect_unauthenticated_to_permalinks!\n     before_action :set_referer_header\n+    before_action :redirect_to_tos_interstitial!\n \n     content_security_policy do |p|\n       policy = ContentSecurityPolicy.new\n@@ -45,6 +46,13 @@ def redirect_unauthenticated_to_permalinks!\n \n   protected\n \n+  def redirect_to_tos_interstitial!\n+    return unless current_user&.require_tos_interstitial?\n+\n+    @terms_of_service = TermsOfService.published.first\n+    render 'terms_of_service_interstitial/show', layout: 'auth'\n+  end\n+\n   def set_referer_header\n     response.set_header('Referrer-Policy', Setting.allow_referrer_origin ? 'strict-origin-when-cross-origin' : 'same-origin')\n   end\n---\napp/controllers/terms_of_service_controller.rb\n@@ -4,8 +4,19 @@ class TermsOfServiceController < ApplicationController\n   include WebAppControllerConcern\n \n   skip_before_action :require_functional!\n+  skip_before_action :redirect_to_tos_interstitial!\n+\n+  before_action :clear_redirect_interstitial!\n \n   def show\n     expires_in(15.seconds, public: true, stale_while_revalidate: 30.seconds, stale_if_error: 1.day) unless user_signed_in?\n   end\n+\n+  private\n+\n+  def clear_redirect_interstitial!\n+    return unless user_signed_in?\n+\n+    current_user.update(require_tos_interstitial: false)\n+  end\n end\n---\napp/models/terms_of_service.rb\n@@ -23,6 +23,8 @@ class TermsOfService < ApplicationRecord\n \n   validate :effective_date_cannot_be_in_the_past\n \n+  NOTIFICATION_ACTIVITY_CUTOFF = 1.year.freeze\n+\n   def published?\n     published_at.present?\n   end\n@@ -39,8 +41,20 @@ def notification_sent?\n     notification_sent_at.present?\n   end\n \n+  def base_user_scope\n+    User.confirmed.where(created_at: ..published_at).joins(:account)\n+  end\n+\n+  def email_notification_cutoff\n+    published_at - NOTIFICATION_ACTIVITY_CUTOFF\n+  end\n+\n+  def scope_for_interstitial\n+    base_user_scope.merge(Account.suspended).or(base_user_scope.where(current_sign_in_at: [nil, ...email_notification_cutoff]))\n+  end\n+\n   def scope_for_notification\n-    User.confirmed.joins(:account).merge(Account.without_suspended).where(created_at: (..published_at))\n+    base_user_scope.merge(Account.without_suspended).where(current_sign_in_at: email_notification_cutoff...)\n   end\n \n   private\n---\napp/models/user.rb\n@@ -25,6 +25,7 @@\n #  otp_backup_codes          :string           is an Array\n #  otp_required_for_login    :boolean          default(FALSE), not null\n #  otp_secret                :string\n+#  require_tos_interstitial  :boolean          default(FALSE), not null\n #  reset_password_sent_at    :datetime\n #  reset_password_token      :string\n #  settings                  :text\n---\napp/views/terms_of_service_interstitial/show.html.haml\n@@ -0,0 +1,15 @@\n+- content_for :header_tags do\n+  %meta{ name: 'robots', content: 'noindex, noarchive' }/\n+\n+- content_for :body_classes, 'app-body'\n+\n+.simple_form\n+  %h1.title= t('terms_of_service_interstitial.title', domain: site_hostname)\n+\n+  - effective_date = @terms_of_service.effective_date || Time.zone.today\n+  %p.lead= effective_date.past? ? t('terms_of_service_interstitial.past_preamble_html') : t('terms_of_service_interstitial.future_preamble_html', date: l(effective_date))\n+\n+  %p.lead= t('user_mailer.terms_of_service_changed.agreement', domain: site_hostname)\n+\n+  .stacked-actions\n+    = link_to t('terms_of_service_interstitial.review_link'), terms_of_service_path, class: 'button'\n---\napp/workers/admin/distribute_terms_of_service_notification_worker.rb\n@@ -6,6 +6,8 @@ class Admin::DistributeTermsOfServiceNotificationWorker\n   def perform(terms_of_service_id)\n     terms_of_service = TermsOfService.find(terms_of_service_id)\n \n+    terms_of_service.scope_for_interstitial.in_batches.update_all(require_tos_interstitial: true)\n+\n     terms_of_service.scope_for_notification.find_each do |user|\n       UserMailer.terms_of_service_changed(user, terms_of_service).deliver_later!\n     end\n---\nconfig/locales/en.yml\n@@ -1916,6 +1916,11 @@ en:\n     does_not_match_previous_name: does not match the previous name\n   terms_of_service:\n     title: Terms of Service\n+  terms_of_service_interstitial:\n+    future_preamble_html: We're making some changes to our terms of service, which will be effective on <strong>%{date}</strong>. We encourage you to review the updated terms.\n+    past_preamble_html: We have changed our terms of service since your last visit. We encourage you to review the updated terms.\n+    review_link: Review terms of service\n+    title: The terms of service of %{domain} are changing\n   themes:\n     contrast: Mastodon (High contrast)\n     default: Mastodon (Dark)\n---\ndb/migrate/20250428104538_add_require_tos_interstitial_to_users.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddRequireTosInterstitialToUsers < ActiveRecord::Migration[8.0]\n+  def change\n+    add_column :users, :require_tos_interstitial, :boolean, null: false, default: false\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_28_095029) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_28_104538) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -1222,6 +1222,7 @@\n     t.string \"time_zone\"\n     t.string \"otp_secret\"\n     t.datetime \"age_verified_at\"\n+    t.boolean \"require_tos_interstitial\", default: false, null: false\n     t.index [\"account_id\"], name: \"index_users_on_account_id\"\n     t.index [\"confirmation_token\"], name: \"index_users_on_confirmation_token\", unique: true\n     t.index [\"created_by_application_id\"], name: \"index_users_on_created_by_application_id\", where: \"(created_by_application_id IS NOT NULL)\"\n---\nspec/workers/admin/distribute_terms_of_service_notification_worker_spec.rb\n@@ -14,9 +14,10 @@\n \n     context 'with valid terms' do\n       let(:terms) { Fabricate(:terms_of_service) }\n-      let!(:user) { Fabricate :user, confirmed_at: 3.days.ago }\n+      let!(:user) { Fabricate(:user, confirmed_at: 3.days.ago) }\n+      let!(:old_user) { Fabricate(:user, confirmed_at: 2.years.ago, current_sign_in_at: 2.years.ago) }\n \n-      it 'sends the terms update via email', :inline_jobs do\n+      it 'sends the terms update via email and change the old user to require an interstitial', :inline_jobs do\n         emails = capture_emails { worker.perform(terms.id) }\n \n         expect(emails.size)\n@@ -26,6 +27,9 @@\n             to: [user.email],\n             subject: I18n.t('user_mailer.terms_of_service_changed.subject')\n           )\n+\n+        expect(user.reload.require_tos_interstitial?).to be false\n+        expect(old_user.reload.require_tos_interstitial?).to be true\n       end\n     end\n   end\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -807,7 +807,7 @@ GEM\n       rubyzip (>= 1.2.2, < 3.0)\n       websocket (~> 1.0)\n     semantic_range (3.1.0)\n-    shoulda-matchers (6.4.0)\n+    shoulda-matchers (6.5.0)\n       activesupport (>= 5.2.0)\n     sidekiq (6.5.12)\n       connection_pool (>= 2.2.5, < 3)\n---\n\n\n---\n\nChoice C:\napp/models/concerns/status/safe_reblog_insert.rb\n@@ -16,7 +16,7 @@ module Status::SafeReblogInsert\n     # The code is kept similar to ActiveRecord::Persistence code and calls it\n     # directly when we are not handling a reblog.\n     #\n-    # https://github.com/rails/rails/blob/v7.2.1.1/activerecord/lib/active_record/persistence.rb#L238-L263\n+    # https://github.com/rails/rails/blob/v8.0.2/activerecord/lib/active_record/persistence.rb#L238-L261\n     def _insert_record(connection, values, returning)\n       return super unless values.is_a?(Hash) && values['reblog_of_id']&.value.present?\n \n@@ -36,15 +36,13 @@ def _insert_record(connection, values, returning)\n       # Instead, we use a custom builder when a reblog is happening:\n       im = _compile_reblog_insert(values)\n \n-      with_connection do |_c|\n-        connection.insert(\n-          im, \"#{self} Create\", primary_key || false, primary_key_value,\n-          returning: returning\n-        ).tap do |result|\n-          # Since we are using SELECT instead of VALUES, a non-error `nil` return is possible.\n-          # For our purposes, it's equivalent to a foreign key constraint violation\n-          raise ActiveRecord::InvalidForeignKey, \"(reblog_of_id)=(#{values['reblog_of_id'].value}) is not present in table \\\"statuses\\\"\" if result.nil?\n-        end\n+      connection.insert(\n+        im, \"#{self} Create\", primary_key || false, primary_key_value,\n+        returning: returning\n+      ).tap do |result|\n+        # Since we are using SELECT instead of VALUES, a non-error `nil` return is possible.\n+        # For our purposes, it's equivalent to a foreign key constraint violation\n+        raise ActiveRecord::InvalidForeignKey, \"(reblog_of_id)=(#{values['reblog_of_id'].value}) is not present in table \\\"statuses\\\"\" if result.nil?\n       end\n     end\n \n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/components/counters.tsx\n@@ -43,3 +43,17 @@ export const FollowersCounter = (\n     }}\n   />\n );\n+\n+export const FollowersYouKnowCounter = (\n+  displayNumber: React.ReactNode,\n+  pluralReady: number,\n+) => (\n+  <FormattedMessage\n+    id='account.followers_you_know_counter'\n+    defaultMessage='{counter} you know'\n+    values={{\n+      count: pluralReady,\n+      counter: <strong>{displayNumber}</strong>,\n+    }}\n+  />\n+);\n---\napp/javascript/mastodon/components/hover_card_account.tsx\n@@ -9,11 +9,16 @@ import { fetchAccount } from 'mastodon/actions/accounts';\n import { AccountBio } from 'mastodon/components/account_bio';\n import { AccountFields } from 'mastodon/components/account_fields';\n import { Avatar } from 'mastodon/components/avatar';\n-import { FollowersCounter } from 'mastodon/components/counters';\n+import { AvatarGroup } from 'mastodon/components/avatar_group';\n+import {\n+  FollowersCounter,\n+  FollowersYouKnowCounter,\n+} from 'mastodon/components/counters';\n import { DisplayName } from 'mastodon/components/display_name';\n import { FollowButton } from 'mastodon/components/follow_button';\n import { LoadingIndicator } from 'mastodon/components/loading_indicator';\n import { ShortNumber } from 'mastodon/components/short_number';\n+import { useFetchFamiliarFollowers } from 'mastodon/features/account_timeline/hooks/familiar_followers';\n import { domain } from 'mastodon/initial_state';\n import { useAppSelector, useAppDispatch } from 'mastodon/store';\n \n@@ -38,6 +43,8 @@ export const HoverCardAccount = forwardRef<\n     }\n   }, [dispatch, accountId, account]);\n \n+  const { familiarFollowers } = useFetchFamiliarFollowers({ accountId });\n+\n   return (\n     <div\n       ref={ref}\n@@ -73,11 +80,27 @@ export const HoverCardAccount = forwardRef<\n             )}\n           </div>\n \n-          <div className='hover-card__number'>\n+          <div className='hover-card__numbers'>\n             <ShortNumber\n               value={account.followers_count}\n               renderer={FollowersCounter}\n             />\n+            {familiarFollowers.length > 0 && (\n+              <>\n+                &middot;\n+                <div className='hover-card__familiar-followers'>\n+                  <ShortNumber\n+                    value={familiarFollowers.length}\n+                    renderer={FollowersYouKnowCounter}\n+                  />\n+                  <AvatarGroup compact>\n+                    {familiarFollowers.slice(0, 3).map((account) => (\n+                      <Avatar key={account.id} account={account} size={22} />\n+                    ))}\n+                  </AvatarGroup>\n+                </div>\n+              </>\n+            )}\n           </div>\n \n           <FollowButton accountId={accountId} />\n---\napp/javascript/mastodon/features/account_timeline/components/familiar_followers.tsx\n@@ -1,15 +1,12 @@\n-import { useEffect } from 'react';\n-\n import { FormattedMessage } from 'react-intl';\n \n import { Link } from 'react-router-dom';\n \n-import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n import { Avatar } from '@/mastodon/components/avatar';\n import { AvatarGroup } from '@/mastodon/components/avatar_group';\n import type { Account } from '@/mastodon/models/account';\n-import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n-import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n+\n+import { useFetchFamiliarFollowers } from '../hooks/familiar_followers';\n \n const AccountLink: React.FC<{ account?: Account }> = ({ account }) => {\n   if (!account) {\n@@ -64,20 +61,11 @@ const FamiliarFollowersReadout: React.FC<{ familiarFollowers: Account[] }> = ({\n export const FamiliarFollowers: React.FC<{ accountId: string }> = ({\n   accountId,\n }) => {\n-  const dispatch = useAppDispatch();\n-  const familiarFollowers = useAppSelector((state) =>\n-    getAccountFamiliarFollowers(state, accountId),\n-  );\n-\n-  const hasNoData = familiarFollowers === null;\n-\n-  useEffect(() => {\n-    if (hasNoData) {\n-      void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n-    }\n-  }, [dispatch, accountId, hasNoData]);\n+  const { familiarFollowers, isLoading } = useFetchFamiliarFollowers({\n+    accountId,\n+  });\n \n-  if (hasNoData || familiarFollowers.length === 0) {\n+  if (isLoading || familiarFollowers.length === 0) {\n     return null;\n   }\n \n---\napp/javascript/mastodon/features/account_timeline/hooks/familiar_followers.ts\n@@ -0,0 +1,30 @@\n+import { useEffect } from 'react';\n+\n+import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n+import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n+import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n+import { me } from 'mastodon/initial_state';\n+\n+export const useFetchFamiliarFollowers = ({\n+  accountId,\n+}: {\n+  accountId?: string;\n+}) => {\n+  const dispatch = useAppDispatch();\n+  const familiarFollowers = useAppSelector((state) =>\n+    accountId ? getAccountFamiliarFollowers(state, accountId) : null,\n+  );\n+\n+  const hasNoData = familiarFollowers === null;\n+\n+  useEffect(() => {\n+    if (hasNoData && accountId && accountId !== me) {\n+      void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n+    }\n+  }, [dispatch, accountId, hasNoData]);\n+\n+  return {\n+    familiarFollowers: hasNoData ? [] : familiarFollowers,\n+    isLoading: hasNoData,\n+  };\n+};\n---\napp/javascript/mastodon/locales/en.json\n@@ -42,6 +42,7 @@\n   \"account.followers\": \"Followers\",\n   \"account.followers.empty\": \"No one follows this user yet.\",\n   \"account.followers_counter\": \"{count, plural, one {{counter} follower} other {{counter} followers}}\",\n+  \"account.followers_you_know_counter\": \"{counter} you know\",\n   \"account.following\": \"Following\",\n   \"account.following_counter\": \"{count, plural, one {{counter} following} other {{counter} following}}\",\n   \"account.follows.empty\": \"This user doesn't follow anyone yet.\",\n---\napp/javascript/styles/mastodon/components.scss\n@@ -10705,7 +10705,15 @@ noscript {\n     color: inherit;\n   }\n \n-  &__number {\n+  &__numbers,\n+  &__familiar-followers {\n+    display: flex;\n+    align-items: center;\n+    flex-wrap: wrap;\n+    gap: 10px;\n+  }\n+\n+  &__numbers {\n     font-size: 15px;\n     line-height: 22px;\n     color: $secondary-text-color;\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nForks usually won't have chromatic set up.\n\n---\n\nChoice A:\napp/javascript/mastodon/features/account_timeline/hooks/familiar_followers.ts\n@@ -1,6 +1,7 @@\n import { useEffect } from 'react';\n \n import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n+import { useIdentity } from '@/mastodon/identity_context';\n import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n import { me } from 'mastodon/initial_state';\n@@ -14,14 +15,15 @@ export const useFetchFamiliarFollowers = ({\n   const familiarFollowers = useAppSelector((state) =>\n     accountId ? getAccountFamiliarFollowers(state, accountId) : null,\n   );\n+  const { signedIn } = useIdentity();\n \n   const hasNoData = familiarFollowers === null;\n \n   useEffect(() => {\n-    if (hasNoData && accountId && accountId !== me) {\n+    if (hasNoData && signedIn && accountId && accountId !== me) {\n       void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n     }\n-  }, [dispatch, accountId, hasNoData]);\n+  }, [dispatch, accountId, hasNoData, signedIn]);\n \n   return {\n     familiarFollowers: hasNoData ? [] : familiarFollowers,\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/audio/index.tsx\n@@ -442,11 +442,14 @@ export const Audio: React.FC<{\n     if (typeof startMuted !== 'undefined') {\n       audioRef.current.muted = startMuted;\n     }\n+  }, [setDuration, startTime, startVolume, startMuted]);\n \n+  const handleCanPlayThrough = useCallback(() => {\n     if (startPlaying) {\n-      void audioRef.current.play();\n+      resumeAudio();\n+      void audioRef.current?.play();\n     }\n-  }, [setDuration, startTime, startVolume, startMuted, startPlaying]);\n+  }, [startPlaying, resumeAudio]);\n \n   const seekBy = (time: number) => {\n     if (!audioRef.current) {\n@@ -591,6 +594,7 @@ export const Audio: React.FC<{\n         onPause={handlePause}\n         onProgress={handleProgress}\n         onLoadedData={handleLoadedData}\n+        onCanPlayThrough={handleCanPlayThrough}\n         onTimeUpdate={handleTimeUpdate}\n         onVolumeChange={handleVolumeChange}\n         crossOrigin='anonymous'\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -94,7 +94,7 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1080.0)\n+    aws-partitions (1.1087.0)\n     aws-sdk-core (3.215.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n@@ -120,7 +120,7 @@ GEM\n       rack (>= 0.9.0)\n       rouge (>= 1.0.0)\n     bigdecimal (3.1.9)\n-    bindata (2.5.0)\n+    bindata (2.5.1)\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n@@ -227,7 +227,7 @@ GEM\n     fabrication (2.31.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n-    faraday (2.12.2)\n+    faraday (2.13.0)\n       faraday-net_http (>= 2.0, < 3.5)\n       json\n       logger\n@@ -239,7 +239,7 @@ GEM\n       net-http (>= 0.5.0)\n     fast_blank (1.0.1)\n     fastimage (2.4.0)\n-    ffi (1.17.1)\n+    ffi (1.17.2)\n     ffi-compiler (1.3.2)\n       ffi (>= 1.15.5)\n       rake\n@@ -426,7 +426,7 @@ GEM\n     mime-types (3.6.2)\n       logger\n       mime-types-data (~> 3.2015)\n-    mime-types-data (3.2025.0402)\n+    mime-types-data (3.2025.0408)\n     mini_mime (1.1.5)\n     mini_portile2 (2.8.8)\n     minitest (5.25.5)\n@@ -585,8 +585,8 @@ GEM\n     ostruct (0.6.1)\n     ox (2.14.22)\n       bigdecimal (>= 3.0)\n-    parallel (1.26.3)\n-    parser (3.3.7.4)\n+    parallel (1.27.0)\n+    parser (3.3.8.0)\n       ast (~> 2.4.1)\n       racc\n     parslet (2.0.0)\n@@ -751,7 +751,7 @@ GEM\n       rubocop-ast (>= 1.44.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.0)\n+    rubocop-ast (1.44.1)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n@@ -1085,4 +1085,4 @@ RUBY VERSION\n    ruby 3.4.1p0\n \n BUNDLED WITH\n-   2.6.7\n+   2.6.8\n---\n\n\n---\n\nChoice D:\n.github/workflows/chromatic.yml\n@@ -20,6 +20,7 @@ jobs:\n   chromatic:\n     name: Run Chromatic\n     runs-on: ubuntu-latest\n+    if: github.repository == 'mastodon/mastodon'\n     steps:\n       - name: Checkout code\n         uses: actions/checkout@v4\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\n### Changes proposed in this PR:\r\n- Fixes broken indentation of quotes in threads\r\n- Fixes smaller quote indentation not applying in advanced UI\r\n\r\n### Screenshots\r\n\r\n| **Before** | **After** |\r\n|--------|--------|\r\n| ![image](https://github.com/user-attachments/assets/65a2f440-3b6f-4e14-81bc-1a6a2f9ee345) | ![image](https://github.com/user-attachments/assets/33731e16-aba4-4e3e-99fb-4a81293b06c2) |\r\n| ![image](https://github.com/user-attachments/assets/5a308c3c-3939-4276-ae7d-c3a8f086927b) | ![image](https://github.com/user-attachments/assets/11766424-1501-4b7c-9d51-28107c86f940) | \n\n---\n\nChoice A:\napp/lib/activitypub/parser/status_parser.rb\n@@ -95,11 +95,11 @@ def language\n   end\n \n   def favourites_count\n-    @object.dig('likes', 'totalItems') if @object.is_a?(Hash)\n+    @object['likes']['totalItems'] if @object.is_a?(Hash) && @object['likes'].is_a?(Hash)\n   end\n \n   def reblogs_count\n-    @object.dig('shares', 'totalItems') if @object.is_a?(Hash)\n+    @object['shares']['totalItems'] if @object.is_a?(Hash) && @object['shares'].is_a?(Hash)\n   end\n \n   def quote_policy\n---\nspec/lib/activitypub/parser/status_parser_spec.rb\n@@ -49,6 +49,24 @@\n     )\n   end\n \n+  context 'when the likes collection is not inlined' do\n+    let(:object_json) do\n+      {\n+        id: [ActivityPub::TagManager.instance.uri_for(sender), 'post1'].join('/'),\n+        type: 'Note',\n+        to: 'https://www.w3.org/ns/activitystreams#Public',\n+        content: 'bleh',\n+        published: 1.hour.ago.utc.iso8601,\n+        updated: 1.hour.ago.utc.iso8601,\n+        likes: 'https://example.com/collections/likes',\n+      }\n+    end\n+\n+    it 'does not raise an error' do\n+      expect { subject.favourites_count }.to_not raise_error\n+    end\n+  end\n+\n   describe '#quote_policy' do\n     subject do\n       described_class\n---\n\n\n---\n\nChoice B:\napp/javascript/styles/mastodon/components.scss\n@@ -1882,16 +1882,18 @@ body > [data-popper-placement] {\n }\n \n .status__quote {\n+  --quote-margin: 36px;\n+\n   position: relative;\n   margin-block-start: 16px;\n-  margin-inline-start: 36px;\n+  margin-inline-start: calc(var(--quote-margin) + var(--thread-margin, 0px));\n   border-radius: 8px;\n   color: var(--nested-card-text);\n   background: var(--nested-card-background);\n   border: var(--nested-card-border);\n \n-  @media screen and (min-width: $mobile-breakpoint) {\n-    margin-inline-start: 56px;\n+  @container (width > 460px) {\n+    --quote-margin: 56px;\n   }\n }\n \n@@ -1951,7 +1953,7 @@ body > [data-popper-placement] {\n     transform: translateY(-50%);\n   }\n \n-  @media screen and (min-width: $mobile-breakpoint) {\n+  @container (width > 460px) {\n     inset-inline-start: -50px;\n   }\n }\n@@ -2878,6 +2880,7 @@ a.account__display-name {\n       display: flex;\n       flex-direction: column;\n       contain: inline-size layout paint style;\n+      container: column / inline-size;\n \n       @media screen and (min-width: $no-gap-breakpoint) {\n         max-width: 600px;\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/account/components/account_note.jsx\n@@ -8,6 +8,8 @@ import ImmutablePureComponent from 'react-immutable-pure-component';\n \n import Textarea from 'react-textarea-autosize';\n \n+import { LoadingIndicator } from '@/mastodon/components/loading_indicator';\n+\n const messages = defineMessages({\n   placeholder: { id: 'account_note.placeholder', defaultMessage: 'Click to add a note' },\n });\n@@ -153,17 +155,23 @@ class AccountNote extends ImmutablePureComponent {\n           <FormattedMessage id='account.account_note_header' defaultMessage='Personal note' /> <InlineAlert show={saved} />\n         </label>\n \n-        <Textarea\n-          id={`account-note-${accountId}`}\n-          className='account__header__account-note__content'\n-          disabled={this.props.value === null || value === null}\n-          placeholder={intl.formatMessage(messages.placeholder)}\n-          value={value || ''}\n-          onChange={this.handleChange}\n-          onKeyDown={this.handleKeyDown}\n-          onBlur={this.handleBlur}\n-          ref={this.setTextareaRef}\n-        />\n+        {this.props.value === undefined ? (\n+          <div className='account__header__account-note__loading-indicator-wrapper'>\n+            <LoadingIndicator />\n+          </div>\n+        ) : (\n+          <Textarea\n+            id={`account-note-${accountId}`}\n+            className='account__header__account-note__content'\n+            disabled={value === null}\n+            placeholder={intl.formatMessage(messages.placeholder)}\n+            value={value || ''}\n+            onChange={this.handleChange}\n+            onKeyDown={this.handleKeyDown}\n+            onBlur={this.handleBlur}\n+            ref={this.setTextareaRef}\n+          />\n+        )}\n       </div>\n     );\n   }\n---\napp/javascript/styles/mastodon/components.scss\n@@ -8194,6 +8194,20 @@ noscript {\n     font-weight: 400;\n     margin-bottom: 10px;\n \n+    &__loading-indicator-wrapper {\n+      position: relative;\n+      height: 37px;\n+\n+      .loading-indicator {\n+        left: 10px;\n+      }\n+\n+      .circular-progress {\n+        width: 14px;\n+        height: 14px;\n+      }\n+    }\n+\n     label {\n       display: block;\n       font-size: 12px;\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.222.3', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1088.0)\n+    aws-sdk-core (3.222.2)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -931,7 +933,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.222.3)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\n3.1.15 has a security issue: https://github.com/rack/rack/security/advisories/GHSA-47m2-26rw-j2jw\n\n---\n\nChoice A:\nyarn.lock\n@@ -48,7 +48,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/code-frame@npm:^7.0.0, @babel/code-frame@npm:^7.10.4, @babel/code-frame@npm:^7.26.2, @babel/code-frame@npm:^7.27.1\":\n+\"@babel/code-frame@npm:^7.0.0, @babel/code-frame@npm:^7.10.4, @babel/code-frame@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/code-frame@npm:7.27.1\"\n   dependencies:\n@@ -67,29 +67,29 @@ __metadata:\n   linkType: hard\n \n \"@babel/core@npm:^7.12.3, @babel/core@npm:^7.21.3, @babel/core@npm:^7.22.1, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n-  version: 7.26.10\n-  resolution: \"@babel/core@npm:7.26.10\"\n+  version: 7.27.1\n+  resolution: \"@babel/core@npm:7.27.1\"\n   dependencies:\n     \"@ampproject/remapping\": \"npm:^2.2.0\"\n-    \"@babel/code-frame\": \"npm:^7.26.2\"\n-    \"@babel/generator\": \"npm:^7.26.10\"\n-    \"@babel/helper-compilation-targets\": \"npm:^7.26.5\"\n-    \"@babel/helper-module-transforms\": \"npm:^7.26.0\"\n-    \"@babel/helpers\": \"npm:^7.26.10\"\n-    \"@babel/parser\": \"npm:^7.26.10\"\n-    \"@babel/template\": \"npm:^7.26.9\"\n-    \"@babel/traverse\": \"npm:^7.26.10\"\n-    \"@babel/types\": \"npm:^7.26.10\"\n+    \"@babel/code-frame\": \"npm:^7.27.1\"\n+    \"@babel/generator\": \"npm:^7.27.1\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/helper-module-transforms\": \"npm:^7.27.1\"\n+    \"@babel/helpers\": \"npm:^7.27.1\"\n+    \"@babel/parser\": \"npm:^7.27.1\"\n+    \"@babel/template\": \"npm:^7.27.1\"\n+    \"@babel/traverse\": \"npm:^7.27.1\"\n+    \"@babel/types\": \"npm:^7.27.1\"\n     convert-source-map: \"npm:^2.0.0\"\n     debug: \"npm:^4.1.0\"\n     gensync: \"npm:^1.0.0-beta.2\"\n     json5: \"npm:^2.2.3\"\n     semver: \"npm:^6.3.1\"\n-  checksum: 10c0/e046e0e988ab53841b512ee9d263ca409f6c46e2a999fe53024688b92db394346fa3aeae5ea0866331f62133982eee05a675d22922a4603c3f603aa09a581d62\n+  checksum: 10c0/0fc31f87f5401ac5d375528cb009f4ea5527fc8c5bb5b64b5b22c033b60fd0ad723388933a5f3f5db14e1edd13c958e9dd7e5c68f9b68c767aeb496199c8a4bb\n   languageName: node\n   linkType: hard\n \n-\"@babel/generator@npm:^7.26.10, @babel/generator@npm:^7.27.1\":\n+\"@babel/generator@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/generator@npm:7.27.1\"\n   dependencies:\n@@ -121,7 +121,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.26.5, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n+\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n   version: 7.27.2\n   resolution: \"@babel/helper-compilation-targets@npm:7.27.2\"\n   dependencies:\n@@ -199,7 +199,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-module-transforms@npm:^7.26.0, @babel/helper-module-transforms@npm:^7.27.1\":\n+\"@babel/helper-module-transforms@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/helper-module-transforms@npm:7.27.1\"\n   dependencies:\n@@ -296,17 +296,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helpers@npm:^7.26.10\":\n-  version: 7.26.10\n-  resolution: \"@babel/helpers@npm:7.26.10\"\n+\"@babel/helpers@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helpers@npm:7.27.1\"\n   dependencies:\n-    \"@babel/template\": \"npm:^7.26.9\"\n-    \"@babel/types\": \"npm:^7.26.10\"\n-  checksum: 10c0/f99e1836bcffce96db43158518bb4a24cf266820021f6461092a776cba2dc01d9fc8b1b90979d7643c5c2ab7facc438149064463a52dd528b21c6ab32509784f\n+    \"@babel/template\": \"npm:^7.27.1\"\n+    \"@babel/types\": \"npm:^7.27.1\"\n+  checksum: 10c0/e078257b9342dae2c041ac050276c5a28701434ad09478e6dc6976abd99f721a5a92e4bebddcbca6b1c3a7e8acace56a946340c701aad5e7507d2c87446459ba\n   languageName: node\n   linkType: hard\n \n-\"@babel/parser@npm:^7.1.0, @babel/parser@npm:^7.20.7, @babel/parser@npm:^7.26.10, @babel/parser@npm:^7.27.1\":\n+\"@babel/parser@npm:^7.1.0, @babel/parser@npm:^7.20.7, @babel/parser@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/parser@npm:7.27.1\"\n   dependencies:\n@@ -1292,7 +1292,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/template@npm:^7.26.9, @babel/template@npm:^7.27.1\":\n+\"@babel/template@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/template@npm:7.27.1\"\n   dependencies:\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -768,12 +768,12 @@ GEM\n       lint_roller (~> 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n       rubocop-ast (>= 1.38.0, < 2.0)\n-    rubocop-rails (2.31.0)\n+    rubocop-rails (2.32.0)\n       activesupport (>= 4.2.0)\n       lint_roller (~> 1.1)\n       rack (>= 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n-      rubocop-ast (>= 1.38.0, < 2.0)\n+      rubocop-ast (>= 1.44.0, < 2.0)\n     rubocop-rspec (3.6.0)\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -633,7 +633,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (3.1.15)\n+    rack (3.1.16)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (3.0.0)\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/account_featured/components/empty_message.tsx\n@@ -1,6 +1,9 @@\n import { FormattedMessage } from 'react-intl';\n \n+import { useParams } from 'react-router';\n+\n import { LimitedAccountHint } from 'mastodon/features/account_timeline/components/limited_account_hint';\n+import { me } from 'mastodon/initial_state';\n \n interface EmptyMessageProps {\n   suspended: boolean;\n@@ -15,13 +18,21 @@ export const EmptyMessage: React.FC<EmptyMessageProps> = ({\n   hidden,\n   blockedBy,\n }) => {\n+  const { acct } = useParams<{ acct?: string }>();\n   if (!accountId) {\n     return null;\n   }\n \n   let message: React.ReactNode = null;\n \n-  if (suspended) {\n+  if (me === accountId) {\n+    message = (\n+      <FormattedMessage\n+        id='empty_column.account_featured.me'\n+        defaultMessage='You have not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?'\n+      />\n+    );\n+  } else if (suspended) {\n     message = (\n       <FormattedMessage\n         id='empty_column.account_suspended'\n@@ -37,11 +48,19 @@ export const EmptyMessage: React.FC<EmptyMessageProps> = ({\n         defaultMessage='Profile unavailable'\n       />\n     );\n+  } else if (acct) {\n+    message = (\n+      <FormattedMessage\n+        id='empty_column.account_featured.other'\n+        defaultMessage='{acct} has not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?'\n+        values={{ acct }}\n+      />\n+    );\n   } else {\n     message = (\n       <FormattedMessage\n-        id='empty_column.account_featured'\n-        defaultMessage='This list is empty'\n+        id='empty_column.account_featured_other.unknown'\n+        defaultMessage='This account has not featured anything yet.'\n       />\n     );\n   }\n---\napp/javascript/mastodon/locales/en.json\n@@ -300,7 +300,9 @@\n   \"emoji_button.search_results\": \"Search results\",\n   \"emoji_button.symbols\": \"Symbols\",\n   \"emoji_button.travel\": \"Travel & Places\",\n-  \"empty_column.account_featured\": \"This list is empty\",\n+  \"empty_column.account_featured.me\": \"You have not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?\",\n+  \"empty_column.account_featured.other\": \"{acct} has not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?\",\n+  \"empty_column.account_featured_other.unknown\": \"This account has not featured anything yet.\",\n   \"empty_column.account_hides_collections\": \"This user has chosen to not make this information available\",\n   \"empty_column.account_suspended\": \"Account suspended\",\n   \"empty_column.account_timeline\": \"No posts here!\",\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nRemove the feature flag, enable the feature unconditionally.\n\n---\n\nChoice A:\napp/lib/activitypub/activity/create.rb\n@@ -226,8 +226,6 @@ def process_tags\n   end\n \n   def process_quote\n-    return unless Mastodon::Feature.inbound_quotes_enabled?\n-\n     @quote_uri = @status_parser.quote_uri\n     return if @quote_uri.blank?\n \n---\napp/lib/activitypub/activity/quote_request.rb\n@@ -4,7 +4,6 @@ class ActivityPub::Activity::QuoteRequest < ActivityPub::Activity\n   include Payloadable\n \n   def perform\n-    return unless Mastodon::Feature.inbound_quotes_enabled?\n     return if non_matching_uri_hosts?(@account.uri, @json['id'])\n \n     quoted_status = status_from_uri(object_uri)\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -271,8 +271,6 @@ def update_emojis!\n   end\n \n   def update_quote!\n-    return unless Mastodon::Feature.inbound_quotes_enabled?\n-\n     quote_uri = @status_parser.quote_uri\n \n     if quote_uri.present?\n---\nspec/lib/activitypub/activity/create_spec.rb\n@@ -887,7 +887,7 @@ def activity_for_object(json)\n         end\n       end\n \n-      context 'with an unverifiable quote of a known post', feature: :inbound_quotes do\n+      context 'with an unverifiable quote of a known post' do\n         let(:quoted_status) { Fabricate(:status) }\n \n         let(:object_json) do\n@@ -911,7 +911,7 @@ def activity_for_object(json)\n         end\n       end\n \n-      context 'with an unverifiable unknown post', feature: :inbound_quotes do\n+      context 'with an unverifiable unknown post' do\n         let(:unknown_post_uri) { 'https://unavailable.example.com/unavailable-post' }\n \n         let(:object_json) do\n@@ -939,7 +939,7 @@ def activity_for_object(json)\n         end\n       end\n \n-      context 'with a verifiable quote of a known post', feature: :inbound_quotes do\n+      context 'with a verifiable quote of a known post' do\n         let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n         let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n         let(:approval_uri) { 'https://quoted.example.com/quote-approval' }\n---\nspec/lib/activitypub/activity/quote_request_spec.rb\n@@ -2,7 +2,7 @@\n \n require 'rails_helper'\n \n-RSpec.describe ActivityPub::Activity::QuoteRequest, feature: :inbound_quotes do\n+RSpec.describe ActivityPub::Activity::QuoteRequest do\n   let(:sender)    { Fabricate(:account, domain: 'example.com') }\n   let(:recipient) { Fabricate(:account) }\n   let(:quoted_post) { Fabricate(:status, account: recipient) }\n---\nspec/services/activitypub/process_status_update_service_spec.rb\n@@ -435,7 +435,7 @@\n     end\n   end\n \n-  context 'when the status has an existing unverified quote and adds an approval link', feature: :inbound_quotes do\n+  context 'when the status has an existing unverified quote and adds an approval link' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: nil) }\n@@ -500,7 +500,7 @@\n     end\n   end\n \n-  context 'when the status has an existing verified quote and removes an approval link', feature: :inbound_quotes do\n+  context 'when the status has an existing verified quote and removes an approval link' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: approval_uri, state: :accepted) }\n@@ -535,7 +535,7 @@\n     end\n   end\n \n-  context 'when the status adds a verifiable quote', feature: :inbound_quotes do\n+  context 'when the status adds a verifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let(:approval_uri) { 'https://quoted.example.com/approvals/1' }\n@@ -600,7 +600,7 @@\n     end\n   end\n \n-  context 'when the status adds a unverifiable quote', feature: :inbound_quotes do\n+  context 'when the status adds a unverifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let(:approval_uri) { 'https://quoted.example.com/approvals/1' }\n@@ -635,7 +635,7 @@\n     end\n   end\n \n-  context 'when the status removes a verified quote', feature: :inbound_quotes do\n+  context 'when the status removes a verified quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: approval_uri, state: :accepted) }\n@@ -660,7 +660,7 @@\n     end\n   end\n \n-  context 'when the status removes an unverified quote', feature: :inbound_quotes do\n+  context 'when the status removes an unverified quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: nil, state: :pending) }\n@@ -684,7 +684,7 @@\n     end\n   end\n \n-  context 'when the status swaps a verified quote with an unverifiable quote', feature: :inbound_quotes do\n+  context 'when the status swaps a verified quote with an unverifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let(:second_quoted_status) { Fabricate(:status, account: quoted_account) }\n@@ -752,7 +752,7 @@\n     end\n   end\n \n-  context 'when the status swaps a verified quote with another verifiable quote', feature: :inbound_quotes do\n+  context 'when the status swaps a verified quote with another verifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:second_quoted_account) { Fabricate(:account, domain: 'second-quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.7.0\":\n-  version: 2.7.0\n-  resolution: \"pg-connection-string@npm:2.7.0\"\n-  checksum: 10c0/50a1496a1c858f9495d78a2c7a66d93ef3602e718aff2953bb5738f3ea616d7f727f32fc20513c9bed127650cd14c1ddc7b458396f4000e689d4b64c65c5c51e\n+  version: 2.8.1\n+  resolution: \"pg-connection-string@npm:2.8.1\"\n+  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\nspec/lib/activitypub/activity/remove_spec.rb\n@@ -4,29 +4,60 @@\n \n RSpec.describe ActivityPub::Activity::Remove do\n   let(:sender) { Fabricate(:account, featured_collection_url: 'https://example.com/featured') }\n-  let(:status) { Fabricate(:status, account: sender) }\n-\n-  let(:json) do\n-    {\n-      '@context': 'https://www.w3.org/ns/activitystreams',\n-      id: 'foo',\n-      type: 'Add',\n-      actor: ActivityPub::TagManager.instance.uri_for(sender),\n-      object: ActivityPub::TagManager.instance.uri_for(status),\n-      target: sender.featured_collection_url,\n-    }.with_indifferent_access\n-  end\n \n   describe '#perform' do\n     subject { described_class.new(json, sender) }\n \n-    before do\n-      StatusPin.create!(account: sender, status: status)\n-      subject.perform\n+    context 'when removing a pinned status' do\n+      let(:status) { Fabricate(:status, account: sender) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: ActivityPub::TagManager.instance.uri_for(status),\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        StatusPin.create!(account: sender, status: status)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.pinned?(status) }.to(false)\n+      end\n     end\n \n-    it 'removes a pin' do\n-      expect(sender.pinned?(status)).to be false\n+    context 'when removing a featured tag' do\n+      let(:tag) { Fabricate(:tag) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: {\n+            type: 'Hashtag',\n+            name: \"##{tag.display_name}\",\n+            href: \"https://example.com/tags/#{tag.name}\",\n+          },\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        sender.featured_tags.find_or_create_by!(name: tag.name)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.featured_tags.exists?(tag: tag) }.to(false)\n+      end\n     end\n   end\n end\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -768,12 +768,12 @@ GEM\n       lint_roller (~> 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n       rubocop-ast (>= 1.38.0, < 2.0)\n-    rubocop-rails (2.31.0)\n+    rubocop-rails (2.32.0)\n       activesupport (>= 4.2.0)\n       lint_roller (~> 1.1)\n       rack (>= 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n-      rubocop-ast (>= 1.38.0, < 2.0)\n+      rubocop-ast (>= 1.44.0, < 2.0)\n     rubocop-rspec (3.6.0)\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [aws-sdk-core](https://redirect.github.com/aws/aws-sdk-ruby) ([source](https://redirect.github.com/aws/aws-sdk-ruby/tree/HEAD/gems/aws-sdk-core), [changelog](https://redirect.github.com/aws/aws-sdk-ruby/tree/version-3/gems/aws-sdk-core/CHANGELOG.md)) | `'< 3.216.0'` -> `'< 3.225.2'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/aws-sdk-core/3.225.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/aws-sdk-core/3.225.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/aws-sdk-core/3.215.1/3.225.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/aws-sdk-core/3.215.1/3.225.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>aws/aws-sdk-ruby (aws-sdk-core)</summary>\n\n### [`v3.225.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32251-2025-06-05)\n\n-   Issue - Fix RPCv2 parser to handle flattened list and flattened map members correctly for `AwsQueryCompatible` services.\n\n### [`v3.225.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32250-2025-06-02)\n\n-   Feature - AWS SDK for Ruby no longer supports Ruby runtime versions 2.5 and 2.6.\n\n### [`v3.224.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32241-2025-05-28)\n\n-   Issue - Signal data in http response listeners prior to writing, so that data can be inspected or verified before potential mutation.\n\n### [`v3.224.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32240-2025-05-12)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n-   Feature - Support `ENV['AWS_DISABLE_HOST_PREFIX_INJECTION']` and `disable_host_prefix_injection` shared config to disable host prefix injection for all services.\n\n### [`v3.223.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32230-2025-05-01)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n### [`v3.222.3`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32223-2025-04-28)\n\n-   Issue - Do not dynamically create operation methods from the API. ([#&#8203;3234](https://redirect.github.com/aws/aws-sdk-ruby/issues/3234))\n\n### [`v3.222.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32222-2025-04-16)\n\n-   Issue - Additional metrics collection for credentials in the User-Agent plugin.\n\n### [`v3.222.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32221-2025-03-28)\n\n-   Issue - Allow explicit modeled headers to override prefixed headers for `rest` protocols.\n\n### [`v3.222.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32220-2025-03-27)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - This release adds AwsAdditionalDetails in the CreateTokenWithIAM API response.\n\n### [`v3.221.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32210-2025-03-24)\n\n-   Feature - Add `logger` as an explicit dependency for Ruby 3.5.\n-   Issue - Enable ALPN over TLS for H2 Connection by default.\n-   Issue - Fix HTTP-2 connections to properly use config values configured on the client.\n\n### [`v3.220.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32202-2025-03-20)\n\n-   Issue - Enable ALPN over TLS for H2 by default.\n\n### [`v3.220.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32201-2025-03-06)\n\n-   Issue - Convert stubs at request time.\n\n### [`v3.220.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32200-2025-03-04)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n### [`v3.219.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32190-2025-02-18)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.218.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32181-2025-02-07)\n\n-   Issue - Add handling of block in ExtendedSession delegation ([#&#8203;3178](https://redirect.github.com/aws/aws-sdk-ruby/issues/3178)).\n\n### [`v3.218.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32180-2025-02-06)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.217.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32171-2025-01-30)\n\n-   Issue - Add `transfer-encoding` and `connection` to list of unsigned sigv4 headers.\n\n### [`v3.217.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32170-2025-01-24)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Fixed typos in the descriptions.\n\n### [`v3.216.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32161-2025-01-22)\n\n-   Issue - Use epoch seconds instead of milliseconds in cbor encode/decode.\n\n-   Issue - Add handling of block in response delegation ([#&#8203;3169](https://redirect.github.com/aws/aws-sdk-ruby/issues/3169)).\n\n### [`v3.216.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32160-2025-01-15)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n-   Feature - Always calculate request checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:request_checksum_calculation`, in the shared config file as `request_checksum_calculation`, and in the ENV as `ENV['AWS_REQUEST_CHECKSUM_CALCULATION']`.\n\n-   Feature - Always validate response checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:response_checksum_validation`, in the shared config file as `response_checksum_validation`, and in the ENV as `ENV['AWS_RESPONSE_CHECKSUM_VALIDATION']`.\n\n-   Feature - Support CRC64NVME checksums through the `aws-crt` gem.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC40MC4zIiwidXBkYXRlZEluVmVyIjoiNDAuNDAuMyIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\napp/lib/admin/system_check/elasticsearch_check.rb\n@@ -17,7 +17,7 @@ def pass?\n     return true unless Chewy.enabled?\n \n     running_version.present? && compatible_version? && cluster_health['status'] == 'green' && indexes_match? && specifications_match? && preset_matches?\n-  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error\n+  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error, HTTPClient::KeepAliveDisconnected\n     false\n   end\n \n@@ -54,7 +54,7 @@ def message\n     else\n       Admin::SystemCheck::Message.new(:elasticsearch_preset, nil, 'https://docs.joinmastodon.org/admin/elasticsearch/#scaling')\n     end\n-  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error\n+  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error, HTTPClient::KeepAliveDisconnected\n     Admin::SystemCheck::Message.new(:elasticsearch_running_check)\n   end\n \n---\n\n\n---\n\nChoice B:\nconfig/environments/production.rb\n@@ -150,13 +150,6 @@\n     'Referrer-Policy' => 'same-origin',\n   }\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = if ENV['SECRET_KEY_BASE_DUMMY']\n-                          SecureRandom.hex(64)\n-                        else\n-                          ENV.fetch('OTP_SECRET')\n-                        end\n-\n   # Enable DNS rebinding protection and other `Host` header attacks.\n   # config.hosts = [\n   #   \"example.com\",     # Allow requests from example.com\n---\nconfig/environments/test.rb\n@@ -48,9 +48,6 @@\n   # Print deprecation notices to the stderr.\n   config.active_support.deprecation = :stderr\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = '100c7faeef00caa29242f6b04156742bf76065771fd4117990c4282b8748ff3d99f8fdae97c982ab5bd2e6756a159121377cce4421f4a8ecd2d67bd7749a3fb4'\n-\n   # Generate random VAPID keys\n   vapid_key = Webpush.generate_key\n   config.x.vapid_private_key = vapid_key.private_key\n---\ndb/post_migrate/20240307180905_migrate_devise_two_factor_secrets.rb\n@@ -79,8 +79,18 @@ def legacy_otp_secret\n   class MigrationUser < ApplicationRecord\n     self.table_name = :users\n \n+    LEGACY_OTP_SECRET = begin\n+      if Rails.env.test?\n+        '100c7faeef00caa29242f6b04156742bf76065771fd4117990c4282b8748ff3d99f8fdae97c982ab5bd2e6756a159121377cce4421f4a8ecd2d67bd7749a3fb4'\n+      elsif ENV['SECRET_KEY_BASE_DUMMY']\n+        SecureRandom.hex(64)\n+      else\n+        ENV.fetch('OTP_SECRET')\n+      end\n+    end\n+\n     devise :two_factor_authenticatable,\n-           otp_secret_encryption_key: Rails.configuration.x.otp_secret\n+           otp_secret_encryption_key: LEGACY_OTP_SECRET\n \n     include LegacyOtpSecret\n   end\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -794,7 +794,7 @@ GEM\n     ruby-saml (1.18.0)\n       nokogiri (>= 1.13.10)\n       rexml\n-    ruby-vips (2.2.3)\n+    ruby-vips (2.2.4)\n       ffi (~> 1.12)\n       logger\n     rubyzip (2.4.1)\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -13,7 +13,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.225.2', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -93,21 +93,23 @@ GEM\n     annotaterb (4.15.0)\n     ast (2.4.3)\n     attr_required (1.0.2)\n-    aws-eventstream (1.3.2)\n-    aws-partitions (1.1103.0)\n-    aws-sdk-core (3.215.1)\n+    aws-eventstream (1.4.0)\n+    aws-partitions (1.1112.0)\n+    aws-sdk-core (3.225.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n     aws-sdk-s3 (1.177.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sdk-kms (~> 1)\n       aws-sigv4 (~> 1.5)\n-    aws-sigv4 (1.11.0)\n+    aws-sigv4 (1.12.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n     azure-blob (0.5.8)\n       rexml\n@@ -946,7 +948,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.225.2)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nWith `4.4.0-beta.1` tagged, do a pass over the templates.\r\n\r\nit would be truly funny to someday configure renovate to update these. I would laugh and tell everyone on the street.\n\n---\n\nChoice A:\nGemfile.lock\n@@ -200,7 +200,7 @@ GEM\n     doorkeeper (5.8.2)\n       railties (>= 5)\n     dotenv (3.1.8)\n-    drb (2.2.1)\n+    drb (2.2.3)\n     dry-cli (1.2.0)\n     elasticsearch (7.17.11)\n       elasticsearch-api (= 7.17.11)\n@@ -602,8 +602,8 @@ GEM\n     pastel (0.8.0)\n       tty-color (~> 0.5)\n     pg (1.5.9)\n-    pghero (3.6.2)\n-      activerecord (>= 6.1)\n+    pghero (3.7.0)\n+      activerecord (>= 7.1)\n     pp (0.6.2)\n       prettyprint\n     premailer (1.27.0)\n---\n\n\n---\n\nChoice B:\nspec/system/account_notes_spec.rb\n@@ -11,13 +11,13 @@\n   let(:finished_onboarding) { true }\n \n   let!(:other_account) { Fabricate(:account) }\n+  let(:note_text) { 'This is a personal note' }\n \n   before { as_a_logged_in_user }\n \n   it 'can be written and viewed' do\n     visit_profile(other_account)\n \n-    note_text = 'This is a personal note'\n     fill_in frontend_translations('account_note.placeholder'), with: note_text\n \n     # This is a bit awkward since there is no button to save the change\n---\nspec/system/new_statuses_spec.rb\n@@ -9,12 +9,12 @@\n   let(:password)            { 'password' }\n   let(:confirmed_at)        { Time.zone.now }\n   let(:finished_onboarding) { true }\n+  let(:status_text) { 'This is a new status!' }\n \n   before { as_a_logged_in_user }\n \n   it 'can be posted' do\n     visit_homepage\n-    status_text = 'This is a new status!'\n \n     within('.compose-form') do\n       fill_in frontend_translations('compose_form.placeholder'), with: status_text\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.4)\n+    rubocop (1.75.5)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\nChoice D:\n.github/ISSUE_TEMPLATE/1.web_bug_report.yml\n@@ -48,24 +48,24 @@ body:\n     attributes:\n       label: Mastodon version\n       description: |\n-        This is displayed at the bottom of the About page, eg. `v4.4.0-alpha.1`\n-      placeholder: v4.3.0\n+        This is displayed at the bottom of the About page, eg. `v4.4.0-beta.1`\n+      placeholder: v4.4.0-beta.1\n     validations:\n       required: true\n   - type: input\n     attributes:\n       label: Browser name and version\n       description: |\n         What browser are you using when getting this bug? Please specify the version as well.\n-      placeholder: Firefox 131.0.0\n+      placeholder: Firefox 139.0.0\n     validations:\n       required: true\n   - type: input\n     attributes:\n       label: Operating system\n       description: |\n         What OS are you running? Please specify the version as well.\n-      placeholder: macOS 15.0.1\n+      placeholder: macOS 15.5\n     validations:\n       required: true\n   - type: textarea\n---\n.github/ISSUE_TEMPLATE/2.server_bug_report.yml\n@@ -49,8 +49,8 @@ body:\n     attributes:\n       label: Mastodon version\n       description: |\n-        This is displayed at the bottom of the About page, eg. `v4.4.0-alpha.1`\n-      placeholder: v4.3.0\n+        This is displayed at the bottom of the About page, eg. `v4.4.0-beta.1`\n+      placeholder: v4.4.0-beta.1\n     validations:\n       required: false\n   - type: textarea\n@@ -60,7 +60,7 @@ body:\n         Any additional technical details you may have, like logs or error traces\n       value: |\n         If this is happening on your own Mastodon server, please fill out those:\n-        - Ruby version: (from `ruby --version`, eg. v3.4.1)\n-        - Node.js version: (from `node --version`, eg. v20.18.0)\n+        - Ruby version: (from `ruby --version`, eg. v3.4.4)\n+        - Node.js version: (from `node --version`, eg. v22.16.0)\n     validations:\n       required: false\n---\n.github/ISSUE_TEMPLATE/3.troubleshooting.yml\n@@ -50,7 +50,7 @@ body:\n       label: Mastodon version\n       description: |\n         This is displayed at the bottom of the About page, eg. `v4.4.0-alpha.1`\n-      placeholder: v4.3.0\n+      placeholder: v4.4.0-beta.1\n     validations:\n       required: false\n   - type: textarea\n@@ -60,9 +60,9 @@ body:\n         Details about your environment, like how Mastodon is deployed, if containers are used, version numbers, etc.\n       value: |\n         Please at least include those informations:\n-        - Operating system: (eg. Ubuntu 22.04)\n-        - Ruby version: (from `ruby --version`, eg. v3.4.1)\n-        - Node.js version: (from `node --version`, eg. v20.18.0)\n+        - Operating system: (eg. Ubuntu 24.04.2)\n+        - Ruby version: (from `ruby --version`, eg. v3.4.4)\n+        - Node.js version: (from `node --version`, eg. v22.16.0)\n     validations:\n       required: false\n   - type: textarea\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [ruby-vips](https://redirect.github.com/libvips/ruby-vips) ([changelog](https://redirect.github.com/libvips/ruby-vips/blob/master/CHANGELOG.md)) | `2.2.3` -> `2.2.4` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/ruby-vips/2.2.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/ruby-vips/2.2.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/ruby-vips/2.2.3/2.2.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/ruby-vips/2.2.3/2.2.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>libvips/ruby-vips (ruby-vips)</summary>\n\n### [`v2.2.4`](https://redirect.github.com/libvips/ruby-vips/blob/HEAD/CHANGELOG.md#Version-224-2025-06-05)\n\n[Compare Source](https://redirect.github.com/libvips/ruby-vips/compare/v2.2.3...v2.2.4)\n\n-   fix write to target test with libvips 8.17 \\[jcupitt]\n-   update docs for libvips 8.17 \\[jcupitt]\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC40MC4zIiwidXBkYXRlZEluVmVyIjoiNDAuNDAuMyIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n-  version: 2.8.1\n-  resolution: \"pg-connection-string@npm:2.8.1\"\n-  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n+  version: 2.8.5\n+  resolution: \"pg-connection-string@npm:2.8.5\"\n+  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\ndb/migrate/20250425134308_quote_ids_to_timestamp_ids.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class QuoteIdsToTimestampIds < ActiveRecord::Migration[8.0]\n+  def up\n+    # Set up the media_attachments.id column to use our timestamp-based IDs.\n+    safety_assured do\n+      execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT timestamp_id('quotes')\")\n+    end\n+\n+    # Make sure we have a sequence to use.\n+    Mastodon::Snowflake.ensure_id_sequences_exist\n+  end\n+\n+  def down\n+    execute('LOCK quotes')\n+    execute(\"SELECT setval('quotes_id_seq', (SELECT MAX(id) FROM quotes))\")\n+    execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT nextval('quotes_id_seq')\")\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_22_085303) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_25_134654) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -871,7 +871,7 @@\n     t.string \"url\"\n   end\n \n-  create_table \"quotes\", force: :cascade do |t|\n+  create_table \"quotes\", id: :bigint, default: -> { \"timestamp_id('quotes'::text)\" }, force: :cascade do |t|\n     t.bigint \"account_id\", null: false\n     t.bigint \"status_id\", null: false\n     t.bigint \"quoted_status_id\"\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -794,7 +794,7 @@ GEM\n     ruby-saml (1.18.0)\n       nokogiri (>= 1.13.10)\n       rexml\n-    ruby-vips (2.2.3)\n+    ruby-vips (2.2.4)\n       ffi (~> 1.12)\n       logger\n     rubyzip (2.4.1)\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.222.3', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1088.0)\n+    aws-sdk-core (3.222.2)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -931,7 +933,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.222.3)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [postcss-preset-env](https://redirect.github.com/csstools/postcss-plugins/tree/main/plugin-packs/postcss-preset-env#readme) ([source](https://redirect.github.com/csstools/postcss-plugins/tree/HEAD/plugin-packs/postcss-preset-env)) | [`10.2.0` -> `10.2.1`](https://renovatebot.com/diffs/npm/postcss-preset-env/10.2.0/10.2.1) | [![age](https://developer.mend.io/api/mc/badges/age/npm/postcss-preset-env/10.2.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/postcss-preset-env/10.2.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/postcss-preset-env/10.2.0/10.2.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/postcss-preset-env/10.2.0/10.2.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>csstools/postcss-plugins (postcss-preset-env)</summary>\n\n### [`v10.2.1`](https://redirect.github.com/csstools/postcss-plugins/blob/HEAD/plugin-packs/postcss-preset-env/CHANGELOG.md#1021)\n\n[Compare Source](https://redirect.github.com/csstools/postcss-plugins/compare/10628fabdf2ed76e52f1b64fb37f7ff9295c24e4...5fbee910800b21b01ee1d22809cfce0106136143)\n\n*June 5, 2025*\n\n-   Updated [`postcss-custom-properties`](https://redirect.github.com/csstools/postcss-plugins/tree/main/plugins/postcss-custom-properties) to [`14.0.6`](https://redirect.github.com/csstools/postcss-plugins/tree/main/plugins/postcss-custom-properties/CHANGELOG.md#1406) (patch)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC40MC4zIiwidXBkYXRlZEluVmVyIjoiNDAuNDAuMyIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwiamF2YXNjcmlwdCJdfQ==-->\n\n\n---\n\nChoice A:\napp/javascript/images/logo-symbol-icon.svg\n@@ -1,2 +1,2 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"79\" height=\"79\" viewBox=\"0 0 79 75\"><symbol id=\"logo-symbol-icon\"><path d=\"M74.7135 16.6043C73.6199 8.54587 66.5351 2.19527 58.1366 0.964691C56.7196 0.756754 51.351 0 38.9148 0H38.822C26.3824 0 23.7135 0.756754 22.2966 0.964691C14.1319 2.16118 6.67571 7.86752 4.86669 16.0214C3.99657 20.0369 3.90371 24.4888 4.06535 28.5726C4.29578 34.4289 4.34049 40.275 4.877 46.1075C5.24791 49.9817 5.89495 53.8251 6.81328 57.6088C8.53288 64.5968 15.4938 70.4122 22.3138 72.7848C29.6155 75.259 37.468 75.6697 44.9919 73.971C45.8196 73.7801 46.6381 73.5586 47.4475 73.3063C49.2737 72.7302 51.4164 72.086 52.9915 70.9542C53.0131 70.9384 53.0308 70.9178 53.0433 70.8942C53.0558 70.8706 53.0628 70.8445 53.0637 70.8179V65.1661C53.0634 65.1412 53.0574 65.1167 53.0462 65.0944C53.035 65.0721 53.0189 65.0525 52.9992 65.0371C52.9794 65.0218 52.9564 65.011 52.9318 65.0056C52.9073 65.0002 52.8819 65.0003 52.8574 65.0059C48.0369 66.1472 43.0971 66.7193 38.141 66.7103C29.6118 66.7103 27.3178 62.6981 26.6609 61.0278C26.1329 59.5842 25.7976 58.0784 25.6636 56.5486C25.6622 56.5229 25.667 56.4973 25.6775 56.4738C25.688 56.4502 25.7039 56.4295 25.724 56.4132C25.7441 56.397 25.7678 56.3856 25.7931 56.3801C25.8185 56.3746 25.8448 56.3751 25.8699 56.3816C30.6101 57.5151 35.4693 58.0873 40.3455 58.086C41.5183 58.086 42.6876 58.086 43.8604 58.0553C48.7647 57.919 53.9339 57.6701 58.7591 56.7361C58.8794 56.7123 58.9998 56.6918 59.103 56.6611C66.7139 55.2124 73.9569 50.665 74.6929 39.1501C74.7204 38.6967 74.7892 34.4016 74.7892 33.9312C74.7926 32.3325 75.3085 22.5901 74.7135 16.6043ZM62.9996 45.3371H54.9966V25.9069C54.9966 21.8163 53.277 19.7302 49.7793 19.7302C45.9343 19.7302 44.0083 22.1981 44.0083 27.0727V37.7082H36.0534V27.0727C36.0534 22.1981 34.124 19.7302 30.279 19.7302C26.8019 19.7302 25.0651 21.8163 25.0617 25.9069V45.3371H17.0656V25.3172C17.0656 21.2266 18.1191 17.9769 20.2262 15.568C22.3998 13.1648 25.2509 11.9308 28.7898 11.9308C32.8859 11.9308 35.9812 13.492 38.0447 16.6111L40.036 19.9245L42.0308 16.6111C44.0943 13.492 47.1896 11.9308 51.2788 11.9308C54.8143 11.9308 57.6654 13.1648 59.8459 15.568C61.9529 17.9746 63.0065 21.2243 63.0065 25.3172L62.9996 45.3371Z\" fill=\"currentColor\"/></symbol><use xlink:href=\"#logo-symbol-icon\"/></svg>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"79\" height=\"79\" viewBox=\"0 0 79 75\"><symbol id=\"logo-symbol-icon\"><path d=\"M63 45.3v-20c0-4.1-1-7.3-3.2-9.7-2.1-2.4-5-3.7-8.5-3.7-4.1 0-7.2 1.6-9.3 4.7l-2 3.3-2-3.3c-2-3.1-5.1-4.7-9.2-4.7-3.5 0-6.4 1.3-8.6 3.7-2.1 2.4-3.1 5.6-3.1 9.7v20h8V25.9c0-4.1 1.7-6.2 5.2-6.2 3.8 0 5.8 2.5 5.8 7.4V37.7H44V27.1c0-4.9 1.9-7.4 5.8-7.4 3.5 0 5.2 2.1 5.2 6.2V45.3h8ZM74.7 16.6c.6 6 .1 15.7.1 17.3 0 .5-.1 4.8-.1 5.3-.7 11.5-8 16-15.6 17.5-.1 0-.2 0-.3 0-4.9 1-10 1.2-14.9 1.4-1.2 0-2.4 0-3.6 0-4.8 0-9.7-.6-14.4-1.7-.1 0-.1 0-.1 0s-.1 0-.1 0 0 .1 0 .1 0 0 0 0c.1 1.6.4 3.1 1 4.5.6 1.7 2.9 5.7 11.4 5.7 5 0 9.9-.6 14.8-1.7 0 0 0 0 0 0 .1 0 .1 0 .1 0 0 .1 0 .1 0 .1.1 0 .1 0 .1.1v5.6s0 .1-.1.1c0 0 0 0 0 .1-1.6 1.1-3.7 1.7-5.6 2.3-.8.3-1.6.5-2.4.7-7.5 1.7-15.4 1.3-22.7-1.2-6.8-2.4-13.8-8.2-15.5-15.2-.9-3.8-1.6-7.6-1.9-11.5-.6-5.8-.6-11.7-.8-17.5C3.9 24.5 4 20 4.9 16 6.7 7.9 14.1 2.2 22.3 1c1.4-.2 4.1-1 16.5-1h.1C51.4 0 56.7.8 58.1 1c8.4 1.2 15.5 7.5 16.6 15.6Z\" fill=\"currentColor\"/></symbol><use xlink:href=\"#logo-symbol-icon\"/></svg>\n \n---\napp/serializers/oembed_serializer.rb\n@@ -75,7 +75,7 @@ def html\n     <<~HTML.squish\n       <blockquote class=\"mastodon-embed\" data-embed-url=\"#{embed_short_account_status_url(object.account, object)}\" style=\"#{INLINE_STYLES[:blockquote]}\">\n         <a href=\"#{short_account_status_url(object.account, object)}\" target=\"_blank\" style=\"#{INLINE_STYLES[:status_link]}\">\n-          <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"32\" height=\"32\" viewBox=\"0 0 79 75\"><path d=\"M74.7135 16.6043C73.6199 8.54587 66.5351 2.19527 58.1366 0.964691C56.7196 0.756754 51.351 0 38.9148 0H38.822C26.3824 0 23.7135 0.756754 22.2966 0.964691C14.1319 2.16118 6.67571 7.86752 4.86669 16.0214C3.99657 20.0369 3.90371 24.4888 4.06535 28.5726C4.29578 34.4289 4.34049 40.275 4.877 46.1075C5.24791 49.9817 5.89495 53.8251 6.81328 57.6088C8.53288 64.5968 15.4938 70.4122 22.3138 72.7848C29.6155 75.259 37.468 75.6697 44.9919 73.971C45.8196 73.7801 46.6381 73.5586 47.4475 73.3063C49.2737 72.7302 51.4164 72.086 52.9915 70.9542C53.0131 70.9384 53.0308 70.9178 53.0433 70.8942C53.0558 70.8706 53.0628 70.8445 53.0637 70.8179V65.1661C53.0634 65.1412 53.0574 65.1167 53.0462 65.0944C53.035 65.0721 53.0189 65.0525 52.9992 65.0371C52.9794 65.0218 52.9564 65.011 52.9318 65.0056C52.9073 65.0002 52.8819 65.0003 52.8574 65.0059C48.0369 66.1472 43.0971 66.7193 38.141 66.7103C29.6118 66.7103 27.3178 62.6981 26.6609 61.0278C26.1329 59.5842 25.7976 58.0784 25.6636 56.5486C25.6622 56.5229 25.667 56.4973 25.6775 56.4738C25.688 56.4502 25.7039 56.4295 25.724 56.4132C25.7441 56.397 25.7678 56.3856 25.7931 56.3801C25.8185 56.3746 25.8448 56.3751 25.8699 56.3816C30.6101 57.5151 35.4693 58.0873 40.3455 58.086C41.5183 58.086 42.6876 58.086 43.8604 58.0553C48.7647 57.919 53.9339 57.6701 58.7591 56.7361C58.8794 56.7123 58.9998 56.6918 59.103 56.6611C66.7139 55.2124 73.9569 50.665 74.6929 39.1501C74.7204 38.6967 74.7892 34.4016 74.7892 33.9312C74.7926 32.3325 75.3085 22.5901 74.7135 16.6043ZM62.9996 45.3371H54.9966V25.9069C54.9966 21.8163 53.277 19.7302 49.7793 19.7302C45.9343 19.7302 44.0083 22.1981 44.0083 27.0727V37.7082H36.0534V27.0727C36.0534 22.1981 34.124 19.7302 30.279 19.7302C26.8019 19.7302 25.0651 21.8163 25.0617 25.9069V45.3371H17.0656V25.3172C17.0656 21.2266 18.1191 17.9769 20.2262 15.568C22.3998 13.1648 25.2509 11.9308 28.7898 11.9308C32.8859 11.9308 35.9812 13.492 38.0447 16.6111L40.036 19.9245L42.0308 16.6111C44.0943 13.492 47.1896 11.9308 51.2788 11.9308C54.8143 11.9308 57.6654 13.1648 59.8459 15.568C61.9529 17.9746 63.0065 21.2243 63.0065 25.3172L62.9996 45.3371Z\" fill=\"currentColor\"/></svg>\n+          <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"32\" height=\"32\" viewBox=\"0 0 79 75\"><path d=\"M63 45.3v-20c0-4.1-1-7.3-3.2-9.7-2.1-2.4-5-3.7-8.5-3.7-4.1 0-7.2 1.6-9.3 4.7l-2 3.3-2-3.3c-2-3.1-5.1-4.7-9.2-4.7-3.5 0-6.4 1.3-8.6 3.7-2.1 2.4-3.1 5.6-3.1 9.7v20h8V25.9c0-4.1 1.7-6.2 5.2-6.2 3.8 0 5.8 2.5 5.8 7.4V37.7H44V27.1c0-4.9 1.9-7.4 5.8-7.4 3.5 0 5.2 2.1 5.2 6.2V45.3h8ZM74.7 16.6c.6 6 .1 15.7.1 17.3 0 .5-.1 4.8-.1 5.3-.7 11.5-8 16-15.6 17.5-.1 0-.2 0-.3 0-4.9 1-10 1.2-14.9 1.4-1.2 0-2.4 0-3.6 0-4.8 0-9.7-.6-14.4-1.7-.1 0-.1 0-.1 0s-.1 0-.1 0 0 .1 0 .1 0 0 0 0c.1 1.6.4 3.1 1 4.5.6 1.7 2.9 5.7 11.4 5.7 5 0 9.9-.6 14.8-1.7 0 0 0 0 0 0 .1 0 .1 0 .1 0 0 .1 0 .1 0 .1.1 0 .1 0 .1.1v5.6s0 .1-.1.1c0 0 0 0 0 .1-1.6 1.1-3.7 1.7-5.6 2.3-.8.3-1.6.5-2.4.7-7.5 1.7-15.4 1.3-22.7-1.2-6.8-2.4-13.8-8.2-15.5-15.2-.9-3.8-1.6-7.6-1.9-11.5-.6-5.8-.6-11.7-.8-17.5C3.9 24.5 4 20 4.9 16 6.7 7.9 14.1 2.2 22.3 1c1.4-.2 4.1-1 16.5-1h.1C51.4 0 56.7.8 58.1 1c8.4 1.2 15.5 7.5 16.6 15.6Z\" fill=\"currentColor\"/></svg>\n           <div style=\"#{INLINE_STYLES[:div_account]}\">Post by @#{object.account.pretty_acct}@#{provider_name}</div>\n           <div style=\"#{INLINE_STYLES[:div_view]}\">View on Mastodon</div>\n         </a>\n---\n\n\n---\n\nChoice B:\napp/models/user.rb\n@@ -73,7 +73,6 @@ class User < ApplicationRecord\n   ACTIVE_DURATION = ENV.fetch('USER_ACTIVE_DAYS', 7).to_i.days.freeze\n \n   devise :two_factor_authenticatable,\n-         otp_secret_encryption_key: Rails.configuration.x.otp_secret,\n          otp_secret_length: 32\n \n   devise :two_factor_backupable,\n---\nconfig/environments/development.rb\n@@ -84,9 +84,6 @@\n   # Otherwise, use letter_opener, which launches a browser window to view sent mail.\n   config.action_mailer.delivery_method = ENV['HEROKU'] || ENV['VAGRANT'] || ENV['REMOTE_DEV'] ? :letter_opener_web : :letter_opener\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = ENV.fetch('OTP_SECRET', '1fc2b87989afa6351912abeebe31ffc5c476ead9bf8b3d74cbc4a302c7b69a45b40b1bbef3506ddad73e942e15ed5ca4b402bf9a66423626051104f4b5f05109')\n-\n   # Raise error when a before_action's only/except options reference missing actions.\n   config.action_controller.raise_on_missing_callback_actions = true\n \n---\n\n\n---\n\nChoice C:\n.rubocop_todo.yml\n@@ -70,13 +70,6 @@ Style/OptionalBooleanParameter:\n     - 'app/workers/domain_block_worker.rb'\n     - 'app/workers/unfollow_follow_worker.rb'\n \n-# This cop supports unsafe autocorrection (--autocorrect-all).\n-# Configuration parameters: EnforcedStyle.\n-# SupportedStyles: short, verbose\n-Style/PreferredHashMethods:\n-  Exclude:\n-    - 'config/initializers/paperclip.rb'\n-\n # This cop supports safe autocorrection (--autocorrect).\n Style/RedundantConstantBase:\n   Exclude:\n---\nconfig/initializers/paperclip.rb\n@@ -42,7 +42,7 @@\n   s3_protocol = ENV.fetch('S3_PROTOCOL') { 'https' }\n   s3_hostname = ENV.fetch('S3_HOSTNAME') { \"s3-#{s3_region}.amazonaws.com\" }\n \n-  Paperclip::Attachment.default_options[:path] = ENV.fetch('S3_KEY_PREFIX') + \"/#{PATH}\" if ENV.has_key?('S3_KEY_PREFIX')\n+  Paperclip::Attachment.default_options[:path] = ENV.fetch('S3_KEY_PREFIX') + \"/#{PATH}\" if ENV.key?('S3_KEY_PREFIX')\n \n   Paperclip::Attachment.default_options.merge!(\n     storage: :s3,\n@@ -74,7 +74,7 @@\n \n   Paperclip::Attachment.default_options[:s3_permissions] = ->(*) {} if ENV['S3_PERMISSION'] == ''\n \n-  if ENV.has_key?('S3_ENDPOINT')\n+  if ENV.key?('S3_ENDPOINT')\n     Paperclip::Attachment.default_options[:s3_options].merge!(\n       endpoint: ENV['S3_ENDPOINT'],\n       force_path_style: ENV['S3_OVERRIDE_PATH_STYLE'] != 'true'\n@@ -83,14 +83,14 @@\n     Paperclip::Attachment.default_options[:url] = ':s3_path_url'\n   end\n \n-  if ENV.has_key?('S3_ALIAS_HOST') || ENV.has_key?('S3_CLOUDFRONT_HOST')\n+  if ENV.key?('S3_ALIAS_HOST') || ENV.key?('S3_CLOUDFRONT_HOST')\n     Paperclip::Attachment.default_options.merge!(\n       url: ':s3_alias_url',\n       s3_host_alias: ENV['S3_ALIAS_HOST'] || ENV['S3_CLOUDFRONT_HOST']\n     )\n   end\n \n-  Paperclip::Attachment.default_options[:s3_headers]['X-Amz-Storage-Class'] = ENV['S3_STORAGE_CLASS'] if ENV.has_key?('S3_STORAGE_CLASS')\n+  Paperclip::Attachment.default_options[:s3_headers]['X-Amz-Storage-Class'] = ENV['S3_STORAGE_CLASS'] if ENV.key?('S3_STORAGE_CLASS')\n \n   # Some S3-compatible providers might not actually be compatible with some APIs\n   # used by kt-paperclip, see https://github.com/mastodon/mastodon/issues/16822\n@@ -153,7 +153,7 @@ def copy_to_local_file(style, local_dest_path)\n       container: ENV['AZURE_CONTAINER_NAME'],\n     }\n   )\n-  if ENV.has_key?('AZURE_ALIAS_HOST')\n+  if ENV.key?('AZURE_ALIAS_HOST')\n     Paperclip::Attachment.default_options.merge!(\n       url: ':azure_alias_url',\n       azure_host_alias: ENV['AZURE_ALIAS_HOST']\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -4860,17 +4860,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"browserslist@npm:^4.24.0, browserslist@npm:^4.24.4, browserslist@npm:^4.24.5\":\n-  version: 4.24.5\n-  resolution: \"browserslist@npm:4.24.5\"\n+\"browserslist@npm:^4.24.0, browserslist@npm:^4.24.4, browserslist@npm:^4.25.0\":\n+  version: 4.25.0\n+  resolution: \"browserslist@npm:4.25.0\"\n   dependencies:\n-    caniuse-lite: \"npm:^1.0.30001716\"\n-    electron-to-chromium: \"npm:^1.5.149\"\n+    caniuse-lite: \"npm:^1.0.30001718\"\n+    electron-to-chromium: \"npm:^1.5.160\"\n     node-releases: \"npm:^2.0.19\"\n     update-browserslist-db: \"npm:^1.1.3\"\n   bin:\n     browserslist: cli.js\n-  checksum: 10c0/f4c1ce1a7d8fdfab5e5b88bb6e93d09e8a883c393f86801537a252da0362dbdcde4dbd97b318246c5d84c6607b2f6b47af732c1b000d6a8a881ee024bad29204\n+  checksum: 10c0/cc16c55b4468b18684a0e1ca303592b38635b1155d6724f172407192737a2f405b8030d87a05813729592793445b3d15e737b0055f901cdecccb29b1e580a1c5\n   languageName: node\n   linkType: hard\n \n@@ -4991,10 +4991,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"caniuse-lite@npm:^1.0.30001702, caniuse-lite@npm:^1.0.30001716\":\n-  version: 1.0.30001718\n-  resolution: \"caniuse-lite@npm:1.0.30001718\"\n-  checksum: 10c0/67f9ad09bc16443e28d14f265d6e468480cd8dc1900d0d8b982222de80c699c4f2306599c3da8a3fa7139f110d4b30d49dbac78f215470f479abb6ffe141d5d3\n+\"caniuse-lite@npm:^1.0.30001702, caniuse-lite@npm:^1.0.30001718\":\n+  version: 1.0.30001721\n+  resolution: \"caniuse-lite@npm:1.0.30001721\"\n+  checksum: 10c0/fa3a8926899824b385279f1f886fe34c5efb1321c9ece1b9df25c8d567a2706db8450cc5b4d969e769e641593e08ea644909324aba93636a43e4949a75f81c4c\n   languageName: node\n   linkType: hard\n \n@@ -5735,10 +5735,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"electron-to-chromium@npm:^1.5.149\":\n-  version: 1.5.159\n-  resolution: \"electron-to-chromium@npm:1.5.159\"\n-  checksum: 10c0/dc5b60a235ad04b1637b3b2af4914ac900c42813b02262a91a41d950223316f7b12de715697cf9c2d9f572f716f9422bf259ee65d86599cd2cc66e92c499ebd1\n+\"electron-to-chromium@npm:^1.5.160\":\n+  version: 1.5.165\n+  resolution: \"electron-to-chromium@npm:1.5.165\"\n+  checksum: 10c0/20b91e67e7a8829a358c4a488e9b59b0e5f8d4cb075a70b9757bb21acf0fc751ca58ca7d9c6018bec74ac4bd42f7859e4ef37421c252a2275f642e12a32271d6\n   languageName: node\n   linkType: hard\n \n@@ -9321,9 +9321,9 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"postcss-custom-properties@npm:^14.0.5\":\n-  version: 14.0.5\n-  resolution: \"postcss-custom-properties@npm:14.0.5\"\n+\"postcss-custom-properties@npm:^14.0.6\":\n+  version: 14.0.6\n+  resolution: \"postcss-custom-properties@npm:14.0.6\"\n   dependencies:\n     \"@csstools/cascade-layer-name-parser\": \"npm:^2.0.5\"\n     \"@csstools/css-parser-algorithms\": \"npm:^3.0.5\"\n@@ -9332,7 +9332,7 @@ __metadata:\n     postcss-value-parser: \"npm:^4.2.0\"\n   peerDependencies:\n     postcss: ^8.4\n-  checksum: 10c0/ddee0545075dc0888cd54a9bb5791a98719a5d4f31d1de33823841efb540fa79f65e48b7c4aaba753d3214102e419536c5bc46c72e6e1579e5352da4e042ef3b\n+  checksum: 10c0/0eeef77bc713551f5cb8fa5982d24da4e854075f3af020f1c94366c47a23a4cc225ebfecc978bdb17f00ee0bdee9d2c784e0d01adc64a447321e408abbe2c83b\n   languageName: node\n   linkType: hard\n \n@@ -9513,8 +9513,8 @@ __metadata:\n   linkType: hard\n \n \"postcss-preset-env@npm:^10.1.5\":\n-  version: 10.2.0\n-  resolution: \"postcss-preset-env@npm:10.2.0\"\n+  version: 10.2.1\n+  resolution: \"postcss-preset-env@npm:10.2.1\"\n   dependencies:\n     \"@csstools/postcss-cascade-layers\": \"npm:^5.0.1\"\n     \"@csstools/postcss-color-function\": \"npm:^4.0.10\"\n@@ -9550,7 +9550,7 @@ __metadata:\n     \"@csstools/postcss-trigonometric-functions\": \"npm:^4.0.9\"\n     \"@csstools/postcss-unset-value\": \"npm:^4.0.0\"\n     autoprefixer: \"npm:^10.4.21\"\n-    browserslist: \"npm:^4.24.5\"\n+    browserslist: \"npm:^4.25.0\"\n     css-blank-pseudo: \"npm:^7.0.1\"\n     css-has-pseudo: \"npm:^7.0.2\"\n     css-prefers-color-scheme: \"npm:^10.0.0\"\n@@ -9561,7 +9561,7 @@ __metadata:\n     postcss-color-hex-alpha: \"npm:^10.0.0\"\n     postcss-color-rebeccapurple: \"npm:^10.0.0\"\n     postcss-custom-media: \"npm:^11.0.6\"\n-    postcss-custom-properties: \"npm:^14.0.5\"\n+    postcss-custom-properties: \"npm:^14.0.6\"\n     postcss-custom-selectors: \"npm:^8.0.5\"\n     postcss-dir-pseudo-class: \"npm:^9.0.1\"\n     postcss-double-position-gradients: \"npm:^6.0.2\"\n@@ -9582,7 +9582,7 @@ __metadata:\n     postcss-selector-not: \"npm:^8.0.1\"\n   peerDependencies:\n     postcss: ^8.4\n-  checksum: 10c0/33406dcdd1d63fd3810f12cd97bf0d6a09a51917943ee7d75e2ccaf1d8cbce363abcb90ee68f14509d287d00de4afd6664dbdecaa4f4b95509e3578e27f54a24\n+  checksum: 10c0/1a78eb86bca8f7c2bf7686ee9ed354b21d1316a7d12ae9aec2ce4b4810f6d32e23d0787d7450e55145f14f76b715df758bb54af0ea6a151858b045bd429f596e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFiltering client-side is perhaps not the best way since it can result in empty pages, but that is consistent with the other kinds of post type filtering that we already have.\r\n\r\nBeing able to hide quote posts is a request that came up a bunch, and since we have filters for reblogs and replies, I don't see why not.\n\n---\n\nChoice A:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -1023,7 +1023,7 @@ export const AccountHeader: React.FC<{\n                   />\n                 </NavLink>\n               </div>\n-              <FamiliarFollowers accountId={accountId} />\n+              {signedIn && <FamiliarFollowers accountId={accountId} />}\n             </div>\n           )}\n         </div>\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/home_timeline/components/column_settings.tsx\n@@ -40,6 +40,19 @@ export const ColumnSettings: React.FC = () => {\n             }\n           />\n \n+          <SettingToggle\n+            prefix='home_timeline'\n+            settings={settings}\n+            settingPath={['shows', 'quote']}\n+            onChange={onChange}\n+            label={\n+              <FormattedMessage\n+                id='home.column_settings.show_quotes'\n+                defaultMessage='Show quotes'\n+              />\n+            }\n+          />\n+\n           <SettingToggle\n             prefix='home_timeline'\n             settings={settings}\n---\napp/javascript/mastodon/features/ui/containers/status_list_container.js\n@@ -17,19 +17,22 @@ const makeGetStatusIds = (pending = false) => createSelector([\n     if (id === null || id === 'inline-follow-suggestions') return true;\n \n     const statusForId = statuses.get(id);\n-    let showStatus    = true;\n \n     if (statusForId.get('account') === me) return true;\n \n-    if (columnSettings.getIn(['shows', 'reblog']) === false) {\n-      showStatus = showStatus && statusForId.get('reblog') === null;\n+    if (columnSettings.getIn(['shows', 'reblog']) === false && statusForId.get('reblog') !== null) {\n+      return false;\n     }\n \n-    if (columnSettings.getIn(['shows', 'reply']) === false) {\n-      showStatus = showStatus && (statusForId.get('in_reply_to_id') === null || statusForId.get('in_reply_to_account_id') === me);\n+    if (columnSettings.getIn(['shows', 'reply']) === false && statusForId.get('in_reply_to_id') !== null && statusForId.get('in_reply_to_account_id') !== me) {\n+      return false;\n     }\n \n-    return showStatus;\n+    if (columnSettings.getIn(['shows', 'quote']) === false && statusForId.get('quote') !== null) {\n+      return false;\n+    }\n+\n+    return true;\n   });\n });\n \n---\napp/javascript/mastodon/locales/en.json\n@@ -430,6 +430,7 @@\n   \"hints.profiles.see_more_posts\": \"See more posts on {domain}\",\n   \"hints.threads.replies_may_be_missing\": \"Replies from other servers may be missing.\",\n   \"hints.threads.see_more\": \"See more replies on {domain}\",\n+  \"home.column_settings.show_quotes\": \"Show quotes\",\n   \"home.column_settings.show_reblogs\": \"Show boosts\",\n   \"home.column_settings.show_replies\": \"Show replies\",\n   \"home.hide_announcements\": \"Hide announcements\",\n---\napp/javascript/mastodon/reducers/settings.js\n@@ -20,6 +20,7 @@ const initialState = ImmutableMap({\n \n   home: ImmutableMap({\n     shows: ImmutableMap({\n+      quote: true,\n       reblog: true,\n       reply: true,\n     }),\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n---\n\n\n---\n\nChoice D:\n.github/workflows/test-ruby.yml\n@@ -143,7 +143,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick libpam-dev\n+          additional-system-dependencies: ffmpeg libpam-dev\n \n       - name: Load database schema\n         run: |\n@@ -173,8 +173,8 @@ jobs:\n         env:\n           CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}\n \n-  test-libvips:\n-    name: Libvips tests\n+  test-imagemagick:\n+    name: ImageMagick tests\n     runs-on: ubuntu-latest\n \n     needs:\n@@ -220,7 +220,7 @@ jobs:\n       CAS_ENABLED: true\n       BUNDLE_WITH: 'pam_authentication test'\n       GITHUB_RSPEC: ${{ matrix.ruby-version == '.ruby-version' && github.event.pull_request && 'true' }}\n-      MASTODON_USE_LIBVIPS: true\n+      MASTODON_USE_LIBVIPS: false\n \n     strategy:\n       fail-fast: false\n@@ -245,7 +245,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg libpam-dev\n+          additional-system-dependencies: ffmpeg imagemagick libpam-dev\n \n       - name: Load database schema\n         run: './bin/rails db:create db:schema:load db:seed'\n@@ -324,7 +324,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick\n+          additional-system-dependencies: ffmpeg\n \n       - name: Set up Javascript environment\n         uses: ./.github/actions/setup-javascript\n@@ -443,7 +443,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick\n+          additional-system-dependencies: ffmpeg\n \n       - name: Set up Javascript environment\n         uses: ./.github/actions/setup-javascript\n---\nconfig/application.rb\n@@ -95,7 +95,7 @@ class Application < Rails::Application\n       require 'mastodon/redis_configuration'\n       ::REDIS_CONFIGURATION = Mastodon::RedisConfiguration.new\n \n-      config.x.use_vips = ENV['MASTODON_USE_LIBVIPS'] == 'true'\n+      config.x.use_vips = ENV['MASTODON_USE_LIBVIPS'] != 'false'\n \n       if config.x.use_vips\n         require_relative '../lib/paperclip/vips_lazy_thumbnail'\n---\nconfig/initializers/deprecations.rb\n@@ -16,3 +16,9 @@\n \n   abort message\n end\n+\n+if ENV['MASTODON_USE_LIBVIPS'] == 'false'\n+  warn <<~MESSAGE\n+    WARNING: Mastodon support for ImageMagick is deprecated and will be removed in future versions. Please consider using libvips instead.\n+  MESSAGE\n+end\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34943\r\n\r\nThis effectively downgrades compatibility with non-FEP-044f quote posts to only treat them as quote posts in the REST API if they are accepted.\r\n\r\nIn practice, this means fast-track (self-quotes or quotes from mentioned users) will be accepted and displayed as quote posts, other posts will just be whatever fallback the authoring software outputs.\r\n\r\nThis PR doesn't alter our compliance with FEP-044f, which mandates support for quote controls (since it's the point), but affects the fallback behavior with `quoteUri`, `quoteUrl`, and `_misskey_quote`, and may lead to confusion as to why some of those quote-posts work and some of them don't.\n\n---\n\nChoice A:\napp/javascript/mastodon/actions/accounts_typed.ts\n@@ -1,7 +1,9 @@\n import { createAction } from '@reduxjs/toolkit';\n \n+import { apiRemoveAccountFromFollowers } from 'mastodon/api/accounts';\n import type { ApiAccountJSON } from 'mastodon/api_types/accounts';\n import type { ApiRelationshipJSON } from 'mastodon/api_types/relationships';\n+import { createDataLoadingThunk } from 'mastodon/store/typed_functions';\n \n export const revealAccount = createAction<{\n   id: string;\n@@ -95,3 +97,10 @@ export const fetchRelationshipsSuccess = createAction(\n   'relationships/fetch/SUCCESS',\n   actionWithSkipLoadingTrue<{ relationships: ApiRelationshipJSON[] }>,\n );\n+\n+export const removeAccountFromFollowers = createDataLoadingThunk(\n+  'accounts/remove_from_followers',\n+  ({ accountId }: { accountId: string }) =>\n+    apiRemoveAccountFromFollowers(accountId),\n+  (relationship) => ({ relationship }),\n+);\n---\napp/javascript/mastodon/api/accounts.ts\n@@ -18,3 +18,8 @@ export const apiFollowAccount = (\n \n export const apiUnfollowAccount = (id: string) =>\n   apiRequestPost<ApiRelationshipJSON>(`v1/accounts/${id}/unfollow`);\n+\n+export const apiRemoveAccountFromFollowers = (id: string) =>\n+  apiRequestPost<ApiRelationshipJSON>(\n+    `v1/accounts/${id}/remove_from_followers`,\n+  );\n---\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -18,6 +18,7 @@ import {\n   unmuteAccount,\n   pinAccount,\n   unpinAccount,\n+  removeAccountFromFollowers,\n } from 'mastodon/actions/accounts';\n import { initBlockModal } from 'mastodon/actions/blocks';\n import { mentionCompose, directCompose } from 'mastodon/actions/compose';\n@@ -152,6 +153,23 @@ const messages = defineMessages({\n     id: 'account.open_original_page',\n     defaultMessage: 'Open original page',\n   },\n+  removeFromFollowers: {\n+    id: 'account.remove_from_followers',\n+    defaultMessage: 'Remove {name} from followers',\n+  },\n+  confirmRemoveFromFollowersTitle: {\n+    id: 'confirmations.remove_from_followers.title',\n+    defaultMessage: 'Remove follower?',\n+  },\n+  confirmRemoveFromFollowersMessage: {\n+    id: 'confirmations.remove_from_followers.message',\n+    defaultMessage:\n+      '{name} will stop following you. Are you sure you want to proceed?',\n+  },\n+  confirmRemoveFromFollowersButton: {\n+    id: 'confirmations.remove_from_followers.confirm',\n+    defaultMessage: 'Remove follower',\n+  },\n });\n \n const titleFromAccount = (account: Account) => {\n@@ -494,6 +512,39 @@ export const AccountHeader: React.FC<{\n         arr.push(null);\n       }\n \n+      if (relationship?.followed_by) {\n+        const handleRemoveFromFollowers = () => {\n+          dispatch(\n+            openModal({\n+              modalType: 'CONFIRM',\n+              modalProps: {\n+                title: intl.formatMessage(\n+                  messages.confirmRemoveFromFollowersTitle,\n+                ),\n+                message: intl.formatMessage(\n+                  messages.confirmRemoveFromFollowersMessage,\n+                  { name: <strong>{account.acct}</strong> },\n+                ),\n+                confirm: intl.formatMessage(\n+                  messages.confirmRemoveFromFollowersButton,\n+                ),\n+                onConfirm: () => {\n+                  void dispatch(removeAccountFromFollowers({ accountId }));\n+                },\n+              },\n+            }),\n+          );\n+        };\n+\n+        arr.push({\n+          text: intl.formatMessage(messages.removeFromFollowers, {\n+            name: account.username,\n+          }),\n+          action: handleRemoveFromFollowers,\n+          dangerous: true,\n+        });\n+      }\n+\n       if (relationship?.muting) {\n         arr.push({\n           text: intl.formatMessage(messages.unmute, {\n@@ -592,6 +643,8 @@ export const AccountHeader: React.FC<{\n \n     return arr;\n   }, [\n+    dispatch,\n+    accountId,\n     account,\n     relationship,\n     permissions,\n---\napp/javascript/mastodon/locales/en.json\n@@ -62,6 +62,7 @@\n   \"account.open_original_page\": \"Open original page\",\n   \"account.posts\": \"Posts\",\n   \"account.posts_with_replies\": \"Posts and replies\",\n+  \"account.remove_from_followers\": \"Remove {name} from followers\",\n   \"account.report\": \"Report @{name}\",\n   \"account.requested\": \"Awaiting approval. Click to cancel follow request\",\n   \"account.requested_follow\": \"{name} has requested to follow you\",\n@@ -233,6 +234,9 @@\n   \"confirmations.redraft.confirm\": \"Delete & redraft\",\n   \"confirmations.redraft.message\": \"Are you sure you want to delete this post and re-draft it? Favorites and boosts will be lost, and replies to the original post will be orphaned.\",\n   \"confirmations.redraft.title\": \"Delete & redraft post?\",\n+  \"confirmations.remove_from_followers.confirm\": \"Remove follower\",\n+  \"confirmations.remove_from_followers.message\": \"{name} will stop following you. Are you sure you want to proceed?\",\n+  \"confirmations.remove_from_followers.title\": \"Remove follower?\",\n   \"confirmations.reply.confirm\": \"Reply\",\n   \"confirmations.reply.message\": \"Replying now will overwrite the message you are currently composing. Are you sure you want to proceed?\",\n   \"confirmations.reply.title\": \"Overwrite post?\",\n---\napp/javascript/mastodon/reducers/relationships.ts\n@@ -24,6 +24,7 @@ import {\n   pinAccountSuccess,\n   unpinAccountSuccess,\n   fetchRelationshipsSuccess,\n+  removeAccountFromFollowers,\n } from '../actions/accounts_typed';\n import {\n   blockDomainSuccess,\n@@ -109,7 +110,8 @@ export const relationshipsReducer: Reducer<State> = (\n     unmuteAccountSuccess.match(action) ||\n     pinAccountSuccess.match(action) ||\n     unpinAccountSuccess.match(action) ||\n-    isFulfilled(submitAccountNote)(action)\n+    isFulfilled(submitAccountNote)(action) ||\n+    isFulfilled(removeAccountFromFollowers)(action)\n   )\n     return normalizeRelationship(state, action.payload.relationship);\n   else if (fetchRelationshipsSuccess.match(action))\n---\n\n\n---\n\nChoice B:\napp/javascript/styles/mastodon/admin.scss\n@@ -3,7 +3,7 @@\n @use 'variables' as *;\n \n $no-columns-breakpoint: 890px;\n-$sidebar-width: 300px;\n+$sidebar-width: 360px;\n $content-width: 840px;\n \n .admin-wrapper {\n@@ -180,8 +180,8 @@ $content-width: 840px;\n   .content {\n     padding-top: 55px;\n     padding-bottom: 20px;\n-    padding-inline-start: 25px;\n-    padding-inline-end: 15px;\n+    padding-inline-start: 15px;\n+    padding-inline-end: 5px;\n \n     @media screen and (max-width: $no-columns-breakpoint) {\n       max-width: none;\n---\n\n\n---\n\nChoice C:\napp/lib/activitypub/activity/create.rb\n@@ -233,7 +233,7 @@ def process_quote\n \n     approval_uri = @status_parser.quote_approval_uri\n     approval_uri = nil if unsupported_uri_scheme?(approval_uri)\n-    @quote = Quote.new(account: @account, approval_uri: approval_uri)\n+    @quote = Quote.new(account: @account, approval_uri: approval_uri, legacy: @status_parser.legacy_quote?)\n   end\n \n   def process_hashtag(tag)\n---\napp/lib/activitypub/parser/status_parser.rb\n@@ -123,6 +123,10 @@ def quote_uri\n     end.first\n   end\n \n+  def legacy_quote?\n+    !@object.key?('quote')\n+  end\n+\n   # The inlined quote; out of the attributes we support, only `https://w3id.org/fep/044f#quote` explicitly supports inlined objects\n   def quoted_object\n     as_array(@object['quote']).first\n---\napp/models/quote.rb\n@@ -7,6 +7,7 @@\n #  id                :bigint(8)        not null, primary key\n #  activity_uri      :string\n #  approval_uri      :string\n+#  legacy            :boolean          default(FALSE), not null\n #  state             :integer          default(\"pending\"), not null\n #  created_at        :datetime         not null\n #  updated_at        :datetime         not null\n@@ -46,6 +47,10 @@ def reject!\n     end\n   end\n \n+  def acceptable?\n+    accepted? || !legacy?\n+  end\n+\n   def schedule_refresh_if_stale!\n     return unless quoted_status_id.present? && approval_uri.present? && updated_at <= BACKGROUND_REFRESH_INTERVAL.ago\n \n---\napp/serializers/rest/status_serializer.rb\n@@ -33,6 +33,10 @@ class REST::StatusSerializer < ActiveModel::Serializer\n   has_one :preview_card, key: :card, serializer: REST::PreviewCardSerializer\n   has_one :preloadable_poll, key: :poll, serializer: REST::PollSerializer\n \n+  def quote\n+    object.quote if object.quote&.acceptable?\n+  end\n+\n   def id\n     object.id.to_s\n   end\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -283,14 +283,14 @@ def update_quote!\n         # If the quoted post has changed, discard the old object and create a new one\n         if @status.quote.quoted_status.present? && ActivityPub::TagManager.instance.uri_for(@status.quote.quoted_status) != quote_uri\n           @status.quote.destroy\n-          quote = Quote.create(status: @status, approval_uri: approval_uri)\n+          quote = Quote.create(status: @status, approval_uri: approval_uri, legacy: @status_parser.legacy_quote?)\n           @quote_changed = true\n         else\n           quote = @status.quote\n-          quote.update(approval_uri: approval_uri, state: :pending) if quote.approval_uri != @status_parser.quote_approval_uri\n+          quote.update(approval_uri: approval_uri, state: :pending, legacy: @status_parser.legacy_quote?) if quote.approval_uri != @status_parser.quote_approval_uri\n         end\n       else\n-        quote = Quote.create(status: @status, approval_uri: approval_uri)\n+        quote = Quote.create(status: @status, approval_uri: approval_uri, legacy: @status_parser.legacy_quote?)\n         @quote_changed = true\n       end\n \n---\ndb/migrate/20250605110215_add_legacy_to_quotes.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddLegacyToQuotes < ActiveRecord::Migration[8.0]\n+  def change\n+    add_column :quotes, :legacy, :boolean, null: false, default: false\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_05_20_204643) do\n+ActiveRecord::Schema[8.0].define(version: 2025_06_05_110215) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -906,6 +906,7 @@\n     t.string \"activity_uri\"\n     t.datetime \"created_at\", null: false\n     t.datetime \"updated_at\", null: false\n+    t.boolean \"legacy\", default: false, null: false\n     t.index [\"account_id\", \"quoted_account_id\"], name: \"index_quotes_on_account_id_and_quoted_account_id\"\n     t.index [\"activity_uri\"], name: \"index_quotes_on_activity_uri\", unique: true, where: \"(activity_uri IS NOT NULL)\"\n     t.index [\"approval_uri\"], name: \"index_quotes_on_approval_uri\", where: \"(approval_uri IS NOT NULL)\"\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -94,7 +94,7 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n+    aws-partitions (1.1103.0)\n     aws-sdk-core (3.215.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n@@ -109,7 +109,7 @@ GEM\n       aws-sigv4 (~> 1.5)\n     aws-sigv4 (1.11.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n-    azure-blob (0.5.7)\n+    azure-blob (0.5.8)\n       rexml\n     base64 (0.2.0)\n     bcp47_spec (0.2.1)\n@@ -124,7 +124,7 @@ GEM\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n-    bootsnap (1.18.5)\n+    bootsnap (1.18.6)\n       msgpack (~> 1.2)\n     brakeman (7.0.2)\n       racc\n@@ -194,7 +194,7 @@ GEM\n     devise_pam_authenticatable2 (9.2.0)\n       devise (>= 4.0.0)\n       rpam2 (~> 4.0)\n-    diff-lcs (1.6.1)\n+    diff-lcs (1.6.2)\n     discard (1.4.0)\n       activerecord (>= 4.2, < 9.0)\n     docile (1.4.1)\n@@ -228,7 +228,7 @@ GEM\n     fabrication (2.31.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n-    faraday (2.13.0)\n+    faraday (2.13.1)\n       faraday-net_http (>= 2.0, < 3.5)\n       json\n       logger\n@@ -267,10 +267,10 @@ GEM\n       raabro (~> 1.4)\n     globalid (1.2.1)\n       activesupport (>= 6.1)\n-    google-protobuf (4.30.2)\n+    google-protobuf (4.31.0)\n       bigdecimal\n       rake (>= 13)\n-    googleapis-common-protos-types (1.19.0)\n+    googleapis-common-protos-types (1.20.0)\n       google-protobuf (>= 3.18, < 5.a)\n     haml (6.3.0)\n       temple (>= 0.8.2)\n@@ -338,7 +338,7 @@ GEM\n       azure-blob (~> 0.5.2)\n       hashie (~> 5.0)\n     jmespath (1.6.2)\n-    json (2.10.2)\n+    json (2.12.0)\n     json-canonicalization (1.0.0)\n     json-jwt (1.16.7)\n       activesupport (>= 4.2)\n@@ -411,7 +411,7 @@ GEM\n       activesupport (>= 4)\n       railties (>= 4)\n       request_store (~> 1.0)\n-    loofah (2.24.0)\n+    loofah (2.24.1)\n       crass (~> 1.0.2)\n       nokogiri (>= 1.12.0)\n     mail (2.8.1)\n@@ -427,9 +427,9 @@ GEM\n     mime-types (3.7.0)\n       logger\n       mime-types-data (~> 3.2025, >= 3.2025.0507)\n-    mime-types-data (3.2025.0507)\n+    mime-types-data (3.2025.0514)\n     mini_mime (1.1.5)\n-    mini_portile2 (2.8.8)\n+    mini_portile2 (2.8.9)\n     minitest (5.25.5)\n     msgpack (1.8.0)\n     multi_json (1.15.0)\n@@ -504,7 +504,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-active_support (~> 0.7)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-action_pack (0.12.0)\n+    opentelemetry-instrumentation-action_pack (0.12.1)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n       opentelemetry-instrumentation-rack (~> 0.21)\n@@ -618,7 +618,7 @@ GEM\n       activesupport (>= 7.0.0)\n       rack\n       railties (>= 7.0.0)\n-    psych (5.2.3)\n+    psych (5.2.6)\n       date\n       stringio\n     public_suffix (6.0.2)\n@@ -710,7 +710,7 @@ GEM\n       railties (>= 5.2)\n     rexml (3.4.1)\n     rotp (6.3.0)\n-    rouge (4.5.1)\n+    rouge (4.5.2)\n     rpam2 (4.0.2)\n     rqrcode (3.1.0)\n       chunky_png (~> 1.0)\n@@ -727,7 +727,7 @@ GEM\n       rspec-support (~> 3.13.0)\n     rspec-github (3.0.0)\n       rspec-core (~> 3.0)\n-    rspec-mocks (3.13.3)\n+    rspec-mocks (3.13.4)\n       diff-lcs (>= 1.2.0, < 2.0)\n       rspec-support (~> 3.13.0)\n     rspec-rails (8.0.0)\n@@ -1092,4 +1092,4 @@ RUBY VERSION\n    ruby 3.4.1p0\n \n BUNDLED WITH\n-   2.6.8\n+   2.6.9\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34930\r\n\r\n### Changes proposed in this PR:\r\n- Fixes broken audio player layout in Safari \r\n\r\n### Screenshots\r\n\r\n![image](https://github.com/user-attachments/assets/f4cb6d5d-c0db-4890-b267-db7fcb730749)\r\n\n\n---\n\nChoice A:\napp/javascript/styles/mastodon/components.scss\n@@ -7068,18 +7068,19 @@ a.status-card {\n }\n \n .audio-player {\n-  overflow: hidden;\n   box-sizing: border-box;\n+  container: audio-player / inline-size;\n   position: relative;\n-  background: var(--player-background-color, var(--background-color));\n+  overflow: hidden;\n+  display: flex;\n+  flex-direction: column;\n+  width: 100%;\n+  aspect-ratio: 16 / 9;\n   color: var(--player-foreground-color);\n+  background: var(--player-background-color, var(--background-color));\n   border-radius: 8px;\n-  padding-bottom: 44px;\n-  width: 100%;\n   outline: 1px solid var(--media-outline-color);\n   outline-offset: -1px;\n-  aspect-ratio: 16 / 9;\n-  container: audio-player / inline-size;\n \n   &__controls {\n     display: grid;\n@@ -7128,9 +7129,17 @@ a.status-card {\n   }\n \n   &__visualizer {\n+    width: 100%;\n     max-width: 200px;\n   }\n \n+  .video-player__seek {\n+    position: absolute;\n+    inset: 0 0 auto;\n+    height: 24px;\n+    z-index: 1; /* Ensure this renders on top of audio player controls */\n+  }\n+\n   &.inactive {\n     .video-player__seek,\n     .audio-player__controls,\n---\n\n\n---\n\nChoice B:\napp/models/user.rb\n@@ -73,7 +73,6 @@ class User < ApplicationRecord\n   ACTIVE_DURATION = ENV.fetch('USER_ACTIVE_DAYS', 7).to_i.days.freeze\n \n   devise :two_factor_authenticatable,\n-         otp_secret_encryption_key: Rails.configuration.x.otp_secret,\n          otp_secret_length: 32\n \n   devise :two_factor_backupable,\n---\nconfig/environments/development.rb\n@@ -84,9 +84,6 @@\n   # Otherwise, use letter_opener, which launches a browser window to view sent mail.\n   config.action_mailer.delivery_method = ENV['HEROKU'] || ENV['VAGRANT'] || ENV['REMOTE_DEV'] ? :letter_opener_web : :letter_opener\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = ENV.fetch('OTP_SECRET', '1fc2b87989afa6351912abeebe31ffc5c476ead9bf8b3d74cbc4a302c7b69a45b40b1bbef3506ddad73e942e15ed5ca4b402bf9a66423626051104f4b5f05109')\n-\n   # Raise error when a before_action's only/except options reference missing actions.\n   config.action_controller.raise_on_missing_callback_actions = true\n \n---\n\n\n---\n\nChoice C:\napp/models/home_feed.rb\n@@ -9,4 +9,12 @@ def initialize(account)\n   def regenerating?\n     redis.exists?(\"account:#{@account.id}:regeneration\")\n   end\n+\n+  def regeneration_in_progress!\n+    redis.set(\"account:#{@account.id}:regeneration\", true, nx: true, ex: 1.day.seconds)\n+  end\n+\n+  def regeneration_finished!\n+    redis.del(\"account:#{@account.id}:regeneration\")\n+  end\n end\n---\napp/models/user.rb\n@@ -531,7 +531,11 @@ def notify_staff_about_pending_account!\n   end\n \n   def regenerate_feed!\n-    RegenerationWorker.perform_async(account_id) if redis.set(\"account:#{account_id}:regeneration\", true, nx: true, ex: 1.day.seconds)\n+    home_feed = HomeFeed.new(account)\n+    unless home_feed.regenerating?\n+      home_feed.regeneration_in_progress!\n+      RegenerationWorker.perform_async(account_id)\n+    end\n   end\n \n   def needs_feed_update?\n---\napp/services/follow_service.rb\n@@ -46,7 +46,7 @@ def call(source_account, target_account, options = {})\n   private\n \n   def mark_home_feed_as_partial!\n-    redis.set(\"account:#{@source_account.id}:regeneration\", true, nx: true, ex: 1.day.seconds)\n+    HomeFeed.new(@source_account).regeneration_in_progress!\n   end\n \n   def following_not_possible?\n---\napp/services/precompute_feed_service.rb\n@@ -12,7 +12,7 @@ def call(account, skip_filled_timelines: false)\n       FeedManager.instance.populate_list(list) unless skip_timeline?(:list, list.id)\n     end\n   ensure\n-    redis.del(\"account:#{account.id}:regeneration\")\n+    HomeFeed.new(account).regeneration_finished!\n   end\n \n   private\n---\napp/workers/merge_worker.rb\n@@ -31,7 +31,7 @@ def merge_into_home!(into_account_id)\n       FeedManager.instance.merge_into_home(@from_account, @into_account)\n     end\n   ensure\n-    redis.del(\"account:#{into_account_id}:regeneration\")\n+    HomeFeed.new(@into_account).regeneration_finished!\n   end\n \n   def merge_into_list!(into_list_id)\n---\nspec/models/home_feed_spec.rb\n@@ -42,4 +42,42 @@\n       end\n     end\n   end\n+\n+  describe '#regenerating?' do\n+    context 'when feed is being generated' do\n+      before do\n+        redis.set(\"account:#{account.id}:regeneration\", true)\n+      end\n+\n+      it 'returns `true`' do\n+        expect(subject.regenerating?).to be true\n+      end\n+    end\n+\n+    context 'when feed is not being generated' do\n+      it 'returns `false`' do\n+        expect(subject.regenerating?).to be false\n+      end\n+    end\n+  end\n+\n+  describe '#regeneration_in_progress!' do\n+    it 'sets the corresponding key in redis' do\n+      expect(redis.exists?(\"account:#{account.id}:regeneration\")).to be false\n+\n+      subject.regeneration_in_progress!\n+\n+      expect(redis.exists?(\"account:#{account.id}:regeneration\")).to be true\n+    end\n+  end\n+\n+  describe '#regeneration_finished!' do\n+    it 'removes the corresponding key from redis' do\n+      redis.set(\"account:#{account.id}:regeneration\", true)\n+\n+      subject.regeneration_finished!\n+\n+      expect(redis.exists?(\"account:#{account.id}:regeneration\")).to be false\n+    end\n+  end\n end\n---\n\n\n---\n\nChoice D:\napp/controllers/concerns/localized.rb\n@@ -16,7 +16,7 @@ def set_locale(&block)\n   def requested_locale\n     requested_locale_name   = available_locale_or_nil(params[:lang])\n     requested_locale_name ||= available_locale_or_nil(current_user.locale) if respond_to?(:user_signed_in?) && user_signed_in?\n-    requested_locale_name ||= http_accept_language if ENV['DEFAULT_LOCALE'].blank?\n+    requested_locale_name ||= http_accept_language unless ENV['FORCE_DEFAULT_LOCALE'] == 'true'\n     requested_locale_name\n   end\n \n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nI believe this is the reason for one class of flaky tests: the tests start writing in the textarea before the relationship gets loaded, which resets the textarea and discards the text input.\r\n\r\nThe textarea was supposed to be disabled when the relationship isn't loaded yet, but the check was incorrect, comparing the value to `null` whereas it is actually `undefined`.\r\n\r\nInstead of having an uninteractable placeholder that says to click it, opted for a skeleton loader, although this may be a bit too distracting.\r\n\r\nhttps://github.com/user-attachments/assets/832c64a3-0349-4f54-aa44-ce9a8a52e446\n\n---\n\nChoice A:\nyarn.lock\n@@ -12473,10 +12473,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.5\":\n-  version: 2.8.5\n-  resolution: \"pg-connection-string@npm:2.8.5\"\n-  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n+\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.9.0\":\n+  version: 2.9.0\n+  resolution: \"pg-connection-string@npm:2.9.0\"\n+  checksum: 10c0/7145d00688200685a9d9931a7fc8d61c75f348608626aef88080ece956ceb4ff1cbdee29c3284e41b7a3345bab0e4f50f9edc256e270bfa3a563af4ea78bb490\n   languageName: node\n   linkType: hard\n \n@@ -12494,23 +12494,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.9.6\":\n-  version: 3.9.6\n-  resolution: \"pg-pool@npm:3.9.6\"\n+\"pg-pool@npm:^3.10.0\":\n+  version: 3.10.0\n+  resolution: \"pg-pool@npm:3.10.0\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/458d50a4e7260977f076472d40d0796fa8b513af7e3ce1bf65557e10724e9c13653661c883f6650dff92d0a1a5ff4e7a001a8262b786c1ad4cfbd35c3354353e\n+  checksum: 10c0/b36162dc98c0ad88cd26f3d65f3e3932c3f870abe7a88905f16fc98282e8131692903e482720ebc9698cb08851c9b19242ff16a50af7f9434c8bb0b5d33a9a9a\n   languageName: node\n   linkType: hard\n \n-\"pg-protocol@npm:*, pg-protocol@npm:^1.9.5\":\n-  version: 1.9.5\n-  resolution: \"pg-protocol@npm:1.9.5\"\n-  checksum: 10c0/5cb3444cf973adadd22ee9ea26bb1674f0d980ef8f9c66d426bbe67fc9cb5f0ca4a204bf7e432b3ab2ab59ac8227f4b18ab3b2e64eaed537e037e916991c7319\n+\"pg-protocol@npm:*, pg-protocol@npm:^1.10.0\":\n+  version: 1.10.0\n+  resolution: \"pg-protocol@npm:1.10.0\"\n+  checksum: 10c0/7d0d64fe9df50262d907fd476454e1e36f41f5f66044c3ba6aa773fb8add1d350a9c162306e5c33e99bdfbdcc1140dd4ca74f66eda41d0aaceb5853244dcdb65\n   languageName: node\n   linkType: hard\n \n-\"pg-types@npm:^2.1.0\":\n+\"pg-types@npm:2.2.0\":\n   version: 2.2.0\n   resolution: \"pg-types@npm:2.2.0\"\n   dependencies:\n@@ -12539,15 +12539,15 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.15.6\n-  resolution: \"pg@npm:8.15.6\"\n+  version: 8.16.0\n+  resolution: \"pg@npm:8.16.0\"\n   dependencies:\n     pg-cloudflare: \"npm:^1.2.5\"\n-    pg-connection-string: \"npm:^2.8.5\"\n-    pg-pool: \"npm:^3.9.6\"\n-    pg-protocol: \"npm:^1.9.5\"\n-    pg-types: \"npm:^2.1.0\"\n-    pgpass: \"npm:1.x\"\n+    pg-connection-string: \"npm:^2.9.0\"\n+    pg-pool: \"npm:^3.10.0\"\n+    pg-protocol: \"npm:^1.10.0\"\n+    pg-types: \"npm:2.2.0\"\n+    pgpass: \"npm:1.0.5\"\n   peerDependencies:\n     pg-native: \">=3.0.1\"\n   dependenciesMeta:\n@@ -12556,11 +12556,11 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/d4dc81020ebd137b6cf6228e43c643067acb8240079a07f7b9a7e97be0f33ad4d8c6f2a3f5b512ad87180e3d48e651fbd72885aa807ab58a715da8f3efea0fab\n+  checksum: 10c0/24542229c7e5cbf69d654de32e8cdc8302c73f1338e56728543cb16364fb319d5689e03fa704b69a208105c7065c867cfccb9dbccccea2020bb5c64ead785713\n   languageName: node\n   linkType: hard\n \n-\"pgpass@npm:1.x\":\n+\"pgpass@npm:1.0.5\":\n   version: 1.0.5\n   resolution: \"pgpass@npm:1.0.5\"\n   dependencies:\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/account/components/account_note.jsx\n@@ -8,6 +8,8 @@ import ImmutablePureComponent from 'react-immutable-pure-component';\n \n import Textarea from 'react-textarea-autosize';\n \n+import { LoadingIndicator } from '@/mastodon/components/loading_indicator';\n+\n const messages = defineMessages({\n   placeholder: { id: 'account_note.placeholder', defaultMessage: 'Click to add a note' },\n });\n@@ -153,17 +155,23 @@ class AccountNote extends ImmutablePureComponent {\n           <FormattedMessage id='account.account_note_header' defaultMessage='Personal note' /> <InlineAlert show={saved} />\n         </label>\n \n-        <Textarea\n-          id={`account-note-${accountId}`}\n-          className='account__header__account-note__content'\n-          disabled={this.props.value === null || value === null}\n-          placeholder={intl.formatMessage(messages.placeholder)}\n-          value={value || ''}\n-          onChange={this.handleChange}\n-          onKeyDown={this.handleKeyDown}\n-          onBlur={this.handleBlur}\n-          ref={this.setTextareaRef}\n-        />\n+        {this.props.value === undefined ? (\n+          <div className='account__header__account-note__loading-indicator-wrapper'>\n+            <LoadingIndicator />\n+          </div>\n+        ) : (\n+          <Textarea\n+            id={`account-note-${accountId}`}\n+            className='account__header__account-note__content'\n+            disabled={value === null}\n+            placeholder={intl.formatMessage(messages.placeholder)}\n+            value={value || ''}\n+            onChange={this.handleChange}\n+            onKeyDown={this.handleKeyDown}\n+            onBlur={this.handleBlur}\n+            ref={this.setTextareaRef}\n+          />\n+        )}\n       </div>\n     );\n   }\n---\napp/javascript/styles/mastodon/components.scss\n@@ -8194,6 +8194,20 @@ noscript {\n     font-weight: 400;\n     margin-bottom: 10px;\n \n+    &__loading-indicator-wrapper {\n+      position: relative;\n+      height: 37px;\n+\n+      .loading-indicator {\n+        left: 10px;\n+      }\n+\n+      .circular-progress {\n+        width: 14px;\n+        height: 14px;\n+      }\n+    }\n+\n     label {\n       display: block;\n       font-size: 12px;\n---\n\n\n---\n\nChoice C:\napp/lib/activitypub/parser/status_parser.rb\n@@ -95,11 +95,11 @@ def language\n   end\n \n   def favourites_count\n-    @object.dig('likes', 'totalItems') if @object.is_a?(Hash)\n+    @object['likes']['totalItems'] if @object.is_a?(Hash) && @object['likes'].is_a?(Hash)\n   end\n \n   def reblogs_count\n-    @object.dig('shares', 'totalItems') if @object.is_a?(Hash)\n+    @object['shares']['totalItems'] if @object.is_a?(Hash) && @object['shares'].is_a?(Hash)\n   end\n \n   def quote_policy\n---\nspec/lib/activitypub/parser/status_parser_spec.rb\n@@ -49,6 +49,24 @@\n     )\n   end\n \n+  context 'when the likes collection is not inlined' do\n+    let(:object_json) do\n+      {\n+        id: [ActivityPub::TagManager.instance.uri_for(sender), 'post1'].join('/'),\n+        type: 'Note',\n+        to: 'https://www.w3.org/ns/activitystreams#Public',\n+        content: 'bleh',\n+        published: 1.hour.ago.utc.iso8601,\n+        updated: 1.hour.ago.utc.iso8601,\n+        likes: 'https://example.com/collections/likes',\n+      }\n+    end\n+\n+    it 'does not raise an error' do\n+      expect { subject.favourites_count }.to_not raise_error\n+    end\n+  end\n+\n   describe '#quote_policy' do\n     subject do\n       described_class\n---\n\n\n---\n\nChoice D:\napp/javascript/styles/mastodon/admin.scss\n@@ -3,7 +3,7 @@\n @use 'variables' as *;\n \n $no-columns-breakpoint: 890px;\n-$sidebar-width: 300px;\n+$sidebar-width: 360px;\n $content-width: 840px;\n \n .admin-wrapper {\n@@ -180,8 +180,8 @@ $content-width: 840px;\n   .content {\n     padding-top: 55px;\n     padding-bottom: 20px;\n-    padding-inline-start: 25px;\n-    padding-inline-end: 15px;\n+    padding-inline-start: 15px;\n+    padding-inline-end: 5px;\n \n     @media screen and (max-width: $no-columns-breakpoint) {\n       max-width: none;\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34924. This PR does the following:\r\n- Add menu items to pin and unpin accounts in the `Account` component, which is used in a few areas including followers, following, and featured.\r\n- It only shows if you are a follower (or requested to follow).\r\n- Will update the UI after unpinning an account.\r\n\r\nhttps://github.com/user-attachments/assets/6ac995c6-caeb-4550-8f08-497f35ad61d5\r\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n-  version: 2.8.1\n-  resolution: \"pg-connection-string@npm:2.8.1\"\n-  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n+  version: 2.8.5\n+  resolution: \"pg-connection-string@npm:2.8.5\"\n+  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\napp/controllers/api/base_controller.rb\n@@ -72,6 +72,13 @@ def require_user!\n     end\n   end\n \n+  # Redefine `require_functional!` to properly output JSON instead of HTML redirects\n+  def require_functional!\n+    return if current_user.functional?\n+\n+    require_user!\n+  end\n+\n   def render_empty\n     render json: {}, status: 200\n   end\n---\napp/controllers/application_controller.rb\n@@ -72,10 +72,24 @@ def store_referrer\n   def require_functional!\n     return if current_user.functional?\n \n-    if current_user.confirmed?\n-      redirect_to edit_user_registration_path\n-    else\n-      redirect_to auth_setup_path\n+    respond_to do |format|\n+      format.any do\n+        if current_user.confirmed?\n+          redirect_to edit_user_registration_path\n+        else\n+          redirect_to auth_setup_path\n+        end\n+      end\n+\n+      format.json do\n+        if !current_user.confirmed?\n+          render json: { error: 'Your login is missing a confirmed e-mail address' }, status: 403\n+        elsif !current_user.approved?\n+          render json: { error: 'Your login is currently pending approval' }, status: 403\n+        elsif !current_user.functional?\n+          render json: { error: 'Your login is currently disabled' }, status: 403\n+        end\n+      end\n     end\n   end\n \n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/actions/accounts.js\n@@ -2,6 +2,7 @@ import { browserHistory } from 'mastodon/components/router';\n import { debounceWithDispatchAndArguments } from 'mastodon/utils/debounce';\n \n import api, { getLinks } from '../api';\n+import { me } from '../initial_state';\n \n import {\n   followAccountSuccess, unfollowAccountSuccess,\n@@ -12,6 +13,7 @@ import {\n   blockAccountSuccess, unblockAccountSuccess,\n   pinAccountSuccess, unpinAccountSuccess,\n   fetchRelationshipsSuccess,\n+  fetchEndorsedAccounts,\n } from './accounts_typed';\n import { importFetchedAccount, importFetchedAccounts } from './importer';\n \n@@ -634,6 +636,7 @@ export function pinAccount(id) {\n \n     api().post(`/api/v1/accounts/${id}/pin`).then(response => {\n       dispatch(pinAccountSuccess({ relationship: response.data }));\n+      dispatch(fetchEndorsedAccounts({ accountId: me }));\n     }).catch(error => {\n       dispatch(pinAccountFail(error));\n     });\n@@ -646,6 +649,7 @@ export function unpinAccount(id) {\n \n     api().post(`/api/v1/accounts/${id}/unpin`).then(response => {\n       dispatch(unpinAccountSuccess({ relationship: response.data }));\n+      dispatch(fetchEndorsedAccounts({ accountId: me }));\n     }).catch(error => {\n       dispatch(unpinAccountFail(error));\n     });\n---\napp/javascript/mastodon/components/account.tsx\n@@ -12,6 +12,8 @@ import {\n   muteAccount,\n   unmuteAccount,\n   followAccountSuccess,\n+  unpinAccount,\n+  pinAccount,\n } from 'mastodon/actions/accounts';\n import { showAlertForError } from 'mastodon/actions/alerts';\n import { openModal } from 'mastodon/actions/modal';\n@@ -62,14 +64,23 @@ const messages = defineMessages({\n   },\n });\n \n-export const Account: React.FC<{\n+interface AccountProps {\n   size?: number;\n   id: string;\n   hidden?: boolean;\n   minimal?: boolean;\n   defaultAction?: 'block' | 'mute';\n   withBio?: boolean;\n-}> = ({ id, size = 46, hidden, minimal, defaultAction, withBio }) => {\n+}\n+\n+export const Account: React.FC<AccountProps> = ({\n+  id,\n+  size = 46,\n+  hidden,\n+  minimal,\n+  defaultAction,\n+  withBio,\n+}) => {\n   const intl = useIntl();\n   const { signedIn } = useIdentity();\n   const account = useAppSelector((state) => state.accounts.get(id));\n@@ -119,8 +130,6 @@ export const Account: React.FC<{\n         },\n       ];\n     } else if (defaultAction !== 'block') {\n-      arr = [];\n-\n       if (isRemote && accountUrl) {\n         arr.push({\n           text: intl.formatMessage(messages.openOriginalPage),\n@@ -173,6 +182,25 @@ export const Account: React.FC<{\n           text: intl.formatMessage(messages.addToLists),\n           action: handleAddToLists,\n         });\n+\n+        if (id !== me && (relationship?.following || relationship?.requested)) {\n+          const handleEndorseToggle = () => {\n+            if (relationship.endorsed) {\n+              dispatch(unpinAccount(id));\n+            } else {\n+              dispatch(pinAccount(id));\n+            }\n+          };\n+          arr.push({\n+            text: intl.formatMessage(\n+              // Defined in features/account_timeline/components/account_header.tsx\n+              relationship.endorsed\n+                ? { id: 'account.unendorse' }\n+                : { id: 'account.endorse' },\n+            ),\n+            action: handleEndorseToggle,\n+          });\n+        }\n       }\n     }\n \n---\n\n\n---\n\nChoice D:\ndocs/DEVELOPMENT.md\n@@ -7,6 +7,19 @@ what changes are desirable and what general processes to use.\n \n ## Environments\n \n+The following instructions will guide you through the process of setting up a local development instance of Mastodon on your computer.\n+\n+There are instructions for these environments:\n+\n+- [Vagrant](#vagrant)\n+- [macOS](#macos)\n+- [Linux](#linux)\n+- [Docker](#docker)\n+- [Dev Containers](#dev-containers)\n+- [GitHub Codespaces](#github-codespaces)\n+\n+Once completed, continue with the [Next steps](#next-steps) section below.\n+\n ### Vagrant\n \n A **Vagrant** configuration is included for development purposes. To use it,\n@@ -28,11 +41,17 @@ To set up **macOS** for native development, complete the following steps:\n   to install the required project dependencies\n - Use a Ruby version manager to activate the ruby in `.ruby-version` and run\n   `nvm use` to activate the node version from `.nvmrc`\n-- Run the `bin/setup` script, which will install the required ruby gems and node\n+- Start the database services by running `brew services start postgresql` and\n+  `brew services start redis`\n+- Run `RAILS_ENV=development bin/setup`, which will install the required ruby gems and node\n   packages and prepare the database for local development\n - Finally, run the `bin/dev` script which will launch services via `overmind`\n   (if installed) or `foreman`\n \n+### Linux\n+\n+The Mastodon documentation has a [guide on installing Mastodon from source](https://docs.joinmastodon.org/dev/setup/#manual) on Linux.\n+\n ### Docker\n \n For production hosting and deployment with **Docker**, use the `Dockerfile` and\n@@ -66,10 +85,17 @@ development environment configured with the software needed for this project.\n - Wait for an _Open in Browser_ prompt. This will open Mastodon\n - On the _Ports_ tab \"stream\" setting change _Port visibility_ \u2192 _Public_\n \n+## Next steps\n+\n+- Once you have successfully set up a development environment, it will be available on http://localhost:3000\n+- Log in as the default admin user with the username `admin@mastodon.local` and the password `mastodonadmin`.\n+- Check out the [Mastodon docs] for tips on working with emails in development (you'll need this when creating new user accounts) as well as a list of useful commands for testing and updating your dev instance.\n+\n [codespace]: https://codespaces.new/mastodon/mastodon?quickstart=1&devcontainer_path=.devcontainer%2Fcodespaces%2Fdevcontainer.json\n [CONTRIBUTING]: ../CONTRIBUTING.md\n [Dev Container extension]: https://containers.dev/supporting#dev-containers\n [Development Containers]: https://containers.dev/supporting\n [Docker]: https://docs.docker.com\n [GitHub Codespaces]: https://docs.github.com/en/codespaces\n [Homebrew]: https://brew.sh\n+[Mastodon docs]: https://docs.joinmastodon.org/dev/setup/#working-with-emails-in-development\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34913. This forces slides to be 100% width, so they aren't wider than the parent space.\n\n---\n\nChoice A:\napp/javascript/styles/mastodon/components.scss\n@@ -11053,6 +11053,8 @@ noscript {\n   &__slide {\n     flex: 0 0 auto;\n     flex-basis: 100%;\n+    width: 100%;\n+    overflow: hidden;\n   }\n \n   .status {\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/selectors/contexts.ts\n@@ -41,7 +41,7 @@ export const getDescendantsIds = createAppSelector(\n       }\n \n       if (replies) {\n-        replies.reverse().forEach((replyId) => {\n+        replies.toReversed().forEach((replyId) => {\n           if (\n             !visitIds.includes(replyId) &&\n             !descendantsIds.includes(replyId) &&\n---\n\n\n---\n\nChoice C:\nconfig/environments/development.rb\n@@ -37,10 +37,8 @@\n \n   config.action_controller.forgery_protection_origin_check = ENV['DISABLE_FORGERY_REQUEST_PROTECTION'].nil?\n \n-  ActiveSupport::Logger.new($stdout).tap do |logger|\n-    logger.formatter = config.log_formatter\n-    config.logger = ActiveSupport::TaggedLogging.new(logger)\n-  end\n+  # Override default file logging in favor of STDOUT logging in dev environment\n+  config.logger = ActiveSupport::TaggedLogging.logger($stdout, formatter: config.log_formatter)\n \n   # Generate random VAPID keys\n   Webpush.generate_key.tap do |vapid_key|\n---\n\n\n---\n\nChoice D:\napp/helpers/json_ld_helper.rb\n@@ -72,6 +72,18 @@ def non_matching_uri_hosts?(base_url, comparison_url)\n     !haystack.casecmp(needle).zero?\n   end\n \n+  def safe_prefetched_embed(account, object, context)\n+    return unless object.is_a?(Hash)\n+\n+    # NOTE: Replacing the object's context by that of the parent activity is\n+    # not sound, but it's consistent with the rest of the codebase\n+    object = object.merge({ '@context' => context })\n+\n+    return if value_or_id(first_of_value(object['attributedTo'])) != account.uri || non_matching_uri_hosts?(account.uri, object['id'])\n+\n+    object\n+  end\n+\n   def canonicalize(json)\n     graph = RDF::Graph.new << JSON::LD::API.toRdf(json, documentLoader: method(:load_jsonld_context))\n     graph.dump(:normalize)\n---\napp/lib/activitypub/activity/create.rb\n@@ -204,7 +204,9 @@ def attach_quote(status)\n \n     @quote.status = status\n     @quote.save\n-    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, request_id: @options[:request_id])\n+\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, prefetched_quoted_object: embedded_quote, request_id: @options[:request_id])\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n     ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, @quote.id, @quote_uri, { 'request_id' => @options[:request_id] })\n   end\n---\napp/lib/activitypub/parser/status_parser.rb\n@@ -120,6 +120,11 @@ def quote_uri\n     end.first\n   end\n \n+  # The inlined quote; out of the attributes we support, only `https://w3id.org/fep/044f#quote` explicitly supports inlined objects\n+  def quoted_object\n+    as_array(@object['quote']).first\n+  end\n+\n   def quote_approval_uri\n     as_array(@object['quoteAuthorization']).first\n   end\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -273,7 +273,6 @@ def update_emojis!\n   def update_quote!\n     return unless Mastodon::Feature.inbound_quotes_enabled?\n \n-    quote = nil\n     quote_uri = @status_parser.quote_uri\n \n     if quote_uri.present?\n@@ -294,21 +293,23 @@ def update_quote!\n         quote = Quote.create(status: @status, approval_uri: approval_uri)\n         @quote_changed = true\n       end\n-    end\n \n-    if quote.present?\n-      begin\n-        quote.save\n-        ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, request_id: @request_id)\n-      rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n-        ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n-      end\n+      quote.save\n+\n+      fetch_and_verify_quote!(quote, quote_uri)\n     elsif @status.quote.present?\n       @status.quote.destroy!\n       @quote_changed = true\n     end\n   end\n \n+  def fetch_and_verify_quote!(quote, quote_uri)\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @activity_json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, prefetched_quoted_object: embedded_quote, request_id: @request_id)\n+  rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n+    ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n+  end\n+\n   def update_counts!\n     likes = @status_parser.favourites_count\n     shares =  @status_parser.reblogs_count\n---\napp/services/activitypub/verify_quote_service.rb\n@@ -4,15 +4,15 @@ class ActivityPub::VerifyQuoteService < BaseService\n   include JsonLdHelper\n \n   # Optionally fetch quoted post, and verify the quote is authorized\n-  def call(quote, fetchable_quoted_uri: nil, prefetched_body: nil, request_id: nil)\n+  def call(quote, fetchable_quoted_uri: nil, prefetched_quoted_object: nil, prefetched_approval: nil, request_id: nil)\n     @request_id = request_id\n     @quote = quote\n     @fetching_error = nil\n \n-    fetch_quoted_post_if_needed!(fetchable_quoted_uri)\n+    fetch_quoted_post_if_needed!(fetchable_quoted_uri, prefetched_body: prefetched_quoted_object)\n     return if fast_track_approval! || quote.approval_uri.blank?\n \n-    @json = fetch_approval_object(quote.approval_uri, prefetched_body:)\n+    @json = fetch_approval_object(quote.approval_uri, prefetched_body: prefetched_approval)\n     return quote.reject! if @json.nil?\n \n     return if non_matching_uri_hosts?(quote.approval_uri, value_or_id(@json['attributedTo']))\n@@ -68,11 +68,11 @@ def matching_quote_uri?\n     ActivityPub::TagManager.instance.uri_for(@quote.status) == value_or_id(@json['interactingObject'])\n   end\n \n-  def fetch_quoted_post_if_needed!(uri)\n+  def fetch_quoted_post_if_needed!(uri, prefetched_body: nil)\n     return if uri.nil? || @quote.quoted_status.present?\n \n     status = ActivityPub::TagManager.instance.uri_to_resource(uri, Status)\n-    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, request_id: @request_id)\n+    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, prefetched_body:, request_id: @request_id)\n \n     @quote.update(quoted_status: status) if status.present?\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS => e\n---\nspec/services/activitypub/verify_quote_service_spec.rb\n@@ -89,6 +89,37 @@\n       end\n     end\n \n+    context 'with a valid activity for a post that cannot be fetched but is passed as fetched_quoted_object' do\n+      let(:quoted_status) { nil }\n+\n+      let(:approval_interaction_target) { 'https://b.example.com/unknown-quoted' }\n+      let(:prefetched_object) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          type: 'Note',\n+          id: 'https://b.example.com/unknown-quoted',\n+          to: 'https://www.w3.org/ns/activitystreams#Public',\n+          attributedTo: ActivityPub::TagManager.instance.uri_for(quoted_account),\n+          content: 'previously unknown post',\n+        }.with_indifferent_access\n+      end\n+\n+      before do\n+        stub_request(:get, 'https://b.example.com/unknown-quoted')\n+          .to_return(status: 404)\n+      end\n+\n+      it 'updates the status' do\n+        expect { subject.call(quote, fetchable_quoted_uri: 'https://b.example.com/unknown-quoted', prefetched_quoted_object: prefetched_object) }\n+          .to change(quote, :state).to('accepted')\n+\n+        expect(a_request(:get, approval_uri))\n+          .to have_been_made.once\n+\n+        expect(quote.reload.quoted_status.content).to eq 'previously unknown post'\n+      end\n+    end\n+\n     context 'with a valid activity for a post that cannot be fetched but is inlined' do\n       let(:quoted_status) { nil }\n \n@@ -148,7 +179,7 @@\n \n     context 'with a valid activity for already-fetched posts, with a pre-fetched approval' do\n       it 'updates the status without fetching the activity' do\n-        expect { subject.call(quote, prefetched_body: Oj.dump(json)) }\n+        expect { subject.call(quote, prefetched_approval: Oj.dump(json)) }\n           .to change(quote, :state).to('accepted')\n \n         expect(a_request(:get, approval_uri))\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nReplaces https://github.com/mastodon/mastodon/pull/34919\r\n\r\nChanges:\r\n\r\n- A cop name changed, update it in some disables\r\n- Opt out of the new `PredicateMethod` cop ... there were ~25 issues here which were all in my opinion false positives. If they relax this cop in future releases I could see opting back in, since the intent is good.\r\n- Autofix on `EmptyStringInsideInterpolation` cop\r\n- Regen the TODO\r\n\r\nPossible future improvement to the migration warning - include a helper and use `pluralize` there.\n\n---\n\nChoice A:\nconfig/initializers/chewy.rb\n@@ -9,7 +9,11 @@\n prefix          = ENV.fetch('ES_PREFIX') { fallback_prefix }\n ca_file         = ENV.fetch('ES_CA_FILE', nil).presence\n \n-transport_options = { ssl: { ca_file: ca_file } } if ca_file.present?\n+# While Faraday ignore http_proxy env var when Faraday.ignore_env_proxy eqals true, elasticsearch-transport will use proxy. This is a workaround to avoid this.\n+transport_options = {\n+  proxy: {},\n+}\n+transport_options[:ssl] = { ca_file: ca_file } if ca_file.present?\n \n Chewy.settings = {\n   host: \"#{host}:#{port}\",\n---\n\n\n---\n\nChoice B:\napp/models/home_feed.rb\n@@ -9,4 +9,12 @@ def initialize(account)\n   def regenerating?\n     redis.exists?(\"account:#{@account.id}:regeneration\")\n   end\n+\n+  def regeneration_in_progress!\n+    redis.set(\"account:#{@account.id}:regeneration\", true, nx: true, ex: 1.day.seconds)\n+  end\n+\n+  def regeneration_finished!\n+    redis.del(\"account:#{@account.id}:regeneration\")\n+  end\n end\n---\napp/models/user.rb\n@@ -531,7 +531,11 @@ def notify_staff_about_pending_account!\n   end\n \n   def regenerate_feed!\n-    RegenerationWorker.perform_async(account_id) if redis.set(\"account:#{account_id}:regeneration\", true, nx: true, ex: 1.day.seconds)\n+    home_feed = HomeFeed.new(account)\n+    unless home_feed.regenerating?\n+      home_feed.regeneration_in_progress!\n+      RegenerationWorker.perform_async(account_id)\n+    end\n   end\n \n   def needs_feed_update?\n---\napp/services/follow_service.rb\n@@ -46,7 +46,7 @@ def call(source_account, target_account, options = {})\n   private\n \n   def mark_home_feed_as_partial!\n-    redis.set(\"account:#{@source_account.id}:regeneration\", true, nx: true, ex: 1.day.seconds)\n+    HomeFeed.new(@source_account).regeneration_in_progress!\n   end\n \n   def following_not_possible?\n---\napp/services/precompute_feed_service.rb\n@@ -12,7 +12,7 @@ def call(account, skip_filled_timelines: false)\n       FeedManager.instance.populate_list(list) unless skip_timeline?(:list, list.id)\n     end\n   ensure\n-    redis.del(\"account:#{account.id}:regeneration\")\n+    HomeFeed.new(account).regeneration_finished!\n   end\n \n   private\n---\napp/workers/merge_worker.rb\n@@ -31,7 +31,7 @@ def merge_into_home!(into_account_id)\n       FeedManager.instance.merge_into_home(@from_account, @into_account)\n     end\n   ensure\n-    redis.del(\"account:#{into_account_id}:regeneration\")\n+    HomeFeed.new(@into_account).regeneration_finished!\n   end\n \n   def merge_into_list!(into_list_id)\n---\nspec/models/home_feed_spec.rb\n@@ -42,4 +42,42 @@\n       end\n     end\n   end\n+\n+  describe '#regenerating?' do\n+    context 'when feed is being generated' do\n+      before do\n+        redis.set(\"account:#{account.id}:regeneration\", true)\n+      end\n+\n+      it 'returns `true`' do\n+        expect(subject.regenerating?).to be true\n+      end\n+    end\n+\n+    context 'when feed is not being generated' do\n+      it 'returns `false`' do\n+        expect(subject.regenerating?).to be false\n+      end\n+    end\n+  end\n+\n+  describe '#regeneration_in_progress!' do\n+    it 'sets the corresponding key in redis' do\n+      expect(redis.exists?(\"account:#{account.id}:regeneration\")).to be false\n+\n+      subject.regeneration_in_progress!\n+\n+      expect(redis.exists?(\"account:#{account.id}:regeneration\")).to be true\n+    end\n+  end\n+\n+  describe '#regeneration_finished!' do\n+    it 'removes the corresponding key from redis' do\n+      redis.set(\"account:#{account.id}:regeneration\", true)\n+\n+      subject.regeneration_finished!\n+\n+      expect(redis.exists?(\"account:#{account.id}:regeneration\")).to be false\n+    end\n+  end\n end\n---\n\n\n---\n\nChoice C:\nspec/lib/activitypub/activity/remove_spec.rb\n@@ -4,29 +4,60 @@\n \n RSpec.describe ActivityPub::Activity::Remove do\n   let(:sender) { Fabricate(:account, featured_collection_url: 'https://example.com/featured') }\n-  let(:status) { Fabricate(:status, account: sender) }\n-\n-  let(:json) do\n-    {\n-      '@context': 'https://www.w3.org/ns/activitystreams',\n-      id: 'foo',\n-      type: 'Add',\n-      actor: ActivityPub::TagManager.instance.uri_for(sender),\n-      object: ActivityPub::TagManager.instance.uri_for(status),\n-      target: sender.featured_collection_url,\n-    }.with_indifferent_access\n-  end\n \n   describe '#perform' do\n     subject { described_class.new(json, sender) }\n \n-    before do\n-      StatusPin.create!(account: sender, status: status)\n-      subject.perform\n+    context 'when removing a pinned status' do\n+      let(:status) { Fabricate(:status, account: sender) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: ActivityPub::TagManager.instance.uri_for(status),\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        StatusPin.create!(account: sender, status: status)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.pinned?(status) }.to(false)\n+      end\n     end\n \n-    it 'removes a pin' do\n-      expect(sender.pinned?(status)).to be false\n+    context 'when removing a featured tag' do\n+      let(:tag) { Fabricate(:tag) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: {\n+            type: 'Hashtag',\n+            name: \"##{tag.display_name}\",\n+            href: \"https://example.com/tags/#{tag.name}\",\n+          },\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        sender.featured_tags.find_or_create_by!(name: tag.name)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.featured_tags.exists?(tag: tag) }.to(false)\n+      end\n     end\n   end\n end\n---\n\n\n---\n\nChoice D:\n.rubocop/naming.yml\n@@ -1,3 +1,6 @@\n ---\n Naming/BlockForwarding:\n   EnforcedStyle: explicit\n+\n+Naming/PredicateMethod:\n+  Enabled: false\n---\n.rubocop_todo.yml\n@@ -1,6 +1,6 @@\n # This configuration was generated by\n # `rubocop --auto-gen-config --auto-gen-only-exclude --no-offense-counts --no-auto-gen-timestamp`\n-# using RuboCop version 1.75.8.\n+# using RuboCop version 1.76.0.\n # The point is for the user to remove these configuration records\n # one by one as the offenses are removed from the code base.\n # Note that changes in the inspected code, or installation of new\n---\nGemfile.lock\n@@ -751,18 +751,18 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.8)\n+    rubocop (1.76.0)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n       parallel (~> 1.10)\n       parser (>= 3.3.0.2)\n       rainbow (>= 2.2.2, < 4.0)\n       regexp_parser (>= 2.9.3, < 3.0)\n-      rubocop-ast (>= 1.44.0, < 2.0)\n+      rubocop-ast (>= 1.45.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.1)\n+    rubocop-ast (1.45.0)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n---\napp/controllers/auth/registrations_controller.rb\n@@ -138,7 +138,7 @@ def require_rules_acceptance!\n     set_locale { render :rules }\n   end\n \n-  def is_flashing_format? # rubocop:disable Naming/PredicateName\n+  def is_flashing_format? # rubocop:disable Naming/PredicatePrefix\n     if params[:action] == 'create'\n       false # Disable flash messages for sign-up\n     else\n---\napp/models/concerns/attachmentable.rb\n@@ -22,7 +22,7 @@ module Attachmentable\n   ).freeze\n \n   included do\n-    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicateName\n+    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicatePrefix\n       super\n \n       send(:\"before_#{name}_validate\", prepend: true) do\n---\napp/models/user_settings/glue.rb\n@@ -17,7 +17,7 @@ def type_for_attribute(key)\n     self.class.definition_for(key)&.type\n   end\n \n-  def has_attribute?(key) # rubocop:disable Naming/PredicateName\n+  def has_attribute?(key) # rubocop:disable Naming/PredicatePrefix\n     self.class.definition_for?(key)\n   end\n end\n---\nconfig/initializers/1_hosts.rb\n@@ -21,7 +21,7 @@\n \n   config.x.streaming_api_base_url = ENV.fetch('STREAMING_API_BASE_URL') do\n     if Rails.env.production?\n-      \"ws#{https ? 's' : ''}://#{web_host}\"\n+      \"ws#{'s' if https}://#{web_host}\"\n     else\n       \"ws://#{host.split(':').first}:4000\"\n     end\n---\nconfig/initializers/content_security_policy.rb\n@@ -32,7 +32,7 @@\n \n   if Rails.env.development?\n     vite_public_host = ENV.fetch('VITE_DEV_SERVER_PUBLIC', \"localhost:#{ViteRuby.config.port}\")\n-    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{ViteRuby.config.https ? 's' : ''}://#{vite_public_host}\" }\n+    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{'s' if ViteRuby.config.https}://#{vite_public_host}\" }\n \n     p.connect_src :self, :data, :blob, *media_hosts, Rails.configuration.x.streaming_api_base_url, *front_end_build_urls\n     p.script_src  :self, :unsafe_inline, :unsafe_eval, assets_host\n---\nlib/mastodon/migration_warning.rb\n@@ -23,7 +23,7 @@ def migration_duration_warning(explanation = nil)\n \n     def announce_countdown\n       WARNING_SECONDS.downto(1) do |i|\n-        say \"Continuing in #{i} second#{i == 1 ? '' : 's'}...\", true\n+        say \"Continuing in #{i} second#{'s' unless i == 1}...\", true\n         sleep 1\n       end\n     end\n---\nlib/mastodon/version.rb\n@@ -75,7 +75,7 @@ def source_commit\n     end\n \n     def user_agent\n-      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{Rails.configuration.x.use_https ? 's' : ''}://#{Rails.configuration.x.web_domain}/)\"\n+      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{'s' if Rails.configuration.x.use_https}://#{Rails.configuration.x.web_domain}/)\"\n     end\n \n     def version_configuration\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [pino-http](https://redirect.github.com/pinojs/pino-http) | [`10.4.0` -> `10.5.0`](https://renovatebot.com/diffs/npm/pino-http/10.4.0/10.5.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/pino-http/10.5.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/pino-http/10.5.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/pino-http/10.4.0/10.5.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/pino-http/10.4.0/10.5.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>pinojs/pino-http (pino-http)</summary>\n\n### [`v10.5.0`](https://redirect.github.com/pinojs/pino-http/compare/v10.4.0...d8c995e06da5d0bbd9e231dab80c4b02f2f5c3fd)\n\n[Compare Source](https://redirect.github.com/pinojs/pino-http/compare/v10.4.0...d8c995e06da5d0bbd9e231dab80c4b02f2f5c3fd)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC40MC4zIiwidXBkYXRlZEluVmVyIjoiNDAuNDAuMyIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwiamF2YXNjcmlwdCJdfQ==-->\n\n\n---\n\nChoice A:\nconfig/initializers/cookie_rotator.rb\n@@ -0,0 +1,23 @@\n+# frozen_string_literal: true\n+\n+# TODO: remove this file some time after 4.3.0\n+\n+Rails.application.config.after_initialize do\n+  Rails.application.config.action_dispatch.cookies_rotations.tap do |cookies|\n+    authenticated_encrypted_cookie_salt = Rails.application.config.action_dispatch.authenticated_encrypted_cookie_salt\n+    signed_cookie_salt = Rails.application.config.action_dispatch.signed_cookie_salt\n+\n+    secret_key_base = Rails.application.secret_key_base\n+\n+    key_generator = ActiveSupport::KeyGenerator.new(\n+      secret_key_base, iterations: 1000, hash_digest_class: OpenSSL::Digest::SHA1\n+    )\n+    key_len = ActiveSupport::MessageEncryptor.key_len\n+\n+    old_encrypted_secret = key_generator.generate_key(authenticated_encrypted_cookie_salt, key_len)\n+    old_signed_secret = key_generator.generate_key(signed_cookie_salt)\n+\n+    cookies.rotate :encrypted, old_encrypted_secret\n+    cookies.rotate :signed, old_signed_secret\n+  end\n+end\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -66,7 +66,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n+\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n   version: 7.26.10\n   resolution: \"@babel/core@npm:7.26.10\"\n   dependencies:\n@@ -211,10 +211,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.24.0, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5\":\n-  version: 7.26.5\n-  resolution: \"@babel/helper-plugin-utils@npm:7.26.5\"\n-  checksum: 10c0/cdaba71d4b891aa6a8dfbe5bac2f94effb13e5fa4c2c487667fdbaa04eae059b78b28d85a885071f45f7205aeb56d16759e1bed9c118b94b16e4720ef1ab0f65\n+\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5, @babel/helper-plugin-utils@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helper-plugin-utils@npm:7.27.1\"\n+  checksum: 10c0/94cf22c81a0c11a09b197b41ab488d416ff62254ce13c57e62912c85700dc2e99e555225787a4099ff6bae7a1812d622c80fbaeda824b79baa10a6c5ac4cf69b\n   languageName: node\n   linkType: hard\n \n@@ -869,25 +869,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-self@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-self@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea362ff94b535c753f560eb1f5e063dc72bbbca17ed58837a949a7b289d5eacc7b0a28296d1932c94429b168d6040cdee5484a59b9e3c021f169e0ee137e6a27\n+  checksum: 10c0/00a4f917b70a608f9aca2fb39aabe04a60aa33165a7e0105fd44b3a8531630eb85bf5572e9f242f51e6ad2fa38c2e7e780902176c863556c58b5ba6f6e164031\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-source@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-source@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea8e3263c0dc51fbc97c156cc647150a757cc56de10781287353d0ce9b2dcd6b6d93d573c0142d7daf5d6fb554c74fa1971ae60764924ea711161d8458739b63\n+  checksum: 10c0/5e67b56c39c4d03e59e03ba80692b24c5a921472079b63af711b1d250fc37c1733a17069b63537f750f3e937ec44a42b1ee6a46cd23b1a0df5163b17f741f7f2\n   languageName: node\n   linkType: hard\n \n@@ -4135,17 +4135,17 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.2.1\n-  resolution: \"@vitejs/plugin-react@npm:4.2.1\"\n+  version: 4.4.1\n+  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n   dependencies:\n-    \"@babel/core\": \"npm:^7.23.5\"\n-    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.23.3\"\n-    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.23.3\"\n+    \"@babel/core\": \"npm:^7.26.10\"\n+    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n+    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n-    react-refresh: \"npm:^0.14.0\"\n+    react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n-    vite: ^4.2.0 || ^5.0.0\n-  checksum: 10c0/de1eec44d703f32e5b58e776328ca20793657fe991835d15b290230b19a2a08be5d31501d424279ae13ecfed28044c117b69d746891c8d9b92c69e8a8907e989\n+    vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n+  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n   languageName: node\n   linkType: hard\n \n@@ -10069,10 +10069,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-refresh@npm:^0.14.0\":\n-  version: 0.14.0\n-  resolution: \"react-refresh@npm:0.14.0\"\n-  checksum: 10c0/b8ae07ad153357d77830928a7f1fc2df837aabefee907fa273ba04c7643f3b860e986f1d4b7ada9b721c8d79b8c24b5b911a314a1a2398b105f1b13d19ea2b8d\n+\"react-refresh@npm:^0.17.0\":\n+  version: 0.17.0\n+  resolution: \"react-refresh@npm:0.17.0\"\n+  checksum: 10c0/002cba940384c9930008c0bce26cac97a9d5682bc623112c2268ba0c155127d9c178a9a5cc2212d560088d60dfd503edd808669a25f9b377f316a32361d0b23c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -9177,14 +9177,14 @@ __metadata:\n   linkType: hard\n \n \"pino-http@npm:^10.0.0\":\n-  version: 10.4.0\n-  resolution: \"pino-http@npm:10.4.0\"\n+  version: 10.5.0\n+  resolution: \"pino-http@npm:10.5.0\"\n   dependencies:\n     get-caller-file: \"npm:^2.0.5\"\n     pino: \"npm:^9.0.0\"\n     pino-std-serializers: \"npm:^7.0.0\"\n-    process-warning: \"npm:^4.0.0\"\n-  checksum: 10c0/64144e2c94e939070f56ad82dfb012b6a98d21582e0660cf821e7cee64d4e06f7724aa40bc5bf9cd1254d58ab7cbd972dec287b7989eba647d384f6edd8d95fd\n+    process-warning: \"npm:^5.0.0\"\n+  checksum: 10c0/17597d653a4088f7faed4d58500a5ef51d4d05247307696760006313c33c1d23177af98fb902e15b8e2cd92d81306c884673f841ba5b9bf0c064802f3c0bd775\n   languageName: node\n   linkType: hard\n \n@@ -9748,13 +9748,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"process-warning@npm:^4.0.0\":\n-  version: 4.0.0\n-  resolution: \"process-warning@npm:4.0.0\"\n-  checksum: 10c0/5312a72b69d37a1b82ad03f3dfa0090dab3804a8fd995d06c28e3c002852bd82f5584217d9f4a3f197892bb2afc22d57e2c662c7e906b5abb48c0380c7b0880d\n-  languageName: node\n-  linkType: hard\n-\n \"process-warning@npm:^5.0.0\":\n   version: 5.0.0\n   resolution: \"process-warning@npm:5.0.0\"\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/components/avatar_group.tsx\n@@ -7,10 +7,16 @@ import classNames from 'classnames';\n \n export const AvatarGroup: React.FC<{\n   compact?: boolean;\n+  avatarHeight?: number;\n   children: React.ReactNode;\n-}> = ({ children, compact = false }) => (\n+}> = ({ children, compact = false, avatarHeight }) => (\n   <div\n     className={classNames('avatar-group', { 'avatar-group--compact': compact })}\n+    style={\n+      avatarHeight\n+        ? ({ '--avatar-height': `${avatarHeight}px` } as React.CSSProperties)\n+        : undefined\n+    }\n   >\n     {children}\n   </div>\n---\napp/javascript/mastodon/components/more_from_author.jsx\n@@ -1,17 +0,0 @@\n-import PropTypes from 'prop-types';\n-\n-import { FormattedMessage } from 'react-intl';\n-\n-import { IconLogo } from 'mastodon/components/logo';\n-import { AuthorLink } from 'mastodon/features/explore/components/author_link';\n-\n-export const MoreFromAuthor = ({ accountId }) => (\n-  <div className='more-from-author'>\n-    <IconLogo />\n-    <FormattedMessage id='link_preview.more_from_author' defaultMessage='More from {name}' values={{ name: <AuthorLink accountId={accountId} /> }} />\n-  </div>\n-);\n-\n-MoreFromAuthor.propTypes = {\n-  accountId: PropTypes.string.isRequired,\n-};\n---\napp/javascript/mastodon/components/more_from_author.tsx\n@@ -0,0 +1,21 @@\n+import { FormattedMessage } from 'react-intl';\n+\n+import { IconLogo } from 'mastodon/components/logo';\n+import { AuthorLink } from 'mastodon/features/explore/components/author_link';\n+\n+export const MoreFromAuthor: React.FC<{ accountId: string }> = ({\n+  accountId,\n+}) => (\n+  <FormattedMessage\n+    id='link_preview.more_from_author'\n+    defaultMessage='More from {name}'\n+    values={{ name: <AuthorLink accountId={accountId} /> }}\n+  >\n+    {(chunks) => (\n+      <div className='more-from-author'>\n+        <IconLogo />\n+        {chunks}\n+      </div>\n+    )}\n+  </FormattedMessage>\n+);\n---\napp/javascript/mastodon/features/notifications_v2/components/notification_group_with_status.tsx\n@@ -18,12 +18,14 @@ import { useAppSelector, useAppDispatch } from 'mastodon/store';\n import { DisplayedName } from './displayed_name';\n import { EmbeddedStatus } from './embedded_status';\n \n+const AVATAR_SIZE = 28;\n+\n export const AvatarById: React.FC<{ accountId: string }> = ({ accountId }) => {\n   const account = useAppSelector((state) => state.accounts.get(accountId));\n \n   if (!account) return null;\n \n-  return <Avatar withLink account={account} size={28} />;\n+  return <Avatar withLink account={account} size={AVATAR_SIZE} />;\n };\n \n export type LabelRenderer = (\n@@ -108,7 +110,7 @@ export const NotificationGroupWithStatus: React.FC<{\n         <div className='notification-group__main'>\n           <div className='notification-group__main__header'>\n             <div className='notification-group__main__header__wrapper'>\n-              <AvatarGroup>\n+              <AvatarGroup avatarHeight={AVATAR_SIZE}>\n                 {accountIds\n                   .slice(0, NOTIFICATIONS_GROUP_MAX_AVATARS)\n                   .map((id) => (\n@@ -123,7 +125,14 @@ export const NotificationGroupWithStatus: React.FC<{\n \n             <div className='notification-group__main__header__label'>\n               {label}\n-              {timestamp && <RelativeTimestamp timestamp={timestamp} />}\n+              {timestamp && (\n+                <>\n+                  <span className='notification-group__main__header__label-separator'>\n+                    &middot;\n+                  </span>\n+                  <RelativeTimestamp timestamp={timestamp} />\n+                </>\n+              )}\n             </div>\n           </div>\n \n---\napp/javascript/styles/mastodon/components.scss\n@@ -2249,14 +2249,18 @@ a .account__avatar {\n \n .avatar-group {\n   display: flex;\n-  gap: 8px;\n-  flex-wrap: wrap;\n+\n+  --avatar-height: 28px;\n+\n+  &:not(.avatar-group--compact) {\n+    gap: 8px;\n+    flex-wrap: wrap;\n+    height: var(--avatar-height);\n+    overflow-y: clip;\n+  }\n }\n \n .avatar-group--compact {\n-  gap: 0;\n-  flex-wrap: nowrap;\n-\n   & > :not(:first-child) {\n     margin-inline-start: -12px;\n   }\n@@ -10408,7 +10412,8 @@ noscript {\n   padding: 15px;\n   display: flex;\n   align-items: center;\n-  gap: 8px;\n+  flex-wrap: wrap;\n+  gap: 4px 8px;\n \n   .logo {\n     width: 16px;\n@@ -10502,12 +10507,6 @@ noscript {\n     overflow: hidden;\n     container-type: inline-size;\n \n-    @container (width < 350px) {\n-      &__header time {\n-        display: none;\n-      }\n-    }\n-\n     &__header {\n       display: flex;\n       flex-direction: column;\n@@ -10520,7 +10519,8 @@ noscript {\n \n       &__label {\n         display: flex;\n-        gap: 8px;\n+        flex-wrap: wrap;\n+        gap: 2px 8px;\n         font-size: 15px;\n         line-height: 22px;\n         color: $darker-text-color;\n@@ -10538,6 +10538,13 @@ noscript {\n         time {\n           color: $dark-text-color;\n         }\n+\n+        @container (width < 350px) {\n+          time,\n+          &-separator {\n+            display: none;\n+          }\n+        }\n       }\n     }\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rubocop](https://rubocop.org/) ([source](https://redirect.github.com/rubocop/rubocop), [changelog](https://redirect.github.com/rubocop/rubocop/releases/tag/v1.76.0)) | `1.75.8` -> `1.76.0` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rubocop/1.76.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rubocop/1.76.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rubocop/1.75.8/1.76.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rubocop/1.75.8/1.76.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>rubocop/rubocop (rubocop)</summary>\n\n### [`v1.76.0`](https://redirect.github.com/rubocop/rubocop/blob/HEAD/CHANGELOG.md#1760-2025-06-04)\n\n[Compare Source](https://redirect.github.com/rubocop/rubocop/compare/v1.75.8...v1.76.0)\n\n##### New features\n\n-   [#&#8203;12360](https://redirect.github.com/rubocop/rubocop/issues/12360): Add new `Naming/PredicateMethod` cop to check that predicate methods end with `?` and non-predicate methods do not. (\\[[@&#8203;dvandersluis](https://redirect.github.com/dvandersluis)]\\[])\n-   [#&#8203;13121](https://redirect.github.com/rubocop/rubocop/issues/13121): Add new `Style/EmptyStringInsideInterpolation` cop. (\\[[@&#8203;zopolis4](https://redirect.github.com/zopolis4)]\\[])\n-   [#&#8203;14091](https://redirect.github.com/rubocop/rubocop/pull/14091): Add new cop `Style/RedundantArrayFlatten`. (\\[[@&#8203;lovro-bikic](https://redirect.github.com/lovro-bikic)]\\[])\n-   [#&#8203;14184](https://redirect.github.com/rubocop/rubocop/pull/14184): Add new cop `Lint/UselessOr`. (\\[[@&#8203;lovro-bikic](https://redirect.github.com/lovro-bikic)]\\[])\n-   [#&#8203;14221](https://redirect.github.com/rubocop/rubocop/pull/14221): Enhance `Gemspec` department cops to detect offenses if specification variable is `it` or a numbered parameter. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14166](https://redirect.github.com/rubocop/rubocop/pull/14166): Add new cop `Lint/UselessDefaultValueArgument`. (\\[[@&#8203;lovro-bikic](https://redirect.github.com/lovro-bikic)]\\[])\n\n##### Bug fixes\n\n-   [#&#8203;14228](https://redirect.github.com/rubocop/rubocop/issues/14228): Fix a false positive for `Style/RedundantParentheses` when using a one-line `rescue` expression as a method argument. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14224](https://redirect.github.com/rubocop/rubocop/pull/14224): Fix false negatives for `Style/RedundantParentheses` when using one-line pattern matching. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14205](https://redirect.github.com/rubocop/rubocop/issues/14205): False negatives in `Style/SafeNavigation` when a ternary expression is used in a method argument. (\\[[@&#8203;steiley](https://redirect.github.com/steiley)]\\[])\n-   [#&#8203;14226](https://redirect.github.com/rubocop/rubocop/pull/14226): Fix `Lint/LiteralAsCondition` autocorrect when branches of a condition have comments. (\\[[@&#8203;zopolis4](https://redirect.github.com/zopolis4)]\\[])\n\n##### Changes\n\n-   [#&#8203;14066](https://redirect.github.com/rubocop/rubocop/pull/14066): Add `EnforcedStyle: allow_single_line` as the default to `Style/ItBlockParameter`. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;13788](https://redirect.github.com/rubocop/rubocop/pull/13788): Disable `Lint/ShadowingOuterLocalVariable` by default. (\\[[@&#8203;nekketsuuu](https://redirect.github.com/nekketsuuu)]\\[])\n-   [#&#8203;14215](https://redirect.github.com/rubocop/rubocop/pull/14215): Recognize inequation (`!=`) in `Lint/IdentityComparison`. (\\[[@&#8203;lovro-bikic](https://redirect.github.com/lovro-bikic)]\\[])\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC40MC4zIiwidXBkYXRlZEluVmVyIjoiNDAuNDAuMyIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\npackage.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/mastodon\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.1\",\n+  \"packageManager\": \"yarn@4.9.2\",\n   \"engines\": {\n     \"node\": \">=20\"\n   },\n---\nstreaming/package.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/streaming\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.1\",\n+  \"packageManager\": \"yarn@4.9.2\",\n   \"engines\": {\n     \"node\": \">=20\"\n   },\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -751,18 +751,18 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.8)\n+    rubocop (1.76.0)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n       parallel (~> 1.10)\n       parser (>= 3.3.0.2)\n       rainbow (>= 2.2.2, < 4.0)\n       regexp_parser (>= 2.9.3, < 3.0)\n-      rubocop-ast (>= 1.44.0, < 2.0)\n+      rubocop-ast (>= 1.45.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.1)\n+    rubocop-ast (1.45.0)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/account.tsx\n@@ -11,9 +11,12 @@ import {\n   unblockAccount,\n   muteAccount,\n   unmuteAccount,\n+  followAccountSuccess,\n } from 'mastodon/actions/accounts';\n+import { showAlertForError } from 'mastodon/actions/alerts';\n import { openModal } from 'mastodon/actions/modal';\n import { initMuteModal } from 'mastodon/actions/mutes';\n+import { apiFollowAccount } from 'mastodon/api/accounts';\n import { Avatar } from 'mastodon/components/avatar';\n import { Button } from 'mastodon/components/button';\n import { FollowersCounter } from 'mastodon/components/counters';\n@@ -24,6 +27,7 @@ import { RelativeTimestamp } from 'mastodon/components/relative_timestamp';\n import { ShortNumber } from 'mastodon/components/short_number';\n import { Skeleton } from 'mastodon/components/skeleton';\n import { VerifiedBadge } from 'mastodon/components/verified_badge';\n+import { me } from 'mastodon/initial_state';\n import type { MenuItem } from 'mastodon/models/dropdown_menu';\n import { useAppSelector, useAppDispatch } from 'mastodon/store';\n \n@@ -113,14 +117,43 @@ export const Account: React.FC<{\n       ];\n     } else if (defaultAction !== 'block') {\n       const handleAddToLists = () => {\n-        dispatch(\n-          openModal({\n-            modalType: 'LIST_ADDER',\n-            modalProps: {\n-              accountId: id,\n-            },\n-          }),\n-        );\n+        const openAddToListModal = () => {\n+          dispatch(\n+            openModal({\n+              modalType: 'LIST_ADDER',\n+              modalProps: {\n+                accountId: id,\n+              },\n+            }),\n+          );\n+        };\n+        if (relationship?.following || relationship?.requested || id === me) {\n+          openAddToListModal();\n+        } else {\n+          dispatch(\n+            openModal({\n+              modalType: 'CONFIRM_FOLLOW_TO_LIST',\n+              modalProps: {\n+                accountId: id,\n+                onConfirm: () => {\n+                  apiFollowAccount(id)\n+                    .then((relationship) => {\n+                      dispatch(\n+                        followAccountSuccess({\n+                          relationship,\n+                          alreadyFollowing: false,\n+                        }),\n+                      );\n+                      openAddToListModal();\n+                    })\n+                    .catch((err: unknown) => {\n+                      dispatch(showAlertForError(err));\n+                    });\n+                },\n+              },\n+            }),\n+          );\n+        }\n       };\n \n       arr = [\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -66,7 +66,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n+\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n   version: 7.26.10\n   resolution: \"@babel/core@npm:7.26.10\"\n   dependencies:\n@@ -211,10 +211,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.24.0, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5\":\n-  version: 7.26.5\n-  resolution: \"@babel/helper-plugin-utils@npm:7.26.5\"\n-  checksum: 10c0/cdaba71d4b891aa6a8dfbe5bac2f94effb13e5fa4c2c487667fdbaa04eae059b78b28d85a885071f45f7205aeb56d16759e1bed9c118b94b16e4720ef1ab0f65\n+\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5, @babel/helper-plugin-utils@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helper-plugin-utils@npm:7.27.1\"\n+  checksum: 10c0/94cf22c81a0c11a09b197b41ab488d416ff62254ce13c57e62912c85700dc2e99e555225787a4099ff6bae7a1812d622c80fbaeda824b79baa10a6c5ac4cf69b\n   languageName: node\n   linkType: hard\n \n@@ -869,25 +869,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-self@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-self@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea362ff94b535c753f560eb1f5e063dc72bbbca17ed58837a949a7b289d5eacc7b0a28296d1932c94429b168d6040cdee5484a59b9e3c021f169e0ee137e6a27\n+  checksum: 10c0/00a4f917b70a608f9aca2fb39aabe04a60aa33165a7e0105fd44b3a8531630eb85bf5572e9f242f51e6ad2fa38c2e7e780902176c863556c58b5ba6f6e164031\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-source@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-source@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea8e3263c0dc51fbc97c156cc647150a757cc56de10781287353d0ce9b2dcd6b6d93d573c0142d7daf5d6fb554c74fa1971ae60764924ea711161d8458739b63\n+  checksum: 10c0/5e67b56c39c4d03e59e03ba80692b24c5a921472079b63af711b1d250fc37c1733a17069b63537f750f3e937ec44a42b1ee6a46cd23b1a0df5163b17f741f7f2\n   languageName: node\n   linkType: hard\n \n@@ -4135,17 +4135,17 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.2.1\n-  resolution: \"@vitejs/plugin-react@npm:4.2.1\"\n+  version: 4.4.1\n+  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n   dependencies:\n-    \"@babel/core\": \"npm:^7.23.5\"\n-    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.23.3\"\n-    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.23.3\"\n+    \"@babel/core\": \"npm:^7.26.10\"\n+    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n+    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n-    react-refresh: \"npm:^0.14.0\"\n+    react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n-    vite: ^4.2.0 || ^5.0.0\n-  checksum: 10c0/de1eec44d703f32e5b58e776328ca20793657fe991835d15b290230b19a2a08be5d31501d424279ae13ecfed28044c117b69d746891c8d9b92c69e8a8907e989\n+    vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n+  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n   languageName: node\n   linkType: hard\n \n@@ -10069,10 +10069,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-refresh@npm:^0.14.0\":\n-  version: 0.14.0\n-  resolution: \"react-refresh@npm:0.14.0\"\n-  checksum: 10c0/b8ae07ad153357d77830928a7f1fc2df837aabefee907fa273ba04c7643f3b860e986f1d4b7ada9b721c8d79b8c24b5b911a314a1a2398b105f1b13d19ea2b8d\n+\"react-refresh@npm:^0.17.0\":\n+  version: 0.17.0\n+  resolution: \"react-refresh@npm:0.17.0\"\n+  checksum: 10c0/002cba940384c9930008c0bce26cac97a9d5682bc623112c2268ba0c155127d9c178a9a5cc2212d560088d60dfd503edd808669a25f9b377f316a32361d0b23c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [opentelemetry-instrumentation-faraday](https://redirect.github.com/open-telemetry/opentelemetry-ruby-contrib) ([source](https://redirect.github.com/open-telemetry/opentelemetry-ruby-contrib/tree/HEAD/instrumentation/faraday), [changelog](https://rubydoc.info/gems/opentelemetry-instrumentation-faraday/0.27.0/file/CHANGELOG.md)) | `'~> 0.26.0'` -> `'~> 0.27.0'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/opentelemetry-instrumentation-faraday/0.27.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/opentelemetry-instrumentation-faraday/0.27.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/opentelemetry-instrumentation-faraday/0.26.0/0.27.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/opentelemetry-instrumentation-faraday/0.26.0/0.27.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>open-telemetry/opentelemetry-ruby-contrib (opentelemetry-instrumentation-faraday)</summary>\n\n### [`v0.27.0`](https://redirect.github.com/open-telemetry/opentelemetry-ruby-contrib/blob/HEAD/instrumentation/faraday/CHANGELOG.md#v0270--2025-06-03)\n\n-   ADDED: Suppress internal spans with Faraday instrumentation\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC40MC4zIiwidXBkYXRlZEluVmVyIjoiNDAuNDAuMyIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\nGemfile\n@@ -110,7 +110,7 @@ group :opentelemetry do\n   gem 'opentelemetry-instrumentation-active_model_serializers', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-concurrent_ruby', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-excon', '~> 0.23.0', require: false\n-  gem 'opentelemetry-instrumentation-faraday', '~> 0.26.0', require: false\n+  gem 'opentelemetry-instrumentation-faraday', '~> 0.27.0', require: false\n   gem 'opentelemetry-instrumentation-http', '~> 0.24.0', require: false\n   gem 'opentelemetry-instrumentation-http_client', '~> 0.23.0', require: false\n   gem 'opentelemetry-instrumentation-net_http', '~> 0.23.0', require: false\n---\nGemfile.lock\n@@ -544,7 +544,7 @@ GEM\n     opentelemetry-instrumentation-excon (0.23.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-faraday (0.26.0)\n+    opentelemetry-instrumentation-faraday (0.27.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n     opentelemetry-instrumentation-http (0.24.0)\n@@ -1026,7 +1026,7 @@ DEPENDENCIES\n   opentelemetry-instrumentation-active_model_serializers (~> 0.22.0)\n   opentelemetry-instrumentation-concurrent_ruby (~> 0.22.0)\n   opentelemetry-instrumentation-excon (~> 0.23.0)\n-  opentelemetry-instrumentation-faraday (~> 0.26.0)\n+  opentelemetry-instrumentation-faraday (~> 0.27.0)\n   opentelemetry-instrumentation-http (~> 0.24.0)\n   opentelemetry-instrumentation-http_client (~> 0.23.0)\n   opentelemetry-instrumentation-net_http (~> 0.23.0)\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -4201,8 +4201,8 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.5.0\n-  resolution: \"@vitejs/plugin-react@npm:4.5.0\"\n+  version: 4.5.1\n+  resolution: \"@vitejs/plugin-react@npm:4.5.1\"\n   dependencies:\n     \"@babel/core\": \"npm:^7.26.10\"\n     \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n@@ -4212,7 +4212,7 @@ __metadata:\n     react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n     vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n-  checksum: 10c0/c9f75cde098b9aac62cb512103d7f898a0a173cb78dc9fcf79ca4b3f21a1458cd1955a4383c8c9e3841ce23c5e7f02ed1455e445c9574879b143d40734121fd8\n+  checksum: 10c0/51b28c02905228cc5b1dd16f5d008cf08175e47d22ff37b0959a9ee20a46a5215698b20405f39e6b73ae2a63c2a005d74c94b3456083ad038b59932d682b9165\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\n.env.production.sample\n@@ -43,7 +43,6 @@ ES_PASS=password\n # Make sure to use `bundle exec rails secret` to generate secrets\n # -------\n SECRET_KEY_BASE=\n-OTP_SECRET=\n \n # Encryption secrets\n # ------------------\n---\napp.json\n@@ -17,10 +17,6 @@\n       \"description\": \"The secret key base\",\n       \"generator\": \"secret\"\n     },\n-    \"OTP_SECRET\": {\n-      \"description\": \"One-time password secret\",\n-      \"generator\": \"secret\"\n-    },\n     \"SINGLE_USER_MODE\": {\n       \"description\": \"Should the instance run in single user mode? (Disable registrations, redirect to front page)\",\n       \"value\": \"false\",\n---\nlib/tasks/mastodon.rake\n@@ -32,7 +32,7 @@ namespace :mastodon do\n       prompt.say('Single user mode disables registrations and redirects the landing page to your public profile.')\n       env['SINGLE_USER_MODE'] = prompt.yes?('Do you want to enable single user mode?', default: false)\n \n-      %w(SECRET_KEY_BASE OTP_SECRET).each do |key|\n+      %w(SECRET_KEY_BASE).each do |key|\n         env[key] = SecureRandom.hex(64)\n       end\n \n---\nscalingo.json\n@@ -12,10 +12,6 @@\n       \"description\": \"The secret key base\",\n       \"generator\": \"secret\"\n     },\n-    \"OTP_SECRET\": {\n-      \"description\": \"One-time password secret\",\n-      \"generator\": \"secret\"\n-    },\n     \"SINGLE_USER_MODE\": {\n       \"description\": \"Should the instance run in single user mode? (Disable registrations, redirect to front page)\",\n       \"value\": \"false\",\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -7829,14 +7829,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"es-module-lexer@npm:^1.5.3\":\n-  version: 1.6.0\n-  resolution: \"es-module-lexer@npm:1.6.0\"\n-  checksum: 10c0/667309454411c0b95c476025929881e71400d74a746ffa1ff4cb450bd87f8e33e8eef7854d68e401895039ac0bac64e7809acbebb6253e055dd49ea9e3ea9212\n-  languageName: node\n-  linkType: hard\n-\n-\"es-module-lexer@npm:^1.7.0\":\n+\"es-module-lexer@npm:^1.5.3, es-module-lexer@npm:^1.7.0\":\n   version: 1.7.0\n   resolution: \"es-module-lexer@npm:1.7.0\"\n   checksum: 10c0/4c935affcbfeba7fb4533e1da10fa8568043df1e3574b869385980de9e2d475ddc36769891936dbb07036edb3c3786a8b78ccf44964cd130dedc1f2c984b6c7b\n@@ -14945,8 +14938,8 @@ __metadata:\n   linkType: hard\n \n \"sass@npm:^1.62.1\":\n-  version: 1.87.0\n-  resolution: \"sass@npm:1.87.0\"\n+  version: 1.88.0\n+  resolution: \"sass@npm:1.88.0\"\n   dependencies:\n     \"@parcel/watcher\": \"npm:^2.4.1\"\n     chokidar: \"npm:^4.0.0\"\n@@ -14957,7 +14950,7 @@ __metadata:\n       optional: true\n   bin:\n     sass: sass.js\n-  checksum: 10c0/bd245faf14e4783dc547765350cf05817edaac0d6d6f6e4da8ab751f3eb3cc3873afd563c0ce416a24aa6c9c4e9023b05096447fc006660a01f76adffb54fbc6\n+  checksum: 10c0/dcb16dc29116bfa5a90485d24fd8020d2b0d95155bd2e31285901588729343b59fefe44365c5f146b2ba5a9ebadef90b23a7220b902507bdbd91ca2ba0a0b688\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [yarn](https://redirect.github.com/yarnpkg/berry) ([source](https://redirect.github.com/yarnpkg/berry/tree/HEAD/packages/yarnpkg-cli)) | [`4.9.1` -> `4.9.2`](https://renovatebot.com/diffs/npm/yarn/4.9.1/4.9.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/@yarnpkg%2fcli/4.9.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/@yarnpkg%2fcli/4.9.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/@yarnpkg%2fcli/4.9.1/4.9.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/@yarnpkg%2fcli/4.9.1/4.9.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>yarnpkg/berry (yarn)</summary>\n\n### [`v4.9.2`](https://redirect.github.com/yarnpkg/berry/compare/1908ee79fdf80fc8397d8ff928f3bfe25f30e715...a9edb7777f04ba16f51503ef6775325b353b67cc)\n\n[Compare Source](https://redirect.github.com/yarnpkg/berry/compare/1908ee79fdf80fc8397d8ff928f3bfe25f30e715...a9edb7777f04ba16f51503ef6775325b353b67cc)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC40MC4zIiwidXBkYXRlZEluVmVyIjoiNDAuNDAuMyIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwiamF2YXNjcmlwdCJdfQ==-->\n\n\n---\n\nChoice A:\n.ruby-version\n@@ -1 +1 @@\n-3.4.2\n+3.4.3\n---\n\n\n---\n\nChoice B:\npackage.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/mastodon\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.1\",\n+  \"packageManager\": \"yarn@4.9.2\",\n   \"engines\": {\n     \"node\": \">=20\"\n   },\n---\nstreaming/package.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/streaming\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.1\",\n+  \"packageManager\": \"yarn@4.9.2\",\n   \"engines\": {\n     \"node\": \">=20\"\n   },\n---\n\n\n---\n\nChoice C:\nconfig/initializers/devise.rb\n@@ -158,13 +158,15 @@ def session_cookie\n   # given strategies, for example, `config.params_authenticatable = [:database]` will\n   # enable it only for database (email + password) authentication.\n   # config.params_authenticatable = true\n+  config.params_authenticatable = true\n \n   # Tell if authentication through HTTP Auth is enabled. False by default.\n   # It can be set to an array that will enable http authentication only for the\n   # given strategies, for example, `config.http_authenticatable = [:database]` will\n   # enable it only for database authentication. The supported strategies are:\n   # :database      = Support basic authentication with authentication key + password\n-  config.http_authenticatable = [:pam, :database]\n+  # config.http_authenticatable = [:pam, :database]\n+  config.http_authenticatable = false\n \n   # If 401 status code should be returned for AJAX requests. True by default.\n   # config.http_authenticatable_on_xhr = true\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -201,7 +201,7 @@ group :development, :test do\n   gem 'faker', '~> 3.2'\n \n   # Generate factory objects\n-  gem 'fabrication', '~> 2.30'\n+  gem 'fabrication'\n \n   # Profiling tools\n   gem 'memory_profiler', require: false\n---\nGemfile.lock\n@@ -223,7 +223,7 @@ GEM\n       tzinfo\n     excon (1.2.5)\n       logger\n-    fabrication (2.31.0)\n+    fabrication (3.0.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n     faraday (2.13.1)\n@@ -972,7 +972,7 @@ DEPENDENCIES\n   doorkeeper (~> 5.6)\n   dotenv\n   email_spec\n-  fabrication (~> 2.30)\n+  fabrication\n   faker (~> 3.2)\n   faraday-httpclient\n   fast_blank (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34911\r\n\r\n### Changes proposed in this PR:\r\n- Prevents a request for familiar followers in the hover card when not logged in\n\n---\n\nChoice A:\napp/javascript/mastodon/features/account_timeline/hooks/familiar_followers.ts\n@@ -1,6 +1,7 @@\n import { useEffect } from 'react';\n \n import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n+import { useIdentity } from '@/mastodon/identity_context';\n import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n import { me } from 'mastodon/initial_state';\n@@ -14,14 +15,15 @@ export const useFetchFamiliarFollowers = ({\n   const familiarFollowers = useAppSelector((state) =>\n     accountId ? getAccountFamiliarFollowers(state, accountId) : null,\n   );\n+  const { signedIn } = useIdentity();\n \n   const hasNoData = familiarFollowers === null;\n \n   useEffect(() => {\n-    if (hasNoData && accountId && accountId !== me) {\n+    if (hasNoData && signedIn && accountId && accountId !== me) {\n       void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n     }\n-  }, [dispatch, accountId, hasNoData]);\n+  }, [dispatch, accountId, hasNoData, signedIn]);\n \n   return {\n     familiarFollowers: hasNoData ? [] : familiarFollowers,\n---\n\n\n---\n\nChoice B:\ndocs/DEVELOPMENT.md\n@@ -7,6 +7,19 @@ what changes are desirable and what general processes to use.\n \n ## Environments\n \n+The following instructions will guide you through the process of setting up a local development instance of Mastodon on your computer.\n+\n+There are instructions for these environments:\n+\n+- [Vagrant](#vagrant)\n+- [macOS](#macos)\n+- [Linux](#linux)\n+- [Docker](#docker)\n+- [Dev Containers](#dev-containers)\n+- [GitHub Codespaces](#github-codespaces)\n+\n+Once completed, continue with the [Next steps](#next-steps) section below.\n+\n ### Vagrant\n \n A **Vagrant** configuration is included for development purposes. To use it,\n@@ -28,11 +41,17 @@ To set up **macOS** for native development, complete the following steps:\n   to install the required project dependencies\n - Use a Ruby version manager to activate the ruby in `.ruby-version` and run\n   `nvm use` to activate the node version from `.nvmrc`\n-- Run the `bin/setup` script, which will install the required ruby gems and node\n+- Start the database services by running `brew services start postgresql` and\n+  `brew services start redis`\n+- Run `RAILS_ENV=development bin/setup`, which will install the required ruby gems and node\n   packages and prepare the database for local development\n - Finally, run the `bin/dev` script which will launch services via `overmind`\n   (if installed) or `foreman`\n \n+### Linux\n+\n+The Mastodon documentation has a [guide on installing Mastodon from source](https://docs.joinmastodon.org/dev/setup/#manual) on Linux.\n+\n ### Docker\n \n For production hosting and deployment with **Docker**, use the `Dockerfile` and\n@@ -66,10 +85,17 @@ development environment configured with the software needed for this project.\n - Wait for an _Open in Browser_ prompt. This will open Mastodon\n - On the _Ports_ tab \"stream\" setting change _Port visibility_ \u2192 _Public_\n \n+## Next steps\n+\n+- Once you have successfully set up a development environment, it will be available on http://localhost:3000\n+- Log in as the default admin user with the username `admin@mastodon.local` and the password `mastodonadmin`.\n+- Check out the [Mastodon docs] for tips on working with emails in development (you'll need this when creating new user accounts) as well as a list of useful commands for testing and updating your dev instance.\n+\n [codespace]: https://codespaces.new/mastodon/mastodon?quickstart=1&devcontainer_path=.devcontainer%2Fcodespaces%2Fdevcontainer.json\n [CONTRIBUTING]: ../CONTRIBUTING.md\n [Dev Container extension]: https://containers.dev/supporting#dev-containers\n [Development Containers]: https://containers.dev/supporting\n [Docker]: https://docs.docker.com\n [GitHub Codespaces]: https://docs.github.com/en/codespaces\n [Homebrew]: https://brew.sh\n+[Mastodon docs]: https://docs.joinmastodon.org/dev/setup/#working-with-emails-in-development\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -10092,8 +10092,8 @@ __metadata:\n   linkType: hard\n \n \"ioredis@npm:^5.3.2\":\n-  version: 5.6.0\n-  resolution: \"ioredis@npm:5.6.0\"\n+  version: 5.6.1\n+  resolution: \"ioredis@npm:5.6.1\"\n   dependencies:\n     \"@ioredis/commands\": \"npm:^1.1.1\"\n     cluster-key-slot: \"npm:^1.1.0\"\n@@ -10104,7 +10104,7 @@ __metadata:\n     redis-errors: \"npm:^1.2.0\"\n     redis-parser: \"npm:^3.0.0\"\n     standard-as-callback: \"npm:^2.1.0\"\n-  checksum: 10c0/a885e5146640fc448706871290ef424ffa39af561f7ee3cf1590085209a509f85e99082bdaaf3cd32fa66758aea3fc2055d1109648ddca96fac4944bf2092c30\n+  checksum: 10c0/26ae49cf448e807e454a9bdea5a9dfdcf669e2fdbf2df341900a0fb693c5662fea7e39db3227ce8972d1bda0ba7da9b7410e5163b12d8878a579548d847220ac\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/components/load_more.tsx\n@@ -1,24 +1,32 @@\n import { FormattedMessage } from 'react-intl';\n \n+import { LoadingIndicator } from './loading_indicator';\n+\n interface Props {\n   onClick: (event: React.MouseEvent) => void;\n   disabled?: boolean;\n   visible?: boolean;\n+  loading?: boolean;\n }\n export const LoadMore: React.FC<Props> = ({\n   onClick,\n   disabled,\n   visible = true,\n+  loading = false,\n }) => {\n   return (\n     <button\n       type='button'\n       className='load-more'\n-      disabled={disabled || !visible}\n+      disabled={disabled || loading || !visible}\n       style={{ visibility: visible ? 'visible' : 'hidden' }}\n       onClick={onClick}\n     >\n-      <FormattedMessage id='status.load_more' defaultMessage='Load more' />\n+      {loading ? (\n+        <LoadingIndicator />\n+      ) : (\n+        <FormattedMessage id='status.load_more' defaultMessage='Load more' />\n+      )}\n     </button>\n   );\n };\n---\napp/javascript/mastodon/features/directory/index.tsx\n@@ -130,6 +130,7 @@ export const Directory: React.FC<{\n   }, [dispatch, order, local]);\n \n   const pinned = !!columnId;\n+  const initialLoad = isLoading && accountIds.size === 0;\n \n   const scrollableArea = (\n     <div className='scrollable'>\n@@ -170,7 +171,7 @@ export const Directory: React.FC<{\n       </div>\n \n       <div className='directory__list'>\n-        {isLoading ? (\n+        {initialLoad ? (\n           <LoadingIndicator />\n         ) : (\n           accountIds.map((accountId) => (\n@@ -179,7 +180,11 @@ export const Directory: React.FC<{\n         )}\n       </div>\n \n-      <LoadMore onClick={handleLoadMore} visible={!isLoading} />\n+      <LoadMore\n+        onClick={handleLoadMore}\n+        visible={!initialLoad}\n+        loading={isLoading}\n+      />\n     </div>\n   );\n \n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis reverts commit 9de3fd60a012c69070a3371efec9c9fd54d9071a.\n\n---\n\nChoice A:\napp/javascript/entrypoints/sign_up.ts\n@@ -4,9 +4,12 @@ import axios from 'axios';\n import ready from '../mastodon/ready';\n \n async function checkConfirmation() {\n-  const response = await axios.get('/api/v1/emails/check_confirmation');\n+  const response = await axios.get('/api/v1/emails/check_confirmation', {\n+    headers: { Accept: 'application/json' },\n+    withCredentials: true,\n+  });\n \n-  if (response.data) {\n+  if (response.status === 200 && response.data === true) {\n     window.location.href = '/start';\n   }\n }\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/locales/en-GB.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Moderated servers\",\n   \"about.contact\": \"Contact:\",\n+  \"about.default_locale\": \"Default\",\n   \"about.disclaimer\": \"Mastodon is free, open-source software, and a trademark of Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Reason not available\",\n   \"about.domain_blocks.preamble\": \"Mastodon generally allows you to view content from and interact with users from any other server in the Fediverse. These are the exceptions that have been made on this particular server.\",\n   \"about.domain_blocks.silenced.explanation\": \"You will generally not see profiles and content from this server, unless you explicitly look it up or opt into it by following.\",\n   \"about.domain_blocks.silenced.title\": \"Limited\",\n   \"about.domain_blocks.suspended.explanation\": \"No data from this server will be processed, stored or exchanged, making any interaction or communication with users from this server impossible.\",\n   \"about.domain_blocks.suspended.title\": \"Suspended\",\n+  \"about.language_label\": \"Language\",\n   \"about.not_available\": \"This information has not been made available on this server.\",\n   \"about.powered_by\": \"Decentralised social media powered by {mastodon}\",\n   \"about.rules\": \"Server rules\",\n@@ -19,10 +21,12 @@\n   \"account.block_domain\": \"Block domain {domain}\",\n   \"account.block_short\": \"Block\",\n   \"account.blocked\": \"Blocked\",\n+  \"account.blocking\": \"Blocking\",\n   \"account.cancel_follow_request\": \"Cancel follow\",\n   \"account.copy\": \"Copy link to profile\",\n   \"account.direct\": \"Privately mention @{name}\",\n   \"account.disable_notifications\": \"Stop notifying me when @{name} posts\",\n+  \"account.domain_blocking\": \"Blocking domain\",\n   \"account.edit_profile\": \"Edit profile\",\n   \"account.enable_notifications\": \"Notify me when @{name} posts\",\n   \"account.endorse\": \"Feature on profile\",\n---\napp/javascript/mastodon/locales/pt-PT.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Servidores moderados\",\n   \"about.contact\": \"Contacto:\",\n+  \"about.default_locale\": \"Padr\u00e3o\",\n   \"about.disclaimer\": \"O Mastodon \u00e9 um software livre, de c\u00f3digo aberto e uma marca registada de Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Motivo n\u00e3o dispon\u00edvel\",\n   \"about.domain_blocks.preamble\": \"O Mastodon geralmente permite ver e interagir com o conte\u00fado de utilizadores de qualquer outra inst\u00e2ncia no fediverso. Estas s\u00e3o as exce\u00e7\u00f5es desta inst\u00e2ncia em espec\u00edfico.\",\n   \"about.domain_blocks.silenced.explanation\": \"Normalmente n\u00e3o ver\u00e1s perfis e conte\u00fados deste servidor, a n\u00e3o ser que os procures explicitamente ou optes por segui-los.\",\n   \"about.domain_blocks.silenced.title\": \"Limitados\",\n   \"about.domain_blocks.suspended.explanation\": \"Nenhum dado deste servidor ser\u00e1 processado, armazenado ou trocado, tornando imposs\u00edvel qualquer intera\u00e7\u00e3o ou comunica\u00e7\u00e3o com os utilizadores a partir deste servidor.\",\n   \"about.domain_blocks.suspended.title\": \"Suspensos\",\n+  \"about.language_label\": \"Idioma\",\n   \"about.not_available\": \"Esta informa\u00e7\u00e3o n\u00e3o foi disponibilizada neste servidor.\",\n   \"about.powered_by\": \"Rede social descentralizada baseada no {mastodon}\",\n   \"about.rules\": \"Regras do servidor\",\n@@ -308,6 +310,8 @@\n   \"emoji_button.search_results\": \"Resultados da pesquisa\",\n   \"emoji_button.symbols\": \"S\u00edmbolos\",\n   \"emoji_button.travel\": \"Viagens e lugares\",\n+  \"empty_column.account_featured.me\": \"Ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n+  \"empty_column.account_featured.other\": \"{acct} ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n   \"empty_column.account_featured_other.unknown\": \"Esta conta ainda n\u00e3o colocou nada em destaque.\",\n   \"empty_column.account_hides_collections\": \"Este utilizador escolheu n\u00e3o disponibilizar esta informa\u00e7\u00e3o\",\n   \"empty_column.account_suspended\": \"Conta suspensa\",\n@@ -341,6 +345,11 @@\n   \"explore.trending_links\": \"Not\u00edcias\",\n   \"explore.trending_statuses\": \"Publica\u00e7\u00f5es\",\n   \"explore.trending_tags\": \"#Etiquetas\",\n+  \"featured_carousel.header\": \"{count, plural, one {Publica\u00e7\u00e3o Afixada} other {Publica\u00e7\u00f5es Afixadas}}\",\n+  \"featured_carousel.next\": \"Seguinte\",\n+  \"featured_carousel.post\": \"Publica\u00e7\u00e3o\",\n+  \"featured_carousel.previous\": \"Anterior\",\n+  \"featured_carousel.slide\": \"{index} de {total}\",\n   \"filter_modal.added.context_mismatch_explanation\": \"Esta categoria de filtro n\u00e3o se aplica ao contexto em que acedeste a esta publica\u00e7\u00e3o. Se pretenderes que esta publica\u00e7\u00e3o seja filtrada tamb\u00e9m neste contexto, ter\u00e1s que editar o filtro.\",\n   \"filter_modal.added.context_mismatch_title\": \"O contexto n\u00e3o coincide!\",\n   \"filter_modal.added.expired_explanation\": \"Esta categoria de filtro expirou, tens de alterar a data de validade para que ele seja aplicado.\",\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -1,18 +1,24 @@\n import { FormattedMessage } from 'react-intl';\n \n import classNames from 'classnames';\n+import { Link } from 'react-router-dom';\n \n import type { Map as ImmutableMap } from 'immutable';\n \n+import ArticleIcon from '@/material-icons/400-24px/article.svg?react';\n+import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react';\n import { Icon } from 'mastodon/components/icon';\n import StatusContainer from 'mastodon/containers/status_container';\n+import type { Status } from 'mastodon/models/status';\n import { useAppSelector } from 'mastodon/store';\n \n import QuoteIcon from '../../images/quote.svg?react';\n \n+const MAX_QUOTE_POSTS_NESTING_LEVEL = 1;\n+\n const QuoteWrapper: React.FC<{\n   isError?: boolean;\n-  children: React.ReactNode;\n+  children: React.ReactElement;\n }> = ({ isError, children }) => {\n   return (\n     <div\n@@ -26,16 +32,52 @@ const QuoteWrapper: React.FC<{\n   );\n };\n \n+const QuoteLink: React.FC<{\n+  status: Status;\n+}> = ({ status }) => {\n+  const accountId = status.get('account') as string;\n+  const account = useAppSelector((state) =>\n+    accountId ? state.accounts.get(accountId) : undefined,\n+  );\n+\n+  const quoteAuthorName = account?.display_name_html;\n+\n+  if (!quoteAuthorName) {\n+    return null;\n+  }\n+\n+  const quoteAuthorElement = (\n+    <span dangerouslySetInnerHTML={{ __html: quoteAuthorName }} />\n+  );\n+  const quoteUrl = `/@${account.get('acct')}/${status.get('id') as string}`;\n+\n+  return (\n+    <Link to={quoteUrl} className='status__quote-author-button'>\n+      <FormattedMessage\n+        id='status.quote_post_author'\n+        defaultMessage='Post by {name}'\n+        values={{ name: quoteAuthorElement }}\n+      />\n+      <Icon id='chevron_right' icon={ChevronRightIcon} />\n+      <Icon id='article' icon={ArticleIcon} />\n+    </Link>\n+  );\n+};\n+\n type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n \n-export const QuotedStatus: React.FC<{ quote: QuoteMap }> = ({ quote }) => {\n+export const QuotedStatus: React.FC<{\n+  quote: QuoteMap;\n+  variant?: 'full' | 'link';\n+  nestingLevel?: number;\n+}> = ({ quote, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n   const state = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n \n-  let quoteError: React.ReactNode | null = null;\n+  let quoteError: React.ReactNode = null;\n \n   if (state === 'deleted') {\n     quoteError = (\n@@ -78,14 +120,28 @@ export const QuotedStatus: React.FC<{ quote: QuoteMap }> = ({ quote }) => {\n     return <QuoteWrapper isError>{quoteError}</QuoteWrapper>;\n   }\n \n+  if (variant === 'link' && status) {\n+    return <QuoteLink status={status} />;\n+  }\n+\n+  const childQuote = status?.get('quote') as QuoteMap | undefined;\n+  const canRenderChildQuote =\n+    childQuote && nestingLevel <= MAX_QUOTE_POSTS_NESTING_LEVEL;\n+\n   return (\n     <QuoteWrapper>\n-      <StatusContainer\n-        // @ts-expect-error Status isn't typed yet\n-        isQuotedPost\n-        id={quotedStatusId}\n-        avatarSize={40}\n-      />\n+      {/* @ts-expect-error Status is not yet typed */}\n+      <StatusContainer isQuotedPost id={quotedStatusId} avatarSize={40}>\n+        {canRenderChildQuote && (\n+          <QuotedStatus\n+            quote={childQuote}\n+            variant={\n+              nestingLevel === MAX_QUOTE_POSTS_NESTING_LEVEL ? 'link' : 'full'\n+            }\n+            nestingLevel={nestingLevel + 1}\n+          />\n+        )}\n+      </StatusContainer>\n     </QuoteWrapper>\n   );\n };\n---\napp/javascript/mastodon/locales/en.json\n@@ -868,6 +868,7 @@\n   \"status.quote_error.rejected\": \"This post cannot be displayed as the original author does not allow it to be quoted.\",\n   \"status.quote_error.removed\": \"This post was removed by its author.\",\n   \"status.quote_error.unauthorized\": \"This post cannot be displayed as you are not authorized to view it.\",\n+  \"status.quote_post_author\": \"Post by {name}\",\n   \"status.read_more\": \"Read more\",\n   \"status.reblog\": \"Boost\",\n   \"status.reblog_private\": \"Boost with original visibility\",\n---\napp/javascript/material-icons/400-24px/article-fill.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm80-160h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/article.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M280-280h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Zm-80 480q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/README.md\n@@ -1 +1,12 @@\n-Files in this directory are Material Symbols icons fetched using the `icons:download` task.\n+Files in this directory are Material Symbols icons fetched using the `icons:download` rake task (see `/lib/tasks/icons.rake`).\n+\n+To add another icon, follow these steps:\n+\n+- Determine the name of the Material Symbols icon you want to download.\n+  You can find a searchable overview of all icons on [https://fonts.google.com/icons].\n+  Click on the icon you want to use and find the icon name towards the bottom of the slide-out panel (it'll be something like `icon_name`)\n+- Import the icon in your React component using the following format:\n+  `import IconName from '@/material-icons/400-24px/icon_name.svg?react';`\n+- Run `RAILS_ENV=development rails icons:download` to download any newly imported icons.\n+\n+The import should now work and the icon should appear when passed to the `<Icon icon={IconName} /> component\n---\napp/javascript/styles/mastodon/components.scss\n@@ -1880,11 +1880,15 @@ body > [data-popper-placement] {\n .status__quote {\n   position: relative;\n   margin-block-start: 16px;\n-  margin-inline-start: 56px;\n+  margin-inline-start: 36px;\n   border-radius: 8px;\n   color: var(--nested-card-text);\n   background: var(--nested-card-background);\n   border: var(--nested-card-border);\n+\n+  @media screen and (min-width: $mobile-breakpoint) {\n+    margin-inline-start: 56px;\n+  }\n }\n \n .status__quote--error {\n@@ -1895,10 +1899,42 @@ body > [data-popper-placement] {\n   font-size: 15px;\n }\n \n+.status__quote-author-button {\n+  position: relative;\n+  overflow: hidden;\n+  display: inline-flex;\n+  width: auto;\n+  margin-block-start: 10px;\n+  padding: 5px 12px;\n+  align-items: center;\n+  gap: 6px;\n+  font-family: inherit;\n+  font-size: 14px;\n+  font-weight: 700;\n+  line-height: normal;\n+  letter-spacing: 0;\n+  text-decoration: none;\n+  color: $highlight-text-color;\n+  background: var(--nested-card-background);\n+  border: var(--nested-card-border);\n+  border-radius: 4px;\n+\n+  &:active,\n+  &:focus,\n+  &:hover {\n+    border-color: lighten($highlight-text-color, 4%);\n+    color: lighten($highlight-text-color, 4%);\n+  }\n+\n+  &:focus-visible {\n+    outline: $ui-button-icon-focus-outline;\n+  }\n+}\n+\n .status__quote-icon {\n   position: absolute;\n   inset-block-start: 18px;\n-  inset-inline-start: -50px;\n+  inset-inline-start: -40px;\n   display: block;\n   width: 26px;\n   height: 26px;\n@@ -1910,6 +1946,10 @@ body > [data-popper-placement] {\n     inset-block-start: 50%;\n     transform: translateY(-50%);\n   }\n+\n+  @media screen and (min-width: $mobile-breakpoint) {\n+    inset-inline-start: -50px;\n+  }\n }\n \n .detailed-status__link {\n---\n\n\n---\n\nChoice D:\napp/helpers/formatting_helper.rb\n@@ -27,14 +27,7 @@ def extract_status_plain_text(status)\n   module_function :extract_status_plain_text\n \n   def status_content_format(status)\n-    MastodonOTELTracer.in_span('HtmlAwareFormatter rendering') do |span|\n-      span.add_attributes(\n-        'app.formatter.content.type' => 'status',\n-        'app.formatter.content.origin' => status.local? ? 'local' : 'remote'\n-      )\n-\n-      html_aware_format(status.text, status.local?, preloaded_accounts: [status.account] + (status.respond_to?(:active_mentions) ? status.active_mentions.map(&:account) : []))\n-    end\n+    html_aware_format(status.text, status.local?, preloaded_accounts: [status.account] + (status.respond_to?(:active_mentions) ? status.active_mentions.map(&:account) : []))\n   end\n \n   def rss_status_content_format(status)\n@@ -46,14 +39,7 @@ def rss_status_content_format(status)\n   end\n \n   def account_bio_format(account)\n-    MastodonOTELTracer.in_span('HtmlAwareFormatter rendering') do |span|\n-      span.add_attributes(\n-        'app.formatter.content.type' => 'account_bio',\n-        'app.formatter.content.origin' => account.local? ? 'local' : 'remote'\n-      )\n-\n-      html_aware_format(account.note, account.local?)\n-    end\n+    html_aware_format(account.note, account.local?)\n   end\n \n   def account_field_value_format(field, with_rel_me: true)\n---\napp/lib/text_formatter.rb\n@@ -33,24 +33,17 @@ def entities\n   def to_s\n     return ''.html_safe if text.blank?\n \n-    html = nil\n-    MastodonOTELTracer.in_span('TextFormatter#to_s extract_and_rewrite') do\n-      html = rewrite do |entity|\n-        if entity[:url]\n-          link_to_url(entity)\n-        elsif entity[:hashtag]\n-          link_to_hashtag(entity)\n-        elsif entity[:screen_name]\n-          link_to_mention(entity)\n-        end\n+    html = rewrite do |entity|\n+      if entity[:url]\n+        link_to_url(entity)\n+      elsif entity[:hashtag]\n+        link_to_hashtag(entity)\n+      elsif entity[:screen_name]\n+        link_to_mention(entity)\n       end\n     end\n \n-    if multiline?\n-      MastodonOTELTracer.in_span('TextFormatter#to_s simple_format') do\n-        html = simple_format(html, {}, sanitize: false).delete(\"\\n\")\n-      end\n-    end\n+    html = simple_format(html, {}, sanitize: false).delete(\"\\n\") if multiline?\n \n     html.html_safe # rubocop:disable Rails/OutputSafety\n   end\n@@ -106,54 +99,48 @@ def rewrite\n   end\n \n   def link_to_url(entity)\n-    MastodonOTELTracer.in_span('TextFormatter#link_to_url') do\n-      TextFormatter.shortened_link(entity[:url], rel_me: with_rel_me?)\n-    end\n+    TextFormatter.shortened_link(entity[:url], rel_me: with_rel_me?)\n   end\n \n   def link_to_hashtag(entity)\n-    MastodonOTELTracer.in_span('TextFormatter#link_to_hashtag') do\n-      hashtag = entity[:hashtag]\n-      url     = tag_url(hashtag)\n+    hashtag = entity[:hashtag]\n+    url     = tag_url(hashtag)\n \n-      <<~HTML.squish\n-        <a href=\"#{h(url)}\" class=\"mention hashtag\" rel=\"tag\">#<span>#{h(hashtag)}</span></a>\n-      HTML\n-    end\n+    <<~HTML.squish\n+      <a href=\"#{h(url)}\" class=\"mention hashtag\" rel=\"tag\">#<span>#{h(hashtag)}</span></a>\n+    HTML\n   end\n \n   def link_to_mention(entity)\n-    MastodonOTELTracer.in_span('TextFormatter#link_to_mention') do\n-      username, domain = entity[:screen_name].split('@')\n-      domain           = nil if local_domain?(domain)\n-      account          = nil\n-\n-      if preloaded_accounts?\n-        same_username_hits = 0\n-\n-        preloaded_accounts.each do |other_account|\n-          same_username = other_account.username.casecmp(username).zero?\n-          same_domain   = other_account.domain.nil? ? domain.nil? : other_account.domain.casecmp(domain)&.zero?\n-\n-          if same_username && !same_domain\n-            same_username_hits += 1\n-          elsif same_username && same_domain\n-            account = other_account\n-          end\n+    username, domain = entity[:screen_name].split('@')\n+    domain           = nil if local_domain?(domain)\n+    account          = nil\n+\n+    if preloaded_accounts?\n+      same_username_hits = 0\n+\n+      preloaded_accounts.each do |other_account|\n+        same_username = other_account.username.casecmp(username).zero?\n+        same_domain   = other_account.domain.nil? ? domain.nil? : other_account.domain.casecmp(domain)&.zero?\n+\n+        if same_username && !same_domain\n+          same_username_hits += 1\n+        elsif same_username && same_domain\n+          account = other_account\n         end\n-      else\n-        account = entity_cache.mention(username, domain)\n       end\n+    else\n+      account = entity_cache.mention(username, domain)\n+    end\n \n-      return \"@#{h(entity[:screen_name])}\" if account.nil?\n+    return \"@#{h(entity[:screen_name])}\" if account.nil?\n \n-      url = ActivityPub::TagManager.instance.url_for(account)\n-      display_username = same_username_hits&.positive? || with_domains? ? account.pretty_acct : account.username\n+    url = ActivityPub::TagManager.instance.url_for(account)\n+    display_username = same_username_hits&.positive? || with_domains? ? account.pretty_acct : account.username\n \n-      <<~HTML.squish\n-        <span class=\"h-card\" translate=\"no\"><a href=\"#{h(url)}\" class=\"u-url mention\">@<span>#{h(display_username)}</span></a></span>\n-      HTML\n-    end\n+    <<~HTML.squish\n+      <span class=\"h-card\" translate=\"no\"><a href=\"#{h(url)}\" class=\"u-url mention\">@<span>#{h(display_username)}</span></a></span>\n+    HTML\n   end\n \n   def entity_cache\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nAs part of https://github.com/mastodon/mastodon/pull/34867 I've had several hundred full E2E suite runs without failures. This is the one spec that did have a failure, and my guess is that the example filled in the field and sent `ctrl+enter` before the JS was ready to process that. So, this adds an assertion that some JS-rendered DOM portion is actually there, in hope to make it less likely for that to happen.\r\n\r\nAlso extracted local var to a `let`.\r\n\r\nThe playwright branch seems promising - going to continue doing partial suite runs there to see what other E2E stuff I can get to fail. Regular runs seem sufficiently more reliable there that I think finding failures might indicate actually async/load issues, rather than flaky runner/manager stuff.\n\n---\n\nChoice A:\nGemfile.lock\n@@ -397,7 +397,7 @@ GEM\n       rexml\n     link_header (0.0.8)\n     lint_roller (1.1.0)\n-    linzer (0.7.2)\n+    linzer (0.7.3)\n       cgi (~> 0.4.2)\n       forwardable (~> 1.3, >= 1.3.3)\n       logger (~> 1.7, >= 1.7.0)\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/components/avatar_group.tsx\n@@ -7,10 +7,16 @@ import classNames from 'classnames';\n \n export const AvatarGroup: React.FC<{\n   compact?: boolean;\n+  avatarHeight?: number;\n   children: React.ReactNode;\n-}> = ({ children, compact = false }) => (\n+}> = ({ children, compact = false, avatarHeight }) => (\n   <div\n     className={classNames('avatar-group', { 'avatar-group--compact': compact })}\n+    style={\n+      avatarHeight\n+        ? ({ '--avatar-height': `${avatarHeight}px` } as React.CSSProperties)\n+        : undefined\n+    }\n   >\n     {children}\n   </div>\n---\napp/javascript/mastodon/components/more_from_author.jsx\n@@ -1,17 +0,0 @@\n-import PropTypes from 'prop-types';\n-\n-import { FormattedMessage } from 'react-intl';\n-\n-import { IconLogo } from 'mastodon/components/logo';\n-import { AuthorLink } from 'mastodon/features/explore/components/author_link';\n-\n-export const MoreFromAuthor = ({ accountId }) => (\n-  <div className='more-from-author'>\n-    <IconLogo />\n-    <FormattedMessage id='link_preview.more_from_author' defaultMessage='More from {name}' values={{ name: <AuthorLink accountId={accountId} /> }} />\n-  </div>\n-);\n-\n-MoreFromAuthor.propTypes = {\n-  accountId: PropTypes.string.isRequired,\n-};\n---\napp/javascript/mastodon/components/more_from_author.tsx\n@@ -0,0 +1,21 @@\n+import { FormattedMessage } from 'react-intl';\n+\n+import { IconLogo } from 'mastodon/components/logo';\n+import { AuthorLink } from 'mastodon/features/explore/components/author_link';\n+\n+export const MoreFromAuthor: React.FC<{ accountId: string }> = ({\n+  accountId,\n+}) => (\n+  <FormattedMessage\n+    id='link_preview.more_from_author'\n+    defaultMessage='More from {name}'\n+    values={{ name: <AuthorLink accountId={accountId} /> }}\n+  >\n+    {(chunks) => (\n+      <div className='more-from-author'>\n+        <IconLogo />\n+        {chunks}\n+      </div>\n+    )}\n+  </FormattedMessage>\n+);\n---\napp/javascript/mastodon/features/notifications_v2/components/notification_group_with_status.tsx\n@@ -18,12 +18,14 @@ import { useAppSelector, useAppDispatch } from 'mastodon/store';\n import { DisplayedName } from './displayed_name';\n import { EmbeddedStatus } from './embedded_status';\n \n+const AVATAR_SIZE = 28;\n+\n export const AvatarById: React.FC<{ accountId: string }> = ({ accountId }) => {\n   const account = useAppSelector((state) => state.accounts.get(accountId));\n \n   if (!account) return null;\n \n-  return <Avatar withLink account={account} size={28} />;\n+  return <Avatar withLink account={account} size={AVATAR_SIZE} />;\n };\n \n export type LabelRenderer = (\n@@ -108,7 +110,7 @@ export const NotificationGroupWithStatus: React.FC<{\n         <div className='notification-group__main'>\n           <div className='notification-group__main__header'>\n             <div className='notification-group__main__header__wrapper'>\n-              <AvatarGroup>\n+              <AvatarGroup avatarHeight={AVATAR_SIZE}>\n                 {accountIds\n                   .slice(0, NOTIFICATIONS_GROUP_MAX_AVATARS)\n                   .map((id) => (\n@@ -123,7 +125,14 @@ export const NotificationGroupWithStatus: React.FC<{\n \n             <div className='notification-group__main__header__label'>\n               {label}\n-              {timestamp && <RelativeTimestamp timestamp={timestamp} />}\n+              {timestamp && (\n+                <>\n+                  <span className='notification-group__main__header__label-separator'>\n+                    &middot;\n+                  </span>\n+                  <RelativeTimestamp timestamp={timestamp} />\n+                </>\n+              )}\n             </div>\n           </div>\n \n---\napp/javascript/styles/mastodon/components.scss\n@@ -2249,14 +2249,18 @@ a .account__avatar {\n \n .avatar-group {\n   display: flex;\n-  gap: 8px;\n-  flex-wrap: wrap;\n+\n+  --avatar-height: 28px;\n+\n+  &:not(.avatar-group--compact) {\n+    gap: 8px;\n+    flex-wrap: wrap;\n+    height: var(--avatar-height);\n+    overflow-y: clip;\n+  }\n }\n \n .avatar-group--compact {\n-  gap: 0;\n-  flex-wrap: nowrap;\n-\n   & > :not(:first-child) {\n     margin-inline-start: -12px;\n   }\n@@ -10408,7 +10412,8 @@ noscript {\n   padding: 15px;\n   display: flex;\n   align-items: center;\n-  gap: 8px;\n+  flex-wrap: wrap;\n+  gap: 4px 8px;\n \n   .logo {\n     width: 16px;\n@@ -10502,12 +10507,6 @@ noscript {\n     overflow: hidden;\n     container-type: inline-size;\n \n-    @container (width < 350px) {\n-      &__header time {\n-        display: none;\n-      }\n-    }\n-\n     &__header {\n       display: flex;\n       flex-direction: column;\n@@ -10520,7 +10519,8 @@ noscript {\n \n       &__label {\n         display: flex;\n-        gap: 8px;\n+        flex-wrap: wrap;\n+        gap: 2px 8px;\n         font-size: 15px;\n         line-height: 22px;\n         color: $darker-text-color;\n@@ -10538,6 +10538,13 @@ noscript {\n         time {\n           color: $dark-text-color;\n         }\n+\n+        @container (width < 350px) {\n+          time,\n+          &-separator {\n+            display: none;\n+          }\n+        }\n       }\n     }\n \n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -620,7 +620,7 @@ GEM\n     psych (5.2.3)\n       date\n       stringio\n-    public_suffix (6.0.1)\n+    public_suffix (6.0.2)\n     puma (6.6.0)\n       nio4r (~> 2.0)\n     pundit (2.5.0)\n---\n\n\n---\n\nChoice D:\nspec/system/account_notes_spec.rb\n@@ -11,13 +11,13 @@\n   let(:finished_onboarding) { true }\n \n   let!(:other_account) { Fabricate(:account) }\n+  let(:note_text) { 'This is a personal note' }\n \n   before { as_a_logged_in_user }\n \n   it 'can be written and viewed' do\n     visit_profile(other_account)\n \n-    note_text = 'This is a personal note'\n     fill_in frontend_translations('account_note.placeholder'), with: note_text\n \n     # This is a bit awkward since there is no button to save the change\n---\nspec/system/new_statuses_spec.rb\n@@ -9,12 +9,12 @@\n   let(:password)            { 'password' }\n   let(:confirmed_at)        { Time.zone.now }\n   let(:finished_onboarding) { true }\n+  let(:status_text) { 'This is a new status!' }\n \n   before { as_a_logged_in_user }\n \n   it 'can be posted' do\n     visit_homepage\n-    status_text = 'This is a new status!'\n \n     within('.compose-form') do\n       fill_in frontend_translations('compose_form.placeholder'), with: status_text\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nAuto-correct here.\n\n---\n\nChoice A:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n-  version: 2.8.1\n-  resolution: \"pg-connection-string@npm:2.8.1\"\n-  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n+  version: 2.8.5\n+  resolution: \"pg-connection-string@npm:2.8.5\"\n+  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\n.rubocop_todo.yml\n@@ -33,7 +33,6 @@ Style/FetchEnvVar:\n   Exclude:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/paperclip.rb'\n-    - 'lib/tasks/repo.rake'\n \n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: MinBodyLength, AllowConsecutiveConditionals.\n---\nlib/tasks/repo.rake\n@@ -57,7 +57,7 @@ namespace :repo do\n                 response = nil\n \n                 loop do\n-                  response = HTTP.headers('Authorization' => \"token #{ENV['GITHUB_API_TOKEN']}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n+                  response = HTTP.headers('Authorization' => \"token #{ENV.fetch('GITHUB_API_TOKEN')}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n \n                   if response.code == 403\n                     sleep_for = (response.headers['X-RateLimit-Reset'].to_i - Time.now.to_i).abs\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -78,7 +78,6 @@ gem 'rack-cors', '~> 2.0', require: 'rack/cors'\n gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n-gem 'redis-namespace', '~> 1.10'\n gem 'rqrcode', '~> 3.0'\n gem 'ruby-progressbar', '~> 1.13'\n gem 'sanitize', '~> 7.0'\n---\nGemfile.lock\n@@ -696,8 +696,6 @@ GEM\n       psych (>= 4.0.0)\n     redcarpet (3.6.1)\n     redis (4.8.1)\n-    redis-namespace (1.11.0)\n-      redis (>= 4)\n     redlock (1.3.2)\n       redis (>= 3.0.0, < 6.0)\n     regexp_parser (2.10.0)\n@@ -1046,7 +1044,6 @@ DEPENDENCIES\n   rdf-normalize (~> 0.5)\n   redcarpet (~> 3.6)\n   redis (~> 4.5)\n-  redis-namespace (~> 1.10)\n   rqrcode (~> 3.0)\n   rspec-github (~> 3.0)\n   rspec-rails (~> 8.0)\n---\napp/lib/admin/metrics/dimension/software_versions_dimension.rb\n@@ -119,10 +119,6 @@ def ffmpeg_version\n   end\n \n   def redis_info\n-    @redis_info ||= if redis.is_a?(Redis::Namespace)\n-                      redis.redis.info\n-                    else\n-                      redis.info\n-                    end\n+    @redis_info ||= redis.info\n   end\n end\n---\napp/lib/admin/metrics/dimension/space_usage_dimension.rb\n@@ -58,11 +58,7 @@ def media_size\n   end\n \n   def redis_info\n-    @redis_info ||= if redis.is_a?(Redis::Namespace)\n-                      redis.redis.info\n-                    else\n-                      redis.info\n-                    end\n+    @redis_info ||= redis.info\n   end\n \n   def search_size\n---\napp/lib/redis_connection.rb\n@@ -29,12 +29,7 @@ def initialize\n   end\n \n   def connection\n-    namespace = config[:namespace]\n-    if namespace.present?\n-      Redis::Namespace.new(namespace, redis: raw_connection)\n-    else\n-      raw_connection\n-    end\n+    raw_connection\n   end\n \n   private\n---\nconfig/application.rb\n@@ -24,7 +24,6 @@\n \n require_relative '../lib/exceptions'\n require_relative '../lib/sanitize_ext/sanitize_config'\n-require_relative '../lib/redis/namespace_extensions'\n require_relative '../lib/paperclip/url_generator_extensions'\n require_relative '../lib/paperclip/attachment_extensions'\n \n---\nlib/redis/namespace_extensions.rb\n@@ -1,16 +0,0 @@\n-# frozen_string_literal: true\n-\n-class Redis\n-  module NamespaceExtensions\n-    def exists?(...)\n-      call_with_namespace('exists?', ...)\n-    end\n-\n-    def with\n-      yield self\n-    end\n-  end\n-end\n-\n-Redis::Namespace::COMMANDS['exists?'] = [:first]\n-Redis::Namespace.prepend(Redis::NamespaceExtensions)\n---\nspec/controllers/oauth/authorized_applications_controller_spec.rb\n@@ -43,7 +43,7 @@\n     let!(:application) { Fabricate(:application) }\n     let!(:access_token) { Fabricate(:accessible_access_token, application: application, resource_owner_id: user.id) }\n     let!(:web_push_subscription) { Fabricate(:web_push_subscription, user: user, access_token: access_token) }\n-    let(:redis_pipeline_stub) { instance_double(Redis::Namespace, publish: nil) }\n+    let(:redis_pipeline_stub) { instance_double(Redis::PipelinedConnection, publish: nil) }\n \n     before do\n       sign_in user, scope: :user\n---\nspec/models/user_spec.rb\n@@ -489,7 +489,7 @@ def within_duration_window_days\n     let!(:access_token) { Fabricate(:access_token, resource_owner_id: user.id) }\n     let!(:web_push_subscription) { Fabricate(:web_push_subscription, access_token: access_token) }\n \n-    let(:redis_pipeline_stub) { instance_double(Redis::Namespace, publish: nil) }\n+    let(:redis_pipeline_stub) { instance_double(Redis::PipelinedConnection, publish: nil) }\n \n     before { stub_redis }\n \n---\nspec/system/settings/applications_spec.rb\n@@ -101,7 +101,7 @@ def submit_form\n   end\n \n   describe 'Destroying an application' do\n-    let(:redis_pipeline_stub) { instance_double(Redis::Namespace, publish: nil) }\n+    let(:redis_pipeline_stub) { instance_double(Redis::PipelinedConnection, publish: nil) }\n     let!(:access_token) { Fabricate(:accessible_access_token, application: application) }\n \n     before { stub_redis_pipeline }\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -1,18 +1,24 @@\n import { FormattedMessage } from 'react-intl';\n \n import classNames from 'classnames';\n+import { Link } from 'react-router-dom';\n \n import type { Map as ImmutableMap } from 'immutable';\n \n+import ArticleIcon from '@/material-icons/400-24px/article.svg?react';\n+import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react';\n import { Icon } from 'mastodon/components/icon';\n import StatusContainer from 'mastodon/containers/status_container';\n+import type { Status } from 'mastodon/models/status';\n import { useAppSelector } from 'mastodon/store';\n \n import QuoteIcon from '../../images/quote.svg?react';\n \n+const MAX_QUOTE_POSTS_NESTING_LEVEL = 1;\n+\n const QuoteWrapper: React.FC<{\n   isError?: boolean;\n-  children: React.ReactNode;\n+  children: React.ReactElement;\n }> = ({ isError, children }) => {\n   return (\n     <div\n@@ -26,16 +32,52 @@ const QuoteWrapper: React.FC<{\n   );\n };\n \n+const QuoteLink: React.FC<{\n+  status: Status;\n+}> = ({ status }) => {\n+  const accountId = status.get('account') as string;\n+  const account = useAppSelector((state) =>\n+    accountId ? state.accounts.get(accountId) : undefined,\n+  );\n+\n+  const quoteAuthorName = account?.display_name_html;\n+\n+  if (!quoteAuthorName) {\n+    return null;\n+  }\n+\n+  const quoteAuthorElement = (\n+    <span dangerouslySetInnerHTML={{ __html: quoteAuthorName }} />\n+  );\n+  const quoteUrl = `/@${account.get('acct')}/${status.get('id') as string}`;\n+\n+  return (\n+    <Link to={quoteUrl} className='status__quote-author-button'>\n+      <FormattedMessage\n+        id='status.quote_post_author'\n+        defaultMessage='Post by {name}'\n+        values={{ name: quoteAuthorElement }}\n+      />\n+      <Icon id='chevron_right' icon={ChevronRightIcon} />\n+      <Icon id='article' icon={ArticleIcon} />\n+    </Link>\n+  );\n+};\n+\n type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n \n-export const QuotedStatus: React.FC<{ quote: QuoteMap }> = ({ quote }) => {\n+export const QuotedStatus: React.FC<{\n+  quote: QuoteMap;\n+  variant?: 'full' | 'link';\n+  nestingLevel?: number;\n+}> = ({ quote, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n   const state = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n \n-  let quoteError: React.ReactNode | null = null;\n+  let quoteError: React.ReactNode = null;\n \n   if (state === 'deleted') {\n     quoteError = (\n@@ -78,14 +120,28 @@ export const QuotedStatus: React.FC<{ quote: QuoteMap }> = ({ quote }) => {\n     return <QuoteWrapper isError>{quoteError}</QuoteWrapper>;\n   }\n \n+  if (variant === 'link' && status) {\n+    return <QuoteLink status={status} />;\n+  }\n+\n+  const childQuote = status?.get('quote') as QuoteMap | undefined;\n+  const canRenderChildQuote =\n+    childQuote && nestingLevel <= MAX_QUOTE_POSTS_NESTING_LEVEL;\n+\n   return (\n     <QuoteWrapper>\n-      <StatusContainer\n-        // @ts-expect-error Status isn't typed yet\n-        isQuotedPost\n-        id={quotedStatusId}\n-        avatarSize={40}\n-      />\n+      {/* @ts-expect-error Status is not yet typed */}\n+      <StatusContainer isQuotedPost id={quotedStatusId} avatarSize={40}>\n+        {canRenderChildQuote && (\n+          <QuotedStatus\n+            quote={childQuote}\n+            variant={\n+              nestingLevel === MAX_QUOTE_POSTS_NESTING_LEVEL ? 'link' : 'full'\n+            }\n+            nestingLevel={nestingLevel + 1}\n+          />\n+        )}\n+      </StatusContainer>\n     </QuoteWrapper>\n   );\n };\n---\napp/javascript/mastodon/locales/en.json\n@@ -868,6 +868,7 @@\n   \"status.quote_error.rejected\": \"This post cannot be displayed as the original author does not allow it to be quoted.\",\n   \"status.quote_error.removed\": \"This post was removed by its author.\",\n   \"status.quote_error.unauthorized\": \"This post cannot be displayed as you are not authorized to view it.\",\n+  \"status.quote_post_author\": \"Post by {name}\",\n   \"status.read_more\": \"Read more\",\n   \"status.reblog\": \"Boost\",\n   \"status.reblog_private\": \"Boost with original visibility\",\n---\napp/javascript/material-icons/400-24px/article-fill.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm80-160h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/article.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M280-280h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Zm-80 480q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/README.md\n@@ -1 +1,12 @@\n-Files in this directory are Material Symbols icons fetched using the `icons:download` task.\n+Files in this directory are Material Symbols icons fetched using the `icons:download` rake task (see `/lib/tasks/icons.rake`).\n+\n+To add another icon, follow these steps:\n+\n+- Determine the name of the Material Symbols icon you want to download.\n+  You can find a searchable overview of all icons on [https://fonts.google.com/icons].\n+  Click on the icon you want to use and find the icon name towards the bottom of the slide-out panel (it'll be something like `icon_name`)\n+- Import the icon in your React component using the following format:\n+  `import IconName from '@/material-icons/400-24px/icon_name.svg?react';`\n+- Run `RAILS_ENV=development rails icons:download` to download any newly imported icons.\n+\n+The import should now work and the icon should appear when passed to the `<Icon icon={IconName} /> component\n---\napp/javascript/styles/mastodon/components.scss\n@@ -1880,11 +1880,15 @@ body > [data-popper-placement] {\n .status__quote {\n   position: relative;\n   margin-block-start: 16px;\n-  margin-inline-start: 56px;\n+  margin-inline-start: 36px;\n   border-radius: 8px;\n   color: var(--nested-card-text);\n   background: var(--nested-card-background);\n   border: var(--nested-card-border);\n+\n+  @media screen and (min-width: $mobile-breakpoint) {\n+    margin-inline-start: 56px;\n+  }\n }\n \n .status__quote--error {\n@@ -1895,10 +1899,42 @@ body > [data-popper-placement] {\n   font-size: 15px;\n }\n \n+.status__quote-author-button {\n+  position: relative;\n+  overflow: hidden;\n+  display: inline-flex;\n+  width: auto;\n+  margin-block-start: 10px;\n+  padding: 5px 12px;\n+  align-items: center;\n+  gap: 6px;\n+  font-family: inherit;\n+  font-size: 14px;\n+  font-weight: 700;\n+  line-height: normal;\n+  letter-spacing: 0;\n+  text-decoration: none;\n+  color: $highlight-text-color;\n+  background: var(--nested-card-background);\n+  border: var(--nested-card-border);\n+  border-radius: 4px;\n+\n+  &:active,\n+  &:focus,\n+  &:hover {\n+    border-color: lighten($highlight-text-color, 4%);\n+    color: lighten($highlight-text-color, 4%);\n+  }\n+\n+  &:focus-visible {\n+    outline: $ui-button-icon-focus-outline;\n+  }\n+}\n+\n .status__quote-icon {\n   position: absolute;\n   inset-block-start: 18px;\n-  inset-inline-start: -50px;\n+  inset-inline-start: -40px;\n   display: block;\n   width: 26px;\n   height: 26px;\n@@ -1910,6 +1946,10 @@ body > [data-popper-placement] {\n     inset-block-start: 50%;\n     transform: translateY(-50%);\n   }\n+\n+  @media screen and (min-width: $mobile-breakpoint) {\n+    inset-inline-start: -50px;\n+  }\n }\n \n .detailed-status__link {\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [aws-sdk-core](https://redirect.github.com/aws/aws-sdk-ruby) ([source](https://redirect.github.com/aws/aws-sdk-ruby/tree/HEAD/gems/aws-sdk-core), [changelog](https://redirect.github.com/aws/aws-sdk-ruby/tree/version-3/gems/aws-sdk-core/CHANGELOG.md)) | `'< 3.216.0'` -> `'< 3.225.1'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/aws-sdk-core/3.225.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/aws-sdk-core/3.225.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/aws-sdk-core/3.215.1/3.225.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/aws-sdk-core/3.215.1/3.225.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>aws/aws-sdk-ruby (aws-sdk-core)</summary>\n\n### [`v3.225.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32250-2025-06-02)\n\n-   Feature - AWS SDK for Ruby no longer supports Ruby runtime versions 2.5 and 2.6.\n\n### [`v3.224.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32241-2025-05-28)\n\n-   Issue - Signal data in http response listeners prior to writing, so that data can be inspected or verified before potential mutation.\n\n### [`v3.224.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32240-2025-05-12)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n-   Feature - Support `ENV['AWS_DISABLE_HOST_PREFIX_INJECTION']` and `disable_host_prefix_injection` shared config to disable host prefix injection for all services.\n\n### [`v3.223.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32230-2025-05-01)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n### [`v3.222.3`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32223-2025-04-28)\n\n-   Issue - Do not dynamically create operation methods from the API. ([#&#8203;3234](https://redirect.github.com/aws/aws-sdk-ruby/issues/3234))\n\n### [`v3.222.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32222-2025-04-16)\n\n-   Issue - Additional metrics collection for credentials in the User-Agent plugin.\n\n### [`v3.222.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32221-2025-03-28)\n\n-   Issue - Allow explicit modeled headers to override prefixed headers for `rest` protocols.\n\n### [`v3.222.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32220-2025-03-27)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - This release adds AwsAdditionalDetails in the CreateTokenWithIAM API response.\n\n### [`v3.221.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32210-2025-03-24)\n\n-   Feature - Add `logger` as an explicit dependency for Ruby 3.5.\n-   Issue - Enable ALPN over TLS for H2 Connection by default.\n-   Issue - Fix HTTP-2 connections to properly use config values configured on the client.\n\n### [`v3.220.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32202-2025-03-20)\n\n-   Issue - Enable ALPN over TLS for H2 by default.\n\n### [`v3.220.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32201-2025-03-06)\n\n-   Issue - Convert stubs at request time.\n\n### [`v3.220.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32200-2025-03-04)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n### [`v3.219.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32190-2025-02-18)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.218.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32181-2025-02-07)\n\n-   Issue - Add handling of block in ExtendedSession delegation ([#&#8203;3178](https://redirect.github.com/aws/aws-sdk-ruby/issues/3178)).\n\n### [`v3.218.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32180-2025-02-06)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.217.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32171-2025-01-30)\n\n-   Issue - Add `transfer-encoding` and `connection` to list of unsigned sigv4 headers.\n\n### [`v3.217.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32170-2025-01-24)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Fixed typos in the descriptions.\n\n### [`v3.216.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32161-2025-01-22)\n\n-   Issue - Use epoch seconds instead of milliseconds in cbor encode/decode.\n\n-   Issue - Add handling of block in response delegation ([#&#8203;3169](https://redirect.github.com/aws/aws-sdk-ruby/issues/3169)).\n\n### [`v3.216.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32160-2025-01-15)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n-   Feature - Always calculate request checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:request_checksum_calculation`, in the shared config file as `request_checksum_calculation`, and in the ENV as `ENV['AWS_REQUEST_CHECKSUM_CALCULATION']`.\n\n-   Feature - Always validate response checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:response_checksum_validation`, in the shared config file as `response_checksum_validation`, and in the ENV as `ENV['AWS_RESPONSE_CHECKSUM_VALIDATION']`.\n\n-   Feature - Support CRC64NVME checksums through the `aws-crt` gem.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4zMy42IiwidXBkYXRlZEluVmVyIjoiNDAuMzMuNiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\nlib/mastodon/cli/search.rb\n@@ -20,6 +20,7 @@ class Search < Base\n     option :import, type: :boolean, default: true, desc: 'Import data from the database to the index'\n     option :clean, type: :boolean, default: true, desc: 'Remove outdated documents from the index'\n     option :reset_chewy, type: :boolean, default: false, desc: \"Reset Chewy's internal index\"\n+    option :only_mapping, type: :boolean, default: false, desc: 'Update the index specification without re-index'\n     desc 'deploy', 'Create or upgrade Elasticsearch indices and populate them'\n     long_desc <<~LONG_DESC\n       If Elasticsearch is empty, this command will create the necessary indices\n@@ -52,6 +53,20 @@ def deploy\n \n       Chewy::Stash::Specification.reset! if options[:reset_chewy]\n \n+      if options[:only_mapping]\n+        indices.select { |index| index.specification.changed? }.each do |index|\n+          progress.title = \"Updating mapping for #{index} \"\n+          index.update_mapping\n+          index.specification.lock!\n+        end\n+\n+        progress.title = 'Done! '\n+        progress.finish\n+\n+        say('Updated index mappings', :green, true)\n+        return\n+      end\n+\n       # First, ensure all indices are created and have the correct\n       # structure, so that live data can already be written\n       indices.select { |index| index.specification.changed? }.each do |index|\n---\n\n\n---\n\nChoice B:\napp/lib/activitypub/activity/create.rb\n@@ -233,7 +233,7 @@ def process_quote\n \n     approval_uri = @status_parser.quote_approval_uri\n     approval_uri = nil if unsupported_uri_scheme?(approval_uri)\n-    @quote = Quote.new(account: @account, approval_uri: approval_uri)\n+    @quote = Quote.new(account: @account, approval_uri: approval_uri, legacy: @status_parser.legacy_quote?)\n   end\n \n   def process_hashtag(tag)\n---\napp/lib/activitypub/parser/status_parser.rb\n@@ -123,6 +123,10 @@ def quote_uri\n     end.first\n   end\n \n+  def legacy_quote?\n+    !@object.key?('quote')\n+  end\n+\n   # The inlined quote; out of the attributes we support, only `https://w3id.org/fep/044f#quote` explicitly supports inlined objects\n   def quoted_object\n     as_array(@object['quote']).first\n---\napp/models/quote.rb\n@@ -7,6 +7,7 @@\n #  id                :bigint(8)        not null, primary key\n #  activity_uri      :string\n #  approval_uri      :string\n+#  legacy            :boolean          default(FALSE), not null\n #  state             :integer          default(\"pending\"), not null\n #  created_at        :datetime         not null\n #  updated_at        :datetime         not null\n@@ -46,6 +47,10 @@ def reject!\n     end\n   end\n \n+  def acceptable?\n+    accepted? || !legacy?\n+  end\n+\n   def schedule_refresh_if_stale!\n     return unless quoted_status_id.present? && approval_uri.present? && updated_at <= BACKGROUND_REFRESH_INTERVAL.ago\n \n---\napp/serializers/rest/status_serializer.rb\n@@ -33,6 +33,10 @@ class REST::StatusSerializer < ActiveModel::Serializer\n   has_one :preview_card, key: :card, serializer: REST::PreviewCardSerializer\n   has_one :preloadable_poll, key: :poll, serializer: REST::PollSerializer\n \n+  def quote\n+    object.quote if object.quote&.acceptable?\n+  end\n+\n   def id\n     object.id.to_s\n   end\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -283,14 +283,14 @@ def update_quote!\n         # If the quoted post has changed, discard the old object and create a new one\n         if @status.quote.quoted_status.present? && ActivityPub::TagManager.instance.uri_for(@status.quote.quoted_status) != quote_uri\n           @status.quote.destroy\n-          quote = Quote.create(status: @status, approval_uri: approval_uri)\n+          quote = Quote.create(status: @status, approval_uri: approval_uri, legacy: @status_parser.legacy_quote?)\n           @quote_changed = true\n         else\n           quote = @status.quote\n-          quote.update(approval_uri: approval_uri, state: :pending) if quote.approval_uri != @status_parser.quote_approval_uri\n+          quote.update(approval_uri: approval_uri, state: :pending, legacy: @status_parser.legacy_quote?) if quote.approval_uri != @status_parser.quote_approval_uri\n         end\n       else\n-        quote = Quote.create(status: @status, approval_uri: approval_uri)\n+        quote = Quote.create(status: @status, approval_uri: approval_uri, legacy: @status_parser.legacy_quote?)\n         @quote_changed = true\n       end\n \n---\ndb/migrate/20250605110215_add_legacy_to_quotes.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddLegacyToQuotes < ActiveRecord::Migration[8.0]\n+  def change\n+    add_column :quotes, :legacy, :boolean, null: false, default: false\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_05_20_204643) do\n+ActiveRecord::Schema[8.0].define(version: 2025_06_05_110215) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -906,6 +906,7 @@\n     t.string \"activity_uri\"\n     t.datetime \"created_at\", null: false\n     t.datetime \"updated_at\", null: false\n+    t.boolean \"legacy\", default: false, null: false\n     t.index [\"account_id\", \"quoted_account_id\"], name: \"index_quotes_on_account_id_and_quoted_account_id\"\n     t.index [\"activity_uri\"], name: \"index_quotes_on_activity_uri\", unique: true, where: \"(activity_uri IS NOT NULL)\"\n     t.index [\"approval_uri\"], name: \"index_quotes_on_approval_uri\", where: \"(approval_uri IS NOT NULL)\"\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -13,7 +13,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.225.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -93,21 +93,23 @@ GEM\n     annotaterb (4.14.0)\n     ast (2.4.3)\n     attr_required (1.0.2)\n-    aws-eventstream (1.3.2)\n-    aws-partitions (1.1103.0)\n-    aws-sdk-core (3.215.1)\n+    aws-eventstream (1.4.0)\n+    aws-partitions (1.1110.0)\n+    aws-sdk-core (3.225.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n     aws-sdk-s3 (1.177.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sdk-kms (~> 1)\n       aws-sigv4 (~> 1.5)\n-    aws-sigv4 (1.11.0)\n+    aws-sigv4 (1.12.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n     azure-blob (0.5.8)\n       rexml\n@@ -946,7 +948,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.225.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice D:\ndb/migrate/20250425134308_quote_ids_to_timestamp_ids.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class QuoteIdsToTimestampIds < ActiveRecord::Migration[8.0]\n+  def up\n+    # Set up the media_attachments.id column to use our timestamp-based IDs.\n+    safety_assured do\n+      execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT timestamp_id('quotes')\")\n+    end\n+\n+    # Make sure we have a sequence to use.\n+    Mastodon::Snowflake.ensure_id_sequences_exist\n+  end\n+\n+  def down\n+    execute('LOCK quotes')\n+    execute(\"SELECT setval('quotes_id_seq', (SELECT MAX(id) FROM quotes))\")\n+    execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT nextval('quotes_id_seq')\")\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_22_085303) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_25_134654) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -871,7 +871,7 @@\n     t.string \"url\"\n   end\n \n-  create_table \"quotes\", force: :cascade do |t|\n+  create_table \"quotes\", id: :bigint, default: -> { \"timestamp_id('quotes'::text)\" }, force: :cascade do |t|\n     t.bigint \"account_id\", null: false\n     t.bigint \"status_id\", null: false\n     t.bigint \"quoted_status_id\"\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [@vitejs/plugin-react](https://redirect.github.com/vitejs/vite-plugin-react/tree/main/packages/plugin-react#readme) ([source](https://redirect.github.com/vitejs/vite-plugin-react/tree/HEAD/packages/plugin-react)) | [`4.5.0` -> `4.5.1`](https://renovatebot.com/diffs/npm/@vitejs%2fplugin-react/4.5.0/4.5.1) | [![age](https://developer.mend.io/api/mc/badges/age/npm/@vitejs%2fplugin-react/4.5.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/@vitejs%2fplugin-react/4.5.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/@vitejs%2fplugin-react/4.5.0/4.5.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/@vitejs%2fplugin-react/4.5.0/4.5.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>vitejs/vite-plugin-react (@&#8203;vitejs/plugin-react)</summary>\n\n### [`v4.5.1`](https://redirect.github.com/vitejs/vite-plugin-react/blob/HEAD/packages/plugin-react/CHANGELOG.md#451-2025-06-03)\n\n[Compare Source](https://redirect.github.com/vitejs/vite-plugin-react/compare/476e705375ef618458918580beb63f43799d12e4...2f3205265904ff7770021700689a0d6fe17b1f03)\n\n##### Add explicit semicolon in preambleCode [#&#8203;485](https://redirect.github.com/vitejs/vite-plugin-react/pull/485)\n\nThis fixes an edge case when using HTML minifiers that strips line breaks aggressively.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4zMy42IiwidXBkYXRlZEluVmVyIjoiNDAuMzMuNiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwiamF2YXNjcmlwdCJdfQ==-->\n\n\n---\n\nChoice A:\nGemfile\n@@ -79,7 +79,7 @@ gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n gem 'redis-namespace', '~> 1.10'\n-gem 'rqrcode', '~> 2.2'\n+gem 'rqrcode', '~> 3.0'\n gem 'ruby-progressbar', '~> 1.13'\n gem 'sanitize', '~> 7.0'\n gem 'scenic', '~> 1.7'\n---\nGemfile.lock\n@@ -711,10 +711,10 @@ GEM\n     rotp (6.3.0)\n     rouge (4.5.1)\n     rpam2 (4.0.2)\n-    rqrcode (2.2.0)\n+    rqrcode (3.0.0)\n       chunky_png (~> 1.0)\n-      rqrcode_core (~> 1.0)\n-    rqrcode_core (1.2.0)\n+      rqrcode_core (~> 2.0)\n+    rqrcode_core (2.0.0)\n     rspec (3.13.0)\n       rspec-core (~> 3.13.0)\n       rspec-expectations (~> 3.13.0)\n@@ -1043,7 +1043,7 @@ DEPENDENCIES\n   redcarpet (~> 3.6)\n   redis (~> 4.5)\n   redis-namespace (~> 1.10)\n-  rqrcode (~> 2.2)\n+  rqrcode (~> 3.0)\n   rspec-github (~> 3.0)\n   rspec-rails (~> 7.0)\n   rspec-sidekiq (~> 5.0)\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -4201,8 +4201,8 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.5.0\n-  resolution: \"@vitejs/plugin-react@npm:4.5.0\"\n+  version: 4.5.1\n+  resolution: \"@vitejs/plugin-react@npm:4.5.1\"\n   dependencies:\n     \"@babel/core\": \"npm:^7.26.10\"\n     \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n@@ -4212,7 +4212,7 @@ __metadata:\n     react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n     vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n-  checksum: 10c0/c9f75cde098b9aac62cb512103d7f898a0a173cb78dc9fcf79ca4b3f21a1458cd1955a4383c8c9e3841ce23c5e7f02ed1455e445c9574879b143d40734121fd8\n+  checksum: 10c0/51b28c02905228cc5b1dd16f5d008cf08175e47d22ff37b0959a9ee20a46a5215698b20405f39e6b73ae2a63c2a005d74c94b3456083ad038b59932d682b9165\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\ndocker-compose.yml\n@@ -115,7 +115,7 @@ services:\n     volumes:\n       - ./public/system:/mastodon/public/system\n     healthcheck:\n-      test: ['CMD-SHELL', \"ps aux | grep '[s]idekiq\\ 6' || false\"]\n+      test: ['CMD-SHELL', \"ps aux | grep '[s]idekiq\\ 7' || false\"]\n \n   ## Uncomment to enable federation with tor instances along with adding the following ENV variables\n   ## http_hidden_proxy=http://privoxy:8118\n---\n\n\n---\n\nChoice D:\napp/controllers/admin/rules_controller.rb\n@@ -50,6 +50,22 @@ def destroy\n       redirect_to admin_rules_path\n     end\n \n+    def move_up\n+      authorize @rule, :update?\n+\n+      @rule.move!(-1)\n+\n+      redirect_to admin_rules_path\n+    end\n+\n+    def move_down\n+      authorize @rule, :update?\n+\n+      @rule.move!(+1)\n+\n+      redirect_to admin_rules_path\n+    end\n+\n     private\n \n     def set_rule\n---\napp/javascript/material-icons/400-24px/arrow_downward-fill.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-800v487L216-537l-56 57 320 320 320-320-56-57-224 224v-487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/arrow_downward.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-800v487L216-537l-56 57 320 320 320-320-56-57-224 224v-487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/arrow_upward-fill.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-160v-487L216-423l-56-57 320-320 320 320-56 57-224-224v487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/arrow_upward.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-160v-487L216-423l-56-57 320-320 320 320-56 57-224-224v487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/styles/mastodon/admin.scss\n@@ -1127,6 +1127,15 @@ a.name-tag,\n   }\n }\n \n+.rule-actions {\n+  display: flex;\n+  flex-direction: column;\n+\n+  a.table-action-link {\n+    padding-inline-start: 0;\n+  }\n+}\n+\n .dashboard__counters.admin-account-counters {\n   margin-top: 10px;\n }\n---\napp/models/rule.rb\n@@ -22,4 +22,18 @@ class Rule < ApplicationRecord\n   validates :text, presence: true, length: { maximum: TEXT_SIZE_LIMIT }\n \n   scope :ordered, -> { kept.order(priority: :asc, id: :asc) }\n+\n+  def move!(offset)\n+    rules = Rule.ordered.to_a\n+    position = rules.index(self)\n+\n+    rules.delete_at(position)\n+    rules.insert(position + offset, self)\n+\n+    transaction do\n+      rules.each.with_index do |rule, index|\n+        rule.update!(priority: index)\n+      end\n+    end\n+  end\n end\n---\napp/views/admin/rules/_rule.html.haml\n@@ -7,5 +7,7 @@\n     .announcements-list__item__meta\n       = rule.hint\n \n-    %div\n+    .rule-actions\n+      = table_link_to 'arrow_upward', t('admin.rules.move_up'), move_up_admin_rule_path(rule), method: :post if can?(:update, rule) && !rule_iteration.first?\n       = table_link_to 'delete', t('admin.rules.delete'), admin_rule_path(rule), method: :delete, data: { confirm: t('admin.accounts.are_you_sure') } if can?(:destroy, rule)\n+      = table_link_to 'arrow_downward', t('admin.rules.move_down'), move_down_admin_rule_path(rule), method: :post if can?(:update, rule) && !rule_iteration.last?\n---\nconfig/locales/en.yml\n@@ -790,6 +790,8 @@ en:\n       description_html: While most claim to have read and agree to the terms of service, usually people do not read through until after a problem arises. <strong>Make it easier to see your server's rules at a glance by providing them in a flat bullet point list.</strong> Try to keep individual rules short and simple, but try not to split them up into many separate items either.\n       edit: Edit rule\n       empty: No server rules have been defined yet.\n+      move_down: Move down\n+      move_up: Move up\n       title: Server rules\n     settings:\n       about:\n---\nconfig/routes/admin.rb\n@@ -93,7 +93,12 @@\n     end\n   end\n \n-  resources :rules, only: [:index, :new, :create, :edit, :update, :destroy]\n+  resources :rules, only: [:index, :new, :create, :edit, :update, :destroy] do\n+    member do\n+      post :move_up\n+      post :move_down\n+    end\n+  end\n \n   resources :webhooks do\n     member do\n---\nspec/models/rule_spec.rb\n@@ -16,4 +16,24 @@\n       end\n     end\n   end\n+\n+  describe '#move!' do\n+    let!(:first_rule) { Fabricate(:rule, text: 'foo') }\n+    let!(:second_rule) { Fabricate(:rule, text: 'bar') }\n+    let!(:third_rule) { Fabricate(:rule, text: 'baz') }\n+\n+    it 'moves the rules as expected' do\n+      expect { first_rule.move!(+1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(foo bar baz)).to(%w(bar foo baz))\n+\n+      expect { first_rule.move!(-1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(bar foo baz)).to(%w(foo bar baz))\n+\n+      expect { third_rule.move!(-1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(foo bar baz)).to(%w(foo baz bar))\n+\n+      expect { second_rule.move!(-1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(foo baz bar)).to(%w(foo bar baz))\n+    end\n+  end\n end\n---\nspec/system/admin/rules_spec.rb\n@@ -48,6 +48,29 @@ def submit_form\n       end\n     end\n \n+    describe 'Moving down an existing rule' do\n+      let!(:first_rule) { Fabricate(:rule, text: 'This is another rule') }\n+      let!(:second_rule) { Fabricate(:rule, text: 'This is a rule') }\n+\n+      it 'moves the rule down' do\n+        visit admin_rules_path\n+\n+        expect(page)\n+          .to have_content(I18n.t('admin.rules.title'))\n+\n+        expect(Rule.ordered.pluck(:text)).to eq ['This is another rule', 'This is a rule']\n+\n+        click_on(I18n.t('admin.rules.move_down'))\n+\n+        expect(page)\n+          .to have_content(I18n.t('admin.rules.title'))\n+          .and have_content(first_rule.text)\n+          .and have_content(second_rule.text)\n+\n+        expect(Rule.ordered.pluck(:text)).to eq ['This is a rule', 'This is another rule']\n+      end\n+    end\n+\n     describe 'Editing an existing rule' do\n       let!(:rule) { Fabricate :rule, text: 'Rule text' }\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nNew Crowdin translations, automated with GitHub Actions\n\nSee `.github/workflows/crowdin-download.yml`\n\nThis PR will be updated every day with new translations.\n\nDue to a limitation in GitHub Actions, checks are not running on this PR without manual action.\nIf you want to run the checks, then close and re-open it.\n\n---\n\nChoice A:\napp/javascript/mastodon/features/video/components/hotkey_indicator.tsx\n@@ -24,7 +24,9 @@ export const HotkeyIndicator: React.FC<{\n     enter: [{ opacity: 1 }],\n     leave: [{ opacity: 0 }],\n     onRest: (_result, _ctrl, item) => {\n-      onDismiss(item);\n+      if (item) {\n+        onDismiss(item);\n+      }\n     },\n   });\n \n---\npackage.json\n@@ -44,7 +44,7 @@\n     \"@github/webauthn-json\": \"^2.1.1\",\n     \"@optimize-lodash/rollup-plugin\": \"^5.0.2\",\n     \"@rails/ujs\": \"7.1.501\",\n-    \"@react-spring/web\": \"^9.7.5\",\n+    \"@react-spring/web\": \"^10.0.0\",\n     \"@reduxjs/toolkit\": \"^2.0.1\",\n     \"@use-gesture/react\": \"^10.3.1\",\n     \"@vitejs/plugin-react\": \"^4.2.1\",\n---\nyarn.lock\n@@ -2451,7 +2451,7 @@ __metadata:\n     \"@github/webauthn-json\": \"npm:^2.1.1\"\n     \"@optimize-lodash/rollup-plugin\": \"npm:^5.0.2\"\n     \"@rails/ujs\": \"npm:7.1.501\"\n-    \"@react-spring/web\": \"npm:^9.7.5\"\n+    \"@react-spring/web\": \"npm:^10.0.0\"\n     \"@reduxjs/toolkit\": \"npm:^2.0.1\"\n     \"@testing-library/dom\": \"npm:^10.2.0\"\n     \"@testing-library/react\": \"npm:^16.0.0\"\n@@ -2877,69 +2877,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/animated@npm:9.7.5\"\n+\"@react-spring/animated@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/animated@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/f8c2473c60f39a878c7dd0fdfcfcdbc720521e1506aa3f63c9de64780694a0a73d5ccc535a5ccec3520ddb70a71cf43b038b32c18e99531522da5388c510ecd7\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/a8c40aff22def6dbe964b1f79fa4a7774c44bf5eb47c2ef969c8ecb2a426b4c972b147bf18635d6972dbec3fb95e70dd84f22b43c904c32dfc7a57ad144a0879\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/core@npm:9.7.5\"\n+\"@react-spring/core@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/core@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~9.7.5\"\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/animated\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/5bfd83dfe248cd91889f215f015d908c7714ef445740fd5afa054b27ebc7d5a456abf6c309e2459d9b5b436e78d6fda16b62b9601f96352e9130552c02270830\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/39036a153dbd973443e23d90cb8e7be83201b1f0e4105f8427ddb4c9e9e50e590e1b46282829e0bb6f3deebfab004e30dcb4eec0e34c5ebb234d5060c06ecae5\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/rafz@npm:9.7.5\"\n-  checksum: 10c0/8bdad180feaa9a0e870a513043a5e98a4e9b7292a9f887575b7e6fadab2677825bc894b7ff16c38511b35bfe6cc1072df5851c5fee64448d67551559578ca759\n+\"@react-spring/rafz@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/rafz@npm:10.0.0\"\n+  checksum: 10c0/8d92bc553172fa883ec2121b9cc62bfb43ff5d6c4e76363c8ce100fb6c3dd67c3dd629931786f9d1d63ac95a5d6996e4a08693cd56dda685bdbaf39b60e97f66\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/shared@npm:9.7.5\"\n+\"@react-spring/shared@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/shared@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/rafz\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/0207eacccdedd918a2fc55e78356ce937f445ce27ad9abd5d3accba8f9701a39349b55115641dc2b39bb9d3a155b058c185b411d292dc8cc5686bfa56f73b94f\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/833c3f42d35d22ac47a2f756ac47d85a81bc1decc5e7915f46013823344374378f883135754de94d5b43d8fff3c55fc4a359044c9a44f9095bd1ef1f11a20d4d\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/types@npm:9.7.5\"\n-  checksum: 10c0/85c05121853cacb64f7cf63a4855e9044635e1231f70371cd7b8c78bc10be6f4dd7c68f592f92a2607e8bb68051540989b4677a2ccb525dba937f5cd95dc8bc1\n+\"@react-spring/types@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/types@npm:10.0.0\"\n+  checksum: 10c0/ce1b959eaa8964f4004481d1e7c6eca0a8d636eb9f35ca654bdf77a78a860c0ff9eaa6bdc0cab84fc8a16be5c5fbb22b114249a2721bfc16191666670c0f44b3\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/web@npm:^9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/web@npm:9.7.5\"\n+\"@react-spring/web@npm:^10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/web@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~9.7.5\"\n-    \"@react-spring/core\": \"npm:~9.7.5\"\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/animated\": \"npm:~10.0.0\"\n+    \"@react-spring/core\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/bcd1e052e1b16341a12a19bf4515f153ca09d1fa86ff7752a5d02d7c4db58e8baf80e6283e64411f1e388c65340dce2254b013083426806b5dbae38bd151e53e\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/2218c87d9bfafab78b3079d94ea89ab9b95cb174910be5682fd8f5fc73e326ca956e9b844e5b255d1e3402138ad26981fae2fc1091d682a78359044a63b6421e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -1,3 +1,5 @@\n+import { useMemo } from 'react';\n+\n import { FormattedMessage } from 'react-intl';\n \n import classNames from 'classnames';\n@@ -10,9 +12,11 @@ import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react'\n import { Icon } from 'mastodon/components/icon';\n import StatusContainer from 'mastodon/containers/status_container';\n import type { Status } from 'mastodon/models/status';\n+import type { RootState } from 'mastodon/store';\n import { useAppSelector } from 'mastodon/store';\n \n import QuoteIcon from '../../images/quote.svg?react';\n+import { makeGetStatus } from '../selectors';\n \n const MAX_QUOTE_POSTS_NESTING_LEVEL = 1;\n \n@@ -65,6 +69,10 @@ const QuoteLink: React.FC<{\n };\n \n type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n+type GetStatusSelector = (\n+  state: RootState,\n+  props: { id?: string | null; contextType?: string },\n+) => Status | null;\n \n export const QuotedStatus: React.FC<{\n   quote: QuoteMap;\n@@ -73,34 +81,50 @@ export const QuotedStatus: React.FC<{\n   nestingLevel?: number;\n }> = ({ quote, contextType, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n-  const state = quote.get('state');\n+  const quoteState = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n   let quoteError: React.ReactNode = null;\n \n-  if (state === 'deleted') {\n+  // In order to find out whether the quoted post should be completely hidden\n+  // due to a matching filter, we run it through the selector used by `status_container`.\n+  // If this returns null even though `status` exists, it's because it's filtered.\n+  const getStatus = useMemo(() => makeGetStatus(), []) as GetStatusSelector;\n+  const statusWithExtraData = useAppSelector((state) =>\n+    getStatus(state, { id: quotedStatusId, contextType }),\n+  );\n+  const isFilteredAndHidden = status && statusWithExtraData === null;\n+\n+  if (isFilteredAndHidden) {\n+    quoteError = (\n+      <FormattedMessage\n+        id='status.quote_error.filtered'\n+        defaultMessage='Hidden due to one of your filters'\n+      />\n+    );\n+  } else if (quoteState === 'deleted') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.removed'\n         defaultMessage='This post was removed by its author.'\n       />\n     );\n-  } else if (state === 'unauthorized') {\n+  } else if (quoteState === 'unauthorized') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.unauthorized'\n         defaultMessage='This post cannot be displayed as you are not authorized to view it.'\n       />\n     );\n-  } else if (state === 'pending') {\n+  } else if (quoteState === 'pending') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.pending_approval'\n         defaultMessage='This post is pending approval from the original author.'\n       />\n     );\n-  } else if (state === 'rejected' || state === 'revoked') {\n+  } else if (quoteState === 'rejected' || quoteState === 'revoked') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.rejected'\n---\napp/javascript/mastodon/locales/en.json\n@@ -864,6 +864,7 @@\n   \"status.mute_conversation\": \"Mute conversation\",\n   \"status.open\": \"Expand this post\",\n   \"status.pin\": \"Feature on profile\",\n+  \"status.quote_error.filtered\": \"Hidden due to one of your filters\",\n   \"status.quote_error.not_found\": \"This post cannot be displayed.\",\n   \"status.quote_error.pending_approval\": \"This post is pending approval from the original author.\",\n   \"status.quote_error.rejected\": \"This post cannot be displayed as the original author does not allow it to be quoted.\",\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/locales/en-GB.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Moderated servers\",\n   \"about.contact\": \"Contact:\",\n+  \"about.default_locale\": \"Default\",\n   \"about.disclaimer\": \"Mastodon is free, open-source software, and a trademark of Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Reason not available\",\n   \"about.domain_blocks.preamble\": \"Mastodon generally allows you to view content from and interact with users from any other server in the Fediverse. These are the exceptions that have been made on this particular server.\",\n   \"about.domain_blocks.silenced.explanation\": \"You will generally not see profiles and content from this server, unless you explicitly look it up or opt into it by following.\",\n   \"about.domain_blocks.silenced.title\": \"Limited\",\n   \"about.domain_blocks.suspended.explanation\": \"No data from this server will be processed, stored or exchanged, making any interaction or communication with users from this server impossible.\",\n   \"about.domain_blocks.suspended.title\": \"Suspended\",\n+  \"about.language_label\": \"Language\",\n   \"about.not_available\": \"This information has not been made available on this server.\",\n   \"about.powered_by\": \"Decentralised social media powered by {mastodon}\",\n   \"about.rules\": \"Server rules\",\n@@ -19,10 +21,12 @@\n   \"account.block_domain\": \"Block domain {domain}\",\n   \"account.block_short\": \"Block\",\n   \"account.blocked\": \"Blocked\",\n+  \"account.blocking\": \"Blocking\",\n   \"account.cancel_follow_request\": \"Cancel follow\",\n   \"account.copy\": \"Copy link to profile\",\n   \"account.direct\": \"Privately mention @{name}\",\n   \"account.disable_notifications\": \"Stop notifying me when @{name} posts\",\n+  \"account.domain_blocking\": \"Blocking domain\",\n   \"account.edit_profile\": \"Edit profile\",\n   \"account.enable_notifications\": \"Notify me when @{name} posts\",\n   \"account.endorse\": \"Feature on profile\",\n---\napp/javascript/mastodon/locales/pt-PT.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Servidores moderados\",\n   \"about.contact\": \"Contacto:\",\n+  \"about.default_locale\": \"Padr\u00e3o\",\n   \"about.disclaimer\": \"O Mastodon \u00e9 um software livre, de c\u00f3digo aberto e uma marca registada de Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Motivo n\u00e3o dispon\u00edvel\",\n   \"about.domain_blocks.preamble\": \"O Mastodon geralmente permite ver e interagir com o conte\u00fado de utilizadores de qualquer outra inst\u00e2ncia no fediverso. Estas s\u00e3o as exce\u00e7\u00f5es desta inst\u00e2ncia em espec\u00edfico.\",\n   \"about.domain_blocks.silenced.explanation\": \"Normalmente n\u00e3o ver\u00e1s perfis e conte\u00fados deste servidor, a n\u00e3o ser que os procures explicitamente ou optes por segui-los.\",\n   \"about.domain_blocks.silenced.title\": \"Limitados\",\n   \"about.domain_blocks.suspended.explanation\": \"Nenhum dado deste servidor ser\u00e1 processado, armazenado ou trocado, tornando imposs\u00edvel qualquer intera\u00e7\u00e3o ou comunica\u00e7\u00e3o com os utilizadores a partir deste servidor.\",\n   \"about.domain_blocks.suspended.title\": \"Suspensos\",\n+  \"about.language_label\": \"Idioma\",\n   \"about.not_available\": \"Esta informa\u00e7\u00e3o n\u00e3o foi disponibilizada neste servidor.\",\n   \"about.powered_by\": \"Rede social descentralizada baseada no {mastodon}\",\n   \"about.rules\": \"Regras do servidor\",\n@@ -308,6 +310,8 @@\n   \"emoji_button.search_results\": \"Resultados da pesquisa\",\n   \"emoji_button.symbols\": \"S\u00edmbolos\",\n   \"emoji_button.travel\": \"Viagens e lugares\",\n+  \"empty_column.account_featured.me\": \"Ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n+  \"empty_column.account_featured.other\": \"{acct} ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n   \"empty_column.account_featured_other.unknown\": \"Esta conta ainda n\u00e3o colocou nada em destaque.\",\n   \"empty_column.account_hides_collections\": \"Este utilizador escolheu n\u00e3o disponibilizar esta informa\u00e7\u00e3o\",\n   \"empty_column.account_suspended\": \"Conta suspensa\",\n@@ -341,6 +345,11 @@\n   \"explore.trending_links\": \"Not\u00edcias\",\n   \"explore.trending_statuses\": \"Publica\u00e7\u00f5es\",\n   \"explore.trending_tags\": \"#Etiquetas\",\n+  \"featured_carousel.header\": \"{count, plural, one {Publica\u00e7\u00e3o Afixada} other {Publica\u00e7\u00f5es Afixadas}}\",\n+  \"featured_carousel.next\": \"Seguinte\",\n+  \"featured_carousel.post\": \"Publica\u00e7\u00e3o\",\n+  \"featured_carousel.previous\": \"Anterior\",\n+  \"featured_carousel.slide\": \"{index} de {total}\",\n   \"filter_modal.added.context_mismatch_explanation\": \"Esta categoria de filtro n\u00e3o se aplica ao contexto em que acedeste a esta publica\u00e7\u00e3o. Se pretenderes que esta publica\u00e7\u00e3o seja filtrada tamb\u00e9m neste contexto, ter\u00e1s que editar o filtro.\",\n   \"filter_modal.added.context_mismatch_title\": \"O contexto n\u00e3o coincide!\",\n   \"filter_modal.added.expired_explanation\": \"Esta categoria de filtro expirou, tens de alterar a data de validade para que ele seja aplicado.\",\n---\n\n\n---\n\nChoice D:\npackage.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/mastodon\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.0\",\n+  \"packageManager\": \"yarn@4.9.1\",\n   \"engines\": {\n     \"node\": \">=18\"\n   },\n---\nstreaming/package.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/streaming\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.0\",\n+  \"packageManager\": \"yarn@4.9.1\",\n   \"engines\": {\n     \"node\": \">=18\"\n   },\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nI've converted https://github.com/mastodon/mastodon/pull/34867 to draft mode and have been experimenting with different things there to try to reduce the intermittent failures on the selenium/JS/system specs.\r\n\r\nIt's a little challenging to reliabily measure any changes because the failures are not consistent and the feedback loop is slow. However, \"increase the wait time even more\" seems to have helped a little bit ... and even if that's a false positive, it may be harmless to increase it even more? I tried some different values. This seems to be in the sweet spot of \"large enough to actually help some execution, but low enough that it does not make the whole thing comically long for real failures\".\r\n\r\nThis is extracted from that PR, and also follow-up on https://github.com/mastodon/mastodon/pull/34859\r\n\r\nChange here also to only do this in CI env, and preserve faster (legit) failures locally.\r\n\r\nThe other useful things in various versions of that PR (some since removed/replaced/etc) were things like: a) add a before hook which viewed the about page and using a long wait, assert something from the js-generated DOM to be sure we're in a js-loaded state, b) more `expect(page)` dotted throughout between other steps, c) remove selenium and use playwright instead.\r\n\r\nThat last step was by far most impactful in terms of failure-free CI runs. May open that as followup to this.\n\n---\n\nChoice A:\napp/javascript/styles/mastodon/admin.scss\n@@ -114,15 +114,14 @@ $content-width: 840px;\n \n       a {\n         font-size: 14px;\n-        display: block;\n+        display: flex;\n+        align-items: center;\n+        gap: 6px;\n         padding: 15px;\n         color: $darker-text-color;\n         text-decoration: none;\n         transition: all 200ms linear;\n         transition-property: color, background-color;\n-        white-space: nowrap;\n-        overflow: hidden;\n-        text-overflow: ellipsis;\n \n         &:hover {\n           color: $primary-text-color;\n---\n\n\n---\n\nChoice B:\nspec/support/capybara.rb\n@@ -30,9 +30,10 @@ def common_chrome_options\n \n Capybara.javascript_driver = :headless_chrome\n \n-# Some of the flaky tests seem to be caused by github runners being too slow for the\n-# default timeout of 2 seconds\n-Capybara.default_max_wait_time = 8\n+if ENV['CI'].present?\n+  # Reduce some intermittent failures from slow CI runner environment\n+  Capybara.default_max_wait_time = 60\n+end\n \n RSpec.configure do |config|\n   config.before(:each, type: :system) do\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/account_featured/components/empty_message.tsx\n@@ -1,6 +1,9 @@\n import { FormattedMessage } from 'react-intl';\n \n+import { useParams } from 'react-router';\n+\n import { LimitedAccountHint } from 'mastodon/features/account_timeline/components/limited_account_hint';\n+import { me } from 'mastodon/initial_state';\n \n interface EmptyMessageProps {\n   suspended: boolean;\n@@ -15,13 +18,21 @@ export const EmptyMessage: React.FC<EmptyMessageProps> = ({\n   hidden,\n   blockedBy,\n }) => {\n+  const { acct } = useParams<{ acct?: string }>();\n   if (!accountId) {\n     return null;\n   }\n \n   let message: React.ReactNode = null;\n \n-  if (suspended) {\n+  if (me === accountId) {\n+    message = (\n+      <FormattedMessage\n+        id='empty_column.account_featured.me'\n+        defaultMessage='You have not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?'\n+      />\n+    );\n+  } else if (suspended) {\n     message = (\n       <FormattedMessage\n         id='empty_column.account_suspended'\n@@ -37,11 +48,19 @@ export const EmptyMessage: React.FC<EmptyMessageProps> = ({\n         defaultMessage='Profile unavailable'\n       />\n     );\n+  } else if (acct) {\n+    message = (\n+      <FormattedMessage\n+        id='empty_column.account_featured.other'\n+        defaultMessage='{acct} has not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?'\n+        values={{ acct }}\n+      />\n+    );\n   } else {\n     message = (\n       <FormattedMessage\n-        id='empty_column.account_featured'\n-        defaultMessage='This list is empty'\n+        id='empty_column.account_featured_other.unknown'\n+        defaultMessage='This account has not featured anything yet.'\n       />\n     );\n   }\n---\napp/javascript/mastodon/locales/en.json\n@@ -300,7 +300,9 @@\n   \"emoji_button.search_results\": \"Search results\",\n   \"emoji_button.symbols\": \"Symbols\",\n   \"emoji_button.travel\": \"Travel & Places\",\n-  \"empty_column.account_featured\": \"This list is empty\",\n+  \"empty_column.account_featured.me\": \"You have not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?\",\n+  \"empty_column.account_featured.other\": \"{acct} has not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?\",\n+  \"empty_column.account_featured_other.unknown\": \"This account has not featured anything yet.\",\n   \"empty_column.account_hides_collections\": \"This user has chosen to not make this information available\",\n   \"empty_column.account_suspended\": \"Account suspended\",\n   \"empty_column.account_timeline\": \"No posts here!\",\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -94,7 +94,7 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1080.0)\n+    aws-partitions (1.1087.0)\n     aws-sdk-core (3.215.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n@@ -120,7 +120,7 @@ GEM\n       rack (>= 0.9.0)\n       rouge (>= 1.0.0)\n     bigdecimal (3.1.9)\n-    bindata (2.5.0)\n+    bindata (2.5.1)\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n@@ -227,7 +227,7 @@ GEM\n     fabrication (2.31.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n-    faraday (2.12.2)\n+    faraday (2.13.0)\n       faraday-net_http (>= 2.0, < 3.5)\n       json\n       logger\n@@ -239,7 +239,7 @@ GEM\n       net-http (>= 0.5.0)\n     fast_blank (1.0.1)\n     fastimage (2.4.0)\n-    ffi (1.17.1)\n+    ffi (1.17.2)\n     ffi-compiler (1.3.2)\n       ffi (>= 1.15.5)\n       rake\n@@ -426,7 +426,7 @@ GEM\n     mime-types (3.6.2)\n       logger\n       mime-types-data (~> 3.2015)\n-    mime-types-data (3.2025.0402)\n+    mime-types-data (3.2025.0408)\n     mini_mime (1.1.5)\n     mini_portile2 (2.8.8)\n     minitest (5.25.5)\n@@ -585,8 +585,8 @@ GEM\n     ostruct (0.6.1)\n     ox (2.14.22)\n       bigdecimal (>= 3.0)\n-    parallel (1.26.3)\n-    parser (3.3.7.4)\n+    parallel (1.27.0)\n+    parser (3.3.8.0)\n       ast (~> 2.4.1)\n       racc\n     parslet (2.0.0)\n@@ -751,7 +751,7 @@ GEM\n       rubocop-ast (>= 1.44.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.0)\n+    rubocop-ast (1.44.1)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n@@ -1085,4 +1085,4 @@ RUBY VERSION\n    ruby 3.4.1p0\n \n BUNDLED WITH\n-   2.6.7\n+   2.6.8\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nI'm not sure of a better alternate approach, so I think inline disable is the right solution here ... matches what we do elsewhere with similar strings, and matches what the simpleform component docs do re: `html_safe`, https://github.com/heartcombo/simple_form?tab=readme-ov-file#custom-components\n\n---\n\nChoice A:\n.rubocop_todo.yml\n@@ -27,10 +27,6 @@ Metrics/CyclomaticComplexity:\n Metrics/PerceivedComplexity:\n   Max: 27\n \n-Rails/OutputSafety:\n-  Exclude:\n-    - 'config/initializers/simple_form.rb'\n-\n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: AllowedVars.\n Style/FetchEnvVar:\n---\nconfig/initializers/simple_form.rb\n@@ -5,7 +5,7 @@\n module AppendComponent\n   def append(_wrapper_options = nil)\n     @append ||= begin\n-      options[:append].to_s.html_safe if options[:append].present?\n+      options[:append].to_s.html_safe if options[:append].present? # rubocop:disable Rails/OutputSafety\n     end\n   end\n end\n@@ -24,7 +24,7 @@ def recommended(_wrapper_options = nil)\n module WarningHintComponent\n   def warning_hint(_wrapper_options = nil)\n     @warning_hint ||= begin\n-      options[:warning_hint].to_s.html_safe if options[:warning_hint].present?\n+      options[:warning_hint].to_s.html_safe if options[:warning_hint].present? # rubocop:disable Rails/OutputSafety\n     end\n   end\n end\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -751,18 +751,18 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.8)\n+    rubocop (1.76.0)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n       parallel (~> 1.10)\n       parser (>= 3.3.0.2)\n       rainbow (>= 2.2.2, < 4.0)\n       regexp_parser (>= 2.9.3, < 3.0)\n-      rubocop-ast (>= 1.44.0, < 2.0)\n+      rubocop-ast (>= 1.45.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.1)\n+    rubocop-ast (1.45.0)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n---\n\n\n---\n\nChoice C:\napp/javascript/styles/mastodon/components.scss\n@@ -11053,6 +11053,8 @@ noscript {\n   &__slide {\n     flex: 0 0 auto;\n     flex-basis: 100%;\n+    width: 100%;\n+    overflow: hidden;\n   }\n \n   .status {\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -12473,10 +12473,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.5\":\n-  version: 2.8.5\n-  resolution: \"pg-connection-string@npm:2.8.5\"\n-  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n+\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.9.0\":\n+  version: 2.9.0\n+  resolution: \"pg-connection-string@npm:2.9.0\"\n+  checksum: 10c0/7145d00688200685a9d9931a7fc8d61c75f348608626aef88080ece956ceb4ff1cbdee29c3284e41b7a3345bab0e4f50f9edc256e270bfa3a563af4ea78bb490\n   languageName: node\n   linkType: hard\n \n@@ -12494,23 +12494,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.9.6\":\n-  version: 3.9.6\n-  resolution: \"pg-pool@npm:3.9.6\"\n+\"pg-pool@npm:^3.10.0\":\n+  version: 3.10.0\n+  resolution: \"pg-pool@npm:3.10.0\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/458d50a4e7260977f076472d40d0796fa8b513af7e3ce1bf65557e10724e9c13653661c883f6650dff92d0a1a5ff4e7a001a8262b786c1ad4cfbd35c3354353e\n+  checksum: 10c0/b36162dc98c0ad88cd26f3d65f3e3932c3f870abe7a88905f16fc98282e8131692903e482720ebc9698cb08851c9b19242ff16a50af7f9434c8bb0b5d33a9a9a\n   languageName: node\n   linkType: hard\n \n-\"pg-protocol@npm:*, pg-protocol@npm:^1.9.5\":\n-  version: 1.9.5\n-  resolution: \"pg-protocol@npm:1.9.5\"\n-  checksum: 10c0/5cb3444cf973adadd22ee9ea26bb1674f0d980ef8f9c66d426bbe67fc9cb5f0ca4a204bf7e432b3ab2ab59ac8227f4b18ab3b2e64eaed537e037e916991c7319\n+\"pg-protocol@npm:*, pg-protocol@npm:^1.10.0\":\n+  version: 1.10.0\n+  resolution: \"pg-protocol@npm:1.10.0\"\n+  checksum: 10c0/7d0d64fe9df50262d907fd476454e1e36f41f5f66044c3ba6aa773fb8add1d350a9c162306e5c33e99bdfbdcc1140dd4ca74f66eda41d0aaceb5853244dcdb65\n   languageName: node\n   linkType: hard\n \n-\"pg-types@npm:^2.1.0\":\n+\"pg-types@npm:2.2.0\":\n   version: 2.2.0\n   resolution: \"pg-types@npm:2.2.0\"\n   dependencies:\n@@ -12539,15 +12539,15 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.15.6\n-  resolution: \"pg@npm:8.15.6\"\n+  version: 8.16.0\n+  resolution: \"pg@npm:8.16.0\"\n   dependencies:\n     pg-cloudflare: \"npm:^1.2.5\"\n-    pg-connection-string: \"npm:^2.8.5\"\n-    pg-pool: \"npm:^3.9.6\"\n-    pg-protocol: \"npm:^1.9.5\"\n-    pg-types: \"npm:^2.1.0\"\n-    pgpass: \"npm:1.x\"\n+    pg-connection-string: \"npm:^2.9.0\"\n+    pg-pool: \"npm:^3.10.0\"\n+    pg-protocol: \"npm:^1.10.0\"\n+    pg-types: \"npm:2.2.0\"\n+    pgpass: \"npm:1.0.5\"\n   peerDependencies:\n     pg-native: \">=3.0.1\"\n   dependenciesMeta:\n@@ -12556,11 +12556,11 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/d4dc81020ebd137b6cf6228e43c643067acb8240079a07f7b9a7e97be0f33ad4d8c6f2a3f5b512ad87180e3d48e651fbd72885aa807ab58a715da8f3efea0fab\n+  checksum: 10c0/24542229c7e5cbf69d654de32e8cdc8302c73f1338e56728543cb16364fb319d5689e03fa704b69a208105c7065c867cfccb9dbccccea2020bb5c64ead785713\n   languageName: node\n   linkType: hard\n \n-\"pgpass@npm:1.x\":\n+\"pgpass@npm:1.0.5\":\n   version: 1.0.5\n   resolution: \"pgpass@npm:1.0.5\"\n   dependencies:\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis reverts commit a139dac18ec6e50b35a51f664fd5b02b0f9f1c47.\r\n\r\nSee rationale in https://github.com/mastodon/mastodon/pull/32289#issuecomment-2930741732, basically this commit dropped Mastodon's ability to read pre-4.3.0 cookies, making it likely for users to lose their sessions if admins only briefly run 4.3, and move to 4.4 afterwards.\n\n---\n\nChoice A:\napp/javascript/mastodon/features/account_featured/components/empty_message.tsx\n@@ -1,6 +1,9 @@\n import { FormattedMessage } from 'react-intl';\n \n+import { useParams } from 'react-router';\n+\n import { LimitedAccountHint } from 'mastodon/features/account_timeline/components/limited_account_hint';\n+import { me } from 'mastodon/initial_state';\n \n interface EmptyMessageProps {\n   suspended: boolean;\n@@ -15,13 +18,21 @@ export const EmptyMessage: React.FC<EmptyMessageProps> = ({\n   hidden,\n   blockedBy,\n }) => {\n+  const { acct } = useParams<{ acct?: string }>();\n   if (!accountId) {\n     return null;\n   }\n \n   let message: React.ReactNode = null;\n \n-  if (suspended) {\n+  if (me === accountId) {\n+    message = (\n+      <FormattedMessage\n+        id='empty_column.account_featured.me'\n+        defaultMessage='You have not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?'\n+      />\n+    );\n+  } else if (suspended) {\n     message = (\n       <FormattedMessage\n         id='empty_column.account_suspended'\n@@ -37,11 +48,19 @@ export const EmptyMessage: React.FC<EmptyMessageProps> = ({\n         defaultMessage='Profile unavailable'\n       />\n     );\n+  } else if (acct) {\n+    message = (\n+      <FormattedMessage\n+        id='empty_column.account_featured.other'\n+        defaultMessage='{acct} has not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?'\n+        values={{ acct }}\n+      />\n+    );\n   } else {\n     message = (\n       <FormattedMessage\n-        id='empty_column.account_featured'\n-        defaultMessage='This list is empty'\n+        id='empty_column.account_featured_other.unknown'\n+        defaultMessage='This account has not featured anything yet.'\n       />\n     );\n   }\n---\napp/javascript/mastodon/locales/en.json\n@@ -300,7 +300,9 @@\n   \"emoji_button.search_results\": \"Search results\",\n   \"emoji_button.symbols\": \"Symbols\",\n   \"emoji_button.travel\": \"Travel & Places\",\n-  \"empty_column.account_featured\": \"This list is empty\",\n+  \"empty_column.account_featured.me\": \"You have not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?\",\n+  \"empty_column.account_featured.other\": \"{acct} has not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?\",\n+  \"empty_column.account_featured_other.unknown\": \"This account has not featured anything yet.\",\n   \"empty_column.account_hides_collections\": \"This user has chosen to not make this information available\",\n   \"empty_column.account_suspended\": \"Account suspended\",\n   \"empty_column.account_timeline\": \"No posts here!\",\n---\n\n\n---\n\nChoice B:\nconfig/initializers/cookie_rotator.rb\n@@ -0,0 +1,23 @@\n+# frozen_string_literal: true\n+\n+# TODO: remove this file some time after 4.3.0\n+\n+Rails.application.config.after_initialize do\n+  Rails.application.config.action_dispatch.cookies_rotations.tap do |cookies|\n+    authenticated_encrypted_cookie_salt = Rails.application.config.action_dispatch.authenticated_encrypted_cookie_salt\n+    signed_cookie_salt = Rails.application.config.action_dispatch.signed_cookie_salt\n+\n+    secret_key_base = Rails.application.secret_key_base\n+\n+    key_generator = ActiveSupport::KeyGenerator.new(\n+      secret_key_base, iterations: 1000, hash_digest_class: OpenSSL::Digest::SHA1\n+    )\n+    key_len = ActiveSupport::MessageEncryptor.key_len\n+\n+    old_encrypted_secret = key_generator.generate_key(authenticated_encrypted_cookie_salt, key_len)\n+    old_signed_secret = key_generator.generate_key(signed_cookie_salt)\n+\n+    cookies.rotate :encrypted, old_encrypted_secret\n+    cookies.rotate :signed, old_signed_secret\n+  end\n+end\n---\n\n\n---\n\nChoice C:\nlib/premailer_bundled_asset_strategy.rb\n@@ -15,7 +15,9 @@ def load(url)\n         headers\n       ).presence\n     else\n-      path = Rails.public_path.join(url.delete_prefix('/'))\n+      url = url.delete_prefix(Rails.configuration.action_controller.asset_host) if Rails.configuration.action_controller.asset_host.present?\n+      url = url.delete_prefix('/')\n+      path = Rails.public_path.join(url)\n       return unless path.exist?\n \n       path.read\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -13307,12 +13307,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.9.5\":\n-  version: 3.9.5\n-  resolution: \"pg-pool@npm:3.9.5\"\n+\"pg-pool@npm:^3.9.6\":\n+  version: 3.9.6\n+  resolution: \"pg-pool@npm:3.9.6\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/ebb36b6a1fd753213263a2e0e73d06ffe9fc93907deceae484c7fe4b464f6e9c41a578eb096b4b6012beec94a5d6e0e47728dfc4425e06d283744aa7432365a4\n+  checksum: 10c0/458d50a4e7260977f076472d40d0796fa8b513af7e3ce1bf65557e10724e9c13653661c883f6650dff92d0a1a5ff4e7a001a8262b786c1ad4cfbd35c3354353e\n   languageName: node\n   linkType: hard\n \n@@ -13352,12 +13352,12 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.15.5\n-  resolution: \"pg@npm:8.15.5\"\n+  version: 8.15.6\n+  resolution: \"pg@npm:8.15.6\"\n   dependencies:\n     pg-cloudflare: \"npm:^1.2.5\"\n     pg-connection-string: \"npm:^2.8.5\"\n-    pg-pool: \"npm:^3.9.5\"\n+    pg-pool: \"npm:^3.9.6\"\n     pg-protocol: \"npm:^1.9.5\"\n     pg-types: \"npm:^2.1.0\"\n     pgpass: \"npm:1.x\"\n@@ -13369,7 +13369,7 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/4c118cd9bec37c8880b4489b9acbd10cf1eaa86a0a9024de2dac83f4ce5adedecc4cab54b66fa3bcb204aab7297c08d03617ae15499538939692b48651cc52d1\n+  checksum: 10c0/d4dc81020ebd137b6cf6228e43c643067acb8240079a07f7b9a7e97be0f33ad4d8c6f2a3f5b512ad87180e3d48e651fbd72885aa807ab58a715da8f3efea0fab\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nBackport the test part of #34887 to stable-4.3\n\n---\n\nChoice A:\napp/chewy/accounts_index.rb\n@@ -19,9 +19,16 @@ class AccountsIndex < Chewy::Index\n         type: 'stemmer',\n         language: 'possessive_english',\n       },\n+\n+      word_joiner: {\n+        type: 'shingle',\n+        output_unigrams: true,\n+        token_separator: '',\n+      },\n     },\n \n     analyzer: {\n+      # \"The FOOING's bar\" becomes \"foo bar\"\n       natural: {\n         tokenizer: 'standard',\n         filter: %w(\n@@ -35,11 +42,20 @@ class AccountsIndex < Chewy::Index\n         ),\n       },\n \n+      # \"FOO bar\" becomes \"foo bar\"\n       verbatim: {\n         tokenizer: 'standard',\n         filter: %w(lowercase asciifolding cjk_width),\n       },\n \n+      # \"Foo bar\" becomes \"foo bar foobar\"\n+      word_join_analyzer: {\n+        type: 'custom',\n+        tokenizer: 'standard',\n+        filter: %w(lowercase asciifolding cjk_width word_joiner),\n+      },\n+\n+      # \"Foo bar\" becomes \"f fo foo b ba bar\"\n       edge_ngram: {\n         tokenizer: 'edge_ngram',\n         filter: %w(lowercase asciifolding cjk_width),\n---\napp/services/account_search_service.rb\n@@ -128,11 +128,37 @@ class FullQueryBuilder < QueryBuilder\n \n     def core_query\n       {\n-        multi_match: {\n-          query: @query,\n-          type: 'best_fields',\n-          fields: %w(username^2 display_name^2 text text.*),\n-          operator: 'and',\n+        dis_max: {\n+          queries: [\n+            {\n+              match: {\n+                username: {\n+                  query: @query,\n+                  analyzer: 'word_join_analyzer',\n+                },\n+              },\n+            },\n+\n+            {\n+              match: {\n+                display_name: {\n+                  query: @query,\n+                  analyzer: 'word_join_analyzer',\n+                },\n+              },\n+            },\n+\n+            {\n+              multi_match: {\n+                query: @query,\n+                type: 'best_fields',\n+                fields: %w(text text.*),\n+                operator: 'and',\n+              },\n+            },\n+          ],\n+\n+          tie_breaker: 0.5,\n         },\n       }\n     end\n---\n\n\n---\n\nChoice B:\ndb/migrate/20250425134308_quote_ids_to_timestamp_ids.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class QuoteIdsToTimestampIds < ActiveRecord::Migration[8.0]\n+  def up\n+    # Set up the media_attachments.id column to use our timestamp-based IDs.\n+    safety_assured do\n+      execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT timestamp_id('quotes')\")\n+    end\n+\n+    # Make sure we have a sequence to use.\n+    Mastodon::Snowflake.ensure_id_sequences_exist\n+  end\n+\n+  def down\n+    execute('LOCK quotes')\n+    execute(\"SELECT setval('quotes_id_seq', (SELECT MAX(id) FROM quotes))\")\n+    execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT nextval('quotes_id_seq')\")\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_22_085303) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_25_134654) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -871,7 +871,7 @@\n     t.string \"url\"\n   end\n \n-  create_table \"quotes\", force: :cascade do |t|\n+  create_table \"quotes\", id: :bigint, default: -> { \"timestamp_id('quotes'::text)\" }, force: :cascade do |t|\n     t.bigint \"account_id\", null: false\n     t.bigint \"status_id\", null: false\n     t.bigint \"quoted_status_id\"\n---\n\n\n---\n\nChoice C:\n.github/workflows/test-ruby.yml\n@@ -143,7 +143,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick libpam-dev\n+          additional-system-dependencies: ffmpeg libpam-dev\n \n       - name: Load database schema\n         run: |\n@@ -173,8 +173,8 @@ jobs:\n         env:\n           CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}\n \n-  test-libvips:\n-    name: Libvips tests\n+  test-imagemagick:\n+    name: ImageMagick tests\n     runs-on: ubuntu-latest\n \n     needs:\n@@ -220,7 +220,7 @@ jobs:\n       CAS_ENABLED: true\n       BUNDLE_WITH: 'pam_authentication test'\n       GITHUB_RSPEC: ${{ matrix.ruby-version == '.ruby-version' && github.event.pull_request && 'true' }}\n-      MASTODON_USE_LIBVIPS: true\n+      MASTODON_USE_LIBVIPS: false\n \n     strategy:\n       fail-fast: false\n@@ -245,7 +245,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg libpam-dev\n+          additional-system-dependencies: ffmpeg imagemagick libpam-dev\n \n       - name: Load database schema\n         run: './bin/rails db:create db:schema:load db:seed'\n@@ -324,7 +324,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick\n+          additional-system-dependencies: ffmpeg\n \n       - name: Set up Javascript environment\n         uses: ./.github/actions/setup-javascript\n@@ -443,7 +443,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick\n+          additional-system-dependencies: ffmpeg\n \n       - name: Set up Javascript environment\n         uses: ./.github/actions/setup-javascript\n---\nconfig/application.rb\n@@ -95,7 +95,7 @@ class Application < Rails::Application\n       require 'mastodon/redis_configuration'\n       ::REDIS_CONFIGURATION = Mastodon::RedisConfiguration.new\n \n-      config.x.use_vips = ENV['MASTODON_USE_LIBVIPS'] == 'true'\n+      config.x.use_vips = ENV['MASTODON_USE_LIBVIPS'] != 'false'\n \n       if config.x.use_vips\n         require_relative '../lib/paperclip/vips_lazy_thumbnail'\n---\nconfig/initializers/deprecations.rb\n@@ -16,3 +16,9 @@\n \n   abort message\n end\n+\n+if ENV['MASTODON_USE_LIBVIPS'] == 'false'\n+  warn <<~MESSAGE\n+    WARNING: Mastodon support for ImageMagick is deprecated and will be removed in future versions. Please consider using libvips instead.\n+  MESSAGE\n+end\n---\n\n\n---\n\nChoice D:\nspec/lib/activitypub/activity/remove_spec.rb\n@@ -4,29 +4,60 @@\n \n RSpec.describe ActivityPub::Activity::Remove do\n   let(:sender) { Fabricate(:account, featured_collection_url: 'https://example.com/featured') }\n-  let(:status) { Fabricate(:status, account: sender) }\n-\n-  let(:json) do\n-    {\n-      '@context': 'https://www.w3.org/ns/activitystreams',\n-      id: 'foo',\n-      type: 'Add',\n-      actor: ActivityPub::TagManager.instance.uri_for(sender),\n-      object: ActivityPub::TagManager.instance.uri_for(status),\n-      target: sender.featured_collection_url,\n-    }.with_indifferent_access\n-  end\n \n   describe '#perform' do\n     subject { described_class.new(json, sender) }\n \n-    before do\n-      StatusPin.create!(account: sender, status: status)\n-      subject.perform\n+    context 'when removing a pinned status' do\n+      let(:status) { Fabricate(:status, account: sender) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: ActivityPub::TagManager.instance.uri_for(status),\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        StatusPin.create!(account: sender, status: status)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.pinned?(status) }.to(false)\n+      end\n     end\n \n-    it 'removes a pin' do\n-      expect(sender.pinned?(status)).to be false\n+    context 'when removing a featured tag' do\n+      let(:tag) { Fabricate(:tag) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: {\n+            type: 'Hashtag',\n+            name: \"##{tag.display_name}\",\n+            href: \"https://example.com/tags/#{tag.name}\",\n+          },\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        sender.featured_tags.find_or_create_by!(name: tag.name)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.featured_tags.exists?(tag: tag) }.to(false)\n+      end\n     end\n   end\n end\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34886\r\n\r\nThis was a regression from #34489, which we haven't caught due to the lack of tests.\n\n---\n\nChoice A:\nyarn.lock\n@@ -13307,12 +13307,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.9.5\":\n-  version: 3.9.5\n-  resolution: \"pg-pool@npm:3.9.5\"\n+\"pg-pool@npm:^3.9.6\":\n+  version: 3.9.6\n+  resolution: \"pg-pool@npm:3.9.6\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/ebb36b6a1fd753213263a2e0e73d06ffe9fc93907deceae484c7fe4b464f6e9c41a578eb096b4b6012beec94a5d6e0e47728dfc4425e06d283744aa7432365a4\n+  checksum: 10c0/458d50a4e7260977f076472d40d0796fa8b513af7e3ce1bf65557e10724e9c13653661c883f6650dff92d0a1a5ff4e7a001a8262b786c1ad4cfbd35c3354353e\n   languageName: node\n   linkType: hard\n \n@@ -13352,12 +13352,12 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.15.5\n-  resolution: \"pg@npm:8.15.5\"\n+  version: 8.15.6\n+  resolution: \"pg@npm:8.15.6\"\n   dependencies:\n     pg-cloudflare: \"npm:^1.2.5\"\n     pg-connection-string: \"npm:^2.8.5\"\n-    pg-pool: \"npm:^3.9.5\"\n+    pg-pool: \"npm:^3.9.6\"\n     pg-protocol: \"npm:^1.9.5\"\n     pg-types: \"npm:^2.1.0\"\n     pgpass: \"npm:1.x\"\n@@ -13369,7 +13369,7 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/4c118cd9bec37c8880b4489b9acbd10cf1eaa86a0a9024de2dac83f4ce5adedecc4cab54b66fa3bcb204aab7297c08d03617ae15499538939692b48651cc52d1\n+  checksum: 10c0/d4dc81020ebd137b6cf6228e43c643067acb8240079a07f7b9a7e97be0f33ad4d8c6f2a3f5b512ad87180e3d48e651fbd72885aa807ab58a715da8f3efea0fab\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/components/counters.tsx\n@@ -43,3 +43,17 @@ export const FollowersCounter = (\n     }}\n   />\n );\n+\n+export const FollowersYouKnowCounter = (\n+  displayNumber: React.ReactNode,\n+  pluralReady: number,\n+) => (\n+  <FormattedMessage\n+    id='account.followers_you_know_counter'\n+    defaultMessage='{counter} you know'\n+    values={{\n+      count: pluralReady,\n+      counter: <strong>{displayNumber}</strong>,\n+    }}\n+  />\n+);\n---\napp/javascript/mastodon/components/hover_card_account.tsx\n@@ -9,11 +9,16 @@ import { fetchAccount } from 'mastodon/actions/accounts';\n import { AccountBio } from 'mastodon/components/account_bio';\n import { AccountFields } from 'mastodon/components/account_fields';\n import { Avatar } from 'mastodon/components/avatar';\n-import { FollowersCounter } from 'mastodon/components/counters';\n+import { AvatarGroup } from 'mastodon/components/avatar_group';\n+import {\n+  FollowersCounter,\n+  FollowersYouKnowCounter,\n+} from 'mastodon/components/counters';\n import { DisplayName } from 'mastodon/components/display_name';\n import { FollowButton } from 'mastodon/components/follow_button';\n import { LoadingIndicator } from 'mastodon/components/loading_indicator';\n import { ShortNumber } from 'mastodon/components/short_number';\n+import { useFetchFamiliarFollowers } from 'mastodon/features/account_timeline/hooks/familiar_followers';\n import { domain } from 'mastodon/initial_state';\n import { useAppSelector, useAppDispatch } from 'mastodon/store';\n \n@@ -38,6 +43,8 @@ export const HoverCardAccount = forwardRef<\n     }\n   }, [dispatch, accountId, account]);\n \n+  const { familiarFollowers } = useFetchFamiliarFollowers({ accountId });\n+\n   return (\n     <div\n       ref={ref}\n@@ -73,11 +80,27 @@ export const HoverCardAccount = forwardRef<\n             )}\n           </div>\n \n-          <div className='hover-card__number'>\n+          <div className='hover-card__numbers'>\n             <ShortNumber\n               value={account.followers_count}\n               renderer={FollowersCounter}\n             />\n+            {familiarFollowers.length > 0 && (\n+              <>\n+                &middot;\n+                <div className='hover-card__familiar-followers'>\n+                  <ShortNumber\n+                    value={familiarFollowers.length}\n+                    renderer={FollowersYouKnowCounter}\n+                  />\n+                  <AvatarGroup compact>\n+                    {familiarFollowers.slice(0, 3).map((account) => (\n+                      <Avatar key={account.id} account={account} size={22} />\n+                    ))}\n+                  </AvatarGroup>\n+                </div>\n+              </>\n+            )}\n           </div>\n \n           <FollowButton accountId={accountId} />\n---\napp/javascript/mastodon/features/account_timeline/components/familiar_followers.tsx\n@@ -1,15 +1,12 @@\n-import { useEffect } from 'react';\n-\n import { FormattedMessage } from 'react-intl';\n \n import { Link } from 'react-router-dom';\n \n-import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n import { Avatar } from '@/mastodon/components/avatar';\n import { AvatarGroup } from '@/mastodon/components/avatar_group';\n import type { Account } from '@/mastodon/models/account';\n-import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n-import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n+\n+import { useFetchFamiliarFollowers } from '../hooks/familiar_followers';\n \n const AccountLink: React.FC<{ account?: Account }> = ({ account }) => {\n   if (!account) {\n@@ -64,20 +61,11 @@ const FamiliarFollowersReadout: React.FC<{ familiarFollowers: Account[] }> = ({\n export const FamiliarFollowers: React.FC<{ accountId: string }> = ({\n   accountId,\n }) => {\n-  const dispatch = useAppDispatch();\n-  const familiarFollowers = useAppSelector((state) =>\n-    getAccountFamiliarFollowers(state, accountId),\n-  );\n-\n-  const hasNoData = familiarFollowers === null;\n-\n-  useEffect(() => {\n-    if (hasNoData) {\n-      void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n-    }\n-  }, [dispatch, accountId, hasNoData]);\n+  const { familiarFollowers, isLoading } = useFetchFamiliarFollowers({\n+    accountId,\n+  });\n \n-  if (hasNoData || familiarFollowers.length === 0) {\n+  if (isLoading || familiarFollowers.length === 0) {\n     return null;\n   }\n \n---\napp/javascript/mastodon/features/account_timeline/hooks/familiar_followers.ts\n@@ -0,0 +1,30 @@\n+import { useEffect } from 'react';\n+\n+import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n+import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n+import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n+import { me } from 'mastodon/initial_state';\n+\n+export const useFetchFamiliarFollowers = ({\n+  accountId,\n+}: {\n+  accountId?: string;\n+}) => {\n+  const dispatch = useAppDispatch();\n+  const familiarFollowers = useAppSelector((state) =>\n+    accountId ? getAccountFamiliarFollowers(state, accountId) : null,\n+  );\n+\n+  const hasNoData = familiarFollowers === null;\n+\n+  useEffect(() => {\n+    if (hasNoData && accountId && accountId !== me) {\n+      void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n+    }\n+  }, [dispatch, accountId, hasNoData]);\n+\n+  return {\n+    familiarFollowers: hasNoData ? [] : familiarFollowers,\n+    isLoading: hasNoData,\n+  };\n+};\n---\napp/javascript/mastodon/locales/en.json\n@@ -42,6 +42,7 @@\n   \"account.followers\": \"Followers\",\n   \"account.followers.empty\": \"No one follows this user yet.\",\n   \"account.followers_counter\": \"{count, plural, one {{counter} follower} other {{counter} followers}}\",\n+  \"account.followers_you_know_counter\": \"{counter} you know\",\n   \"account.following\": \"Following\",\n   \"account.following_counter\": \"{count, plural, one {{counter} following} other {{counter} following}}\",\n   \"account.follows.empty\": \"This user doesn't follow anyone yet.\",\n---\napp/javascript/styles/mastodon/components.scss\n@@ -10705,7 +10705,15 @@ noscript {\n     color: inherit;\n   }\n \n-  &__number {\n+  &__numbers,\n+  &__familiar-followers {\n+    display: flex;\n+    align-items: center;\n+    flex-wrap: wrap;\n+    gap: 10px;\n+  }\n+\n+  &__numbers {\n     font-size: 15px;\n     line-height: 22px;\n     color: $secondary-text-color;\n---\n\n\n---\n\nChoice C:\napp/lib/activitypub/activity/create.rb\n@@ -226,8 +226,6 @@ def process_tags\n   end\n \n   def process_quote\n-    return unless Mastodon::Feature.inbound_quotes_enabled?\n-\n     @quote_uri = @status_parser.quote_uri\n     return if @quote_uri.blank?\n \n---\napp/lib/activitypub/activity/quote_request.rb\n@@ -4,7 +4,6 @@ class ActivityPub::Activity::QuoteRequest < ActivityPub::Activity\n   include Payloadable\n \n   def perform\n-    return unless Mastodon::Feature.inbound_quotes_enabled?\n     return if non_matching_uri_hosts?(@account.uri, @json['id'])\n \n     quoted_status = status_from_uri(object_uri)\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -271,8 +271,6 @@ def update_emojis!\n   end\n \n   def update_quote!\n-    return unless Mastodon::Feature.inbound_quotes_enabled?\n-\n     quote_uri = @status_parser.quote_uri\n \n     if quote_uri.present?\n---\nspec/lib/activitypub/activity/create_spec.rb\n@@ -887,7 +887,7 @@ def activity_for_object(json)\n         end\n       end\n \n-      context 'with an unverifiable quote of a known post', feature: :inbound_quotes do\n+      context 'with an unverifiable quote of a known post' do\n         let(:quoted_status) { Fabricate(:status) }\n \n         let(:object_json) do\n@@ -911,7 +911,7 @@ def activity_for_object(json)\n         end\n       end\n \n-      context 'with an unverifiable unknown post', feature: :inbound_quotes do\n+      context 'with an unverifiable unknown post' do\n         let(:unknown_post_uri) { 'https://unavailable.example.com/unavailable-post' }\n \n         let(:object_json) do\n@@ -939,7 +939,7 @@ def activity_for_object(json)\n         end\n       end\n \n-      context 'with a verifiable quote of a known post', feature: :inbound_quotes do\n+      context 'with a verifiable quote of a known post' do\n         let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n         let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n         let(:approval_uri) { 'https://quoted.example.com/quote-approval' }\n---\nspec/lib/activitypub/activity/quote_request_spec.rb\n@@ -2,7 +2,7 @@\n \n require 'rails_helper'\n \n-RSpec.describe ActivityPub::Activity::QuoteRequest, feature: :inbound_quotes do\n+RSpec.describe ActivityPub::Activity::QuoteRequest do\n   let(:sender)    { Fabricate(:account, domain: 'example.com') }\n   let(:recipient) { Fabricate(:account) }\n   let(:quoted_post) { Fabricate(:status, account: recipient) }\n---\nspec/services/activitypub/process_status_update_service_spec.rb\n@@ -435,7 +435,7 @@\n     end\n   end\n \n-  context 'when the status has an existing unverified quote and adds an approval link', feature: :inbound_quotes do\n+  context 'when the status has an existing unverified quote and adds an approval link' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: nil) }\n@@ -500,7 +500,7 @@\n     end\n   end\n \n-  context 'when the status has an existing verified quote and removes an approval link', feature: :inbound_quotes do\n+  context 'when the status has an existing verified quote and removes an approval link' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: approval_uri, state: :accepted) }\n@@ -535,7 +535,7 @@\n     end\n   end\n \n-  context 'when the status adds a verifiable quote', feature: :inbound_quotes do\n+  context 'when the status adds a verifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let(:approval_uri) { 'https://quoted.example.com/approvals/1' }\n@@ -600,7 +600,7 @@\n     end\n   end\n \n-  context 'when the status adds a unverifiable quote', feature: :inbound_quotes do\n+  context 'when the status adds a unverifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let(:approval_uri) { 'https://quoted.example.com/approvals/1' }\n@@ -635,7 +635,7 @@\n     end\n   end\n \n-  context 'when the status removes a verified quote', feature: :inbound_quotes do\n+  context 'when the status removes a verified quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: approval_uri, state: :accepted) }\n@@ -660,7 +660,7 @@\n     end\n   end\n \n-  context 'when the status removes an unverified quote', feature: :inbound_quotes do\n+  context 'when the status removes an unverified quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: nil, state: :pending) }\n@@ -684,7 +684,7 @@\n     end\n   end\n \n-  context 'when the status swaps a verified quote with an unverifiable quote', feature: :inbound_quotes do\n+  context 'when the status swaps a verified quote with an unverifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let(:second_quoted_status) { Fabricate(:status, account: quoted_account) }\n@@ -752,7 +752,7 @@\n     end\n   end\n \n-  context 'when the status swaps a verified quote with another verifiable quote', feature: :inbound_quotes do\n+  context 'when the status swaps a verified quote with another verifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:second_quoted_account) { Fabricate(:account, domain: 'second-quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n---\n\n\n---\n\nChoice D:\napp/models/featured_tag.rb\n@@ -26,6 +26,8 @@ class FeaturedTag < ApplicationRecord\n \n   normalizes :name, with: ->(name) { name.strip.delete_prefix('#') }\n \n+  scope :by_name, ->(name) { joins(:tag).where(tag: { name: HashtagNormalizer.new.normalize(name) }) }\n+\n   before_validation :set_tag\n \n   before_create :reset_data\n---\nspec/lib/activitypub/activity/remove_spec.rb\n@@ -4,29 +4,60 @@\n \n RSpec.describe ActivityPub::Activity::Remove do\n   let(:sender) { Fabricate(:account, featured_collection_url: 'https://example.com/featured') }\n-  let(:status) { Fabricate(:status, account: sender) }\n-\n-  let(:json) do\n-    {\n-      '@context': 'https://www.w3.org/ns/activitystreams',\n-      id: 'foo',\n-      type: 'Add',\n-      actor: ActivityPub::TagManager.instance.uri_for(sender),\n-      object: ActivityPub::TagManager.instance.uri_for(status),\n-      target: sender.featured_collection_url,\n-    }.with_indifferent_access\n-  end\n \n   describe '#perform' do\n     subject { described_class.new(json, sender) }\n \n-    before do\n-      StatusPin.create!(account: sender, status: status)\n-      subject.perform\n+    context 'when removing a pinned status' do\n+      let(:status) { Fabricate(:status, account: sender) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: ActivityPub::TagManager.instance.uri_for(status),\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        StatusPin.create!(account: sender, status: status)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.pinned?(status) }.to(false)\n+      end\n     end\n \n-    it 'removes a pin' do\n-      expect(sender.pinned?(status)).to be false\n+    context 'when removing a featured tag' do\n+      let(:tag) { Fabricate(:tag) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: {\n+            type: 'Hashtag',\n+            name: \"##{tag.display_name}\",\n+            href: \"https://example.com/tags/#{tag.name}\",\n+          },\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        sender.featured_tags.find_or_create_by!(tag: tag)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.featured_tags.exists?(tag: tag) }.to(false)\n+      end\n     end\n   end\n end\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [linzer](https://redirect.github.com/nomadium/linzer) ([changelog](https://redirect.github.com/nomadium/linzer/blob/master/CHANGELOG.md)) | `0.7.2` -> `0.7.3` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/linzer/0.7.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/linzer/0.7.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/linzer/0.7.2/0.7.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/linzer/0.7.2/0.7.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>nomadium/linzer (linzer)</summary>\n\n### [`v0.7.3`](https://redirect.github.com/nomadium/linzer/blob/HEAD/CHANGELOG.md#073---2025-06-01)\n\n[Compare Source](https://redirect.github.com/nomadium/linzer/compare/v0.7.2...v0.7.3)\n\n-   Fix broken retrieval of header names from Rack responses.\n    Previously, this caused signatures attached to Rack response instances\n    to use incorrect header names, making them unverifiable.\n\n-   Add Linzer.signature_base method.\n\n-   Add initial support for JWS algorithms. See Linzer::JWS module for more details.\n    In this initial preview, only EdDSA algorithm ([`Ed25519`](https://redirect.github.com/nomadium/linzer/commit/Ed25519)) is supported).\n\n-   Add a simple integration test to verify signatures on HTTP responses.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4zMy42IiwidXBkYXRlZEluVmVyIjoiNDAuMzMuNiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\napp/helpers/context_helper.rb\n@@ -26,6 +26,13 @@ module ContextHelper\n     suspended: { 'toot' => 'http://joinmastodon.org/ns#', 'suspended' => 'toot:suspended' },\n     attribution_domains: { 'toot' => 'http://joinmastodon.org/ns#', 'attributionDomains' => { '@id' => 'toot:attributionDomains', '@type' => '@id' } },\n     quote_requests: { 'QuoteRequest' => 'https://w3id.org/fep/044f#QuoteRequest' },\n+    interaction_policies: {\n+      'gts' => 'https://gotosocial.org/ns#',\n+      'interactionPolicy' => { '@id' => 'gts:interactionPolicy', '@type' => '@id' },\n+      'canQuote' => { '@id' => 'gts:canQuote', '@type' => '@id' },\n+      'automaticApproval' => { '@id' => 'gts:automaticApproval', '@type' => '@id' },\n+      'manualApproval' => { '@id' => 'gts:manualApproval', '@type' => '@id' },\n+    },\n   }.freeze\n \n   def full_context\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -397,7 +397,7 @@ GEM\n       rexml\n     link_header (0.0.8)\n     lint_roller (1.1.0)\n-    linzer (0.7.2)\n+    linzer (0.7.3)\n       cgi (~> 0.4.2)\n       forwardable (~> 1.3, >= 1.3.3)\n       logger (~> 1.7, >= 1.7.0)\n---\n\n\n---\n\nChoice C:\napp/javascript/images/logo-symbol-icon.svg\n@@ -1,2 +1,2 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"79\" height=\"79\" viewBox=\"0 0 79 75\"><symbol id=\"logo-symbol-icon\"><path d=\"M74.7135 16.6043C73.6199 8.54587 66.5351 2.19527 58.1366 0.964691C56.7196 0.756754 51.351 0 38.9148 0H38.822C26.3824 0 23.7135 0.756754 22.2966 0.964691C14.1319 2.16118 6.67571 7.86752 4.86669 16.0214C3.99657 20.0369 3.90371 24.4888 4.06535 28.5726C4.29578 34.4289 4.34049 40.275 4.877 46.1075C5.24791 49.9817 5.89495 53.8251 6.81328 57.6088C8.53288 64.5968 15.4938 70.4122 22.3138 72.7848C29.6155 75.259 37.468 75.6697 44.9919 73.971C45.8196 73.7801 46.6381 73.5586 47.4475 73.3063C49.2737 72.7302 51.4164 72.086 52.9915 70.9542C53.0131 70.9384 53.0308 70.9178 53.0433 70.8942C53.0558 70.8706 53.0628 70.8445 53.0637 70.8179V65.1661C53.0634 65.1412 53.0574 65.1167 53.0462 65.0944C53.035 65.0721 53.0189 65.0525 52.9992 65.0371C52.9794 65.0218 52.9564 65.011 52.9318 65.0056C52.9073 65.0002 52.8819 65.0003 52.8574 65.0059C48.0369 66.1472 43.0971 66.7193 38.141 66.7103C29.6118 66.7103 27.3178 62.6981 26.6609 61.0278C26.1329 59.5842 25.7976 58.0784 25.6636 56.5486C25.6622 56.5229 25.667 56.4973 25.6775 56.4738C25.688 56.4502 25.7039 56.4295 25.724 56.4132C25.7441 56.397 25.7678 56.3856 25.7931 56.3801C25.8185 56.3746 25.8448 56.3751 25.8699 56.3816C30.6101 57.5151 35.4693 58.0873 40.3455 58.086C41.5183 58.086 42.6876 58.086 43.8604 58.0553C48.7647 57.919 53.9339 57.6701 58.7591 56.7361C58.8794 56.7123 58.9998 56.6918 59.103 56.6611C66.7139 55.2124 73.9569 50.665 74.6929 39.1501C74.7204 38.6967 74.7892 34.4016 74.7892 33.9312C74.7926 32.3325 75.3085 22.5901 74.7135 16.6043ZM62.9996 45.3371H54.9966V25.9069C54.9966 21.8163 53.277 19.7302 49.7793 19.7302C45.9343 19.7302 44.0083 22.1981 44.0083 27.0727V37.7082H36.0534V27.0727C36.0534 22.1981 34.124 19.7302 30.279 19.7302C26.8019 19.7302 25.0651 21.8163 25.0617 25.9069V45.3371H17.0656V25.3172C17.0656 21.2266 18.1191 17.9769 20.2262 15.568C22.3998 13.1648 25.2509 11.9308 28.7898 11.9308C32.8859 11.9308 35.9812 13.492 38.0447 16.6111L40.036 19.9245L42.0308 16.6111C44.0943 13.492 47.1896 11.9308 51.2788 11.9308C54.8143 11.9308 57.6654 13.1648 59.8459 15.568C61.9529 17.9746 63.0065 21.2243 63.0065 25.3172L62.9996 45.3371Z\" fill=\"currentColor\"/></symbol><use xlink:href=\"#logo-symbol-icon\"/></svg>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"79\" height=\"79\" viewBox=\"0 0 79 75\"><symbol id=\"logo-symbol-icon\"><path d=\"M63 45.3v-20c0-4.1-1-7.3-3.2-9.7-2.1-2.4-5-3.7-8.5-3.7-4.1 0-7.2 1.6-9.3 4.7l-2 3.3-2-3.3c-2-3.1-5.1-4.7-9.2-4.7-3.5 0-6.4 1.3-8.6 3.7-2.1 2.4-3.1 5.6-3.1 9.7v20h8V25.9c0-4.1 1.7-6.2 5.2-6.2 3.8 0 5.8 2.5 5.8 7.4V37.7H44V27.1c0-4.9 1.9-7.4 5.8-7.4 3.5 0 5.2 2.1 5.2 6.2V45.3h8ZM74.7 16.6c.6 6 .1 15.7.1 17.3 0 .5-.1 4.8-.1 5.3-.7 11.5-8 16-15.6 17.5-.1 0-.2 0-.3 0-4.9 1-10 1.2-14.9 1.4-1.2 0-2.4 0-3.6 0-4.8 0-9.7-.6-14.4-1.7-.1 0-.1 0-.1 0s-.1 0-.1 0 0 .1 0 .1 0 0 0 0c.1 1.6.4 3.1 1 4.5.6 1.7 2.9 5.7 11.4 5.7 5 0 9.9-.6 14.8-1.7 0 0 0 0 0 0 .1 0 .1 0 .1 0 0 .1 0 .1 0 .1.1 0 .1 0 .1.1v5.6s0 .1-.1.1c0 0 0 0 0 .1-1.6 1.1-3.7 1.7-5.6 2.3-.8.3-1.6.5-2.4.7-7.5 1.7-15.4 1.3-22.7-1.2-6.8-2.4-13.8-8.2-15.5-15.2-.9-3.8-1.6-7.6-1.9-11.5-.6-5.8-.6-11.7-.8-17.5C3.9 24.5 4 20 4.9 16 6.7 7.9 14.1 2.2 22.3 1c1.4-.2 4.1-1 16.5-1h.1C51.4 0 56.7.8 58.1 1c8.4 1.2 15.5 7.5 16.6 15.6Z\" fill=\"currentColor\"/></symbol><use xlink:href=\"#logo-symbol-icon\"/></svg>\n \n---\napp/serializers/oembed_serializer.rb\n@@ -75,7 +75,7 @@ def html\n     <<~HTML.squish\n       <blockquote class=\"mastodon-embed\" data-embed-url=\"#{embed_short_account_status_url(object.account, object)}\" style=\"#{INLINE_STYLES[:blockquote]}\">\n         <a href=\"#{short_account_status_url(object.account, object)}\" target=\"_blank\" style=\"#{INLINE_STYLES[:status_link]}\">\n-          <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"32\" height=\"32\" viewBox=\"0 0 79 75\"><path d=\"M74.7135 16.6043C73.6199 8.54587 66.5351 2.19527 58.1366 0.964691C56.7196 0.756754 51.351 0 38.9148 0H38.822C26.3824 0 23.7135 0.756754 22.2966 0.964691C14.1319 2.16118 6.67571 7.86752 4.86669 16.0214C3.99657 20.0369 3.90371 24.4888 4.06535 28.5726C4.29578 34.4289 4.34049 40.275 4.877 46.1075C5.24791 49.9817 5.89495 53.8251 6.81328 57.6088C8.53288 64.5968 15.4938 70.4122 22.3138 72.7848C29.6155 75.259 37.468 75.6697 44.9919 73.971C45.8196 73.7801 46.6381 73.5586 47.4475 73.3063C49.2737 72.7302 51.4164 72.086 52.9915 70.9542C53.0131 70.9384 53.0308 70.9178 53.0433 70.8942C53.0558 70.8706 53.0628 70.8445 53.0637 70.8179V65.1661C53.0634 65.1412 53.0574 65.1167 53.0462 65.0944C53.035 65.0721 53.0189 65.0525 52.9992 65.0371C52.9794 65.0218 52.9564 65.011 52.9318 65.0056C52.9073 65.0002 52.8819 65.0003 52.8574 65.0059C48.0369 66.1472 43.0971 66.7193 38.141 66.7103C29.6118 66.7103 27.3178 62.6981 26.6609 61.0278C26.1329 59.5842 25.7976 58.0784 25.6636 56.5486C25.6622 56.5229 25.667 56.4973 25.6775 56.4738C25.688 56.4502 25.7039 56.4295 25.724 56.4132C25.7441 56.397 25.7678 56.3856 25.7931 56.3801C25.8185 56.3746 25.8448 56.3751 25.8699 56.3816C30.6101 57.5151 35.4693 58.0873 40.3455 58.086C41.5183 58.086 42.6876 58.086 43.8604 58.0553C48.7647 57.919 53.9339 57.6701 58.7591 56.7361C58.8794 56.7123 58.9998 56.6918 59.103 56.6611C66.7139 55.2124 73.9569 50.665 74.6929 39.1501C74.7204 38.6967 74.7892 34.4016 74.7892 33.9312C74.7926 32.3325 75.3085 22.5901 74.7135 16.6043ZM62.9996 45.3371H54.9966V25.9069C54.9966 21.8163 53.277 19.7302 49.7793 19.7302C45.9343 19.7302 44.0083 22.1981 44.0083 27.0727V37.7082H36.0534V27.0727C36.0534 22.1981 34.124 19.7302 30.279 19.7302C26.8019 19.7302 25.0651 21.8163 25.0617 25.9069V45.3371H17.0656V25.3172C17.0656 21.2266 18.1191 17.9769 20.2262 15.568C22.3998 13.1648 25.2509 11.9308 28.7898 11.9308C32.8859 11.9308 35.9812 13.492 38.0447 16.6111L40.036 19.9245L42.0308 16.6111C44.0943 13.492 47.1896 11.9308 51.2788 11.9308C54.8143 11.9308 57.6654 13.1648 59.8459 15.568C61.9529 17.9746 63.0065 21.2243 63.0065 25.3172L62.9996 45.3371Z\" fill=\"currentColor\"/></svg>\n+          <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"32\" height=\"32\" viewBox=\"0 0 79 75\"><path d=\"M63 45.3v-20c0-4.1-1-7.3-3.2-9.7-2.1-2.4-5-3.7-8.5-3.7-4.1 0-7.2 1.6-9.3 4.7l-2 3.3-2-3.3c-2-3.1-5.1-4.7-9.2-4.7-3.5 0-6.4 1.3-8.6 3.7-2.1 2.4-3.1 5.6-3.1 9.7v20h8V25.9c0-4.1 1.7-6.2 5.2-6.2 3.8 0 5.8 2.5 5.8 7.4V37.7H44V27.1c0-4.9 1.9-7.4 5.8-7.4 3.5 0 5.2 2.1 5.2 6.2V45.3h8ZM74.7 16.6c.6 6 .1 15.7.1 17.3 0 .5-.1 4.8-.1 5.3-.7 11.5-8 16-15.6 17.5-.1 0-.2 0-.3 0-4.9 1-10 1.2-14.9 1.4-1.2 0-2.4 0-3.6 0-4.8 0-9.7-.6-14.4-1.7-.1 0-.1 0-.1 0s-.1 0-.1 0 0 .1 0 .1 0 0 0 0c.1 1.6.4 3.1 1 4.5.6 1.7 2.9 5.7 11.4 5.7 5 0 9.9-.6 14.8-1.7 0 0 0 0 0 0 .1 0 .1 0 .1 0 0 .1 0 .1 0 .1.1 0 .1 0 .1.1v5.6s0 .1-.1.1c0 0 0 0 0 .1-1.6 1.1-3.7 1.7-5.6 2.3-.8.3-1.6.5-2.4.7-7.5 1.7-15.4 1.3-22.7-1.2-6.8-2.4-13.8-8.2-15.5-15.2-.9-3.8-1.6-7.6-1.9-11.5-.6-5.8-.6-11.7-.8-17.5C3.9 24.5 4 20 4.9 16 6.7 7.9 14.1 2.2 22.3 1c1.4-.2 4.1-1 16.5-1h.1C51.4 0 56.7.8 58.1 1c8.4 1.2 15.5 7.5 16.6 15.6Z\" fill=\"currentColor\"/></svg>\n           <div style=\"#{INLINE_STYLES[:div_account]}\">Post by @#{object.account.pretty_acct}@#{provider_name}</div>\n           <div style=\"#{INLINE_STYLES[:div_view]}\">View on Mastodon</div>\n         </a>\n---\n\n\n---\n\nChoice D:\nstreaming/database.js\n@@ -1,5 +1,5 @@\n import pg from 'pg';\n-import pgConnectionString from 'pg-connection-string';\n+import { parse } from 'pg-connection-string';\n \n import { parseIntFromEnvValue } from './utils.js';\n \n@@ -16,15 +16,19 @@ export function configFromEnv(env, environment) {\n       password: env.DB_PASS || pg.defaults.password,\n       database: env.DB_NAME || 'mastodon_development',\n       host: env.DB_HOST || pg.defaults.host,\n-      port: parseIntFromEnvValue(env.DB_PORT, pg.defaults.port ?? 5432, 'DB_PORT')\n+      port: parseIntFromEnvValue(\n+        env.DB_PORT,\n+        pg.defaults.port ?? 5432,\n+        'DB_PORT',\n+      ),\n     },\n \n     production: {\n       user: env.DB_USER || 'mastodon',\n       password: env.DB_PASS || '',\n       database: env.DB_NAME || 'mastodon_production',\n       host: env.DB_HOST || 'localhost',\n-      port: parseIntFromEnvValue(env.DB_PORT, 5432, 'DB_PORT')\n+      port: parseIntFromEnvValue(env.DB_PORT, 5432, 'DB_PORT'),\n     },\n   };\n \n@@ -34,7 +38,7 @@ export function configFromEnv(env, environment) {\n   let baseConfig = {};\n \n   if (env.DATABASE_URL) {\n-    const parsedUrl = pgConnectionString.parse(env.DATABASE_URL);\n+    const parsedUrl = parse(env.DATABASE_URL);\n \n     // The result of dbUrlToConfig from pg-connection-string is not type\n     // compatible with pg.PoolConfig, since parts of the connection URL may be\n@@ -46,25 +50,34 @@ export function configFromEnv(env, environment) {\n     // https://github.com/brianc/node-postgres/issues/2280\n     //\n     // FIXME: clean up once brianc/node-postgres#3128 lands\n-    if (typeof parsedUrl.password === 'string') baseConfig.password = parsedUrl.password;\n+    if (typeof parsedUrl.password === 'string')\n+      baseConfig.password = parsedUrl.password;\n     if (typeof parsedUrl.host === 'string') baseConfig.host = parsedUrl.host;\n     if (typeof parsedUrl.user === 'string') baseConfig.user = parsedUrl.user;\n     if (typeof parsedUrl.port === 'string' && parsedUrl.port) {\n       const parsedPort = parseInt(parsedUrl.port, 10);\n       if (isNaN(parsedPort)) {\n-        throw new Error('Invalid port specified in DATABASE_URL environment variable');\n+        throw new Error(\n+          'Invalid port specified in DATABASE_URL environment variable',\n+        );\n       }\n       baseConfig.port = parsedPort;\n     }\n-    if (typeof parsedUrl.database === 'string') baseConfig.database = parsedUrl.database;\n-    if (typeof parsedUrl.options === 'string') baseConfig.options = parsedUrl.options;\n+    if (typeof parsedUrl.database === 'string')\n+      baseConfig.database = parsedUrl.database;\n+    if (typeof parsedUrl.options === 'string')\n+      baseConfig.options = parsedUrl.options;\n \n     // The pg-connection-string type definition isn't correct, as parsedUrl.ssl\n     // can absolutely be an Object, this is to work around these incorrect\n     // types, including the casting of parsedUrl.ssl to Record<string, any>\n     if (typeof parsedUrl.ssl === 'boolean') {\n       baseConfig.ssl = parsedUrl.ssl;\n-    } else if (typeof parsedUrl.ssl === 'object' && !Array.isArray(parsedUrl.ssl) && parsedUrl.ssl !== null) {\n+    } else if (\n+      typeof parsedUrl.ssl === 'object' &&\n+      !Array.isArray(parsedUrl.ssl) &&\n+      parsedUrl.ssl !== null\n+    ) {\n       /** @type {Record<string, any>} */\n       const sslOptions = parsedUrl.ssl;\n       baseConfig.ssl = {};\n@@ -83,17 +96,17 @@ export function configFromEnv(env, environment) {\n     baseConfig = pgConfigs[environment];\n \n     if (env.DB_SSLMODE) {\n-      switch(env.DB_SSLMODE) {\n-      case 'disable':\n-      case '':\n-        baseConfig.ssl = false;\n-        break;\n-      case 'no-verify':\n-        baseConfig.ssl = { rejectUnauthorized: false };\n-        break;\n-      default:\n-        baseConfig.ssl = {};\n-        break;\n+      switch (env.DB_SSLMODE) {\n+        case 'disable':\n+        case '':\n+          baseConfig.ssl = false;\n+          break;\n+        case 'no-verify':\n+          baseConfig.ssl = { rejectUnauthorized: false };\n+          break;\n+        default:\n+          baseConfig.ssl = {};\n+          break;\n       }\n     }\n   } else {\n@@ -134,16 +147,23 @@ export function getPool(config, environment, logger) {\n       return async (queryTextOrConfig, values, ...rest) => {\n         const start = process.hrtime();\n \n-        const result = await originalQuery.apply(pool, [queryTextOrConfig, values, ...rest]);\n+        const result = await originalQuery.apply(pool, [\n+          queryTextOrConfig,\n+          values,\n+          ...rest,\n+        ]);\n \n         const duration = process.hrtime(start);\n         const durationInMs = (duration[0] * 1000000000 + duration[1]) / 1000000;\n \n-        logger.debug({\n-          query: queryTextOrConfig,\n-          values,\n-          duration: durationInMs\n-        }, 'Executed database query');\n+        logger.debug(\n+          {\n+            query: queryTextOrConfig,\n+            values,\n+            duration: durationInMs,\n+          },\n+          'Executed database query',\n+        );\n \n         return result;\n       };\n---\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.7.0\":\n-  version: 2.7.0\n-  resolution: \"pg-connection-string@npm:2.7.0\"\n-  checksum: 10c0/50a1496a1c858f9495d78a2c7a66d93ef3602e718aff2953bb5738f3ea616d7f727f32fc20513c9bed127650cd14c1ddc7b458396f4000e689d4b64c65c5c51e\n+  version: 2.8.0\n+  resolution: \"pg-connection-string@npm:2.8.0\"\n+  checksum: 10c0/5600e3992ddacaa1022e4260a7bb8f24cc187cec1fc5d1526a274a4edc8db8b446f2a9c7f552c6f71f2dc7b3b391ceedebfef93de26b4943b6a26dfaecdd5bbc\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [csv](https://redirect.github.com/ruby/csv) ([changelog](https://redirect.github.com/ruby/csv/releases/tag/v3.3.5)) | `3.3.4` -> `3.3.5` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/csv/3.3.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/csv/3.3.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/csv/3.3.4/3.3.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/csv/3.3.4/3.3.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>ruby/csv (csv)</summary>\n\n### [`v3.3.5`](https://redirect.github.com/ruby/csv/releases/tag/v3.3.5): csv 3.3.5 - 2025-06-01\n\n[Compare Source](https://redirect.github.com/ruby/csv/compare/v3.3.4...v3.3.5)\n\n##### Improvements\n\n-   docs: Fixed `StringScanner` document URL.\n    -   [GH-343](https://redirect.github.com/ruby/csv/issues/343)\n    -   Patch by Petrik de Heus\n\n##### Thanks\n\n-   Petrik de Heus\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4zMy42IiwidXBkYXRlZEluVmVyIjoiNDAuMzMuNiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\napp/javascript/mastodon/features/video/index.tsx\n@@ -346,8 +346,10 @@ export const Video: React.FC<{\n     const updateProgress = () => {\n       nextFrame = requestAnimationFrame(() => {\n         if (videoRef.current) {\n+          const progress =\n+            videoRef.current.currentTime / videoRef.current.duration;\n           void api.start({\n-            progress: `${(videoRef.current.currentTime / videoRef.current.duration) * 100}%`,\n+            progress: isNaN(progress) ? '0%' : `${progress * 100}%`,\n             immediate: reduceMotion,\n             config: config.stiff,\n           });\n---\n\n\n---\n\nChoice B:\n.rubocop/naming.yml\n@@ -1,3 +1,6 @@\n ---\n Naming/BlockForwarding:\n   EnforcedStyle: explicit\n+\n+Naming/PredicateMethod:\n+  Enabled: false\n---\n.rubocop_todo.yml\n@@ -1,6 +1,6 @@\n # This configuration was generated by\n # `rubocop --auto-gen-config --auto-gen-only-exclude --no-offense-counts --no-auto-gen-timestamp`\n-# using RuboCop version 1.75.8.\n+# using RuboCop version 1.76.0.\n # The point is for the user to remove these configuration records\n # one by one as the offenses are removed from the code base.\n # Note that changes in the inspected code, or installation of new\n---\nGemfile.lock\n@@ -751,18 +751,18 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.8)\n+    rubocop (1.76.0)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n       parallel (~> 1.10)\n       parser (>= 3.3.0.2)\n       rainbow (>= 2.2.2, < 4.0)\n       regexp_parser (>= 2.9.3, < 3.0)\n-      rubocop-ast (>= 1.44.0, < 2.0)\n+      rubocop-ast (>= 1.45.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.1)\n+    rubocop-ast (1.45.0)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n---\napp/controllers/auth/registrations_controller.rb\n@@ -138,7 +138,7 @@ def require_rules_acceptance!\n     set_locale { render :rules }\n   end\n \n-  def is_flashing_format? # rubocop:disable Naming/PredicateName\n+  def is_flashing_format? # rubocop:disable Naming/PredicatePrefix\n     if params[:action] == 'create'\n       false # Disable flash messages for sign-up\n     else\n---\napp/models/concerns/attachmentable.rb\n@@ -22,7 +22,7 @@ module Attachmentable\n   ).freeze\n \n   included do\n-    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicateName\n+    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicatePrefix\n       super\n \n       send(:\"before_#{name}_validate\", prepend: true) do\n---\napp/models/user_settings/glue.rb\n@@ -17,7 +17,7 @@ def type_for_attribute(key)\n     self.class.definition_for(key)&.type\n   end\n \n-  def has_attribute?(key) # rubocop:disable Naming/PredicateName\n+  def has_attribute?(key) # rubocop:disable Naming/PredicatePrefix\n     self.class.definition_for?(key)\n   end\n end\n---\nconfig/initializers/1_hosts.rb\n@@ -21,7 +21,7 @@\n \n   config.x.streaming_api_base_url = ENV.fetch('STREAMING_API_BASE_URL') do\n     if Rails.env.production?\n-      \"ws#{https ? 's' : ''}://#{web_host}\"\n+      \"ws#{'s' if https}://#{web_host}\"\n     else\n       \"ws://#{host.split(':').first}:4000\"\n     end\n---\nconfig/initializers/content_security_policy.rb\n@@ -32,7 +32,7 @@\n \n   if Rails.env.development?\n     vite_public_host = ENV.fetch('VITE_DEV_SERVER_PUBLIC', \"localhost:#{ViteRuby.config.port}\")\n-    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{ViteRuby.config.https ? 's' : ''}://#{vite_public_host}\" }\n+    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{'s' if ViteRuby.config.https}://#{vite_public_host}\" }\n \n     p.connect_src :self, :data, :blob, *media_hosts, Rails.configuration.x.streaming_api_base_url, *front_end_build_urls\n     p.script_src  :self, :unsafe_inline, :unsafe_eval, assets_host\n---\nlib/mastodon/migration_warning.rb\n@@ -23,7 +23,7 @@ def migration_duration_warning(explanation = nil)\n \n     def announce_countdown\n       WARNING_SECONDS.downto(1) do |i|\n-        say \"Continuing in #{i} second#{i == 1 ? '' : 's'}...\", true\n+        say \"Continuing in #{i} second#{'s' unless i == 1}...\", true\n         sleep 1\n       end\n     end\n---\nlib/mastodon/version.rb\n@@ -75,7 +75,7 @@ def source_commit\n     end\n \n     def user_agent\n-      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{Rails.configuration.x.use_https ? 's' : ''}://#{Rails.configuration.x.web_domain}/)\"\n+      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{'s' if Rails.configuration.x.use_https}://#{Rails.configuration.x.web_domain}/)\"\n     end\n \n     def version_configuration\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -62,7 +62,7 @@ gem 'inline_svg'\n gem 'irb', '~> 1.8'\n gem 'kaminari', '~> 1.2'\n gem 'link_header', '~> 0.0'\n-gem 'linzer', '~> 0.6.1'\n+gem 'linzer', '~> 0.7.0'\n gem 'mario-redis-lock', '~> 1.2', require: 'redis_lock'\n gem 'mime-types', '~> 3.7.0', require: 'mime/types/columnar'\n gem 'mutex_m'\n---\nGemfile.lock\n@@ -148,6 +148,7 @@ GEM\n     case_transform (0.2)\n       activesupport\n     cbor (0.5.9.8)\n+    cgi (0.4.2)\n     charlock_holmes (0.7.9)\n     chewy (7.6.0)\n       activesupport (>= 5.2)\n@@ -262,6 +263,7 @@ GEM\n       fog-core (~> 2.1)\n       fog-json (>= 1.0)\n     formatador (1.1.0)\n+    forwardable (1.3.3)\n     fugit (1.11.1)\n       et-orbi (~> 1, >= 1.2.11)\n       raabro (~> 1.4)\n@@ -396,7 +398,11 @@ GEM\n       rexml\n     link_header (0.0.8)\n     lint_roller (1.1.0)\n-    linzer (0.6.5)\n+    linzer (0.7.0)\n+      cgi (~> 0.4.2)\n+      forwardable (~> 1.3, >= 1.3.3)\n+      logger (~> 1.7, >= 1.7.0)\n+      net-http (~> 0.6.0)\n       openssl (~> 3.0, >= 3.0.0)\n       rack (>= 2.2, < 4.0)\n       starry (~> 0.2)\n@@ -628,7 +634,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -995,7 +1001,7 @@ DEPENDENCIES\n   letter_opener (~> 1.8)\n   letter_opener_web (~> 3.0)\n   link_header (~> 0.0)\n-  linzer (~> 0.6.1)\n+  linzer (~> 0.7.0)\n   lograge (~> 0.12)\n   mail (~> 2.8)\n   mario-redis-lock (~> 1.2)\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -168,7 +168,7 @@ GEM\n     crass (1.0.6)\n     css_parser (1.21.1)\n       addressable\n-    csv (3.3.4)\n+    csv (3.3.5)\n     database_cleaner-active_record (2.2.1)\n       activerecord (>= 5.a)\n       database_cleaner-core (~> 2.0.0)\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\n#34745 updated sidekiq to v7, as a result the process name has also changed to 'sidekiq 7.x.x' and does't match the old grep regex anymore. The regex could probably also be changed to match `sidekiq [0-9]\\.` or something but I went for the straight-forward fix\n\n---\n\nChoice A:\napp/controllers/api/base_controller.rb\n@@ -50,6 +50,10 @@ def current_user\n     nil\n   end\n \n+  def require_client_credentials!\n+    render json: { error: 'This method requires an client credentials authentication' }, status: 403 if doorkeeper_token.resource_owner_id.present?\n+  end\n+\n   def require_authenticated_user!\n     render json: { error: 'This method requires an authenticated user' }, status: 401 unless current_user\n   end\n---\napp/controllers/api/v1/accounts_controller.rb\n@@ -10,6 +10,7 @@ class Api::V1::AccountsController < Api::BaseController\n   before_action -> { doorkeeper_authorize! :write, :'write:accounts' }, only: [:create]\n \n   before_action :require_user!, except: [:index, :show, :create]\n+  before_action :require_client_credentials!, only: [:create]\n   before_action :set_account, except: [:index, :create]\n   before_action :set_accounts, only: [:index]\n   before_action :check_account_approval, except: [:index, :create]\n---\nspec/fabricators/client_credentials_token_fabricator.rb\n@@ -0,0 +1,5 @@\n+# frozen_string_literal: true\n+\n+Fabricator :client_credentials_token, from: :accessible_access_token do\n+  resource_owner_id { nil }\n+end\n---\nspec/requests/api/v1/accounts_spec.rb\n@@ -78,10 +78,27 @@\n     end\n \n     let(:client_app) { Fabricate(:application) }\n-    let(:token) { Doorkeeper::AccessToken.find_or_create_for(application: client_app, resource_owner: nil, scopes: 'read write', use_refresh_token: false) }\n+    let(:token) { Fabricate(:client_credentials_token, application: client_app, scopes: 'read write') }\n     let(:agreement) { nil }\n     let(:date_of_birth) { nil }\n \n+    context 'when not using client credentials token' do\n+      let(:token) { Fabricate(:accessible_access_token, application: client_app, scopes: 'read write', resource_owner_id: user.id) }\n+\n+      it 'returns http forbidden error' do\n+        subject\n+\n+        expect(response).to have_http_status(403)\n+        expect(response.content_type)\n+          .to start_with('application/json')\n+\n+        expect(response.parsed_body)\n+          .to include(\n+            error: 'This method requires an client credentials authentication'\n+          )\n+      end\n+    end\n+\n     context 'when age verification is enabled' do\n       before do\n         Setting.min_age = 16\n---\n\n\n---\n\nChoice B:\nconfig/vite/plugin-mastodon-themes.ts\n@@ -0,0 +1,58 @@\n+/* This plugins handles Mastodon's theme system\n+ */\n+\n+import fs from 'node:fs/promises';\n+import path from 'node:path';\n+\n+import yaml from 'js-yaml';\n+import type { Plugin } from 'vite';\n+\n+export function MastodonThemes(): Plugin {\n+  return {\n+    name: 'mastodon-themes',\n+    async config(userConfig) {\n+      if (!userConfig.root || !userConfig.envDir) {\n+        throw new Error('Unknown project directory');\n+      }\n+\n+      const themesFile = path.resolve(userConfig.envDir, 'config/themes.yml');\n+      const entrypoints: Record<string, string> = {};\n+\n+      // Get all files mentioned in the themes.yml file.\n+      const themesString = await fs.readFile(themesFile, 'utf8');\n+      const themes = yaml.load(themesString, {\n+        filename: 'themes.yml',\n+        schema: yaml.FAILSAFE_SCHEMA,\n+      });\n+\n+      if (!themes || typeof themes !== 'object') {\n+        throw new Error('Invalid themes.yml file');\n+      }\n+\n+      for (const themePath of Object.values(themes)) {\n+        if (\n+          typeof themePath !== 'string' ||\n+          themePath.split('.').length !== 2 || // Ensure it has exactly one period\n+          !themePath.endsWith('css')\n+        ) {\n+          console.warn(\n+            `Invalid theme path \"${themePath}\" in themes.yml, skipping`,\n+          );\n+          continue;\n+        }\n+        entrypoints[path.basename(themePath)] = path.resolve(\n+          userConfig.root,\n+          themePath,\n+        );\n+      }\n+\n+      return {\n+        build: {\n+          rollupOptions: {\n+            input: entrypoints,\n+          },\n+        },\n+      };\n+    },\n+  };\n+}\n---\nvite.config.mts\n@@ -1,4 +1,3 @@\n-import fs from 'node:fs/promises';\n import path from 'node:path';\n \n import { optimizeLodashImports } from '@optimize-lodash/rollup-plugin';\n@@ -9,44 +8,18 @@ import { visualizer } from 'rollup-plugin-visualizer';\n import RailsPlugin from 'vite-plugin-rails';\n import { VitePWA } from 'vite-plugin-pwa';\n import tsconfigPaths from 'vite-tsconfig-paths';\n-import yaml from 'js-yaml';\n import legacy from '@vitejs/plugin-legacy';\n \n import { defineConfig, UserConfigFnPromise, UserConfig } from 'vite';\n import postcssPresetEnv from 'postcss-preset-env';\n \n import { MastodonServiceWorkerLocales } from './config/vite/plugin-sw-locales';\n import { MastodonEmojiCompressed } from './config/vite/plugin-emoji-compressed';\n+import { MastodonThemes } from './config/vite/plugin-mastodon-themes';\n \n const jsRoot = path.resolve(__dirname, 'app/javascript');\n-const themesFile = path.resolve(__dirname, 'config/themes.yml');\n \n export const config: UserConfigFnPromise = async ({ mode, command }) => {\n-  const entrypoints: Record<string, string> = {}; // All JS entrypoints are taken care of by Vite Ruby\n-\n-  // Get all files mentioned in the themes.yml file.\n-  const themesString = await fs.readFile(themesFile, 'utf8');\n-  const themes = yaml.load(themesString, {\n-    filename: 'themes.yml',\n-    schema: yaml.FAILSAFE_SCHEMA,\n-  });\n-\n-  if (!themes || typeof themes !== 'object') {\n-    throw new Error('Invalid themes.yml file');\n-  }\n-\n-  for (const themePath of Object.values(themes)) {\n-    if (\n-      typeof themePath !== 'string' ||\n-      themePath.split('.').length !== 2 || // Ensure it has exactly one period\n-      !themePath.endsWith('css')\n-    ) {\n-      console.warn(`Invalid theme path \"${themePath}\" in themes.yml, skipping`);\n-      continue;\n-    }\n-    entrypoints[path.basename(themePath)] = path.resolve(jsRoot, themePath);\n-  }\n-\n   return {\n     root: jsRoot,\n     css: {\n@@ -72,7 +45,6 @@ export const config: UserConfigFnPromise = async ({ mode, command }) => {\n       chunkSizeWarningLimit: 1 * 1024 * 1024, // 1MB\n       sourcemap: true,\n       rollupOptions: {\n-        input: entrypoints,\n         output: {\n           chunkFileNames({ facadeModuleId, name }) {\n             if (!facadeModuleId) {\n@@ -113,6 +85,7 @@ export const config: UserConfigFnPromise = async ({ mode, command }) => {\n           manifestPaths: ['.vite/manifest.json', '.vite/manifest-assets.json'],\n         },\n       }),\n+      MastodonThemes(),\n       react({\n         babel: {\n           plugins: ['formatjs', 'transform-react-remove-prop-types'],\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -446,7 +446,7 @@ GEM\n     net-smtp (0.5.1)\n       net-protocol\n     nio4r (2.7.4)\n-    nokogiri (1.18.7)\n+    nokogiri (1.18.8)\n       mini_portile2 (~> 2.8.2)\n       racc (~> 1.4)\n     oj (3.16.10)\n---\n\n\n---\n\nChoice D:\ndocker-compose.yml\n@@ -115,7 +115,7 @@ services:\n     volumes:\n       - ./public/system:/mastodon/public/system\n     healthcheck:\n-      test: ['CMD-SHELL', \"ps aux | grep '[s]idekiq\\ 6' || false\"]\n+      test: ['CMD-SHELL', \"ps aux | grep '[s]idekiq\\ 7' || false\"]\n \n   ## Uncomment to enable federation with tor instances along with adding the following ENV variables\n   ## http_hidden_proxy=http://privoxy:8118\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis is a maddening thing to have to optimize for, but we sometimes have multiple failures of the E2E tests (ie, 3.2 and 3.3 from the matrix), but they cant both upload their screenshot artifacts because the names collide.\r\n\r\nChange here, borrowed from the log naming section right above it, includes the matrix ruby version value in the name, which hopefully prevents the collision and will capture all failing screenshots for later download.\n\n---\n\nChoice A:\n.github/ISSUE_TEMPLATE/1.web_bug_report.yml\n@@ -48,24 +48,24 @@ body:\n     attributes:\n       label: Mastodon version\n       description: |\n-        This is displayed at the bottom of the About page, eg. `v4.4.0-alpha.1`\n-      placeholder: v4.3.0\n+        This is displayed at the bottom of the About page, eg. `v4.4.0-beta.1`\n+      placeholder: v4.4.0-beta.1\n     validations:\n       required: true\n   - type: input\n     attributes:\n       label: Browser name and version\n       description: |\n         What browser are you using when getting this bug? Please specify the version as well.\n-      placeholder: Firefox 131.0.0\n+      placeholder: Firefox 139.0.0\n     validations:\n       required: true\n   - type: input\n     attributes:\n       label: Operating system\n       description: |\n         What OS are you running? Please specify the version as well.\n-      placeholder: macOS 15.0.1\n+      placeholder: macOS 15.5\n     validations:\n       required: true\n   - type: textarea\n---\n.github/ISSUE_TEMPLATE/2.server_bug_report.yml\n@@ -49,8 +49,8 @@ body:\n     attributes:\n       label: Mastodon version\n       description: |\n-        This is displayed at the bottom of the About page, eg. `v4.4.0-alpha.1`\n-      placeholder: v4.3.0\n+        This is displayed at the bottom of the About page, eg. `v4.4.0-beta.1`\n+      placeholder: v4.4.0-beta.1\n     validations:\n       required: false\n   - type: textarea\n@@ -60,7 +60,7 @@ body:\n         Any additional technical details you may have, like logs or error traces\n       value: |\n         If this is happening on your own Mastodon server, please fill out those:\n-        - Ruby version: (from `ruby --version`, eg. v3.4.1)\n-        - Node.js version: (from `node --version`, eg. v20.18.0)\n+        - Ruby version: (from `ruby --version`, eg. v3.4.4)\n+        - Node.js version: (from `node --version`, eg. v22.16.0)\n     validations:\n       required: false\n---\n.github/ISSUE_TEMPLATE/3.troubleshooting.yml\n@@ -50,7 +50,7 @@ body:\n       label: Mastodon version\n       description: |\n         This is displayed at the bottom of the About page, eg. `v4.4.0-alpha.1`\n-      placeholder: v4.3.0\n+      placeholder: v4.4.0-beta.1\n     validations:\n       required: false\n   - type: textarea\n@@ -60,9 +60,9 @@ body:\n         Details about your environment, like how Mastodon is deployed, if containers are used, version numbers, etc.\n       value: |\n         Please at least include those informations:\n-        - Operating system: (eg. Ubuntu 22.04)\n-        - Ruby version: (from `ruby --version`, eg. v3.4.1)\n-        - Node.js version: (from `node --version`, eg. v20.18.0)\n+        - Operating system: (eg. Ubuntu 24.04.2)\n+        - Ruby version: (from `ruby --version`, eg. v3.4.4)\n+        - Node.js version: (from `node --version`, eg. v22.16.0)\n     validations:\n       required: false\n   - type: textarea\n---\n\n\n---\n\nChoice B:\n.github/workflows/test-ruby.yml\n@@ -345,7 +345,7 @@ jobs:\n         uses: actions/upload-artifact@v4\n         if: failure()\n         with:\n-          name: e2e-screenshots\n+          name: e2e-screenshots-${{ matrix.ruby-version }}\n           path: tmp/capybara/\n \n   test-search:\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/locales/en-GB.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Moderated servers\",\n   \"about.contact\": \"Contact:\",\n+  \"about.default_locale\": \"Default\",\n   \"about.disclaimer\": \"Mastodon is free, open-source software, and a trademark of Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Reason not available\",\n   \"about.domain_blocks.preamble\": \"Mastodon generally allows you to view content from and interact with users from any other server in the Fediverse. These are the exceptions that have been made on this particular server.\",\n   \"about.domain_blocks.silenced.explanation\": \"You will generally not see profiles and content from this server, unless you explicitly look it up or opt into it by following.\",\n   \"about.domain_blocks.silenced.title\": \"Limited\",\n   \"about.domain_blocks.suspended.explanation\": \"No data from this server will be processed, stored or exchanged, making any interaction or communication with users from this server impossible.\",\n   \"about.domain_blocks.suspended.title\": \"Suspended\",\n+  \"about.language_label\": \"Language\",\n   \"about.not_available\": \"This information has not been made available on this server.\",\n   \"about.powered_by\": \"Decentralised social media powered by {mastodon}\",\n   \"about.rules\": \"Server rules\",\n@@ -19,10 +21,12 @@\n   \"account.block_domain\": \"Block domain {domain}\",\n   \"account.block_short\": \"Block\",\n   \"account.blocked\": \"Blocked\",\n+  \"account.blocking\": \"Blocking\",\n   \"account.cancel_follow_request\": \"Cancel follow\",\n   \"account.copy\": \"Copy link to profile\",\n   \"account.direct\": \"Privately mention @{name}\",\n   \"account.disable_notifications\": \"Stop notifying me when @{name} posts\",\n+  \"account.domain_blocking\": \"Blocking domain\",\n   \"account.edit_profile\": \"Edit profile\",\n   \"account.enable_notifications\": \"Notify me when @{name} posts\",\n   \"account.endorse\": \"Feature on profile\",\n---\napp/javascript/mastodon/locales/pt-PT.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Servidores moderados\",\n   \"about.contact\": \"Contacto:\",\n+  \"about.default_locale\": \"Padr\u00e3o\",\n   \"about.disclaimer\": \"O Mastodon \u00e9 um software livre, de c\u00f3digo aberto e uma marca registada de Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Motivo n\u00e3o dispon\u00edvel\",\n   \"about.domain_blocks.preamble\": \"O Mastodon geralmente permite ver e interagir com o conte\u00fado de utilizadores de qualquer outra inst\u00e2ncia no fediverso. Estas s\u00e3o as exce\u00e7\u00f5es desta inst\u00e2ncia em espec\u00edfico.\",\n   \"about.domain_blocks.silenced.explanation\": \"Normalmente n\u00e3o ver\u00e1s perfis e conte\u00fados deste servidor, a n\u00e3o ser que os procures explicitamente ou optes por segui-los.\",\n   \"about.domain_blocks.silenced.title\": \"Limitados\",\n   \"about.domain_blocks.suspended.explanation\": \"Nenhum dado deste servidor ser\u00e1 processado, armazenado ou trocado, tornando imposs\u00edvel qualquer intera\u00e7\u00e3o ou comunica\u00e7\u00e3o com os utilizadores a partir deste servidor.\",\n   \"about.domain_blocks.suspended.title\": \"Suspensos\",\n+  \"about.language_label\": \"Idioma\",\n   \"about.not_available\": \"Esta informa\u00e7\u00e3o n\u00e3o foi disponibilizada neste servidor.\",\n   \"about.powered_by\": \"Rede social descentralizada baseada no {mastodon}\",\n   \"about.rules\": \"Regras do servidor\",\n@@ -308,6 +310,8 @@\n   \"emoji_button.search_results\": \"Resultados da pesquisa\",\n   \"emoji_button.symbols\": \"S\u00edmbolos\",\n   \"emoji_button.travel\": \"Viagens e lugares\",\n+  \"empty_column.account_featured.me\": \"Ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n+  \"empty_column.account_featured.other\": \"{acct} ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n   \"empty_column.account_featured_other.unknown\": \"Esta conta ainda n\u00e3o colocou nada em destaque.\",\n   \"empty_column.account_hides_collections\": \"Este utilizador escolheu n\u00e3o disponibilizar esta informa\u00e7\u00e3o\",\n   \"empty_column.account_suspended\": \"Conta suspensa\",\n@@ -341,6 +345,11 @@\n   \"explore.trending_links\": \"Not\u00edcias\",\n   \"explore.trending_statuses\": \"Publica\u00e7\u00f5es\",\n   \"explore.trending_tags\": \"#Etiquetas\",\n+  \"featured_carousel.header\": \"{count, plural, one {Publica\u00e7\u00e3o Afixada} other {Publica\u00e7\u00f5es Afixadas}}\",\n+  \"featured_carousel.next\": \"Seguinte\",\n+  \"featured_carousel.post\": \"Publica\u00e7\u00e3o\",\n+  \"featured_carousel.previous\": \"Anterior\",\n+  \"featured_carousel.slide\": \"{index} de {total}\",\n   \"filter_modal.added.context_mismatch_explanation\": \"Esta categoria de filtro n\u00e3o se aplica ao contexto em que acedeste a esta publica\u00e7\u00e3o. Se pretenderes que esta publica\u00e7\u00e3o seja filtrada tamb\u00e9m neste contexto, ter\u00e1s que editar o filtro.\",\n   \"filter_modal.added.context_mismatch_title\": \"O contexto n\u00e3o coincide!\",\n   \"filter_modal.added.expired_explanation\": \"Esta categoria de filtro expirou, tens de alterar a data de validade para que ele seja aplicado.\",\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -212,7 +212,7 @@ group :development, :test do\n   gem 'test-prof', require: false\n \n   # RSpec runner for rails\n-  gem 'rspec-rails', '~> 7.0'\n+  gem 'rspec-rails', '~> 8.0'\n end\n \n group :production do\n---\nGemfile.lock\n@@ -435,7 +435,7 @@ GEM\n     mutex_m (0.3.0)\n     net-http (0.6.0)\n       uri\n-    net-imap (0.5.6)\n+    net-imap (0.5.8)\n       date\n       net-protocol\n     net-ldap (0.19.0)\n@@ -721,18 +721,18 @@ GEM\n       rspec-mocks (~> 3.13.0)\n     rspec-core (3.13.3)\n       rspec-support (~> 3.13.0)\n-    rspec-expectations (3.13.3)\n+    rspec-expectations (3.13.4)\n       diff-lcs (>= 1.2.0, < 2.0)\n       rspec-support (~> 3.13.0)\n     rspec-github (3.0.0)\n       rspec-core (~> 3.0)\n-    rspec-mocks (3.13.2)\n+    rspec-mocks (3.13.3)\n       diff-lcs (>= 1.2.0, < 2.0)\n       rspec-support (~> 3.13.0)\n-    rspec-rails (7.1.1)\n-      actionpack (>= 7.0)\n-      activesupport (>= 7.0)\n-      railties (>= 7.0)\n+    rspec-rails (8.0.0)\n+      actionpack (>= 7.2)\n+      activesupport (>= 7.2)\n+      railties (>= 7.2)\n       rspec-core (~> 3.13)\n       rspec-expectations (~> 3.13)\n       rspec-mocks (~> 3.13)\n@@ -742,7 +742,7 @@ GEM\n       rspec-expectations (~> 3.0)\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n-    rspec-support (3.13.2)\n+    rspec-support (3.13.3)\n     rubocop (1.75.4)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n@@ -842,7 +842,7 @@ GEM\n       base64\n     stoplight (4.1.1)\n       redlock (~> 1.0)\n-    stringio (3.1.6)\n+    stringio (3.1.7)\n     strong_migrations (2.3.0)\n       activerecord (>= 7)\n     swd (2.0.3)\n@@ -1045,7 +1045,7 @@ DEPENDENCIES\n   redis-namespace (~> 1.10)\n   rqrcode (~> 3.0)\n   rspec-github (~> 3.0)\n-  rspec-rails (~> 7.0)\n+  rspec-rails (~> 8.0)\n   rspec-sidekiq (~> 5.0)\n   rubocop\n   rubocop-capybara\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [sass](https://redirect.github.com/sass/dart-sass) | [`1.89.0` -> `1.89.1`](https://renovatebot.com/diffs/npm/sass/1.89.0/1.89.1) | [![age](https://developer.mend.io/api/mc/badges/age/npm/sass/1.89.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/sass/1.89.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/sass/1.89.0/1.89.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/sass/1.89.0/1.89.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>sass/dart-sass (sass)</summary>\n\n### [`v1.89.1`](https://redirect.github.com/sass/dart-sass/blob/HEAD/CHANGELOG.md#1891)\n\n[Compare Source](https://redirect.github.com/sass/dart-sass/compare/1.89.0...1.89.1)\n\n-   No user-visible changes.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4zMy42IiwidXBkYXRlZEluVmVyIjoiNDAuMzMuNiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwiamF2YXNjcmlwdCJdfQ==-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -768,12 +768,12 @@ GEM\n       lint_roller (~> 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n       rubocop-ast (>= 1.38.0, < 2.0)\n-    rubocop-rails (2.31.0)\n+    rubocop-rails (2.32.0)\n       activesupport (>= 4.2.0)\n       lint_roller (~> 1.1)\n       rack (>= 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n-      rubocop-ast (>= 1.38.0, < 2.0)\n+      rubocop-ast (>= 1.44.0, < 2.0)\n     rubocop-rspec (3.6.0)\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -201,7 +201,7 @@ group :development, :test do\n   gem 'faker', '~> 3.2'\n \n   # Generate factory objects\n-  gem 'fabrication', '~> 2.30'\n+  gem 'fabrication'\n \n   # Profiling tools\n   gem 'memory_profiler', require: false\n---\nGemfile.lock\n@@ -223,7 +223,7 @@ GEM\n       tzinfo\n     excon (1.2.5)\n       logger\n-    fabrication (2.31.0)\n+    fabrication (3.0.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n     faraday (2.13.1)\n@@ -972,7 +972,7 @@ DEPENDENCIES\n   doorkeeper (~> 5.6)\n   dotenv\n   email_spec\n-  fabrication (~> 2.30)\n+  fabrication\n   faker (~> 3.2)\n   faraday-httpclient\n   fast_blank (~> 1.0)\n---\n\n\n---\n\nChoice C:\n.rubocop_todo.yml\n@@ -39,7 +39,6 @@ Style/FetchEnvVar:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/3_omniauth.rb'\n     - 'config/initializers/cache_buster.rb'\n-    - 'config/initializers/devise.rb'\n     - 'config/initializers/paperclip.rb'\n     - 'config/initializers/vapid.rb'\n     - 'lib/tasks/repo.rake'\n---\nconfig/initializers/devise.rb\n@@ -377,7 +377,7 @@ def session_cookie\n     config.usernamefield          = nil\n     config.emailfield             = 'email'\n     config.check_at_sign          = true\n-    config.pam_default_suffix     = ENV.fetch('PAM_EMAIL_DOMAIN') { ENV['LOCAL_DOMAIN'] }\n+    config.pam_default_suffix     = ENV.fetch('PAM_EMAIL_DOMAIN') { ENV.fetch('LOCAL_DOMAIN', nil) }\n     config.pam_default_service    = ENV.fetch('PAM_DEFAULT_SERVICE') { 'rpam' }\n     config.pam_controlled_service = ENV.fetch('PAM_CONTROLLED_SERVICE', nil).presence\n   end\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -10845,8 +10845,8 @@ __metadata:\n   linkType: hard\n \n \"sass@npm:^1.62.1\":\n-  version: 1.89.0\n-  resolution: \"sass@npm:1.89.0\"\n+  version: 1.89.1\n+  resolution: \"sass@npm:1.89.1\"\n   dependencies:\n     \"@parcel/watcher\": \"npm:^2.4.1\"\n     chokidar: \"npm:^4.0.0\"\n@@ -10857,7 +10857,7 @@ __metadata:\n       optional: true\n   bin:\n     sass: sass.js\n-  checksum: 10c0/8e31b48c5e0abd9d437edb201919a82863f605ace1c1536ccdc6b3133937a70fe29b92ad536af632ecae2f140733931e4ec971e1bfbf8b835c54d392b28331df\n+  checksum: 10c0/4406c441f71f5e0ec056345e6091cef51fd1786dac6e5b3eb1e87df464c40b3278219cc51df98309c36794503787ab0fe88fd45f2b0464f22000b68e755883ee\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThere is no difference in functionality because the popout has a separate system for keyboard navigation with up/down arrows and enter, so the element only needs to handle the mouse event. Also fixes clearing a particular recent search clearing all searches with that query even if one is for a hashtag and another is for post search.\n\n---\n\nChoice A:\nGemfile\n@@ -13,7 +13,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.224.2', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1103.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1108.0)\n+    aws-sdk-core (3.224.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -945,7 +947,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.224.2)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/actions/search.ts\n@@ -121,10 +121,15 @@ export const clickSearchResult = createAppAsyncThunk(\n \n export const forgetSearchResult = createAppAsyncThunk(\n   'search/forgetResult',\n-  (q: string, { dispatch, getState }) => {\n+  (\n+    { q, type }: { q: string; type?: RecentSearchType },\n+    { dispatch, getState },\n+  ) => {\n     const previous = getState().search.recent;\n     const me = getState().meta.get('me') as string;\n-    const current = previous.filter((result) => result.q !== q);\n+    const current = previous.filter(\n+      (result) => result.q !== q || result.type !== type,\n+    );\n \n     searchHistory.set(me, current);\n     dispatch(updateSearchHistory(current));\n---\napp/javascript/mastodon/features/compose/components/search.tsx\n@@ -221,7 +221,7 @@ export const Search: React.FC<{\n     },\n     forget: (e) => {\n       e.stopPropagation();\n-      void dispatch(forgetSearchResult(search.q));\n+      void dispatch(forgetSearchResult(search));\n     },\n   }));\n \n@@ -497,8 +497,10 @@ export const Search: React.FC<{\n             <div className='search__popout__menu'>\n               {recentOptions.length > 0 ? (\n                 recentOptions.map(({ label, key, action, forget }, i) => (\n-                  <button\n+                  <div\n                     key={key}\n+                    tabIndex={0}\n+                    role='button'\n                     onMouseDown={action}\n                     className={classNames(\n                       'search__popout__menu__item search__popout__menu__item--flex',\n@@ -509,7 +511,7 @@ export const Search: React.FC<{\n                     <button className='icon-button' onMouseDown={forget}>\n                       <Icon id='times' icon={CloseIcon} />\n                     </button>\n-                  </button>\n+                  </div>\n                 ))\n               ) : (\n                 <div className='search__popout__menu__message'>\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/audio/index.tsx\n@@ -442,11 +442,14 @@ export const Audio: React.FC<{\n     if (typeof startMuted !== 'undefined') {\n       audioRef.current.muted = startMuted;\n     }\n+  }, [setDuration, startTime, startVolume, startMuted]);\n \n+  const handleCanPlayThrough = useCallback(() => {\n     if (startPlaying) {\n-      void audioRef.current.play();\n+      resumeAudio();\n+      void audioRef.current?.play();\n     }\n-  }, [setDuration, startTime, startVolume, startMuted, startPlaying]);\n+  }, [startPlaying, resumeAudio]);\n \n   const seekBy = (time: number) => {\n     if (!audioRef.current) {\n@@ -591,6 +594,7 @@ export const Audio: React.FC<{\n         onPause={handlePause}\n         onProgress={handleProgress}\n         onLoadedData={handleLoadedData}\n+        onCanPlayThrough={handleCanPlayThrough}\n         onTimeUpdate={handleTimeUpdate}\n         onVolumeChange={handleVolumeChange}\n         crossOrigin='anonymous'\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -592,7 +592,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n     orm_adapter (0.5.0)\n     ostruct (0.6.1)\n-    ox (2.14.22)\n+    ox (2.14.23)\n       bigdecimal (>= 3.0)\n     parallel (1.27.0)\n     parser (3.3.8.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [annotaterb](https://redirect.github.com/drwl/annotaterb) ([changelog](https://redirect.github.com/drwl/annotaterb/blob/main/CHANGELOG.md)) | `4.14.0` -> `4.15.0` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/annotaterb/4.15.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/annotaterb/4.15.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/annotaterb/4.14.0/4.15.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/annotaterb/4.14.0/4.15.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>drwl/annotaterb (annotaterb)</summary>\n\n### [`v4.15.0`](https://redirect.github.com/drwl/annotaterb/blob/HEAD/CHANGELOG.md#v4150-2025-05-30)\n\n[Compare Source](https://redirect.github.com/drwl/annotaterb/compare/v4.14.0...v4.15.0)\n\n[Full Changelog](https://redirect.github.com/drwl/annotaterb/compare/v4.14.1...v4.15.0)\n\n**Closed issues:**\n\n-   Feature request: packs-rails support [#&#8203;99](https://redirect.github.com/drwl/annotaterb/issues/99)\n-   Annotate models using Zeitwerk namespaces [#&#8203;82](https://redirect.github.com/drwl/annotaterb/issues/82)\n\n**Merged pull requests:**\n\n-   Bump version to v4.15.0 [#&#8203;218](https://redirect.github.com/drwl/annotaterb/pull/218) ([drwl](https://redirect.github.com/drwl))\n-   Add debug logs for model annotation [#&#8203;217](https://redirect.github.com/drwl/annotaterb/pull/217) ([jarredhawkins](https://redirect.github.com/jarredhawkins))\n-   Cache retrieved indexes in ModelWrapper [#&#8203;215](https://redirect.github.com/drwl/annotaterb/pull/215) ([tr4b4nt](https://redirect.github.com/tr4b4nt))\n-   feat: identify unique indexes in simple_indexes option [#&#8203;214](https://redirect.github.com/drwl/annotaterb/pull/214) ([amerritt14](https://redirect.github.com/amerritt14))\n-   fix: Handle case when table_name_prefix specified as symbol [#&#8203;208](https://redirect.github.com/drwl/annotaterb/pull/208) ([gururuby](https://redirect.github.com/gururuby))\n-   Support the glob pattern in `root_dir` and `model_dir` [#&#8203;198](https://redirect.github.com/drwl/annotaterb/pull/198) ([sinsoku](https://redirect.github.com/sinsoku))\n-   Fix `changelog_uri` in gemspec [#&#8203;192](https://redirect.github.com/drwl/annotaterb/pull/192) ([y-yagi](https://redirect.github.com/y-yagi))\n-   Generate changelog for v4.14.0 [#&#8203;191](https://redirect.github.com/drwl/annotaterb/pull/191) ([drwl](https://redirect.github.com/drwl))\n-   feat: add `timestamp_columns` config option [#&#8203;173](https://redirect.github.com/drwl/annotaterb/pull/173) ([pbernays](https://redirect.github.com/pbernays))\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4zMy42IiwidXBkYXRlZEluVmVyIjoiNDAuMzMuNiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\napp/javascript/images/logo-symbol-icon.svg\n@@ -1,2 +1,2 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"79\" height=\"79\" viewBox=\"0 0 79 75\"><symbol id=\"logo-symbol-icon\"><path d=\"M74.7135 16.6043C73.6199 8.54587 66.5351 2.19527 58.1366 0.964691C56.7196 0.756754 51.351 0 38.9148 0H38.822C26.3824 0 23.7135 0.756754 22.2966 0.964691C14.1319 2.16118 6.67571 7.86752 4.86669 16.0214C3.99657 20.0369 3.90371 24.4888 4.06535 28.5726C4.29578 34.4289 4.34049 40.275 4.877 46.1075C5.24791 49.9817 5.89495 53.8251 6.81328 57.6088C8.53288 64.5968 15.4938 70.4122 22.3138 72.7848C29.6155 75.259 37.468 75.6697 44.9919 73.971C45.8196 73.7801 46.6381 73.5586 47.4475 73.3063C49.2737 72.7302 51.4164 72.086 52.9915 70.9542C53.0131 70.9384 53.0308 70.9178 53.0433 70.8942C53.0558 70.8706 53.0628 70.8445 53.0637 70.8179V65.1661C53.0634 65.1412 53.0574 65.1167 53.0462 65.0944C53.035 65.0721 53.0189 65.0525 52.9992 65.0371C52.9794 65.0218 52.9564 65.011 52.9318 65.0056C52.9073 65.0002 52.8819 65.0003 52.8574 65.0059C48.0369 66.1472 43.0971 66.7193 38.141 66.7103C29.6118 66.7103 27.3178 62.6981 26.6609 61.0278C26.1329 59.5842 25.7976 58.0784 25.6636 56.5486C25.6622 56.5229 25.667 56.4973 25.6775 56.4738C25.688 56.4502 25.7039 56.4295 25.724 56.4132C25.7441 56.397 25.7678 56.3856 25.7931 56.3801C25.8185 56.3746 25.8448 56.3751 25.8699 56.3816C30.6101 57.5151 35.4693 58.0873 40.3455 58.086C41.5183 58.086 42.6876 58.086 43.8604 58.0553C48.7647 57.919 53.9339 57.6701 58.7591 56.7361C58.8794 56.7123 58.9998 56.6918 59.103 56.6611C66.7139 55.2124 73.9569 50.665 74.6929 39.1501C74.7204 38.6967 74.7892 34.4016 74.7892 33.9312C74.7926 32.3325 75.3085 22.5901 74.7135 16.6043ZM62.9996 45.3371H54.9966V25.9069C54.9966 21.8163 53.277 19.7302 49.7793 19.7302C45.9343 19.7302 44.0083 22.1981 44.0083 27.0727V37.7082H36.0534V27.0727C36.0534 22.1981 34.124 19.7302 30.279 19.7302C26.8019 19.7302 25.0651 21.8163 25.0617 25.9069V45.3371H17.0656V25.3172C17.0656 21.2266 18.1191 17.9769 20.2262 15.568C22.3998 13.1648 25.2509 11.9308 28.7898 11.9308C32.8859 11.9308 35.9812 13.492 38.0447 16.6111L40.036 19.9245L42.0308 16.6111C44.0943 13.492 47.1896 11.9308 51.2788 11.9308C54.8143 11.9308 57.6654 13.1648 59.8459 15.568C61.9529 17.9746 63.0065 21.2243 63.0065 25.3172L62.9996 45.3371Z\" fill=\"currentColor\"/></symbol><use xlink:href=\"#logo-symbol-icon\"/></svg>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"79\" height=\"79\" viewBox=\"0 0 79 75\"><symbol id=\"logo-symbol-icon\"><path d=\"M63 45.3v-20c0-4.1-1-7.3-3.2-9.7-2.1-2.4-5-3.7-8.5-3.7-4.1 0-7.2 1.6-9.3 4.7l-2 3.3-2-3.3c-2-3.1-5.1-4.7-9.2-4.7-3.5 0-6.4 1.3-8.6 3.7-2.1 2.4-3.1 5.6-3.1 9.7v20h8V25.9c0-4.1 1.7-6.2 5.2-6.2 3.8 0 5.8 2.5 5.8 7.4V37.7H44V27.1c0-4.9 1.9-7.4 5.8-7.4 3.5 0 5.2 2.1 5.2 6.2V45.3h8ZM74.7 16.6c.6 6 .1 15.7.1 17.3 0 .5-.1 4.8-.1 5.3-.7 11.5-8 16-15.6 17.5-.1 0-.2 0-.3 0-4.9 1-10 1.2-14.9 1.4-1.2 0-2.4 0-3.6 0-4.8 0-9.7-.6-14.4-1.7-.1 0-.1 0-.1 0s-.1 0-.1 0 0 .1 0 .1 0 0 0 0c.1 1.6.4 3.1 1 4.5.6 1.7 2.9 5.7 11.4 5.7 5 0 9.9-.6 14.8-1.7 0 0 0 0 0 0 .1 0 .1 0 .1 0 0 .1 0 .1 0 .1.1 0 .1 0 .1.1v5.6s0 .1-.1.1c0 0 0 0 0 .1-1.6 1.1-3.7 1.7-5.6 2.3-.8.3-1.6.5-2.4.7-7.5 1.7-15.4 1.3-22.7-1.2-6.8-2.4-13.8-8.2-15.5-15.2-.9-3.8-1.6-7.6-1.9-11.5-.6-5.8-.6-11.7-.8-17.5C3.9 24.5 4 20 4.9 16 6.7 7.9 14.1 2.2 22.3 1c1.4-.2 4.1-1 16.5-1h.1C51.4 0 56.7.8 58.1 1c8.4 1.2 15.5 7.5 16.6 15.6Z\" fill=\"currentColor\"/></symbol><use xlink:href=\"#logo-symbol-icon\"/></svg>\n \n---\napp/serializers/oembed_serializer.rb\n@@ -75,7 +75,7 @@ def html\n     <<~HTML.squish\n       <blockquote class=\"mastodon-embed\" data-embed-url=\"#{embed_short_account_status_url(object.account, object)}\" style=\"#{INLINE_STYLES[:blockquote]}\">\n         <a href=\"#{short_account_status_url(object.account, object)}\" target=\"_blank\" style=\"#{INLINE_STYLES[:status_link]}\">\n-          <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"32\" height=\"32\" viewBox=\"0 0 79 75\"><path d=\"M74.7135 16.6043C73.6199 8.54587 66.5351 2.19527 58.1366 0.964691C56.7196 0.756754 51.351 0 38.9148 0H38.822C26.3824 0 23.7135 0.756754 22.2966 0.964691C14.1319 2.16118 6.67571 7.86752 4.86669 16.0214C3.99657 20.0369 3.90371 24.4888 4.06535 28.5726C4.29578 34.4289 4.34049 40.275 4.877 46.1075C5.24791 49.9817 5.89495 53.8251 6.81328 57.6088C8.53288 64.5968 15.4938 70.4122 22.3138 72.7848C29.6155 75.259 37.468 75.6697 44.9919 73.971C45.8196 73.7801 46.6381 73.5586 47.4475 73.3063C49.2737 72.7302 51.4164 72.086 52.9915 70.9542C53.0131 70.9384 53.0308 70.9178 53.0433 70.8942C53.0558 70.8706 53.0628 70.8445 53.0637 70.8179V65.1661C53.0634 65.1412 53.0574 65.1167 53.0462 65.0944C53.035 65.0721 53.0189 65.0525 52.9992 65.0371C52.9794 65.0218 52.9564 65.011 52.9318 65.0056C52.9073 65.0002 52.8819 65.0003 52.8574 65.0059C48.0369 66.1472 43.0971 66.7193 38.141 66.7103C29.6118 66.7103 27.3178 62.6981 26.6609 61.0278C26.1329 59.5842 25.7976 58.0784 25.6636 56.5486C25.6622 56.5229 25.667 56.4973 25.6775 56.4738C25.688 56.4502 25.7039 56.4295 25.724 56.4132C25.7441 56.397 25.7678 56.3856 25.7931 56.3801C25.8185 56.3746 25.8448 56.3751 25.8699 56.3816C30.6101 57.5151 35.4693 58.0873 40.3455 58.086C41.5183 58.086 42.6876 58.086 43.8604 58.0553C48.7647 57.919 53.9339 57.6701 58.7591 56.7361C58.8794 56.7123 58.9998 56.6918 59.103 56.6611C66.7139 55.2124 73.9569 50.665 74.6929 39.1501C74.7204 38.6967 74.7892 34.4016 74.7892 33.9312C74.7926 32.3325 75.3085 22.5901 74.7135 16.6043ZM62.9996 45.3371H54.9966V25.9069C54.9966 21.8163 53.277 19.7302 49.7793 19.7302C45.9343 19.7302 44.0083 22.1981 44.0083 27.0727V37.7082H36.0534V27.0727C36.0534 22.1981 34.124 19.7302 30.279 19.7302C26.8019 19.7302 25.0651 21.8163 25.0617 25.9069V45.3371H17.0656V25.3172C17.0656 21.2266 18.1191 17.9769 20.2262 15.568C22.3998 13.1648 25.2509 11.9308 28.7898 11.9308C32.8859 11.9308 35.9812 13.492 38.0447 16.6111L40.036 19.9245L42.0308 16.6111C44.0943 13.492 47.1896 11.9308 51.2788 11.9308C54.8143 11.9308 57.6654 13.1648 59.8459 15.568C61.9529 17.9746 63.0065 21.2243 63.0065 25.3172L62.9996 45.3371Z\" fill=\"currentColor\"/></svg>\n+          <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"32\" height=\"32\" viewBox=\"0 0 79 75\"><path d=\"M63 45.3v-20c0-4.1-1-7.3-3.2-9.7-2.1-2.4-5-3.7-8.5-3.7-4.1 0-7.2 1.6-9.3 4.7l-2 3.3-2-3.3c-2-3.1-5.1-4.7-9.2-4.7-3.5 0-6.4 1.3-8.6 3.7-2.1 2.4-3.1 5.6-3.1 9.7v20h8V25.9c0-4.1 1.7-6.2 5.2-6.2 3.8 0 5.8 2.5 5.8 7.4V37.7H44V27.1c0-4.9 1.9-7.4 5.8-7.4 3.5 0 5.2 2.1 5.2 6.2V45.3h8ZM74.7 16.6c.6 6 .1 15.7.1 17.3 0 .5-.1 4.8-.1 5.3-.7 11.5-8 16-15.6 17.5-.1 0-.2 0-.3 0-4.9 1-10 1.2-14.9 1.4-1.2 0-2.4 0-3.6 0-4.8 0-9.7-.6-14.4-1.7-.1 0-.1 0-.1 0s-.1 0-.1 0 0 .1 0 .1 0 0 0 0c.1 1.6.4 3.1 1 4.5.6 1.7 2.9 5.7 11.4 5.7 5 0 9.9-.6 14.8-1.7 0 0 0 0 0 0 .1 0 .1 0 .1 0 0 .1 0 .1 0 .1.1 0 .1 0 .1.1v5.6s0 .1-.1.1c0 0 0 0 0 .1-1.6 1.1-3.7 1.7-5.6 2.3-.8.3-1.6.5-2.4.7-7.5 1.7-15.4 1.3-22.7-1.2-6.8-2.4-13.8-8.2-15.5-15.2-.9-3.8-1.6-7.6-1.9-11.5-.6-5.8-.6-11.7-.8-17.5C3.9 24.5 4 20 4.9 16 6.7 7.9 14.1 2.2 22.3 1c1.4-.2 4.1-1 16.5-1h.1C51.4 0 56.7.8 58.1 1c8.4 1.2 15.5 7.5 16.6 15.6Z\" fill=\"currentColor\"/></svg>\n           <div style=\"#{INLINE_STYLES[:div_account]}\">Post by @#{object.account.pretty_acct}@#{provider_name}</div>\n           <div style=\"#{INLINE_STYLES[:div_view]}\">View on Mastodon</div>\n         </a>\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -90,7 +90,7 @@ GEM\n       public_suffix (>= 2.0.2, < 7.0)\n     aes_key_wrap (1.1.0)\n     android_key_attestation (0.3.0)\n-    annotaterb (4.14.0)\n+    annotaterb (4.15.0)\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n---\n\n\n---\n\nChoice C:\napp/lib/admin/system_check/elasticsearch_check.rb\n@@ -38,6 +38,11 @@ def message\n         :elasticsearch_index_mismatch,\n         mismatched_indexes.join(' ')\n       )\n+    elsif !specifications_match?\n+      Admin::SystemCheck::Message.new(\n+        :elasticsearch_analysis_mismatch,\n+        mismatched_specifications_indexes.join(' ')\n+      )\n     elsif cluster_health['status'] == 'red'\n       Admin::SystemCheck::Message.new(:elasticsearch_health_red)\n     elsif cluster_health['number_of_nodes'] < 2 && es_preset != 'single_node_cluster'\n@@ -111,10 +116,20 @@ def mismatched_indexes\n     end\n   end\n \n+  def mismatched_specifications_indexes\n+    @mismatched_specifications_indexes ||= INDEXES.filter_map do |klass|\n+      klass.base_name if klass.specification.changed?\n+    end\n+  end\n+\n   def indexes_match?\n     mismatched_indexes.empty?\n   end\n \n+  def specifications_match?\n+    mismatched_specifications_indexes.empty?\n+  end\n+\n   def es_preset\n     ENV.fetch('ES_PRESET', 'single_node_cluster')\n   end\n---\nconfig/locales/en.yml\n@@ -903,6 +903,8 @@ en:\n     system_checks:\n       database_schema_check:\n         message_html: There are pending database migrations. Please run them to ensure the application behaves as expected\n+      elasticsearch_analysis_index_mismatch:\n+        message_html: Elasticsearch index analyzer settings are outdated. Please run <code>tootctl search deploy --only-mapping --only=%{value}</code>\n       elasticsearch_health_red:\n         message_html: Elasticsearch cluster is unhealthy (red status), search features are unavailable\n       elasticsearch_health_yellow:\n---\n\n\n---\n\nChoice D:\napp/helpers/context_helper.rb\n@@ -26,6 +26,13 @@ module ContextHelper\n     suspended: { 'toot' => 'http://joinmastodon.org/ns#', 'suspended' => 'toot:suspended' },\n     attribution_domains: { 'toot' => 'http://joinmastodon.org/ns#', 'attributionDomains' => { '@id' => 'toot:attributionDomains', '@type' => '@id' } },\n     quote_requests: { 'QuoteRequest' => 'https://w3id.org/fep/044f#QuoteRequest' },\n+    interaction_policies: {\n+      'gts' => 'https://gotosocial.org/ns#',\n+      'interactionPolicy' => { '@id' => 'gts:interactionPolicy', '@type' => '@id' },\n+      'canQuote' => { '@id' => 'gts:canQuote', '@type' => '@id' },\n+      'automaticApproval' => { '@id' => 'gts:automaticApproval', '@type' => '@id' },\n+      'manualApproval' => { '@id' => 'gts:manualApproval', '@type' => '@id' },\n+    },\n   }.freeze\n \n   def full_context\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\n![grafik](https://github.com/user-attachments/assets/0f49e386-8228-4a87-aa47-a1830314f364)\r\n\n\n---\n\nChoice A:\napp/javascript/mastodon/components/featured_carousel.tsx\n@@ -5,6 +5,7 @@ import {\n   useLayoutEffect,\n   useRef,\n   useState,\n+  useId,\n } from 'react';\n \n import { defineMessages, FormattedMessage, useIntl } from 'react-intl';\n@@ -17,12 +18,14 @@ import { animated, useSpring } from '@react-spring/web';\n import { useDrag } from '@use-gesture/react';\n \n import { expandAccountFeaturedTimeline } from '@/mastodon/actions/timelines';\n+import { Icon } from '@/mastodon/components/icon';\n import { IconButton } from '@/mastodon/components/icon_button';\n import StatusContainer from '@/mastodon/containers/status_container';\n import { usePrevious } from '@/mastodon/hooks/usePrevious';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n import ChevronLeftIcon from '@/material-icons/400-24px/chevron_left.svg?react';\n import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react';\n+import PushPinIcon from '@/material-icons/400-24px/push_pin.svg?react';\n \n const messages = defineMessages({\n   previous: { id: 'featured_carousel.previous', defaultMessage: 'Previous' },\n@@ -38,6 +41,7 @@ export const FeaturedCarousel: React.FC<{\n   tagged?: string;\n }> = ({ accountId, tagged }) => {\n   const intl = useIntl();\n+  const accessibilityId = useId();\n \n   // Load pinned statuses\n   const dispatch = useAppDispatch();\n@@ -120,11 +124,15 @@ export const FeaturedCarousel: React.FC<{\n       className='featured-carousel'\n       {...bind()}\n       aria-roledescription='carousel'\n-      aria-labelledby='featured-carousel-title'\n+      aria-labelledby={`${accessibilityId}-title`}\n       role='region'\n     >\n       <div className='featured-carousel__header'>\n-        <h4 className='featured-carousel__title' id='featured-carousel-title'>\n+        <h4\n+          className='featured-carousel__title'\n+          id={`${accessibilityId}-title`}\n+        >\n+          <Icon id='thumb-tack' icon={PushPinIcon} />\n           <FormattedMessage\n             id='featured_carousel.header'\n             defaultMessage='{count, plural, one {Pinned Post} other {Pinned Posts}}'\n---\napp/javascript/styles/mastodon/components.scss\n@@ -11074,5 +11074,13 @@ noscript {\n     font-size: 12px;\n     font-weight: 500;\n     text-transform: uppercase;\n+    display: flex;\n+    align-items: center;\n+    gap: 4px;\n+\n+    .icon {\n+      width: 16px;\n+      height: 16px;\n+    }\n   }\n }\n---\n\n\n---\n\nChoice B:\n.rubocop_todo.yml\n@@ -33,7 +33,6 @@ Style/FetchEnvVar:\n   Exclude:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/paperclip.rb'\n-    - 'lib/tasks/repo.rake'\n \n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: MinBodyLength, AllowConsecutiveConditionals.\n---\nlib/tasks/repo.rake\n@@ -57,7 +57,7 @@ namespace :repo do\n                 response = nil\n \n                 loop do\n-                  response = HTTP.headers('Authorization' => \"token #{ENV['GITHUB_API_TOKEN']}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n+                  response = HTTP.headers('Authorization' => \"token #{ENV.fetch('GITHUB_API_TOKEN')}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n \n                   if response.code == 403\n                     sleep_for = (response.headers['X-RateLimit-Reset'].to_i - Time.now.to_i).abs\n---\n\n\n---\n\nChoice C:\napp/javascript/styles/fonts/roboto-mono.scss\n@@ -2,11 +2,10 @@\n   font-family: mastodon-font-monospace;\n   src:\n     local('Roboto Mono'),\n-    url('../fonts/roboto-mono/robotomono-regular-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto-mono/robotomono-regular-webfont.woff') format('woff'),\n-    url('../fonts/roboto-mono/robotomono-regular-webfont.ttf')\n-      format('truetype'),\n-    url('../fonts/roboto-mono/robotomono-regular-webfont.svg#roboto_monoregular')\n+    url('@/fonts/roboto-mono/robotomono-regular-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto-mono/robotomono-regular-webfont.woff') format('woff'),\n+    url('@/fonts/roboto-mono/robotomono-regular-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto-mono/robotomono-regular-webfont.svg#roboto_monoregular')\n       format('svg');\n   font-weight: 400;\n   font-display: swap;\n---\napp/javascript/styles/fonts/roboto.scss\n@@ -2,10 +2,10 @@\n   font-family: mastodon-font-sans-serif;\n   src:\n     local('Roboto Italic'),\n-    url('../fonts/roboto/roboto-italic-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto/roboto-italic-webfont.woff') format('woff'),\n-    url('../fonts/roboto/roboto-italic-webfont.ttf') format('truetype'),\n-    url('../fonts/roboto/roboto-italic-webfont.svg#roboto-italic-webfont')\n+    url('@/fonts/roboto/roboto-italic-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto/roboto-italic-webfont.woff') format('woff'),\n+    url('@/fonts/roboto/roboto-italic-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto/roboto-italic-webfont.svg#roboto-italic-webfont')\n       format('svg');\n   font-weight: normal;\n   font-display: swap;\n@@ -16,10 +16,10 @@\n   font-family: mastodon-font-sans-serif;\n   src:\n     local('Roboto Bold'),\n-    url('../fonts/roboto/roboto-bold-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto/roboto-bold-webfont.woff') format('woff'),\n-    url('../fonts/roboto/roboto-bold-webfont.ttf') format('truetype'),\n-    url('../fonts/roboto/roboto-bold-webfont.svg#roboto-bold-webfont')\n+    url('@/fonts/roboto/roboto-bold-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto/roboto-bold-webfont.woff') format('woff'),\n+    url('@/fonts/roboto/roboto-bold-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto/roboto-bold-webfont.svg#roboto-bold-webfont')\n       format('svg');\n   font-weight: bold;\n   font-display: swap;\n@@ -30,10 +30,10 @@\n   font-family: mastodon-font-sans-serif;\n   src:\n     local('Roboto Medium'),\n-    url('../fonts/roboto/roboto-medium-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto/roboto-medium-webfont.woff') format('woff'),\n-    url('../fonts/roboto/roboto-medium-webfont.ttf') format('truetype'),\n-    url('../fonts/roboto/roboto-medium-webfont.svg#roboto-medium-webfont')\n+    url('@/fonts/roboto/roboto-medium-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto/roboto-medium-webfont.woff') format('woff'),\n+    url('@/fonts/roboto/roboto-medium-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto/roboto-medium-webfont.svg#roboto-medium-webfont')\n       format('svg');\n   font-weight: 500;\n   font-display: swap;\n@@ -44,10 +44,10 @@\n   font-family: mastodon-font-sans-serif;\n   src:\n     local('Roboto'),\n-    url('../fonts/roboto/roboto-regular-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto/roboto-regular-webfont.woff') format('woff'),\n-    url('../fonts/roboto/roboto-regular-webfont.ttf') format('truetype'),\n-    url('../fonts/roboto/roboto-regular-webfont.svg#roboto-regular-webfont')\n+    url('@/fonts/roboto/roboto-regular-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto/roboto-regular-webfont.woff') format('woff'),\n+    url('@/fonts/roboto/roboto-regular-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto/roboto-regular-webfont.svg#roboto-regular-webfont')\n       format('svg');\n   font-weight: normal;\n   font-display: swap;\n---\napp/javascript/styles/mastodon/admin.scss\n@@ -1438,8 +1438,8 @@ a.sparkline {\n     inset-inline-start: 10px;\n     border-radius: 4px;\n     background:\n-      url('../images/warning-stripes.svg') repeat-y left,\n-      url('../images/warning-stripes.svg') repeat-y right,\n+      url('@/images/warning-stripes.svg') repeat-y left,\n+      url('@/images/warning-stripes.svg') repeat-y right,\n       var(--background-color);\n   }\n \n---\napp/javascript/styles/mastodon/components.scss\n@@ -641,7 +641,7 @@ body > [data-popper-placement] {\n     align-items: stretch;\n \n     &__border {\n-      background: url('../images/warning-stripes.svg') repeat-y;\n+      background: url('@/images/warning-stripes.svg') repeat-y;\n       width: 5px;\n       flex: 0 0 auto;\n \n---\napp/javascript/styles/mastodon/rich_text.scss\n@@ -44,7 +44,7 @@\n       content: '';\n       width: 24px;\n       height: 20px;\n-      mask-image: url('../images/quote.svg');\n+      mask-image: url('@/images/quote.svg');\n       background-color: var(--rich-text-decorations-color);\n       position: absolute;\n       inset-inline-start: 0;\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -110,7 +110,7 @@ group :opentelemetry do\n   gem 'opentelemetry-instrumentation-active_model_serializers', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-concurrent_ruby', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-excon', '~> 0.23.0', require: false\n-  gem 'opentelemetry-instrumentation-faraday', '~> 0.26.0', require: false\n+  gem 'opentelemetry-instrumentation-faraday', '~> 0.27.0', require: false\n   gem 'opentelemetry-instrumentation-http', '~> 0.24.0', require: false\n   gem 'opentelemetry-instrumentation-http_client', '~> 0.23.0', require: false\n   gem 'opentelemetry-instrumentation-net_http', '~> 0.23.0', require: false\n---\nGemfile.lock\n@@ -544,7 +544,7 @@ GEM\n     opentelemetry-instrumentation-excon (0.23.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-faraday (0.26.0)\n+    opentelemetry-instrumentation-faraday (0.27.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n     opentelemetry-instrumentation-http (0.24.0)\n@@ -1026,7 +1026,7 @@ DEPENDENCIES\n   opentelemetry-instrumentation-active_model_serializers (~> 0.22.0)\n   opentelemetry-instrumentation-concurrent_ruby (~> 0.22.0)\n   opentelemetry-instrumentation-excon (~> 0.23.0)\n-  opentelemetry-instrumentation-faraday (~> 0.26.0)\n+  opentelemetry-instrumentation-faraday (~> 0.27.0)\n   opentelemetry-instrumentation-http (~> 0.24.0)\n   opentelemetry-instrumentation-http_client (~> 0.23.0)\n   opentelemetry-instrumentation-net_http (~> 0.23.0)\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\n### Changes proposed in this PR:\r\n- Prevent the height animation when mounting the pinned posts carousel\r\n- Introduces a new `usePrevious` utility hook\r\n\r\n### Screenshots\r\n\r\nhttps://github.com/user-attachments/assets/f2c6d6bb-3d5e-400e-af32-ed46c318efa8\r\n\r\n\n\n---\n\nChoice A:\napp/controllers/concerns/web_app_controller_concern.rb\n@@ -8,6 +8,7 @@ module WebAppControllerConcern\n \n     before_action :redirect_unauthenticated_to_permalinks!\n     before_action :set_referer_header\n+    before_action :redirect_to_tos_interstitial!\n \n     content_security_policy do |p|\n       policy = ContentSecurityPolicy.new\n@@ -45,6 +46,13 @@ def redirect_unauthenticated_to_permalinks!\n \n   protected\n \n+  def redirect_to_tos_interstitial!\n+    return unless current_user&.require_tos_interstitial?\n+\n+    @terms_of_service = TermsOfService.published.first\n+    render 'terms_of_service_interstitial/show', layout: 'auth'\n+  end\n+\n   def set_referer_header\n     response.set_header('Referrer-Policy', Setting.allow_referrer_origin ? 'strict-origin-when-cross-origin' : 'same-origin')\n   end\n---\napp/controllers/terms_of_service_controller.rb\n@@ -4,8 +4,19 @@ class TermsOfServiceController < ApplicationController\n   include WebAppControllerConcern\n \n   skip_before_action :require_functional!\n+  skip_before_action :redirect_to_tos_interstitial!\n+\n+  before_action :clear_redirect_interstitial!\n \n   def show\n     expires_in(15.seconds, public: true, stale_while_revalidate: 30.seconds, stale_if_error: 1.day) unless user_signed_in?\n   end\n+\n+  private\n+\n+  def clear_redirect_interstitial!\n+    return unless user_signed_in?\n+\n+    current_user.update(require_tos_interstitial: false)\n+  end\n end\n---\napp/models/terms_of_service.rb\n@@ -23,6 +23,8 @@ class TermsOfService < ApplicationRecord\n \n   validate :effective_date_cannot_be_in_the_past\n \n+  NOTIFICATION_ACTIVITY_CUTOFF = 1.year.freeze\n+\n   def published?\n     published_at.present?\n   end\n@@ -39,8 +41,20 @@ def notification_sent?\n     notification_sent_at.present?\n   end\n \n+  def base_user_scope\n+    User.confirmed.where(created_at: ..published_at).joins(:account)\n+  end\n+\n+  def email_notification_cutoff\n+    published_at - NOTIFICATION_ACTIVITY_CUTOFF\n+  end\n+\n+  def scope_for_interstitial\n+    base_user_scope.merge(Account.suspended).or(base_user_scope.where(current_sign_in_at: [nil, ...email_notification_cutoff]))\n+  end\n+\n   def scope_for_notification\n-    User.confirmed.joins(:account).merge(Account.without_suspended).where(created_at: (..published_at))\n+    base_user_scope.merge(Account.without_suspended).where(current_sign_in_at: email_notification_cutoff...)\n   end\n \n   private\n---\napp/models/user.rb\n@@ -25,6 +25,7 @@\n #  otp_backup_codes          :string           is an Array\n #  otp_required_for_login    :boolean          default(FALSE), not null\n #  otp_secret                :string\n+#  require_tos_interstitial  :boolean          default(FALSE), not null\n #  reset_password_sent_at    :datetime\n #  reset_password_token      :string\n #  settings                  :text\n---\napp/views/terms_of_service_interstitial/show.html.haml\n@@ -0,0 +1,15 @@\n+- content_for :header_tags do\n+  %meta{ name: 'robots', content: 'noindex, noarchive' }/\n+\n+- content_for :body_classes, 'app-body'\n+\n+.simple_form\n+  %h1.title= t('terms_of_service_interstitial.title', domain: site_hostname)\n+\n+  - effective_date = @terms_of_service.effective_date || Time.zone.today\n+  %p.lead= effective_date.past? ? t('terms_of_service_interstitial.past_preamble_html') : t('terms_of_service_interstitial.future_preamble_html', date: l(effective_date))\n+\n+  %p.lead= t('user_mailer.terms_of_service_changed.agreement', domain: site_hostname)\n+\n+  .stacked-actions\n+    = link_to t('terms_of_service_interstitial.review_link'), terms_of_service_path, class: 'button'\n---\napp/workers/admin/distribute_terms_of_service_notification_worker.rb\n@@ -6,6 +6,8 @@ class Admin::DistributeTermsOfServiceNotificationWorker\n   def perform(terms_of_service_id)\n     terms_of_service = TermsOfService.find(terms_of_service_id)\n \n+    terms_of_service.scope_for_interstitial.in_batches.update_all(require_tos_interstitial: true)\n+\n     terms_of_service.scope_for_notification.find_each do |user|\n       UserMailer.terms_of_service_changed(user, terms_of_service).deliver_later!\n     end\n---\nconfig/locales/en.yml\n@@ -1916,6 +1916,11 @@ en:\n     does_not_match_previous_name: does not match the previous name\n   terms_of_service:\n     title: Terms of Service\n+  terms_of_service_interstitial:\n+    future_preamble_html: We're making some changes to our terms of service, which will be effective on <strong>%{date}</strong>. We encourage you to review the updated terms.\n+    past_preamble_html: We have changed our terms of service since your last visit. We encourage you to review the updated terms.\n+    review_link: Review terms of service\n+    title: The terms of service of %{domain} are changing\n   themes:\n     contrast: Mastodon (High contrast)\n     default: Mastodon (Dark)\n---\ndb/migrate/20250428104538_add_require_tos_interstitial_to_users.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddRequireTosInterstitialToUsers < ActiveRecord::Migration[8.0]\n+  def change\n+    add_column :users, :require_tos_interstitial, :boolean, null: false, default: false\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_28_095029) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_28_104538) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -1222,6 +1222,7 @@\n     t.string \"time_zone\"\n     t.string \"otp_secret\"\n     t.datetime \"age_verified_at\"\n+    t.boolean \"require_tos_interstitial\", default: false, null: false\n     t.index [\"account_id\"], name: \"index_users_on_account_id\"\n     t.index [\"confirmation_token\"], name: \"index_users_on_confirmation_token\", unique: true\n     t.index [\"created_by_application_id\"], name: \"index_users_on_created_by_application_id\", where: \"(created_by_application_id IS NOT NULL)\"\n---\nspec/workers/admin/distribute_terms_of_service_notification_worker_spec.rb\n@@ -14,9 +14,10 @@\n \n     context 'with valid terms' do\n       let(:terms) { Fabricate(:terms_of_service) }\n-      let!(:user) { Fabricate :user, confirmed_at: 3.days.ago }\n+      let!(:user) { Fabricate(:user, confirmed_at: 3.days.ago) }\n+      let!(:old_user) { Fabricate(:user, confirmed_at: 2.years.ago, current_sign_in_at: 2.years.ago) }\n \n-      it 'sends the terms update via email', :inline_jobs do\n+      it 'sends the terms update via email and change the old user to require an interstitial', :inline_jobs do\n         emails = capture_emails { worker.perform(terms.id) }\n \n         expect(emails.size)\n@@ -26,6 +27,9 @@\n             to: [user.email],\n             subject: I18n.t('user_mailer.terms_of_service_changed.subject')\n           )\n+\n+        expect(user.reload.require_tos_interstitial?).to be false\n+        expect(old_user.reload.require_tos_interstitial?).to be true\n       end\n     end\n   end\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/components/featured_carousel.tsx\n@@ -1,5 +1,11 @@\n import type { ComponentPropsWithRef } from 'react';\n-import { useCallback, useEffect, useRef, useState } from 'react';\n+import {\n+  useCallback,\n+  useEffect,\n+  useLayoutEffect,\n+  useRef,\n+  useState,\n+} from 'react';\n \n import { defineMessages, FormattedMessage, useIntl } from 'react-intl';\n \n@@ -13,6 +19,7 @@ import { useDrag } from '@use-gesture/react';\n import { expandAccountFeaturedTimeline } from '@/mastodon/actions/timelines';\n import { IconButton } from '@/mastodon/components/icon_button';\n import StatusContainer from '@/mastodon/containers/status_container';\n+import { usePrevious } from '@/mastodon/hooks/usePrevious';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n import ChevronLeftIcon from '@/material-icons/400-24px/chevron_left.svg?react';\n import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react';\n@@ -74,6 +81,7 @@ export const FeaturedCarousel: React.FC<{\n   const [currentSlideHeight, setCurrentSlideHeight] = useState(\n     wrapperRef.current?.scrollHeight ?? 0,\n   );\n+  const previousSlideHeight = usePrevious(currentSlideHeight);\n   const observerRef = useRef<ResizeObserver>(\n     new ResizeObserver(() => {\n       handleSlideChange(0);\n@@ -82,8 +90,10 @@ export const FeaturedCarousel: React.FC<{\n   const wrapperStyles = useSpring({\n     x: `-${slideIndex * 100}%`,\n     height: currentSlideHeight,\n+    // Don't animate from zero to the height of the initial slide\n+    immediate: !previousSlideHeight,\n   });\n-  useEffect(() => {\n+  useLayoutEffect(() => {\n     // Update slide height when the component mounts\n     if (currentSlideHeight === 0) {\n       handleSlideChange(0);\n---\napp/javascript/mastodon/hooks/usePrevious.ts\n@@ -0,0 +1,16 @@\n+import { useRef, useEffect } from 'react';\n+\n+/**\n+ * Returns the previous state of the passed in value.\n+ * On first render, undefined is returned.\n+ */\n+\n+export function usePrevious<T>(value: T): T | undefined {\n+  const ref = useRef<T>();\n+\n+  useEffect(() => {\n+    ref.current = value;\n+  }, [value]);\n+\n+  return ref.current;\n+}\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -64,7 +64,7 @@ gem 'kaminari', '~> 1.2'\n gem 'link_header', '~> 0.0'\n gem 'linzer', '~> 0.6.1'\n gem 'mario-redis-lock', '~> 1.2', require: 'redis_lock'\n-gem 'mime-types', '~> 3.6.0', require: 'mime/types/columnar'\n+gem 'mime-types', '~> 3.7.0', require: 'mime/types/columnar'\n gem 'mutex_m'\n gem 'nokogiri', '~> 1.15'\n gem 'oj', '~> 3.14'\n---\nGemfile.lock\n@@ -423,10 +423,10 @@ GEM\n       redis (>= 3.0.5)\n     matrix (0.4.2)\n     memory_profiler (1.1.0)\n-    mime-types (3.6.2)\n+    mime-types (3.7.0)\n       logger\n-      mime-types-data (~> 3.2015)\n-    mime-types-data (3.2025.0408)\n+      mime-types-data (~> 3.2025, >= 3.2025.0507)\n+    mime-types-data (3.2025.0507)\n     mini_mime (1.1.5)\n     mini_portile2 (2.8.8)\n     minitest (5.25.5)\n@@ -996,7 +996,7 @@ DEPENDENCIES\n   mail (~> 2.8)\n   mario-redis-lock (~> 1.2)\n   memory_profiler\n-  mime-types (~> 3.6.0)\n+  mime-types (~> 3.7.0)\n   mutex_m\n   net-http (~> 0.6.0)\n   net-ldap (~> 0.18)\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -592,7 +592,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n     orm_adapter (0.5.0)\n     ostruct (0.6.1)\n-    ox (2.14.22)\n+    ox (2.14.23)\n       bigdecimal (>= 3.0)\n     parallel (1.27.0)\n     parser (3.3.8.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34841\r\n\r\n### Changes proposed in this PR:\r\n- Fixes glitchy autoplay in the Audio component\n\n---\n\nChoice A:\nGemfile.lock\n@@ -455,7 +455,7 @@ GEM\n     nokogiri (1.18.8)\n       mini_portile2 (~> 2.8.2)\n       racc (~> 1.4)\n-    oj (3.16.10)\n+    oj (3.16.11)\n       bigdecimal (>= 3.0)\n       ostruct (>= 0.2)\n     omniauth (2.1.3)\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -10092,8 +10092,8 @@ __metadata:\n   linkType: hard\n \n \"ioredis@npm:^5.3.2\":\n-  version: 5.6.0\n-  resolution: \"ioredis@npm:5.6.0\"\n+  version: 5.6.1\n+  resolution: \"ioredis@npm:5.6.1\"\n   dependencies:\n     \"@ioredis/commands\": \"npm:^1.1.1\"\n     cluster-key-slot: \"npm:^1.1.0\"\n@@ -10104,7 +10104,7 @@ __metadata:\n     redis-errors: \"npm:^1.2.0\"\n     redis-parser: \"npm:^3.0.0\"\n     standard-as-callback: \"npm:^2.1.0\"\n-  checksum: 10c0/a885e5146640fc448706871290ef424ffa39af561f7ee3cf1590085209a509f85e99082bdaaf3cd32fa66758aea3fc2055d1109648ddca96fac4944bf2092c30\n+  checksum: 10c0/26ae49cf448e807e454a9bdea5a9dfdcf669e2fdbf2df341900a0fb693c5662fea7e39db3227ce8972d1bda0ba7da9b7410e5163b12d8878a579548d847220ac\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\n.github/workflows/test-ruby.yml\n@@ -143,7 +143,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick libpam-dev\n+          additional-system-dependencies: ffmpeg libpam-dev\n \n       - name: Load database schema\n         run: |\n@@ -173,8 +173,8 @@ jobs:\n         env:\n           CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}\n \n-  test-libvips:\n-    name: Libvips tests\n+  test-imagemagick:\n+    name: ImageMagick tests\n     runs-on: ubuntu-latest\n \n     needs:\n@@ -220,7 +220,7 @@ jobs:\n       CAS_ENABLED: true\n       BUNDLE_WITH: 'pam_authentication test'\n       GITHUB_RSPEC: ${{ matrix.ruby-version == '.ruby-version' && github.event.pull_request && 'true' }}\n-      MASTODON_USE_LIBVIPS: true\n+      MASTODON_USE_LIBVIPS: false\n \n     strategy:\n       fail-fast: false\n@@ -245,7 +245,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg libpam-dev\n+          additional-system-dependencies: ffmpeg imagemagick libpam-dev\n \n       - name: Load database schema\n         run: './bin/rails db:create db:schema:load db:seed'\n@@ -324,7 +324,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick\n+          additional-system-dependencies: ffmpeg\n \n       - name: Set up Javascript environment\n         uses: ./.github/actions/setup-javascript\n@@ -443,7 +443,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick\n+          additional-system-dependencies: ffmpeg\n \n       - name: Set up Javascript environment\n         uses: ./.github/actions/setup-javascript\n---\nconfig/application.rb\n@@ -95,7 +95,7 @@ class Application < Rails::Application\n       require 'mastodon/redis_configuration'\n       ::REDIS_CONFIGURATION = Mastodon::RedisConfiguration.new\n \n-      config.x.use_vips = ENV['MASTODON_USE_LIBVIPS'] == 'true'\n+      config.x.use_vips = ENV['MASTODON_USE_LIBVIPS'] != 'false'\n \n       if config.x.use_vips\n         require_relative '../lib/paperclip/vips_lazy_thumbnail'\n---\nconfig/initializers/deprecations.rb\n@@ -16,3 +16,9 @@\n \n   abort message\n end\n+\n+if ENV['MASTODON_USE_LIBVIPS'] == 'false'\n+  warn <<~MESSAGE\n+    WARNING: Mastodon support for ImageMagick is deprecated and will be removed in future versions. Please consider using libvips instead.\n+  MESSAGE\n+end\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/audio/index.tsx\n@@ -442,11 +442,14 @@ export const Audio: React.FC<{\n     if (typeof startMuted !== 'undefined') {\n       audioRef.current.muted = startMuted;\n     }\n+  }, [setDuration, startTime, startVolume, startMuted]);\n \n+  const handleCanPlayThrough = useCallback(() => {\n     if (startPlaying) {\n-      void audioRef.current.play();\n+      resumeAudio();\n+      void audioRef.current?.play();\n     }\n-  }, [setDuration, startTime, startVolume, startMuted, startPlaying]);\n+  }, [startPlaying, resumeAudio]);\n \n   const seekBy = (time: number) => {\n     if (!audioRef.current) {\n@@ -591,6 +594,7 @@ export const Audio: React.FC<{\n         onPause={handlePause}\n         onProgress={handleProgress}\n         onLoadedData={handleLoadedData}\n+        onCanPlayThrough={handleCanPlayThrough}\n         onTimeUpdate={handleTimeUpdate}\n         onVolumeChange={handleVolumeChange}\n         crossOrigin='anonymous'\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nLong ago, silenced accounts could see posts from other silenced accounts without filtering.\r\n\r\nBefore this PR, this was still the case in some specific contexts, but this was inconsistent.\n\n---\n\nChoice A:\napp/lib/activitypub/activity/create.rb\n@@ -226,8 +226,6 @@ def process_tags\n   end\n \n   def process_quote\n-    return unless Mastodon::Feature.inbound_quotes_enabled?\n-\n     @quote_uri = @status_parser.quote_uri\n     return if @quote_uri.blank?\n \n---\napp/lib/activitypub/activity/quote_request.rb\n@@ -4,7 +4,6 @@ class ActivityPub::Activity::QuoteRequest < ActivityPub::Activity\n   include Payloadable\n \n   def perform\n-    return unless Mastodon::Feature.inbound_quotes_enabled?\n     return if non_matching_uri_hosts?(@account.uri, @json['id'])\n \n     quoted_status = status_from_uri(object_uri)\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -271,8 +271,6 @@ def update_emojis!\n   end\n \n   def update_quote!\n-    return unless Mastodon::Feature.inbound_quotes_enabled?\n-\n     quote_uri = @status_parser.quote_uri\n \n     if quote_uri.present?\n---\nspec/lib/activitypub/activity/create_spec.rb\n@@ -887,7 +887,7 @@ def activity_for_object(json)\n         end\n       end\n \n-      context 'with an unverifiable quote of a known post', feature: :inbound_quotes do\n+      context 'with an unverifiable quote of a known post' do\n         let(:quoted_status) { Fabricate(:status) }\n \n         let(:object_json) do\n@@ -911,7 +911,7 @@ def activity_for_object(json)\n         end\n       end\n \n-      context 'with an unverifiable unknown post', feature: :inbound_quotes do\n+      context 'with an unverifiable unknown post' do\n         let(:unknown_post_uri) { 'https://unavailable.example.com/unavailable-post' }\n \n         let(:object_json) do\n@@ -939,7 +939,7 @@ def activity_for_object(json)\n         end\n       end\n \n-      context 'with a verifiable quote of a known post', feature: :inbound_quotes do\n+      context 'with a verifiable quote of a known post' do\n         let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n         let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n         let(:approval_uri) { 'https://quoted.example.com/quote-approval' }\n---\nspec/lib/activitypub/activity/quote_request_spec.rb\n@@ -2,7 +2,7 @@\n \n require 'rails_helper'\n \n-RSpec.describe ActivityPub::Activity::QuoteRequest, feature: :inbound_quotes do\n+RSpec.describe ActivityPub::Activity::QuoteRequest do\n   let(:sender)    { Fabricate(:account, domain: 'example.com') }\n   let(:recipient) { Fabricate(:account) }\n   let(:quoted_post) { Fabricate(:status, account: recipient) }\n---\nspec/services/activitypub/process_status_update_service_spec.rb\n@@ -435,7 +435,7 @@\n     end\n   end\n \n-  context 'when the status has an existing unverified quote and adds an approval link', feature: :inbound_quotes do\n+  context 'when the status has an existing unverified quote and adds an approval link' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: nil) }\n@@ -500,7 +500,7 @@\n     end\n   end\n \n-  context 'when the status has an existing verified quote and removes an approval link', feature: :inbound_quotes do\n+  context 'when the status has an existing verified quote and removes an approval link' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: approval_uri, state: :accepted) }\n@@ -535,7 +535,7 @@\n     end\n   end\n \n-  context 'when the status adds a verifiable quote', feature: :inbound_quotes do\n+  context 'when the status adds a verifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let(:approval_uri) { 'https://quoted.example.com/approvals/1' }\n@@ -600,7 +600,7 @@\n     end\n   end\n \n-  context 'when the status adds a unverifiable quote', feature: :inbound_quotes do\n+  context 'when the status adds a unverifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let(:approval_uri) { 'https://quoted.example.com/approvals/1' }\n@@ -635,7 +635,7 @@\n     end\n   end\n \n-  context 'when the status removes a verified quote', feature: :inbound_quotes do\n+  context 'when the status removes a verified quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: approval_uri, state: :accepted) }\n@@ -660,7 +660,7 @@\n     end\n   end\n \n-  context 'when the status removes an unverified quote', feature: :inbound_quotes do\n+  context 'when the status removes an unverified quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: nil, state: :pending) }\n@@ -684,7 +684,7 @@\n     end\n   end\n \n-  context 'when the status swaps a verified quote with an unverifiable quote', feature: :inbound_quotes do\n+  context 'when the status swaps a verified quote with an unverifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let(:second_quoted_status) { Fabricate(:status, account: quoted_account) }\n@@ -752,7 +752,7 @@\n     end\n   end\n \n-  context 'when the status swaps a verified quote with another verifiable quote', feature: :inbound_quotes do\n+  context 'when the status swaps a verified quote with another verifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:second_quoted_account) { Fabricate(:account, domain: 'second-quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/locales/en-GB.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Moderated servers\",\n   \"about.contact\": \"Contact:\",\n+  \"about.default_locale\": \"Default\",\n   \"about.disclaimer\": \"Mastodon is free, open-source software, and a trademark of Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Reason not available\",\n   \"about.domain_blocks.preamble\": \"Mastodon generally allows you to view content from and interact with users from any other server in the Fediverse. These are the exceptions that have been made on this particular server.\",\n   \"about.domain_blocks.silenced.explanation\": \"You will generally not see profiles and content from this server, unless you explicitly look it up or opt into it by following.\",\n   \"about.domain_blocks.silenced.title\": \"Limited\",\n   \"about.domain_blocks.suspended.explanation\": \"No data from this server will be processed, stored or exchanged, making any interaction or communication with users from this server impossible.\",\n   \"about.domain_blocks.suspended.title\": \"Suspended\",\n+  \"about.language_label\": \"Language\",\n   \"about.not_available\": \"This information has not been made available on this server.\",\n   \"about.powered_by\": \"Decentralised social media powered by {mastodon}\",\n   \"about.rules\": \"Server rules\",\n@@ -19,10 +21,12 @@\n   \"account.block_domain\": \"Block domain {domain}\",\n   \"account.block_short\": \"Block\",\n   \"account.blocked\": \"Blocked\",\n+  \"account.blocking\": \"Blocking\",\n   \"account.cancel_follow_request\": \"Cancel follow\",\n   \"account.copy\": \"Copy link to profile\",\n   \"account.direct\": \"Privately mention @{name}\",\n   \"account.disable_notifications\": \"Stop notifying me when @{name} posts\",\n+  \"account.domain_blocking\": \"Blocking domain\",\n   \"account.edit_profile\": \"Edit profile\",\n   \"account.enable_notifications\": \"Notify me when @{name} posts\",\n   \"account.endorse\": \"Feature on profile\",\n---\napp/javascript/mastodon/locales/pt-PT.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Servidores moderados\",\n   \"about.contact\": \"Contacto:\",\n+  \"about.default_locale\": \"Padr\u00e3o\",\n   \"about.disclaimer\": \"O Mastodon \u00e9 um software livre, de c\u00f3digo aberto e uma marca registada de Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Motivo n\u00e3o dispon\u00edvel\",\n   \"about.domain_blocks.preamble\": \"O Mastodon geralmente permite ver e interagir com o conte\u00fado de utilizadores de qualquer outra inst\u00e2ncia no fediverso. Estas s\u00e3o as exce\u00e7\u00f5es desta inst\u00e2ncia em espec\u00edfico.\",\n   \"about.domain_blocks.silenced.explanation\": \"Normalmente n\u00e3o ver\u00e1s perfis e conte\u00fados deste servidor, a n\u00e3o ser que os procures explicitamente ou optes por segui-los.\",\n   \"about.domain_blocks.silenced.title\": \"Limitados\",\n   \"about.domain_blocks.suspended.explanation\": \"Nenhum dado deste servidor ser\u00e1 processado, armazenado ou trocado, tornando imposs\u00edvel qualquer intera\u00e7\u00e3o ou comunica\u00e7\u00e3o com os utilizadores a partir deste servidor.\",\n   \"about.domain_blocks.suspended.title\": \"Suspensos\",\n+  \"about.language_label\": \"Idioma\",\n   \"about.not_available\": \"Esta informa\u00e7\u00e3o n\u00e3o foi disponibilizada neste servidor.\",\n   \"about.powered_by\": \"Rede social descentralizada baseada no {mastodon}\",\n   \"about.rules\": \"Regras do servidor\",\n@@ -308,6 +310,8 @@\n   \"emoji_button.search_results\": \"Resultados da pesquisa\",\n   \"emoji_button.symbols\": \"S\u00edmbolos\",\n   \"emoji_button.travel\": \"Viagens e lugares\",\n+  \"empty_column.account_featured.me\": \"Ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n+  \"empty_column.account_featured.other\": \"{acct} ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n   \"empty_column.account_featured_other.unknown\": \"Esta conta ainda n\u00e3o colocou nada em destaque.\",\n   \"empty_column.account_hides_collections\": \"Este utilizador escolheu n\u00e3o disponibilizar esta informa\u00e7\u00e3o\",\n   \"empty_column.account_suspended\": \"Conta suspensa\",\n@@ -341,6 +345,11 @@\n   \"explore.trending_links\": \"Not\u00edcias\",\n   \"explore.trending_statuses\": \"Publica\u00e7\u00f5es\",\n   \"explore.trending_tags\": \"#Etiquetas\",\n+  \"featured_carousel.header\": \"{count, plural, one {Publica\u00e7\u00e3o Afixada} other {Publica\u00e7\u00f5es Afixadas}}\",\n+  \"featured_carousel.next\": \"Seguinte\",\n+  \"featured_carousel.post\": \"Publica\u00e7\u00e3o\",\n+  \"featured_carousel.previous\": \"Anterior\",\n+  \"featured_carousel.slide\": \"{index} de {total}\",\n   \"filter_modal.added.context_mismatch_explanation\": \"Esta categoria de filtro n\u00e3o se aplica ao contexto em que acedeste a esta publica\u00e7\u00e3o. Se pretenderes que esta publica\u00e7\u00e3o seja filtrada tamb\u00e9m neste contexto, ter\u00e1s que editar o filtro.\",\n   \"filter_modal.added.context_mismatch_title\": \"O contexto n\u00e3o coincide!\",\n   \"filter_modal.added.expired_explanation\": \"Esta categoria de filtro expirou, tens de alterar a data de validade para que ele seja aplicado.\",\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -794,7 +794,7 @@ GEM\n     ruby-saml (1.18.0)\n       nokogiri (>= 1.13.10)\n       rexml\n-    ruby-vips (2.2.3)\n+    ruby-vips (2.2.4)\n       ffi (~> 1.12)\n       logger\n     rubyzip (2.4.1)\n---\n\n\n---\n\nChoice D:\napp/lib/status_filter.rb\n@@ -38,7 +38,7 @@ def muting_account?\n   end\n \n   def silenced_account?\n-    !account&.silenced? && status_account_silenced? && !account_following_status_account?\n+    status_account_silenced? && !account_following_status_account?\n   end\n \n   def status_account_silenced?\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nSimilar to other recent ones, just doing auto-correct here.\r\n\r\nThis one definitely has a good opportunity for followup moving to `config_for` ... each of the (cas, saml, oidc) sections are just building big hashes which are then conditionally loaded.\r\n\r\nAnother good improvement would be to a) make the loading at all conditional on the \"enabled\" setting, and then b) use `ENV.fetch` and actually let it raise when required things are missing (as opposed to the \"NEED\" comments in the code now).\n\n---\n\nChoice A:\n.rubocop_todo.yml\n@@ -36,7 +36,6 @@ Rails/OutputSafety:\n Style/FetchEnvVar:\n   Exclude:\n     - 'config/initializers/2_limited_federation_mode.rb'\n-    - 'config/initializers/3_omniauth.rb'\n     - 'config/initializers/paperclip.rb'\n     - 'lib/tasks/repo.rake'\n \n---\nconfig/initializers/3_omniauth.rb\n@@ -12,7 +12,7 @@\n   # CAS strategy\n   if ENV['CAS_ENABLED'] == 'true'\n     cas_options = {}\n-    cas_options[:display_name] = ENV['CAS_DISPLAY_NAME']\n+    cas_options[:display_name] = ENV.fetch('CAS_DISPLAY_NAME', nil)\n     cas_options[:url] = ENV['CAS_URL'] if ENV['CAS_URL']\n     cas_options[:host] = ENV['CAS_HOST'] if ENV['CAS_HOST']\n     cas_options[:port] = ENV['CAS_PORT'] if ENV['CAS_PORT']\n@@ -41,7 +41,7 @@\n   # SAML strategy\n   if ENV['SAML_ENABLED'] == 'true'\n     saml_options = {}\n-    saml_options[:display_name] = ENV['SAML_DISPLAY_NAME']\n+    saml_options[:display_name] = ENV.fetch('SAML_DISPLAY_NAME', nil)\n     saml_options[:assertion_consumer_service_url] = ENV['SAML_ACS_URL'] if ENV['SAML_ACS_URL']\n     saml_options[:issuer] = ENV['SAML_ISSUER'] if ENV['SAML_ISSUER']\n     saml_options[:idp_sso_target_url] = ENV['SAML_IDP_SSO_TARGET_URL'] if ENV['SAML_IDP_SSO_TARGET_URL']\n@@ -73,7 +73,7 @@\n   # OpenID Connect Strategy\n   if ENV['OIDC_ENABLED'] == 'true'\n     oidc_options = {}\n-    oidc_options[:display_name] = ENV['OIDC_DISPLAY_NAME'] # OPTIONAL\n+    oidc_options[:display_name] = ENV.fetch('OIDC_DISPLAY_NAME', nil) # OPTIONAL\n     oidc_options[:issuer] = ENV['OIDC_ISSUER'] if ENV['OIDC_ISSUER'] # NEED\n     oidc_options[:discovery] = ENV['OIDC_DISCOVERY'] == 'true' if ENV['OIDC_DISCOVERY'] # OPTIONAL (default: false)\n     oidc_options[:client_auth_method] = ENV['OIDC_CLIENT_AUTH_METHOD'] if ENV['OIDC_CLIENT_AUTH_METHOD'] # OPTIONAL (default: basic)\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -10092,8 +10092,8 @@ __metadata:\n   linkType: hard\n \n \"ioredis@npm:^5.3.2\":\n-  version: 5.6.0\n-  resolution: \"ioredis@npm:5.6.0\"\n+  version: 5.6.1\n+  resolution: \"ioredis@npm:5.6.1\"\n   dependencies:\n     \"@ioredis/commands\": \"npm:^1.1.1\"\n     cluster-key-slot: \"npm:^1.1.0\"\n@@ -10104,7 +10104,7 @@ __metadata:\n     redis-errors: \"npm:^1.2.0\"\n     redis-parser: \"npm:^3.0.0\"\n     standard-as-callback: \"npm:^2.1.0\"\n-  checksum: 10c0/a885e5146640fc448706871290ef424ffa39af561f7ee3cf1590085209a509f85e99082bdaaf3cd32fa66758aea3fc2055d1109648ddca96fac4944bf2092c30\n+  checksum: 10c0/26ae49cf448e807e454a9bdea5a9dfdcf669e2fdbf2df341900a0fb693c5662fea7e39db3227ce8972d1bda0ba7da9b7410e5163b12d8878a579548d847220ac\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -48,7 +48,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/code-frame@npm:^7.0.0, @babel/code-frame@npm:^7.10.4, @babel/code-frame@npm:^7.26.2, @babel/code-frame@npm:^7.27.1\":\n+\"@babel/code-frame@npm:^7.0.0, @babel/code-frame@npm:^7.10.4, @babel/code-frame@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/code-frame@npm:7.27.1\"\n   dependencies:\n@@ -67,29 +67,29 @@ __metadata:\n   linkType: hard\n \n \"@babel/core@npm:^7.12.3, @babel/core@npm:^7.21.3, @babel/core@npm:^7.22.1, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n-  version: 7.26.10\n-  resolution: \"@babel/core@npm:7.26.10\"\n+  version: 7.27.1\n+  resolution: \"@babel/core@npm:7.27.1\"\n   dependencies:\n     \"@ampproject/remapping\": \"npm:^2.2.0\"\n-    \"@babel/code-frame\": \"npm:^7.26.2\"\n-    \"@babel/generator\": \"npm:^7.26.10\"\n-    \"@babel/helper-compilation-targets\": \"npm:^7.26.5\"\n-    \"@babel/helper-module-transforms\": \"npm:^7.26.0\"\n-    \"@babel/helpers\": \"npm:^7.26.10\"\n-    \"@babel/parser\": \"npm:^7.26.10\"\n-    \"@babel/template\": \"npm:^7.26.9\"\n-    \"@babel/traverse\": \"npm:^7.26.10\"\n-    \"@babel/types\": \"npm:^7.26.10\"\n+    \"@babel/code-frame\": \"npm:^7.27.1\"\n+    \"@babel/generator\": \"npm:^7.27.1\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/helper-module-transforms\": \"npm:^7.27.1\"\n+    \"@babel/helpers\": \"npm:^7.27.1\"\n+    \"@babel/parser\": \"npm:^7.27.1\"\n+    \"@babel/template\": \"npm:^7.27.1\"\n+    \"@babel/traverse\": \"npm:^7.27.1\"\n+    \"@babel/types\": \"npm:^7.27.1\"\n     convert-source-map: \"npm:^2.0.0\"\n     debug: \"npm:^4.1.0\"\n     gensync: \"npm:^1.0.0-beta.2\"\n     json5: \"npm:^2.2.3\"\n     semver: \"npm:^6.3.1\"\n-  checksum: 10c0/e046e0e988ab53841b512ee9d263ca409f6c46e2a999fe53024688b92db394346fa3aeae5ea0866331f62133982eee05a675d22922a4603c3f603aa09a581d62\n+  checksum: 10c0/0fc31f87f5401ac5d375528cb009f4ea5527fc8c5bb5b64b5b22c033b60fd0ad723388933a5f3f5db14e1edd13c958e9dd7e5c68f9b68c767aeb496199c8a4bb\n   languageName: node\n   linkType: hard\n \n-\"@babel/generator@npm:^7.26.10, @babel/generator@npm:^7.27.1\":\n+\"@babel/generator@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/generator@npm:7.27.1\"\n   dependencies:\n@@ -121,7 +121,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.26.5, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n+\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n   version: 7.27.2\n   resolution: \"@babel/helper-compilation-targets@npm:7.27.2\"\n   dependencies:\n@@ -199,7 +199,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-module-transforms@npm:^7.26.0, @babel/helper-module-transforms@npm:^7.27.1\":\n+\"@babel/helper-module-transforms@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/helper-module-transforms@npm:7.27.1\"\n   dependencies:\n@@ -296,17 +296,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helpers@npm:^7.26.10\":\n-  version: 7.26.10\n-  resolution: \"@babel/helpers@npm:7.26.10\"\n+\"@babel/helpers@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helpers@npm:7.27.1\"\n   dependencies:\n-    \"@babel/template\": \"npm:^7.26.9\"\n-    \"@babel/types\": \"npm:^7.26.10\"\n-  checksum: 10c0/f99e1836bcffce96db43158518bb4a24cf266820021f6461092a776cba2dc01d9fc8b1b90979d7643c5c2ab7facc438149064463a52dd528b21c6ab32509784f\n+    \"@babel/template\": \"npm:^7.27.1\"\n+    \"@babel/types\": \"npm:^7.27.1\"\n+  checksum: 10c0/e078257b9342dae2c041ac050276c5a28701434ad09478e6dc6976abd99f721a5a92e4bebddcbca6b1c3a7e8acace56a946340c701aad5e7507d2c87446459ba\n   languageName: node\n   linkType: hard\n \n-\"@babel/parser@npm:^7.1.0, @babel/parser@npm:^7.20.7, @babel/parser@npm:^7.26.10, @babel/parser@npm:^7.27.1\":\n+\"@babel/parser@npm:^7.1.0, @babel/parser@npm:^7.20.7, @babel/parser@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/parser@npm:7.27.1\"\n   dependencies:\n@@ -1292,7 +1292,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/template@npm:^7.26.9, @babel/template@npm:^7.27.1\":\n+\"@babel/template@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/template@npm:7.27.1\"\n   dependencies:\n---\n\n\n---\n\nChoice D:\nconfig/environments/development.rb\n@@ -37,10 +37,8 @@\n \n   config.action_controller.forgery_protection_origin_check = ENV['DISABLE_FORGERY_REQUEST_PROTECTION'].nil?\n \n-  ActiveSupport::Logger.new($stdout).tap do |logger|\n-    logger.formatter = config.log_formatter\n-    config.logger = ActiveSupport::TaggedLogging.new(logger)\n-  end\n+  # Override default file logging in favor of STDOUT logging in dev environment\n+  config.logger = ActiveSupport::TaggedLogging.logger($stdout, formatter: config.log_formatter)\n \n   # Generate random VAPID keys\n   Webpush.generate_key.tap do |vapid_key|\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThe one in devise is a situation sort of like the existing `redirect_with_vary` situation we have ... essentially a false positive where rubocop thinks a raw string is a `format` string, but its not. In this case there's not method to configure ignore for, though, so just use inline disable.\r\n\r\nThe other one I think becomes less readable (or at least, not obviously more readable) when we use the keyword style, so just disable that one as well.\n\n---\n\nChoice A:\napp/javascript/mastodon/components/featured_carousel.tsx\n@@ -1,5 +1,11 @@\n import type { ComponentPropsWithRef } from 'react';\n-import { useCallback, useEffect, useRef, useState } from 'react';\n+import {\n+  useCallback,\n+  useEffect,\n+  useLayoutEffect,\n+  useRef,\n+  useState,\n+} from 'react';\n \n import { defineMessages, FormattedMessage, useIntl } from 'react-intl';\n \n@@ -13,6 +19,7 @@ import { useDrag } from '@use-gesture/react';\n import { expandAccountFeaturedTimeline } from '@/mastodon/actions/timelines';\n import { IconButton } from '@/mastodon/components/icon_button';\n import StatusContainer from '@/mastodon/containers/status_container';\n+import { usePrevious } from '@/mastodon/hooks/usePrevious';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n import ChevronLeftIcon from '@/material-icons/400-24px/chevron_left.svg?react';\n import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react';\n@@ -74,6 +81,7 @@ export const FeaturedCarousel: React.FC<{\n   const [currentSlideHeight, setCurrentSlideHeight] = useState(\n     wrapperRef.current?.scrollHeight ?? 0,\n   );\n+  const previousSlideHeight = usePrevious(currentSlideHeight);\n   const observerRef = useRef<ResizeObserver>(\n     new ResizeObserver(() => {\n       handleSlideChange(0);\n@@ -82,8 +90,10 @@ export const FeaturedCarousel: React.FC<{\n   const wrapperStyles = useSpring({\n     x: `-${slideIndex * 100}%`,\n     height: currentSlideHeight,\n+    // Don't animate from zero to the height of the initial slide\n+    immediate: !previousSlideHeight,\n   });\n-  useEffect(() => {\n+  useLayoutEffect(() => {\n     // Update slide height when the component mounts\n     if (currentSlideHeight === 0) {\n       handleSlideChange(0);\n---\napp/javascript/mastodon/hooks/usePrevious.ts\n@@ -0,0 +1,16 @@\n+import { useRef, useEffect } from 'react';\n+\n+/**\n+ * Returns the previous state of the passed in value.\n+ * On first render, undefined is returned.\n+ */\n+\n+export function usePrevious<T>(value: T): T | undefined {\n+  const ref = useRef<T>();\n+\n+  useEffect(() => {\n+    ref.current = value;\n+  }, [value]);\n+\n+  return ref.current;\n+}\n---\n\n\n---\n\nChoice B:\n.rubocop_todo.yml\n@@ -39,15 +39,6 @@ Style/FetchEnvVar:\n     - 'config/initializers/paperclip.rb'\n     - 'lib/tasks/repo.rake'\n \n-# This cop supports safe autocorrection (--autocorrect).\n-# Configuration parameters: EnforcedStyle, MaxUnannotatedPlaceholdersAllowed, Mode, AllowedMethods, AllowedPatterns.\n-# SupportedStyles: annotated, template, unannotated\n-# AllowedMethods: redirect\n-Style/FormatStringToken:\n-  Exclude:\n-    - 'config/initializers/devise.rb'\n-    - 'lib/paperclip/color_extractor.rb'\n-\n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: MinBodyLength, AllowConsecutiveConditionals.\n Style/GuardClause:\n---\nconfig/initializers/devise.rb\n@@ -394,7 +394,7 @@ def session_cookie\n     config.ldap_uid            = ENV.fetch('LDAP_UID', 'cn')\n     config.ldap_mail           = ENV.fetch('LDAP_MAIL', 'mail')\n     config.ldap_tls_no_verify  = ENV['LDAP_TLS_NO_VERIFY'] == 'true'\n-    config.ldap_search_filter  = ENV.fetch('LDAP_SEARCH_FILTER', '(|(%{uid}=%{email})(%{mail}=%{email}))')\n+    config.ldap_search_filter  = ENV.fetch('LDAP_SEARCH_FILTER', '(|(%<uid>s=%<email>s)(%<mail>s=%<email>s))')\n     config.ldap_uid_conversion_enabled  = ENV['LDAP_UID_CONVERSION_ENABLED'] == 'true'\n     config.ldap_uid_conversion_search   = ENV.fetch('LDAP_UID_CONVERSION_SEARCH', '.,- ')\n     config.ldap_uid_conversion_replace  = ENV.fetch('LDAP_UID_CONVERSION_REPLACE', '_')\n---\nlib/paperclip/color_extractor.rb\n@@ -239,7 +239,7 @@ def palette_from_im_histogram(result, quantity)\n     end\n \n     def rgb_to_hex(rgb)\n-      format('#%02x%02x%02x', rgb.r, rgb.g, rgb.b)\n+      format('#%02x%02x%02x', rgb.r, rgb.g, rgb.b) # rubocop:disable Style/FormatStringToken\n     end\n   end\n end\n---\n\n\n---\n\nChoice C:\n.env.production.sample\n@@ -43,7 +43,6 @@ ES_PASS=password\n # Make sure to use `bundle exec rails secret` to generate secrets\n # -------\n SECRET_KEY_BASE=\n-OTP_SECRET=\n \n # Encryption secrets\n # ------------------\n---\napp.json\n@@ -17,10 +17,6 @@\n       \"description\": \"The secret key base\",\n       \"generator\": \"secret\"\n     },\n-    \"OTP_SECRET\": {\n-      \"description\": \"One-time password secret\",\n-      \"generator\": \"secret\"\n-    },\n     \"SINGLE_USER_MODE\": {\n       \"description\": \"Should the instance run in single user mode? (Disable registrations, redirect to front page)\",\n       \"value\": \"false\",\n---\nlib/tasks/mastodon.rake\n@@ -32,7 +32,7 @@ namespace :mastodon do\n       prompt.say('Single user mode disables registrations and redirects the landing page to your public profile.')\n       env['SINGLE_USER_MODE'] = prompt.yes?('Do you want to enable single user mode?', default: false)\n \n-      %w(SECRET_KEY_BASE OTP_SECRET).each do |key|\n+      %w(SECRET_KEY_BASE).each do |key|\n         env[key] = SecureRandom.hex(64)\n       end\n \n---\nscalingo.json\n@@ -12,10 +12,6 @@\n       \"description\": \"The secret key base\",\n       \"generator\": \"secret\"\n     },\n-    \"OTP_SECRET\": {\n-      \"description\": \"One-time password secret\",\n-      \"generator\": \"secret\"\n-    },\n     \"SINGLE_USER_MODE\": {\n       \"description\": \"Should the instance run in single user mode? (Disable registrations, redirect to front page)\",\n       \"value\": \"false\",\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -66,7 +66,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n+\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n   version: 7.26.10\n   resolution: \"@babel/core@npm:7.26.10\"\n   dependencies:\n@@ -211,10 +211,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.24.0, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5\":\n-  version: 7.26.5\n-  resolution: \"@babel/helper-plugin-utils@npm:7.26.5\"\n-  checksum: 10c0/cdaba71d4b891aa6a8dfbe5bac2f94effb13e5fa4c2c487667fdbaa04eae059b78b28d85a885071f45f7205aeb56d16759e1bed9c118b94b16e4720ef1ab0f65\n+\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5, @babel/helper-plugin-utils@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helper-plugin-utils@npm:7.27.1\"\n+  checksum: 10c0/94cf22c81a0c11a09b197b41ab488d416ff62254ce13c57e62912c85700dc2e99e555225787a4099ff6bae7a1812d622c80fbaeda824b79baa10a6c5ac4cf69b\n   languageName: node\n   linkType: hard\n \n@@ -869,25 +869,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-self@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-self@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea362ff94b535c753f560eb1f5e063dc72bbbca17ed58837a949a7b289d5eacc7b0a28296d1932c94429b168d6040cdee5484a59b9e3c021f169e0ee137e6a27\n+  checksum: 10c0/00a4f917b70a608f9aca2fb39aabe04a60aa33165a7e0105fd44b3a8531630eb85bf5572e9f242f51e6ad2fa38c2e7e780902176c863556c58b5ba6f6e164031\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-source@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-source@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea8e3263c0dc51fbc97c156cc647150a757cc56de10781287353d0ce9b2dcd6b6d93d573c0142d7daf5d6fb554c74fa1971ae60764924ea711161d8458739b63\n+  checksum: 10c0/5e67b56c39c4d03e59e03ba80692b24c5a921472079b63af711b1d250fc37c1733a17069b63537f750f3e937ec44a42b1ee6a46cd23b1a0df5163b17f741f7f2\n   languageName: node\n   linkType: hard\n \n@@ -4135,17 +4135,17 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.2.1\n-  resolution: \"@vitejs/plugin-react@npm:4.2.1\"\n+  version: 4.4.1\n+  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n   dependencies:\n-    \"@babel/core\": \"npm:^7.23.5\"\n-    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.23.3\"\n-    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.23.3\"\n+    \"@babel/core\": \"npm:^7.26.10\"\n+    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n+    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n-    react-refresh: \"npm:^0.14.0\"\n+    react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n-    vite: ^4.2.0 || ^5.0.0\n-  checksum: 10c0/de1eec44d703f32e5b58e776328ca20793657fe991835d15b290230b19a2a08be5d31501d424279ae13ecfed28044c117b69d746891c8d9b92c69e8a8907e989\n+    vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n+  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n   languageName: node\n   linkType: hard\n \n@@ -10069,10 +10069,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-refresh@npm:^0.14.0\":\n-  version: 0.14.0\n-  resolution: \"react-refresh@npm:0.14.0\"\n-  checksum: 10c0/b8ae07ad153357d77830928a7f1fc2df837aabefee907fa273ba04c7643f3b860e986f1d4b7ada9b721c8d79b8c24b5b911a314a1a2398b105f1b13d19ea2b8d\n+\"react-refresh@npm:^0.17.0\":\n+  version: 0.17.0\n+  resolution: \"react-refresh@npm:0.17.0\"\n+  checksum: 10c0/002cba940384c9930008c0bce26cac97a9d5682bc623112c2268ba0c155127d9c178a9a5cc2212d560088d60dfd503edd808669a25f9b377f316a32361d0b23c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nI have been investigating e2e test flakiness, and while I don't have a good explanation of some of them, I was able to reliably reproduce some of the common test failures by reducing Capybara's default wait time, suggesting that some of the test failures may simply be due to Github runner performance.\n\n---\n\nChoice A:\napp/javascript/styles/fonts/roboto-mono.scss\n@@ -2,11 +2,10 @@\n   font-family: mastodon-font-monospace;\n   src:\n     local('Roboto Mono'),\n-    url('../fonts/roboto-mono/robotomono-regular-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto-mono/robotomono-regular-webfont.woff') format('woff'),\n-    url('../fonts/roboto-mono/robotomono-regular-webfont.ttf')\n-      format('truetype'),\n-    url('../fonts/roboto-mono/robotomono-regular-webfont.svg#roboto_monoregular')\n+    url('@/fonts/roboto-mono/robotomono-regular-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto-mono/robotomono-regular-webfont.woff') format('woff'),\n+    url('@/fonts/roboto-mono/robotomono-regular-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto-mono/robotomono-regular-webfont.svg#roboto_monoregular')\n       format('svg');\n   font-weight: 400;\n   font-display: swap;\n---\napp/javascript/styles/fonts/roboto.scss\n@@ -2,10 +2,10 @@\n   font-family: mastodon-font-sans-serif;\n   src:\n     local('Roboto Italic'),\n-    url('../fonts/roboto/roboto-italic-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto/roboto-italic-webfont.woff') format('woff'),\n-    url('../fonts/roboto/roboto-italic-webfont.ttf') format('truetype'),\n-    url('../fonts/roboto/roboto-italic-webfont.svg#roboto-italic-webfont')\n+    url('@/fonts/roboto/roboto-italic-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto/roboto-italic-webfont.woff') format('woff'),\n+    url('@/fonts/roboto/roboto-italic-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto/roboto-italic-webfont.svg#roboto-italic-webfont')\n       format('svg');\n   font-weight: normal;\n   font-display: swap;\n@@ -16,10 +16,10 @@\n   font-family: mastodon-font-sans-serif;\n   src:\n     local('Roboto Bold'),\n-    url('../fonts/roboto/roboto-bold-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto/roboto-bold-webfont.woff') format('woff'),\n-    url('../fonts/roboto/roboto-bold-webfont.ttf') format('truetype'),\n-    url('../fonts/roboto/roboto-bold-webfont.svg#roboto-bold-webfont')\n+    url('@/fonts/roboto/roboto-bold-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto/roboto-bold-webfont.woff') format('woff'),\n+    url('@/fonts/roboto/roboto-bold-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto/roboto-bold-webfont.svg#roboto-bold-webfont')\n       format('svg');\n   font-weight: bold;\n   font-display: swap;\n@@ -30,10 +30,10 @@\n   font-family: mastodon-font-sans-serif;\n   src:\n     local('Roboto Medium'),\n-    url('../fonts/roboto/roboto-medium-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto/roboto-medium-webfont.woff') format('woff'),\n-    url('../fonts/roboto/roboto-medium-webfont.ttf') format('truetype'),\n-    url('../fonts/roboto/roboto-medium-webfont.svg#roboto-medium-webfont')\n+    url('@/fonts/roboto/roboto-medium-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto/roboto-medium-webfont.woff') format('woff'),\n+    url('@/fonts/roboto/roboto-medium-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto/roboto-medium-webfont.svg#roboto-medium-webfont')\n       format('svg');\n   font-weight: 500;\n   font-display: swap;\n@@ -44,10 +44,10 @@\n   font-family: mastodon-font-sans-serif;\n   src:\n     local('Roboto'),\n-    url('../fonts/roboto/roboto-regular-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto/roboto-regular-webfont.woff') format('woff'),\n-    url('../fonts/roboto/roboto-regular-webfont.ttf') format('truetype'),\n-    url('../fonts/roboto/roboto-regular-webfont.svg#roboto-regular-webfont')\n+    url('@/fonts/roboto/roboto-regular-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto/roboto-regular-webfont.woff') format('woff'),\n+    url('@/fonts/roboto/roboto-regular-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto/roboto-regular-webfont.svg#roboto-regular-webfont')\n       format('svg');\n   font-weight: normal;\n   font-display: swap;\n---\napp/javascript/styles/mastodon/admin.scss\n@@ -1438,8 +1438,8 @@ a.sparkline {\n     inset-inline-start: 10px;\n     border-radius: 4px;\n     background:\n-      url('../images/warning-stripes.svg') repeat-y left,\n-      url('../images/warning-stripes.svg') repeat-y right,\n+      url('@/images/warning-stripes.svg') repeat-y left,\n+      url('@/images/warning-stripes.svg') repeat-y right,\n       var(--background-color);\n   }\n \n---\napp/javascript/styles/mastodon/components.scss\n@@ -641,7 +641,7 @@ body > [data-popper-placement] {\n     align-items: stretch;\n \n     &__border {\n-      background: url('../images/warning-stripes.svg') repeat-y;\n+      background: url('@/images/warning-stripes.svg') repeat-y;\n       width: 5px;\n       flex: 0 0 auto;\n \n---\napp/javascript/styles/mastodon/rich_text.scss\n@@ -44,7 +44,7 @@\n       content: '';\n       width: 24px;\n       height: 20px;\n-      mask-image: url('../images/quote.svg');\n+      mask-image: url('@/images/quote.svg');\n       background-color: var(--rich-text-decorations-color);\n       position: absolute;\n       inset-inline-start: 0;\n---\n\n\n---\n\nChoice B:\nspec/support/capybara.rb\n@@ -30,6 +30,10 @@ def common_chrome_options\n \n Capybara.javascript_driver = :headless_chrome\n \n+# Some of the flaky tests seem to be caused by github runners being too slow for the\n+# default timeout of 2 seconds\n+Capybara.default_max_wait_time = 8\n+\n RSpec.configure do |config|\n   config.before(:each, type: :system) do\n     driven_by :rack_test\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/admin/ReportReasonSelector.jsx\n@@ -105,7 +105,7 @@ class ReportReasonSelector extends PureComponent {\n   };\n \n   componentDidMount() {\n-    api(false).get('/api/v1/instance').then(res => {\n+    api(false).get('/api/v2/instance').then(res => {\n       this.setState({\n         rules: res.data.rules,\n       });\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/locales/lt.json\n@@ -19,14 +19,17 @@\n   \"account.block_domain\": \"Blokuoti server\u012f {domain}\",\n   \"account.block_short\": \"Blokuoti\",\n   \"account.blocked\": \"U\u017eblokuota\",\n+  \"account.blocking\": \"Blokavimas\",\n   \"account.cancel_follow_request\": \"At\u0161aukti sekim\u0105\",\n   \"account.copy\": \"Kopijuoti nuorod\u0105 \u012f profil\u012f\",\n   \"account.direct\": \"Priva\u010diai pamin\u0117ti @{name}\",\n   \"account.disable_notifications\": \"Nustoti man prane\u0161ti, kai @{name} paskelbia\",\n+  \"account.domain_blocking\": \"Blokuoti domen\u0105\",\n   \"account.edit_profile\": \"Redaguoti profil\u012f\",\n   \"account.enable_notifications\": \"Prane\u0161ti man, kai @{name} paskelbia\",\n   \"account.endorse\": \"Rodyti profilyje\",\n   \"account.featured\": \"Rodomi\",\n+  \"account.featured.accounts\": \"Profiliai\",\n   \"account.featured.hashtags\": \"Saita\u017eod\u017eiai\",\n   \"account.featured.posts\": \"\u012era\u0161ai\",\n   \"account.featured_tags.last_status_at\": \"Paskutinis \u012fra\u0161as {date}\",\n@@ -39,6 +42,7 @@\n   \"account.following\": \"Sekama\",\n   \"account.following_counter\": \"{count, plural, one {{counter} sekimas} few {{counter} sekimai} many {{counter} sekimo} other {{counter} sekim\u0173}}\",\n   \"account.follows.empty\": \"\u0160is naudotojas dar nieko neseka.\",\n+  \"account.follows_you\": \"Seka tave\",\n   \"account.go_to_profile\": \"Eiti \u012f profil\u012f\",\n   \"account.hide_reblogs\": \"Sl\u0117pti pasidalinimus i\u0161 @{name}\",\n   \"account.in_memoriam\": \"Atminimui.\",\n@@ -53,6 +57,8 @@\n   \"account.mute_notifications_short\": \"Nutildyti prane\u0161imus\",\n   \"account.mute_short\": \"Nutildyti\",\n   \"account.muted\": \"Nutildytas\",\n+  \"account.muting\": \"U\u017etildymas\",\n+  \"account.mutual\": \"J\u016bs sekate vienas kit\u0105\",\n   \"account.no_bio\": \"N\u0117ra pateikto apra\u0161ymo.\",\n   \"account.open_original_page\": \"Atidaryti original\u0173 puslap\u012f\",\n   \"account.posts\": \"\u012era\u0161ai\",\n@@ -61,6 +67,7 @@\n   \"account.report\": \"Prane\u0161ti apie @{name}\",\n   \"account.requested\": \"Laukiama patvirtinimo. Spustel\u0117k, kad at\u0161auktum sekimo pra\u0161ym\u0105\",\n   \"account.requested_follow\": \"{name} papra\u0161\u0117 tave sekti\",\n+  \"account.requests_to_follow_you\": \"Pra\u0161ymai sekti jus\",\n   \"account.share\": \"Bendrinti @{name} profil\u012f\",\n   \"account.show_reblogs\": \"Rodyti pasidalinimus i\u0161 @{name}\",\n   \"account.statuses_counter\": \"{count, plural, one {{counter} \u012fra\u0161as} few {{counter} \u012fra\u0161ai} many {{counter} \u012fra\u0161o} other {{counter} \u012fra\u0161\u0173}}\",\n@@ -255,6 +262,7 @@\n   \"disabled_account_banner.text\": \"Tavo paskyra {disabledAccount} \u0161iuo metu i\u0161jungta.\",\n   \"dismissable_banner.community_timeline\": \"Tai \u2013 naujausi vie\u0161i \u012fra\u0161ai i\u0161 \u017emoni\u0173, kuri\u0173 paskyros talpinamos {domain}.\",\n   \"dismissable_banner.dismiss\": \"Atmesti\",\n+  \"dismissable_banner.explore_links\": \"\u0160iomis naujien\u0173 istorijomis \u0161iandien \\\"Fediverse\\\" dalijamasi da\u017eniausiai. Naujesn\u0117s istorijos, kurias paskelb\u0117 daugiau skirting\u0173 \u017emoni\u0173, u\u017eima auk\u0161tesn\u0119 viet\u0105.\",\n   \"domain_block_modal.block\": \"Blokuoti server\u012f\",\n   \"domain_block_modal.block_account_instead\": \"Blokuoti @{name} vietoj to\",\n   \"domain_block_modal.they_can_interact_with_old_posts\": \"\u017dmon\u0117s i\u0161 \u0161io serverio gali bendrauti su tavo senomis \u012fra\u0161omis.\",\n---\napp/javascript/mastodon/locales/sk.json\n@@ -26,6 +26,8 @@\n   \"account.edit_profile\": \"Upravi\u0165 profil\",\n   \"account.enable_notifications\": \"Zapn\u00fa\u0165 upozornenia na pr\u00edspevky od @{name}\",\n   \"account.endorse\": \"Zobrazi\u0165 na vlastnom profile\",\n+  \"account.featured.accounts\": \"Profily\",\n+  \"account.featured.hashtags\": \"Hashtagy\",\n   \"account.featured.posts\": \"Pr\u00edspevky\",\n   \"account.featured_tags.last_status_at\": \"Posledn\u00fd pr\u00edspevok d\u0148a {date}\",\n   \"account.featured_tags.last_status_never\": \"\u017diadne pr\u00edspevky\",\n@@ -37,6 +39,7 @@\n   \"account.following\": \"Sledovan\u00fd \u00fa\u010det\",\n   \"account.following_counter\": \"{count, plural, one {{counter} sledovan\u00fdch} other {{counter} sledovan\u00fdch}}\",\n   \"account.follows.empty\": \"Tento \u00fa\u010det e\u0161te nikoho nesleduje.\",\n+  \"account.follows_you\": \"Nasleduje \u0165a\",\n   \"account.go_to_profile\": \"Prejs\u0165 na profil\",\n   \"account.hide_reblogs\": \"Skry\u0165 zdie\u013eania od @{name}\",\n   \"account.in_memoriam\": \"In memoriam.\",\n@@ -208,6 +211,7 @@\n   \"confirmations.redraft.confirm\": \"Vymaza\u0165 a prep\u00edsa\u0165\",\n   \"confirmations.redraft.message\": \"Ur\u010dite chcete tento pr\u00edspevok vymaza\u0165 a prep\u00edsa\u0165? Pr\u00eddete o jeho zdie\u013eania a ohviezdi\u010dkovania a odpovede na p\u00f4vodn\u00fd pr\u00edspevok bud\u00fa odl\u00fa\u010den\u00e9.\",\n   \"confirmations.redraft.title\": \"Vymaza\u0165 a prep\u00edsa\u0165 pr\u00edspevok?\",\n+  \"confirmations.remove_from_followers.confirm\": \"Odstr\u00e1ni\u0165 nasledovate\u013ea\",\n   \"confirmations.reply.confirm\": \"Odpoveda\u0165\",\n   \"confirmations.reply.message\": \"Odpovedan\u00edm akur\u00e1t teraz prep\u00ed\u0161e\u0161 spr\u00e1vu, ktor\u00fa m\u00e1\u0161 pr\u00e1ve rozp\u00edsan\u00fa. Si si ist\u00fd/\u00e1, \u017ee chce\u0161 pokra\u010dova\u0165?\",\n   \"confirmations.reply.title\": \"Prep\u00edsa\u0165 pr\u00edspevok?\",\n---\nconfig/locales/nan.yml\n@@ -36,6 +36,25 @@ nan:\n       approved_msg: \u6210\u529f\u5be9\u6838 %{username} \u00ea\u8a3b\u518a\u7533\u8acbah\n       are_you_sure: L\u00ed k\u00e1m\u78ba\u5b9a\uff1f\n       avatar: \u6a19\u982d\n+      by_domain: \u57df\u540d\n+      change_email:\n+        changed_msg: Email\u6539\u6210\u529fah\uff01\n+        current_email: \u73fe\u5728\u00ea email\n+        label: \u6539email\n+        new_email: \u65b0\u00ea email\n+        submit: \u6539email\n+        title: \u66ff %{username} \u6539email\n+      change_role:\n+        changed_msg: \u89d2\u8272\u6539\u6210\u529fah\uff01\n+        edit_roles: \u7ba1\u7406\u7528\u8005\u00ea\u89d2\u8272\n+        label: \u6539\u89d2\u8272\n+        no_role: \u7121\u89d2\u8272\n+        title: \u66ff %{username} \u6539\u89d2\u8272\n+      confirm: \u78ba\u8a8d\n+      confirmed: \u78ba\u8a8dah\n+      confirming: Teh\u78ba\u8a8d\n+      custom: \u81ea\u8a02\n+      delete: Th\u00e2i\u8cc7\u6599\n       deleted: Th\u00e2i\u6389ah\n       demote: \u964d\u7d1a\n       destroyed_msg: Teh-beh th\u00e2i\u6389 %{username} \u00ea\u8cc7\u6599\n@@ -49,15 +68,61 @@ nan:\n       email: \u96fb\u5b50phue\u7bb1\n       email_status: \u96fb\u5b50phue \u00ea\u72c0\u614b\n       enable: \u53d6\u6d88\u51b7\u51cd\n+      enable_sign_in_token_auth: \u555f\u7528\u96fb\u5b50phue \u00ea token\u8a8d\u8b49\n+      enabled: \u555f\u7528ah\n+      enabled_msg: \u6210\u529fk\u0101 %{username} \u00ea\u53e3\u5ea7\u9000\u51b0\n+      followers: \u8ddftu\u00e8 l\u00ed \u00ea\n+      follows: L\u00ed\u8ddftu\u00e8 \u00ea\n+      header: \u5c01\u9762\u00ea\u5716\n+      inbox_url: \u6536\u4ef6kheh-\u00e1 \u00ea URL\n+      invite_request_text: \u52a0\u5165\u00ea\u7406\u7531\n+      invited_by: \u9080\u8acb\u00ea l\u00e2ng\n+      ip: IP\n+      joined: \u52a0\u5165\u00ea\u6642\n       location:\n         all: Kui \u00ea\n         local: \u672c\u5730\n         remote: \u5225\u00ea\u7ad9\n         title: \u4f4d\u7f6e\n+      login_status: \u767b\u5165\u00ea\u72c0\u614b\n+      media_attachments: \u5a92\u9ad4\u00ea\u9644\u4ef6\n+      memorialize: \u8b8a\u505a\u6545\u4eba\u00ea\u53e3\u5ea7\n+      memorialized: \u8b8a\u505a\u6545\u4eba\u00ea\u53e3\u5ea7ah\n+      memorialized_msg: \u6210\u529fk\u0101 %{username} \u8b8a\u505a\u6545\u4eba\u00ea\u53e3\u5ea7ah\n+      moderation:\n+        active: \u6d3b\u00ea\n+        all: \u5168\u90e8\n+        disabled: \u505c\u6b62\u4f7f\u7528ah\n+        pending: Teh\u5be9\u6838\n+        silenced: \u53d7\u9650\u5236\n+        suspended: \u6b0a\u9650\u4e2d\u6b62ah\n+        title: \u7ba1\u7406\n+      moderation_notes: \u7ba1\u7406\u00ea\u8a3b\u91cb\n+      most_recent_activity: \u6700\u8fd1\u00ea\u6d3b\u52d5\u6642\u9593\n+      most_recent_ip: \u6700\u8fd1\u00ea IP\n+      no_account_selected: \u56e0\u70ba\u7121\u63c0\u4efb\u4f55\u53e3\u5ea7\uff0c\u6240\u4ee5l\u00f3ng\u7121\u6539\u8b8a\n+      no_limits_imposed: \u7121\u53d7\u8457\u9650\u5236\n+      no_role_assigned: \u7121\u5206\u8457\u89d2\u8272\n+      not_subscribed: \u7121\u8a02\n+      pending: Teh\u7b49\u5be9\u6838\n+      perform_full_suspension: \u4e2d\u6b62\u6b0a\u9650\n+      previous_strikes: Khah\u65e9\u00ea\u8655\u4efd\n       remove_avatar: Th\u00e2i\u6389\u6a19\u982d\n       removed_avatar_msg: \u6210\u529fth\u00e2i\u6389 %{username} \u00ea \u6a19\u982d\u5f71\u50cf\n+      username: \u7528\u8005\u00ea\u540d\n+      view_domain: \u770b\u57df\u540d\u00ea\u6458\u8981\n+      warn: \u8b66\u544a\n+      web: \u7db2\u9801\n+      whitelisted: \u5141\u51c6\u4f47\u806f\u90a6\u50b3\u8cc7\u6599\n     action_logs:\n       action_types:\n+        approve_appeal: \u6279\u51c6\u6295\u8a34\n+        approve_user: \u6279\u51c6\u7528\u8005\n+        assigned_to_self_report: \u5206\u914d\u6aa2\u8209\n+        change_email_user: \u66ff\u7528\u8005\u6539email\n+        change_role_user: \u6539\u7528\u8005\u00ea\u89d2\u8272\n+        confirm_user: \u78ba\u8a8d\u7528\u8005\n+        create_account_warning: \u5efa\u7acb\u8b66\u544a\n         remove_avatar_user: Th\u00e2i\u6389\u6a19\u982d\n       actions:\n         remove_avatar_user_html: \"%{name} th\u00e2i\u6389 %{target} \u00ea\u6a19\u982d\"\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34852. The direction on the `touch-action` attribute was incorrect.\n\n---\n\nChoice A:\napp/models/concerns/status/safe_reblog_insert.rb\n@@ -16,7 +16,7 @@ module Status::SafeReblogInsert\n     # The code is kept similar to ActiveRecord::Persistence code and calls it\n     # directly when we are not handling a reblog.\n     #\n-    # https://github.com/rails/rails/blob/v7.2.1.1/activerecord/lib/active_record/persistence.rb#L238-L263\n+    # https://github.com/rails/rails/blob/v8.0.2/activerecord/lib/active_record/persistence.rb#L238-L261\n     def _insert_record(connection, values, returning)\n       return super unless values.is_a?(Hash) && values['reblog_of_id']&.value.present?\n \n@@ -36,15 +36,13 @@ def _insert_record(connection, values, returning)\n       # Instead, we use a custom builder when a reblog is happening:\n       im = _compile_reblog_insert(values)\n \n-      with_connection do |_c|\n-        connection.insert(\n-          im, \"#{self} Create\", primary_key || false, primary_key_value,\n-          returning: returning\n-        ).tap do |result|\n-          # Since we are using SELECT instead of VALUES, a non-error `nil` return is possible.\n-          # For our purposes, it's equivalent to a foreign key constraint violation\n-          raise ActiveRecord::InvalidForeignKey, \"(reblog_of_id)=(#{values['reblog_of_id'].value}) is not present in table \\\"statuses\\\"\" if result.nil?\n-        end\n+      connection.insert(\n+        im, \"#{self} Create\", primary_key || false, primary_key_value,\n+        returning: returning\n+      ).tap do |result|\n+        # Since we are using SELECT instead of VALUES, a non-error `nil` return is possible.\n+        # For our purposes, it's equivalent to a foreign key constraint violation\n+        raise ActiveRecord::InvalidForeignKey, \"(reblog_of_id)=(#{values['reblog_of_id'].value}) is not present in table \\\"statuses\\\"\" if result.nil?\n       end\n     end\n \n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -160,7 +160,7 @@ GEM\n     cocoon (1.2.15)\n     color_diff (0.1)\n     concurrent-ruby (1.3.5)\n-    connection_pool (2.5.1)\n+    connection_pool (2.5.2)\n     cose (1.3.1)\n       cbor (~> 0.5.9)\n       openssl-signature_algorithm (~> 1.0)\n---\n\n\n---\n\nChoice C:\napp/javascript/styles/mastodon/components.scss\n@@ -11044,7 +11044,7 @@ noscript {\n   overflow: hidden;\n   flex-shrink: 0;\n   border-bottom: 1px solid var(--background-border-color);\n-  touch-action: pan-x;\n+  touch-action: pan-y;\n \n   &__slides {\n     display: flex;\n---\n\n\n---\n\nChoice D:\napp/javascript/styles/mastodon/admin.scss\n@@ -3,7 +3,7 @@\n @use 'variables' as *;\n \n $no-columns-breakpoint: 890px;\n-$sidebar-width: 300px;\n+$sidebar-width: 360px;\n $content-width: 840px;\n \n .admin-wrapper {\n@@ -180,8 +180,8 @@ $content-width: 840px;\n   .content {\n     padding-top: 55px;\n     padding-bottom: 20px;\n-    padding-inline-start: 25px;\n-    padding-inline-end: 15px;\n+    padding-inline-start: 15px;\n+    padding-inline-end: 5px;\n \n     @media screen and (max-width: $no-columns-breakpoint) {\n       max-width: none;\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [fabrication](https://fabricationgem.org) ([source](https://gitlab.com/fabrication-gem/fabrication), [changelog](https://gitlab.com/fabrication-gem/fabrication/-/blob/master/Changelog.markdown)) | `'~> 2.30'` -> `'~> 3.0'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/fabrication/3.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/fabrication/3.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/fabrication/2.31.0/3.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/fabrication/2.31.0/3.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>fabrication-gem/fabrication (fabrication)</summary>\n\n### [`v3.0.0`](https://gitlab.com/fabrication-gem/fabrication/blob/HEAD/Changelog.markdown#300-)\n\n[Compare Source](https://gitlab.com/fabrication-gem/fabrication/compare/2.31.0...3.0.0)\n\n-   Add support for supported Ruby versions through 3.4\n-   Drop support for Ruby 3.1 and below\n-   Add support for Rails versions through 8.0\n-   Drop support for Rails 7.0 and below\n-   Add support for Mongoid versions through 9.x\n-   Drop support for Mongoid 7.x and below\n-   Drop support for DataMapper\n-   Fix RuboCop warnings\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4zMy42IiwidXBkYXRlZEluVmVyIjoiNDAuMzMuNiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -48,7 +48,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/code-frame@npm:^7.0.0, @babel/code-frame@npm:^7.10.4, @babel/code-frame@npm:^7.26.2, @babel/code-frame@npm:^7.27.1\":\n+\"@babel/code-frame@npm:^7.0.0, @babel/code-frame@npm:^7.10.4, @babel/code-frame@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/code-frame@npm:7.27.1\"\n   dependencies:\n@@ -67,29 +67,29 @@ __metadata:\n   linkType: hard\n \n \"@babel/core@npm:^7.12.3, @babel/core@npm:^7.21.3, @babel/core@npm:^7.22.1, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n-  version: 7.26.10\n-  resolution: \"@babel/core@npm:7.26.10\"\n+  version: 7.27.1\n+  resolution: \"@babel/core@npm:7.27.1\"\n   dependencies:\n     \"@ampproject/remapping\": \"npm:^2.2.0\"\n-    \"@babel/code-frame\": \"npm:^7.26.2\"\n-    \"@babel/generator\": \"npm:^7.26.10\"\n-    \"@babel/helper-compilation-targets\": \"npm:^7.26.5\"\n-    \"@babel/helper-module-transforms\": \"npm:^7.26.0\"\n-    \"@babel/helpers\": \"npm:^7.26.10\"\n-    \"@babel/parser\": \"npm:^7.26.10\"\n-    \"@babel/template\": \"npm:^7.26.9\"\n-    \"@babel/traverse\": \"npm:^7.26.10\"\n-    \"@babel/types\": \"npm:^7.26.10\"\n+    \"@babel/code-frame\": \"npm:^7.27.1\"\n+    \"@babel/generator\": \"npm:^7.27.1\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/helper-module-transforms\": \"npm:^7.27.1\"\n+    \"@babel/helpers\": \"npm:^7.27.1\"\n+    \"@babel/parser\": \"npm:^7.27.1\"\n+    \"@babel/template\": \"npm:^7.27.1\"\n+    \"@babel/traverse\": \"npm:^7.27.1\"\n+    \"@babel/types\": \"npm:^7.27.1\"\n     convert-source-map: \"npm:^2.0.0\"\n     debug: \"npm:^4.1.0\"\n     gensync: \"npm:^1.0.0-beta.2\"\n     json5: \"npm:^2.2.3\"\n     semver: \"npm:^6.3.1\"\n-  checksum: 10c0/e046e0e988ab53841b512ee9d263ca409f6c46e2a999fe53024688b92db394346fa3aeae5ea0866331f62133982eee05a675d22922a4603c3f603aa09a581d62\n+  checksum: 10c0/0fc31f87f5401ac5d375528cb009f4ea5527fc8c5bb5b64b5b22c033b60fd0ad723388933a5f3f5db14e1edd13c958e9dd7e5c68f9b68c767aeb496199c8a4bb\n   languageName: node\n   linkType: hard\n \n-\"@babel/generator@npm:^7.26.10, @babel/generator@npm:^7.27.1\":\n+\"@babel/generator@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/generator@npm:7.27.1\"\n   dependencies:\n@@ -121,7 +121,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.26.5, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n+\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n   version: 7.27.2\n   resolution: \"@babel/helper-compilation-targets@npm:7.27.2\"\n   dependencies:\n@@ -199,7 +199,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-module-transforms@npm:^7.26.0, @babel/helper-module-transforms@npm:^7.27.1\":\n+\"@babel/helper-module-transforms@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/helper-module-transforms@npm:7.27.1\"\n   dependencies:\n@@ -296,17 +296,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helpers@npm:^7.26.10\":\n-  version: 7.26.10\n-  resolution: \"@babel/helpers@npm:7.26.10\"\n+\"@babel/helpers@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helpers@npm:7.27.1\"\n   dependencies:\n-    \"@babel/template\": \"npm:^7.26.9\"\n-    \"@babel/types\": \"npm:^7.26.10\"\n-  checksum: 10c0/f99e1836bcffce96db43158518bb4a24cf266820021f6461092a776cba2dc01d9fc8b1b90979d7643c5c2ab7facc438149064463a52dd528b21c6ab32509784f\n+    \"@babel/template\": \"npm:^7.27.1\"\n+    \"@babel/types\": \"npm:^7.27.1\"\n+  checksum: 10c0/e078257b9342dae2c041ac050276c5a28701434ad09478e6dc6976abd99f721a5a92e4bebddcbca6b1c3a7e8acace56a946340c701aad5e7507d2c87446459ba\n   languageName: node\n   linkType: hard\n \n-\"@babel/parser@npm:^7.1.0, @babel/parser@npm:^7.20.7, @babel/parser@npm:^7.26.10, @babel/parser@npm:^7.27.1\":\n+\"@babel/parser@npm:^7.1.0, @babel/parser@npm:^7.20.7, @babel/parser@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/parser@npm:7.27.1\"\n   dependencies:\n@@ -1292,7 +1292,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/template@npm:^7.26.9, @babel/template@npm:^7.27.1\":\n+\"@babel/template@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/template@npm:7.27.1\"\n   dependencies:\n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -201,7 +201,7 @@ group :development, :test do\n   gem 'faker', '~> 3.2'\n \n   # Generate factory objects\n-  gem 'fabrication', '~> 2.30'\n+  gem 'fabrication', '~> 3.0'\n \n   # Profiling tools\n   gem 'memory_profiler', require: false\n---\nGemfile.lock\n@@ -223,7 +223,7 @@ GEM\n       tzinfo\n     excon (1.2.5)\n       logger\n-    fabrication (2.31.0)\n+    fabrication (3.0.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n     faraday (2.13.1)\n@@ -972,7 +972,7 @@ DEPENDENCIES\n   doorkeeper (~> 5.6)\n   dotenv\n   email_spec\n-  fabrication (~> 2.30)\n+  fabrication (~> 3.0)\n   faker (~> 3.2)\n   faraday-httpclient\n   fast_blank (~> 1.0)\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/api.ts\n@@ -83,6 +83,7 @@ export default function api(withAuthorization = true) {\n   return instance;\n }\n \n+type ApiUrl = `v${1 | 2}/${string}`;\n type RequestParamsOrData = Record<string, unknown>;\n \n export async function apiRequest<ApiResponse = unknown>(\n@@ -105,28 +106,28 @@ export async function apiRequest<ApiResponse = unknown>(\n }\n \n export async function apiRequestGet<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   params?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('GET', url, { params });\n }\n \n export async function apiRequestPost<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   data?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('POST', url, { data });\n }\n \n export async function apiRequestPut<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   data?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('PUT', url, { data });\n }\n \n export async function apiRequestDelete<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   params?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('DELETE', url, { params });\n---\napp/javascript/mastodon/api/accounts.ts\n@@ -36,6 +36,6 @@ export const apiGetEndorsedAccounts = (id: string) =>\n   apiRequestGet<ApiAccountJSON>(`v1/accounts/${id}/endorsements`);\n \n export const apiGetFamiliarFollowers = (id: string) =>\n-  apiRequestGet<ApiFamiliarFollowersJSON>('/v1/accounts/familiar_followers', {\n+  apiRequestGet<ApiFamiliarFollowersJSON>('v1/accounts/familiar_followers', {\n     id,\n   });\n---\napp/javascript/mastodon/api/polls.ts\n@@ -2,9 +2,9 @@ import { apiRequestGet, apiRequestPost } from 'mastodon/api';\n import type { ApiPollJSON } from 'mastodon/api_types/polls';\n \n export const apiGetPoll = (pollId: string) =>\n-  apiRequestGet<ApiPollJSON>(`/v1/polls/${pollId}`);\n+  apiRequestGet<ApiPollJSON>(`v1/polls/${pollId}`);\n \n export const apiPollVote = (pollId: string, choices: string[]) =>\n-  apiRequestPost<ApiPollJSON>(`/v1/polls/${pollId}/votes`, {\n+  apiRequestPost<ApiPollJSON>(`v1/polls/${pollId}/votes`, {\n     choices,\n   });\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.7.0\":\n-  version: 2.7.0\n-  resolution: \"pg-connection-string@npm:2.7.0\"\n-  checksum: 10c0/50a1496a1c858f9495d78a2c7a66d93ef3602e718aff2953bb5738f3ea616d7f727f32fc20513c9bed127650cd14c1ddc7b458396f4000e689d4b64c65c5c51e\n+  version: 2.8.1\n+  resolution: \"pg-connection-string@npm:2.8.1\"\n+  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [aws-sdk-core](https://redirect.github.com/aws/aws-sdk-ruby) ([source](https://redirect.github.com/aws/aws-sdk-ruby/tree/HEAD/gems/aws-sdk-core), [changelog](https://redirect.github.com/aws/aws-sdk-ruby/tree/version-3/gems/aws-sdk-core/CHANGELOG.md)) | `'< 3.216.0'` -> `'< 3.224.2'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/aws-sdk-core/3.224.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/aws-sdk-core/3.224.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/aws-sdk-core/3.215.1/3.224.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/aws-sdk-core/3.215.1/3.224.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>aws/aws-sdk-ruby (aws-sdk-core)</summary>\n\n### [`v3.224.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32241-2025-05-28)\n\n-   Issue - Signal data in http response listeners prior to writing, so that data can be inspected or verified before potential mutation.\n\n### [`v3.224.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32240-2025-05-12)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n-   Feature - Support `ENV['AWS_DISABLE_HOST_PREFIX_INJECTION']` and `disable_host_prefix_injection` shared config to disable host prefix injection for all services.\n\n### [`v3.223.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32230-2025-05-01)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n### [`v3.222.3`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32223-2025-04-28)\n\n-   Issue - Do not dynamically create operation methods from the API. ([#&#8203;3234](https://redirect.github.com/aws/aws-sdk-ruby/issues/3234))\n\n### [`v3.222.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32222-2025-04-16)\n\n-   Issue - Additional metrics collection for credentials in the User-Agent plugin.\n\n### [`v3.222.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32221-2025-03-28)\n\n-   Issue - Allow explicit modeled headers to override prefixed headers for `rest` protocols.\n\n### [`v3.222.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32220-2025-03-27)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - This release adds AwsAdditionalDetails in the CreateTokenWithIAM API response.\n\n### [`v3.221.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32210-2025-03-24)\n\n-   Feature - Add `logger` as an explicit dependency for Ruby 3.5.\n-   Issue - Enable ALPN over TLS for H2 Connection by default.\n-   Issue - Fix HTTP-2 connections to properly use config values configured on the client.\n\n### [`v3.220.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32202-2025-03-20)\n\n-   Issue - Enable ALPN over TLS for H2 by default.\n\n### [`v3.220.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32201-2025-03-06)\n\n-   Issue - Convert stubs at request time.\n\n### [`v3.220.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32200-2025-03-04)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n### [`v3.219.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32190-2025-02-18)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.218.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32181-2025-02-07)\n\n-   Issue - Add handling of block in ExtendedSession delegation ([#&#8203;3178](https://redirect.github.com/aws/aws-sdk-ruby/issues/3178)).\n\n### [`v3.218.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32180-2025-02-06)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.217.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32171-2025-01-30)\n\n-   Issue - Add `transfer-encoding` and `connection` to list of unsigned sigv4 headers.\n\n### [`v3.217.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32170-2025-01-24)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Fixed typos in the descriptions.\n\n### [`v3.216.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32161-2025-01-22)\n\n-   Issue - Use epoch seconds instead of milliseconds in cbor encode/decode.\n\n-   Issue - Add handling of block in response delegation ([#&#8203;3169](https://redirect.github.com/aws/aws-sdk-ruby/issues/3169)).\n\n### [`v3.216.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32160-2025-01-15)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n-   Feature - Always calculate request checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:request_checksum_calculation`, in the shared config file as `request_checksum_calculation`, and in the ENV as `ENV['AWS_REQUEST_CHECKSUM_CALCULATION']`.\n\n-   Feature - Always validate response checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:response_checksum_validation`, in the shared config file as `response_checksum_validation`, and in the ENV as `ENV['AWS_RESPONSE_CHECKSUM_VALIDATION']`.\n\n-   Feature - Support CRC64NVME checksums through the `aws-crt` gem.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4zMy42IiwidXBkYXRlZEluVmVyIjoiNDAuMzMuNiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\n.ruby-version\n@@ -1 +1 @@\n-3.4.2\n+3.4.3\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/components/hover_card_account.tsx\n@@ -45,6 +45,19 @@ export const HoverCardAccount = forwardRef<\n \n   const { familiarFollowers } = useFetchFamiliarFollowers({ accountId });\n \n+  const relationship = useAppSelector((state) =>\n+    accountId ? state.relationships.get(accountId) : undefined,\n+  );\n+  const isMutual = relationship?.followed_by && relationship.following;\n+  const isFollower = relationship?.followed_by;\n+  const hasRelationshipLoaded = !!relationship;\n+\n+  const shouldDisplayFamiliarFollowers =\n+    familiarFollowers.length > 0 &&\n+    hasRelationshipLoaded &&\n+    !isMutual &&\n+    !isFollower;\n+\n   return (\n     <div\n       ref={ref}\n@@ -85,7 +98,7 @@ export const HoverCardAccount = forwardRef<\n               value={account.followers_count}\n               renderer={FollowersCounter}\n             />\n-            {familiarFollowers.length > 0 && (\n+            {shouldDisplayFamiliarFollowers && (\n               <>\n                 &middot;\n                 <div className='hover-card__familiar-followers'>\n@@ -101,6 +114,22 @@ export const HoverCardAccount = forwardRef<\n                 </div>\n               </>\n             )}\n+            {(isMutual || isFollower) && (\n+              <>\n+                &middot;\n+                {isMutual ? (\n+                  <FormattedMessage\n+                    id='account.mutual'\n+                    defaultMessage='You follow each other'\n+                  />\n+                ) : (\n+                  <FormattedMessage\n+                    id='account.follows_you'\n+                    defaultMessage='Follows you'\n+                  />\n+                )}\n+              </>\n+            )}\n           </div>\n \n           <FollowButton accountId={accountId} />\n---\napp/javascript/styles/mastodon/components.scss\n@@ -10766,7 +10766,7 @@ noscript {\n     display: flex;\n     align-items: center;\n     flex-wrap: wrap;\n-    gap: 10px;\n+    gap: 2px 10px;\n   }\n \n   &__numbers {\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -13,7 +13,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.224.2', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1103.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1108.0)\n+    aws-sdk-core (3.224.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -945,7 +947,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.224.2)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -455,7 +455,7 @@ GEM\n     nokogiri (1.18.8)\n       mini_portile2 (~> 2.8.2)\n       racc (~> 1.4)\n-    oj (3.16.10)\n+    oj (3.16.11)\n       bigdecimal (>= 3.0)\n       ostruct (>= 0.2)\n     omniauth (2.1.3)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [oj](http://www.ohler.com/oj/) ([source](https://redirect.github.com/ohler55/oj), [changelog](https://redirect.github.com/ohler55/oj/blob/master/CHANGELOG.md)) | `3.16.10` -> `3.16.11` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/oj/3.16.11?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/oj/3.16.11?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/oj/3.16.10/3.16.11?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/oj/3.16.10/3.16.11?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>ohler55/oj (oj)</summary>\n\n### [`v3.16.11`](https://redirect.github.com/ohler55/oj/blob/HEAD/CHANGELOG.md#31611---2025-05-29)\n\n[Compare Source](https://redirect.github.com/ohler55/oj/compare/v3.16.10...v3.16.11)\n\n-   Fixed range encoding with the :circular option\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4zMy42IiwidXBkYXRlZEluVmVyIjoiNDAuMzMuNiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -455,7 +455,7 @@ GEM\n     nokogiri (1.18.8)\n       mini_portile2 (~> 2.8.2)\n       racc (~> 1.4)\n-    oj (3.16.10)\n+    oj (3.16.11)\n       bigdecimal (>= 3.0)\n       ostruct (>= 0.2)\n     omniauth (2.1.3)\n---\n\n\n---\n\nChoice B:\n.rubocop_todo.yml\n@@ -39,7 +39,6 @@ Style/FetchEnvVar:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/3_omniauth.rb'\n     - 'config/initializers/cache_buster.rb'\n-    - 'config/initializers/devise.rb'\n     - 'config/initializers/paperclip.rb'\n     - 'config/initializers/vapid.rb'\n     - 'lib/tasks/repo.rake'\n---\nconfig/initializers/devise.rb\n@@ -377,7 +377,7 @@ def session_cookie\n     config.usernamefield          = nil\n     config.emailfield             = 'email'\n     config.check_at_sign          = true\n-    config.pam_default_suffix     = ENV.fetch('PAM_EMAIL_DOMAIN') { ENV['LOCAL_DOMAIN'] }\n+    config.pam_default_suffix     = ENV.fetch('PAM_EMAIL_DOMAIN') { ENV.fetch('LOCAL_DOMAIN', nil) }\n     config.pam_default_service    = ENV.fetch('PAM_DEFAULT_SERVICE') { 'rpam' }\n     config.pam_controlled_service = ENV.fetch('PAM_CONTROLLED_SERVICE', nil).presence\n   end\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.223.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1096.0)\n+    aws-sdk-core (3.223.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.223.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -14795,8 +14795,8 @@ __metadata:\n   linkType: hard\n \n \"react-intl@npm:^7.1.10\":\n-  version: 7.1.10\n-  resolution: \"react-intl@npm:7.1.10\"\n+  version: 7.1.11\n+  resolution: \"react-intl@npm:7.1.11\"\n   dependencies:\n     \"@formatjs/ecma402-abstract\": \"npm:2.3.4\"\n     \"@formatjs/icu-messageformat-parser\": \"npm:2.11.2\"\n@@ -14812,7 +14812,7 @@ __metadata:\n   peerDependenciesMeta:\n     typescript:\n       optional: true\n-  checksum: 10c0/7d47ac7e2284eb6d920d26d5cdcfee33f54805eb27284dab969ac931139c5eacb2b24f60c8e7645a623b768d0fdfa5dfc4df63a9270301d57aa356ddf231c484\n+  checksum: 10c0/f20770fb7bcce7a67acec70b9183f5320b7f3f9bbcb263ca8f4787817297674d1be158687f94d1e2803a9c8696d4f93dd86a28898aba8bc5197e858313e3dd06\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nSimple rename on the enabled check, other parts are just moving a hash. Preserves default values.\n\n---\n\nChoice A:\nGemfile.lock\n@@ -94,7 +94,7 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n+    aws-partitions (1.1103.0)\n     aws-sdk-core (3.215.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n@@ -109,7 +109,7 @@ GEM\n       aws-sigv4 (~> 1.5)\n     aws-sigv4 (1.11.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n-    azure-blob (0.5.7)\n+    azure-blob (0.5.8)\n       rexml\n     base64 (0.2.0)\n     bcp47_spec (0.2.1)\n@@ -124,7 +124,7 @@ GEM\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n-    bootsnap (1.18.5)\n+    bootsnap (1.18.6)\n       msgpack (~> 1.2)\n     brakeman (7.0.2)\n       racc\n@@ -194,7 +194,7 @@ GEM\n     devise_pam_authenticatable2 (9.2.0)\n       devise (>= 4.0.0)\n       rpam2 (~> 4.0)\n-    diff-lcs (1.6.1)\n+    diff-lcs (1.6.2)\n     discard (1.4.0)\n       activerecord (>= 4.2, < 9.0)\n     docile (1.4.1)\n@@ -228,7 +228,7 @@ GEM\n     fabrication (2.31.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n-    faraday (2.13.0)\n+    faraday (2.13.1)\n       faraday-net_http (>= 2.0, < 3.5)\n       json\n       logger\n@@ -267,10 +267,10 @@ GEM\n       raabro (~> 1.4)\n     globalid (1.2.1)\n       activesupport (>= 6.1)\n-    google-protobuf (4.30.2)\n+    google-protobuf (4.31.0)\n       bigdecimal\n       rake (>= 13)\n-    googleapis-common-protos-types (1.19.0)\n+    googleapis-common-protos-types (1.20.0)\n       google-protobuf (>= 3.18, < 5.a)\n     haml (6.3.0)\n       temple (>= 0.8.2)\n@@ -338,7 +338,7 @@ GEM\n       azure-blob (~> 0.5.2)\n       hashie (~> 5.0)\n     jmespath (1.6.2)\n-    json (2.10.2)\n+    json (2.12.0)\n     json-canonicalization (1.0.0)\n     json-jwt (1.16.7)\n       activesupport (>= 4.2)\n@@ -411,7 +411,7 @@ GEM\n       activesupport (>= 4)\n       railties (>= 4)\n       request_store (~> 1.0)\n-    loofah (2.24.0)\n+    loofah (2.24.1)\n       crass (~> 1.0.2)\n       nokogiri (>= 1.12.0)\n     mail (2.8.1)\n@@ -427,9 +427,9 @@ GEM\n     mime-types (3.7.0)\n       logger\n       mime-types-data (~> 3.2025, >= 3.2025.0507)\n-    mime-types-data (3.2025.0507)\n+    mime-types-data (3.2025.0514)\n     mini_mime (1.1.5)\n-    mini_portile2 (2.8.8)\n+    mini_portile2 (2.8.9)\n     minitest (5.25.5)\n     msgpack (1.8.0)\n     multi_json (1.15.0)\n@@ -504,7 +504,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-active_support (~> 0.7)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-action_pack (0.12.0)\n+    opentelemetry-instrumentation-action_pack (0.12.1)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n       opentelemetry-instrumentation-rack (~> 0.21)\n@@ -618,7 +618,7 @@ GEM\n       activesupport (>= 7.0.0)\n       rack\n       railties (>= 7.0.0)\n-    psych (5.2.3)\n+    psych (5.2.6)\n       date\n       stringio\n     public_suffix (6.0.2)\n@@ -710,7 +710,7 @@ GEM\n       railties (>= 5.2)\n     rexml (3.4.1)\n     rotp (6.3.0)\n-    rouge (4.5.1)\n+    rouge (4.5.2)\n     rpam2 (4.0.2)\n     rqrcode (3.1.0)\n       chunky_png (~> 1.0)\n@@ -727,7 +727,7 @@ GEM\n       rspec-support (~> 3.13.0)\n     rspec-github (3.0.0)\n       rspec-core (~> 3.0)\n-    rspec-mocks (3.13.3)\n+    rspec-mocks (3.13.4)\n       diff-lcs (>= 1.2.0, < 2.0)\n       rspec-support (~> 3.13.0)\n     rspec-rails (8.0.0)\n@@ -1092,4 +1092,4 @@ RUBY VERSION\n    ruby 3.4.1p0\n \n BUNDLED WITH\n-   2.6.8\n+   2.6.9\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -66,10 +66,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/compat-data@npm:^7.22.6, @babel/compat-data@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/compat-data@npm:7.27.1\"\n-  checksum: 10c0/03e3a01b6772858dc5064f332ad4dc16fbbc0353f2180fd663a2651e8305058e35b6db57114e345d925def9b73cd7a322e95a45913428b8db705a098fd3dd289\n+\"@babel/compat-data@npm:^7.22.6, @babel/compat-data@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/compat-data@npm:7.27.2\"\n+  checksum: 10c0/077c9e01af3b90decee384a6a44dcf353898e980cee22ec7941f9074655dbbe97ec317345536cdc7ef7391521e1497930c522a3816af473076dd524be7fccd32\n   languageName: node\n   linkType: hard\n \n@@ -128,16 +128,16 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/helper-compilation-targets@npm:7.27.1\"\n+\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/helper-compilation-targets@npm:7.27.2\"\n   dependencies:\n-    \"@babel/compat-data\": \"npm:^7.27.1\"\n+    \"@babel/compat-data\": \"npm:^7.27.2\"\n     \"@babel/helper-validator-option\": \"npm:^7.27.1\"\n     browserslist: \"npm:^4.24.0\"\n     lru-cache: \"npm:^5.1.1\"\n     semver: \"npm:^6.3.1\"\n-  checksum: 10c0/1cfd3760a1bf1e367ea4a91214c041be7076197ba7a4f3c0710cab00fb5734eb010a2946efe6ecfb1ca9dc63e6c69644a1afa399db4082f374b9311e129f6f0b\n+  checksum: 10c0/f338fa00dcfea931804a7c55d1a1c81b6f0a09787e528ec580d5c21b3ecb3913f6cb0f361368973ce953b824d910d3ac3e8a8ee15192710d3563826447193ad1\n   languageName: node\n   linkType: hard\n \n@@ -934,16 +934,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-object-rest-spread@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/plugin-transform-object-rest-spread@npm:7.27.1\"\n+\"@babel/plugin-transform-object-rest-spread@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/plugin-transform-object-rest-spread@npm:7.27.2\"\n   dependencies:\n-    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.2\"\n     \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n+    \"@babel/plugin-transform-destructuring\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-parameters\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ac73caea178b51a64cc1c5e5ce1a67bacf89c1af664ef219aa1403d54258804113d6f267820c211768460e056f3aeb642c98ee14842c4fb548974c82f7dbe7dd\n+  checksum: 10c0/5e255b262dd65c8700078d9f6ed87bd45f951a905dda6b3414be28d7b2781b18e6b812e9d71421e61360c9cf51e1e619c1d48348593bb7399496f61f5f221446\n   languageName: node\n   linkType: hard\n \n@@ -1270,11 +1271,11 @@ __metadata:\n   linkType: hard\n \n \"@babel/preset-env@npm:^7.11.0, @babel/preset-env@npm:^7.12.1, @babel/preset-env@npm:^7.22.4\":\n-  version: 7.27.1\n-  resolution: \"@babel/preset-env@npm:7.27.1\"\n+  version: 7.27.2\n+  resolution: \"@babel/preset-env@npm:7.27.2\"\n   dependencies:\n-    \"@babel/compat-data\": \"npm:^7.27.1\"\n-    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/compat-data\": \"npm:^7.27.2\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.2\"\n     \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n     \"@babel/helper-validator-option\": \"npm:^7.27.1\"\n     \"@babel/plugin-bugfix-firefox-class-in-computed-class-key\": \"npm:^7.27.1\"\n@@ -1316,7 +1317,7 @@ __metadata:\n     \"@babel/plugin-transform-new-target\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-nullish-coalescing-operator\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-numeric-separator\": \"npm:^7.27.1\"\n-    \"@babel/plugin-transform-object-rest-spread\": \"npm:^7.27.1\"\n+    \"@babel/plugin-transform-object-rest-spread\": \"npm:^7.27.2\"\n     \"@babel/plugin-transform-object-super\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-optional-catch-binding\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-optional-chaining\": \"npm:^7.27.1\"\n@@ -1344,7 +1345,7 @@ __metadata:\n     semver: \"npm:^6.3.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/893b269f5e7e2084ee7fb60d3a1f154470c89169475170a8a595f1910cade9c9978b42df5405a46a699529dfdb1c6b0135cc4c0aa8f9e685ae230b1cb0172ad9\n+  checksum: 10c0/fd7ec310832a9ff26ed8d56bc0832cdbdb3a188e022050b74790796650649fb8373568af05b320b58b3ff922507979bad50ff95a4d504ab0081134480103504e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\npackage.json\n@@ -107,7 +107,7 @@\n     \"react-overlays\": \"^5.2.1\",\n     \"react-redux\": \"^9.0.4\",\n     \"react-redux-loading-bar\": \"^5.0.8\",\n-    \"react-router\": \"^5.3.4\",\n+    \"react-router\": \"^7.0.0\",\n     \"react-router-dom\": \"^5.3.4\",\n     \"react-router-scroll-4\": \"^1.0.0-beta.1\",\n     \"react-select\": \"^5.7.3\",\n---\nyarn.lock\n@@ -2936,7 +2936,7 @@ __metadata:\n     react-overlays: \"npm:^5.2.1\"\n     react-redux: \"npm:^9.0.4\"\n     react-redux-loading-bar: \"npm:^5.0.8\"\n-    react-router: \"npm:^5.3.4\"\n+    react-router: \"npm:^7.0.0\"\n     react-router-dom: \"npm:^5.3.4\"\n     react-router-scroll-4: \"npm:^1.0.0-beta.1\"\n     react-select: \"npm:^5.7.3\"\n@@ -6662,6 +6662,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"cookie@npm:^1.0.1\":\n+  version: 1.0.2\n+  resolution: \"cookie@npm:1.0.2\"\n+  checksum: 10c0/fd25fe79e8fbcfcaf6aa61cd081c55d144eeeba755206c058682257cb38c4bd6795c6620de3f064c740695bb65b7949ebb1db7a95e4636efb8357a335ad3f54b\n+  languageName: node\n+  linkType: hard\n+\n \"copy-descriptor@npm:^0.1.0\":\n   version: 0.1.1\n   resolution: \"copy-descriptor@npm:0.1.1\"\n@@ -14929,7 +14936,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-router@npm:5.3.4, react-router@npm:^5.3.4\":\n+\"react-router@npm:5.3.4\":\n   version: 5.3.4\n   resolution: \"react-router@npm:5.3.4\"\n   dependencies:\n@@ -14948,6 +14955,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"react-router@npm:^7.0.0\":\n+  version: 7.5.2\n+  resolution: \"react-router@npm:7.5.2\"\n+  dependencies:\n+    cookie: \"npm:^1.0.1\"\n+    set-cookie-parser: \"npm:^2.6.0\"\n+    turbo-stream: \"npm:2.4.0\"\n+  peerDependencies:\n+    react: \">=18\"\n+    react-dom: \">=18\"\n+  peerDependenciesMeta:\n+    react-dom:\n+      optional: true\n+  checksum: 10c0/5972ecb783e0ac0512c500b84bd4ff475665ba49c67b69e13b79dc24c7ee0496d523858058bb43c70147367688e0cc0d6d6d0f51cabfdebfbc5556d559bff457\n+  languageName: node\n+  linkType: hard\n+\n \"react-select@npm:^5.7.3\":\n   version: 5.10.1\n   resolution: \"react-select@npm:5.10.1\"\n@@ -15944,6 +15968,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"set-cookie-parser@npm:^2.6.0\":\n+  version: 2.7.1\n+  resolution: \"set-cookie-parser@npm:2.7.1\"\n+  checksum: 10c0/060c198c4c92547ac15988256f445eae523f57f2ceefeccf52d30d75dedf6bff22b9c26f756bd44e8e560d44ff4ab2130b178bd2e52ef5571bf7be3bd7632d9a\n+  languageName: node\n+  linkType: hard\n+\n \"set-function-length@npm:^1.2.2\":\n   version: 1.2.2\n   resolution: \"set-function-length@npm:1.2.2\"\n@@ -17530,6 +17561,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"turbo-stream@npm:2.4.0\":\n+  version: 2.4.0\n+  resolution: \"turbo-stream@npm:2.4.0\"\n+  checksum: 10c0/e68b2569f1f16e6e9633d090c6024b2ae9f0e97bfeacb572451ca3732e120ebbb546f3bc4afc717c46cb57b5aea6104e04ef497f9912eef6a7641e809518e98a\n+  languageName: node\n+  linkType: hard\n+\n \"twemoji-parser@npm:^11.0.2\":\n   version: 11.0.2\n   resolution: \"twemoji-parser@npm:11.0.2\"\n---\n\n\n---\n\nChoice D:\n.rubocop_todo.yml\n@@ -1,6 +1,6 @@\n # This configuration was generated by\n # `rubocop --auto-gen-config --auto-gen-only-exclude --no-offense-counts --no-auto-gen-timestamp`\n-# using RuboCop version 1.75.7.\n+# using RuboCop version 1.75.8.\n # The point is for the user to remove these configuration records\n # one by one as the offenses are removed from the code base.\n # Note that changes in the inspected code, or installation of new\n@@ -37,7 +37,6 @@ Style/FetchEnvVar:\n   Exclude:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/3_omniauth.rb'\n-    - 'config/initializers/cache_buster.rb'\n     - 'config/initializers/paperclip.rb'\n     - 'lib/tasks/repo.rake'\n \n---\napp/models/media_attachment.rb\n@@ -417,7 +417,7 @@ def reset_parent_cache\n \n   # Record the cache keys to burst before the file get actually deleted\n   def prepare_cache_bust!\n-    return unless Rails.configuration.x.cache_buster_enabled\n+    return unless Rails.configuration.x.cache_buster.enabled\n \n     @paths_to_cache_bust = MediaAttachment.attachment_definitions.keys.flat_map do |attachment_name|\n       attachment = public_send(attachment_name)\n@@ -434,7 +434,7 @@ def prepare_cache_bust!\n   # Once Paperclip has deleted the files, we can't recover the cache keys,\n   # so use the previously-saved ones\n   def bust_cache!\n-    return unless Rails.configuration.x.cache_buster_enabled\n+    return unless Rails.configuration.x.cache_buster.enabled\n \n     CacheBusterWorker.push_bulk(@paths_to_cache_bust) { |path| [path] }\n   rescue => e\n---\napp/services/suspend_account_service.rb\n@@ -95,7 +95,7 @@ def privatize_media_attachments!\n             end\n           end\n \n-          CacheBusterWorker.perform_async(attachment.url(style)) if Rails.configuration.x.cache_buster_enabled\n+          CacheBusterWorker.perform_async(attachment.url(style)) if Rails.configuration.x.cache_buster.enabled\n         end\n       end\n     end\n---\napp/services/unsuspend_account_service.rb\n@@ -91,7 +91,7 @@ def publish_media_attachments!\n             end\n           end\n \n-          CacheBusterWorker.perform_async(attachment.url(style)) if Rails.configuration.x.cache_buster_enabled\n+          CacheBusterWorker.perform_async(attachment.url(style)) if Rails.configuration.x.cache_buster.enabled\n         end\n       end\n     end\n---\nconfig/application.rb\n@@ -103,6 +103,7 @@ class Application < Rails::Application\n       end\n     end\n \n+    config.x.cache_buster = config_for(:cache_buster)\n     config.x.captcha = config_for(:captcha)\n     config.x.mastodon = config_for(:mastodon)\n     config.x.translation = config_for(:translation)\n---\nconfig/cache_buster.yml\n@@ -0,0 +1,5 @@\n+shared:\n+  enabled: <%= ENV.fetch('CACHE_BUSTER_ENABLED', 'false') == 'true' %>\n+  secret_header: <%= ENV.fetch('CACHE_BUSTER_SECRET_HEADER', nil) %>\n+  secret: <%= ENV.fetch('CACHE_BUSTER_SECRET', nil) %>\n+  http_method: <%= ENV.fetch('CACHE_BUSTER_HTTP_METHOD', 'GET') %>\n---\nconfig/initializers/cache_buster.rb\n@@ -1,11 +0,0 @@\n-# frozen_string_literal: true\n-\n-Rails.application.configure do\n-  config.x.cache_buster_enabled = ENV['CACHE_BUSTER_ENABLED'] == 'true'\n-\n-  config.x.cache_buster = {\n-    secret_header: ENV['CACHE_BUSTER_SECRET_HEADER'],\n-    secret: ENV['CACHE_BUSTER_SECRET'],\n-    http_method: ENV['CACHE_BUSTER_HTTP_METHOD'] || 'GET',\n-  }\n-end\n---\nspec/models/media_attachment_spec.rb\n@@ -291,7 +291,7 @@\n     let(:media) { Fabricate(:media_attachment) }\n \n     before do\n-      allow(Rails.configuration.x).to receive(:cache_buster_enabled).and_return(true)\n+      allow(Rails.configuration.x.cache_buster).to receive(:enabled).and_return(true)\n     end\n \n     it 'queues CacheBusterWorker jobs' do\n---\nspec/services/suspend_account_service_spec.rb\n@@ -11,7 +11,7 @@\n \n     before do\n       allow(FeedManager.instance).to receive_messages(unmerge_from_home: nil, unmerge_from_list: nil)\n-      allow(Rails.configuration.x).to receive(:cache_buster_enabled).and_return(true)\n+      allow(Rails.configuration.x.cache_buster).to receive(:enabled).and_return(true)\n \n       local_follower.follow!(account)\n       list.accounts << account\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis major version bump is also almost entirely just dropping support for old ruby/rails versions -- https://gitlab.com/fabrication-gem/fabrication/-/compare/2.31.0...3.0.0\n\n---\n\nChoice A:\nGemfile\n@@ -201,7 +201,7 @@ group :development, :test do\n   gem 'faker', '~> 3.2'\n \n   # Generate factory objects\n-  gem 'fabrication', '~> 2.30'\n+  gem 'fabrication'\n \n   # Profiling tools\n   gem 'memory_profiler', require: false\n---\nGemfile.lock\n@@ -223,7 +223,7 @@ GEM\n       tzinfo\n     excon (1.2.5)\n       logger\n-    fabrication (2.31.0)\n+    fabrication (3.0.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n     faraday (2.13.1)\n@@ -972,7 +972,7 @@ DEPENDENCIES\n   doorkeeper (~> 5.6)\n   dotenv\n   email_spec\n-  fabrication (~> 2.30)\n+  fabrication\n   faker (~> 3.2)\n   faraday-httpclient\n   fast_blank (~> 1.0)\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -912,7 +912,9 @@ export const AccountHeader: React.FC<{\n             <div className='account__header__badges'>{badges}</div>\n           )}\n \n-          {signedIn && <FamiliarFollowers accountId={accountId} />}\n+          {account.id !== me && signedIn && (\n+            <FamiliarFollowers accountId={accountId} />\n+          )}\n \n           {!(suspended || hidden) && (\n             <div className='account__header__extra'>\n---\napp/javascript/styles/mastodon/components.scss\n@@ -2179,7 +2179,7 @@ a .account__avatar {\n   flex-wrap: nowrap;\n \n   & > :not(:first-child) {\n-    margin-inline-start: -8px;\n+    margin-inline-start: -12px;\n   }\n \n   & > :first-child {\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -827,9 +827,9 @@ GEM\n       rufus-scheduler (~> 3.2)\n       sidekiq (>= 6, < 8)\n       tilt (>= 1.4.0, < 3)\n-    sidekiq-unique-jobs (8.0.10)\n+    sidekiq-unique-jobs (8.0.11)\n       concurrent-ruby (~> 1.0, >= 1.0.5)\n-      sidekiq (>= 7.0.0, < 8.0.0)\n+      sidekiq (>= 7.0.0, < 9.0.0)\n       thor (>= 1.0, < 3.0)\n     simple-navigation (4.4.0)\n       activesupport (>= 2.3.2)\n---\n\n\n---\n\nChoice D:\napp/workers/activitypub/fetch_all_replies_worker.rb\n@@ -80,7 +80,7 @@ def get_root_replies(root_status_uri, options = {})\n     root_status_body = fetch_resource(root_status_uri, true)\n     return if root_status_body.nil?\n \n-    FetchReplyWorker.perform_async(root_status_uri, { **options, prefetched_body: root_status_body })\n+    FetchReplyWorker.perform_async(root_status_uri, { **options.deep_stringify_keys, 'prefetched_body' => root_status_body })\n \n     get_replies(root_status_body, MAX_PAGES, options)\n   end\n---\nspec/workers/activitypub/fetch_all_replies_worker_spec.rb\n@@ -124,8 +124,6 @@\n \n   before do\n     stub_const('Status::FetchRepliesConcern::FETCH_REPLIES_ENABLED', true)\n-    allow(FetchReplyWorker).to receive(:push_bulk)\n-    allow(FetchReplyWorker).to receive(:perform_async)\n     all_items.each do |item|\n       next if [top_note_uri, reply_note_uri].include? item\n \n@@ -150,7 +148,7 @@\n \n     it 'fetches the top status only once' do\n       _ = subject.perform(status.id, { request_id: 0 })\n-      expect(FetchReplyWorker).to have_received(:perform_async).with(top_note_uri, { prefetched_body: top_object.deep_stringify_keys, request_id: 0 })\n+      expect(FetchReplyWorker).to have_enqueued_sidekiq_job(top_note_uri, { 'prefetched_body' => top_object.deep_stringify_keys, 'request_id' => 0 })\n       expect(a_request(:get, top_note_uri)).to have_been_made.once\n     end\n   end\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThe [rack-cors 3.0 bump](https://github.com/cyu/rack-cors/compare/v2.0.2...v3.0.0) requires rack 3, which we now can satisfy, and drops support for old ruby that we already don't support. Should be safe.\n\n---\n\nChoice A:\nGemfile\n@@ -74,7 +74,7 @@ gem 'premailer-rails'\n gem 'public_suffix', '~> 6.0'\n gem 'pundit', '~> 2.3'\n gem 'rack-attack', '~> 6.6'\n-gem 'rack-cors', '~> 2.0', require: 'rack/cors'\n+gem 'rack-cors', require: 'rack/cors'\n gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n---\nGemfile.lock\n@@ -636,8 +636,9 @@ GEM\n     rack (3.1.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n-    rack-cors (2.0.2)\n-      rack (>= 2.0.0)\n+    rack-cors (3.0.0)\n+      logger\n+      rack (>= 3.0.14)\n     rack-oauth2 (2.2.1)\n       activesupport\n       attr_required\n@@ -1046,7 +1047,7 @@ DEPENDENCIES\n   puma (~> 6.3)\n   pundit (~> 2.3)\n   rack-attack (~> 6.6)\n-  rack-cors (~> 2.0)\n+  rack-cors\n   rack-test (~> 2.1)\n   rails (~> 8.0)\n   rails-i18n (~> 8.0)\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -773,7 +773,7 @@ GEM\n       rack (>= 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n       rubocop-ast (>= 1.38.0, < 2.0)\n-    rubocop-rspec (3.5.0)\n+    rubocop-rspec (3.6.0)\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n     rubocop-rspec_rails (2.31.0)\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -10092,8 +10092,8 @@ __metadata:\n   linkType: hard\n \n \"ioredis@npm:^5.3.2\":\n-  version: 5.6.0\n-  resolution: \"ioredis@npm:5.6.0\"\n+  version: 5.6.1\n+  resolution: \"ioredis@npm:5.6.1\"\n   dependencies:\n     \"@ioredis/commands\": \"npm:^1.1.1\"\n     cluster-key-slot: \"npm:^1.1.0\"\n@@ -10104,7 +10104,7 @@ __metadata:\n     redis-errors: \"npm:^1.2.0\"\n     redis-parser: \"npm:^3.0.0\"\n     standard-as-callback: \"npm:^2.1.0\"\n-  checksum: 10c0/a885e5146640fc448706871290ef424ffa39af561f7ee3cf1590085209a509f85e99082bdaaf3cd32fa66758aea3fc2055d1109648ddca96fac4944bf2092c30\n+  checksum: 10c0/26ae49cf448e807e454a9bdea5a9dfdcf669e2fdbf2df341900a0fb693c5662fea7e39db3227ce8972d1bda0ba7da9b7410e5163b12d8878a579548d847220ac\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -52,6 +52,7 @@ gem 'faraday-httpclient'\n gem 'fast_blank', '~> 1.0'\n gem 'fastimage'\n gem 'hiredis', '~> 0.6'\n+gem 'hiredis-client'\n gem 'htmlentities', '~> 4.3'\n gem 'http', '~> 5.2.0'\n gem 'http_accept_language', '~> 2.1'\n@@ -82,10 +83,10 @@ gem 'rqrcode', '~> 3.0'\n gem 'ruby-progressbar', '~> 1.13'\n gem 'sanitize', '~> 7.0'\n gem 'scenic', '~> 1.7'\n-gem 'sidekiq', '~> 6.5'\n+gem 'sidekiq', '< 8'\n gem 'sidekiq-bulk', '~> 0.2.0'\n gem 'sidekiq-scheduler', '~> 5.0'\n-gem 'sidekiq-unique-jobs', '~> 7.1'\n+gem 'sidekiq-unique-jobs', '> 8'\n gem 'simple_form', '~> 5.2'\n gem 'simple-navigation', '~> 4.4'\n gem 'stoplight', '~> 4.1'\n---\nGemfile.lock\n@@ -129,9 +129,6 @@ GEM\n     brakeman (7.0.2)\n       racc\n     browser (6.2.0)\n-    brpoplpush-redis_script (0.1.3)\n-      concurrent-ruby (~> 1.0, >= 1.0.5)\n-      redis (>= 1.0, < 6)\n     builder (3.3.0)\n     bundler-audit (0.9.2)\n       bundler (>= 1.2.0, < 3)\n@@ -294,6 +291,8 @@ GEM\n     highline (3.1.2)\n       reline\n     hiredis (0.6.3)\n+    hiredis-client (0.24.0)\n+      redis-client (= 0.24.0)\n     hkdf (0.3.0)\n     htmlentities (4.3.4)\n     http (5.2.0)\n@@ -696,6 +695,8 @@ GEM\n       psych (>= 4.0.0)\n     redcarpet (3.6.1)\n     redis (4.8.1)\n+    redis-client (0.24.0)\n+      connection_pool\n     redlock (1.3.2)\n       redis (>= 3.0.0, < 6.0)\n     regexp_parser (2.10.0)\n@@ -808,22 +809,22 @@ GEM\n       websocket (~> 1.0)\n     shoulda-matchers (6.5.0)\n       activesupport (>= 5.2.0)\n-    sidekiq (6.5.12)\n-      connection_pool (>= 2.2.5, < 3)\n-      rack (~> 2.0)\n-      redis (>= 4.5.0, < 5)\n+    sidekiq (7.3.9)\n+      base64\n+      connection_pool (>= 2.3.0)\n+      logger\n+      rack (>= 2.2.4)\n+      redis-client (>= 0.22.2)\n     sidekiq-bulk (0.2.0)\n       sidekiq\n     sidekiq-scheduler (5.0.6)\n       rufus-scheduler (~> 3.2)\n       sidekiq (>= 6, < 8)\n       tilt (>= 1.4.0, < 3)\n-    sidekiq-unique-jobs (7.1.33)\n-      brpoplpush-redis_script (> 0.1.1, <= 2.0.0)\n+    sidekiq-unique-jobs (8.0.10)\n       concurrent-ruby (~> 1.0, >= 1.0.5)\n-      redis (< 5.0)\n-      sidekiq (>= 5.0, < 7.0)\n-      thor (>= 0.20, < 3.0)\n+      sidekiq (>= 7.0.0, < 8.0.0)\n+      thor (>= 1.0, < 3.0)\n     simple-navigation (4.4.0)\n       activesupport (>= 2.3.2)\n     simple_form (5.3.1)\n@@ -976,6 +977,7 @@ DEPENDENCIES\n   haml_lint\n   hcaptcha (~> 7.1)\n   hiredis (~> 0.6)\n+  hiredis-client\n   htmlentities (~> 4.3)\n   http (~> 5.2.0)\n   http_accept_language (~> 2.1)\n@@ -1064,10 +1066,10 @@ DEPENDENCIES\n   scenic (~> 1.7)\n   selenium-webdriver\n   shoulda-matchers\n-  sidekiq (~> 6.5)\n+  sidekiq (< 8)\n   sidekiq-bulk (~> 0.2.0)\n   sidekiq-scheduler (~> 5.0)\n-  sidekiq-unique-jobs (~> 7.1)\n+  sidekiq-unique-jobs (> 8)\n   simple-navigation (~> 4.4)\n   simple_form (~> 5.2)\n   simplecov (~> 0.22)\n---\napp/lib/redis_connection.rb\n@@ -15,7 +15,7 @@ def pool\n \n     def pool_size\n       if Sidekiq.server?\n-        Sidekiq[:concurrency]\n+        Sidekiq.default_configuration[:concurrency]\n       else\n         ENV['MAX_THREADS'] || 5\n       end\n---\napp/workers/scheduler/self_destruct_scheduler.rb\n@@ -20,7 +20,7 @@ def perform\n   private\n \n   def sidekiq_overwhelmed?\n-    redis_mem_info = Sidekiq.redis_info\n+    redis_mem_info = Sidekiq.default_configuration.redis_info\n \n     Sidekiq::Stats.new.enqueued > MAX_ENQUEUED || redis_mem_info['used_memory'].to_f > redis_mem_info['total_system_memory'].to_f * MAX_REDIS_MEM_USAGE\n   end\n---\nconfig/database.yml\n@@ -1,6 +1,6 @@\n default: &default\n   adapter: postgresql\n-  pool: <%= ENV[\"DB_POOL\"] || (if Sidekiq.server? then Sidekiq[:concurrency] else ENV['MAX_THREADS'] end) || 5 %>\n+  pool: <%= ENV[\"DB_POOL\"] || (if Sidekiq.server? then Sidekiq.default_configuration[:concurrency] else ENV['MAX_THREADS'] end) || 5 %>\n   timeout: 5000\n   connect_timeout: 15\n   encoding: unicode\n---\nconfig/initializers/sidekiq.rb\n@@ -89,6 +89,8 @@\n     end\n   end\n \n+  config.logger.level = Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+\n   SidekiqUniqueJobs::Server.configure(config)\n end\n \n@@ -98,9 +100,9 @@\n   config.client_middleware do |chain|\n     chain.add SidekiqUniqueJobs::Middleware::Client\n   end\n-end\n \n-Sidekiq.logger.level = ::Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+  config.logger.level = Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+end\n \n SidekiqUniqueJobs.configure do |config|\n   config.enabled         = !Rails.env.test?\n---\nlib/mastodon/redis_configuration.rb\n@@ -9,7 +9,6 @@ class Mastodon::RedisConfiguration\n \n   def base\n     @base ||= setup_config(prefix: nil, defaults: DEFAULTS)\n-              .merge(namespace: nil)\n   end\n \n   def sidekiq\n@@ -23,7 +22,7 @@ def cache\n                  expires_in: 10.minutes,\n                  connect_timeout: 5,\n                  pool: {\n-                   size: Sidekiq.server? ? Sidekiq[:concurrency] : Integer(ENV['MAX_THREADS'] || 5),\n+                   size: Sidekiq.server? ? Sidekiq.default_configuration[:concurrency] : Integer(ENV['MAX_THREADS'] || 5),\n                    timeout: 5,\n                  },\n                })\n---\nspec/lib/mastodon/redis_configuration_spec.rb\n@@ -156,7 +156,6 @@\n         expect(subject).to eq({\n           url: 'redis://localhost:6379/0',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n@@ -172,7 +171,6 @@\n         expect(subject).to eq({\n           url: 'redis::/user@example.com/2',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n@@ -188,7 +186,6 @@\n         expect(subject).to eq({\n           url: 'redis://:testpass@redis.example.com:3333/3',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n---\nspec/rails_helper.rb\n@@ -53,7 +53,7 @@\n   allow_localhost: true,\n   allow: Chewy.settings[:host]\n )\n-Sidekiq.logger = nil\n+Sidekiq.default_configuration.logger = nil\n \n DatabaseCleaner.strategy = [:deletion]\n \n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nSame idea as https://github.com/mastodon/mastodon/pull/34844 - just do minimum to auto-correct.\r\n\r\nProbably similar future improvement here, re: potentially moving some of the PAM and/or LDAP setup from this file into a `config_for` loader ... though would have to contemplate how to cleanly do that and set these config options, since it's not just one big hash.\n\n---\n\nChoice A:\nGemfile.lock\n@@ -633,7 +633,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (3.1.15)\n+    rack (3.1.16)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (3.0.0)\n---\n\n\n---\n\nChoice B:\n.rubocop_todo.yml\n@@ -39,7 +39,6 @@ Style/FetchEnvVar:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/3_omniauth.rb'\n     - 'config/initializers/cache_buster.rb'\n-    - 'config/initializers/devise.rb'\n     - 'config/initializers/paperclip.rb'\n     - 'config/initializers/vapid.rb'\n     - 'lib/tasks/repo.rake'\n---\nconfig/initializers/devise.rb\n@@ -377,7 +377,7 @@ def session_cookie\n     config.usernamefield          = nil\n     config.emailfield             = 'email'\n     config.check_at_sign          = true\n-    config.pam_default_suffix     = ENV.fetch('PAM_EMAIL_DOMAIN') { ENV['LOCAL_DOMAIN'] }\n+    config.pam_default_suffix     = ENV.fetch('PAM_EMAIL_DOMAIN') { ENV.fetch('LOCAL_DOMAIN', nil) }\n     config.pam_default_service    = ENV.fetch('PAM_DEFAULT_SERVICE') { 'rpam' }\n     config.pam_controlled_service = ENV.fetch('PAM_CONTROLLED_SERVICE', nil).presence\n   end\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -13307,12 +13307,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.9.5\":\n-  version: 3.9.5\n-  resolution: \"pg-pool@npm:3.9.5\"\n+\"pg-pool@npm:^3.9.6\":\n+  version: 3.9.6\n+  resolution: \"pg-pool@npm:3.9.6\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/ebb36b6a1fd753213263a2e0e73d06ffe9fc93907deceae484c7fe4b464f6e9c41a578eb096b4b6012beec94a5d6e0e47728dfc4425e06d283744aa7432365a4\n+  checksum: 10c0/458d50a4e7260977f076472d40d0796fa8b513af7e3ce1bf65557e10724e9c13653661c883f6650dff92d0a1a5ff4e7a001a8262b786c1ad4cfbd35c3354353e\n   languageName: node\n   linkType: hard\n \n@@ -13352,12 +13352,12 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.15.5\n-  resolution: \"pg@npm:8.15.5\"\n+  version: 8.15.6\n+  resolution: \"pg@npm:8.15.6\"\n   dependencies:\n     pg-cloudflare: \"npm:^1.2.5\"\n     pg-connection-string: \"npm:^2.8.5\"\n-    pg-pool: \"npm:^3.9.5\"\n+    pg-pool: \"npm:^3.9.6\"\n     pg-protocol: \"npm:^1.9.5\"\n     pg-types: \"npm:^2.1.0\"\n     pgpass: \"npm:1.x\"\n@@ -13369,7 +13369,7 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/4c118cd9bec37c8880b4489b9acbd10cf1eaa86a0a9024de2dac83f4ce5adedecc4cab54b66fa3bcb204aab7297c08d03617ae15499538939692b48651cc52d1\n+  checksum: 10c0/d4dc81020ebd137b6cf6228e43c643067acb8240079a07f7b9a7e97be0f33ad4d8c6f2a3f5b512ad87180e3d48e651fbd72885aa807ab58a715da8f3efea0fab\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\napp/models/web/push_subscription.rb\n@@ -12,13 +12,13 @@\n #  standard        :boolean          default(FALSE), not null\n #  created_at      :datetime         not null\n #  updated_at      :datetime         not null\n-#  access_token_id :bigint(8)\n-#  user_id         :bigint(8)\n+#  access_token_id :bigint(8)        not null\n+#  user_id         :bigint(8)        not null\n #\n \n class Web::PushSubscription < ApplicationRecord\n-  belongs_to :user, optional: true\n-  belongs_to :access_token, class_name: 'Doorkeeper::AccessToken', optional: true\n+  belongs_to :user\n+  belongs_to :access_token, class_name: 'Doorkeeper::AccessToken'\n \n   has_one :session_activation, foreign_key: 'web_push_subscription_id', inverse_of: :web_push_subscription, dependent: nil\n \n@@ -28,32 +28,16 @@ class Web::PushSubscription < ApplicationRecord\n \n   validates_with WebPushKeyValidator\n \n-  delegate :locale, to: :associated_user\n+  delegate :locale, to: :user\n \n   generates_token_for :unsubscribe, expires_in: Web::PushNotificationWorker::TTL\n \n   def pushable?(notification)\n     policy_allows_notification?(notification) && alert_enabled_for_notification_type?(notification)\n   end\n \n-  def associated_user\n-    return @associated_user if defined?(@associated_user)\n-\n-    @associated_user = if user_id.nil?\n-                         session_activation.user\n-                       else\n-                         user\n-                       end\n-  end\n-\n   def associated_access_token\n-    return @associated_access_token if defined?(@associated_access_token)\n-\n-    @associated_access_token = if access_token_id.nil?\n-                                 find_or_create_access_token.token\n-                               else\n-                                 access_token.token\n-                               end\n+    access_token.token\n   end\n \n   class << self\n@@ -65,16 +49,6 @@ def unsubscribe_for(application_id, resource_owner)\n \n   private\n \n-  def find_or_create_access_token\n-    Doorkeeper::AccessToken.find_or_create_for(\n-      application: Doorkeeper::Application.find_by(superapp: true),\n-      resource_owner: user_id || session_activation.user_id,\n-      scopes: Doorkeeper::OAuth::Scopes.from_string('read write follow push'),\n-      expires_in: Doorkeeper.configuration.access_token_expires_in,\n-      use_refresh_token: Doorkeeper.configuration.refresh_token_enabled?\n-    )\n-  end\n-\n   def alert_enabled_for_notification_type?(notification)\n     truthy?(data&.dig('alerts', notification.type.to_s))\n   end\n---\napp/serializers/web/notification_serializer.rb\n@@ -13,7 +13,7 @@ def access_token\n   end\n \n   def preferred_locale\n-    current_push_subscription.associated_user&.locale || I18n.default_locale\n+    current_push_subscription.user&.locale || I18n.default_locale\n   end\n \n   def notification_id\n---\ndb/migrate/20250422083912_add_not_null_to_web_push_subscription_user.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddNotNullToWebPushSubscriptionUser < ActiveRecord::Migration[8.0]\n+  def change\n+    add_check_constraint :web_push_subscriptions, 'user_id IS NOT NULL', name: 'web_push_subscriptions_user_id_null', validate: false\n+  end\n+end\n---\ndb/migrate/20250422084214_validate_add_not_null_to_web_push_subscription_user.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ValidateAddNotNullToWebPushSubscriptionUser < ActiveRecord::Migration[8.0]\n+  def up\n+    connection.execute(<<~SQL.squish)\n+      DELETE FROM web_push_subscriptions\n+      WHERE user_id IS NULL\n+    SQL\n+\n+    validate_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_user_id_null'\n+    change_column_null :web_push_subscriptions, :user_id, false\n+    remove_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_user_id_null'\n+  end\n+\n+  def down\n+    add_check_constraint :web_push_subscriptions, 'user_id IS NOT NULL', name: 'web_push_subscriptions_user_id_null', validate: false\n+    change_column_null :web_push_subscriptions, :user_id, true\n+  end\n+end\n---\ndb/migrate/20250422085027_add_not_null_to_web_push_subscription_access_token.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddNotNullToWebPushSubscriptionAccessToken < ActiveRecord::Migration[8.0]\n+  def change\n+    add_check_constraint :web_push_subscriptions, 'access_token_id IS NOT NULL', name: 'web_push_subscriptions_access_token_id_null', validate: false\n+  end\n+end\n---\ndb/migrate/20250422085303_validate_add_not_null_to_web_push_subscription_access_token.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ValidateAddNotNullToWebPushSubscriptionAccessToken < ActiveRecord::Migration[8.0]\n+  def up\n+    connection.execute(<<~SQL.squish)\n+      DELETE FROM web_push_subscriptions\n+      WHERE access_token_id IS NULL\n+    SQL\n+\n+    validate_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_access_token_id_null'\n+    change_column_null :web_push_subscriptions, :access_token_id, false\n+    remove_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_access_token_id_null'\n+  end\n+\n+  def down\n+    add_check_constraint :web_push_subscriptions, 'access_token_id IS NOT NULL', name: 'web_push_subscriptions_access_token_id_null', validate: false\n+    change_column_null :web_push_subscriptions, :access_token_id, true\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_11_095859) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_22_085303) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -1237,8 +1237,8 @@\n     t.json \"data\"\n     t.datetime \"created_at\", precision: nil, null: false\n     t.datetime \"updated_at\", precision: nil, null: false\n-    t.bigint \"access_token_id\"\n-    t.bigint \"user_id\"\n+    t.bigint \"access_token_id\", null: false\n+    t.bigint \"user_id\", null: false\n     t.boolean \"standard\", default: false, null: false\n     t.index [\"access_token_id\"], name: \"index_web_push_subscriptions_on_access_token_id\", where: \"(access_token_id IS NOT NULL)\"\n     t.index [\"user_id\"], name: \"index_web_push_subscriptions_on_user_id\"\n---\nspec/fabricators/web_push_subscription_fabricator.rb\n@@ -8,4 +8,6 @@\n     Base64.urlsafe_encode64(ecdh_key)\n   end\n   key_auth { Base64.urlsafe_encode64(Random.new.bytes(16)) }\n+  user { Fabricate(:user) }\n+  access_token { |attrs| Fabricate.build(:accessible_access_token, resource_owner_id: attrs[:user].id) }\n end\n---\nspec/requests/api/v1/push/subscriptions_spec.rb\n@@ -207,7 +207,8 @@ def create_subscription_with_token\n     Fabricate(\n       :web_push_subscription,\n       endpoint: create_payload[:subscription][:endpoint],\n-      access_token_id: token.id\n+      access_token: token,\n+      user: user\n     )\n   end\n end\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nSimilar to other config_for changes, and solves one TODO cop.\r\n\r\nSummary:\r\n\r\n- Adds a `vapid.yml` which holds the key values\r\n- Changes the access from `...configuration.x.vapid_` to `...configuration.x.vapid.*`\r\n- Production env preserves behaviour of having `nil` value if no env vars present\r\n- Dev and Test envs will now pull from env vars if present, but override with random as before if not\r\n\r\nOne thing that would be slightly cleaner here would be to remove these from the environment files totally and put everything in the yaml, but I could not think of a way to do this that was not super awkward, since we need to first generate the random keys and hold that somewhere. I think this is still net improvement, but that would be a good followup (or I'll add here if anyone has ideas).\n\n---\n\nChoice A:\n.rubocop_todo.yml\n@@ -41,7 +41,6 @@ Style/FetchEnvVar:\n     - 'config/initializers/cache_buster.rb'\n     - 'config/initializers/devise.rb'\n     - 'config/initializers/paperclip.rb'\n-    - 'config/initializers/vapid.rb'\n     - 'lib/tasks/repo.rake'\n \n # This cop supports safe autocorrection (--autocorrect).\n---\napp/lib/web_push_request.rb\n@@ -79,8 +79,8 @@ def payload_subject\n \n   def vapid_key\n     @vapid_key ||= Webpush::VapidKey.from_keys(\n-      Rails.configuration.x.vapid_public_key,\n-      Rails.configuration.x.vapid_private_key\n+      Rails.configuration.x.vapid.public_key,\n+      Rails.configuration.x.vapid.private_key\n     )\n   end\n \n---\napp/serializers/rest/application_serializer.rb\n@@ -18,6 +18,6 @@ def website\n   end\n \n   def vapid_key\n-    Rails.configuration.x.vapid_public_key\n+    Rails.configuration.x.vapid.public_key\n   end\n end\n---\napp/serializers/rest/instance_serializer.rb\n@@ -65,7 +65,7 @@ def configuration\n       },\n \n       vapid: {\n-        public_key: Rails.configuration.x.vapid_public_key,\n+        public_key: Rails.configuration.x.vapid.public_key,\n       },\n \n       accounts: {\n---\napp/serializers/rest/web_push_subscription_serializer.rb\n@@ -10,7 +10,7 @@ def alerts\n   end\n \n   def server_key\n-    Rails.configuration.x.vapid_public_key\n+    Rails.configuration.x.vapid.public_key\n   end\n \n   def policy\n---\napp/views/shared/_web_app.html.haml\n@@ -3,7 +3,7 @@\n   - if user_signed_in?\n     %meta{ name: 'initialPath', content: request.path }\n \n-  %meta{ name: 'applicationServerKey', content: Rails.configuration.x.vapid_public_key }\n+  %meta{ name: 'applicationServerKey', content: Rails.configuration.x.vapid.public_key }\n \n   = render_initial_state\n   = vite_typescript_tag 'application.ts', crossorigin: 'anonymous'\n---\nconfig/application.rb\n@@ -106,6 +106,7 @@ class Application < Rails::Application\n     config.x.captcha = config_for(:captcha)\n     config.x.mastodon = config_for(:mastodon)\n     config.x.translation = config_for(:translation)\n+    config.x.vapid = config_for(:vapid)\n \n     if ENV.fetch('QUERY_LOG_TAGS_ENABLED', 'false') == 'true'\n       config.active_record.query_log_tags_enabled = ENV.fetch('QUERY_LOG_TAGS_ENABLED', 'false') == 'true'\n---\nconfig/environments/development.rb\n@@ -40,10 +40,10 @@\n   # Override default file logging in favor of STDOUT logging in dev environment\n   config.logger = ActiveSupport::TaggedLogging.logger($stdout, formatter: config.log_formatter)\n \n-  # Generate random VAPID keys\n+  # Generate random VAPID keys when needed\n   Webpush.generate_key.tap do |vapid_key|\n-    config.x.vapid_private_key = vapid_key.private_key\n-    config.x.vapid_public_key = vapid_key.public_key\n+    config.x.vapid.private_key ||= vapid_key.private_key\n+    config.x.vapid.public_key ||= vapid_key.public_key\n   end\n \n   # Don't care if the mailer can't send.\n---\nconfig/environments/test.rb\n@@ -48,10 +48,11 @@\n   # Print deprecation notices to the stderr.\n   config.active_support.deprecation = :stderr\n \n-  # Generate random VAPID keys\n-  vapid_key = Webpush.generate_key\n-  config.x.vapid_private_key = vapid_key.private_key\n-  config.x.vapid_public_key = vapid_key.public_key\n+  # Generate random VAPID keys when needed\n+  Webpush.generate_key.tap do |vapid_key|\n+    config.x.vapid.private_key ||= vapid_key.private_key\n+    config.x.vapid.public_key ||= vapid_key.public_key\n+  end\n \n   # Raise exceptions when a reorder occurs in in_batches\n   config.active_record.error_on_ignored_order = true\n---\nconfig/initializers/vapid.rb\n@@ -1,16 +0,0 @@\n-# frozen_string_literal: true\n-\n-Rails.application.configure do\n-  # You can generate the keys using the following command (first is the private key, second is the public one)\n-  # You should only generate this once per instance. If you later decide to change it, all push subscription will\n-  # be invalidated, requiring the users to access the website again to resubscribe.\n-  #\n-  # Generate with `bundle exec rails mastodon:webpush:generate_vapid_key` task (`docker-compose run --rm web bundle exec rails mastodon:webpush:generate_vapid_key` if you use docker compose)\n-  #\n-  # For more information visit https://rossta.net/blog/using-the-web-push-api-with-vapid.html\n-\n-  if Rails.env.production?\n-    config.x.vapid_private_key = ENV['VAPID_PRIVATE_KEY']\n-    config.x.vapid_public_key = ENV['VAPID_PUBLIC_KEY']\n-  end\n-end\n---\nconfig/vapid.yml\n@@ -0,0 +1,17 @@\n+# You can generate the private and public keys using the following task. You\n+# should only generate this once per instance. If you later decide to change it,\n+# all push subscriptions will be invalidated, requiring users to access the\n+# website again to resubscribe.\n+#\n+# Generate on the CLI:\n+# `bundle exec rails mastodon:webpush:generate_vapid_key`\n+#\n+# Generate via Docker Compose:\n+# `docker-compose run --rm web bundle exec rails mastodon:webpush:generate_vapid_key`\n+#\n+# For more information visit\n+# https://rossta.net/blog/using-the-web-push-api-with-vapid.html\n+#\n+shared:\n+  private_key: <%= ENV.fetch('VAPID_PRIVATE_KEY', nil) %>\n+  public_key: <%= ENV.fetch('VAPID_PUBLIC_KEY', nil) %>\n---\nspec/requests/api/v1/apps/credentials_spec.rb\n@@ -29,7 +29,7 @@\n             redirect_uris: token.application.redirect_uris,\n             # Deprecated properties as of 4.3:\n             redirect_uri: token.application.redirect_uri.split.first,\n-            vapid_key: Rails.configuration.x.vapid_public_key\n+            vapid_key: Rails.configuration.x.vapid.public_key\n           )\n         )\n       end\n@@ -69,7 +69,7 @@\n             redirect_uris: token.application.redirect_uris,\n             # Deprecated properties as of 4.3:\n             redirect_uri: token.application.redirect_uri.split.first,\n-            vapid_key: Rails.configuration.x.vapid_public_key\n+            vapid_key: Rails.configuration.x.vapid.public_key\n           )\n         )\n       end\n---\nspec/requests/api/v1/apps_spec.rb\n@@ -49,7 +49,7 @@\n             redirect_uris: redirect_uris,\n             # Deprecated properties as of 4.3:\n             redirect_uri: redirect_uri,\n-            vapid_key: Rails.configuration.x.vapid_public_key\n+            vapid_key: Rails.configuration.x.vapid.public_key\n           )\n         )\n       end\n---\nspec/serializers/rest/instance_serializer_spec.rb\n@@ -15,7 +15,7 @@\n   describe 'configuration' do\n     it 'returns the VAPID public key' do\n       expect(serialization['configuration']['vapid']).to eq({\n-        'public_key' => Rails.configuration.x.vapid_public_key,\n+        'public_key' => Rails.configuration.x.vapid.public_key,\n       })\n     end\n \n---\nspec/workers/web/push_notification_worker_spec.rb\n@@ -38,13 +38,13 @@\n \n   describe 'perform' do\n     around do |example|\n-      original_private = Rails.configuration.x.vapid_private_key\n-      original_public = Rails.configuration.x.vapid_public_key\n-      Rails.configuration.x.vapid_private_key = vapid_private_key\n-      Rails.configuration.x.vapid_public_key = vapid_public_key\n+      original_private = Rails.configuration.x.vapid.private_key\n+      original_public = Rails.configuration.x.vapid.public_key\n+      Rails.configuration.x.vapid.private_key = vapid_private_key\n+      Rails.configuration.x.vapid.public_key = vapid_public_key\n       example.run\n-      Rails.configuration.x.vapid_private_key = original_private\n-      Rails.configuration.x.vapid_public_key = original_public\n+      Rails.configuration.x.vapid.private_key = original_private\n+      Rails.configuration.x.vapid.public_key = original_public\n     end\n \n     before do\n---\n\n\n---\n\nChoice B:\napp/javascript/styles/mastodon/components.scss\n@@ -11044,7 +11044,7 @@ noscript {\n   overflow: hidden;\n   flex-shrink: 0;\n   border-bottom: 1px solid var(--background-border-color);\n-  touch-action: pan-x;\n+  touch-action: pan-y;\n \n   &__slides {\n     display: flex;\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -773,7 +773,7 @@ GEM\n       rack (>= 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n       rubocop-ast (>= 1.38.0, < 2.0)\n-    rubocop-rspec (3.5.0)\n+    rubocop-rspec (3.6.0)\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n     rubocop-rspec_rails (2.31.0)\n---\n\n\n---\n\nChoice D:\napp/lib/activitypub/parser/status_parser.rb\n@@ -95,11 +95,11 @@ def language\n   end\n \n   def favourites_count\n-    @object.dig(:likes, :totalItems)\n+    @object.dig('likes', 'totalItems')\n   end\n \n   def reblogs_count\n-    @object.dig(:shares, :totalItems)\n+    @object.dig('shares', 'totalItems')\n   end\n \n   def quote_policy\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nAutocorrect to do just enough to get the line out of TODO.\r\n\r\nPossible future followup here:\r\n\r\n- Add a class that handles the various logic for the different smtp scenarios?\r\n- Move portions of this into a `config_for`, cleaning up even more `ENV` access?\n\n---\n\nChoice A:\napp/javascript/mastodon/actions/search.ts\n@@ -121,10 +121,15 @@ export const clickSearchResult = createAppAsyncThunk(\n \n export const forgetSearchResult = createAppAsyncThunk(\n   'search/forgetResult',\n-  (q: string, { dispatch, getState }) => {\n+  (\n+    { q, type }: { q: string; type?: RecentSearchType },\n+    { dispatch, getState },\n+  ) => {\n     const previous = getState().search.recent;\n     const me = getState().meta.get('me') as string;\n-    const current = previous.filter((result) => result.q !== q);\n+    const current = previous.filter(\n+      (result) => result.q !== q || result.type !== type,\n+    );\n \n     searchHistory.set(me, current);\n     dispatch(updateSearchHistory(current));\n---\napp/javascript/mastodon/features/compose/components/search.tsx\n@@ -221,7 +221,7 @@ export const Search: React.FC<{\n     },\n     forget: (e) => {\n       e.stopPropagation();\n-      void dispatch(forgetSearchResult(search.q));\n+      void dispatch(forgetSearchResult(search));\n     },\n   }));\n \n@@ -497,8 +497,10 @@ export const Search: React.FC<{\n             <div className='search__popout__menu'>\n               {recentOptions.length > 0 ? (\n                 recentOptions.map(({ label, key, action, forget }, i) => (\n-                  <button\n+                  <div\n                     key={key}\n+                    tabIndex={0}\n+                    role='button'\n                     onMouseDown={action}\n                     className={classNames(\n                       'search__popout__menu__item search__popout__menu__item--flex',\n@@ -509,7 +511,7 @@ export const Search: React.FC<{\n                     <button className='icon-button' onMouseDown={forget}>\n                       <Icon id='times' icon={CloseIcon} />\n                     </button>\n-                  </button>\n+                  </div>\n                 ))\n               ) : (\n                 <div className='search__popout__menu__message'>\n---\n\n\n---\n\nChoice B:\n.rubocop_todo.yml\n@@ -35,7 +35,6 @@ Rails/OutputSafety:\n # Configuration parameters: AllowedVars.\n Style/FetchEnvVar:\n   Exclude:\n-    - 'config/environments/production.rb'\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/3_omniauth.rb'\n     - 'config/initializers/cache_buster.rb'\n---\nconfig/environments/production.rb\n@@ -113,7 +113,7 @@\n   enable_starttls = nil\n   enable_starttls_auto = nil\n \n-  case ENV['SMTP_ENABLE_STARTTLS']\n+  case ENV.fetch('SMTP_ENABLE_STARTTLS', nil)\n   when 'always'\n     enable_starttls = true\n   when 'never'\n@@ -125,14 +125,14 @@\n   end\n \n   config.action_mailer.smtp_settings = {\n-    port: ENV['SMTP_PORT'],\n-    address: ENV['SMTP_SERVER'],\n+    port: ENV.fetch('SMTP_PORT', nil),\n+    address: ENV.fetch('SMTP_SERVER', nil),\n     user_name: ENV['SMTP_LOGIN'].presence,\n     password: ENV['SMTP_PASSWORD'].presence,\n-    domain: ENV['SMTP_DOMAIN'] || ENV['LOCAL_DOMAIN'],\n+    domain: ENV['SMTP_DOMAIN'] || ENV.fetch('LOCAL_DOMAIN', nil),\n     authentication: ENV['SMTP_AUTH_METHOD'] == 'none' ? nil : ENV['SMTP_AUTH_METHOD'] || :plain,\n     ca_file: ENV['SMTP_CA_FILE'].presence || '/etc/ssl/certs/ca-certificates.crt',\n-    openssl_verify_mode: ENV['SMTP_OPENSSL_VERIFY_MODE'],\n+    openssl_verify_mode: ENV.fetch('SMTP_OPENSSL_VERIFY_MODE', nil),\n     enable_starttls: enable_starttls,\n     enable_starttls_auto: enable_starttls_auto,\n     tls: ENV['SMTP_TLS'].presence && ENV['SMTP_TLS'] == 'true',\n---\n\n\n---\n\nChoice C:\nspec/support/capybara.rb\n@@ -30,9 +30,10 @@ def common_chrome_options\n \n Capybara.javascript_driver = :headless_chrome\n \n-# Some of the flaky tests seem to be caused by github runners being too slow for the\n-# default timeout of 2 seconds\n-Capybara.default_max_wait_time = 8\n+if ENV['CI'].present?\n+  # Reduce some intermittent failures from slow CI runner environment\n+  Capybara.default_max_wait_time = 60\n+end\n \n RSpec.configure do |config|\n   config.before(:each, type: :system) do\n---\n\n\n---\n\nChoice D:\napp/javascript/styles/mastodon/admin.scss\n@@ -114,15 +114,14 @@ $content-width: 840px;\n \n       a {\n         font-size: 14px;\n-        display: block;\n+        display: flex;\n+        align-items: center;\n+        gap: 6px;\n         padding: 15px;\n         color: $darker-text-color;\n         text-decoration: none;\n         transition: all 200ms linear;\n         transition-property: color, background-color;\n-        white-space: nowrap;\n-        overflow: hidden;\n-        text-overflow: ellipsis;\n \n         &:hover {\n           color: $primary-text-color;\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rubocop](https://rubocop.org/) ([source](https://redirect.github.com/rubocop/rubocop), [changelog](https://redirect.github.com/rubocop/rubocop/releases/tag/v1.75.8)) | `1.75.7` -> `1.75.8` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rubocop/1.75.8?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rubocop/1.75.8?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rubocop/1.75.7/1.75.8?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rubocop/1.75.7/1.75.8?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>rubocop/rubocop (rubocop)</summary>\n\n### [`v1.75.8`](https://redirect.github.com/rubocop/rubocop/blob/HEAD/CHANGELOG.md#1758-2025-05-28)\n\n##### Bug fixes\n\n-   [#&#8203;14191](https://redirect.github.com/rubocop/rubocop/pull/14191): Fix `Lint/FloatComparison` cop to detect floating-point number comparisons in `case` statements. (\\[[@&#8203;daisuke](https://redirect.github.com/daisuke)]\\[])\n-   [#&#8203;14209](https://redirect.github.com/rubocop/rubocop/pull/14209): Fix an error for `Style/RedundantFormat` with invalid format arguments. (\\[[@&#8203;earlopain](https://redirect.github.com/earlopain)]\\[])\n-   [#&#8203;14200](https://redirect.github.com/rubocop/rubocop/pull/14200): Fix false positives for `Style/DefWithParentheses` when using endless method definition with empty parentheses and a space before `=`. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14197](https://redirect.github.com/rubocop/rubocop/issues/14197): Fix infinite loop error for `EnforcedStyle: with_fixed_indentation` of `Layout/ArgumentAlignment` and `EnforcedStyle: consistent` of `Layout/FirstArgumentIndentation` and `Layout/HashAlignment`. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14204](https://redirect.github.com/rubocop/rubocop/pull/14204): Fix `Layout/EmptyLinesAroundAccessModifier` cop error on trailing access modifier. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14198](https://redirect.github.com/rubocop/rubocop/pull/14198): Fix `Lint/DuplicateMethods` cop error on `to` option is dynamically generated and `prefix` is enabled. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14199](https://redirect.github.com/rubocop/rubocop/pull/14199): Fix wrong autocorrection for `Style/MapToHash` with destructuring argument. (\\[[@&#8203;lovro-bikic](https://redirect.github.com/lovro-bikic)]\\[])\n-   [#&#8203;14050](https://redirect.github.com/rubocop/rubocop/issues/14050): Modify condition for `rubocop:todo` EOL comment. (\\[[@&#8203;jonas054](https://redirect.github.com/jonas054)]\\[])\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4zMy42IiwidXBkYXRlZEluVmVyIjoiNDAuMzMuNiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\n.rubocop_todo.yml\n@@ -33,7 +33,6 @@ Style/FetchEnvVar:\n   Exclude:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/paperclip.rb'\n-    - 'lib/tasks/repo.rake'\n \n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: MinBodyLength, AllowConsecutiveConditionals.\n---\nlib/tasks/repo.rake\n@@ -57,7 +57,7 @@ namespace :repo do\n                 response = nil\n \n                 loop do\n-                  response = HTTP.headers('Authorization' => \"token #{ENV['GITHUB_API_TOKEN']}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n+                  response = HTTP.headers('Authorization' => \"token #{ENV.fetch('GITHUB_API_TOKEN')}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n \n                   if response.code == 403\n                     sleep_for = (response.headers['X-RateLimit-Reset'].to_i - Time.now.to_i).abs\n---\n\n\n---\n\nChoice B:\nconfig/initializers/cookie_rotator.rb\n@@ -0,0 +1,23 @@\n+# frozen_string_literal: true\n+\n+# TODO: remove this file some time after 4.3.0\n+\n+Rails.application.config.after_initialize do\n+  Rails.application.config.action_dispatch.cookies_rotations.tap do |cookies|\n+    authenticated_encrypted_cookie_salt = Rails.application.config.action_dispatch.authenticated_encrypted_cookie_salt\n+    signed_cookie_salt = Rails.application.config.action_dispatch.signed_cookie_salt\n+\n+    secret_key_base = Rails.application.secret_key_base\n+\n+    key_generator = ActiveSupport::KeyGenerator.new(\n+      secret_key_base, iterations: 1000, hash_digest_class: OpenSSL::Digest::SHA1\n+    )\n+    key_len = ActiveSupport::MessageEncryptor.key_len\n+\n+    old_encrypted_secret = key_generator.generate_key(authenticated_encrypted_cookie_salt, key_len)\n+    old_signed_secret = key_generator.generate_key(signed_cookie_salt)\n+\n+    cookies.rotate :encrypted, old_encrypted_secret\n+    cookies.rotate :signed, old_signed_secret\n+  end\n+end\n---\n\n\n---\n\nChoice C:\napp/services/post_status_service.rb\n@@ -18,6 +18,7 @@ def initialize(message, accounts)\n   # @param [Hash] options\n   # @option [String] :text Message\n   # @option [Status] :thread Optional status to reply to\n+  # @option [Status] :quoted_status Optional status to quote\n   # @option [Boolean] :sensitive\n   # @option [String] :visibility\n   # @option [String] :spoiler_text\n@@ -35,6 +36,7 @@ def call(account, options = {})\n     @options     = options\n     @text        = @options[:text] || ''\n     @in_reply_to = @options[:thread]\n+    @quoted_status = @options[:quoted_status]\n \n     @antispam = Antispam.new\n \n@@ -78,6 +80,7 @@ def process_status!\n     @status = @account.statuses.new(status_attributes)\n     process_mentions_service.call(@status, save_records: false)\n     safeguard_mentions!(@status)\n+    attach_quote!(@status)\n     @antispam.local_preflight_check!(@status)\n \n     # The following transaction block is needed to wrap the UPDATEs to\n@@ -87,6 +90,21 @@ def process_status!\n     end\n   end\n \n+  def attach_quote!(status)\n+    return if @quoted_status.nil?\n+\n+    # NOTE: for now this is only for convenience in testing, as we don't support the request flow nor serialize quotes in ActivityPub\n+    # we only support incoming quotes so far\n+\n+    status.quote = Quote.new(quoted_status: @quoted_status)\n+    status.quote.accept! if @status.account == @quoted_status.account || @quoted_status.active_mentions.exists?(mentions: { account_id: status.account_id })\n+\n+    # TODO: the following has yet to be implemented:\n+    # - handle approval of local users (requires the interactionPolicy PR)\n+    # - produce a QuoteAuthorization for quotes of local users\n+    # - send a QuoteRequest for quotes of remote users\n+  end\n+\n   def safeguard_mentions!(status)\n     return if @options[:allowed_mentions].nil?\n \n@@ -223,6 +241,7 @@ def scheduled_options\n     @options.dup.tap do |options_hash|\n       options_hash[:in_reply_to_id]  = options_hash.delete(:thread)&.id\n       options_hash[:application_id]  = options_hash.delete(:application)&.id\n+      options_hash[:quoted_status_id] = options_hash.delete(:quoted_status)&.id\n       options_hash[:scheduled_at]    = nil\n       options_hash[:idempotency]     = nil\n       options_hash[:with_rate_limit] = false\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -339,7 +339,7 @@ GEM\n       azure-blob (~> 0.5.2)\n       hashie (~> 5.0)\n     jmespath (1.6.2)\n-    json (2.12.0)\n+    json (2.12.2)\n     json-canonicalization (1.0.0)\n     json-jwt (1.16.7)\n       activesupport (>= 4.2)\n@@ -750,7 +750,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.7)\n+    rubocop (1.75.8)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nI was thinking of changing what we store under this Redis key here, but realized this would be a bit cumbersome, when it is accessed directly all over the place.\r\n\r\nThis change ensures it is only ever directly accessed in a single place making it easier to change down the line if that should become necessary.\n\n---\n\nChoice A:\nyarn.lock\n@@ -5448,13 +5448,13 @@ __metadata:\n   linkType: hard\n \n \"axios@npm:^1.4.0\":\n-  version: 1.8.4\n-  resolution: \"axios@npm:1.8.4\"\n+  version: 1.9.0\n+  resolution: \"axios@npm:1.9.0\"\n   dependencies:\n     follow-redirects: \"npm:^1.15.6\"\n     form-data: \"npm:^4.0.0\"\n     proxy-from-env: \"npm:^1.1.0\"\n-  checksum: 10c0/450993c2ba975ffccaf0d480b68839a3b2435a5469a71fa2fb0b8a55cdb2c2ae47e609360b9c1e2b2534b73dfd69e2733a1cf9f8215bee0bcd729b72f801b0ce\n+  checksum: 10c0/9371a56886c2e43e4ff5647b5c2c3c046ed0a3d13482ef1d0135b994a628c41fbad459796f101c655e62f0c161d03883454474d2e435b2e021b1924d9f24994c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -170,7 +170,7 @@ GEM\n     crass (1.0.6)\n     css_parser (1.21.1)\n       addressable\n-    csv (3.3.3)\n+    csv (3.3.4)\n     database_cleaner-active_record (2.2.0)\n       activerecord (>= 5.a)\n       database_cleaner-core (~> 2.0.0)\n---\n\n\n---\n\nChoice C:\napp/models/home_feed.rb\n@@ -9,4 +9,12 @@ def initialize(account)\n   def regenerating?\n     redis.exists?(\"account:#{@account.id}:regeneration\")\n   end\n+\n+  def regeneration_in_progress!\n+    redis.set(\"account:#{@account.id}:regeneration\", true, nx: true, ex: 1.day.seconds)\n+  end\n+\n+  def regeneration_finished!\n+    redis.del(\"account:#{@account.id}:regeneration\")\n+  end\n end\n---\napp/models/user.rb\n@@ -531,7 +531,11 @@ def notify_staff_about_pending_account!\n   end\n \n   def regenerate_feed!\n-    RegenerationWorker.perform_async(account_id) if redis.set(\"account:#{account_id}:regeneration\", true, nx: true, ex: 1.day.seconds)\n+    home_feed = HomeFeed.new(account)\n+    unless home_feed.regenerating?\n+      home_feed.regeneration_in_progress!\n+      RegenerationWorker.perform_async(account_id)\n+    end\n   end\n \n   def needs_feed_update?\n---\napp/services/follow_service.rb\n@@ -46,7 +46,7 @@ def call(source_account, target_account, options = {})\n   private\n \n   def mark_home_feed_as_partial!\n-    redis.set(\"account:#{@source_account.id}:regeneration\", true, nx: true, ex: 1.day.seconds)\n+    HomeFeed.new(@source_account).regeneration_in_progress!\n   end\n \n   def following_not_possible?\n---\napp/services/precompute_feed_service.rb\n@@ -12,7 +12,7 @@ def call(account, skip_filled_timelines: false)\n       FeedManager.instance.populate_list(list) unless skip_timeline?(:list, list.id)\n     end\n   ensure\n-    redis.del(\"account:#{account.id}:regeneration\")\n+    HomeFeed.new(account).regeneration_finished!\n   end\n \n   private\n---\napp/workers/merge_worker.rb\n@@ -31,7 +31,7 @@ def merge_into_home!(into_account_id)\n       FeedManager.instance.merge_into_home(@from_account, @into_account)\n     end\n   ensure\n-    redis.del(\"account:#{into_account_id}:regeneration\")\n+    HomeFeed.new(@into_account).regeneration_finished!\n   end\n \n   def merge_into_list!(into_list_id)\n---\nspec/models/home_feed_spec.rb\n@@ -42,4 +42,42 @@\n       end\n     end\n   end\n+\n+  describe '#regenerating?' do\n+    context 'when feed is being generated' do\n+      before do\n+        redis.set(\"account:#{account.id}:regeneration\", true)\n+      end\n+\n+      it 'returns `true`' do\n+        expect(subject.regenerating?).to be true\n+      end\n+    end\n+\n+    context 'when feed is not being generated' do\n+      it 'returns `false`' do\n+        expect(subject.regenerating?).to be false\n+      end\n+    end\n+  end\n+\n+  describe '#regeneration_in_progress!' do\n+    it 'sets the corresponding key in redis' do\n+      expect(redis.exists?(\"account:#{account.id}:regeneration\")).to be false\n+\n+      subject.regeneration_in_progress!\n+\n+      expect(redis.exists?(\"account:#{account.id}:regeneration\")).to be true\n+    end\n+  end\n+\n+  describe '#regeneration_finished!' do\n+    it 'removes the corresponding key from redis' do\n+      redis.set(\"account:#{account.id}:regeneration\", true)\n+\n+      subject.regeneration_finished!\n+\n+      expect(redis.exists?(\"account:#{account.id}:regeneration\")).to be false\n+    end\n+  end\n end\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -160,7 +160,7 @@ GEM\n     cocoon (1.2.15)\n     color_diff (0.1)\n     concurrent-ruby (1.3.5)\n-    connection_pool (2.5.2)\n+    connection_pool (2.5.3)\n     cose (1.3.1)\n       cbor (~> 0.5.9)\n       openssl-signature_algorithm (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nSmall PR to make ESLint stop complaining about Vite virtual modules.\n\n---\n\nChoice A:\napp/lib/admin/system_check/elasticsearch_check.rb\n@@ -17,7 +17,7 @@ def pass?\n     return true unless Chewy.enabled?\n \n     running_version.present? && compatible_version? && cluster_health['status'] == 'green' && indexes_match? && specifications_match? && preset_matches?\n-  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error\n+  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error, HTTPClient::KeepAliveDisconnected\n     false\n   end\n \n@@ -54,7 +54,7 @@ def message\n     else\n       Admin::SystemCheck::Message.new(:elasticsearch_preset, nil, 'https://docs.joinmastodon.org/admin/elasticsearch/#scaling')\n     end\n-  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error\n+  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error, HTTPClient::KeepAliveDisconnected\n     Admin::SystemCheck::Message.new(:elasticsearch_running_check)\n   end\n \n---\n\n\n---\n\nChoice B:\napp/models/user.rb\n@@ -112,7 +112,7 @@ class User < ApplicationRecord\n   validates_with RegistrationFormTimeValidator, on: :create\n   validates :website, absence: true, on: :create\n   validates :confirm_password, absence: true, on: :create\n-  validates :date_of_birth, presence: true, date_of_birth: true, on: :create, if: -> { Setting.min_age.present? }\n+  validates :date_of_birth, presence: true, date_of_birth: true, on: :create, if: -> { Setting.min_age.present? && !bypass_registration_checks? }\n   validate :validate_role_elevation\n \n   scope :account_not_suspended, -> { joins(:account).merge(Account.without_suspended) }\n@@ -144,7 +144,7 @@ class User < ApplicationRecord\n   delegate :can?, to: :role\n \n   attr_reader :invite_code, :date_of_birth\n-  attr_writer :external, :bypass_invite_request_check, :current_account\n+  attr_writer :external, :bypass_registration_checks, :current_account\n \n   def self.those_who_can(*any_of_privileges)\n     matching_role_ids = UserRole.that_can(*any_of_privileges).map(&:id)\n@@ -501,8 +501,8 @@ def external?\n     !!@external\n   end\n \n-  def bypass_invite_request_check?\n-    @bypass_invite_request_check\n+  def bypass_registration_checks?\n+    @bypass_registration_checks\n   end\n \n   def sanitize_role\n@@ -549,7 +549,7 @@ def validate_role_elevation\n   end\n \n   def invite_text_required?\n-    Setting.require_invite_text && !open_registrations? && !invited? && !external? && !bypass_invite_request_check?\n+    Setting.require_invite_text && !open_registrations? && !invited? && !external? && !bypass_registration_checks?\n   end\n \n   def trigger_webhooks\n---\nlib/mastodon/cli/accounts.rb\n@@ -79,7 +79,14 @@ def create(username)\n \n       account  = Account.new(username: username)\n       password = SecureRandom.hex\n-      user     = User.new(email: options[:email], password: password, agreement: true, role_id: role_id, confirmed_at: options[:confirmed] ? Time.now.utc : nil, bypass_invite_request_check: true)\n+      user = User.new(\n+        email: options[:email],\n+        password: password,\n+        agreement: true,\n+        role_id: role_id,\n+        confirmed_at: options[:confirmed] ? Time.now.utc : nil,\n+        bypass_registration_checks: true\n+      )\n \n       if options[:reattach]\n         account = Account.find_local(username) || Account.new(username: username)\n---\nlib/tasks/mastodon.rake\n@@ -552,7 +552,7 @@ namespace :mastodon do\n           password = SecureRandom.hex(16)\n \n           owner_role = UserRole.find_by(name: 'Owner')\n-          user = User.new(email: email, password: password, confirmed_at: Time.now.utc, account_attributes: { username: username }, bypass_invite_request_check: true, role: owner_role)\n+          user = User.new(email: email, password: password, confirmed_at: Time.now.utc, account_attributes: { username: username }, bypass_registration_checks: true, role: owner_role)\n           user.save(validate: false)\n           user.approve!\n \n---\nspec/lib/mastodon/cli/accounts_spec.rb\n@@ -70,6 +70,25 @@ def account_from_options\n         end\n       end\n \n+      context 'with min_age setting' do\n+        let(:options) { { email: 'tootctl@example.com', confirmed: true } }\n+\n+        before do\n+          Setting.min_age = 42\n+        end\n+\n+        it_behaves_like 'a new user with given email address and username'\n+\n+        it 'creates a new user with confirmed status' do\n+          expect { subject }\n+            .to output_results('New password')\n+\n+          user = User.find_by(email: options[:email])\n+\n+          expect(user.confirmed?).to be(true)\n+        end\n+      end\n+\n       context 'with --confirmed option' do\n         let(:options) { { email: 'tootctl@example.com', confirmed: true } }\n \n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/emoji/emoji_mart_data_light.ts\n@@ -3,7 +3,6 @@\n // emojiIndex.search functionality.\n import type { BaseEmoji } from 'emoji-mart';\n import type { Emoji } from 'emoji-mart/dist-es/utils/data';\n-// eslint-disable-next-line import/no-unresolved\n import emojiCompressed from 'virtual:mastodon-emoji-compressed';\n import type {\n   Search,\n---\napp/javascript/mastodon/features/emoji/emoji_unicode_mapping_light.ts\n@@ -2,7 +2,6 @@\n // (i.e. the svg filename) and a shortCode intended to be shown\n // as a \"title\" attribute in an HTML element (aka tooltip).\n \n-// eslint-disable-next-line import/no-unresolved\n import emojiCompressed from 'virtual:mastodon-emoji-compressed';\n import type {\n   FilenameData,\n---\napp/javascript/mastodon/service_worker/web_push_notifications.js\n@@ -3,7 +3,6 @@ import { IntlMessageFormat } from 'intl-messageformat';\n import { unescape } from 'lodash';\n // see config/vite/plugins/sw-locales\n // it needs to be updated when new locale keys are used in this file\n-// eslint-disable-next-line import/no-unresolved\n import locales from \"virtual:mastodon-sw-locales\";\n \n const MAX_NOTIFICATIONS = 5;\n---\neslint.config.mjs\n@@ -258,7 +258,7 @@ export default tseslint.config([\n       'import/no-unresolved': [\n         'error',\n         {\n-          ignore: ['vite/modulepreload-polyfill'],\n+          ignore: ['vite/modulepreload-polyfill', '^virtual:.+'],\n         },\n       ],\n \n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -12001,9 +12001,9 @@ __metadata:\n   linkType: hard\n \n \"marky@npm:^1.2.5\":\n-  version: 1.2.5\n-  resolution: \"marky@npm:1.2.5\"\n-  checksum: 10c0/ca8a011f287dab1ac3291df720fc32b366c4cd767347b63722966650405ce71ec6566f71d1e22e1768bf6461a7fd689b9038e7df0fcfb62eacf3a5a6dcac249e\n+  version: 1.3.0\n+  resolution: \"marky@npm:1.3.0\"\n+  checksum: 10c0/6619cdb132fdc4f7cd3e2bed6eebf81a38e50ff4b426bbfb354db68731e4adfebf35ebfd7c8e5a6e846cbf9b872588c4f76db25782caee8c1529ec9d483bf98b\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rollup-plugin-visualizer](https://redirect.github.com/btd/rollup-plugin-visualizer) | [`6.0.0` -> `6.0.1`](https://renovatebot.com/diffs/npm/rollup-plugin-visualizer/6.0.0/6.0.1) | [![age](https://developer.mend.io/api/mc/badges/age/npm/rollup-plugin-visualizer/6.0.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/rollup-plugin-visualizer/6.0.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/rollup-plugin-visualizer/6.0.0/6.0.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/rollup-plugin-visualizer/6.0.0/6.0.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>btd/rollup-plugin-visualizer (rollup-plugin-visualizer)</summary>\n\n### [`v6.0.1`](https://redirect.github.com/btd/rollup-plugin-visualizer/blob/HEAD/CHANGELOG.md#601)\n\n[Compare Source](https://redirect.github.com/btd/rollup-plugin-visualizer/compare/v6.0.0...v6.0.1)\n\n-   Rollback dependency package `open` to version 8 as require(esm) is not ready to be used\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4zMy42IiwidXBkYXRlZEluVmVyIjoiNDAuMzMuNiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwiamF2YXNjcmlwdCJdfQ==-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -66,7 +66,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n+\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n   version: 7.26.10\n   resolution: \"@babel/core@npm:7.26.10\"\n   dependencies:\n@@ -211,10 +211,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.24.0, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5\":\n-  version: 7.26.5\n-  resolution: \"@babel/helper-plugin-utils@npm:7.26.5\"\n-  checksum: 10c0/cdaba71d4b891aa6a8dfbe5bac2f94effb13e5fa4c2c487667fdbaa04eae059b78b28d85a885071f45f7205aeb56d16759e1bed9c118b94b16e4720ef1ab0f65\n+\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5, @babel/helper-plugin-utils@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helper-plugin-utils@npm:7.27.1\"\n+  checksum: 10c0/94cf22c81a0c11a09b197b41ab488d416ff62254ce13c57e62912c85700dc2e99e555225787a4099ff6bae7a1812d622c80fbaeda824b79baa10a6c5ac4cf69b\n   languageName: node\n   linkType: hard\n \n@@ -869,25 +869,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-self@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-self@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea362ff94b535c753f560eb1f5e063dc72bbbca17ed58837a949a7b289d5eacc7b0a28296d1932c94429b168d6040cdee5484a59b9e3c021f169e0ee137e6a27\n+  checksum: 10c0/00a4f917b70a608f9aca2fb39aabe04a60aa33165a7e0105fd44b3a8531630eb85bf5572e9f242f51e6ad2fa38c2e7e780902176c863556c58b5ba6f6e164031\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-source@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-source@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea8e3263c0dc51fbc97c156cc647150a757cc56de10781287353d0ce9b2dcd6b6d93d573c0142d7daf5d6fb554c74fa1971ae60764924ea711161d8458739b63\n+  checksum: 10c0/5e67b56c39c4d03e59e03ba80692b24c5a921472079b63af711b1d250fc37c1733a17069b63537f750f3e937ec44a42b1ee6a46cd23b1a0df5163b17f741f7f2\n   languageName: node\n   linkType: hard\n \n@@ -4135,17 +4135,17 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.2.1\n-  resolution: \"@vitejs/plugin-react@npm:4.2.1\"\n+  version: 4.4.1\n+  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n   dependencies:\n-    \"@babel/core\": \"npm:^7.23.5\"\n-    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.23.3\"\n-    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.23.3\"\n+    \"@babel/core\": \"npm:^7.26.10\"\n+    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n+    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n-    react-refresh: \"npm:^0.14.0\"\n+    react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n-    vite: ^4.2.0 || ^5.0.0\n-  checksum: 10c0/de1eec44d703f32e5b58e776328ca20793657fe991835d15b290230b19a2a08be5d31501d424279ae13ecfed28044c117b69d746891c8d9b92c69e8a8907e989\n+    vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n+  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n   languageName: node\n   linkType: hard\n \n@@ -10069,10 +10069,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-refresh@npm:^0.14.0\":\n-  version: 0.14.0\n-  resolution: \"react-refresh@npm:0.14.0\"\n-  checksum: 10c0/b8ae07ad153357d77830928a7f1fc2df837aabefee907fa273ba04c7643f3b860e986f1d4b7ada9b721c8d79b8c24b5b911a314a1a2398b105f1b13d19ea2b8d\n+\"react-refresh@npm:^0.17.0\":\n+  version: 0.17.0\n+  resolution: \"react-refresh@npm:0.17.0\"\n+  checksum: 10c0/002cba940384c9930008c0bce26cac97a9d5682bc623112c2268ba0c155127d9c178a9a5cc2212d560088d60dfd503edd808669a25f9b377f316a32361d0b23c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -62,7 +62,7 @@ gem 'inline_svg'\n gem 'irb', '~> 1.8'\n gem 'kaminari', '~> 1.2'\n gem 'link_header', '~> 0.0'\n-gem 'linzer', '~> 0.6.1'\n+gem 'linzer', '~> 0.7.0'\n gem 'mario-redis-lock', '~> 1.2', require: 'redis_lock'\n gem 'mime-types', '~> 3.7.0', require: 'mime/types/columnar'\n gem 'mutex_m'\n---\nGemfile.lock\n@@ -148,6 +148,7 @@ GEM\n     case_transform (0.2)\n       activesupport\n     cbor (0.5.9.8)\n+    cgi (0.4.2)\n     charlock_holmes (0.7.9)\n     chewy (7.6.0)\n       activesupport (>= 5.2)\n@@ -262,6 +263,7 @@ GEM\n       fog-core (~> 2.1)\n       fog-json (>= 1.0)\n     formatador (1.1.0)\n+    forwardable (1.3.3)\n     fugit (1.11.1)\n       et-orbi (~> 1, >= 1.2.11)\n       raabro (~> 1.4)\n@@ -396,7 +398,11 @@ GEM\n       rexml\n     link_header (0.0.8)\n     lint_roller (1.1.0)\n-    linzer (0.6.5)\n+    linzer (0.7.0)\n+      cgi (~> 0.4.2)\n+      forwardable (~> 1.3, >= 1.3.3)\n+      logger (~> 1.7, >= 1.7.0)\n+      net-http (~> 0.6.0)\n       openssl (~> 3.0, >= 3.0.0)\n       rack (>= 2.2, < 4.0)\n       starry (~> 0.2)\n@@ -628,7 +634,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -995,7 +1001,7 @@ DEPENDENCIES\n   letter_opener (~> 1.8)\n   letter_opener_web (~> 3.0)\n   link_header (~> 0.0)\n-  linzer (~> 0.6.1)\n+  linzer (~> 0.7.0)\n   lograge (~> 0.12)\n   mail (~> 2.8)\n   mario-redis-lock (~> 1.2)\n---\n\n\n---\n\nChoice C:\npackage.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/mastodon\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.1\",\n+  \"packageManager\": \"yarn@4.9.2\",\n   \"engines\": {\n     \"node\": \">=20\"\n   },\n---\nstreaming/package.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/streaming\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.1\",\n+  \"packageManager\": \"yarn@4.9.2\",\n   \"engines\": {\n     \"node\": \">=20\"\n   },\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -4886,15 +4886,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"bundle-name@npm:^4.1.0\":\n-  version: 4.1.0\n-  resolution: \"bundle-name@npm:4.1.0\"\n-  dependencies:\n-    run-applescript: \"npm:^7.0.0\"\n-  checksum: 10c0/8e575981e79c2bcf14d8b1c027a3775c095d362d1382312f444a7c861b0e21513c0bd8db5bd2b16e50ba0709fa622d4eab6b53192d222120305e68359daece29\n-  languageName: node\n-  linkType: hard\n-\n \"bytes@npm:3.1.2\":\n   version: 3.1.2\n   resolution: \"bytes@npm:3.1.2\"\n@@ -5543,23 +5534,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"default-browser-id@npm:^5.0.0\":\n-  version: 5.0.0\n-  resolution: \"default-browser-id@npm:5.0.0\"\n-  checksum: 10c0/957fb886502594c8e645e812dfe93dba30ed82e8460d20ce39c53c5b0f3e2afb6ceaec2249083b90bdfbb4cb0f34e1f73fde3d68cac00becdbcfd894156b5ead\n-  languageName: node\n-  linkType: hard\n-\n-\"default-browser@npm:^5.2.1\":\n-  version: 5.2.1\n-  resolution: \"default-browser@npm:5.2.1\"\n-  dependencies:\n-    bundle-name: \"npm:^4.1.0\"\n-    default-browser-id: \"npm:^5.0.0\"\n-  checksum: 10c0/73f17dc3c58026c55bb5538749597db31f9561c0193cd98604144b704a981c95a466f8ecc3c2db63d8bfd04fb0d426904834cfc91ae510c6aeb97e13c5167c4d\n-  languageName: node\n-  linkType: hard\n-\n \"define-data-property@npm:^1.0.1, define-data-property@npm:^1.1.4\":\n   version: 1.1.4\n   resolution: \"define-data-property@npm:1.1.4\"\n@@ -5571,10 +5545,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"define-lazy-prop@npm:^3.0.0\":\n-  version: 3.0.0\n-  resolution: \"define-lazy-prop@npm:3.0.0\"\n-  checksum: 10c0/5ab0b2bf3fa58b3a443140bbd4cd3db1f91b985cc8a246d330b9ac3fc0b6a325a6d82bddc0b055123d745b3f9931afeea74a5ec545439a1630b9c8512b0eeb49\n+\"define-lazy-prop@npm:^2.0.0\":\n+  version: 2.0.0\n+  resolution: \"define-lazy-prop@npm:2.0.0\"\n+  checksum: 10c0/db6c63864a9d3b7dc9def55d52764968a5af296de87c1b2cc71d8be8142e445208071953649e0386a8cc37cfcf9a2067a47207f1eb9ff250c2a269658fdae422\n   languageName: node\n   linkType: hard\n \n@@ -7531,12 +7505,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-docker@npm:^3.0.0\":\n-  version: 3.0.0\n-  resolution: \"is-docker@npm:3.0.0\"\n+\"is-docker@npm:^2.0.0, is-docker@npm:^2.1.1\":\n+  version: 2.2.1\n+  resolution: \"is-docker@npm:2.2.1\"\n   bin:\n     is-docker: cli.js\n-  checksum: 10c0/d2c4f8e6d3e34df75a5defd44991b6068afad4835bb783b902fa12d13ebdb8f41b2a199dcb0b5ed2cb78bfee9e4c0bbdb69c2d9646f4106464674d3e697a5856\n+  checksum: 10c0/e828365958d155f90c409cdbe958f64051d99e8aedc2c8c4cd7c89dcf35329daed42f7b99346f7828df013e27deb8f721cf9408ba878c76eb9e8290235fbcdcc\n   languageName: node\n   linkType: hard\n \n@@ -7597,17 +7571,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-inside-container@npm:^1.0.0\":\n-  version: 1.0.0\n-  resolution: \"is-inside-container@npm:1.0.0\"\n-  dependencies:\n-    is-docker: \"npm:^3.0.0\"\n-  bin:\n-    is-inside-container: cli.js\n-  checksum: 10c0/a8efb0e84f6197e6ff5c64c52890fa9acb49b7b74fed4da7c95383965da6f0fa592b4dbd5e38a79f87fc108196937acdbcd758fcefc9b140e479b39ce1fcd1cd\n-  languageName: node\n-  linkType: hard\n-\n \"is-lambda@npm:^1.0.1\":\n   version: 1.0.1\n   resolution: \"is-lambda@npm:1.0.1\"\n@@ -7772,12 +7735,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-wsl@npm:^3.1.0\":\n-  version: 3.1.0\n-  resolution: \"is-wsl@npm:3.1.0\"\n+\"is-wsl@npm:^2.2.0\":\n+  version: 2.2.0\n+  resolution: \"is-wsl@npm:2.2.0\"\n   dependencies:\n-    is-inside-container: \"npm:^1.0.0\"\n-  checksum: 10c0/d3317c11995690a32c362100225e22ba793678fe8732660c6de511ae71a0ff05b06980cf21f98a6bf40d7be0e9e9506f859abe00a1118287d63e53d0a3d06947\n+    is-docker: \"npm:^2.0.0\"\n+  checksum: 10c0/a6fa2d370d21be487c0165c7a440d567274fbba1a817f2f0bfa41cc5e3af25041d84267baa22df66696956038a43973e72fca117918c91431920bdef490fa25e\n   languageName: node\n   linkType: hard\n \n@@ -8877,15 +8840,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"open@npm:^10.1.2\":\n-  version: 10.1.2\n-  resolution: \"open@npm:10.1.2\"\n+\"open@npm:^8.0.0\":\n+  version: 8.4.2\n+  resolution: \"open@npm:8.4.2\"\n   dependencies:\n-    default-browser: \"npm:^5.2.1\"\n-    define-lazy-prop: \"npm:^3.0.0\"\n-    is-inside-container: \"npm:^1.0.0\"\n-    is-wsl: \"npm:^3.1.0\"\n-  checksum: 10c0/1bee796f06e549ce764f693272100323fbc04da8fa3c5b0402d6c2d11b3d76fa0aac0be7535e710015ff035326638e3b9a563f3b0e7ac3266473ed5663caae6d\n+    define-lazy-prop: \"npm:^2.0.0\"\n+    is-docker: \"npm:^2.1.1\"\n+    is-wsl: \"npm:^2.2.0\"\n+  checksum: 10c0/bb6b3a58401dacdb0aad14360626faf3fb7fba4b77816b373495988b724fb48941cad80c1b65d62bb31a17609b2cd91c41a181602caea597ca80dfbcc27e84c9\n   languageName: node\n   linkType: hard\n \n@@ -10685,10 +10647,10 @@ __metadata:\n   linkType: hard\n \n \"rollup-plugin-visualizer@npm:^6.0.0\":\n-  version: 6.0.0\n-  resolution: \"rollup-plugin-visualizer@npm:6.0.0\"\n+  version: 6.0.1\n+  resolution: \"rollup-plugin-visualizer@npm:6.0.1\"\n   dependencies:\n-    open: \"npm:^10.1.2\"\n+    open: \"npm:^8.0.0\"\n     picomatch: \"npm:^4.0.2\"\n     source-map: \"npm:^0.7.4\"\n     yargs: \"npm:^17.5.1\"\n@@ -10702,7 +10664,7 @@ __metadata:\n       optional: true\n   bin:\n     rollup-plugin-visualizer: dist/bin/cli.js\n-  checksum: 10c0/803b7a93692824c31c4eb6595367717591123dbdc6be3402403bba633bb81ccfdbd16827e852af9da03fd7e8211a974717492e4032d14897c37c130f0cb86222\n+  checksum: 10c0/c938224b2027b3f490569c439d400b8fc80a0ad07b58720771b23623efe1efc7eb61f3de4506fb4520ce95ef4ea3c93153c31130559e017606c046c052690d1c\n   languageName: node\n   linkType: hard\n \n@@ -10802,13 +10764,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"run-applescript@npm:^7.0.0\":\n-  version: 7.0.0\n-  resolution: \"run-applescript@npm:7.0.0\"\n-  checksum: 10c0/bd821bbf154b8e6c8ecffeaf0c33cebbb78eb2987476c3f6b420d67ab4c5301faa905dec99ded76ebb3a7042b4e440189ae6d85bbbd3fc6e8d493347ecda8bfe\n-  languageName: node\n-  linkType: hard\n-\n \"run-parallel@npm:^1.1.9\":\n   version: 1.2.0\n   resolution: \"run-parallel@npm:1.2.0\"\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [ox](http://www.ohler.com/ox/) ([source](https://redirect.github.com/ohler55/ox), [changelog](https://redirect.github.com/ohler55/ox/blob/master/CHANGELOG.md)) | `2.14.22` -> `2.14.23` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/ox/2.14.23?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/ox/2.14.23?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/ox/2.14.22/2.14.23?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/ox/2.14.22/2.14.23?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>ohler55/ox (ox)</summary>\n\n### [`v2.14.23`](https://redirect.github.com/ohler55/ox/blob/HEAD/CHANGELOG.md#21423---2025-05-27)\n\n[Compare Source](https://redirect.github.com/ohler55/ox/compare/v2.14.22...v2.14.23)\n\n##### Changed\n\n-   Comments are no longer space padded to be similar with other XML writers.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4zMy42IiwidXBkYXRlZEluVmVyIjoiNDAuMzMuNiIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -592,7 +592,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n     orm_adapter (0.5.0)\n     ostruct (0.6.1)\n-    ox (2.14.22)\n+    ox (2.14.23)\n       bigdecimal (>= 3.0)\n     parallel (1.27.0)\n     parser (3.3.8.0)\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -633,7 +633,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (3.1.15)\n+    rack (3.1.16)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (3.0.0)\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/locales/en-GB.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Moderated servers\",\n   \"about.contact\": \"Contact:\",\n+  \"about.default_locale\": \"Default\",\n   \"about.disclaimer\": \"Mastodon is free, open-source software, and a trademark of Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Reason not available\",\n   \"about.domain_blocks.preamble\": \"Mastodon generally allows you to view content from and interact with users from any other server in the Fediverse. These are the exceptions that have been made on this particular server.\",\n   \"about.domain_blocks.silenced.explanation\": \"You will generally not see profiles and content from this server, unless you explicitly look it up or opt into it by following.\",\n   \"about.domain_blocks.silenced.title\": \"Limited\",\n   \"about.domain_blocks.suspended.explanation\": \"No data from this server will be processed, stored or exchanged, making any interaction or communication with users from this server impossible.\",\n   \"about.domain_blocks.suspended.title\": \"Suspended\",\n+  \"about.language_label\": \"Language\",\n   \"about.not_available\": \"This information has not been made available on this server.\",\n   \"about.powered_by\": \"Decentralised social media powered by {mastodon}\",\n   \"about.rules\": \"Server rules\",\n@@ -19,10 +21,12 @@\n   \"account.block_domain\": \"Block domain {domain}\",\n   \"account.block_short\": \"Block\",\n   \"account.blocked\": \"Blocked\",\n+  \"account.blocking\": \"Blocking\",\n   \"account.cancel_follow_request\": \"Cancel follow\",\n   \"account.copy\": \"Copy link to profile\",\n   \"account.direct\": \"Privately mention @{name}\",\n   \"account.disable_notifications\": \"Stop notifying me when @{name} posts\",\n+  \"account.domain_blocking\": \"Blocking domain\",\n   \"account.edit_profile\": \"Edit profile\",\n   \"account.enable_notifications\": \"Notify me when @{name} posts\",\n   \"account.endorse\": \"Feature on profile\",\n---\napp/javascript/mastodon/locales/pt-PT.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Servidores moderados\",\n   \"about.contact\": \"Contacto:\",\n+  \"about.default_locale\": \"Padr\u00e3o\",\n   \"about.disclaimer\": \"O Mastodon \u00e9 um software livre, de c\u00f3digo aberto e uma marca registada de Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Motivo n\u00e3o dispon\u00edvel\",\n   \"about.domain_blocks.preamble\": \"O Mastodon geralmente permite ver e interagir com o conte\u00fado de utilizadores de qualquer outra inst\u00e2ncia no fediverso. Estas s\u00e3o as exce\u00e7\u00f5es desta inst\u00e2ncia em espec\u00edfico.\",\n   \"about.domain_blocks.silenced.explanation\": \"Normalmente n\u00e3o ver\u00e1s perfis e conte\u00fados deste servidor, a n\u00e3o ser que os procures explicitamente ou optes por segui-los.\",\n   \"about.domain_blocks.silenced.title\": \"Limitados\",\n   \"about.domain_blocks.suspended.explanation\": \"Nenhum dado deste servidor ser\u00e1 processado, armazenado ou trocado, tornando imposs\u00edvel qualquer intera\u00e7\u00e3o ou comunica\u00e7\u00e3o com os utilizadores a partir deste servidor.\",\n   \"about.domain_blocks.suspended.title\": \"Suspensos\",\n+  \"about.language_label\": \"Idioma\",\n   \"about.not_available\": \"Esta informa\u00e7\u00e3o n\u00e3o foi disponibilizada neste servidor.\",\n   \"about.powered_by\": \"Rede social descentralizada baseada no {mastodon}\",\n   \"about.rules\": \"Regras do servidor\",\n@@ -308,6 +310,8 @@\n   \"emoji_button.search_results\": \"Resultados da pesquisa\",\n   \"emoji_button.symbols\": \"S\u00edmbolos\",\n   \"emoji_button.travel\": \"Viagens e lugares\",\n+  \"empty_column.account_featured.me\": \"Ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n+  \"empty_column.account_featured.other\": \"{acct} ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n   \"empty_column.account_featured_other.unknown\": \"Esta conta ainda n\u00e3o colocou nada em destaque.\",\n   \"empty_column.account_hides_collections\": \"Este utilizador escolheu n\u00e3o disponibilizar esta informa\u00e7\u00e3o\",\n   \"empty_column.account_suspended\": \"Conta suspensa\",\n@@ -341,6 +345,11 @@\n   \"explore.trending_links\": \"Not\u00edcias\",\n   \"explore.trending_statuses\": \"Publica\u00e7\u00f5es\",\n   \"explore.trending_tags\": \"#Etiquetas\",\n+  \"featured_carousel.header\": \"{count, plural, one {Publica\u00e7\u00e3o Afixada} other {Publica\u00e7\u00f5es Afixadas}}\",\n+  \"featured_carousel.next\": \"Seguinte\",\n+  \"featured_carousel.post\": \"Publica\u00e7\u00e3o\",\n+  \"featured_carousel.previous\": \"Anterior\",\n+  \"featured_carousel.slide\": \"{index} de {total}\",\n   \"filter_modal.added.context_mismatch_explanation\": \"Esta categoria de filtro n\u00e3o se aplica ao contexto em que acedeste a esta publica\u00e7\u00e3o. Se pretenderes que esta publica\u00e7\u00e3o seja filtrada tamb\u00e9m neste contexto, ter\u00e1s que editar o filtro.\",\n   \"filter_modal.added.context_mismatch_title\": \"O contexto n\u00e3o coincide!\",\n   \"filter_modal.added.expired_explanation\": \"Esta categoria de filtro expirou, tens de alterar a data de validade para que ele seja aplicado.\",\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -779,7 +779,8 @@ GEM\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n       rubocop-rspec (~> 3.5)\n-    ruby-prof (1.7.1)\n+    ruby-prof (1.7.2)\n+      base64\n     ruby-progressbar (1.13.0)\n     ruby-saml (1.18.0)\n       nokogiri (>= 1.13.10)\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [omniauth-saml](https://redirect.github.com/omniauth/omniauth-saml) | `2.2.3` -> `2.2.4` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/omniauth-saml/2.2.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/omniauth-saml/2.2.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/omniauth-saml/2.2.3/2.2.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/omniauth-saml/2.2.3/2.2.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>omniauth/omniauth-saml (omniauth-saml)</summary>\n\n### [`v2.2.4`](https://redirect.github.com/omniauth/omniauth-saml/blob/HEAD/CHANGELOG.md#v224-2025-05-14)\n\n[Compare Source](https://redirect.github.com/omniauth/omniauth-saml/compare/v2.2.3...v2.2.4)\n\n##### Bug Fixes\n\n-   remove :idp_cert_fingerprint_validator\t ([c573690](/../../commit/c573690))\n-   Fix GHSA-cgp2-2cmh-pf7x\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xNi4wIiwidXBkYXRlZEluVmVyIjoiNDAuMTYuMCIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -469,7 +469,7 @@ GEM\n     omniauth-rails_csrf_protection (1.0.2)\n       actionpack (>= 4.2)\n       omniauth (~> 2.0)\n-    omniauth-saml (2.2.3)\n+    omniauth-saml (2.2.4)\n       omniauth (~> 2.1)\n       ruby-saml (~> 1.18)\n     omniauth_openid_connect (0.8.0)\n---\n\n\n---\n\nChoice B:\napp/models/user.rb\n@@ -73,7 +73,6 @@ class User < ApplicationRecord\n   ACTIVE_DURATION = ENV.fetch('USER_ACTIVE_DAYS', 7).to_i.days.freeze\n \n   devise :two_factor_authenticatable,\n-         otp_secret_encryption_key: Rails.configuration.x.otp_secret,\n          otp_secret_length: 32\n \n   devise :two_factor_backupable,\n---\nconfig/environments/development.rb\n@@ -84,9 +84,6 @@\n   # Otherwise, use letter_opener, which launches a browser window to view sent mail.\n   config.action_mailer.delivery_method = ENV['HEROKU'] || ENV['VAGRANT'] || ENV['REMOTE_DEV'] ? :letter_opener_web : :letter_opener\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = ENV.fetch('OTP_SECRET', '1fc2b87989afa6351912abeebe31ffc5c476ead9bf8b3d74cbc4a302c7b69a45b40b1bbef3506ddad73e942e15ed5ca4b402bf9a66423626051104f4b5f05109')\n-\n   # Raise error when a before_action's only/except options reference missing actions.\n   config.action_controller.raise_on_missing_callback_actions = true\n \n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/locales/en-GB.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Moderated servers\",\n   \"about.contact\": \"Contact:\",\n+  \"about.default_locale\": \"Default\",\n   \"about.disclaimer\": \"Mastodon is free, open-source software, and a trademark of Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Reason not available\",\n   \"about.domain_blocks.preamble\": \"Mastodon generally allows you to view content from and interact with users from any other server in the Fediverse. These are the exceptions that have been made on this particular server.\",\n   \"about.domain_blocks.silenced.explanation\": \"You will generally not see profiles and content from this server, unless you explicitly look it up or opt into it by following.\",\n   \"about.domain_blocks.silenced.title\": \"Limited\",\n   \"about.domain_blocks.suspended.explanation\": \"No data from this server will be processed, stored or exchanged, making any interaction or communication with users from this server impossible.\",\n   \"about.domain_blocks.suspended.title\": \"Suspended\",\n+  \"about.language_label\": \"Language\",\n   \"about.not_available\": \"This information has not been made available on this server.\",\n   \"about.powered_by\": \"Decentralised social media powered by {mastodon}\",\n   \"about.rules\": \"Server rules\",\n@@ -19,10 +21,12 @@\n   \"account.block_domain\": \"Block domain {domain}\",\n   \"account.block_short\": \"Block\",\n   \"account.blocked\": \"Blocked\",\n+  \"account.blocking\": \"Blocking\",\n   \"account.cancel_follow_request\": \"Cancel follow\",\n   \"account.copy\": \"Copy link to profile\",\n   \"account.direct\": \"Privately mention @{name}\",\n   \"account.disable_notifications\": \"Stop notifying me when @{name} posts\",\n+  \"account.domain_blocking\": \"Blocking domain\",\n   \"account.edit_profile\": \"Edit profile\",\n   \"account.enable_notifications\": \"Notify me when @{name} posts\",\n   \"account.endorse\": \"Feature on profile\",\n---\napp/javascript/mastodon/locales/pt-PT.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Servidores moderados\",\n   \"about.contact\": \"Contacto:\",\n+  \"about.default_locale\": \"Padr\u00e3o\",\n   \"about.disclaimer\": \"O Mastodon \u00e9 um software livre, de c\u00f3digo aberto e uma marca registada de Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Motivo n\u00e3o dispon\u00edvel\",\n   \"about.domain_blocks.preamble\": \"O Mastodon geralmente permite ver e interagir com o conte\u00fado de utilizadores de qualquer outra inst\u00e2ncia no fediverso. Estas s\u00e3o as exce\u00e7\u00f5es desta inst\u00e2ncia em espec\u00edfico.\",\n   \"about.domain_blocks.silenced.explanation\": \"Normalmente n\u00e3o ver\u00e1s perfis e conte\u00fados deste servidor, a n\u00e3o ser que os procures explicitamente ou optes por segui-los.\",\n   \"about.domain_blocks.silenced.title\": \"Limitados\",\n   \"about.domain_blocks.suspended.explanation\": \"Nenhum dado deste servidor ser\u00e1 processado, armazenado ou trocado, tornando imposs\u00edvel qualquer intera\u00e7\u00e3o ou comunica\u00e7\u00e3o com os utilizadores a partir deste servidor.\",\n   \"about.domain_blocks.suspended.title\": \"Suspensos\",\n+  \"about.language_label\": \"Idioma\",\n   \"about.not_available\": \"Esta informa\u00e7\u00e3o n\u00e3o foi disponibilizada neste servidor.\",\n   \"about.powered_by\": \"Rede social descentralizada baseada no {mastodon}\",\n   \"about.rules\": \"Regras do servidor\",\n@@ -308,6 +310,8 @@\n   \"emoji_button.search_results\": \"Resultados da pesquisa\",\n   \"emoji_button.symbols\": \"S\u00edmbolos\",\n   \"emoji_button.travel\": \"Viagens e lugares\",\n+  \"empty_column.account_featured.me\": \"Ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n+  \"empty_column.account_featured.other\": \"{acct} ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n   \"empty_column.account_featured_other.unknown\": \"Esta conta ainda n\u00e3o colocou nada em destaque.\",\n   \"empty_column.account_hides_collections\": \"Este utilizador escolheu n\u00e3o disponibilizar esta informa\u00e7\u00e3o\",\n   \"empty_column.account_suspended\": \"Conta suspensa\",\n@@ -341,6 +345,11 @@\n   \"explore.trending_links\": \"Not\u00edcias\",\n   \"explore.trending_statuses\": \"Publica\u00e7\u00f5es\",\n   \"explore.trending_tags\": \"#Etiquetas\",\n+  \"featured_carousel.header\": \"{count, plural, one {Publica\u00e7\u00e3o Afixada} other {Publica\u00e7\u00f5es Afixadas}}\",\n+  \"featured_carousel.next\": \"Seguinte\",\n+  \"featured_carousel.post\": \"Publica\u00e7\u00e3o\",\n+  \"featured_carousel.previous\": \"Anterior\",\n+  \"featured_carousel.slide\": \"{index} de {total}\",\n   \"filter_modal.added.context_mismatch_explanation\": \"Esta categoria de filtro n\u00e3o se aplica ao contexto em que acedeste a esta publica\u00e7\u00e3o. Se pretenderes que esta publica\u00e7\u00e3o seja filtrada tamb\u00e9m neste contexto, ter\u00e1s que editar o filtro.\",\n   \"filter_modal.added.context_mismatch_title\": \"O contexto n\u00e3o coincide!\",\n   \"filter_modal.added.expired_explanation\": \"Esta categoria de filtro expirou, tens de alterar a data de validade para que ele seja aplicado.\",\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -94,7 +94,7 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n+    aws-partitions (1.1103.0)\n     aws-sdk-core (3.215.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n@@ -109,7 +109,7 @@ GEM\n       aws-sigv4 (~> 1.5)\n     aws-sigv4 (1.11.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n-    azure-blob (0.5.7)\n+    azure-blob (0.5.8)\n       rexml\n     base64 (0.2.0)\n     bcp47_spec (0.2.1)\n@@ -124,7 +124,7 @@ GEM\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n-    bootsnap (1.18.5)\n+    bootsnap (1.18.6)\n       msgpack (~> 1.2)\n     brakeman (7.0.2)\n       racc\n@@ -194,7 +194,7 @@ GEM\n     devise_pam_authenticatable2 (9.2.0)\n       devise (>= 4.0.0)\n       rpam2 (~> 4.0)\n-    diff-lcs (1.6.1)\n+    diff-lcs (1.6.2)\n     discard (1.4.0)\n       activerecord (>= 4.2, < 9.0)\n     docile (1.4.1)\n@@ -228,7 +228,7 @@ GEM\n     fabrication (2.31.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n-    faraday (2.13.0)\n+    faraday (2.13.1)\n       faraday-net_http (>= 2.0, < 3.5)\n       json\n       logger\n@@ -267,10 +267,10 @@ GEM\n       raabro (~> 1.4)\n     globalid (1.2.1)\n       activesupport (>= 6.1)\n-    google-protobuf (4.30.2)\n+    google-protobuf (4.31.0)\n       bigdecimal\n       rake (>= 13)\n-    googleapis-common-protos-types (1.19.0)\n+    googleapis-common-protos-types (1.20.0)\n       google-protobuf (>= 3.18, < 5.a)\n     haml (6.3.0)\n       temple (>= 0.8.2)\n@@ -338,7 +338,7 @@ GEM\n       azure-blob (~> 0.5.2)\n       hashie (~> 5.0)\n     jmespath (1.6.2)\n-    json (2.10.2)\n+    json (2.12.0)\n     json-canonicalization (1.0.0)\n     json-jwt (1.16.7)\n       activesupport (>= 4.2)\n@@ -411,7 +411,7 @@ GEM\n       activesupport (>= 4)\n       railties (>= 4)\n       request_store (~> 1.0)\n-    loofah (2.24.0)\n+    loofah (2.24.1)\n       crass (~> 1.0.2)\n       nokogiri (>= 1.12.0)\n     mail (2.8.1)\n@@ -427,9 +427,9 @@ GEM\n     mime-types (3.7.0)\n       logger\n       mime-types-data (~> 3.2025, >= 3.2025.0507)\n-    mime-types-data (3.2025.0507)\n+    mime-types-data (3.2025.0514)\n     mini_mime (1.1.5)\n-    mini_portile2 (2.8.8)\n+    mini_portile2 (2.8.9)\n     minitest (5.25.5)\n     msgpack (1.8.0)\n     multi_json (1.15.0)\n@@ -504,7 +504,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-active_support (~> 0.7)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-action_pack (0.12.0)\n+    opentelemetry-instrumentation-action_pack (0.12.1)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n       opentelemetry-instrumentation-rack (~> 0.21)\n@@ -618,7 +618,7 @@ GEM\n       activesupport (>= 7.0.0)\n       rack\n       railties (>= 7.0.0)\n-    psych (5.2.3)\n+    psych (5.2.6)\n       date\n       stringio\n     public_suffix (6.0.2)\n@@ -710,7 +710,7 @@ GEM\n       railties (>= 5.2)\n     rexml (3.4.1)\n     rotp (6.3.0)\n-    rouge (4.5.1)\n+    rouge (4.5.2)\n     rpam2 (4.0.2)\n     rqrcode (3.1.0)\n       chunky_png (~> 1.0)\n@@ -727,7 +727,7 @@ GEM\n       rspec-support (~> 3.13.0)\n     rspec-github (3.0.0)\n       rspec-core (~> 3.0)\n-    rspec-mocks (3.13.3)\n+    rspec-mocks (3.13.4)\n       diff-lcs (>= 1.2.0, < 2.0)\n       rspec-support (~> 3.13.0)\n     rspec-rails (8.0.0)\n@@ -1092,4 +1092,4 @@ RUBY VERSION\n    ruby 3.4.1p0\n \n BUNDLED WITH\n-   2.6.8\n+   2.6.9\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis prohibits the usage of a User's access token being used to register additional accounts, and instead forces using the client credentials grant type for account registration.\r\n\r\nDoorkeeper notes:\r\n- `doorkeeper_token.resource_owner_id` will be set to the user's ID if the access token was obtained via the authorization code grant flow, but will be nil if the access token was obtained via client credentials grant flow.\r\n- this assertion more strongly matches the [documented API](https://docs.joinmastodon.org/methods/accounts/#create), which is that this endpoint requires a App Token (client credential).\r\n\r\nPreviously this would have allowed a user-scoped access token to register a new account, which I don't think is what we intended here, as we only really want applications to be registering new accounts.\n\n---\n\nChoice A:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -1023,7 +1023,7 @@ export const AccountHeader: React.FC<{\n                   />\n                 </NavLink>\n               </div>\n-              <FamiliarFollowers accountId={accountId} />\n+              {signedIn && <FamiliarFollowers accountId={accountId} />}\n             </div>\n           )}\n         </div>\n---\n\n\n---\n\nChoice B:\napp/controllers/api/base_controller.rb\n@@ -50,6 +50,10 @@ def current_user\n     nil\n   end\n \n+  def require_client_credentials!\n+    render json: { error: 'This method requires an client credentials authentication' }, status: 403 if doorkeeper_token.resource_owner_id.present?\n+  end\n+\n   def require_authenticated_user!\n     render json: { error: 'This method requires an authenticated user' }, status: 401 unless current_user\n   end\n---\napp/controllers/api/v1/accounts_controller.rb\n@@ -10,6 +10,7 @@ class Api::V1::AccountsController < Api::BaseController\n   before_action -> { doorkeeper_authorize! :write, :'write:accounts' }, only: [:create]\n \n   before_action :require_user!, except: [:index, :show, :create]\n+  before_action :require_client_credentials!, only: [:create]\n   before_action :set_account, except: [:index, :create]\n   before_action :set_accounts, only: [:index]\n   before_action :check_account_approval, except: [:index, :create]\n---\nspec/fabricators/client_credentials_token_fabricator.rb\n@@ -0,0 +1,5 @@\n+# frozen_string_literal: true\n+\n+Fabricator :client_credentials_token, from: :accessible_access_token do\n+  resource_owner_id { nil }\n+end\n---\nspec/requests/api/v1/accounts_spec.rb\n@@ -78,10 +78,27 @@\n     end\n \n     let(:client_app) { Fabricate(:application) }\n-    let(:token) { Doorkeeper::AccessToken.find_or_create_for(application: client_app, resource_owner: nil, scopes: 'read write', use_refresh_token: false) }\n+    let(:token) { Fabricate(:client_credentials_token, application: client_app, scopes: 'read write') }\n     let(:agreement) { nil }\n     let(:date_of_birth) { nil }\n \n+    context 'when not using client credentials token' do\n+      let(:token) { Fabricate(:accessible_access_token, application: client_app, scopes: 'read write', resource_owner_id: user.id) }\n+\n+      it 'returns http forbidden error' do\n+        subject\n+\n+        expect(response).to have_http_status(403)\n+        expect(response.content_type)\n+          .to start_with('application/json')\n+\n+        expect(response.parsed_body)\n+          .to include(\n+            error: 'This method requires an client credentials authentication'\n+          )\n+      end\n+    end\n+\n     context 'when age verification is enabled' do\n       before do\n         Setting.min_age = 16\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -446,7 +446,7 @@ GEM\n     net-smtp (0.5.1)\n       net-protocol\n     nio4r (2.7.4)\n-    nokogiri (1.18.7)\n+    nokogiri (1.18.8)\n       mini_portile2 (~> 2.8.2)\n       racc (~> 1.4)\n     oj (3.16.10)\n---\n\n\n---\n\nChoice D:\napp/lib/entity_cache.rb\n@@ -26,7 +26,9 @@ def emoji(shortcodes, domain)\n       uncached_ids << shortcode unless cached.key?(to_key(:emoji, shortcode, domain))\n     end\n \n-    unless uncached_ids.empty?\n+    if uncached_ids.empty?\n+      uncached = {}\n+    else\n       uncached = CustomEmoji.enabled.where(shortcode: shortcodes, domain: domain).index_by(&:shortcode)\n       uncached.each_value { |item| Rails.cache.write(to_key(:emoji, item.shortcode, domain), item, expires_in: MAX_EXPIRATION) }\n     end\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nContains version bump and two removals, which were handled as side effects of https://github.com/mastodon/mastodon/pull/34746 and https://github.com/mastodon/mastodon/pull/34745\r\n\r\n\n\n---\n\nChoice A:\napp/helpers/json_ld_helper.rb\n@@ -72,6 +72,18 @@ def non_matching_uri_hosts?(base_url, comparison_url)\n     !haystack.casecmp(needle).zero?\n   end\n \n+  def safe_prefetched_embed(account, object, context)\n+    return unless object.is_a?(Hash)\n+\n+    # NOTE: Replacing the object's context by that of the parent activity is\n+    # not sound, but it's consistent with the rest of the codebase\n+    object = object.merge({ '@context' => context })\n+\n+    return if value_or_id(first_of_value(object['attributedTo'])) != account.uri || non_matching_uri_hosts?(account.uri, object['id'])\n+\n+    object\n+  end\n+\n   def canonicalize(json)\n     graph = RDF::Graph.new << JSON::LD::API.toRdf(json, documentLoader: method(:load_jsonld_context))\n     graph.dump(:normalize)\n---\napp/lib/activitypub/activity/create.rb\n@@ -204,7 +204,9 @@ def attach_quote(status)\n \n     @quote.status = status\n     @quote.save\n-    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, request_id: @options[:request_id])\n+\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, prefetched_quoted_object: embedded_quote, request_id: @options[:request_id])\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n     ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, @quote.id, @quote_uri, { 'request_id' => @options[:request_id] })\n   end\n---\napp/lib/activitypub/parser/status_parser.rb\n@@ -120,6 +120,11 @@ def quote_uri\n     end.first\n   end\n \n+  # The inlined quote; out of the attributes we support, only `https://w3id.org/fep/044f#quote` explicitly supports inlined objects\n+  def quoted_object\n+    as_array(@object['quote']).first\n+  end\n+\n   def quote_approval_uri\n     as_array(@object['quoteAuthorization']).first\n   end\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -273,7 +273,6 @@ def update_emojis!\n   def update_quote!\n     return unless Mastodon::Feature.inbound_quotes_enabled?\n \n-    quote = nil\n     quote_uri = @status_parser.quote_uri\n \n     if quote_uri.present?\n@@ -294,21 +293,23 @@ def update_quote!\n         quote = Quote.create(status: @status, approval_uri: approval_uri)\n         @quote_changed = true\n       end\n-    end\n \n-    if quote.present?\n-      begin\n-        quote.save\n-        ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, request_id: @request_id)\n-      rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n-        ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n-      end\n+      quote.save\n+\n+      fetch_and_verify_quote!(quote, quote_uri)\n     elsif @status.quote.present?\n       @status.quote.destroy!\n       @quote_changed = true\n     end\n   end\n \n+  def fetch_and_verify_quote!(quote, quote_uri)\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @activity_json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, prefetched_quoted_object: embedded_quote, request_id: @request_id)\n+  rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n+    ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n+  end\n+\n   def update_counts!\n     likes = @status_parser.favourites_count\n     shares =  @status_parser.reblogs_count\n---\napp/services/activitypub/verify_quote_service.rb\n@@ -4,15 +4,15 @@ class ActivityPub::VerifyQuoteService < BaseService\n   include JsonLdHelper\n \n   # Optionally fetch quoted post, and verify the quote is authorized\n-  def call(quote, fetchable_quoted_uri: nil, prefetched_body: nil, request_id: nil)\n+  def call(quote, fetchable_quoted_uri: nil, prefetched_quoted_object: nil, prefetched_approval: nil, request_id: nil)\n     @request_id = request_id\n     @quote = quote\n     @fetching_error = nil\n \n-    fetch_quoted_post_if_needed!(fetchable_quoted_uri)\n+    fetch_quoted_post_if_needed!(fetchable_quoted_uri, prefetched_body: prefetched_quoted_object)\n     return if fast_track_approval! || quote.approval_uri.blank?\n \n-    @json = fetch_approval_object(quote.approval_uri, prefetched_body:)\n+    @json = fetch_approval_object(quote.approval_uri, prefetched_body: prefetched_approval)\n     return quote.reject! if @json.nil?\n \n     return if non_matching_uri_hosts?(quote.approval_uri, value_or_id(@json['attributedTo']))\n@@ -68,11 +68,11 @@ def matching_quote_uri?\n     ActivityPub::TagManager.instance.uri_for(@quote.status) == value_or_id(@json['interactingObject'])\n   end\n \n-  def fetch_quoted_post_if_needed!(uri)\n+  def fetch_quoted_post_if_needed!(uri, prefetched_body: nil)\n     return if uri.nil? || @quote.quoted_status.present?\n \n     status = ActivityPub::TagManager.instance.uri_to_resource(uri, Status)\n-    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, request_id: @request_id)\n+    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, prefetched_body:, request_id: @request_id)\n \n     @quote.update(quoted_status: status) if status.present?\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS => e\n---\nspec/services/activitypub/verify_quote_service_spec.rb\n@@ -89,6 +89,37 @@\n       end\n     end\n \n+    context 'with a valid activity for a post that cannot be fetched but is passed as fetched_quoted_object' do\n+      let(:quoted_status) { nil }\n+\n+      let(:approval_interaction_target) { 'https://b.example.com/unknown-quoted' }\n+      let(:prefetched_object) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          type: 'Note',\n+          id: 'https://b.example.com/unknown-quoted',\n+          to: 'https://www.w3.org/ns/activitystreams#Public',\n+          attributedTo: ActivityPub::TagManager.instance.uri_for(quoted_account),\n+          content: 'previously unknown post',\n+        }.with_indifferent_access\n+      end\n+\n+      before do\n+        stub_request(:get, 'https://b.example.com/unknown-quoted')\n+          .to_return(status: 404)\n+      end\n+\n+      it 'updates the status' do\n+        expect { subject.call(quote, fetchable_quoted_uri: 'https://b.example.com/unknown-quoted', prefetched_quoted_object: prefetched_object) }\n+          .to change(quote, :state).to('accepted')\n+\n+        expect(a_request(:get, approval_uri))\n+          .to have_been_made.once\n+\n+        expect(quote.reload.quoted_status.content).to eq 'previously unknown post'\n+      end\n+    end\n+\n     context 'with a valid activity for a post that cannot be fetched but is inlined' do\n       let(:quoted_status) { nil }\n \n@@ -148,7 +179,7 @@\n \n     context 'with a valid activity for already-fetched posts, with a pre-fetched approval' do\n       it 'updates the status without fetching the activity' do\n-        expect { subject.call(quote, prefetched_body: Oj.dump(json)) }\n+        expect { subject.call(quote, prefetched_approval: Oj.dump(json)) }\n           .to change(quote, :state).to('accepted')\n \n         expect(a_request(:get, approval_uri))\n---\n\n\n---\n\nChoice B:\n.rubocop_todo.yml\n@@ -1,6 +1,6 @@\n # This configuration was generated by\n # `rubocop --auto-gen-config --auto-gen-only-exclude --no-offense-counts --no-auto-gen-timestamp`\n-# using RuboCop version 1.75.3.\n+# using RuboCop version 1.75.7.\n # The point is for the user to remove these configuration records\n # one by one as the offenses are removed from the code base.\n # Note that changes in the inspected code, or installation of new\n@@ -69,9 +69,3 @@ Style/OptionalBooleanParameter:\n     - 'app/services/fetch_resource_service.rb'\n     - 'app/workers/domain_block_worker.rb'\n     - 'app/workers/unfollow_follow_worker.rb'\n-\n-# This cop supports safe autocorrection (--autocorrect).\n-Style/RedundantConstantBase:\n-  Exclude:\n-    - 'config/environments/production.rb'\n-    - 'config/initializers/sidekiq.rb'\n---\n\n\n---\n\nChoice C:\napp/models/concerns/status/safe_reblog_insert.rb\n@@ -16,7 +16,7 @@ module Status::SafeReblogInsert\n     # The code is kept similar to ActiveRecord::Persistence code and calls it\n     # directly when we are not handling a reblog.\n     #\n-    # https://github.com/rails/rails/blob/v7.2.1.1/activerecord/lib/active_record/persistence.rb#L238-L263\n+    # https://github.com/rails/rails/blob/v8.0.2/activerecord/lib/active_record/persistence.rb#L238-L261\n     def _insert_record(connection, values, returning)\n       return super unless values.is_a?(Hash) && values['reblog_of_id']&.value.present?\n \n@@ -36,15 +36,13 @@ def _insert_record(connection, values, returning)\n       # Instead, we use a custom builder when a reblog is happening:\n       im = _compile_reblog_insert(values)\n \n-      with_connection do |_c|\n-        connection.insert(\n-          im, \"#{self} Create\", primary_key || false, primary_key_value,\n-          returning: returning\n-        ).tap do |result|\n-          # Since we are using SELECT instead of VALUES, a non-error `nil` return is possible.\n-          # For our purposes, it's equivalent to a foreign key constraint violation\n-          raise ActiveRecord::InvalidForeignKey, \"(reblog_of_id)=(#{values['reblog_of_id'].value}) is not present in table \\\"statuses\\\"\" if result.nil?\n-        end\n+      connection.insert(\n+        im, \"#{self} Create\", primary_key || false, primary_key_value,\n+        returning: returning\n+      ).tap do |result|\n+        # Since we are using SELECT instead of VALUES, a non-error `nil` return is possible.\n+        # For our purposes, it's equivalent to a foreign key constraint violation\n+        raise ActiveRecord::InvalidForeignKey, \"(reblog_of_id)=(#{values['reblog_of_id'].value}) is not present in table \\\"statuses\\\"\" if result.nil?\n       end\n     end\n \n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -62,7 +62,7 @@ gem 'inline_svg'\n gem 'irb', '~> 1.8'\n gem 'kaminari', '~> 1.2'\n gem 'link_header', '~> 0.0'\n-gem 'linzer', '~> 0.6.1'\n+gem 'linzer', '~> 0.7.0'\n gem 'mario-redis-lock', '~> 1.2', require: 'redis_lock'\n gem 'mime-types', '~> 3.7.0', require: 'mime/types/columnar'\n gem 'mutex_m'\n---\nGemfile.lock\n@@ -148,6 +148,7 @@ GEM\n     case_transform (0.2)\n       activesupport\n     cbor (0.5.9.8)\n+    cgi (0.4.2)\n     charlock_holmes (0.7.9)\n     chewy (7.6.0)\n       activesupport (>= 5.2)\n@@ -262,6 +263,7 @@ GEM\n       fog-core (~> 2.1)\n       fog-json (>= 1.0)\n     formatador (1.1.0)\n+    forwardable (1.3.3)\n     fugit (1.11.1)\n       et-orbi (~> 1, >= 1.2.11)\n       raabro (~> 1.4)\n@@ -396,7 +398,11 @@ GEM\n       rexml\n     link_header (0.0.8)\n     lint_roller (1.1.0)\n-    linzer (0.6.5)\n+    linzer (0.7.0)\n+      cgi (~> 0.4.2)\n+      forwardable (~> 1.3, >= 1.3.3)\n+      logger (~> 1.7, >= 1.7.0)\n+      net-http (~> 0.6.0)\n       openssl (~> 3.0, >= 3.0.0)\n       rack (>= 2.2, < 4.0)\n       starry (~> 0.2)\n@@ -628,7 +634,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -995,7 +1001,7 @@ DEPENDENCIES\n   letter_opener (~> 1.8)\n   letter_opener_web (~> 3.0)\n   link_header (~> 0.0)\n-  linzer (~> 0.6.1)\n+  linzer (~> 0.7.0)\n   lograge (~> 0.12)\n   mail (~> 2.8)\n   mario-redis-lock (~> 1.2)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [pghero](https://redirect.github.com/ankane/pghero) | `3.6.2` -> `3.7.0` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/pghero/3.7.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/pghero/3.7.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/pghero/3.6.2/3.7.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/pghero/3.6.2/3.7.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>ankane/pghero (pghero)</summary>\n\n### [`v3.7.0`](https://redirect.github.com/ankane/pghero/blob/HEAD/CHANGELOG.md#370-2025-05-26)\n\n[Compare Source](https://redirect.github.com/ankane/pghero/compare/v3.6.2...v3.7.0)\n\n-   Dropped support for Linux package for Ubuntu 20.04\n-   Dropped support for Ruby < 3.2 and Rails < 7.1\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xNi4wIiwidXBkYXRlZEluVmVyIjoiNDAuMTYuMCIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -381,7 +381,7 @@ GEM\n       marcel (~> 1.0.1)\n       mime-types\n       terrapin (>= 0.6.0, < 2.0)\n-    language_server-protocol (3.17.0.4)\n+    language_server-protocol (3.17.0.5)\n     launchy (3.1.1)\n       addressable (~> 2.8)\n       childprocess (~> 5.0)\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.5)\n+    rubocop (1.75.6)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -200,7 +200,7 @@ GEM\n     doorkeeper (5.8.2)\n       railties (>= 5)\n     dotenv (3.1.8)\n-    drb (2.2.1)\n+    drb (2.2.3)\n     dry-cli (1.2.0)\n     elasticsearch (7.17.11)\n       elasticsearch-api (= 7.17.11)\n@@ -602,8 +602,8 @@ GEM\n     pastel (0.8.0)\n       tty-color (~> 0.5)\n     pg (1.5.9)\n-    pghero (3.6.2)\n-      activerecord (>= 6.1)\n+    pghero (3.7.0)\n+      activerecord (>= 7.1)\n     pp (0.6.2)\n       prettyprint\n     premailer (1.27.0)\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -13279,14 +13279,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-cloudflare@npm:^1.1.1\":\n-  version: 1.1.1\n-  resolution: \"pg-cloudflare@npm:1.1.1\"\n-  checksum: 10c0/a68b957f755be6af813d68ccaf4c906a000fd2ecb362cd281220052cc9e2f6c26da3b88792742387008c30b3bf0d2fa3a0eff04aeb8af4414023c99ae78e07bd\n+\"pg-cloudflare@npm:^1.2.0\":\n+  version: 1.2.0\n+  resolution: \"pg-cloudflare@npm:1.2.0\"\n+  checksum: 10c0/d6f2d032aeab291b17d627b051aae85420aea86a3371895a77b55fec93e3dac05880fbf09e5de33486ad3a2e6d7d56a025a8aa66f0d5883984f9834e4cd6f6a4\n   languageName: node\n   linkType: hard\n \n-\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.7.0\":\n+\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n   version: 2.8.1\n   resolution: \"pg-connection-string@npm:2.8.1\"\n   checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n@@ -13307,19 +13307,19 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.8.0\":\n-  version: 3.8.0\n-  resolution: \"pg-pool@npm:3.8.0\"\n+\"pg-pool@npm:^3.9.1\":\n+  version: 3.9.1\n+  resolution: \"pg-pool@npm:3.9.1\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/c05287b0caafeab43807e6ad22d153c09c473dbeb5b2cea13b83102376e9a56f46b91fa9adf9d53885ce198280c6a95555390987c42b3858d1936d3e0cdc83aa\n+  checksum: 10c0/2bbc0892ab7325486b7d5ad8ade59ec925476666ac3959cb4850814c5334bb2f1344258707f8d0445093b59dd6e94401508cebcee490d4827821549147a2ebd9\n   languageName: node\n   linkType: hard\n \n-\"pg-protocol@npm:*, pg-protocol@npm:^1.8.0\":\n-  version: 1.8.0\n-  resolution: \"pg-protocol@npm:1.8.0\"\n-  checksum: 10c0/2be784955599d84b564795952cee52cc2b8eab0be43f74fc1061506353801e282c1d52c9e0691a9b72092c1f3fde370e9b181e80fef6bb82a9b8d1618bfa91e6\n+\"pg-protocol@npm:*, pg-protocol@npm:^1.9.0\":\n+  version: 1.9.0\n+  resolution: \"pg-protocol@npm:1.9.0\"\n+  checksum: 10c0/c37e61d7fafa97f22eabf12de69863f42fdabb3671df9cc2623bd0ffd6bdedc212e7e8460ad2c721c8a08d8477b4f128a923bf2381905d68a23a532ec7517c77\n   languageName: node\n   linkType: hard\n \n@@ -13352,13 +13352,13 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.14.1\n-  resolution: \"pg@npm:8.14.1\"\n+  version: 8.15.1\n+  resolution: \"pg@npm:8.15.1\"\n   dependencies:\n-    pg-cloudflare: \"npm:^1.1.1\"\n-    pg-connection-string: \"npm:^2.7.0\"\n-    pg-pool: \"npm:^3.8.0\"\n-    pg-protocol: \"npm:^1.8.0\"\n+    pg-cloudflare: \"npm:^1.2.0\"\n+    pg-connection-string: \"npm:^2.8.1\"\n+    pg-pool: \"npm:^3.9.1\"\n+    pg-protocol: \"npm:^1.9.0\"\n     pg-types: \"npm:^2.1.0\"\n     pgpass: \"npm:1.x\"\n   peerDependencies:\n@@ -13369,7 +13369,7 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/221741cfcea4ab32c8b57bd60703bc36cfb5622dcac56c19e45f504ef8669f2f2e0429af8850f58079cfc89055da35b5a5e12de19e0505e3f61a4b4349388dcb\n+  checksum: 10c0/c6e5fd9cd6af7fc3208e48f860fd9ec9f7bc20192e449b0b36b096a9d5889de50706c705f6996e51a765bd4b7331179d7ffb43528a141bb996ee6f2c8f994c9a\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -620,7 +620,7 @@ GEM\n     psych (5.2.3)\n       date\n       stringio\n-    public_suffix (6.0.1)\n+    public_suffix (6.0.2)\n     puma (6.6.0)\n       nio4r (~> 2.0)\n     pundit (2.5.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nSidekiq was the last thing keeping us in 2.x for `rack`, which was originally pinned to a version here - https://github.com/mastodon/mastodon/pull/12972 - due to another rack/sidekiq interaction. Unpinning version entirely in this PR, relying on gems to ask for what they need and let bundler resolve. LMK if there's some other still existing reason to keep the explicit version range pinned.\r\n\r\nI did a quick pass to make sure the various `Rack::...` constants we reference still exist in same names, and I think they do. Also would like feedback on any specific middlewares or other interactions that might have missing/low coverage and could use a more thorough vetting.\n\n---\n\nChoice A:\nGemfile.lock\n@@ -94,7 +94,7 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1080.0)\n+    aws-partitions (1.1087.0)\n     aws-sdk-core (3.215.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n@@ -120,7 +120,7 @@ GEM\n       rack (>= 0.9.0)\n       rouge (>= 1.0.0)\n     bigdecimal (3.1.9)\n-    bindata (2.5.0)\n+    bindata (2.5.1)\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n@@ -227,7 +227,7 @@ GEM\n     fabrication (2.31.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n-    faraday (2.12.2)\n+    faraday (2.13.0)\n       faraday-net_http (>= 2.0, < 3.5)\n       json\n       logger\n@@ -239,7 +239,7 @@ GEM\n       net-http (>= 0.5.0)\n     fast_blank (1.0.1)\n     fastimage (2.4.0)\n-    ffi (1.17.1)\n+    ffi (1.17.2)\n     ffi-compiler (1.3.2)\n       ffi (>= 1.15.5)\n       rake\n@@ -426,7 +426,7 @@ GEM\n     mime-types (3.6.2)\n       logger\n       mime-types-data (~> 3.2015)\n-    mime-types-data (3.2025.0402)\n+    mime-types-data (3.2025.0408)\n     mini_mime (1.1.5)\n     mini_portile2 (2.8.8)\n     minitest (5.25.5)\n@@ -585,8 +585,8 @@ GEM\n     ostruct (0.6.1)\n     ox (2.14.22)\n       bigdecimal (>= 3.0)\n-    parallel (1.26.3)\n-    parser (3.3.7.4)\n+    parallel (1.27.0)\n+    parser (3.3.8.0)\n       ast (~> 2.4.1)\n       racc\n     parslet (2.0.0)\n@@ -751,7 +751,7 @@ GEM\n       rubocop-ast (>= 1.44.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.0)\n+    rubocop-ast (1.44.1)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n@@ -1085,4 +1085,4 @@ RUBY VERSION\n    ruby 3.4.1p0\n \n BUNDLED WITH\n-   2.6.7\n+   2.6.8\n---\n\n\n---\n\nChoice B:\n.github/renovate.json5\n@@ -39,7 +39,6 @@\n       // Require Dependency Dashboard Approval for major version bumps of these Ruby packages\n       matchManagers: ['bundler'],\n       matchPackageNames: [\n-        'rack', // Needs to be synced with Rails version\n         'strong_migrations', // Requires manual upgrade\n         'sidekiq', // Requires manual upgrade\n         'sidekiq-unique-jobs', // Requires manual upgrades and sync with Sidekiq version\n---\nGemfile\n@@ -5,7 +5,6 @@ ruby '>= 3.2.0', '< 3.5.0'\n \n gem 'propshaft'\n gem 'puma', '~> 6.3'\n-gem 'rack', '~> 2.2.7'\n gem 'rails', '~> 8.0'\n gem 'thor', '~> 1.2'\n \n---\nGemfile.lock\n@@ -633,7 +633,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.16)\n+    rack (3.1.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -645,18 +645,19 @@ GEM\n       faraday-follow_redirects\n       json-jwt (>= 1.11.0)\n       rack (>= 2.1.0)\n-    rack-protection (3.2.0)\n+    rack-protection (4.1.1)\n       base64 (>= 0.1.0)\n-      rack (~> 2.2, >= 2.2.4)\n+      logger (>= 1.6.0)\n+      rack (>= 3.0.0, < 4)\n     rack-proxy (0.7.7)\n       rack\n-    rack-session (1.0.2)\n-      rack (< 3)\n+    rack-session (2.1.1)\n+      base64 (>= 0.1.0)\n+      rack (>= 3.0.0)\n     rack-test (2.2.0)\n       rack (>= 1.3)\n-    rackup (1.0.1)\n-      rack (< 3)\n-      webrick\n+    rackup (2.2.1)\n+      rack (>= 3)\n     rails (8.0.2)\n       actioncable (= 8.0.2)\n       actionmailbox (= 8.0.2)\n@@ -1044,7 +1045,6 @@ DEPENDENCIES\n   public_suffix (~> 6.0)\n   puma (~> 6.3)\n   pundit (~> 2.3)\n-  rack (~> 2.2.7)\n   rack-attack (~> 6.6)\n   rack-cors (~> 2.0)\n   rack-test (~> 2.1)\n---\nconfig/initializers/mime_types.rb\n@@ -2,6 +2,3 @@\n \n Mime::Type.register 'application/json', :json, %w(text/x-json application/jsonrequest application/jrd+json application/activity+json application/ld+json)\n Mime::Type.register 'text/xml',         :xml,  %w(application/xml application/atom+xml application/xrd+xml)\n-\n-# WebP is not defined in Rack 2.2.\n-Rack::Mime::MIME_TYPES['.webp'] = 'image/webp'\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -62,7 +62,7 @@ gem 'inline_svg'\n gem 'irb', '~> 1.8'\n gem 'kaminari', '~> 1.2'\n gem 'link_header', '~> 0.0'\n-gem 'linzer', '~> 0.6.1'\n+gem 'linzer', '~> 0.7.0'\n gem 'mario-redis-lock', '~> 1.2', require: 'redis_lock'\n gem 'mime-types', '~> 3.7.0', require: 'mime/types/columnar'\n gem 'mutex_m'\n---\nGemfile.lock\n@@ -148,6 +148,7 @@ GEM\n     case_transform (0.2)\n       activesupport\n     cbor (0.5.9.8)\n+    cgi (0.4.2)\n     charlock_holmes (0.7.9)\n     chewy (7.6.0)\n       activesupport (>= 5.2)\n@@ -262,6 +263,7 @@ GEM\n       fog-core (~> 2.1)\n       fog-json (>= 1.0)\n     formatador (1.1.0)\n+    forwardable (1.3.3)\n     fugit (1.11.1)\n       et-orbi (~> 1, >= 1.2.11)\n       raabro (~> 1.4)\n@@ -396,7 +398,11 @@ GEM\n       rexml\n     link_header (0.0.8)\n     lint_roller (1.1.0)\n-    linzer (0.6.5)\n+    linzer (0.7.0)\n+      cgi (~> 0.4.2)\n+      forwardable (~> 1.3, >= 1.3.3)\n+      logger (~> 1.7, >= 1.7.0)\n+      net-http (~> 0.6.0)\n       openssl (~> 3.0, >= 3.0.0)\n       rack (>= 2.2, < 4.0)\n       starry (~> 0.2)\n@@ -628,7 +634,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -995,7 +1001,7 @@ DEPENDENCIES\n   letter_opener (~> 1.8)\n   letter_opener_web (~> 3.0)\n   link_header (~> 0.0)\n-  linzer (~> 0.6.1)\n+  linzer (~> 0.7.0)\n   lograge (~> 0.12)\n   mail (~> 2.8)\n   mario-redis-lock (~> 1.2)\n---\n\n\n---\n\nChoice D:\n.nvmrc\n@@ -1 +1 @@\n-22.14\n+22.15\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [sidekiq-unique-jobs](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs) | `8.0.10` -> `8.0.11` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/sidekiq-unique-jobs/8.0.11?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/sidekiq-unique-jobs/8.0.11?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/sidekiq-unique-jobs/8.0.10/8.0.11?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/sidekiq-unique-jobs/8.0.10/8.0.11?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>mhenrixon/sidekiq-unique-jobs (sidekiq-unique-jobs)</summary>\n\n### [`v8.0.11`](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/blob/HEAD/CHANGELOG.md#v8011-2025-05-25)\n\n[Compare Source](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/compare/v8.0.10...v8.0.11)\n\n[Full Changelog](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/compare/v8.0.10...v8.0.11)\n\n**Implemented enhancements:**\n\n-   chore: address recent rubocop changes [#&#8203;880](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/pull/880) ([mhenrixon](https://redirect.github.com/mhenrixon))\n-   feat(digest): allow modern algorithm [#&#8203;853](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/pull/853) ([mhenrixon](https://redirect.github.com/mhenrixon))\n\n**Closed issues:**\n\n-   Your paypal link doesn't work [#&#8203;876](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/issues/876)\n-   Replace MD5 with SHA256+ [#&#8203;848](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/issues/848)\n-   NoMethodError: undefined method \\`\\[]' for true:TrueClass [#&#8203;643](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/issues/643)\n\n**Merged pull requests:**\n\n-   Add support for lock_ttl to be a Proc/class method [#&#8203;879](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/pull/879) ([brayden-onesignal](https://redirect.github.com/brayden-onesignal))\n-   Move from Sidekiq 8 beta to released version [#&#8203;872](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/pull/872) ([jukra](https://redirect.github.com/jukra))\n-   update Reject#kill_with_options? for Ruby 3 kwargs [#&#8203;868](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/pull/868) ([stathis-alexander](https://redirect.github.com/stathis-alexander))\n-   Remove redundant include to locales (for Sidekiq 8) [#&#8203;867](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/pull/867) ([jukra](https://redirect.github.com/jukra))\n-   Support for Sidekiq 8 [#&#8203;866](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/pull/866) ([jukra](https://redirect.github.com/jukra))\n-   \ud83d\udcdd Improve README.md [#&#8203;860](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/pull/860) ([jaredsmithse](https://redirect.github.com/jaredsmithse))\n-   mention ttl and timeout unit (seconds) in README [#&#8203;859](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/pull/859) ([fwolfst](https://redirect.github.com/fwolfst))\n-   Add a note to README on `schedule_in` option for `reschedule` conflict strategy [#&#8203;849](https://redirect.github.com/mhenrixon/sidekiq-unique-jobs/pull/849) ([vittorius](https://redirect.github.com/vittorius))\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xNi4wIiwidXBkYXRlZEluVmVyIjoiNDAuMTYuMCIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\napp/javascript/mastodon/components/featured_carousel.tsx\n@@ -5,6 +5,7 @@ import {\n   useLayoutEffect,\n   useRef,\n   useState,\n+  useId,\n } from 'react';\n \n import { defineMessages, FormattedMessage, useIntl } from 'react-intl';\n@@ -17,12 +18,14 @@ import { animated, useSpring } from '@react-spring/web';\n import { useDrag } from '@use-gesture/react';\n \n import { expandAccountFeaturedTimeline } from '@/mastodon/actions/timelines';\n+import { Icon } from '@/mastodon/components/icon';\n import { IconButton } from '@/mastodon/components/icon_button';\n import StatusContainer from '@/mastodon/containers/status_container';\n import { usePrevious } from '@/mastodon/hooks/usePrevious';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n import ChevronLeftIcon from '@/material-icons/400-24px/chevron_left.svg?react';\n import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react';\n+import PushPinIcon from '@/material-icons/400-24px/push_pin.svg?react';\n \n const messages = defineMessages({\n   previous: { id: 'featured_carousel.previous', defaultMessage: 'Previous' },\n@@ -38,6 +41,7 @@ export const FeaturedCarousel: React.FC<{\n   tagged?: string;\n }> = ({ accountId, tagged }) => {\n   const intl = useIntl();\n+  const accessibilityId = useId();\n \n   // Load pinned statuses\n   const dispatch = useAppDispatch();\n@@ -120,11 +124,15 @@ export const FeaturedCarousel: React.FC<{\n       className='featured-carousel'\n       {...bind()}\n       aria-roledescription='carousel'\n-      aria-labelledby='featured-carousel-title'\n+      aria-labelledby={`${accessibilityId}-title`}\n       role='region'\n     >\n       <div className='featured-carousel__header'>\n-        <h4 className='featured-carousel__title' id='featured-carousel-title'>\n+        <h4\n+          className='featured-carousel__title'\n+          id={`${accessibilityId}-title`}\n+        >\n+          <Icon id='thumb-tack' icon={PushPinIcon} />\n           <FormattedMessage\n             id='featured_carousel.header'\n             defaultMessage='{count, plural, one {Pinned Post} other {Pinned Posts}}'\n---\napp/javascript/styles/mastodon/components.scss\n@@ -11074,5 +11074,13 @@ noscript {\n     font-size: 12px;\n     font-weight: 500;\n     text-transform: uppercase;\n+    display: flex;\n+    align-items: center;\n+    gap: 4px;\n+\n+    .icon {\n+      width: 16px;\n+      height: 16px;\n+    }\n   }\n }\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -592,7 +592,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n     orm_adapter (0.5.0)\n     ostruct (0.6.1)\n-    ox (2.14.22)\n+    ox (2.14.23)\n       bigdecimal (>= 3.0)\n     parallel (1.27.0)\n     parser (3.3.8.0)\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -827,9 +827,9 @@ GEM\n       rufus-scheduler (~> 3.2)\n       sidekiq (>= 6, < 8)\n       tilt (>= 1.4.0, < 3)\n-    sidekiq-unique-jobs (8.0.10)\n+    sidekiq-unique-jobs (8.0.11)\n       concurrent-ruby (~> 1.0, >= 1.0.5)\n-      sidekiq (>= 7.0.0, < 8.0.0)\n+      sidekiq (>= 7.0.0, < 9.0.0)\n       thor (>= 1.0, < 3.0)\n     simple-navigation (4.4.0)\n       activesupport (>= 2.3.2)\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -495,6 +495,8 @@ GEM\n       opentelemetry-common (~> 0.20)\n       opentelemetry-sdk (~> 1.2)\n       opentelemetry-semantic_conventions\n+    opentelemetry-helpers-sql (0.1.1)\n+      opentelemetry-api (~> 1.0)\n     opentelemetry-helpers-sql-obfuscation (0.3.0)\n       opentelemetry-common (~> 0.21)\n     opentelemetry-instrumentation-action_mailer (0.4.0)\n@@ -548,8 +550,9 @@ GEM\n     opentelemetry-instrumentation-net_http (0.23.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-pg (0.30.0)\n+    opentelemetry-instrumentation-pg (0.30.1)\n       opentelemetry-api (~> 1.0)\n+      opentelemetry-helpers-sql\n       opentelemetry-helpers-sql-obfuscation\n       opentelemetry-instrumentation-base (~> 0.23.0)\n     opentelemetry-instrumentation-rack (0.26.0)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34793\n\n---\n\nChoice A:\napp/controllers/api/base_controller.rb\n@@ -72,6 +72,13 @@ def require_user!\n     end\n   end\n \n+  # Redefine `require_functional!` to properly output JSON instead of HTML redirects\n+  def require_functional!\n+    return if current_user.functional?\n+\n+    require_user!\n+  end\n+\n   def render_empty\n     render json: {}, status: 200\n   end\n---\napp/controllers/application_controller.rb\n@@ -72,10 +72,24 @@ def store_referrer\n   def require_functional!\n     return if current_user.functional?\n \n-    if current_user.confirmed?\n-      redirect_to edit_user_registration_path\n-    else\n-      redirect_to auth_setup_path\n+    respond_to do |format|\n+      format.any do\n+        if current_user.confirmed?\n+          redirect_to edit_user_registration_path\n+        else\n+          redirect_to auth_setup_path\n+        end\n+      end\n+\n+      format.json do\n+        if !current_user.confirmed?\n+          render json: { error: 'Your login is missing a confirmed e-mail address' }, status: 403\n+        elsif !current_user.approved?\n+          render json: { error: 'Your login is currently pending approval' }, status: 403\n+        elsif !current_user.functional?\n+          render json: { error: 'Your login is currently disabled' }, status: 403\n+        end\n+      end\n     end\n   end\n \n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/actions/tags_typed.ts\n@@ -1,4 +1,10 @@\n-import { apiGetTag, apiFollowTag, apiUnfollowTag } from 'mastodon/api/tags';\n+import {\n+  apiGetTag,\n+  apiFollowTag,\n+  apiUnfollowTag,\n+  apiFeatureTag,\n+  apiUnfeatureTag,\n+} from 'mastodon/api/tags';\n import { createDataLoadingThunk } from 'mastodon/store/typed_functions';\n \n export const fetchHashtag = createDataLoadingThunk(\n@@ -15,3 +21,13 @@ export const unfollowHashtag = createDataLoadingThunk(\n   'tags/unfollow',\n   ({ tagId }: { tagId: string }) => apiUnfollowTag(tagId),\n );\n+\n+export const featureHashtag = createDataLoadingThunk(\n+  'tags/feature',\n+  ({ tagId }: { tagId: string }) => apiFeatureTag(tagId),\n+);\n+\n+export const unfeatureHashtag = createDataLoadingThunk(\n+  'tags/unfeature',\n+  ({ tagId }: { tagId: string }) => apiUnfeatureTag(tagId),\n+);\n---\napp/javascript/mastodon/api/tags.ts\n@@ -10,6 +10,12 @@ export const apiFollowTag = (tagId: string) =>\n export const apiUnfollowTag = (tagId: string) =>\n   apiRequestPost<ApiHashtagJSON>(`v1/tags/${tagId}/unfollow`);\n \n+export const apiFeatureTag = (tagId: string) =>\n+  apiRequestPost<ApiHashtagJSON>(`v1/tags/${tagId}/feature`);\n+\n+export const apiUnfeatureTag = (tagId: string) =>\n+  apiRequestPost<ApiHashtagJSON>(`v1/tags/${tagId}/unfeature`);\n+\n export const apiGetFollowedTags = async (url?: string) => {\n   const response = await api().request<ApiHashtagJSON[]>({\n     method: 'GET',\n---\napp/javascript/mastodon/api_types/tags.ts\n@@ -10,4 +10,5 @@ export interface ApiHashtagJSON {\n   url: string;\n   history: [ApiHistoryJSON, ...ApiHistoryJSON[]];\n   following?: boolean;\n+  featuring?: boolean;\n }\n---\napp/javascript/mastodon/features/hashtag_timeline/components/hashtag_header.tsx\n@@ -9,6 +9,8 @@ import {\n   fetchHashtag,\n   followHashtag,\n   unfollowHashtag,\n+  featureHashtag,\n+  unfeatureHashtag,\n } from 'mastodon/actions/tags_typed';\n import type { ApiHashtagJSON } from 'mastodon/api_types/tags';\n import { Button } from 'mastodon/components/button';\n@@ -28,6 +30,11 @@ const messages = defineMessages({\n     id: 'hashtag.admin_moderation',\n     defaultMessage: 'Open moderation interface for #{name}',\n   },\n+  feature: { id: 'hashtag.feature', defaultMessage: 'Feature on profile' },\n+  unfeature: {\n+    id: 'hashtag.unfeature',\n+    defaultMessage: \"Don't feature on profile\",\n+  },\n });\n \n const usesRenderer = (displayNumber: React.ReactNode, pluralReady: number) => (\n@@ -88,22 +95,51 @@ export const HashtagHeader: React.FC<{\n   }, [dispatch, tagId, setTag]);\n \n   const menu = useMemo(() => {\n-    const tmp = [];\n+    const arr = [];\n+\n+    if (tag && signedIn) {\n+      const handleFeature = () => {\n+        if (tag.featuring) {\n+          void dispatch(unfeatureHashtag({ tagId })).then((result) => {\n+            if (isFulfilled(result)) {\n+              setTag(result.payload);\n+            }\n+\n+            return '';\n+          });\n+        } else {\n+          void dispatch(featureHashtag({ tagId })).then((result) => {\n+            if (isFulfilled(result)) {\n+              setTag(result.payload);\n+            }\n+\n+            return '';\n+          });\n+        }\n+      };\n \n-    if (\n-      tag &&\n-      signedIn &&\n-      (permissions & PERMISSION_MANAGE_TAXONOMIES) ===\n-        PERMISSION_MANAGE_TAXONOMIES\n-    ) {\n-      tmp.push({\n-        text: intl.formatMessage(messages.adminModeration, { name: tag.id }),\n-        href: `/admin/tags/${tag.id}`,\n+      arr.push({\n+        text: intl.formatMessage(\n+          tag.featuring ? messages.unfeature : messages.feature,\n+        ),\n+        action: handleFeature,\n       });\n+\n+      arr.push(null);\n+\n+      if (\n+        (permissions & PERMISSION_MANAGE_TAXONOMIES) ===\n+        PERMISSION_MANAGE_TAXONOMIES\n+      ) {\n+        arr.push({\n+          text: intl.formatMessage(messages.adminModeration, { name: tagId }),\n+          href: `/admin/tags/${tag.id}`,\n+        });\n+      }\n     }\n \n-    return tmp;\n-  }, [signedIn, permissions, intl, tag]);\n+    return arr;\n+  }, [setTag, dispatch, tagId, signedIn, permissions, intl, tag]);\n \n   const handleFollow = useCallback(() => {\n     if (!signedIn || !tag) {\n---\napp/javascript/mastodon/locales/en.json\n@@ -401,8 +401,10 @@\n   \"hashtag.counter_by_accounts\": \"{count, plural, one {{counter} participant} other {{counter} participants}}\",\n   \"hashtag.counter_by_uses\": \"{count, plural, one {{counter} post} other {{counter} posts}}\",\n   \"hashtag.counter_by_uses_today\": \"{count, plural, one {{counter} post} other {{counter} posts}} today\",\n+  \"hashtag.feature\": \"Feature on profile\",\n   \"hashtag.follow\": \"Follow hashtag\",\n   \"hashtag.mute\": \"Mute #{hashtag}\",\n+  \"hashtag.unfeature\": \"Don't feature on profile\",\n   \"hashtag.unfollow\": \"Unfollow hashtag\",\n   \"hashtags.and_other\": \"\u2026and {count, plural, other {# more}}\",\n   \"hints.profiles.followers_may_be_missing\": \"Followers for this profile may be missing.\",\n---\n\n\n---\n\nChoice C:\nlib/premailer_bundled_asset_strategy.rb\n@@ -15,7 +15,9 @@ def load(url)\n         headers\n       ).presence\n     else\n-      path = Rails.public_path.join(url.delete_prefix('/'))\n+      url = url.delete_prefix(Rails.configuration.action_controller.asset_host) if Rails.configuration.action_controller.asset_host.present?\n+      url = url.delete_prefix('/')\n+      path = Rails.public_path.join(url)\n       return unless path.exist?\n \n       path.read\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -9177,14 +9177,14 @@ __metadata:\n   linkType: hard\n \n \"pino-http@npm:^10.0.0\":\n-  version: 10.4.0\n-  resolution: \"pino-http@npm:10.4.0\"\n+  version: 10.5.0\n+  resolution: \"pino-http@npm:10.5.0\"\n   dependencies:\n     get-caller-file: \"npm:^2.0.5\"\n     pino: \"npm:^9.0.0\"\n     pino-std-serializers: \"npm:^7.0.0\"\n-    process-warning: \"npm:^4.0.0\"\n-  checksum: 10c0/64144e2c94e939070f56ad82dfb012b6a98d21582e0660cf821e7cee64d4e06f7724aa40bc5bf9cd1254d58ab7cbd972dec287b7989eba647d384f6edd8d95fd\n+    process-warning: \"npm:^5.0.0\"\n+  checksum: 10c0/17597d653a4088f7faed4d58500a5ef51d4d05247307696760006313c33c1d23177af98fb902e15b8e2cd92d81306c884673f841ba5b9bf0c064802f3c0bd775\n   languageName: node\n   linkType: hard\n \n@@ -9748,13 +9748,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"process-warning@npm:^4.0.0\":\n-  version: 4.0.0\n-  resolution: \"process-warning@npm:4.0.0\"\n-  checksum: 10c0/5312a72b69d37a1b82ad03f3dfa0090dab3804a8fd995d06c28e3c002852bd82f5584217d9f4a3f197892bb2afc22d57e2c662c7e906b5abb48c0380c7b0880d\n-  languageName: node\n-  linkType: hard\n-\n \"process-warning@npm:^5.0.0\":\n   version: 5.0.0\n   resolution: \"process-warning@npm:5.0.0\"\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFollow-up to #34789\r\n\r\nThe removed check for `supported_context?(@json)` also covered `@json` being `nil`, which may happen with some HTTP responses, or the collection being hosted on another domain than the author.\n\n---\n\nChoice A:\napp/javascript/styles/mastodon/admin.scss\n@@ -114,15 +114,14 @@ $content-width: 840px;\n \n       a {\n         font-size: 14px;\n-        display: block;\n+        display: flex;\n+        align-items: center;\n+        gap: 6px;\n         padding: 15px;\n         color: $darker-text-color;\n         text-decoration: none;\n         transition: all 200ms linear;\n         transition-property: color, background-color;\n-        white-space: nowrap;\n-        overflow: hidden;\n-        text-overflow: ellipsis;\n \n         &:hover {\n           color: $primary-text-color;\n---\n\n\n---\n\nChoice B:\napp/javascript/styles/mastodon/components.scss\n@@ -11044,7 +11044,7 @@ noscript {\n   overflow: hidden;\n   flex-shrink: 0;\n   border-bottom: 1px solid var(--background-border-color);\n-  touch-action: pan-x;\n+  touch-action: pan-y;\n \n   &__slides {\n     display: flex;\n---\n\n\n---\n\nChoice C:\napp/services/activitypub/fetch_featured_collection_service.rb\n@@ -9,6 +9,7 @@ def call(account, **options)\n     @account = account\n     @options = options\n     @json    = fetch_collection(options[:collection].presence || @account.featured_collection_url)\n+    return if @json.blank?\n \n     process_items(collection_items(@json))\n   end\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -13279,14 +13279,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-cloudflare@npm:^1.1.1\":\n-  version: 1.1.1\n-  resolution: \"pg-cloudflare@npm:1.1.1\"\n-  checksum: 10c0/a68b957f755be6af813d68ccaf4c906a000fd2ecb362cd281220052cc9e2f6c26da3b88792742387008c30b3bf0d2fa3a0eff04aeb8af4414023c99ae78e07bd\n+\"pg-cloudflare@npm:^1.2.0\":\n+  version: 1.2.0\n+  resolution: \"pg-cloudflare@npm:1.2.0\"\n+  checksum: 10c0/d6f2d032aeab291b17d627b051aae85420aea86a3371895a77b55fec93e3dac05880fbf09e5de33486ad3a2e6d7d56a025a8aa66f0d5883984f9834e4cd6f6a4\n   languageName: node\n   linkType: hard\n \n-\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.7.0\":\n+\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n   version: 2.8.1\n   resolution: \"pg-connection-string@npm:2.8.1\"\n   checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n@@ -13307,19 +13307,19 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.8.0\":\n-  version: 3.8.0\n-  resolution: \"pg-pool@npm:3.8.0\"\n+\"pg-pool@npm:^3.9.1\":\n+  version: 3.9.1\n+  resolution: \"pg-pool@npm:3.9.1\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/c05287b0caafeab43807e6ad22d153c09c473dbeb5b2cea13b83102376e9a56f46b91fa9adf9d53885ce198280c6a95555390987c42b3858d1936d3e0cdc83aa\n+  checksum: 10c0/2bbc0892ab7325486b7d5ad8ade59ec925476666ac3959cb4850814c5334bb2f1344258707f8d0445093b59dd6e94401508cebcee490d4827821549147a2ebd9\n   languageName: node\n   linkType: hard\n \n-\"pg-protocol@npm:*, pg-protocol@npm:^1.8.0\":\n-  version: 1.8.0\n-  resolution: \"pg-protocol@npm:1.8.0\"\n-  checksum: 10c0/2be784955599d84b564795952cee52cc2b8eab0be43f74fc1061506353801e282c1d52c9e0691a9b72092c1f3fde370e9b181e80fef6bb82a9b8d1618bfa91e6\n+\"pg-protocol@npm:*, pg-protocol@npm:^1.9.0\":\n+  version: 1.9.0\n+  resolution: \"pg-protocol@npm:1.9.0\"\n+  checksum: 10c0/c37e61d7fafa97f22eabf12de69863f42fdabb3671df9cc2623bd0ffd6bdedc212e7e8460ad2c721c8a08d8477b4f128a923bf2381905d68a23a532ec7517c77\n   languageName: node\n   linkType: hard\n \n@@ -13352,13 +13352,13 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.14.1\n-  resolution: \"pg@npm:8.14.1\"\n+  version: 8.15.1\n+  resolution: \"pg@npm:8.15.1\"\n   dependencies:\n-    pg-cloudflare: \"npm:^1.1.1\"\n-    pg-connection-string: \"npm:^2.7.0\"\n-    pg-pool: \"npm:^3.8.0\"\n-    pg-protocol: \"npm:^1.8.0\"\n+    pg-cloudflare: \"npm:^1.2.0\"\n+    pg-connection-string: \"npm:^2.8.1\"\n+    pg-pool: \"npm:^3.9.1\"\n+    pg-protocol: \"npm:^1.9.0\"\n     pg-types: \"npm:^2.1.0\"\n     pgpass: \"npm:1.x\"\n   peerDependencies:\n@@ -13369,7 +13369,7 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/221741cfcea4ab32c8b57bd60703bc36cfb5622dcac56c19e45f504ef8669f2f2e0429af8850f58079cfc89055da35b5a5e12de19e0505e3f61a4b4349388dcb\n+  checksum: 10c0/c6e5fd9cd6af7fc3208e48f860fd9ec9f7bc20192e449b0b36b096a9d5889de50706c705f6996e51a765bd4b7331179d7ffb43528a141bb996ee6f2c8f994c9a\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34804\n\n---\n\nChoice A:\nconfig/environments/production.rb\n@@ -150,13 +150,6 @@\n     'Referrer-Policy' => 'same-origin',\n   }\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = if ENV['SECRET_KEY_BASE_DUMMY']\n-                          SecureRandom.hex(64)\n-                        else\n-                          ENV.fetch('OTP_SECRET')\n-                        end\n-\n   # Enable DNS rebinding protection and other `Host` header attacks.\n   # config.hosts = [\n   #   \"example.com\",     # Allow requests from example.com\n---\nconfig/environments/test.rb\n@@ -48,9 +48,6 @@\n   # Print deprecation notices to the stderr.\n   config.active_support.deprecation = :stderr\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = '100c7faeef00caa29242f6b04156742bf76065771fd4117990c4282b8748ff3d99f8fdae97c982ab5bd2e6756a159121377cce4421f4a8ecd2d67bd7749a3fb4'\n-\n   # Generate random VAPID keys\n   vapid_key = Webpush.generate_key\n   config.x.vapid_private_key = vapid_key.private_key\n---\ndb/post_migrate/20240307180905_migrate_devise_two_factor_secrets.rb\n@@ -79,8 +79,18 @@ def legacy_otp_secret\n   class MigrationUser < ApplicationRecord\n     self.table_name = :users\n \n+    LEGACY_OTP_SECRET = begin\n+      if Rails.env.test?\n+        '100c7faeef00caa29242f6b04156742bf76065771fd4117990c4282b8748ff3d99f8fdae97c982ab5bd2e6756a159121377cce4421f4a8ecd2d67bd7749a3fb4'\n+      elsif ENV['SECRET_KEY_BASE_DUMMY']\n+        SecureRandom.hex(64)\n+      else\n+        ENV.fetch('OTP_SECRET')\n+      end\n+    end\n+\n     devise :two_factor_authenticatable,\n-           otp_secret_encryption_key: Rails.configuration.x.otp_secret\n+           otp_secret_encryption_key: LEGACY_OTP_SECRET\n \n     include LegacyOtpSecret\n   end\n---\n\n\n---\n\nChoice B:\napp/models/concerns/attachmentable.rb\n@@ -75,9 +75,16 @@ def appropriate_extension(attachment)\n   end\n \n   def calculated_content_type(attachment)\n-    Paperclip.run('file', '-b --mime :file', file: attachment.queued_for_write[:original].path).split(/[:;\\s]+/).first.chomp\n-  rescue Terrapin::CommandLineError\n-    ''\n+    begin\n+      Timeout.timeout(10) do\n+        Paperclip.run('file', '-b --mime :file', file: attachment.queued_for_write[:original].path).split(/[:;\\s]+/).first.chomp\n+      end\n+    rescue Timeout::Error\n+      Rails.logger.error \"file command timed out for #{attachment.queued_for_write[:original].path}\"\n+      ''\n+    rescue Terrapin::CommandLineError\n+      ''\n+    end\n   end\n \n   def obfuscate_file_name(attachment)\n---\n\n\n---\n\nChoice C:\ndocs/DEVELOPMENT.md\n@@ -7,6 +7,19 @@ what changes are desirable and what general processes to use.\n \n ## Environments\n \n+The following instructions will guide you through the process of setting up a local development instance of Mastodon on your computer.\n+\n+There are instructions for these environments:\n+\n+- [Vagrant](#vagrant)\n+- [macOS](#macos)\n+- [Linux](#linux)\n+- [Docker](#docker)\n+- [Dev Containers](#dev-containers)\n+- [GitHub Codespaces](#github-codespaces)\n+\n+Once completed, continue with the [Next steps](#next-steps) section below.\n+\n ### Vagrant\n \n A **Vagrant** configuration is included for development purposes. To use it,\n@@ -28,11 +41,17 @@ To set up **macOS** for native development, complete the following steps:\n   to install the required project dependencies\n - Use a Ruby version manager to activate the ruby in `.ruby-version` and run\n   `nvm use` to activate the node version from `.nvmrc`\n-- Run the `bin/setup` script, which will install the required ruby gems and node\n+- Start the database services by running `brew services start postgresql` and\n+  `brew services start redis`\n+- Run `RAILS_ENV=development bin/setup`, which will install the required ruby gems and node\n   packages and prepare the database for local development\n - Finally, run the `bin/dev` script which will launch services via `overmind`\n   (if installed) or `foreman`\n \n+### Linux\n+\n+The Mastodon documentation has a [guide on installing Mastodon from source](https://docs.joinmastodon.org/dev/setup/#manual) on Linux.\n+\n ### Docker\n \n For production hosting and deployment with **Docker**, use the `Dockerfile` and\n@@ -66,10 +85,17 @@ development environment configured with the software needed for this project.\n - Wait for an _Open in Browser_ prompt. This will open Mastodon\n - On the _Ports_ tab \"stream\" setting change _Port visibility_ \u2192 _Public_\n \n+## Next steps\n+\n+- Once you have successfully set up a development environment, it will be available on http://localhost:3000\n+- Log in as the default admin user with the username `admin@mastodon.local` and the password `mastodonadmin`.\n+- Check out the [Mastodon docs] for tips on working with emails in development (you'll need this when creating new user accounts) as well as a list of useful commands for testing and updating your dev instance.\n+\n [codespace]: https://codespaces.new/mastodon/mastodon?quickstart=1&devcontainer_path=.devcontainer%2Fcodespaces%2Fdevcontainer.json\n [CONTRIBUTING]: ../CONTRIBUTING.md\n [Dev Container extension]: https://containers.dev/supporting#dev-containers\n [Development Containers]: https://containers.dev/supporting\n [Docker]: https://docs.docker.com\n [GitHub Codespaces]: https://docs.github.com/en/codespaces\n [Homebrew]: https://brew.sh\n+[Mastodon docs]: https://docs.joinmastodon.org/dev/setup/#working-with-emails-in-development\n---\n\n\n---\n\nChoice D:\nconfig/vite/plugin-mastodon-themes.ts\n@@ -0,0 +1,58 @@\n+/* This plugins handles Mastodon's theme system\n+ */\n+\n+import fs from 'node:fs/promises';\n+import path from 'node:path';\n+\n+import yaml from 'js-yaml';\n+import type { Plugin } from 'vite';\n+\n+export function MastodonThemes(): Plugin {\n+  return {\n+    name: 'mastodon-themes',\n+    async config(userConfig) {\n+      if (!userConfig.root || !userConfig.envDir) {\n+        throw new Error('Unknown project directory');\n+      }\n+\n+      const themesFile = path.resolve(userConfig.envDir, 'config/themes.yml');\n+      const entrypoints: Record<string, string> = {};\n+\n+      // Get all files mentioned in the themes.yml file.\n+      const themesString = await fs.readFile(themesFile, 'utf8');\n+      const themes = yaml.load(themesString, {\n+        filename: 'themes.yml',\n+        schema: yaml.FAILSAFE_SCHEMA,\n+      });\n+\n+      if (!themes || typeof themes !== 'object') {\n+        throw new Error('Invalid themes.yml file');\n+      }\n+\n+      for (const themePath of Object.values(themes)) {\n+        if (\n+          typeof themePath !== 'string' ||\n+          themePath.split('.').length !== 2 || // Ensure it has exactly one period\n+          !themePath.endsWith('css')\n+        ) {\n+          console.warn(\n+            `Invalid theme path \"${themePath}\" in themes.yml, skipping`,\n+          );\n+          continue;\n+        }\n+        entrypoints[path.basename(themePath)] = path.resolve(\n+          userConfig.root,\n+          themePath,\n+        );\n+      }\n+\n+      return {\n+        build: {\n+          rollupOptions: {\n+            input: entrypoints,\n+          },\n+        },\n+      };\n+    },\n+  };\n+}\n---\nvite.config.mts\n@@ -1,4 +1,3 @@\n-import fs from 'node:fs/promises';\n import path from 'node:path';\n \n import { optimizeLodashImports } from '@optimize-lodash/rollup-plugin';\n@@ -9,44 +8,18 @@ import { visualizer } from 'rollup-plugin-visualizer';\n import RailsPlugin from 'vite-plugin-rails';\n import { VitePWA } from 'vite-plugin-pwa';\n import tsconfigPaths from 'vite-tsconfig-paths';\n-import yaml from 'js-yaml';\n import legacy from '@vitejs/plugin-legacy';\n \n import { defineConfig, UserConfigFnPromise, UserConfig } from 'vite';\n import postcssPresetEnv from 'postcss-preset-env';\n \n import { MastodonServiceWorkerLocales } from './config/vite/plugin-sw-locales';\n import { MastodonEmojiCompressed } from './config/vite/plugin-emoji-compressed';\n+import { MastodonThemes } from './config/vite/plugin-mastodon-themes';\n \n const jsRoot = path.resolve(__dirname, 'app/javascript');\n-const themesFile = path.resolve(__dirname, 'config/themes.yml');\n \n export const config: UserConfigFnPromise = async ({ mode, command }) => {\n-  const entrypoints: Record<string, string> = {}; // All JS entrypoints are taken care of by Vite Ruby\n-\n-  // Get all files mentioned in the themes.yml file.\n-  const themesString = await fs.readFile(themesFile, 'utf8');\n-  const themes = yaml.load(themesString, {\n-    filename: 'themes.yml',\n-    schema: yaml.FAILSAFE_SCHEMA,\n-  });\n-\n-  if (!themes || typeof themes !== 'object') {\n-    throw new Error('Invalid themes.yml file');\n-  }\n-\n-  for (const themePath of Object.values(themes)) {\n-    if (\n-      typeof themePath !== 'string' ||\n-      themePath.split('.').length !== 2 || // Ensure it has exactly one period\n-      !themePath.endsWith('css')\n-    ) {\n-      console.warn(`Invalid theme path \"${themePath}\" in themes.yml, skipping`);\n-      continue;\n-    }\n-    entrypoints[path.basename(themePath)] = path.resolve(jsRoot, themePath);\n-  }\n-\n   return {\n     root: jsRoot,\n     css: {\n@@ -72,7 +45,6 @@ export const config: UserConfigFnPromise = async ({ mode, command }) => {\n       chunkSizeWarningLimit: 1 * 1024 * 1024, // 1MB\n       sourcemap: true,\n       rollupOptions: {\n-        input: entrypoints,\n         output: {\n           chunkFileNames({ facadeModuleId, name }) {\n             if (!facadeModuleId) {\n@@ -113,6 +85,7 @@ export const config: UserConfigFnPromise = async ({ mode, command }) => {\n           manifestPaths: ['.vite/manifest.json', '.vite/manifest-assets.json'],\n         },\n       }),\n+      MastodonThemes(),\n       react({\n         babel: {\n           plugins: ['formatjs', 'transform-react-remove-prop-types'],\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis was used in our webpack code, but now the equivalent globbing is done by our `vite-plugin-ruby` dependency, using the `fast-glob` package.\n\n---\n\nChoice A:\n.rubocop_todo.yml\n@@ -39,7 +39,6 @@ Style/FetchEnvVar:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/3_omniauth.rb'\n     - 'config/initializers/cache_buster.rb'\n-    - 'config/initializers/devise.rb'\n     - 'config/initializers/paperclip.rb'\n     - 'config/initializers/vapid.rb'\n     - 'lib/tasks/repo.rake'\n---\nconfig/initializers/devise.rb\n@@ -377,7 +377,7 @@ def session_cookie\n     config.usernamefield          = nil\n     config.emailfield             = 'email'\n     config.check_at_sign          = true\n-    config.pam_default_suffix     = ENV.fetch('PAM_EMAIL_DOMAIN') { ENV['LOCAL_DOMAIN'] }\n+    config.pam_default_suffix     = ENV.fetch('PAM_EMAIL_DOMAIN') { ENV.fetch('LOCAL_DOMAIN', nil) }\n     config.pam_default_service    = ENV.fetch('PAM_DEFAULT_SERVICE') { 'rpam' }\n     config.pam_controlled_service = ENV.fetch('PAM_CONTROLLED_SERVICE', nil).presence\n   end\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/account/components/account_note.jsx\n@@ -8,6 +8,8 @@ import ImmutablePureComponent from 'react-immutable-pure-component';\n \n import Textarea from 'react-textarea-autosize';\n \n+import { LoadingIndicator } from '@/mastodon/components/loading_indicator';\n+\n const messages = defineMessages({\n   placeholder: { id: 'account_note.placeholder', defaultMessage: 'Click to add a note' },\n });\n@@ -153,17 +155,23 @@ class AccountNote extends ImmutablePureComponent {\n           <FormattedMessage id='account.account_note_header' defaultMessage='Personal note' /> <InlineAlert show={saved} />\n         </label>\n \n-        <Textarea\n-          id={`account-note-${accountId}`}\n-          className='account__header__account-note__content'\n-          disabled={this.props.value === null || value === null}\n-          placeholder={intl.formatMessage(messages.placeholder)}\n-          value={value || ''}\n-          onChange={this.handleChange}\n-          onKeyDown={this.handleKeyDown}\n-          onBlur={this.handleBlur}\n-          ref={this.setTextareaRef}\n-        />\n+        {this.props.value === undefined ? (\n+          <div className='account__header__account-note__loading-indicator-wrapper'>\n+            <LoadingIndicator />\n+          </div>\n+        ) : (\n+          <Textarea\n+            id={`account-note-${accountId}`}\n+            className='account__header__account-note__content'\n+            disabled={value === null}\n+            placeholder={intl.formatMessage(messages.placeholder)}\n+            value={value || ''}\n+            onChange={this.handleChange}\n+            onKeyDown={this.handleKeyDown}\n+            onBlur={this.handleBlur}\n+            ref={this.setTextareaRef}\n+          />\n+        )}\n       </div>\n     );\n   }\n---\napp/javascript/styles/mastodon/components.scss\n@@ -8194,6 +8194,20 @@ noscript {\n     font-weight: 400;\n     margin-bottom: 10px;\n \n+    &__loading-indicator-wrapper {\n+      position: relative;\n+      height: 37px;\n+\n+      .loading-indicator {\n+        left: 10px;\n+      }\n+\n+      .circular-progress {\n+        width: 14px;\n+        height: 14px;\n+      }\n+    }\n+\n     label {\n       display: block;\n       font-size: 12px;\n---\n\n\n---\n\nChoice C:\npackage.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/mastodon\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.1\",\n+  \"packageManager\": \"yarn@4.9.2\",\n   \"engines\": {\n     \"node\": \">=20\"\n   },\n---\nstreaming/package.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/streaming\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.1\",\n+  \"packageManager\": \"yarn@4.9.2\",\n   \"engines\": {\n     \"node\": \">=20\"\n   },\n---\n\n\n---\n\nChoice D:\npackage.json\n@@ -64,7 +64,6 @@\n     \"emoji-mart\": \"npm:emoji-mart-lazyload@latest\",\n     \"escape-html\": \"^1.0.3\",\n     \"fuzzysort\": \"^3.0.0\",\n-    \"glob\": \"^10.2.6\",\n     \"history\": \"^4.10.1\",\n     \"hoist-non-react-statics\": \"^3.3.2\",\n     \"http-link-header\": \"^1.1.1\",\n---\nyarn.lock\n@@ -2514,7 +2514,6 @@ __metadata:\n     eslint-plugin-react: \"npm:^7.37.4\"\n     eslint-plugin-react-hooks: \"npm:^5.2.0\"\n     fuzzysort: \"npm:^3.0.0\"\n-    glob: \"npm:^10.2.6\"\n     globals: \"npm:^16.0.0\"\n     history: \"npm:^4.10.1\"\n     hoist-non-react-statics: \"npm:^3.3.2\"\n@@ -6919,7 +6918,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"glob@npm:^10.2.2, glob@npm:^10.2.6, glob@npm:^10.3.10\":\n+\"glob@npm:^10.2.2, glob@npm:^10.3.10\":\n   version: 10.4.5\n   resolution: \"glob@npm:10.4.5\"\n   dependencies:\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nNot necessarily required for upstream, but will make glitch-soc easier to maintain.\n\n---\n\nChoice A:\nGemfile.lock\n@@ -94,7 +94,7 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n+    aws-partitions (1.1103.0)\n     aws-sdk-core (3.215.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n@@ -109,7 +109,7 @@ GEM\n       aws-sigv4 (~> 1.5)\n     aws-sigv4 (1.11.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n-    azure-blob (0.5.7)\n+    azure-blob (0.5.8)\n       rexml\n     base64 (0.2.0)\n     bcp47_spec (0.2.1)\n@@ -124,7 +124,7 @@ GEM\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n-    bootsnap (1.18.5)\n+    bootsnap (1.18.6)\n       msgpack (~> 1.2)\n     brakeman (7.0.2)\n       racc\n@@ -194,7 +194,7 @@ GEM\n     devise_pam_authenticatable2 (9.2.0)\n       devise (>= 4.0.0)\n       rpam2 (~> 4.0)\n-    diff-lcs (1.6.1)\n+    diff-lcs (1.6.2)\n     discard (1.4.0)\n       activerecord (>= 4.2, < 9.0)\n     docile (1.4.1)\n@@ -228,7 +228,7 @@ GEM\n     fabrication (2.31.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n-    faraday (2.13.0)\n+    faraday (2.13.1)\n       faraday-net_http (>= 2.0, < 3.5)\n       json\n       logger\n@@ -267,10 +267,10 @@ GEM\n       raabro (~> 1.4)\n     globalid (1.2.1)\n       activesupport (>= 6.1)\n-    google-protobuf (4.30.2)\n+    google-protobuf (4.31.0)\n       bigdecimal\n       rake (>= 13)\n-    googleapis-common-protos-types (1.19.0)\n+    googleapis-common-protos-types (1.20.0)\n       google-protobuf (>= 3.18, < 5.a)\n     haml (6.3.0)\n       temple (>= 0.8.2)\n@@ -338,7 +338,7 @@ GEM\n       azure-blob (~> 0.5.2)\n       hashie (~> 5.0)\n     jmespath (1.6.2)\n-    json (2.10.2)\n+    json (2.12.0)\n     json-canonicalization (1.0.0)\n     json-jwt (1.16.7)\n       activesupport (>= 4.2)\n@@ -411,7 +411,7 @@ GEM\n       activesupport (>= 4)\n       railties (>= 4)\n       request_store (~> 1.0)\n-    loofah (2.24.0)\n+    loofah (2.24.1)\n       crass (~> 1.0.2)\n       nokogiri (>= 1.12.0)\n     mail (2.8.1)\n@@ -427,9 +427,9 @@ GEM\n     mime-types (3.7.0)\n       logger\n       mime-types-data (~> 3.2025, >= 3.2025.0507)\n-    mime-types-data (3.2025.0507)\n+    mime-types-data (3.2025.0514)\n     mini_mime (1.1.5)\n-    mini_portile2 (2.8.8)\n+    mini_portile2 (2.8.9)\n     minitest (5.25.5)\n     msgpack (1.8.0)\n     multi_json (1.15.0)\n@@ -504,7 +504,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-active_support (~> 0.7)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-action_pack (0.12.0)\n+    opentelemetry-instrumentation-action_pack (0.12.1)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n       opentelemetry-instrumentation-rack (~> 0.21)\n@@ -618,7 +618,7 @@ GEM\n       activesupport (>= 7.0.0)\n       rack\n       railties (>= 7.0.0)\n-    psych (5.2.3)\n+    psych (5.2.6)\n       date\n       stringio\n     public_suffix (6.0.2)\n@@ -710,7 +710,7 @@ GEM\n       railties (>= 5.2)\n     rexml (3.4.1)\n     rotp (6.3.0)\n-    rouge (4.5.1)\n+    rouge (4.5.2)\n     rpam2 (4.0.2)\n     rqrcode (3.1.0)\n       chunky_png (~> 1.0)\n@@ -727,7 +727,7 @@ GEM\n       rspec-support (~> 3.13.0)\n     rspec-github (3.0.0)\n       rspec-core (~> 3.0)\n-    rspec-mocks (3.13.3)\n+    rspec-mocks (3.13.4)\n       diff-lcs (>= 1.2.0, < 2.0)\n       rspec-support (~> 3.13.0)\n     rspec-rails (8.0.0)\n@@ -1092,4 +1092,4 @@ RUBY VERSION\n    ruby 3.4.1p0\n \n BUNDLED WITH\n-   2.6.8\n+   2.6.9\n---\n\n\n---\n\nChoice B:\nconfig/vite/plugin-mastodon-themes.ts\n@@ -0,0 +1,58 @@\n+/* This plugins handles Mastodon's theme system\n+ */\n+\n+import fs from 'node:fs/promises';\n+import path from 'node:path';\n+\n+import yaml from 'js-yaml';\n+import type { Plugin } from 'vite';\n+\n+export function MastodonThemes(): Plugin {\n+  return {\n+    name: 'mastodon-themes',\n+    async config(userConfig) {\n+      if (!userConfig.root || !userConfig.envDir) {\n+        throw new Error('Unknown project directory');\n+      }\n+\n+      const themesFile = path.resolve(userConfig.envDir, 'config/themes.yml');\n+      const entrypoints: Record<string, string> = {};\n+\n+      // Get all files mentioned in the themes.yml file.\n+      const themesString = await fs.readFile(themesFile, 'utf8');\n+      const themes = yaml.load(themesString, {\n+        filename: 'themes.yml',\n+        schema: yaml.FAILSAFE_SCHEMA,\n+      });\n+\n+      if (!themes || typeof themes !== 'object') {\n+        throw new Error('Invalid themes.yml file');\n+      }\n+\n+      for (const themePath of Object.values(themes)) {\n+        if (\n+          typeof themePath !== 'string' ||\n+          themePath.split('.').length !== 2 || // Ensure it has exactly one period\n+          !themePath.endsWith('css')\n+        ) {\n+          console.warn(\n+            `Invalid theme path \"${themePath}\" in themes.yml, skipping`,\n+          );\n+          continue;\n+        }\n+        entrypoints[path.basename(themePath)] = path.resolve(\n+          userConfig.root,\n+          themePath,\n+        );\n+      }\n+\n+      return {\n+        build: {\n+          rollupOptions: {\n+            input: entrypoints,\n+          },\n+        },\n+      };\n+    },\n+  };\n+}\n---\nvite.config.mts\n@@ -1,4 +1,3 @@\n-import fs from 'node:fs/promises';\n import path from 'node:path';\n \n import { optimizeLodashImports } from '@optimize-lodash/rollup-plugin';\n@@ -9,44 +8,18 @@ import { visualizer } from 'rollup-plugin-visualizer';\n import RailsPlugin from 'vite-plugin-rails';\n import { VitePWA } from 'vite-plugin-pwa';\n import tsconfigPaths from 'vite-tsconfig-paths';\n-import yaml from 'js-yaml';\n import legacy from '@vitejs/plugin-legacy';\n \n import { defineConfig, UserConfigFnPromise, UserConfig } from 'vite';\n import postcssPresetEnv from 'postcss-preset-env';\n \n import { MastodonServiceWorkerLocales } from './config/vite/plugin-sw-locales';\n import { MastodonEmojiCompressed } from './config/vite/plugin-emoji-compressed';\n+import { MastodonThemes } from './config/vite/plugin-mastodon-themes';\n \n const jsRoot = path.resolve(__dirname, 'app/javascript');\n-const themesFile = path.resolve(__dirname, 'config/themes.yml');\n \n export const config: UserConfigFnPromise = async ({ mode, command }) => {\n-  const entrypoints: Record<string, string> = {}; // All JS entrypoints are taken care of by Vite Ruby\n-\n-  // Get all files mentioned in the themes.yml file.\n-  const themesString = await fs.readFile(themesFile, 'utf8');\n-  const themes = yaml.load(themesString, {\n-    filename: 'themes.yml',\n-    schema: yaml.FAILSAFE_SCHEMA,\n-  });\n-\n-  if (!themes || typeof themes !== 'object') {\n-    throw new Error('Invalid themes.yml file');\n-  }\n-\n-  for (const themePath of Object.values(themes)) {\n-    if (\n-      typeof themePath !== 'string' ||\n-      themePath.split('.').length !== 2 || // Ensure it has exactly one period\n-      !themePath.endsWith('css')\n-    ) {\n-      console.warn(`Invalid theme path \"${themePath}\" in themes.yml, skipping`);\n-      continue;\n-    }\n-    entrypoints[path.basename(themePath)] = path.resolve(jsRoot, themePath);\n-  }\n-\n   return {\n     root: jsRoot,\n     css: {\n@@ -72,7 +45,6 @@ export const config: UserConfigFnPromise = async ({ mode, command }) => {\n       chunkSizeWarningLimit: 1 * 1024 * 1024, // 1MB\n       sourcemap: true,\n       rollupOptions: {\n-        input: entrypoints,\n         output: {\n           chunkFileNames({ facadeModuleId, name }) {\n             if (!facadeModuleId) {\n@@ -113,6 +85,7 @@ export const config: UserConfigFnPromise = async ({ mode, command }) => {\n           manifestPaths: ['.vite/manifest.json', '.vite/manifest-assets.json'],\n         },\n       }),\n+      MastodonThemes(),\n       react({\n         babel: {\n           plugins: ['formatjs', 'transform-react-remove-prop-types'],\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -339,7 +339,7 @@ GEM\n       azure-blob (~> 0.5.2)\n       hashie (~> 5.0)\n     jmespath (1.6.2)\n-    json (2.12.0)\n+    json (2.12.2)\n     json-canonicalization (1.0.0)\n     json-jwt (1.16.7)\n       activesupport (>= 4.2)\n@@ -750,7 +750,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.7)\n+    rubocop (1.75.8)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\nChoice D:\npackage.json\n@@ -64,7 +64,6 @@\n     \"emoji-mart\": \"npm:emoji-mart-lazyload@latest\",\n     \"escape-html\": \"^1.0.3\",\n     \"fuzzysort\": \"^3.0.0\",\n-    \"glob\": \"^10.2.6\",\n     \"history\": \"^4.10.1\",\n     \"hoist-non-react-statics\": \"^3.3.2\",\n     \"http-link-header\": \"^1.1.1\",\n---\nyarn.lock\n@@ -2514,7 +2514,6 @@ __metadata:\n     eslint-plugin-react: \"npm:^7.37.4\"\n     eslint-plugin-react-hooks: \"npm:^5.2.0\"\n     fuzzysort: \"npm:^3.0.0\"\n-    glob: \"npm:^10.2.6\"\n     globals: \"npm:^16.0.0\"\n     history: \"npm:^4.10.1\"\n     hoist-non-react-statics: \"npm:^3.3.2\"\n@@ -6919,7 +6918,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"glob@npm:^10.2.2, glob@npm:^10.2.6, glob@npm:^10.3.10\":\n+\"glob@npm:^10.2.2, glob@npm:^10.3.10\":\n   version: 10.4.5\n   resolution: \"glob@npm:10.4.5\"\n   dependencies:\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nSimply sets the account header profile picture size to 92x instead of 94px/90px to ensure it's 2x the size of the profile picture shown next to posts. This will help address scaling inperfections for peeps with pixel art profile pictures.\r\n\r\nResolves https://github.com/mastodon/mastodon/issues/34802\r\n\r\nWhile I did not specifically :tophat: this change I did take a look at the current state of profile picture sizes and the discrepencies mentioned in the original issue above do line up as noted.\r\n\r\nAccount header (various sizes other than 92px)\r\n![Screenshot From 2025-05-26 15-19-35](https://github.com/user-attachments/assets/d95a7349-84a6-4dca-ae5c-21ee55c1b617)\r\n![Screenshot From 2025-05-26 15-19-47](https://github.com/user-attachments/assets/1a17f70c-463d-45a6-bd2e-598955c24524)\r\n![Screenshot From 2025-05-26 15-19-56](https://github.com/user-attachments/assets/a7cde44c-9c9d-40e6-88a9-7836002aecb9)\r\n\r\nPost (specifically 46px)\r\n![Screenshot From 2025-05-26 15-31-36](https://github.com/user-attachments/assets/654edb2d-534c-40f5-8614-e176419b7166)\r\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -66,7 +66,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n+\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n   version: 7.26.10\n   resolution: \"@babel/core@npm:7.26.10\"\n   dependencies:\n@@ -211,10 +211,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.24.0, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5\":\n-  version: 7.26.5\n-  resolution: \"@babel/helper-plugin-utils@npm:7.26.5\"\n-  checksum: 10c0/cdaba71d4b891aa6a8dfbe5bac2f94effb13e5fa4c2c487667fdbaa04eae059b78b28d85a885071f45f7205aeb56d16759e1bed9c118b94b16e4720ef1ab0f65\n+\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5, @babel/helper-plugin-utils@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helper-plugin-utils@npm:7.27.1\"\n+  checksum: 10c0/94cf22c81a0c11a09b197b41ab488d416ff62254ce13c57e62912c85700dc2e99e555225787a4099ff6bae7a1812d622c80fbaeda824b79baa10a6c5ac4cf69b\n   languageName: node\n   linkType: hard\n \n@@ -869,25 +869,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-self@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-self@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea362ff94b535c753f560eb1f5e063dc72bbbca17ed58837a949a7b289d5eacc7b0a28296d1932c94429b168d6040cdee5484a59b9e3c021f169e0ee137e6a27\n+  checksum: 10c0/00a4f917b70a608f9aca2fb39aabe04a60aa33165a7e0105fd44b3a8531630eb85bf5572e9f242f51e6ad2fa38c2e7e780902176c863556c58b5ba6f6e164031\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-source@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-source@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea8e3263c0dc51fbc97c156cc647150a757cc56de10781287353d0ce9b2dcd6b6d93d573c0142d7daf5d6fb554c74fa1971ae60764924ea711161d8458739b63\n+  checksum: 10c0/5e67b56c39c4d03e59e03ba80692b24c5a921472079b63af711b1d250fc37c1733a17069b63537f750f3e937ec44a42b1ee6a46cd23b1a0df5163b17f741f7f2\n   languageName: node\n   linkType: hard\n \n@@ -4135,17 +4135,17 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.2.1\n-  resolution: \"@vitejs/plugin-react@npm:4.2.1\"\n+  version: 4.4.1\n+  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n   dependencies:\n-    \"@babel/core\": \"npm:^7.23.5\"\n-    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.23.3\"\n-    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.23.3\"\n+    \"@babel/core\": \"npm:^7.26.10\"\n+    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n+    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n-    react-refresh: \"npm:^0.14.0\"\n+    react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n-    vite: ^4.2.0 || ^5.0.0\n-  checksum: 10c0/de1eec44d703f32e5b58e776328ca20793657fe991835d15b290230b19a2a08be5d31501d424279ae13ecfed28044c117b69d746891c8d9b92c69e8a8907e989\n+    vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n+  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n   languageName: node\n   linkType: hard\n \n@@ -10069,10 +10069,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-refresh@npm:^0.14.0\":\n-  version: 0.14.0\n-  resolution: \"react-refresh@npm:0.14.0\"\n-  checksum: 10c0/b8ae07ad153357d77830928a7f1fc2df837aabefee907fa273ba04c7643f3b860e986f1d4b7ada9b721c8d79b8c24b5b911a314a1a2398b105f1b13d19ea2b8d\n+\"react-refresh@npm:^0.17.0\":\n+  version: 0.17.0\n+  resolution: \"react-refresh@npm:0.17.0\"\n+  checksum: 10c0/002cba940384c9930008c0bce26cac97a9d5682bc623112c2268ba0c155127d9c178a9a5cc2212d560088d60dfd503edd808669a25f9b377f316a32361d0b23c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\napp/helpers/context_helper.rb\n@@ -25,6 +25,7 @@ module ContextHelper\n     voters_count: { 'toot' => 'http://joinmastodon.org/ns#', 'votersCount' => 'toot:votersCount' },\n     suspended: { 'toot' => 'http://joinmastodon.org/ns#', 'suspended' => 'toot:suspended' },\n     attribution_domains: { 'toot' => 'http://joinmastodon.org/ns#', 'attributionDomains' => { '@id' => 'toot:attributionDomains', '@type' => '@id' } },\n+    quote_requests: { 'QuoteRequest' => 'https://w3id.org/fep/044f#QuoteRequest' },\n   }.freeze\n \n   def full_context\n---\napp/lib/activitypub/activity.rb\n@@ -57,6 +57,8 @@ def klass\n         ActivityPub::Activity::Remove\n       when 'Move'\n         ActivityPub::Activity::Move\n+      when 'QuoteRequest'\n+        ActivityPub::Activity::QuoteRequest\n       end\n     end\n   end\n---\napp/lib/activitypub/activity/quote_request.rb\n@@ -0,0 +1,30 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::Activity::QuoteRequest < ActivityPub::Activity\n+  include Payloadable\n+\n+  def perform\n+    return unless Mastodon::Feature.inbound_quotes_enabled?\n+    return if non_matching_uri_hosts?(@account.uri, @json['id'])\n+\n+    quoted_status = status_from_uri(object_uri)\n+    return if quoted_status.nil? || !quoted_status.account.local? || !quoted_status.distributable?\n+\n+    # For now, we don't support being quoted by external servers\n+    reject_quote_request!(quoted_status)\n+  end\n+\n+  private\n+\n+  def reject_quote_request!(quoted_status)\n+    quote = Quote.new(\n+      quoted_status: quoted_status,\n+      quoted_account: quoted_status.account,\n+      status: Status.new(account: @account, uri: @json['instrument']),\n+      account: @account,\n+      activity_uri: @json['id']\n+    )\n+    json = Oj.dump(serialize_payload(quote, ActivityPub::RejectQuoteRequestSerializer))\n+    ActivityPub::DeliveryWorker.perform_async(json, quoted_status.account_id, @account.inbox_url)\n+  end\n+end\n---\napp/serializers/activitypub/quote_request_serializer.rb\n@@ -0,0 +1,28 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::QuoteRequestSerializer < ActivityPub::Serializer\n+  context_extensions :quote_requests\n+\n+  attributes :id, :type, :actor, :instrument\n+  attribute :virtual_object, key: :object\n+\n+  def id\n+    object.activity_uri || [ActivityPub::TagManager.instance.uri_for(object.target_account), '#quote_requests/', object.id].join\n+  end\n+\n+  def type\n+    'QuoteRequest'\n+  end\n+\n+  def actor\n+    ActivityPub::TagManager.instance.uri_for(object.account)\n+  end\n+\n+  def virtual_object\n+    ActivityPub::TagManager.instance.uri_for(object.quoted_status)\n+  end\n+\n+  def instrument\n+    ActivityPub::TagManager.instance.uri_for(object.status)\n+  end\n+end\n---\napp/serializers/activitypub/reject_quote_request_serializer.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::RejectQuoteRequestSerializer < ActivityPub::Serializer\n+  attributes :id, :type, :actor\n+\n+  has_one :object, serializer: ActivityPub::QuoteRequestSerializer\n+\n+  def id\n+    [ActivityPub::TagManager.instance.uri_for(object.quoted_account), '#rejects/quote_requests/', object.id].join\n+  end\n+\n+  def type\n+    'Reject'\n+  end\n+\n+  def actor\n+    ActivityPub::TagManager.instance.uri_for(object.quoted_account)\n+  end\n+end\n---\nspec/lib/activitypub/activity/quote_request_spec.rb\n@@ -0,0 +1,51 @@\n+# frozen_string_literal: true\n+\n+require 'rails_helper'\n+\n+RSpec.describe ActivityPub::Activity::QuoteRequest, feature: :inbound_quotes do\n+  let(:sender)    { Fabricate(:account, domain: 'example.com') }\n+  let(:recipient) { Fabricate(:account) }\n+  let(:quoted_post) { Fabricate(:status, account: recipient) }\n+  let(:request_uri) { 'https://example.com/missing-ui' }\n+  let(:quoted_uri) { ActivityPub::TagManager.instance.uri_for(quoted_post) }\n+\n+  let(:json) do\n+    {\n+      '@context': [\n+        'https://www.w3.org/ns/activitystreams',\n+        {\n+          QuoteRequest: 'https://w3id.org/fep/044f#QuoteRequest',\n+        },\n+      ],\n+      id: request_uri,\n+      type: 'QuoteRequest',\n+      actor: ActivityPub::TagManager.instance.uri_for(sender),\n+      object: quoted_uri,\n+      instrument: 'https://example.com/unknown-status',\n+    }.with_indifferent_access\n+  end\n+\n+  describe '#perform' do\n+    subject { described_class.new(json, sender) }\n+\n+    context 'when trying to quote an unknown status' do\n+      let(:quoted_uri) { 'https://example.com/statuses/1234' }\n+\n+      it 'does not send anything' do\n+        expect { subject.perform }\n+          .to_not enqueue_sidekiq_job(ActivityPub::DeliveryWorker)\n+      end\n+    end\n+\n+    context 'when trying to quote an unquotable local status' do\n+      it 'sends a Reject activity' do\n+        expect { subject.perform }\n+          .to enqueue_sidekiq_job(ActivityPub::DeliveryWorker)\n+          .with(satisfying do |body|\n+            outgoing_json = Oj.load(body)\n+            outgoing_json['type'] == 'Reject' && %w(type id actor object instrument).all? { |key| json[key] == outgoing_json['object'][key] }\n+          end, recipient.id, sender.inbox_url)\n+      end\n+    end\n+  end\n+end\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -160,7 +160,7 @@ GEM\n     cocoon (1.2.15)\n     color_diff (0.1)\n     concurrent-ruby (1.3.5)\n-    connection_pool (2.5.1)\n+    connection_pool (2.5.2)\n     cose (1.3.1)\n       cbor (~> 0.5.9)\n       openssl-signature_algorithm (~> 1.0)\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -873,7 +873,7 @@ export const AccountHeader: React.FC<{\n             >\n               <Avatar\n                 account={suspended || hidden ? undefined : account}\n-                size={90}\n+                size={92}\n               />\n             </a>\n \n---\napp/javascript/styles/mastodon/components.scss\n@@ -7963,7 +7963,6 @@ noscript {\n     .avatar {\n       display: block;\n       flex: 0 0 auto;\n-      width: 94px;\n \n       .account__avatar {\n         background: var(--background-color);\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis is something I had to do in glitch-soc, and while it's absolutely not necessary for upstream Mastodon, it looks a little nicer.\n\n---\n\nChoice A:\napp/helpers/json_ld_helper.rb\n@@ -72,6 +72,18 @@ def non_matching_uri_hosts?(base_url, comparison_url)\n     !haystack.casecmp(needle).zero?\n   end\n \n+  def safe_prefetched_embed(account, object, context)\n+    return unless object.is_a?(Hash)\n+\n+    # NOTE: Replacing the object's context by that of the parent activity is\n+    # not sound, but it's consistent with the rest of the codebase\n+    object = object.merge({ '@context' => context })\n+\n+    return if value_or_id(first_of_value(object['attributedTo'])) != account.uri || non_matching_uri_hosts?(account.uri, object['id'])\n+\n+    object\n+  end\n+\n   def canonicalize(json)\n     graph = RDF::Graph.new << JSON::LD::API.toRdf(json, documentLoader: method(:load_jsonld_context))\n     graph.dump(:normalize)\n---\napp/lib/activitypub/activity/create.rb\n@@ -204,7 +204,9 @@ def attach_quote(status)\n \n     @quote.status = status\n     @quote.save\n-    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, request_id: @options[:request_id])\n+\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, prefetched_quoted_object: embedded_quote, request_id: @options[:request_id])\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n     ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, @quote.id, @quote_uri, { 'request_id' => @options[:request_id] })\n   end\n---\napp/lib/activitypub/parser/status_parser.rb\n@@ -120,6 +120,11 @@ def quote_uri\n     end.first\n   end\n \n+  # The inlined quote; out of the attributes we support, only `https://w3id.org/fep/044f#quote` explicitly supports inlined objects\n+  def quoted_object\n+    as_array(@object['quote']).first\n+  end\n+\n   def quote_approval_uri\n     as_array(@object['quoteAuthorization']).first\n   end\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -273,7 +273,6 @@ def update_emojis!\n   def update_quote!\n     return unless Mastodon::Feature.inbound_quotes_enabled?\n \n-    quote = nil\n     quote_uri = @status_parser.quote_uri\n \n     if quote_uri.present?\n@@ -294,21 +293,23 @@ def update_quote!\n         quote = Quote.create(status: @status, approval_uri: approval_uri)\n         @quote_changed = true\n       end\n-    end\n \n-    if quote.present?\n-      begin\n-        quote.save\n-        ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, request_id: @request_id)\n-      rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n-        ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n-      end\n+      quote.save\n+\n+      fetch_and_verify_quote!(quote, quote_uri)\n     elsif @status.quote.present?\n       @status.quote.destroy!\n       @quote_changed = true\n     end\n   end\n \n+  def fetch_and_verify_quote!(quote, quote_uri)\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @activity_json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, prefetched_quoted_object: embedded_quote, request_id: @request_id)\n+  rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n+    ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n+  end\n+\n   def update_counts!\n     likes = @status_parser.favourites_count\n     shares =  @status_parser.reblogs_count\n---\napp/services/activitypub/verify_quote_service.rb\n@@ -4,15 +4,15 @@ class ActivityPub::VerifyQuoteService < BaseService\n   include JsonLdHelper\n \n   # Optionally fetch quoted post, and verify the quote is authorized\n-  def call(quote, fetchable_quoted_uri: nil, prefetched_body: nil, request_id: nil)\n+  def call(quote, fetchable_quoted_uri: nil, prefetched_quoted_object: nil, prefetched_approval: nil, request_id: nil)\n     @request_id = request_id\n     @quote = quote\n     @fetching_error = nil\n \n-    fetch_quoted_post_if_needed!(fetchable_quoted_uri)\n+    fetch_quoted_post_if_needed!(fetchable_quoted_uri, prefetched_body: prefetched_quoted_object)\n     return if fast_track_approval! || quote.approval_uri.blank?\n \n-    @json = fetch_approval_object(quote.approval_uri, prefetched_body:)\n+    @json = fetch_approval_object(quote.approval_uri, prefetched_body: prefetched_approval)\n     return quote.reject! if @json.nil?\n \n     return if non_matching_uri_hosts?(quote.approval_uri, value_or_id(@json['attributedTo']))\n@@ -68,11 +68,11 @@ def matching_quote_uri?\n     ActivityPub::TagManager.instance.uri_for(@quote.status) == value_or_id(@json['interactingObject'])\n   end\n \n-  def fetch_quoted_post_if_needed!(uri)\n+  def fetch_quoted_post_if_needed!(uri, prefetched_body: nil)\n     return if uri.nil? || @quote.quoted_status.present?\n \n     status = ActivityPub::TagManager.instance.uri_to_resource(uri, Status)\n-    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, request_id: @request_id)\n+    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, prefetched_body:, request_id: @request_id)\n \n     @quote.update(quoted_status: status) if status.present?\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS => e\n---\nspec/services/activitypub/verify_quote_service_spec.rb\n@@ -89,6 +89,37 @@\n       end\n     end\n \n+    context 'with a valid activity for a post that cannot be fetched but is passed as fetched_quoted_object' do\n+      let(:quoted_status) { nil }\n+\n+      let(:approval_interaction_target) { 'https://b.example.com/unknown-quoted' }\n+      let(:prefetched_object) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          type: 'Note',\n+          id: 'https://b.example.com/unknown-quoted',\n+          to: 'https://www.w3.org/ns/activitystreams#Public',\n+          attributedTo: ActivityPub::TagManager.instance.uri_for(quoted_account),\n+          content: 'previously unknown post',\n+        }.with_indifferent_access\n+      end\n+\n+      before do\n+        stub_request(:get, 'https://b.example.com/unknown-quoted')\n+          .to_return(status: 404)\n+      end\n+\n+      it 'updates the status' do\n+        expect { subject.call(quote, fetchable_quoted_uri: 'https://b.example.com/unknown-quoted', prefetched_quoted_object: prefetched_object) }\n+          .to change(quote, :state).to('accepted')\n+\n+        expect(a_request(:get, approval_uri))\n+          .to have_been_made.once\n+\n+        expect(quote.reload.quoted_status.content).to eq 'previously unknown post'\n+      end\n+    end\n+\n     context 'with a valid activity for a post that cannot be fetched but is inlined' do\n       let(:quoted_status) { nil }\n \n@@ -148,7 +179,7 @@\n \n     context 'with a valid activity for already-fetched posts, with a pre-fetched approval' do\n       it 'updates the status without fetching the activity' do\n-        expect { subject.call(quote, prefetched_body: Oj.dump(json)) }\n+        expect { subject.call(quote, prefetched_approval: Oj.dump(json)) }\n           .to change(quote, :state).to('accepted')\n \n         expect(a_request(:get, approval_uri))\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/account/components/account_note.jsx\n@@ -8,6 +8,8 @@ import ImmutablePureComponent from 'react-immutable-pure-component';\n \n import Textarea from 'react-textarea-autosize';\n \n+import { LoadingIndicator } from '@/mastodon/components/loading_indicator';\n+\n const messages = defineMessages({\n   placeholder: { id: 'account_note.placeholder', defaultMessage: 'Click to add a note' },\n });\n@@ -153,17 +155,23 @@ class AccountNote extends ImmutablePureComponent {\n           <FormattedMessage id='account.account_note_header' defaultMessage='Personal note' /> <InlineAlert show={saved} />\n         </label>\n \n-        <Textarea\n-          id={`account-note-${accountId}`}\n-          className='account__header__account-note__content'\n-          disabled={this.props.value === null || value === null}\n-          placeholder={intl.formatMessage(messages.placeholder)}\n-          value={value || ''}\n-          onChange={this.handleChange}\n-          onKeyDown={this.handleKeyDown}\n-          onBlur={this.handleBlur}\n-          ref={this.setTextareaRef}\n-        />\n+        {this.props.value === undefined ? (\n+          <div className='account__header__account-note__loading-indicator-wrapper'>\n+            <LoadingIndicator />\n+          </div>\n+        ) : (\n+          <Textarea\n+            id={`account-note-${accountId}`}\n+            className='account__header__account-note__content'\n+            disabled={value === null}\n+            placeholder={intl.formatMessage(messages.placeholder)}\n+            value={value || ''}\n+            onChange={this.handleChange}\n+            onKeyDown={this.handleKeyDown}\n+            onBlur={this.handleBlur}\n+            ref={this.setTextareaRef}\n+          />\n+        )}\n       </div>\n     );\n   }\n---\napp/javascript/styles/mastodon/components.scss\n@@ -8194,6 +8194,20 @@ noscript {\n     font-weight: 400;\n     margin-bottom: 10px;\n \n+    &__loading-indicator-wrapper {\n+      position: relative;\n+      height: 37px;\n+\n+      .loading-indicator {\n+        left: 10px;\n+      }\n+\n+      .circular-progress {\n+        width: 14px;\n+        height: 14px;\n+      }\n+    }\n+\n     label {\n       display: block;\n       font-size: 12px;\n---\n\n\n---\n\nChoice C:\napp/javascript/styles/fonts/roboto-mono.scss\n@@ -2,11 +2,10 @@\n   font-family: mastodon-font-monospace;\n   src:\n     local('Roboto Mono'),\n-    url('../fonts/roboto-mono/robotomono-regular-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto-mono/robotomono-regular-webfont.woff') format('woff'),\n-    url('../fonts/roboto-mono/robotomono-regular-webfont.ttf')\n-      format('truetype'),\n-    url('../fonts/roboto-mono/robotomono-regular-webfont.svg#roboto_monoregular')\n+    url('@/fonts/roboto-mono/robotomono-regular-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto-mono/robotomono-regular-webfont.woff') format('woff'),\n+    url('@/fonts/roboto-mono/robotomono-regular-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto-mono/robotomono-regular-webfont.svg#roboto_monoregular')\n       format('svg');\n   font-weight: 400;\n   font-display: swap;\n---\napp/javascript/styles/fonts/roboto.scss\n@@ -2,10 +2,10 @@\n   font-family: mastodon-font-sans-serif;\n   src:\n     local('Roboto Italic'),\n-    url('../fonts/roboto/roboto-italic-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto/roboto-italic-webfont.woff') format('woff'),\n-    url('../fonts/roboto/roboto-italic-webfont.ttf') format('truetype'),\n-    url('../fonts/roboto/roboto-italic-webfont.svg#roboto-italic-webfont')\n+    url('@/fonts/roboto/roboto-italic-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto/roboto-italic-webfont.woff') format('woff'),\n+    url('@/fonts/roboto/roboto-italic-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto/roboto-italic-webfont.svg#roboto-italic-webfont')\n       format('svg');\n   font-weight: normal;\n   font-display: swap;\n@@ -16,10 +16,10 @@\n   font-family: mastodon-font-sans-serif;\n   src:\n     local('Roboto Bold'),\n-    url('../fonts/roboto/roboto-bold-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto/roboto-bold-webfont.woff') format('woff'),\n-    url('../fonts/roboto/roboto-bold-webfont.ttf') format('truetype'),\n-    url('../fonts/roboto/roboto-bold-webfont.svg#roboto-bold-webfont')\n+    url('@/fonts/roboto/roboto-bold-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto/roboto-bold-webfont.woff') format('woff'),\n+    url('@/fonts/roboto/roboto-bold-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto/roboto-bold-webfont.svg#roboto-bold-webfont')\n       format('svg');\n   font-weight: bold;\n   font-display: swap;\n@@ -30,10 +30,10 @@\n   font-family: mastodon-font-sans-serif;\n   src:\n     local('Roboto Medium'),\n-    url('../fonts/roboto/roboto-medium-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto/roboto-medium-webfont.woff') format('woff'),\n-    url('../fonts/roboto/roboto-medium-webfont.ttf') format('truetype'),\n-    url('../fonts/roboto/roboto-medium-webfont.svg#roboto-medium-webfont')\n+    url('@/fonts/roboto/roboto-medium-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto/roboto-medium-webfont.woff') format('woff'),\n+    url('@/fonts/roboto/roboto-medium-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto/roboto-medium-webfont.svg#roboto-medium-webfont')\n       format('svg');\n   font-weight: 500;\n   font-display: swap;\n@@ -44,10 +44,10 @@\n   font-family: mastodon-font-sans-serif;\n   src:\n     local('Roboto'),\n-    url('../fonts/roboto/roboto-regular-webfont.woff2') format('woff2'),\n-    url('../fonts/roboto/roboto-regular-webfont.woff') format('woff'),\n-    url('../fonts/roboto/roboto-regular-webfont.ttf') format('truetype'),\n-    url('../fonts/roboto/roboto-regular-webfont.svg#roboto-regular-webfont')\n+    url('@/fonts/roboto/roboto-regular-webfont.woff2') format('woff2'),\n+    url('@/fonts/roboto/roboto-regular-webfont.woff') format('woff'),\n+    url('@/fonts/roboto/roboto-regular-webfont.ttf') format('truetype'),\n+    url('@/fonts/roboto/roboto-regular-webfont.svg#roboto-regular-webfont')\n       format('svg');\n   font-weight: normal;\n   font-display: swap;\n---\napp/javascript/styles/mastodon/admin.scss\n@@ -1438,8 +1438,8 @@ a.sparkline {\n     inset-inline-start: 10px;\n     border-radius: 4px;\n     background:\n-      url('../images/warning-stripes.svg') repeat-y left,\n-      url('../images/warning-stripes.svg') repeat-y right,\n+      url('@/images/warning-stripes.svg') repeat-y left,\n+      url('@/images/warning-stripes.svg') repeat-y right,\n       var(--background-color);\n   }\n \n---\napp/javascript/styles/mastodon/components.scss\n@@ -641,7 +641,7 @@ body > [data-popper-placement] {\n     align-items: stretch;\n \n     &__border {\n-      background: url('../images/warning-stripes.svg') repeat-y;\n+      background: url('@/images/warning-stripes.svg') repeat-y;\n       width: 5px;\n       flex: 0 0 auto;\n \n---\napp/javascript/styles/mastodon/rich_text.scss\n@@ -44,7 +44,7 @@\n       content: '';\n       width: 24px;\n       height: 20px;\n-      mask-image: url('../images/quote.svg');\n+      mask-image: url('@/images/quote.svg');\n       background-color: var(--rich-text-decorations-color);\n       position: absolute;\n       inset-inline-start: 0;\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n-  version: 2.8.1\n-  resolution: \"pg-connection-string@npm:2.8.1\"\n-  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n+  version: 2.8.5\n+  resolution: \"pg-connection-string@npm:2.8.5\"\n+  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rollup-plugin-visualizer](https://redirect.github.com/btd/rollup-plugin-visualizer) | [`^5.14.0` -> `^6.0.0`](https://renovatebot.com/diffs/npm/rollup-plugin-visualizer/5.14.0/6.0.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/rollup-plugin-visualizer/6.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/rollup-plugin-visualizer/6.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/rollup-plugin-visualizer/5.14.0/6.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/rollup-plugin-visualizer/5.14.0/6.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>btd/rollup-plugin-visualizer (rollup-plugin-visualizer)</summary>\n\n### [`v6.0.0`](https://redirect.github.com/btd/rollup-plugin-visualizer/blob/HEAD/CHANGELOG.md#600)\n\n[Compare Source](https://redirect.github.com/btd/rollup-plugin-visualizer/compare/v5.14.0...v6.0.0)\n\n-   Update dependencies\n-   Set minumum required node version to v20\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xNi4wIiwidXBkYXRlZEluVmVyIjoiNDAuMTYuMCIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwiamF2YXNjcmlwdCJdfQ==-->\n\n\n---\n\nChoice A:\n.github/workflows/chromatic.yml\n@@ -20,6 +20,7 @@ jobs:\n   chromatic:\n     name: Run Chromatic\n     runs-on: ubuntu-latest\n+    if: github.repository == 'mastodon/mastodon'\n     steps:\n       - name: Checkout code\n         uses: actions/checkout@v4\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/components/featured_carousel.tsx\n@@ -5,6 +5,7 @@ import {\n   useLayoutEffect,\n   useRef,\n   useState,\n+  useId,\n } from 'react';\n \n import { defineMessages, FormattedMessage, useIntl } from 'react-intl';\n@@ -17,12 +18,14 @@ import { animated, useSpring } from '@react-spring/web';\n import { useDrag } from '@use-gesture/react';\n \n import { expandAccountFeaturedTimeline } from '@/mastodon/actions/timelines';\n+import { Icon } from '@/mastodon/components/icon';\n import { IconButton } from '@/mastodon/components/icon_button';\n import StatusContainer from '@/mastodon/containers/status_container';\n import { usePrevious } from '@/mastodon/hooks/usePrevious';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n import ChevronLeftIcon from '@/material-icons/400-24px/chevron_left.svg?react';\n import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react';\n+import PushPinIcon from '@/material-icons/400-24px/push_pin.svg?react';\n \n const messages = defineMessages({\n   previous: { id: 'featured_carousel.previous', defaultMessage: 'Previous' },\n@@ -38,6 +41,7 @@ export const FeaturedCarousel: React.FC<{\n   tagged?: string;\n }> = ({ accountId, tagged }) => {\n   const intl = useIntl();\n+  const accessibilityId = useId();\n \n   // Load pinned statuses\n   const dispatch = useAppDispatch();\n@@ -120,11 +124,15 @@ export const FeaturedCarousel: React.FC<{\n       className='featured-carousel'\n       {...bind()}\n       aria-roledescription='carousel'\n-      aria-labelledby='featured-carousel-title'\n+      aria-labelledby={`${accessibilityId}-title`}\n       role='region'\n     >\n       <div className='featured-carousel__header'>\n-        <h4 className='featured-carousel__title' id='featured-carousel-title'>\n+        <h4\n+          className='featured-carousel__title'\n+          id={`${accessibilityId}-title`}\n+        >\n+          <Icon id='thumb-tack' icon={PushPinIcon} />\n           <FormattedMessage\n             id='featured_carousel.header'\n             defaultMessage='{count, plural, one {Pinned Post} other {Pinned Posts}}'\n---\napp/javascript/styles/mastodon/components.scss\n@@ -11074,5 +11074,13 @@ noscript {\n     font-size: 12px;\n     font-weight: 500;\n     text-transform: uppercase;\n+    display: flex;\n+    align-items: center;\n+    gap: 4px;\n+\n+    .icon {\n+      width: 16px;\n+      height: 16px;\n+    }\n   }\n }\n---\n\n\n---\n\nChoice C:\npackage.json\n@@ -99,7 +99,7 @@\n     \"redux-immutable\": \"^4.0.0\",\n     \"regenerator-runtime\": \"^0.14.0\",\n     \"requestidlecallback\": \"^0.3.0\",\n-    \"rollup-plugin-visualizer\": \"^5.14.0\",\n+    \"rollup-plugin-visualizer\": \"^6.0.0\",\n     \"sass\": \"^1.62.1\",\n     \"stacktrace-js\": \"^2.0.2\",\n     \"stringz\": \"^2.1.0\",\n---\nyarn.lock\n@@ -2554,7 +2554,7 @@ __metadata:\n     redux-immutable: \"npm:^4.0.0\"\n     regenerator-runtime: \"npm:^0.14.0\"\n     requestidlecallback: \"npm:^0.3.0\"\n-    rollup-plugin-visualizer: \"npm:^5.14.0\"\n+    rollup-plugin-visualizer: \"npm:^6.0.0\"\n     sass: \"npm:^1.62.1\"\n     stacktrace-js: \"npm:^2.0.2\"\n     stringz: \"npm:^2.1.0\"\n@@ -4887,6 +4887,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"bundle-name@npm:^4.1.0\":\n+  version: 4.1.0\n+  resolution: \"bundle-name@npm:4.1.0\"\n+  dependencies:\n+    run-applescript: \"npm:^7.0.0\"\n+  checksum: 10c0/8e575981e79c2bcf14d8b1c027a3775c095d362d1382312f444a7c861b0e21513c0bd8db5bd2b16e50ba0709fa622d4eab6b53192d222120305e68359daece29\n+  languageName: node\n+  linkType: hard\n+\n \"bytes@npm:3.1.2\":\n   version: 3.1.2\n   resolution: \"bytes@npm:3.1.2\"\n@@ -5535,6 +5544,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"default-browser-id@npm:^5.0.0\":\n+  version: 5.0.0\n+  resolution: \"default-browser-id@npm:5.0.0\"\n+  checksum: 10c0/957fb886502594c8e645e812dfe93dba30ed82e8460d20ce39c53c5b0f3e2afb6ceaec2249083b90bdfbb4cb0f34e1f73fde3d68cac00becdbcfd894156b5ead\n+  languageName: node\n+  linkType: hard\n+\n+\"default-browser@npm:^5.2.1\":\n+  version: 5.2.1\n+  resolution: \"default-browser@npm:5.2.1\"\n+  dependencies:\n+    bundle-name: \"npm:^4.1.0\"\n+    default-browser-id: \"npm:^5.0.0\"\n+  checksum: 10c0/73f17dc3c58026c55bb5538749597db31f9561c0193cd98604144b704a981c95a466f8ecc3c2db63d8bfd04fb0d426904834cfc91ae510c6aeb97e13c5167c4d\n+  languageName: node\n+  linkType: hard\n+\n \"define-data-property@npm:^1.0.1, define-data-property@npm:^1.1.4\":\n   version: 1.1.4\n   resolution: \"define-data-property@npm:1.1.4\"\n@@ -5546,10 +5572,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"define-lazy-prop@npm:^2.0.0\":\n-  version: 2.0.0\n-  resolution: \"define-lazy-prop@npm:2.0.0\"\n-  checksum: 10c0/db6c63864a9d3b7dc9def55d52764968a5af296de87c1b2cc71d8be8142e445208071953649e0386a8cc37cfcf9a2067a47207f1eb9ff250c2a269658fdae422\n+\"define-lazy-prop@npm:^3.0.0\":\n+  version: 3.0.0\n+  resolution: \"define-lazy-prop@npm:3.0.0\"\n+  checksum: 10c0/5ab0b2bf3fa58b3a443140bbd4cd3db1f91b985cc8a246d330b9ac3fc0b6a325a6d82bddc0b055123d745b3f9931afeea74a5ec545439a1630b9c8512b0eeb49\n   languageName: node\n   linkType: hard\n \n@@ -7506,12 +7532,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-docker@npm:^2.0.0, is-docker@npm:^2.1.1\":\n-  version: 2.2.1\n-  resolution: \"is-docker@npm:2.2.1\"\n+\"is-docker@npm:^3.0.0\":\n+  version: 3.0.0\n+  resolution: \"is-docker@npm:3.0.0\"\n   bin:\n     is-docker: cli.js\n-  checksum: 10c0/e828365958d155f90c409cdbe958f64051d99e8aedc2c8c4cd7c89dcf35329daed42f7b99346f7828df013e27deb8f721cf9408ba878c76eb9e8290235fbcdcc\n+  checksum: 10c0/d2c4f8e6d3e34df75a5defd44991b6068afad4835bb783b902fa12d13ebdb8f41b2a199dcb0b5ed2cb78bfee9e4c0bbdb69c2d9646f4106464674d3e697a5856\n   languageName: node\n   linkType: hard\n \n@@ -7572,6 +7598,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"is-inside-container@npm:^1.0.0\":\n+  version: 1.0.0\n+  resolution: \"is-inside-container@npm:1.0.0\"\n+  dependencies:\n+    is-docker: \"npm:^3.0.0\"\n+  bin:\n+    is-inside-container: cli.js\n+  checksum: 10c0/a8efb0e84f6197e6ff5c64c52890fa9acb49b7b74fed4da7c95383965da6f0fa592b4dbd5e38a79f87fc108196937acdbcd758fcefc9b140e479b39ce1fcd1cd\n+  languageName: node\n+  linkType: hard\n+\n \"is-lambda@npm:^1.0.1\":\n   version: 1.0.1\n   resolution: \"is-lambda@npm:1.0.1\"\n@@ -7736,12 +7773,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-wsl@npm:^2.2.0\":\n-  version: 2.2.0\n-  resolution: \"is-wsl@npm:2.2.0\"\n+\"is-wsl@npm:^3.1.0\":\n+  version: 3.1.0\n+  resolution: \"is-wsl@npm:3.1.0\"\n   dependencies:\n-    is-docker: \"npm:^2.0.0\"\n-  checksum: 10c0/a6fa2d370d21be487c0165c7a440d567274fbba1a817f2f0bfa41cc5e3af25041d84267baa22df66696956038a43973e72fca117918c91431920bdef490fa25e\n+    is-inside-container: \"npm:^1.0.0\"\n+  checksum: 10c0/d3317c11995690a32c362100225e22ba793678fe8732660c6de511ae71a0ff05b06980cf21f98a6bf40d7be0e9e9506f859abe00a1118287d63e53d0a3d06947\n   languageName: node\n   linkType: hard\n \n@@ -8841,14 +8878,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"open@npm:^8.4.0\":\n-  version: 8.4.2\n-  resolution: \"open@npm:8.4.2\"\n+\"open@npm:^10.1.2\":\n+  version: 10.1.2\n+  resolution: \"open@npm:10.1.2\"\n   dependencies:\n-    define-lazy-prop: \"npm:^2.0.0\"\n-    is-docker: \"npm:^2.1.1\"\n-    is-wsl: \"npm:^2.2.0\"\n-  checksum: 10c0/bb6b3a58401dacdb0aad14360626faf3fb7fba4b77816b373495988b724fb48941cad80c1b65d62bb31a17609b2cd91c41a181602caea597ca80dfbcc27e84c9\n+    default-browser: \"npm:^5.2.1\"\n+    define-lazy-prop: \"npm:^3.0.0\"\n+    is-inside-container: \"npm:^1.0.0\"\n+    is-wsl: \"npm:^3.1.0\"\n+  checksum: 10c0/1bee796f06e549ce764f693272100323fbc04da8fa3c5b0402d6c2d11b3d76fa0aac0be7535e710015ff035326638e3b9a563f3b0e7ac3266473ed5663caae6d\n   languageName: node\n   linkType: hard\n \n@@ -10647,11 +10685,11 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"rollup-plugin-visualizer@npm:^5.14.0\":\n-  version: 5.14.0\n-  resolution: \"rollup-plugin-visualizer@npm:5.14.0\"\n+\"rollup-plugin-visualizer@npm:^6.0.0\":\n+  version: 6.0.0\n+  resolution: \"rollup-plugin-visualizer@npm:6.0.0\"\n   dependencies:\n-    open: \"npm:^8.4.0\"\n+    open: \"npm:^10.1.2\"\n     picomatch: \"npm:^4.0.2\"\n     source-map: \"npm:^0.7.4\"\n     yargs: \"npm:^17.5.1\"\n@@ -10665,7 +10703,7 @@ __metadata:\n       optional: true\n   bin:\n     rollup-plugin-visualizer: dist/bin/cli.js\n-  checksum: 10c0/ec6ca9ed125bce9994ba49a340bda730661d8e8dc5c5dc014dc757185182e1eda49c6708f990cb059095e71a3741a5248f1e6ba0ced7056020692888e06b1ddf\n+  checksum: 10c0/803b7a93692824c31c4eb6595367717591123dbdc6be3402403bba633bb81ccfdbd16827e852af9da03fd7e8211a974717492e4032d14897c37c130f0cb86222\n   languageName: node\n   linkType: hard\n \n@@ -10765,6 +10803,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"run-applescript@npm:^7.0.0\":\n+  version: 7.0.0\n+  resolution: \"run-applescript@npm:7.0.0\"\n+  checksum: 10c0/bd821bbf154b8e6c8ecffeaf0c33cebbb78eb2987476c3f6b420d67ab4c5301faa905dec99ded76ebb3a7042b4e440189ae6d85bbbd3fc6e8d493347ecda8bfe\n+  languageName: node\n+  linkType: hard\n+\n \"run-parallel@npm:^1.1.9\":\n   version: 1.2.0\n   resolution: \"run-parallel@npm:1.2.0\"\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/api.ts\n@@ -83,6 +83,7 @@ export default function api(withAuthorization = true) {\n   return instance;\n }\n \n+type ApiUrl = `v${1 | 2}/${string}`;\n type RequestParamsOrData = Record<string, unknown>;\n \n export async function apiRequest<ApiResponse = unknown>(\n@@ -105,28 +106,28 @@ export async function apiRequest<ApiResponse = unknown>(\n }\n \n export async function apiRequestGet<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   params?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('GET', url, { params });\n }\n \n export async function apiRequestPost<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   data?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('POST', url, { data });\n }\n \n export async function apiRequestPut<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   data?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('PUT', url, { data });\n }\n \n export async function apiRequestDelete<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   params?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('DELETE', url, { params });\n---\napp/javascript/mastodon/api/accounts.ts\n@@ -36,6 +36,6 @@ export const apiGetEndorsedAccounts = (id: string) =>\n   apiRequestGet<ApiAccountJSON>(`v1/accounts/${id}/endorsements`);\n \n export const apiGetFamiliarFollowers = (id: string) =>\n-  apiRequestGet<ApiFamiliarFollowersJSON>('/v1/accounts/familiar_followers', {\n+  apiRequestGet<ApiFamiliarFollowersJSON>('v1/accounts/familiar_followers', {\n     id,\n   });\n---\napp/javascript/mastodon/api/polls.ts\n@@ -2,9 +2,9 @@ import { apiRequestGet, apiRequestPost } from 'mastodon/api';\n import type { ApiPollJSON } from 'mastodon/api_types/polls';\n \n export const apiGetPoll = (pollId: string) =>\n-  apiRequestGet<ApiPollJSON>(`/v1/polls/${pollId}`);\n+  apiRequestGet<ApiPollJSON>(`v1/polls/${pollId}`);\n \n export const apiPollVote = (pollId: string, choices: string[]) =>\n-  apiRequestPost<ApiPollJSON>(`/v1/polls/${pollId}/votes`, {\n+  apiRequestPost<ApiPollJSON>(`v1/polls/${pollId}/votes`, {\n     choices,\n   });\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [selenium-webdriver](https://selenium.dev) ([source](https://redirect.github.com/SeleniumHQ/selenium/tree/HEAD/rb), [changelog](https://redirect.github.com/SeleniumHQ/selenium/blob/trunk/rb/CHANGES)) | `4.32.0` -> `4.33.0` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/selenium-webdriver/4.33.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/selenium-webdriver/4.33.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/selenium-webdriver/4.32.0/4.33.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/selenium-webdriver/4.32.0/4.33.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>SeleniumHQ/selenium (selenium-webdriver)</summary>\n\n### [`v4.33.0`](https://redirect.github.com/SeleniumHQ/selenium/blob/HEAD/rb/CHANGES#4330-2025-05-23)\n\n\\=========================\n\n-   Add CDP for Chrome 137 and remove 134\n-   Let firefox choose the bidi port by default ([#&#8203;15727](https://redirect.github.com/SeleniumHQ/selenium/issues/15727))\n-   Upgrade to Ruby 3.2\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xNi4wIiwidXBkYXRlZEluVmVyIjoiNDAuMTYuMCIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\n.github/renovate.json5\n@@ -39,7 +39,6 @@\n       // Require Dependency Dashboard Approval for major version bumps of these Ruby packages\n       matchManagers: ['bundler'],\n       matchPackageNames: [\n-        'rack', // Needs to be synced with Rails version\n         'strong_migrations', // Requires manual upgrade\n         'sidekiq', // Requires manual upgrade\n         'sidekiq-unique-jobs', // Requires manual upgrades and sync with Sidekiq version\n---\nGemfile\n@@ -5,7 +5,6 @@ ruby '>= 3.2.0', '< 3.5.0'\n \n gem 'propshaft'\n gem 'puma', '~> 6.3'\n-gem 'rack', '~> 2.2.7'\n gem 'rails', '~> 8.0'\n gem 'thor', '~> 1.2'\n \n---\nGemfile.lock\n@@ -633,7 +633,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.16)\n+    rack (3.1.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -645,18 +645,19 @@ GEM\n       faraday-follow_redirects\n       json-jwt (>= 1.11.0)\n       rack (>= 2.1.0)\n-    rack-protection (3.2.0)\n+    rack-protection (4.1.1)\n       base64 (>= 0.1.0)\n-      rack (~> 2.2, >= 2.2.4)\n+      logger (>= 1.6.0)\n+      rack (>= 3.0.0, < 4)\n     rack-proxy (0.7.7)\n       rack\n-    rack-session (1.0.2)\n-      rack (< 3)\n+    rack-session (2.1.1)\n+      base64 (>= 0.1.0)\n+      rack (>= 3.0.0)\n     rack-test (2.2.0)\n       rack (>= 1.3)\n-    rackup (1.0.1)\n-      rack (< 3)\n-      webrick\n+    rackup (2.2.1)\n+      rack (>= 3)\n     rails (8.0.2)\n       actioncable (= 8.0.2)\n       actionmailbox (= 8.0.2)\n@@ -1044,7 +1045,6 @@ DEPENDENCIES\n   public_suffix (~> 6.0)\n   puma (~> 6.3)\n   pundit (~> 2.3)\n-  rack (~> 2.2.7)\n   rack-attack (~> 6.6)\n   rack-cors (~> 2.0)\n   rack-test (~> 2.1)\n---\nconfig/initializers/mime_types.rb\n@@ -2,6 +2,3 @@\n \n Mime::Type.register 'application/json', :json, %w(text/x-json application/jsonrequest application/jrd+json application/activity+json application/ld+json)\n Mime::Type.register 'text/xml',         :xml,  %w(application/xml application/atom+xml application/xrd+xml)\n-\n-# WebP is not defined in Rack 2.2.\n-Rack::Mime::MIME_TYPES['.webp'] = 'image/webp'\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -806,7 +806,7 @@ GEM\n       activerecord (>= 4.0.0)\n       railties (>= 4.0.0)\n     securerandom (0.4.1)\n-    selenium-webdriver (4.32.0)\n+    selenium-webdriver (4.33.0)\n       base64 (~> 0.2)\n       logger (~> 1.4)\n       rexml (~> 3.2, >= 3.2.5)\n---\n\n\n---\n\nChoice C:\nspec/helpers/theme_helper_spec.rb\n@@ -6,10 +6,10 @@\n   describe 'theme_style_tags' do\n     let(:result) { helper.theme_style_tags(theme) }\n \n-    context 'when using system theme' do\n+    context 'when using \"system\" theme' do\n       let(:theme) { 'system' }\n \n-      it 'returns the mastodon-light and default stylesheets with correct color schemes' do\n+      it 'returns the mastodon-light and application stylesheets with correct color schemes' do\n         expect(html_links.first.attributes.symbolize_keys)\n           .to include(\n             href: have_attributes(value: match(/mastodon-light/)),\n@@ -23,6 +23,17 @@\n       end\n     end\n \n+    context 'when using \"default\" theme' do\n+      let(:theme) { 'default' }\n+\n+      it 'returns the application stylesheet' do\n+        expect(html_links.last.attributes.symbolize_keys)\n+          .to include(\n+            href: have_attributes(value: match(/application/))\n+          )\n+      end\n+    end\n+\n     context 'when using other theme' do\n       let(:theme) { 'contrast' }\n \n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -79,7 +79,7 @@ gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n gem 'redis-namespace', '~> 1.10'\n-gem 'rqrcode', '~> 2.2'\n+gem 'rqrcode', '~> 3.0'\n gem 'ruby-progressbar', '~> 1.13'\n gem 'sanitize', '~> 7.0'\n gem 'scenic', '~> 1.7'\n---\nGemfile.lock\n@@ -711,10 +711,10 @@ GEM\n     rotp (6.3.0)\n     rouge (4.5.1)\n     rpam2 (4.0.2)\n-    rqrcode (2.2.0)\n+    rqrcode (3.0.0)\n       chunky_png (~> 1.0)\n-      rqrcode_core (~> 1.0)\n-    rqrcode_core (1.2.0)\n+      rqrcode_core (~> 2.0)\n+    rqrcode_core (2.0.0)\n     rspec (3.13.0)\n       rspec-core (~> 3.13.0)\n       rspec-expectations (~> 3.13.0)\n@@ -1043,7 +1043,7 @@ DEPENDENCIES\n   redcarpet (~> 3.6)\n   redis (~> 4.5)\n   redis-namespace (~> 1.10)\n-  rqrcode (~> 2.2)\n+  rqrcode (~> 3.0)\n   rspec-github (~> 3.0)\n   rspec-rails (~> 7.0)\n   rspec-sidekiq (~> 5.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\n### Changes proposed in this PR:\r\n- Adds relationship info (\"You follow each other\", \"Follows you\") to account hovercard\r\n- If this is shown, \"Followers you know\" is hidden to not clutter up the card\r\n\r\n### Screenshots\r\n\r\n![image](https://github.com/user-attachments/assets/42bc9dd3-886b-4d61-832f-713f1e246b97)\r\n\r\n![Screenshot 2025-05-30 at 11 55 15](https://github.com/user-attachments/assets/4cf14cae-08af-456a-a30a-8b6e05e45621)\r\n\r\n![Screenshot 2025-05-30 at 11 59 01](https://github.com/user-attachments/assets/b71d8eca-71b2-4188-a1e2-83f26178b7ab)\r\n\n\n---\n\nChoice A:\n.rubocop_todo.yml\n@@ -39,7 +39,6 @@ Style/FetchEnvVar:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/3_omniauth.rb'\n     - 'config/initializers/cache_buster.rb'\n-    - 'config/initializers/devise.rb'\n     - 'config/initializers/paperclip.rb'\n     - 'config/initializers/vapid.rb'\n     - 'lib/tasks/repo.rake'\n---\nconfig/initializers/devise.rb\n@@ -377,7 +377,7 @@ def session_cookie\n     config.usernamefield          = nil\n     config.emailfield             = 'email'\n     config.check_at_sign          = true\n-    config.pam_default_suffix     = ENV.fetch('PAM_EMAIL_DOMAIN') { ENV['LOCAL_DOMAIN'] }\n+    config.pam_default_suffix     = ENV.fetch('PAM_EMAIL_DOMAIN') { ENV.fetch('LOCAL_DOMAIN', nil) }\n     config.pam_default_service    = ENV.fetch('PAM_DEFAULT_SERVICE') { 'rpam' }\n     config.pam_controlled_service = ENV.fetch('PAM_CONTROLLED_SERVICE', nil).presence\n   end\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -2986,6 +2986,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"@rolldown/pluginutils@npm:1.0.0-beta.9\":\n+  version: 1.0.0-beta.9\n+  resolution: \"@rolldown/pluginutils@npm:1.0.0-beta.9\"\n+  checksum: 10c0/21aebb7ebd093282efd96f63ddd465f76746b1d70282366d6ccc7fff6eb4da5c2f8f4bfaaaeb4283c2432600e5609e39e9897864575e593efc11d376ca1a6fa1\n+  languageName: node\n+  linkType: hard\n+\n \"@rollup/plugin-babel@npm:^5.2.0\":\n   version: 5.3.1\n   resolution: \"@rollup/plugin-babel@npm:5.3.1\"\n@@ -4180,17 +4187,18 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.4.1\n-  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n+  version: 4.5.0\n+  resolution: \"@vitejs/plugin-react@npm:4.5.0\"\n   dependencies:\n     \"@babel/core\": \"npm:^7.26.10\"\n     \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n     \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n+    \"@rolldown/pluginutils\": \"npm:1.0.0-beta.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n     react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n     vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n-  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n+  checksum: 10c0/c9f75cde098b9aac62cb512103d7f898a0a173cb78dc9fcf79ca4b3f21a1458cd1955a4383c8c9e3841ce23c5e7f02ed1455e445c9574879b143d40734121fd8\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/hover_card_account.tsx\n@@ -45,6 +45,19 @@ export const HoverCardAccount = forwardRef<\n \n   const { familiarFollowers } = useFetchFamiliarFollowers({ accountId });\n \n+  const relationship = useAppSelector((state) =>\n+    accountId ? state.relationships.get(accountId) : undefined,\n+  );\n+  const isMutual = relationship?.followed_by && relationship.following;\n+  const isFollower = relationship?.followed_by;\n+  const hasRelationshipLoaded = !!relationship;\n+\n+  const shouldDisplayFamiliarFollowers =\n+    familiarFollowers.length > 0 &&\n+    hasRelationshipLoaded &&\n+    !isMutual &&\n+    !isFollower;\n+\n   return (\n     <div\n       ref={ref}\n@@ -85,7 +98,7 @@ export const HoverCardAccount = forwardRef<\n               value={account.followers_count}\n               renderer={FollowersCounter}\n             />\n-            {familiarFollowers.length > 0 && (\n+            {shouldDisplayFamiliarFollowers && (\n               <>\n                 &middot;\n                 <div className='hover-card__familiar-followers'>\n@@ -101,6 +114,22 @@ export const HoverCardAccount = forwardRef<\n                 </div>\n               </>\n             )}\n+            {(isMutual || isFollower) && (\n+              <>\n+                &middot;\n+                {isMutual ? (\n+                  <FormattedMessage\n+                    id='account.mutual'\n+                    defaultMessage='You follow each other'\n+                  />\n+                ) : (\n+                  <FormattedMessage\n+                    id='account.follows_you'\n+                    defaultMessage='Follows you'\n+                  />\n+                )}\n+              </>\n+            )}\n           </div>\n \n           <FollowButton accountId={accountId} />\n---\napp/javascript/styles/mastodon/components.scss\n@@ -10766,7 +10766,7 @@ noscript {\n     display: flex;\n     align-items: center;\n     flex-wrap: wrap;\n-    gap: 10px;\n+    gap: 2px 10px;\n   }\n \n   &__numbers {\n---\n\n\n---\n\nChoice D:\n.rubocop_todo.yml\n@@ -39,15 +39,6 @@ Style/FetchEnvVar:\n     - 'config/initializers/paperclip.rb'\n     - 'lib/tasks/repo.rake'\n \n-# This cop supports safe autocorrection (--autocorrect).\n-# Configuration parameters: EnforcedStyle, MaxUnannotatedPlaceholdersAllowed, Mode, AllowedMethods, AllowedPatterns.\n-# SupportedStyles: annotated, template, unannotated\n-# AllowedMethods: redirect\n-Style/FormatStringToken:\n-  Exclude:\n-    - 'config/initializers/devise.rb'\n-    - 'lib/paperclip/color_extractor.rb'\n-\n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: MinBodyLength, AllowConsecutiveConditionals.\n Style/GuardClause:\n---\nconfig/initializers/devise.rb\n@@ -394,7 +394,7 @@ def session_cookie\n     config.ldap_uid            = ENV.fetch('LDAP_UID', 'cn')\n     config.ldap_mail           = ENV.fetch('LDAP_MAIL', 'mail')\n     config.ldap_tls_no_verify  = ENV['LDAP_TLS_NO_VERIFY'] == 'true'\n-    config.ldap_search_filter  = ENV.fetch('LDAP_SEARCH_FILTER', '(|(%{uid}=%{email})(%{mail}=%{email}))')\n+    config.ldap_search_filter  = ENV.fetch('LDAP_SEARCH_FILTER', '(|(%<uid>s=%<email>s)(%<mail>s=%<email>s))')\n     config.ldap_uid_conversion_enabled  = ENV['LDAP_UID_CONVERSION_ENABLED'] == 'true'\n     config.ldap_uid_conversion_search   = ENV.fetch('LDAP_UID_CONVERSION_SEARCH', '.,- ')\n     config.ldap_uid_conversion_replace  = ENV.fetch('LDAP_UID_CONVERSION_REPLACE', '_')\n---\nlib/paperclip/color_extractor.rb\n@@ -239,7 +239,7 @@ def palette_from_im_histogram(result, quantity)\n     end\n \n     def rgb_to_hex(rgb)\n-      format('#%02x%02x%02x', rgb.r, rgb.g, rgb.b)\n+      format('#%02x%02x%02x', rgb.r, rgb.g, rgb.b) # rubocop:disable Style/FormatStringToken\n     end\n   end\n end\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nCloses MAS-430\r\n\r\n### Changes proposed in this PR:\r\n- Shows a hint for quotes that are matching a filter with a filter action of \"Hide completely\"\r\n   The implementation feels quite hacky, but a cleaner approach would require duplicating or entirely refactoring code from `status_container`\r\n\r\n### Screenshots\r\n\r\n![image](https://github.com/user-attachments/assets/da454ca3-505d-4636-815b-31c4f3b6a616)\r\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.4)\n+    rubocop (1.75.5)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\nChoice B:\nconfig/environments/production.rb\n@@ -150,13 +150,6 @@\n     'Referrer-Policy' => 'same-origin',\n   }\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = if ENV['SECRET_KEY_BASE_DUMMY']\n-                          SecureRandom.hex(64)\n-                        else\n-                          ENV.fetch('OTP_SECRET')\n-                        end\n-\n   # Enable DNS rebinding protection and other `Host` header attacks.\n   # config.hosts = [\n   #   \"example.com\",     # Allow requests from example.com\n---\nconfig/environments/test.rb\n@@ -48,9 +48,6 @@\n   # Print deprecation notices to the stderr.\n   config.active_support.deprecation = :stderr\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = '100c7faeef00caa29242f6b04156742bf76065771fd4117990c4282b8748ff3d99f8fdae97c982ab5bd2e6756a159121377cce4421f4a8ecd2d67bd7749a3fb4'\n-\n   # Generate random VAPID keys\n   vapid_key = Webpush.generate_key\n   config.x.vapid_private_key = vapid_key.private_key\n---\ndb/post_migrate/20240307180905_migrate_devise_two_factor_secrets.rb\n@@ -79,8 +79,18 @@ def legacy_otp_secret\n   class MigrationUser < ApplicationRecord\n     self.table_name = :users\n \n+    LEGACY_OTP_SECRET = begin\n+      if Rails.env.test?\n+        '100c7faeef00caa29242f6b04156742bf76065771fd4117990c4282b8748ff3d99f8fdae97c982ab5bd2e6756a159121377cce4421f4a8ecd2d67bd7749a3fb4'\n+      elsif ENV['SECRET_KEY_BASE_DUMMY']\n+        SecureRandom.hex(64)\n+      else\n+        ENV.fetch('OTP_SECRET')\n+      end\n+    end\n+\n     devise :two_factor_authenticatable,\n-           otp_secret_encryption_key: Rails.configuration.x.otp_secret\n+           otp_secret_encryption_key: LEGACY_OTP_SECRET\n \n     include LegacyOtpSecret\n   end\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -1,3 +1,5 @@\n+import { useMemo } from 'react';\n+\n import { FormattedMessage } from 'react-intl';\n \n import classNames from 'classnames';\n@@ -10,9 +12,11 @@ import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react'\n import { Icon } from 'mastodon/components/icon';\n import StatusContainer from 'mastodon/containers/status_container';\n import type { Status } from 'mastodon/models/status';\n+import type { RootState } from 'mastodon/store';\n import { useAppSelector } from 'mastodon/store';\n \n import QuoteIcon from '../../images/quote.svg?react';\n+import { makeGetStatus } from '../selectors';\n \n const MAX_QUOTE_POSTS_NESTING_LEVEL = 1;\n \n@@ -65,6 +69,10 @@ const QuoteLink: React.FC<{\n };\n \n type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n+type GetStatusSelector = (\n+  state: RootState,\n+  props: { id?: string | null; contextType?: string },\n+) => Status | null;\n \n export const QuotedStatus: React.FC<{\n   quote: QuoteMap;\n@@ -73,34 +81,50 @@ export const QuotedStatus: React.FC<{\n   nestingLevel?: number;\n }> = ({ quote, contextType, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n-  const state = quote.get('state');\n+  const quoteState = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n   let quoteError: React.ReactNode = null;\n \n-  if (state === 'deleted') {\n+  // In order to find out whether the quoted post should be completely hidden\n+  // due to a matching filter, we run it through the selector used by `status_container`.\n+  // If this returns null even though `status` exists, it's because it's filtered.\n+  const getStatus = useMemo(() => makeGetStatus(), []) as GetStatusSelector;\n+  const statusWithExtraData = useAppSelector((state) =>\n+    getStatus(state, { id: quotedStatusId, contextType }),\n+  );\n+  const isFilteredAndHidden = status && statusWithExtraData === null;\n+\n+  if (isFilteredAndHidden) {\n+    quoteError = (\n+      <FormattedMessage\n+        id='status.quote_error.filtered'\n+        defaultMessage='Hidden due to one of your filters'\n+      />\n+    );\n+  } else if (quoteState === 'deleted') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.removed'\n         defaultMessage='This post was removed by its author.'\n       />\n     );\n-  } else if (state === 'unauthorized') {\n+  } else if (quoteState === 'unauthorized') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.unauthorized'\n         defaultMessage='This post cannot be displayed as you are not authorized to view it.'\n       />\n     );\n-  } else if (state === 'pending') {\n+  } else if (quoteState === 'pending') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.pending_approval'\n         defaultMessage='This post is pending approval from the original author.'\n       />\n     );\n-  } else if (state === 'rejected' || state === 'revoked') {\n+  } else if (quoteState === 'rejected' || quoteState === 'revoked') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.rejected'\n---\napp/javascript/mastodon/locales/en.json\n@@ -864,6 +864,7 @@\n   \"status.mute_conversation\": \"Mute conversation\",\n   \"status.open\": \"Expand this post\",\n   \"status.pin\": \"Feature on profile\",\n+  \"status.quote_error.filtered\": \"Hidden due to one of your filters\",\n   \"status.quote_error.not_found\": \"This post cannot be displayed.\",\n   \"status.quote_error.pending_approval\": \"This post is pending approval from the original author.\",\n   \"status.quote_error.rejected\": \"This post cannot be displayed as the original author does not allow it to be quoted.\",\n---\n\n\n---\n\nChoice D:\n.rubocop/naming.yml\n@@ -1,3 +1,6 @@\n ---\n Naming/BlockForwarding:\n   EnforcedStyle: explicit\n+\n+Naming/PredicateMethod:\n+  Enabled: false\n---\n.rubocop_todo.yml\n@@ -1,6 +1,6 @@\n # This configuration was generated by\n # `rubocop --auto-gen-config --auto-gen-only-exclude --no-offense-counts --no-auto-gen-timestamp`\n-# using RuboCop version 1.75.8.\n+# using RuboCop version 1.76.0.\n # The point is for the user to remove these configuration records\n # one by one as the offenses are removed from the code base.\n # Note that changes in the inspected code, or installation of new\n---\nGemfile.lock\n@@ -751,18 +751,18 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.8)\n+    rubocop (1.76.0)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n       parallel (~> 1.10)\n       parser (>= 3.3.0.2)\n       rainbow (>= 2.2.2, < 4.0)\n       regexp_parser (>= 2.9.3, < 3.0)\n-      rubocop-ast (>= 1.44.0, < 2.0)\n+      rubocop-ast (>= 1.45.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.1)\n+    rubocop-ast (1.45.0)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n---\napp/controllers/auth/registrations_controller.rb\n@@ -138,7 +138,7 @@ def require_rules_acceptance!\n     set_locale { render :rules }\n   end\n \n-  def is_flashing_format? # rubocop:disable Naming/PredicateName\n+  def is_flashing_format? # rubocop:disable Naming/PredicatePrefix\n     if params[:action] == 'create'\n       false # Disable flash messages for sign-up\n     else\n---\napp/models/concerns/attachmentable.rb\n@@ -22,7 +22,7 @@ module Attachmentable\n   ).freeze\n \n   included do\n-    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicateName\n+    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicatePrefix\n       super\n \n       send(:\"before_#{name}_validate\", prepend: true) do\n---\napp/models/user_settings/glue.rb\n@@ -17,7 +17,7 @@ def type_for_attribute(key)\n     self.class.definition_for(key)&.type\n   end\n \n-  def has_attribute?(key) # rubocop:disable Naming/PredicateName\n+  def has_attribute?(key) # rubocop:disable Naming/PredicatePrefix\n     self.class.definition_for?(key)\n   end\n end\n---\nconfig/initializers/1_hosts.rb\n@@ -21,7 +21,7 @@\n \n   config.x.streaming_api_base_url = ENV.fetch('STREAMING_API_BASE_URL') do\n     if Rails.env.production?\n-      \"ws#{https ? 's' : ''}://#{web_host}\"\n+      \"ws#{'s' if https}://#{web_host}\"\n     else\n       \"ws://#{host.split(':').first}:4000\"\n     end\n---\nconfig/initializers/content_security_policy.rb\n@@ -32,7 +32,7 @@\n \n   if Rails.env.development?\n     vite_public_host = ENV.fetch('VITE_DEV_SERVER_PUBLIC', \"localhost:#{ViteRuby.config.port}\")\n-    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{ViteRuby.config.https ? 's' : ''}://#{vite_public_host}\" }\n+    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{'s' if ViteRuby.config.https}://#{vite_public_host}\" }\n \n     p.connect_src :self, :data, :blob, *media_hosts, Rails.configuration.x.streaming_api_base_url, *front_end_build_urls\n     p.script_src  :self, :unsafe_inline, :unsafe_eval, assets_host\n---\nlib/mastodon/migration_warning.rb\n@@ -23,7 +23,7 @@ def migration_duration_warning(explanation = nil)\n \n     def announce_countdown\n       WARNING_SECONDS.downto(1) do |i|\n-        say \"Continuing in #{i} second#{i == 1 ? '' : 's'}...\", true\n+        say \"Continuing in #{i} second#{'s' unless i == 1}...\", true\n         sleep 1\n       end\n     end\n---\nlib/mastodon/version.rb\n@@ -75,7 +75,7 @@ def source_commit\n     end\n \n     def user_agent\n-      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{Rails.configuration.x.use_https ? 's' : ''}://#{Rails.configuration.x.web_domain}/)\"\n+      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{'s' if Rails.configuration.x.use_https}://#{Rails.configuration.x.web_domain}/)\"\n     end\n \n     def version_configuration\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes bug from #34693. Apparently React Spring v10+ requires React 19+, so we need to revert.\n\n---\n\nChoice A:\napp/models/concerns/status/safe_reblog_insert.rb\n@@ -16,7 +16,7 @@ module Status::SafeReblogInsert\n     # The code is kept similar to ActiveRecord::Persistence code and calls it\n     # directly when we are not handling a reblog.\n     #\n-    # https://github.com/rails/rails/blob/v7.2.1.1/activerecord/lib/active_record/persistence.rb#L238-L263\n+    # https://github.com/rails/rails/blob/v8.0.2/activerecord/lib/active_record/persistence.rb#L238-L261\n     def _insert_record(connection, values, returning)\n       return super unless values.is_a?(Hash) && values['reblog_of_id']&.value.present?\n \n@@ -36,15 +36,13 @@ def _insert_record(connection, values, returning)\n       # Instead, we use a custom builder when a reblog is happening:\n       im = _compile_reblog_insert(values)\n \n-      with_connection do |_c|\n-        connection.insert(\n-          im, \"#{self} Create\", primary_key || false, primary_key_value,\n-          returning: returning\n-        ).tap do |result|\n-          # Since we are using SELECT instead of VALUES, a non-error `nil` return is possible.\n-          # For our purposes, it's equivalent to a foreign key constraint violation\n-          raise ActiveRecord::InvalidForeignKey, \"(reblog_of_id)=(#{values['reblog_of_id'].value}) is not present in table \\\"statuses\\\"\" if result.nil?\n-        end\n+      connection.insert(\n+        im, \"#{self} Create\", primary_key || false, primary_key_value,\n+        returning: returning\n+      ).tap do |result|\n+        # Since we are using SELECT instead of VALUES, a non-error `nil` return is possible.\n+        # For our purposes, it's equivalent to a foreign key constraint violation\n+        raise ActiveRecord::InvalidForeignKey, \"(reblog_of_id)=(#{values['reblog_of_id'].value}) is not present in table \\\"statuses\\\"\" if result.nil?\n       end\n     end\n \n---\n\n\n---\n\nChoice B:\n.github/renovate.json5\n@@ -28,6 +28,9 @@\n         // react-router: Requires manual upgrade\n         'history',\n         'react-router-dom',\n+\n+        // react-spring: Requires manual upgrade when upgrading react\n+        '@react-spring/web',\n       ],\n       matchUpdateTypes: ['major'],\n       dependencyDashboardApproval: true,\n---\napp/javascript/mastodon/features/video/components/hotkey_indicator.tsx\n@@ -24,9 +24,7 @@ export const HotkeyIndicator: React.FC<{\n     enter: [{ opacity: 1 }],\n     leave: [{ opacity: 0 }],\n     onRest: (_result, _ctrl, item) => {\n-      if (item) {\n-        onDismiss(item);\n-      }\n+      onDismiss(item);\n     },\n   });\n \n---\npackage.json\n@@ -44,7 +44,7 @@\n     \"@github/webauthn-json\": \"^2.1.1\",\n     \"@optimize-lodash/rollup-plugin\": \"^5.0.2\",\n     \"@rails/ujs\": \"7.1.501\",\n-    \"@react-spring/web\": \"^10.0.0\",\n+    \"@react-spring/web\": \"^9.7.5\",\n     \"@reduxjs/toolkit\": \"^2.0.1\",\n     \"@use-gesture/react\": \"^10.3.1\",\n     \"@vitejs/plugin-legacy\": \"^6.1.1\",\n---\nyarn.lock\n@@ -2460,7 +2460,7 @@ __metadata:\n     \"@github/webauthn-json\": \"npm:^2.1.1\"\n     \"@optimize-lodash/rollup-plugin\": \"npm:^5.0.2\"\n     \"@rails/ujs\": \"npm:7.1.501\"\n-    \"@react-spring/web\": \"npm:^10.0.0\"\n+    \"@react-spring/web\": \"npm:^9.7.5\"\n     \"@reduxjs/toolkit\": \"npm:^2.0.1\"\n     \"@testing-library/dom\": \"npm:^10.2.0\"\n     \"@testing-library/react\": \"npm:^16.0.0\"\n@@ -2887,69 +2887,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/animated@npm:10.0.1\"\n+\"@react-spring/animated@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/animated@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/shared\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/aaccd4a8b0280ac846d463b253ad8f092ee4afc9dbedc8e77616adf5399ffec755344f09fdd8487cadaf815840dff84d354d1143579c27c2fcd6937549b5fc40\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/f8c2473c60f39a878c7dd0fdfcfcdbc720521e1506aa3f63c9de64780694a0a73d5ccc535a5ccec3520ddb70a71cf43b038b32c18e99531522da5388c510ecd7\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/core@npm:10.0.1\"\n+\"@react-spring/core@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/core@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.1\"\n-    \"@react-spring/shared\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/animated\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/059b122dda4138e5e7e461abd49350921e326735ca9a1d8aa19b1fdbae0937661b5f71af6fe82fd8f59e8db5549627849b38cc3f7ef2ec7ee9c93c3d6225174f\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/5bfd83dfe248cd91889f215f015d908c7714ef445740fd5afa054b27ebc7d5a456abf6c309e2459d9b5b436e78d6fda16b62b9601f96352e9130552c02270830\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/rafz@npm:10.0.1\"\n-  checksum: 10c0/cba76f143d3a06f79dd0c09f7aefd17df9cca9b2c1ef7f9103255e5351326f4a42a5a1366f731a78f74380d96ba683bcc2a49312ed1e4b9e9e249e72c9ff68cb\n+\"@react-spring/rafz@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/rafz@npm:9.7.5\"\n+  checksum: 10c0/8bdad180feaa9a0e870a513043a5e98a4e9b7292a9f887575b7e6fadab2677825bc894b7ff16c38511b35bfe6cc1072df5851c5fee64448d67551559578ca759\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/shared@npm:10.0.1\"\n+\"@react-spring/shared@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/shared@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/rafz\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/f056aaa018b3744afd8244e8eea24534d32f92fad9ace815b80e159b296fb5db148e2c9bd840ad9a5188e7a3c0778fd564b8af9ae02cd500e019a228398fb3cf\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/0207eacccdedd918a2fc55e78356ce937f445ce27ad9abd5d3accba8f9701a39349b55115641dc2b39bb9d3a155b058c185b411d292dc8cc5686bfa56f73b94f\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/types@npm:10.0.1\"\n-  checksum: 10c0/260890f9c156dc69b77c846510017156d8c0a07cce70edc7c108e57b0cf4122b26a15e724b191481a51b2c914296de9e81d56618b2c339339d4b221930691baa\n+\"@react-spring/types@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/types@npm:9.7.5\"\n+  checksum: 10c0/85c05121853cacb64f7cf63a4855e9044635e1231f70371cd7b8c78bc10be6f4dd7c68f592f92a2607e8bb68051540989b4677a2ccb525dba937f5cd95dc8bc1\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/web@npm:^10.0.0\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/web@npm:10.0.1\"\n+\"@react-spring/web@npm:^9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/web@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.1\"\n-    \"@react-spring/core\": \"npm:~10.0.1\"\n-    \"@react-spring/shared\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/animated\": \"npm:~9.7.5\"\n+    \"@react-spring/core\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/a0c788c9fd881ccb834feb22fc0694e74e59f7b76e498f0096f5b65e2c9812513955bf45ee27d7c5348f56a7bba7c5a6961d4be663728bb2172fe5aa6b6bdfc4\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/bcd1e052e1b16341a12a19bf4515f153ca09d1fa86ff7752a5d02d7c4db58e8baf80e6283e64411f1e388c65340dce2254b013083426806b5dbae38bd151e53e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\nlib/premailer_bundled_asset_strategy.rb\n@@ -15,7 +15,9 @@ def load(url)\n         headers\n       ).presence\n     else\n-      path = Rails.public_path.join(url.delete_prefix('/'))\n+      url = url.delete_prefix(Rails.configuration.action_controller.asset_host) if Rails.configuration.action_controller.asset_host.present?\n+      url = url.delete_prefix('/')\n+      path = Rails.public_path.join(url)\n       return unless path.exist?\n \n       path.read\n---\n\n\n---\n\nChoice D:\napp/helpers/context_helper.rb\n@@ -25,6 +25,7 @@ module ContextHelper\n     voters_count: { 'toot' => 'http://joinmastodon.org/ns#', 'votersCount' => 'toot:votersCount' },\n     suspended: { 'toot' => 'http://joinmastodon.org/ns#', 'suspended' => 'toot:suspended' },\n     attribution_domains: { 'toot' => 'http://joinmastodon.org/ns#', 'attributionDomains' => { '@id' => 'toot:attributionDomains', '@type' => '@id' } },\n+    quote_requests: { 'QuoteRequest' => 'https://w3id.org/fep/044f#QuoteRequest' },\n   }.freeze\n \n   def full_context\n---\napp/lib/activitypub/activity.rb\n@@ -57,6 +57,8 @@ def klass\n         ActivityPub::Activity::Remove\n       when 'Move'\n         ActivityPub::Activity::Move\n+      when 'QuoteRequest'\n+        ActivityPub::Activity::QuoteRequest\n       end\n     end\n   end\n---\napp/lib/activitypub/activity/quote_request.rb\n@@ -0,0 +1,30 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::Activity::QuoteRequest < ActivityPub::Activity\n+  include Payloadable\n+\n+  def perform\n+    return unless Mastodon::Feature.inbound_quotes_enabled?\n+    return if non_matching_uri_hosts?(@account.uri, @json['id'])\n+\n+    quoted_status = status_from_uri(object_uri)\n+    return if quoted_status.nil? || !quoted_status.account.local? || !quoted_status.distributable?\n+\n+    # For now, we don't support being quoted by external servers\n+    reject_quote_request!(quoted_status)\n+  end\n+\n+  private\n+\n+  def reject_quote_request!(quoted_status)\n+    quote = Quote.new(\n+      quoted_status: quoted_status,\n+      quoted_account: quoted_status.account,\n+      status: Status.new(account: @account, uri: @json['instrument']),\n+      account: @account,\n+      activity_uri: @json['id']\n+    )\n+    json = Oj.dump(serialize_payload(quote, ActivityPub::RejectQuoteRequestSerializer))\n+    ActivityPub::DeliveryWorker.perform_async(json, quoted_status.account_id, @account.inbox_url)\n+  end\n+end\n---\napp/serializers/activitypub/quote_request_serializer.rb\n@@ -0,0 +1,28 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::QuoteRequestSerializer < ActivityPub::Serializer\n+  context_extensions :quote_requests\n+\n+  attributes :id, :type, :actor, :instrument\n+  attribute :virtual_object, key: :object\n+\n+  def id\n+    object.activity_uri || [ActivityPub::TagManager.instance.uri_for(object.target_account), '#quote_requests/', object.id].join\n+  end\n+\n+  def type\n+    'QuoteRequest'\n+  end\n+\n+  def actor\n+    ActivityPub::TagManager.instance.uri_for(object.account)\n+  end\n+\n+  def virtual_object\n+    ActivityPub::TagManager.instance.uri_for(object.quoted_status)\n+  end\n+\n+  def instrument\n+    ActivityPub::TagManager.instance.uri_for(object.status)\n+  end\n+end\n---\napp/serializers/activitypub/reject_quote_request_serializer.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::RejectQuoteRequestSerializer < ActivityPub::Serializer\n+  attributes :id, :type, :actor\n+\n+  has_one :object, serializer: ActivityPub::QuoteRequestSerializer\n+\n+  def id\n+    [ActivityPub::TagManager.instance.uri_for(object.quoted_account), '#rejects/quote_requests/', object.id].join\n+  end\n+\n+  def type\n+    'Reject'\n+  end\n+\n+  def actor\n+    ActivityPub::TagManager.instance.uri_for(object.quoted_account)\n+  end\n+end\n---\nspec/lib/activitypub/activity/quote_request_spec.rb\n@@ -0,0 +1,51 @@\n+# frozen_string_literal: true\n+\n+require 'rails_helper'\n+\n+RSpec.describe ActivityPub::Activity::QuoteRequest, feature: :inbound_quotes do\n+  let(:sender)    { Fabricate(:account, domain: 'example.com') }\n+  let(:recipient) { Fabricate(:account) }\n+  let(:quoted_post) { Fabricate(:status, account: recipient) }\n+  let(:request_uri) { 'https://example.com/missing-ui' }\n+  let(:quoted_uri) { ActivityPub::TagManager.instance.uri_for(quoted_post) }\n+\n+  let(:json) do\n+    {\n+      '@context': [\n+        'https://www.w3.org/ns/activitystreams',\n+        {\n+          QuoteRequest: 'https://w3id.org/fep/044f#QuoteRequest',\n+        },\n+      ],\n+      id: request_uri,\n+      type: 'QuoteRequest',\n+      actor: ActivityPub::TagManager.instance.uri_for(sender),\n+      object: quoted_uri,\n+      instrument: 'https://example.com/unknown-status',\n+    }.with_indifferent_access\n+  end\n+\n+  describe '#perform' do\n+    subject { described_class.new(json, sender) }\n+\n+    context 'when trying to quote an unknown status' do\n+      let(:quoted_uri) { 'https://example.com/statuses/1234' }\n+\n+      it 'does not send anything' do\n+        expect { subject.perform }\n+          .to_not enqueue_sidekiq_job(ActivityPub::DeliveryWorker)\n+      end\n+    end\n+\n+    context 'when trying to quote an unquotable local status' do\n+      it 'sends a Reject activity' do\n+        expect { subject.perform }\n+          .to enqueue_sidekiq_job(ActivityPub::DeliveryWorker)\n+          .with(satisfying do |body|\n+            outgoing_json = Oj.load(body)\n+            outgoing_json['type'] == 'Reject' && %w(type id actor object instrument).all? { |key| json[key] == outgoing_json['object'][key] }\n+          end, recipient.id, sender.inbox_url)\n+      end\n+    end\n+  end\n+end\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\n### Changes proposed in this PR:\r\n- Adds a sample status with both a quote and attached image\n\n---\n\nChoice A:\nlib/tasks/dev.rake\n@@ -366,6 +366,27 @@ namespace :dev do\n       quoted_status: remote_formatted_post,\n       state: :accepted\n     ).find_or_create_by!(id: 10_000_010)\n-    Status.create_with(account: showcase_account, reblog: remote_quote).find_or_create_by!(id: 10_000_024)\n+    Status.create_with(\n+      account: showcase_account,\n+      reblog: remote_quote\n+    ).find_or_create_by!(id: 10_000_024)\n+\n+    media_attachment = MediaAttachment.create_with(\n+      account: showcase_account,\n+      file: File.open('spec/fixtures/files/attachment.jpg')\n+    ).find_or_create_by!(id: 10_000_010)\n+    quote_post_with_media = Status.create_with(\n+      text: \"This is a status with a picture and tags which also quotes a status with a picture.\\n\\n#Mastodon #Test\",\n+      ordered_media_attachment_ids: [media_attachment.id],\n+      account: showcase_account,\n+      visibility: :public\n+    ).find_or_create_by!(id: 10_000_025)\n+    media_attachment.update(status_id: quote_post_with_media.id)\n+    ProcessHashtagsService.new.call(quote_post_with_media)\n+    Quote.create_with(\n+      status: quote_post_with_media,\n+      quoted_status: status_with_media,\n+      state: :accepted\n+    ).find_or_create_by!(id: 10_000_011)\n   end\n end\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -66,10 +66,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/compat-data@npm:^7.22.6, @babel/compat-data@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/compat-data@npm:7.27.1\"\n-  checksum: 10c0/03e3a01b6772858dc5064f332ad4dc16fbbc0353f2180fd663a2651e8305058e35b6db57114e345d925def9b73cd7a322e95a45913428b8db705a098fd3dd289\n+\"@babel/compat-data@npm:^7.22.6, @babel/compat-data@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/compat-data@npm:7.27.2\"\n+  checksum: 10c0/077c9e01af3b90decee384a6a44dcf353898e980cee22ec7941f9074655dbbe97ec317345536cdc7ef7391521e1497930c522a3816af473076dd524be7fccd32\n   languageName: node\n   linkType: hard\n \n@@ -128,16 +128,16 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/helper-compilation-targets@npm:7.27.1\"\n+\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/helper-compilation-targets@npm:7.27.2\"\n   dependencies:\n-    \"@babel/compat-data\": \"npm:^7.27.1\"\n+    \"@babel/compat-data\": \"npm:^7.27.2\"\n     \"@babel/helper-validator-option\": \"npm:^7.27.1\"\n     browserslist: \"npm:^4.24.0\"\n     lru-cache: \"npm:^5.1.1\"\n     semver: \"npm:^6.3.1\"\n-  checksum: 10c0/1cfd3760a1bf1e367ea4a91214c041be7076197ba7a4f3c0710cab00fb5734eb010a2946efe6ecfb1ca9dc63e6c69644a1afa399db4082f374b9311e129f6f0b\n+  checksum: 10c0/f338fa00dcfea931804a7c55d1a1c81b6f0a09787e528ec580d5c21b3ecb3913f6cb0f361368973ce953b824d910d3ac3e8a8ee15192710d3563826447193ad1\n   languageName: node\n   linkType: hard\n \n@@ -934,16 +934,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-object-rest-spread@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/plugin-transform-object-rest-spread@npm:7.27.1\"\n+\"@babel/plugin-transform-object-rest-spread@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/plugin-transform-object-rest-spread@npm:7.27.2\"\n   dependencies:\n-    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.2\"\n     \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n+    \"@babel/plugin-transform-destructuring\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-parameters\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ac73caea178b51a64cc1c5e5ce1a67bacf89c1af664ef219aa1403d54258804113d6f267820c211768460e056f3aeb642c98ee14842c4fb548974c82f7dbe7dd\n+  checksum: 10c0/5e255b262dd65c8700078d9f6ed87bd45f951a905dda6b3414be28d7b2781b18e6b812e9d71421e61360c9cf51e1e619c1d48348593bb7399496f61f5f221446\n   languageName: node\n   linkType: hard\n \n@@ -1270,11 +1271,11 @@ __metadata:\n   linkType: hard\n \n \"@babel/preset-env@npm:^7.11.0, @babel/preset-env@npm:^7.12.1, @babel/preset-env@npm:^7.22.4\":\n-  version: 7.27.1\n-  resolution: \"@babel/preset-env@npm:7.27.1\"\n+  version: 7.27.2\n+  resolution: \"@babel/preset-env@npm:7.27.2\"\n   dependencies:\n-    \"@babel/compat-data\": \"npm:^7.27.1\"\n-    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/compat-data\": \"npm:^7.27.2\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.2\"\n     \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n     \"@babel/helper-validator-option\": \"npm:^7.27.1\"\n     \"@babel/plugin-bugfix-firefox-class-in-computed-class-key\": \"npm:^7.27.1\"\n@@ -1316,7 +1317,7 @@ __metadata:\n     \"@babel/plugin-transform-new-target\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-nullish-coalescing-operator\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-numeric-separator\": \"npm:^7.27.1\"\n-    \"@babel/plugin-transform-object-rest-spread\": \"npm:^7.27.1\"\n+    \"@babel/plugin-transform-object-rest-spread\": \"npm:^7.27.2\"\n     \"@babel/plugin-transform-object-super\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-optional-catch-binding\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-optional-chaining\": \"npm:^7.27.1\"\n@@ -1344,7 +1345,7 @@ __metadata:\n     semver: \"npm:^6.3.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/893b269f5e7e2084ee7fb60d3a1f154470c89169475170a8a595f1910cade9c9978b42df5405a46a699529dfdb1c6b0135cc4c0aa8f9e685ae230b1cb0172ad9\n+  checksum: 10c0/fd7ec310832a9ff26ed8d56bc0832cdbdb3a188e022050b74790796650649fb8373568af05b320b58b3ff922507979bad50ff95a4d504ab0081134480103504e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -592,7 +592,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n     orm_adapter (0.5.0)\n     ostruct (0.6.1)\n-    ox (2.14.22)\n+    ox (2.14.23)\n       bigdecimal (>= 3.0)\n     parallel (1.27.0)\n     parser (3.3.8.0)\n---\n\n\n---\n\nChoice D:\npackage.json\n@@ -107,7 +107,7 @@\n     \"react-overlays\": \"^5.2.1\",\n     \"react-redux\": \"^9.0.4\",\n     \"react-redux-loading-bar\": \"^5.0.8\",\n-    \"react-router\": \"^5.3.4\",\n+    \"react-router\": \"^7.0.0\",\n     \"react-router-dom\": \"^5.3.4\",\n     \"react-router-scroll-4\": \"^1.0.0-beta.1\",\n     \"react-select\": \"^5.7.3\",\n---\nyarn.lock\n@@ -2936,7 +2936,7 @@ __metadata:\n     react-overlays: \"npm:^5.2.1\"\n     react-redux: \"npm:^9.0.4\"\n     react-redux-loading-bar: \"npm:^5.0.8\"\n-    react-router: \"npm:^5.3.4\"\n+    react-router: \"npm:^7.0.0\"\n     react-router-dom: \"npm:^5.3.4\"\n     react-router-scroll-4: \"npm:^1.0.0-beta.1\"\n     react-select: \"npm:^5.7.3\"\n@@ -6662,6 +6662,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"cookie@npm:^1.0.1\":\n+  version: 1.0.2\n+  resolution: \"cookie@npm:1.0.2\"\n+  checksum: 10c0/fd25fe79e8fbcfcaf6aa61cd081c55d144eeeba755206c058682257cb38c4bd6795c6620de3f064c740695bb65b7949ebb1db7a95e4636efb8357a335ad3f54b\n+  languageName: node\n+  linkType: hard\n+\n \"copy-descriptor@npm:^0.1.0\":\n   version: 0.1.1\n   resolution: \"copy-descriptor@npm:0.1.1\"\n@@ -14929,7 +14936,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-router@npm:5.3.4, react-router@npm:^5.3.4\":\n+\"react-router@npm:5.3.4\":\n   version: 5.3.4\n   resolution: \"react-router@npm:5.3.4\"\n   dependencies:\n@@ -14948,6 +14955,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"react-router@npm:^7.0.0\":\n+  version: 7.5.2\n+  resolution: \"react-router@npm:7.5.2\"\n+  dependencies:\n+    cookie: \"npm:^1.0.1\"\n+    set-cookie-parser: \"npm:^2.6.0\"\n+    turbo-stream: \"npm:2.4.0\"\n+  peerDependencies:\n+    react: \">=18\"\n+    react-dom: \">=18\"\n+  peerDependenciesMeta:\n+    react-dom:\n+      optional: true\n+  checksum: 10c0/5972ecb783e0ac0512c500b84bd4ff475665ba49c67b69e13b79dc24c7ee0496d523858058bb43c70147367688e0cc0d6d6d0f51cabfdebfbc5556d559bff457\n+  languageName: node\n+  linkType: hard\n+\n \"react-select@npm:^5.7.3\":\n   version: 5.10.1\n   resolution: \"react-select@npm:5.10.1\"\n@@ -15944,6 +15968,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"set-cookie-parser@npm:^2.6.0\":\n+  version: 2.7.1\n+  resolution: \"set-cookie-parser@npm:2.7.1\"\n+  checksum: 10c0/060c198c4c92547ac15988256f445eae523f57f2ceefeccf52d30d75dedf6bff22b9c26f756bd44e8e560d44ff4ab2130b178bd2e52ef5571bf7be3bd7632d9a\n+  languageName: node\n+  linkType: hard\n+\n \"set-function-length@npm:^1.2.2\":\n   version: 1.2.2\n   resolution: \"set-function-length@npm:1.2.2\"\n@@ -17530,6 +17561,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"turbo-stream@npm:2.4.0\":\n+  version: 2.4.0\n+  resolution: \"turbo-stream@npm:2.4.0\"\n+  checksum: 10c0/e68b2569f1f16e6e9633d090c6024b2ae9f0e97bfeacb572451ca3732e120ebbb546f3bc4afc717c46cb57b5aea6104e04ef497f9912eef6a7641e809518e98a\n+  languageName: node\n+  linkType: hard\n+\n \"twemoji-parser@npm:^11.0.2\":\n   version: 11.0.2\n   resolution: \"twemoji-parser@npm:11.0.2\"\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nCloses MAS-430\r\n\r\n### Changes proposed in this PR:\r\n- Pass contextType through to quotes, allowing them to be filtered as long as the filter action is \"Hide with a warning\". Completely hiding filtered posts will be addressed in a follow-up PR.\r\n- No special UI treatment here, the existing filtering from the Status component is used\r\n\r\n### Screenshots\r\n\r\n![image](https://github.com/user-attachments/assets/843ac8b4-b732-415c-baf6-8ecf61701349)\r\n\n\n---\n\nChoice A:\nspec/system/account_notes_spec.rb\n@@ -11,13 +11,13 @@\n   let(:finished_onboarding) { true }\n \n   let!(:other_account) { Fabricate(:account) }\n+  let(:note_text) { 'This is a personal note' }\n \n   before { as_a_logged_in_user }\n \n   it 'can be written and viewed' do\n     visit_profile(other_account)\n \n-    note_text = 'This is a personal note'\n     fill_in frontend_translations('account_note.placeholder'), with: note_text\n \n     # This is a bit awkward since there is no button to save the change\n---\nspec/system/new_statuses_spec.rb\n@@ -9,12 +9,12 @@\n   let(:password)            { 'password' }\n   let(:confirmed_at)        { Time.zone.now }\n   let(:finished_onboarding) { true }\n+  let(:status_text) { 'This is a new status!' }\n \n   before { as_a_logged_in_user }\n \n   it 'can be posted' do\n     visit_homepage\n-    status_text = 'This is a new status!'\n \n     within('.compose-form') do\n       fill_in frontend_translations('compose_form.placeholder'), with: status_text\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -9187,23 +9187,23 @@ __metadata:\n   linkType: hard\n \n \"pino@npm:^9.0.0\":\n-  version: 9.6.0\n-  resolution: \"pino@npm:9.6.0\"\n+  version: 9.7.0\n+  resolution: \"pino@npm:9.7.0\"\n   dependencies:\n     atomic-sleep: \"npm:^1.0.0\"\n     fast-redact: \"npm:^3.1.1\"\n     on-exit-leak-free: \"npm:^2.1.0\"\n     pino-abstract-transport: \"npm:^2.0.0\"\n     pino-std-serializers: \"npm:^7.0.0\"\n-    process-warning: \"npm:^4.0.0\"\n+    process-warning: \"npm:^5.0.0\"\n     quick-format-unescaped: \"npm:^4.0.3\"\n     real-require: \"npm:^0.2.0\"\n     safe-stable-stringify: \"npm:^2.3.1\"\n     sonic-boom: \"npm:^4.0.1\"\n     thread-stream: \"npm:^3.0.0\"\n   bin:\n     pino: bin.js\n-  checksum: 10c0/bcd1e9d9b301bea13b95689ca9ad7105ae9451928fb6c0b67b3e58c5fe37cea1d40665f3d6641e3da00be0bbc17b89031e67abbc8ea6aac6164f399309fd78e7\n+  checksum: 10c0/c7f8a83a9a9d728b4eff6d0f4b9367f031c91bcaa5806fbf0eedcc8e77faba593d59baf11a8fba0dd1c778bb17ca7ed01418ac1df4ec129faeedd4f3ecaff66f\n   languageName: node\n   linkType: hard\n \n@@ -9759,6 +9759,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"process-warning@npm:^5.0.0\":\n+  version: 5.0.0\n+  resolution: \"process-warning@npm:5.0.0\"\n+  checksum: 10c0/941f48863d368ec161e0b5890ba0c6af94170078f3d6b5e915c19b36fb59edb0dc2f8e834d25e0d375a8bf368a49d490f080508842168832b93489d17843ec29\n+  languageName: node\n+  linkType: hard\n+\n \"prom-client@npm:^15.0.0\":\n   version: 15.1.3\n   resolution: \"prom-client@npm:15.1.3\"\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -4860,17 +4860,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"browserslist@npm:^4.24.0, browserslist@npm:^4.24.4, browserslist@npm:^4.24.5\":\n-  version: 4.24.5\n-  resolution: \"browserslist@npm:4.24.5\"\n+\"browserslist@npm:^4.24.0, browserslist@npm:^4.24.4, browserslist@npm:^4.25.0\":\n+  version: 4.25.0\n+  resolution: \"browserslist@npm:4.25.0\"\n   dependencies:\n-    caniuse-lite: \"npm:^1.0.30001716\"\n-    electron-to-chromium: \"npm:^1.5.149\"\n+    caniuse-lite: \"npm:^1.0.30001718\"\n+    electron-to-chromium: \"npm:^1.5.160\"\n     node-releases: \"npm:^2.0.19\"\n     update-browserslist-db: \"npm:^1.1.3\"\n   bin:\n     browserslist: cli.js\n-  checksum: 10c0/f4c1ce1a7d8fdfab5e5b88bb6e93d09e8a883c393f86801537a252da0362dbdcde4dbd97b318246c5d84c6607b2f6b47af732c1b000d6a8a881ee024bad29204\n+  checksum: 10c0/cc16c55b4468b18684a0e1ca303592b38635b1155d6724f172407192737a2f405b8030d87a05813729592793445b3d15e737b0055f901cdecccb29b1e580a1c5\n   languageName: node\n   linkType: hard\n \n@@ -4991,10 +4991,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"caniuse-lite@npm:^1.0.30001702, caniuse-lite@npm:^1.0.30001716\":\n-  version: 1.0.30001718\n-  resolution: \"caniuse-lite@npm:1.0.30001718\"\n-  checksum: 10c0/67f9ad09bc16443e28d14f265d6e468480cd8dc1900d0d8b982222de80c699c4f2306599c3da8a3fa7139f110d4b30d49dbac78f215470f479abb6ffe141d5d3\n+\"caniuse-lite@npm:^1.0.30001702, caniuse-lite@npm:^1.0.30001718\":\n+  version: 1.0.30001721\n+  resolution: \"caniuse-lite@npm:1.0.30001721\"\n+  checksum: 10c0/fa3a8926899824b385279f1f886fe34c5efb1321c9ece1b9df25c8d567a2706db8450cc5b4d969e769e641593e08ea644909324aba93636a43e4949a75f81c4c\n   languageName: node\n   linkType: hard\n \n@@ -5735,10 +5735,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"electron-to-chromium@npm:^1.5.149\":\n-  version: 1.5.159\n-  resolution: \"electron-to-chromium@npm:1.5.159\"\n-  checksum: 10c0/dc5b60a235ad04b1637b3b2af4914ac900c42813b02262a91a41d950223316f7b12de715697cf9c2d9f572f716f9422bf259ee65d86599cd2cc66e92c499ebd1\n+\"electron-to-chromium@npm:^1.5.160\":\n+  version: 1.5.165\n+  resolution: \"electron-to-chromium@npm:1.5.165\"\n+  checksum: 10c0/20b91e67e7a8829a358c4a488e9b59b0e5f8d4cb075a70b9757bb21acf0fc751ca58ca7d9c6018bec74ac4bd42f7859e4ef37421c252a2275f642e12a32271d6\n   languageName: node\n   linkType: hard\n \n@@ -9321,9 +9321,9 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"postcss-custom-properties@npm:^14.0.5\":\n-  version: 14.0.5\n-  resolution: \"postcss-custom-properties@npm:14.0.5\"\n+\"postcss-custom-properties@npm:^14.0.6\":\n+  version: 14.0.6\n+  resolution: \"postcss-custom-properties@npm:14.0.6\"\n   dependencies:\n     \"@csstools/cascade-layer-name-parser\": \"npm:^2.0.5\"\n     \"@csstools/css-parser-algorithms\": \"npm:^3.0.5\"\n@@ -9332,7 +9332,7 @@ __metadata:\n     postcss-value-parser: \"npm:^4.2.0\"\n   peerDependencies:\n     postcss: ^8.4\n-  checksum: 10c0/ddee0545075dc0888cd54a9bb5791a98719a5d4f31d1de33823841efb540fa79f65e48b7c4aaba753d3214102e419536c5bc46c72e6e1579e5352da4e042ef3b\n+  checksum: 10c0/0eeef77bc713551f5cb8fa5982d24da4e854075f3af020f1c94366c47a23a4cc225ebfecc978bdb17f00ee0bdee9d2c784e0d01adc64a447321e408abbe2c83b\n   languageName: node\n   linkType: hard\n \n@@ -9513,8 +9513,8 @@ __metadata:\n   linkType: hard\n \n \"postcss-preset-env@npm:^10.1.5\":\n-  version: 10.2.0\n-  resolution: \"postcss-preset-env@npm:10.2.0\"\n+  version: 10.2.1\n+  resolution: \"postcss-preset-env@npm:10.2.1\"\n   dependencies:\n     \"@csstools/postcss-cascade-layers\": \"npm:^5.0.1\"\n     \"@csstools/postcss-color-function\": \"npm:^4.0.10\"\n@@ -9550,7 +9550,7 @@ __metadata:\n     \"@csstools/postcss-trigonometric-functions\": \"npm:^4.0.9\"\n     \"@csstools/postcss-unset-value\": \"npm:^4.0.0\"\n     autoprefixer: \"npm:^10.4.21\"\n-    browserslist: \"npm:^4.24.5\"\n+    browserslist: \"npm:^4.25.0\"\n     css-blank-pseudo: \"npm:^7.0.1\"\n     css-has-pseudo: \"npm:^7.0.2\"\n     css-prefers-color-scheme: \"npm:^10.0.0\"\n@@ -9561,7 +9561,7 @@ __metadata:\n     postcss-color-hex-alpha: \"npm:^10.0.0\"\n     postcss-color-rebeccapurple: \"npm:^10.0.0\"\n     postcss-custom-media: \"npm:^11.0.6\"\n-    postcss-custom-properties: \"npm:^14.0.5\"\n+    postcss-custom-properties: \"npm:^14.0.6\"\n     postcss-custom-selectors: \"npm:^8.0.5\"\n     postcss-dir-pseudo-class: \"npm:^9.0.1\"\n     postcss-double-position-gradients: \"npm:^6.0.2\"\n@@ -9582,7 +9582,7 @@ __metadata:\n     postcss-selector-not: \"npm:^8.0.1\"\n   peerDependencies:\n     postcss: ^8.4\n-  checksum: 10c0/33406dcdd1d63fd3810f12cd97bf0d6a09a51917943ee7d75e2ccaf1d8cbce363abcb90ee68f14509d287d00de4afd6664dbdecaa4f4b95509e3578e27f54a24\n+  checksum: 10c0/1a78eb86bca8f7c2bf7686ee9ed354b21d1316a7d12ae9aec2ce4b4810f6d32e23d0787d7450e55145f14f76b715df758bb54af0ea6a151858b045bd429f596e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -68,15 +68,15 @@ type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n \n export const QuotedStatus: React.FC<{\n   quote: QuoteMap;\n+  contextType?: string;\n   variant?: 'full' | 'link';\n   nestingLevel?: number;\n-}> = ({ quote, nestingLevel = 1, variant = 'full' }) => {\n+}> = ({ quote, contextType, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n   const state = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n-\n   let quoteError: React.ReactNode = null;\n \n   if (state === 'deleted') {\n@@ -131,10 +131,16 @@ export const QuotedStatus: React.FC<{\n   return (\n     <QuoteWrapper>\n       {/* @ts-expect-error Status is not yet typed */}\n-      <StatusContainer isQuotedPost id={quotedStatusId} avatarSize={40}>\n+      <StatusContainer\n+        isQuotedPost\n+        id={quotedStatusId}\n+        contextType={contextType}\n+        avatarSize={40}\n+      >\n         {canRenderChildQuote && (\n           <QuotedStatus\n             quote={childQuote}\n+            contextType={contextType}\n             variant={\n               nestingLevel === MAX_QUOTE_POSTS_NESTING_LEVEL ? 'link' : 'full'\n             }\n@@ -148,6 +154,7 @@ export const QuotedStatus: React.FC<{\n \n interface StatusQuoteManagerProps {\n   id: string;\n+  contextType?: string;\n   [key: string]: unknown;\n }\n \n@@ -168,7 +175,7 @@ export const StatusQuoteManager = (props: StatusQuoteManagerProps) => {\n   if (quote) {\n     return (\n       <StatusContainer {...props}>\n-        <QuotedStatus quote={quote} />\n+        <QuotedStatus quote={quote} contextType={props.contextType} />\n       </StatusContainer>\n     );\n   }\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [@vitejs/plugin-react](https://redirect.github.com/vitejs/vite-plugin-react/tree/main/packages/plugin-react#readme) ([source](https://redirect.github.com/vitejs/vite-plugin-react/tree/HEAD/packages/plugin-react)) | [`4.4.1` -> `4.5.0`](https://renovatebot.com/diffs/npm/@vitejs%2fplugin-react/4.4.1/4.5.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/@vitejs%2fplugin-react/4.5.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/@vitejs%2fplugin-react/4.5.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/@vitejs%2fplugin-react/4.4.1/4.5.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/@vitejs%2fplugin-react/4.4.1/4.5.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>vitejs/vite-plugin-react (@&#8203;vitejs/plugin-react)</summary>\n\n### [`v4.5.0`](https://redirect.github.com/vitejs/vite-plugin-react/blob/HEAD/packages/plugin-react/CHANGELOG.md#450-2025-05-23)\n\n[Compare Source](https://redirect.github.com/vitejs/vite-plugin-react/compare/57cc39869c319b842dac348b62c882a7bb963f7b...476e705375ef618458918580beb63f43799d12e4)\n\n##### Add `filter` for rolldown-vite [#&#8203;470](https://redirect.github.com/vitejs/vite-plugin-react/pull/470)\n\nAdded `filter` so that it is more performant when running this plugin with rolldown-powered version of Vite.\n\n##### Skip HMR for JSX files with hooks [#&#8203;480](https://redirect.github.com/vitejs/vite-plugin-react/pull/480)\n\nThis removes the HMR warning for hooks with JSX.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xNi4wIiwidXBkYXRlZEluVmVyIjoiNDAuMTYuMCIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwiamF2YXNjcmlwdCJdfQ==-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -160,7 +160,7 @@ GEM\n     cocoon (1.2.15)\n     color_diff (0.1)\n     concurrent-ruby (1.3.5)\n-    connection_pool (2.5.1)\n+    connection_pool (2.5.2)\n     cose (1.3.1)\n       cbor (~> 0.5.9)\n       openssl-signature_algorithm (~> 1.0)\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -2986,6 +2986,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"@rolldown/pluginutils@npm:1.0.0-beta.9\":\n+  version: 1.0.0-beta.9\n+  resolution: \"@rolldown/pluginutils@npm:1.0.0-beta.9\"\n+  checksum: 10c0/21aebb7ebd093282efd96f63ddd465f76746b1d70282366d6ccc7fff6eb4da5c2f8f4bfaaaeb4283c2432600e5609e39e9897864575e593efc11d376ca1a6fa1\n+  languageName: node\n+  linkType: hard\n+\n \"@rollup/plugin-babel@npm:^5.2.0\":\n   version: 5.3.1\n   resolution: \"@rollup/plugin-babel@npm:5.3.1\"\n@@ -4180,17 +4187,18 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.4.1\n-  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n+  version: 4.5.0\n+  resolution: \"@vitejs/plugin-react@npm:4.5.0\"\n   dependencies:\n     \"@babel/core\": \"npm:^7.26.10\"\n     \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n     \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n+    \"@rolldown/pluginutils\": \"npm:1.0.0-beta.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n     react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n     vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n-  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n+  checksum: 10c0/c9f75cde098b9aac62cb512103d7f898a0a173cb78dc9fcf79ca4b3f21a1458cd1955a4383c8c9e3841ce23c5e7f02ed1455e445c9574879b143d40734121fd8\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -13,7 +13,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.225.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -93,21 +93,23 @@ GEM\n     annotaterb (4.14.0)\n     ast (2.4.3)\n     attr_required (1.0.2)\n-    aws-eventstream (1.3.2)\n-    aws-partitions (1.1103.0)\n-    aws-sdk-core (3.215.1)\n+    aws-eventstream (1.4.0)\n+    aws-partitions (1.1110.0)\n+    aws-sdk-core (3.225.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n     aws-sdk-s3 (1.177.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sdk-kms (~> 1)\n       aws-sigv4 (~> 1.5)\n-    aws-sigv4 (1.11.0)\n+    aws-sigv4 (1.12.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n     azure-blob (0.5.8)\n       rexml\n@@ -946,7 +948,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.225.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice D:\n.rubocop_todo.yml\n@@ -33,7 +33,6 @@ Style/FetchEnvVar:\n   Exclude:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/paperclip.rb'\n-    - 'lib/tasks/repo.rake'\n \n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: MinBodyLength, AllowConsecutiveConditionals.\n---\nlib/tasks/repo.rake\n@@ -57,7 +57,7 @@ namespace :repo do\n                 response = nil\n \n                 loop do\n-                  response = HTTP.headers('Authorization' => \"token #{ENV['GITHUB_API_TOKEN']}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n+                  response = HTTP.headers('Authorization' => \"token #{ENV.fetch('GITHUB_API_TOKEN')}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n \n                   if response.code == 403\n                     sleep_for = (response.headers['X-RateLimit-Reset'].to_i - Time.now.to_i).abs\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nI would prefer to just disable this rule, but short of that - it's an easy autofix.\r\n\r\nPrior to this change there are ~50 places throughout app using the shorter `key?(value)` style, and only in this one file do we use the `has_key?(value)` style (in theory the longer one is deprecated and may be dropped at some point, though that claim was somewhat walked back).\n\n---\n\nChoice A:\nGemfile.lock\n@@ -160,7 +160,7 @@ GEM\n     cocoon (1.2.15)\n     color_diff (0.1)\n     concurrent-ruby (1.3.5)\n-    connection_pool (2.5.0)\n+    connection_pool (2.5.1)\n     cose (1.3.1)\n       cbor (~> 0.5.9)\n       openssl-signature_algorithm (~> 1.0)\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/components/counters.tsx\n@@ -43,3 +43,17 @@ export const FollowersCounter = (\n     }}\n   />\n );\n+\n+export const FollowersYouKnowCounter = (\n+  displayNumber: React.ReactNode,\n+  pluralReady: number,\n+) => (\n+  <FormattedMessage\n+    id='account.followers_you_know_counter'\n+    defaultMessage='{counter} you know'\n+    values={{\n+      count: pluralReady,\n+      counter: <strong>{displayNumber}</strong>,\n+    }}\n+  />\n+);\n---\napp/javascript/mastodon/components/hover_card_account.tsx\n@@ -9,11 +9,16 @@ import { fetchAccount } from 'mastodon/actions/accounts';\n import { AccountBio } from 'mastodon/components/account_bio';\n import { AccountFields } from 'mastodon/components/account_fields';\n import { Avatar } from 'mastodon/components/avatar';\n-import { FollowersCounter } from 'mastodon/components/counters';\n+import { AvatarGroup } from 'mastodon/components/avatar_group';\n+import {\n+  FollowersCounter,\n+  FollowersYouKnowCounter,\n+} from 'mastodon/components/counters';\n import { DisplayName } from 'mastodon/components/display_name';\n import { FollowButton } from 'mastodon/components/follow_button';\n import { LoadingIndicator } from 'mastodon/components/loading_indicator';\n import { ShortNumber } from 'mastodon/components/short_number';\n+import { useFetchFamiliarFollowers } from 'mastodon/features/account_timeline/hooks/familiar_followers';\n import { domain } from 'mastodon/initial_state';\n import { useAppSelector, useAppDispatch } from 'mastodon/store';\n \n@@ -38,6 +43,8 @@ export const HoverCardAccount = forwardRef<\n     }\n   }, [dispatch, accountId, account]);\n \n+  const { familiarFollowers } = useFetchFamiliarFollowers({ accountId });\n+\n   return (\n     <div\n       ref={ref}\n@@ -73,11 +80,27 @@ export const HoverCardAccount = forwardRef<\n             )}\n           </div>\n \n-          <div className='hover-card__number'>\n+          <div className='hover-card__numbers'>\n             <ShortNumber\n               value={account.followers_count}\n               renderer={FollowersCounter}\n             />\n+            {familiarFollowers.length > 0 && (\n+              <>\n+                &middot;\n+                <div className='hover-card__familiar-followers'>\n+                  <ShortNumber\n+                    value={familiarFollowers.length}\n+                    renderer={FollowersYouKnowCounter}\n+                  />\n+                  <AvatarGroup compact>\n+                    {familiarFollowers.slice(0, 3).map((account) => (\n+                      <Avatar key={account.id} account={account} size={22} />\n+                    ))}\n+                  </AvatarGroup>\n+                </div>\n+              </>\n+            )}\n           </div>\n \n           <FollowButton accountId={accountId} />\n---\napp/javascript/mastodon/features/account_timeline/components/familiar_followers.tsx\n@@ -1,15 +1,12 @@\n-import { useEffect } from 'react';\n-\n import { FormattedMessage } from 'react-intl';\n \n import { Link } from 'react-router-dom';\n \n-import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n import { Avatar } from '@/mastodon/components/avatar';\n import { AvatarGroup } from '@/mastodon/components/avatar_group';\n import type { Account } from '@/mastodon/models/account';\n-import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n-import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n+\n+import { useFetchFamiliarFollowers } from '../hooks/familiar_followers';\n \n const AccountLink: React.FC<{ account?: Account }> = ({ account }) => {\n   if (!account) {\n@@ -64,20 +61,11 @@ const FamiliarFollowersReadout: React.FC<{ familiarFollowers: Account[] }> = ({\n export const FamiliarFollowers: React.FC<{ accountId: string }> = ({\n   accountId,\n }) => {\n-  const dispatch = useAppDispatch();\n-  const familiarFollowers = useAppSelector((state) =>\n-    getAccountFamiliarFollowers(state, accountId),\n-  );\n-\n-  const hasNoData = familiarFollowers === null;\n-\n-  useEffect(() => {\n-    if (hasNoData) {\n-      void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n-    }\n-  }, [dispatch, accountId, hasNoData]);\n+  const { familiarFollowers, isLoading } = useFetchFamiliarFollowers({\n+    accountId,\n+  });\n \n-  if (hasNoData || familiarFollowers.length === 0) {\n+  if (isLoading || familiarFollowers.length === 0) {\n     return null;\n   }\n \n---\napp/javascript/mastodon/features/account_timeline/hooks/familiar_followers.ts\n@@ -0,0 +1,30 @@\n+import { useEffect } from 'react';\n+\n+import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n+import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n+import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n+import { me } from 'mastodon/initial_state';\n+\n+export const useFetchFamiliarFollowers = ({\n+  accountId,\n+}: {\n+  accountId?: string;\n+}) => {\n+  const dispatch = useAppDispatch();\n+  const familiarFollowers = useAppSelector((state) =>\n+    accountId ? getAccountFamiliarFollowers(state, accountId) : null,\n+  );\n+\n+  const hasNoData = familiarFollowers === null;\n+\n+  useEffect(() => {\n+    if (hasNoData && accountId && accountId !== me) {\n+      void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n+    }\n+  }, [dispatch, accountId, hasNoData]);\n+\n+  return {\n+    familiarFollowers: hasNoData ? [] : familiarFollowers,\n+    isLoading: hasNoData,\n+  };\n+};\n---\napp/javascript/mastodon/locales/en.json\n@@ -42,6 +42,7 @@\n   \"account.followers\": \"Followers\",\n   \"account.followers.empty\": \"No one follows this user yet.\",\n   \"account.followers_counter\": \"{count, plural, one {{counter} follower} other {{counter} followers}}\",\n+  \"account.followers_you_know_counter\": \"{counter} you know\",\n   \"account.following\": \"Following\",\n   \"account.following_counter\": \"{count, plural, one {{counter} following} other {{counter} following}}\",\n   \"account.follows.empty\": \"This user doesn't follow anyone yet.\",\n---\napp/javascript/styles/mastodon/components.scss\n@@ -10705,7 +10705,15 @@ noscript {\n     color: inherit;\n   }\n \n-  &__number {\n+  &__numbers,\n+  &__familiar-followers {\n+    display: flex;\n+    align-items: center;\n+    flex-wrap: wrap;\n+    gap: 10px;\n+  }\n+\n+  &__numbers {\n     font-size: 15px;\n     line-height: 22px;\n     color: $secondary-text-color;\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/compose/components/emoji_picker_dropdown.jsx\n@@ -12,14 +12,10 @@ import Overlay from 'react-overlays/Overlay';\n \n import MoodIcon from '@/material-icons/400-20px/mood.svg?react';\n import { IconButton } from 'mastodon/components/icon_button';\n-import emojiCompressed from 'mastodon/features/emoji/emoji_compressed';\n-import { assetHost } from 'mastodon/utils/config';\n \n import { buildCustomEmojis, categoriesFromEmojis } from '../../emoji/emoji';\n import { EmojiPicker as EmojiPickerAsync } from '../../ui/util/async-components';\n \n-const nimblePickerData = emojiCompressed[5];\n-\n const messages = defineMessages({\n   emoji: { id: 'emoji_button.label', defaultMessage: 'Insert emoji' },\n   emoji_search: { id: 'emoji_button.search', defaultMessage: 'Search...' },\n@@ -40,19 +36,11 @@ let EmojiPicker, Emoji; // load asynchronously\n \n const listenerOptions = supportsPassiveEvents ? { passive: true, capture: true } : true;\n \n-const backgroundImageFn = () => `${assetHost}/emoji/sheet_15_1.png`;\n-\n const notFoundFn = () => (\n   <div className='emoji-mart-no-results'>\n     <Emoji\n-      data={nimblePickerData}\n       emoji='sleuth_or_spy'\n-      set='twitter'\n       size={32}\n-      sheetSize={32}\n-      sheetColumns={62}\n-      sheetRows={62}\n-      backgroundImageFn={backgroundImageFn}\n     />\n \n     <div className='emoji-mart-no-results-label'>\n@@ -110,12 +98,12 @@ class ModifierPickerMenu extends PureComponent {\n \n     return (\n       <div className='emoji-picker-dropdown__modifiers__menu' style={{ display: active ? 'block' : 'none' }} ref={this.setRef}>\n-        <button type='button' onClick={this.handleClick} data-index={1}><Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={1} backgroundImageFn={backgroundImageFn} /></button>\n-        <button type='button' onClick={this.handleClick} data-index={2}><Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={2} backgroundImageFn={backgroundImageFn} /></button>\n-        <button type='button' onClick={this.handleClick} data-index={3}><Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={3} backgroundImageFn={backgroundImageFn} /></button>\n-        <button type='button' onClick={this.handleClick} data-index={4}><Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={4} backgroundImageFn={backgroundImageFn} /></button>\n-        <button type='button' onClick={this.handleClick} data-index={5}><Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={5} backgroundImageFn={backgroundImageFn} /></button>\n-        <button type='button' onClick={this.handleClick} data-index={6}><Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={6} backgroundImageFn={backgroundImageFn} /></button>\n+        <button type='button' onClick={this.handleClick} data-index={1}><Emoji emoji='fist' size={22} skin={1} /></button>\n+        <button type='button' onClick={this.handleClick} data-index={2}><Emoji emoji='fist' size={22} skin={2} /></button>\n+        <button type='button' onClick={this.handleClick} data-index={3}><Emoji emoji='fist' size={22} skin={3} /></button>\n+        <button type='button' onClick={this.handleClick} data-index={4}><Emoji emoji='fist' size={22} skin={4} /></button>\n+        <button type='button' onClick={this.handleClick} data-index={5}><Emoji emoji='fist' size={22} skin={5} /></button>\n+        <button type='button' onClick={this.handleClick} data-index={6}><Emoji emoji='fist' size={22} skin={6} /></button>\n       </div>\n     );\n   }\n@@ -150,7 +138,7 @@ class ModifierPicker extends PureComponent {\n \n     return (\n       <div className='emoji-picker-dropdown__modifiers'>\n-        <Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={modifier} onClick={this.handleClick} backgroundImageFn={backgroundImageFn} />\n+        <Emoji emoji='fist' size={22} skin={modifier} onClick={this.handleClick} />\n         <ModifierPickerMenu active={active} onSelect={this.handleSelect} onClose={this.props.onClose} />\n       </div>\n     );\n@@ -286,16 +274,11 @@ class EmojiPickerMenuImpl extends PureComponent {\n     return (\n       <div className={classNames('emoji-picker-dropdown__menu', { selecting: modifierOpen })} style={style} ref={this.setRef}>\n         <EmojiPicker\n-          data={nimblePickerData}\n-          sheetColumns={62}\n-          sheetRows={62}\n           perLine={8}\n           emojiSize={22}\n-          sheetSize={32}\n           custom={buildCustomEmojis(custom_emojis)}\n           color=''\n           emoji=''\n-          set='twitter'\n           title={title}\n           i18n={this.getI18n()}\n           onClick={this.handleClick}\n@@ -304,7 +287,6 @@ class EmojiPickerMenuImpl extends PureComponent {\n           skin={skinTone}\n           showPreview={false}\n           showSkinTones={false}\n-          backgroundImageFn={backgroundImageFn}\n           notFound={notFoundFn}\n           autoFocus={this.state.readyToFocus}\n           emojiTooltip\n---\napp/javascript/mastodon/features/emoji/emoji_compressed.d.ts\n@@ -45,7 +45,6 @@ type EmojiCompressed = [\n   Category[],\n   Data['aliases'],\n   EmojisWithoutShortCodes,\n-  Data,\n ];\n \n /*\n---\napp/javascript/mastodon/features/emoji/emoji_compressed.js\n@@ -132,6 +132,5 @@ module.exports = JSON.parse(JSON.stringify([\n   emojiMartData.skins,\n   emojiMartData.categories,\n   emojiMartData.aliases,\n-  emojisWithoutShortCodes,\n-  emojiMartData\n+  emojisWithoutShortCodes\n ]));\n---\napp/javascript/mastodon/features/emoji/emoji_picker.js\n@@ -1,7 +0,0 @@\n-import Emoji from 'emoji-mart/dist-es/components/emoji/nimble-emoji';\n-import Picker from 'emoji-mart/dist-es/components/picker/nimble-picker';\n-\n-export {\n-  Picker,\n-  Emoji,\n-};\n---\napp/javascript/mastodon/features/emoji/emoji_picker.tsx\n@@ -0,0 +1,53 @@\n+import type { EmojiProps, PickerProps } from 'emoji-mart';\n+import EmojiRaw from 'emoji-mart/dist-es/components/emoji/nimble-emoji';\n+import PickerRaw from 'emoji-mart/dist-es/components/picker/nimble-picker';\n+\n+import { assetHost } from 'mastodon/utils/config';\n+\n+import EmojiData from './emoji_data.json';\n+\n+const backgroundImageFnDefault = () => `${assetHost}/emoji/sheet_15_1.png`;\n+\n+const Emoji = ({\n+  set = 'twitter',\n+  sheetSize = 32,\n+  sheetColumns = 62,\n+  sheetRows = 62,\n+  backgroundImageFn = backgroundImageFnDefault,\n+  ...props\n+}: EmojiProps) => {\n+  return (\n+    <EmojiRaw\n+      data={EmojiData}\n+      set={set}\n+      sheetSize={sheetSize}\n+      sheetColumns={sheetColumns}\n+      sheetRows={sheetRows}\n+      backgroundImageFn={backgroundImageFn}\n+      {...props}\n+    />\n+  );\n+};\n+\n+const Picker = ({\n+  set = 'twitter',\n+  sheetSize = 32,\n+  sheetColumns = 62,\n+  sheetRows = 62,\n+  backgroundImageFn = backgroundImageFnDefault,\n+  ...props\n+}: PickerProps) => {\n+  return (\n+    <PickerRaw\n+      data={EmojiData}\n+      set={set}\n+      sheetSize={sheetSize}\n+      sheetColumns={sheetColumns}\n+      sheetRows={sheetRows}\n+      backgroundImageFn={backgroundImageFn}\n+      {...props}\n+    />\n+  );\n+};\n+\n+export { Picker, Emoji };\n---\napp/javascript/types/emoji_picker.d.ts\n@@ -0,0 +1,8 @@\n+declare module 'emoji-mart' {\n+  interface PickerProps {\n+    sheetColumns?: number;\n+    sheetRows?: number;\n+  }\n+}\n+\n+export {};\n---\ntsconfig.json\n@@ -5,6 +5,7 @@\n     \"module\": \"CommonJS\",\n     \"moduleResolution\": \"node\",\n     \"allowJs\": true,\n+    \"resolveJsonModule\": true,\n     \"noEmit\": true,\n     \"strict\": true,\n     \"noImplicitReturns\": true,\n---\n\n\n---\n\nChoice D:\n.rubocop_todo.yml\n@@ -70,13 +70,6 @@ Style/OptionalBooleanParameter:\n     - 'app/workers/domain_block_worker.rb'\n     - 'app/workers/unfollow_follow_worker.rb'\n \n-# This cop supports unsafe autocorrection (--autocorrect-all).\n-# Configuration parameters: EnforcedStyle.\n-# SupportedStyles: short, verbose\n-Style/PreferredHashMethods:\n-  Exclude:\n-    - 'config/initializers/paperclip.rb'\n-\n # This cop supports safe autocorrection (--autocorrect).\n Style/RedundantConstantBase:\n   Exclude:\n---\nconfig/initializers/paperclip.rb\n@@ -42,7 +42,7 @@\n   s3_protocol = ENV.fetch('S3_PROTOCOL') { 'https' }\n   s3_hostname = ENV.fetch('S3_HOSTNAME') { \"s3-#{s3_region}.amazonaws.com\" }\n \n-  Paperclip::Attachment.default_options[:path] = ENV.fetch('S3_KEY_PREFIX') + \"/#{PATH}\" if ENV.has_key?('S3_KEY_PREFIX')\n+  Paperclip::Attachment.default_options[:path] = ENV.fetch('S3_KEY_PREFIX') + \"/#{PATH}\" if ENV.key?('S3_KEY_PREFIX')\n \n   Paperclip::Attachment.default_options.merge!(\n     storage: :s3,\n@@ -74,7 +74,7 @@\n \n   Paperclip::Attachment.default_options[:s3_permissions] = ->(*) {} if ENV['S3_PERMISSION'] == ''\n \n-  if ENV.has_key?('S3_ENDPOINT')\n+  if ENV.key?('S3_ENDPOINT')\n     Paperclip::Attachment.default_options[:s3_options].merge!(\n       endpoint: ENV['S3_ENDPOINT'],\n       force_path_style: ENV['S3_OVERRIDE_PATH_STYLE'] != 'true'\n@@ -83,14 +83,14 @@\n     Paperclip::Attachment.default_options[:url] = ':s3_path_url'\n   end\n \n-  if ENV.has_key?('S3_ALIAS_HOST') || ENV.has_key?('S3_CLOUDFRONT_HOST')\n+  if ENV.key?('S3_ALIAS_HOST') || ENV.key?('S3_CLOUDFRONT_HOST')\n     Paperclip::Attachment.default_options.merge!(\n       url: ':s3_alias_url',\n       s3_host_alias: ENV['S3_ALIAS_HOST'] || ENV['S3_CLOUDFRONT_HOST']\n     )\n   end\n \n-  Paperclip::Attachment.default_options[:s3_headers]['X-Amz-Storage-Class'] = ENV['S3_STORAGE_CLASS'] if ENV.has_key?('S3_STORAGE_CLASS')\n+  Paperclip::Attachment.default_options[:s3_headers]['X-Amz-Storage-Class'] = ENV['S3_STORAGE_CLASS'] if ENV.key?('S3_STORAGE_CLASS')\n \n   # Some S3-compatible providers might not actually be compatible with some APIs\n   # used by kt-paperclip, see https://github.com/mastodon/mastodon/issues/16822\n@@ -153,7 +153,7 @@ def copy_to_local_file(style, local_dest_path)\n       container: ENV['AZURE_CONTAINER_NAME'],\n     }\n   )\n-  if ENV.has_key?('AZURE_ALIAS_HOST')\n+  if ENV.key?('AZURE_ALIAS_HOST')\n     Paperclip::Attachment.default_options.merge!(\n       url: ':azure_alias_url',\n       azure_host_alias: ENV['AZURE_ALIAS_HOST']\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\n### Changes proposed in this PR:\r\n- Fixes #34751\r\n- Fixes #34690\r\n  (Unfortunately this now requires the `AvatarGroup` component to know the height of the nested avatars, but such is life.)\r\n- Also fixes another ugly wrapping behaviour within notifications, when there's a long username\r\n- Adds a separation dot `\u00b7` between notification text and timestamp\r\n- Converts `MoreFromAuthor` to TS\r\n\r\n### Screenshots\r\n\r\n\r\n\r\n| Before | After |\r\n|--------|--------|\r\n| ![image](https://github.com/user-attachments/assets/317c4ed1-2660-4010-b115-93c9e7f64e34) | ![image](https://github.com/user-attachments/assets/520fddb9-f74b-4c82-92b5-8fea0e307afe) |\r\n| ![Screenshot 2025-05-22 at 17 06 44](https://github.com/user-attachments/assets/0cde7bf7-5c2e-4908-850a-6afbf2f9b581) | ![Screenshot 2025-05-22 at 17 01 04](https://github.com/user-attachments/assets/856765b6-11b0-42e6-b923-8dc14da45ad9) |\r\n| ![Screenshot 2025-05-22 at 17 30 56](https://github.com/user-attachments/assets/6309e5c9-c54f-4172-ba84-f81c27e06386) | ![Screenshot 2025-05-22 at 17 31 18](https://github.com/user-attachments/assets/040b2855-c723-4ac7-8c1f-71606911a7cf) |\r\n| ![Screenshot 2025-05-22 at 17 16 46](https://github.com/user-attachments/assets/606d8cc5-41a6-480c-9f9c-ce1a12295008) | ![Screenshot 2025-05-22 at 17 16 21](https://github.com/user-attachments/assets/d6aba1b4-3d47-42c9-a88f-0cb584ae0625) | \n\n---\n\nChoice A:\napp/workers/activitypub/fetch_all_replies_worker.rb\n@@ -78,7 +78,7 @@ def get_replies_uri(parent_status)\n   # @param root_status_uri [String]\n   def get_root_replies(root_status_uri, options = {})\n     root_status_body = fetch_resource(root_status_uri, true)\n-    raise RuntimeError(\"FetchAllRepliesWorker - #{@root_status.uri}: Root status could not be fetched\") if root_status_body.nil?\n+    return if root_status_body.nil?\n \n     FetchReplyWorker.perform_async(root_status_uri, { **options, prefetched_body: root_status_body })\n \n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.222.3', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1088.0)\n+    aws-sdk-core (3.222.2)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -931,7 +933,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.222.3)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice C:\napp/chewy/accounts_index.rb\n@@ -19,9 +19,16 @@ class AccountsIndex < Chewy::Index\n         type: 'stemmer',\n         language: 'possessive_english',\n       },\n+\n+      word_joiner: {\n+        type: 'shingle',\n+        output_unigrams: true,\n+        token_separator: '',\n+      },\n     },\n \n     analyzer: {\n+      # \"The FOOING's bar\" becomes \"foo bar\"\n       natural: {\n         tokenizer: 'standard',\n         filter: %w(\n@@ -35,11 +42,20 @@ class AccountsIndex < Chewy::Index\n         ),\n       },\n \n+      # \"FOO bar\" becomes \"foo bar\"\n       verbatim: {\n         tokenizer: 'standard',\n         filter: %w(lowercase asciifolding cjk_width),\n       },\n \n+      # \"Foo bar\" becomes \"foo bar foobar\"\n+      word_join_analyzer: {\n+        type: 'custom',\n+        tokenizer: 'standard',\n+        filter: %w(lowercase asciifolding cjk_width word_joiner),\n+      },\n+\n+      # \"Foo bar\" becomes \"f fo foo b ba bar\"\n       edge_ngram: {\n         tokenizer: 'edge_ngram',\n         filter: %w(lowercase asciifolding cjk_width),\n---\napp/services/account_search_service.rb\n@@ -128,11 +128,37 @@ class FullQueryBuilder < QueryBuilder\n \n     def core_query\n       {\n-        multi_match: {\n-          query: @query,\n-          type: 'best_fields',\n-          fields: %w(username^2 display_name^2 text text.*),\n-          operator: 'and',\n+        dis_max: {\n+          queries: [\n+            {\n+              match: {\n+                username: {\n+                  query: @query,\n+                  analyzer: 'word_join_analyzer',\n+                },\n+              },\n+            },\n+\n+            {\n+              match: {\n+                display_name: {\n+                  query: @query,\n+                  analyzer: 'word_join_analyzer',\n+                },\n+              },\n+            },\n+\n+            {\n+              multi_match: {\n+                query: @query,\n+                type: 'best_fields',\n+                fields: %w(text text.*),\n+                operator: 'and',\n+              },\n+            },\n+          ],\n+\n+          tie_breaker: 0.5,\n         },\n       }\n     end\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/components/avatar_group.tsx\n@@ -7,10 +7,16 @@ import classNames from 'classnames';\n \n export const AvatarGroup: React.FC<{\n   compact?: boolean;\n+  avatarHeight?: number;\n   children: React.ReactNode;\n-}> = ({ children, compact = false }) => (\n+}> = ({ children, compact = false, avatarHeight }) => (\n   <div\n     className={classNames('avatar-group', { 'avatar-group--compact': compact })}\n+    style={\n+      avatarHeight\n+        ? ({ '--avatar-height': `${avatarHeight}px` } as React.CSSProperties)\n+        : undefined\n+    }\n   >\n     {children}\n   </div>\n---\napp/javascript/mastodon/components/more_from_author.jsx\n@@ -1,17 +0,0 @@\n-import PropTypes from 'prop-types';\n-\n-import { FormattedMessage } from 'react-intl';\n-\n-import { IconLogo } from 'mastodon/components/logo';\n-import { AuthorLink } from 'mastodon/features/explore/components/author_link';\n-\n-export const MoreFromAuthor = ({ accountId }) => (\n-  <div className='more-from-author'>\n-    <IconLogo />\n-    <FormattedMessage id='link_preview.more_from_author' defaultMessage='More from {name}' values={{ name: <AuthorLink accountId={accountId} /> }} />\n-  </div>\n-);\n-\n-MoreFromAuthor.propTypes = {\n-  accountId: PropTypes.string.isRequired,\n-};\n---\napp/javascript/mastodon/components/more_from_author.tsx\n@@ -0,0 +1,21 @@\n+import { FormattedMessage } from 'react-intl';\n+\n+import { IconLogo } from 'mastodon/components/logo';\n+import { AuthorLink } from 'mastodon/features/explore/components/author_link';\n+\n+export const MoreFromAuthor: React.FC<{ accountId: string }> = ({\n+  accountId,\n+}) => (\n+  <FormattedMessage\n+    id='link_preview.more_from_author'\n+    defaultMessage='More from {name}'\n+    values={{ name: <AuthorLink accountId={accountId} /> }}\n+  >\n+    {(chunks) => (\n+      <div className='more-from-author'>\n+        <IconLogo />\n+        {chunks}\n+      </div>\n+    )}\n+  </FormattedMessage>\n+);\n---\napp/javascript/mastodon/features/notifications_v2/components/notification_group_with_status.tsx\n@@ -18,12 +18,14 @@ import { useAppSelector, useAppDispatch } from 'mastodon/store';\n import { DisplayedName } from './displayed_name';\n import { EmbeddedStatus } from './embedded_status';\n \n+const AVATAR_SIZE = 28;\n+\n export const AvatarById: React.FC<{ accountId: string }> = ({ accountId }) => {\n   const account = useAppSelector((state) => state.accounts.get(accountId));\n \n   if (!account) return null;\n \n-  return <Avatar withLink account={account} size={28} />;\n+  return <Avatar withLink account={account} size={AVATAR_SIZE} />;\n };\n \n export type LabelRenderer = (\n@@ -108,7 +110,7 @@ export const NotificationGroupWithStatus: React.FC<{\n         <div className='notification-group__main'>\n           <div className='notification-group__main__header'>\n             <div className='notification-group__main__header__wrapper'>\n-              <AvatarGroup>\n+              <AvatarGroup avatarHeight={AVATAR_SIZE}>\n                 {accountIds\n                   .slice(0, NOTIFICATIONS_GROUP_MAX_AVATARS)\n                   .map((id) => (\n@@ -123,7 +125,14 @@ export const NotificationGroupWithStatus: React.FC<{\n \n             <div className='notification-group__main__header__label'>\n               {label}\n-              {timestamp && <RelativeTimestamp timestamp={timestamp} />}\n+              {timestamp && (\n+                <>\n+                  <span className='notification-group__main__header__label-separator'>\n+                    &middot;\n+                  </span>\n+                  <RelativeTimestamp timestamp={timestamp} />\n+                </>\n+              )}\n             </div>\n           </div>\n \n---\napp/javascript/styles/mastodon/components.scss\n@@ -2249,14 +2249,18 @@ a .account__avatar {\n \n .avatar-group {\n   display: flex;\n-  gap: 8px;\n-  flex-wrap: wrap;\n+\n+  --avatar-height: 28px;\n+\n+  &:not(.avatar-group--compact) {\n+    gap: 8px;\n+    flex-wrap: wrap;\n+    height: var(--avatar-height);\n+    overflow-y: clip;\n+  }\n }\n \n .avatar-group--compact {\n-  gap: 0;\n-  flex-wrap: nowrap;\n-\n   & > :not(:first-child) {\n     margin-inline-start: -12px;\n   }\n@@ -10408,7 +10412,8 @@ noscript {\n   padding: 15px;\n   display: flex;\n   align-items: center;\n-  gap: 8px;\n+  flex-wrap: wrap;\n+  gap: 4px 8px;\n \n   .logo {\n     width: 16px;\n@@ -10502,12 +10507,6 @@ noscript {\n     overflow: hidden;\n     container-type: inline-size;\n \n-    @container (width < 350px) {\n-      &__header time {\n-        display: none;\n-      }\n-    }\n-\n     &__header {\n       display: flex;\n       flex-direction: column;\n@@ -10520,7 +10519,8 @@ noscript {\n \n       &__label {\n         display: flex;\n-        gap: 8px;\n+        flex-wrap: wrap;\n+        gap: 2px 8px;\n         font-size: 15px;\n         line-height: 22px;\n         color: $darker-text-color;\n@@ -10538,6 +10538,13 @@ noscript {\n         time {\n           color: $dark-text-color;\n         }\n+\n+        @container (width < 350px) {\n+          time,\n+          &-separator {\n+            display: none;\n+          }\n+        }\n       }\n     }\n \n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nIn the Web UI and the main client, we skip displaying link previews when a media attachment is provided.\r\n\r\nHowever, I noticed we were still creating the attachment, which is unnecessary, and may lead to inconsistencies between clients.\n\n---\n\nChoice A:\napp/services/fetch_link_card_service.rb\n@@ -19,7 +19,7 @@ def call(status)\n     @status       = status\n     @original_url = parse_urls\n \n-    return if @original_url.nil? || @status.with_preview_card?\n+    return if @original_url.nil? || @status.with_preview_card? || @status.with_media? || @status.quote.present?\n \n     @url = @original_url.to_s\n \n---\n\n\n---\n\nChoice B:\napp/helpers/context_helper.rb\n@@ -25,6 +25,7 @@ module ContextHelper\n     voters_count: { 'toot' => 'http://joinmastodon.org/ns#', 'votersCount' => 'toot:votersCount' },\n     suspended: { 'toot' => 'http://joinmastodon.org/ns#', 'suspended' => 'toot:suspended' },\n     attribution_domains: { 'toot' => 'http://joinmastodon.org/ns#', 'attributionDomains' => { '@id' => 'toot:attributionDomains', '@type' => '@id' } },\n+    quote_requests: { 'QuoteRequest' => 'https://w3id.org/fep/044f#QuoteRequest' },\n   }.freeze\n \n   def full_context\n---\napp/lib/activitypub/activity.rb\n@@ -57,6 +57,8 @@ def klass\n         ActivityPub::Activity::Remove\n       when 'Move'\n         ActivityPub::Activity::Move\n+      when 'QuoteRequest'\n+        ActivityPub::Activity::QuoteRequest\n       end\n     end\n   end\n---\napp/lib/activitypub/activity/quote_request.rb\n@@ -0,0 +1,30 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::Activity::QuoteRequest < ActivityPub::Activity\n+  include Payloadable\n+\n+  def perform\n+    return unless Mastodon::Feature.inbound_quotes_enabled?\n+    return if non_matching_uri_hosts?(@account.uri, @json['id'])\n+\n+    quoted_status = status_from_uri(object_uri)\n+    return if quoted_status.nil? || !quoted_status.account.local? || !quoted_status.distributable?\n+\n+    # For now, we don't support being quoted by external servers\n+    reject_quote_request!(quoted_status)\n+  end\n+\n+  private\n+\n+  def reject_quote_request!(quoted_status)\n+    quote = Quote.new(\n+      quoted_status: quoted_status,\n+      quoted_account: quoted_status.account,\n+      status: Status.new(account: @account, uri: @json['instrument']),\n+      account: @account,\n+      activity_uri: @json['id']\n+    )\n+    json = Oj.dump(serialize_payload(quote, ActivityPub::RejectQuoteRequestSerializer))\n+    ActivityPub::DeliveryWorker.perform_async(json, quoted_status.account_id, @account.inbox_url)\n+  end\n+end\n---\napp/serializers/activitypub/quote_request_serializer.rb\n@@ -0,0 +1,28 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::QuoteRequestSerializer < ActivityPub::Serializer\n+  context_extensions :quote_requests\n+\n+  attributes :id, :type, :actor, :instrument\n+  attribute :virtual_object, key: :object\n+\n+  def id\n+    object.activity_uri || [ActivityPub::TagManager.instance.uri_for(object.target_account), '#quote_requests/', object.id].join\n+  end\n+\n+  def type\n+    'QuoteRequest'\n+  end\n+\n+  def actor\n+    ActivityPub::TagManager.instance.uri_for(object.account)\n+  end\n+\n+  def virtual_object\n+    ActivityPub::TagManager.instance.uri_for(object.quoted_status)\n+  end\n+\n+  def instrument\n+    ActivityPub::TagManager.instance.uri_for(object.status)\n+  end\n+end\n---\napp/serializers/activitypub/reject_quote_request_serializer.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::RejectQuoteRequestSerializer < ActivityPub::Serializer\n+  attributes :id, :type, :actor\n+\n+  has_one :object, serializer: ActivityPub::QuoteRequestSerializer\n+\n+  def id\n+    [ActivityPub::TagManager.instance.uri_for(object.quoted_account), '#rejects/quote_requests/', object.id].join\n+  end\n+\n+  def type\n+    'Reject'\n+  end\n+\n+  def actor\n+    ActivityPub::TagManager.instance.uri_for(object.quoted_account)\n+  end\n+end\n---\nspec/lib/activitypub/activity/quote_request_spec.rb\n@@ -0,0 +1,51 @@\n+# frozen_string_literal: true\n+\n+require 'rails_helper'\n+\n+RSpec.describe ActivityPub::Activity::QuoteRequest, feature: :inbound_quotes do\n+  let(:sender)    { Fabricate(:account, domain: 'example.com') }\n+  let(:recipient) { Fabricate(:account) }\n+  let(:quoted_post) { Fabricate(:status, account: recipient) }\n+  let(:request_uri) { 'https://example.com/missing-ui' }\n+  let(:quoted_uri) { ActivityPub::TagManager.instance.uri_for(quoted_post) }\n+\n+  let(:json) do\n+    {\n+      '@context': [\n+        'https://www.w3.org/ns/activitystreams',\n+        {\n+          QuoteRequest: 'https://w3id.org/fep/044f#QuoteRequest',\n+        },\n+      ],\n+      id: request_uri,\n+      type: 'QuoteRequest',\n+      actor: ActivityPub::TagManager.instance.uri_for(sender),\n+      object: quoted_uri,\n+      instrument: 'https://example.com/unknown-status',\n+    }.with_indifferent_access\n+  end\n+\n+  describe '#perform' do\n+    subject { described_class.new(json, sender) }\n+\n+    context 'when trying to quote an unknown status' do\n+      let(:quoted_uri) { 'https://example.com/statuses/1234' }\n+\n+      it 'does not send anything' do\n+        expect { subject.perform }\n+          .to_not enqueue_sidekiq_job(ActivityPub::DeliveryWorker)\n+      end\n+    end\n+\n+    context 'when trying to quote an unquotable local status' do\n+      it 'sends a Reject activity' do\n+        expect { subject.perform }\n+          .to enqueue_sidekiq_job(ActivityPub::DeliveryWorker)\n+          .with(satisfying do |body|\n+            outgoing_json = Oj.load(body)\n+            outgoing_json['type'] == 'Reject' && %w(type id actor object instrument).all? { |key| json[key] == outgoing_json['object'][key] }\n+          end, recipient.id, sender.inbox_url)\n+      end\n+    end\n+  end\n+end\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -62,7 +62,7 @@ gem 'inline_svg'\n gem 'irb', '~> 1.8'\n gem 'kaminari', '~> 1.2'\n gem 'link_header', '~> 0.0'\n-gem 'linzer', '~> 0.6.1'\n+gem 'linzer', '~> 0.7.0'\n gem 'mario-redis-lock', '~> 1.2', require: 'redis_lock'\n gem 'mime-types', '~> 3.7.0', require: 'mime/types/columnar'\n gem 'mutex_m'\n---\nGemfile.lock\n@@ -148,6 +148,7 @@ GEM\n     case_transform (0.2)\n       activesupport\n     cbor (0.5.9.8)\n+    cgi (0.4.2)\n     charlock_holmes (0.7.9)\n     chewy (7.6.0)\n       activesupport (>= 5.2)\n@@ -262,6 +263,7 @@ GEM\n       fog-core (~> 2.1)\n       fog-json (>= 1.0)\n     formatador (1.1.0)\n+    forwardable (1.3.3)\n     fugit (1.11.1)\n       et-orbi (~> 1, >= 1.2.11)\n       raabro (~> 1.4)\n@@ -396,7 +398,11 @@ GEM\n       rexml\n     link_header (0.0.8)\n     lint_roller (1.1.0)\n-    linzer (0.6.5)\n+    linzer (0.7.0)\n+      cgi (~> 0.4.2)\n+      forwardable (~> 1.3, >= 1.3.3)\n+      logger (~> 1.7, >= 1.7.0)\n+      net-http (~> 0.6.0)\n       openssl (~> 3.0, >= 3.0.0)\n       rack (>= 2.2, < 4.0)\n       starry (~> 0.2)\n@@ -628,7 +634,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -995,7 +1001,7 @@ DEPENDENCIES\n   letter_opener (~> 1.8)\n   letter_opener_web (~> 3.0)\n   link_header (~> 0.0)\n-  linzer (~> 0.6.1)\n+  linzer (~> 0.7.0)\n   lograge (~> 0.12)\n   mail (~> 2.8)\n   mario-redis-lock (~> 1.2)\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -212,7 +212,7 @@ group :development, :test do\n   gem 'test-prof', require: false\n \n   # RSpec runner for rails\n-  gem 'rspec-rails', '~> 7.0'\n+  gem 'rspec-rails', '~> 8.0'\n end\n \n group :production do\n---\nGemfile.lock\n@@ -435,7 +435,7 @@ GEM\n     mutex_m (0.3.0)\n     net-http (0.6.0)\n       uri\n-    net-imap (0.5.6)\n+    net-imap (0.5.8)\n       date\n       net-protocol\n     net-ldap (0.19.0)\n@@ -721,18 +721,18 @@ GEM\n       rspec-mocks (~> 3.13.0)\n     rspec-core (3.13.3)\n       rspec-support (~> 3.13.0)\n-    rspec-expectations (3.13.3)\n+    rspec-expectations (3.13.4)\n       diff-lcs (>= 1.2.0, < 2.0)\n       rspec-support (~> 3.13.0)\n     rspec-github (3.0.0)\n       rspec-core (~> 3.0)\n-    rspec-mocks (3.13.2)\n+    rspec-mocks (3.13.3)\n       diff-lcs (>= 1.2.0, < 2.0)\n       rspec-support (~> 3.13.0)\n-    rspec-rails (7.1.1)\n-      actionpack (>= 7.0)\n-      activesupport (>= 7.0)\n-      railties (>= 7.0)\n+    rspec-rails (8.0.0)\n+      actionpack (>= 7.2)\n+      activesupport (>= 7.2)\n+      railties (>= 7.2)\n       rspec-core (~> 3.13)\n       rspec-expectations (~> 3.13)\n       rspec-mocks (~> 3.13)\n@@ -742,7 +742,7 @@ GEM\n       rspec-expectations (~> 3.0)\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n-    rspec-support (3.13.2)\n+    rspec-support (3.13.3)\n     rubocop (1.75.4)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n@@ -842,7 +842,7 @@ GEM\n       base64\n     stoplight (4.1.1)\n       redlock (~> 1.0)\n-    stringio (3.1.6)\n+    stringio (3.1.7)\n     strong_migrations (2.3.0)\n       activerecord (>= 7)\n     swd (2.0.3)\n@@ -1045,7 +1045,7 @@ DEPENDENCIES\n   redis-namespace (~> 1.10)\n   rqrcode (~> 3.0)\n   rspec-github (~> 3.0)\n-  rspec-rails (~> 7.0)\n+  rspec-rails (~> 8.0)\n   rspec-sidekiq (~> 5.0)\n   rubocop\n   rubocop-capybara\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes MAS-422\r\nFixes #34688\r\n\r\n### Changes proposed in this PR:\r\n- Adds a new counter of known accounts to the account hover card\r\n- Adds new `useFetchFamiliarFollowers` hook that wraps the data fetching and Redux plumbing around fetching familiar followes\r\n\r\n### Screenshots\r\n\r\n![image](https://github.com/user-attachments/assets/7d5d3789-2d3d-41f0-bff4-5a7bf8f4d5ce)\r\n\r\n![image](https://github.com/user-attachments/assets/25ec96e6-db40-4244-8c2f-56c279b19a7d)\r\n\r\n![image](https://github.com/user-attachments/assets/bc005a9e-3000-4048-b3f8-f54d6c0977c3)\r\n\n\n---\n\nChoice A:\napp/javascript/mastodon/components/counters.tsx\n@@ -43,3 +43,17 @@ export const FollowersCounter = (\n     }}\n   />\n );\n+\n+export const FollowersYouKnowCounter = (\n+  displayNumber: React.ReactNode,\n+  pluralReady: number,\n+) => (\n+  <FormattedMessage\n+    id='account.followers_you_know_counter'\n+    defaultMessage='{counter} you know'\n+    values={{\n+      count: pluralReady,\n+      counter: <strong>{displayNumber}</strong>,\n+    }}\n+  />\n+);\n---\napp/javascript/mastodon/components/hover_card_account.tsx\n@@ -9,11 +9,16 @@ import { fetchAccount } from 'mastodon/actions/accounts';\n import { AccountBio } from 'mastodon/components/account_bio';\n import { AccountFields } from 'mastodon/components/account_fields';\n import { Avatar } from 'mastodon/components/avatar';\n-import { FollowersCounter } from 'mastodon/components/counters';\n+import { AvatarGroup } from 'mastodon/components/avatar_group';\n+import {\n+  FollowersCounter,\n+  FollowersYouKnowCounter,\n+} from 'mastodon/components/counters';\n import { DisplayName } from 'mastodon/components/display_name';\n import { FollowButton } from 'mastodon/components/follow_button';\n import { LoadingIndicator } from 'mastodon/components/loading_indicator';\n import { ShortNumber } from 'mastodon/components/short_number';\n+import { useFetchFamiliarFollowers } from 'mastodon/features/account_timeline/hooks/familiar_followers';\n import { domain } from 'mastodon/initial_state';\n import { useAppSelector, useAppDispatch } from 'mastodon/store';\n \n@@ -38,6 +43,8 @@ export const HoverCardAccount = forwardRef<\n     }\n   }, [dispatch, accountId, account]);\n \n+  const { familiarFollowers } = useFetchFamiliarFollowers({ accountId });\n+\n   return (\n     <div\n       ref={ref}\n@@ -73,11 +80,27 @@ export const HoverCardAccount = forwardRef<\n             )}\n           </div>\n \n-          <div className='hover-card__number'>\n+          <div className='hover-card__numbers'>\n             <ShortNumber\n               value={account.followers_count}\n               renderer={FollowersCounter}\n             />\n+            {familiarFollowers.length > 0 && (\n+              <>\n+                &middot;\n+                <div className='hover-card__familiar-followers'>\n+                  <ShortNumber\n+                    value={familiarFollowers.length}\n+                    renderer={FollowersYouKnowCounter}\n+                  />\n+                  <AvatarGroup compact>\n+                    {familiarFollowers.slice(0, 3).map((account) => (\n+                      <Avatar key={account.id} account={account} size={22} />\n+                    ))}\n+                  </AvatarGroup>\n+                </div>\n+              </>\n+            )}\n           </div>\n \n           <FollowButton accountId={accountId} />\n---\napp/javascript/mastodon/features/account_timeline/components/familiar_followers.tsx\n@@ -1,15 +1,12 @@\n-import { useEffect } from 'react';\n-\n import { FormattedMessage } from 'react-intl';\n \n import { Link } from 'react-router-dom';\n \n-import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n import { Avatar } from '@/mastodon/components/avatar';\n import { AvatarGroup } from '@/mastodon/components/avatar_group';\n import type { Account } from '@/mastodon/models/account';\n-import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n-import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n+\n+import { useFetchFamiliarFollowers } from '../hooks/familiar_followers';\n \n const AccountLink: React.FC<{ account?: Account }> = ({ account }) => {\n   if (!account) {\n@@ -64,20 +61,11 @@ const FamiliarFollowersReadout: React.FC<{ familiarFollowers: Account[] }> = ({\n export const FamiliarFollowers: React.FC<{ accountId: string }> = ({\n   accountId,\n }) => {\n-  const dispatch = useAppDispatch();\n-  const familiarFollowers = useAppSelector((state) =>\n-    getAccountFamiliarFollowers(state, accountId),\n-  );\n-\n-  const hasNoData = familiarFollowers === null;\n-\n-  useEffect(() => {\n-    if (hasNoData) {\n-      void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n-    }\n-  }, [dispatch, accountId, hasNoData]);\n+  const { familiarFollowers, isLoading } = useFetchFamiliarFollowers({\n+    accountId,\n+  });\n \n-  if (hasNoData || familiarFollowers.length === 0) {\n+  if (isLoading || familiarFollowers.length === 0) {\n     return null;\n   }\n \n---\napp/javascript/mastodon/features/account_timeline/hooks/familiar_followers.ts\n@@ -0,0 +1,30 @@\n+import { useEffect } from 'react';\n+\n+import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n+import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n+import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n+import { me } from 'mastodon/initial_state';\n+\n+export const useFetchFamiliarFollowers = ({\n+  accountId,\n+}: {\n+  accountId?: string;\n+}) => {\n+  const dispatch = useAppDispatch();\n+  const familiarFollowers = useAppSelector((state) =>\n+    accountId ? getAccountFamiliarFollowers(state, accountId) : null,\n+  );\n+\n+  const hasNoData = familiarFollowers === null;\n+\n+  useEffect(() => {\n+    if (hasNoData && accountId && accountId !== me) {\n+      void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n+    }\n+  }, [dispatch, accountId, hasNoData]);\n+\n+  return {\n+    familiarFollowers: hasNoData ? [] : familiarFollowers,\n+    isLoading: hasNoData,\n+  };\n+};\n---\napp/javascript/mastodon/locales/en.json\n@@ -42,6 +42,7 @@\n   \"account.followers\": \"Followers\",\n   \"account.followers.empty\": \"No one follows this user yet.\",\n   \"account.followers_counter\": \"{count, plural, one {{counter} follower} other {{counter} followers}}\",\n+  \"account.followers_you_know_counter\": \"{counter} you know\",\n   \"account.following\": \"Following\",\n   \"account.following_counter\": \"{count, plural, one {{counter} following} other {{counter} following}}\",\n   \"account.follows.empty\": \"This user doesn't follow anyone yet.\",\n---\napp/javascript/styles/mastodon/components.scss\n@@ -10705,7 +10705,15 @@ noscript {\n     color: inherit;\n   }\n \n-  &__number {\n+  &__numbers,\n+  &__familiar-followers {\n+    display: flex;\n+    align-items: center;\n+    flex-wrap: wrap;\n+    gap: 10px;\n+  }\n+\n+  &__numbers {\n     font-size: 15px;\n     line-height: 22px;\n     color: $secondary-text-color;\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n-  version: 2.8.1\n-  resolution: \"pg-connection-string@npm:2.8.1\"\n-  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n+  version: 2.8.5\n+  resolution: \"pg-connection-string@npm:2.8.5\"\n+  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\napp/controllers/api/base_controller.rb\n@@ -50,6 +50,10 @@ def current_user\n     nil\n   end\n \n+  def require_client_credentials!\n+    render json: { error: 'This method requires an client credentials authentication' }, status: 403 if doorkeeper_token.resource_owner_id.present?\n+  end\n+\n   def require_authenticated_user!\n     render json: { error: 'This method requires an authenticated user' }, status: 401 unless current_user\n   end\n---\napp/controllers/api/v1/accounts_controller.rb\n@@ -10,6 +10,7 @@ class Api::V1::AccountsController < Api::BaseController\n   before_action -> { doorkeeper_authorize! :write, :'write:accounts' }, only: [:create]\n \n   before_action :require_user!, except: [:index, :show, :create]\n+  before_action :require_client_credentials!, only: [:create]\n   before_action :set_account, except: [:index, :create]\n   before_action :set_accounts, only: [:index]\n   before_action :check_account_approval, except: [:index, :create]\n---\nspec/fabricators/client_credentials_token_fabricator.rb\n@@ -0,0 +1,5 @@\n+# frozen_string_literal: true\n+\n+Fabricator :client_credentials_token, from: :accessible_access_token do\n+  resource_owner_id { nil }\n+end\n---\nspec/requests/api/v1/accounts_spec.rb\n@@ -78,10 +78,27 @@\n     end\n \n     let(:client_app) { Fabricate(:application) }\n-    let(:token) { Doorkeeper::AccessToken.find_or_create_for(application: client_app, resource_owner: nil, scopes: 'read write', use_refresh_token: false) }\n+    let(:token) { Fabricate(:client_credentials_token, application: client_app, scopes: 'read write') }\n     let(:agreement) { nil }\n     let(:date_of_birth) { nil }\n \n+    context 'when not using client credentials token' do\n+      let(:token) { Fabricate(:accessible_access_token, application: client_app, scopes: 'read write', resource_owner_id: user.id) }\n+\n+      it 'returns http forbidden error' do\n+        subject\n+\n+        expect(response).to have_http_status(403)\n+        expect(response.content_type)\n+          .to start_with('application/json')\n+\n+        expect(response.parsed_body)\n+          .to include(\n+            error: 'This method requires an client credentials authentication'\n+          )\n+      end\n+    end\n+\n     context 'when age verification is enabled' do\n       before do\n         Setting.min_age = 16\n---\n\n\n---\n\nChoice D:\nlib/premailer_bundled_asset_strategy.rb\n@@ -15,7 +15,9 @@ def load(url)\n         headers\n       ).presence\n     else\n-      path = Rails.public_path.join(url.delete_prefix('/'))\n+      url = url.delete_prefix(Rails.configuration.action_controller.asset_host) if Rails.configuration.action_controller.asset_host.present?\n+      url = url.delete_prefix('/')\n+      path = Rails.public_path.join(url)\n       return unless path.exist?\n \n       path.read\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis omited the tag entirely from the HTML without causing an error\n\nIntroduced in #34758\n\n---\n\nChoice A:\nGemfile\n@@ -110,7 +110,7 @@ group :opentelemetry do\n   gem 'opentelemetry-instrumentation-active_model_serializers', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-concurrent_ruby', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-excon', '~> 0.23.0', require: false\n-  gem 'opentelemetry-instrumentation-faraday', '~> 0.26.0', require: false\n+  gem 'opentelemetry-instrumentation-faraday', '~> 0.27.0', require: false\n   gem 'opentelemetry-instrumentation-http', '~> 0.24.0', require: false\n   gem 'opentelemetry-instrumentation-http_client', '~> 0.23.0', require: false\n   gem 'opentelemetry-instrumentation-net_http', '~> 0.23.0', require: false\n---\nGemfile.lock\n@@ -544,7 +544,7 @@ GEM\n     opentelemetry-instrumentation-excon (0.23.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-faraday (0.26.0)\n+    opentelemetry-instrumentation-faraday (0.27.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n     opentelemetry-instrumentation-http (0.24.0)\n@@ -1026,7 +1026,7 @@ DEPENDENCIES\n   opentelemetry-instrumentation-active_model_serializers (~> 0.22.0)\n   opentelemetry-instrumentation-concurrent_ruby (~> 0.22.0)\n   opentelemetry-instrumentation-excon (~> 0.23.0)\n-  opentelemetry-instrumentation-faraday (~> 0.26.0)\n+  opentelemetry-instrumentation-faraday (~> 0.27.0)\n   opentelemetry-instrumentation-http (~> 0.24.0)\n   opentelemetry-instrumentation-http_client (~> 0.23.0)\n   opentelemetry-instrumentation-net_http (~> 0.23.0)\n---\n\n\n---\n\nChoice B:\n.rubocop_todo.yml\n@@ -35,7 +35,6 @@ Rails/OutputSafety:\n # Configuration parameters: AllowedVars.\n Style/FetchEnvVar:\n   Exclude:\n-    - 'config/environments/production.rb'\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/3_omniauth.rb'\n     - 'config/initializers/cache_buster.rb'\n---\nconfig/environments/production.rb\n@@ -113,7 +113,7 @@\n   enable_starttls = nil\n   enable_starttls_auto = nil\n \n-  case ENV['SMTP_ENABLE_STARTTLS']\n+  case ENV.fetch('SMTP_ENABLE_STARTTLS', nil)\n   when 'always'\n     enable_starttls = true\n   when 'never'\n@@ -125,14 +125,14 @@\n   end\n \n   config.action_mailer.smtp_settings = {\n-    port: ENV['SMTP_PORT'],\n-    address: ENV['SMTP_SERVER'],\n+    port: ENV.fetch('SMTP_PORT', nil),\n+    address: ENV.fetch('SMTP_SERVER', nil),\n     user_name: ENV['SMTP_LOGIN'].presence,\n     password: ENV['SMTP_PASSWORD'].presence,\n-    domain: ENV['SMTP_DOMAIN'] || ENV['LOCAL_DOMAIN'],\n+    domain: ENV['SMTP_DOMAIN'] || ENV.fetch('LOCAL_DOMAIN', nil),\n     authentication: ENV['SMTP_AUTH_METHOD'] == 'none' ? nil : ENV['SMTP_AUTH_METHOD'] || :plain,\n     ca_file: ENV['SMTP_CA_FILE'].presence || '/etc/ssl/certs/ca-certificates.crt',\n-    openssl_verify_mode: ENV['SMTP_OPENSSL_VERIFY_MODE'],\n+    openssl_verify_mode: ENV.fetch('SMTP_OPENSSL_VERIFY_MODE', nil),\n     enable_starttls: enable_starttls,\n     enable_starttls_auto: enable_starttls_auto,\n     tls: ENV['SMTP_TLS'].presence && ENV['SMTP_TLS'] == 'true',\n---\n\n\n---\n\nChoice C:\napp/views/layouts/application.html.haml\n@@ -28,7 +28,7 @@\n     = theme_style_tags current_theme\n     = vite_client_tag\n     = vite_react_refresh_tag\n-    = vite_polyfill_tag crossorigin: 'anonymous'\n+    = vite_polyfills_tag\n     -# Needed for the wicg-inert polyfill. It needs to be on it's own <style> tag, with this `id`\n     = vite_stylesheet_tag 'styles/entrypoints/inert.scss', media: 'all', id: 'inert-style'\n     = vite_typescript_tag 'common.ts', crossorigin: 'anonymous'\n---\napp/views/layouts/embedded.html.haml\n@@ -13,7 +13,7 @@\n \n     = vite_client_tag\n     = vite_react_refresh_tag\n-    = vite_polyfill_tag crossorigin: 'anonymous'\n+    = vite_polyfills_tag\n     = theme_style_tags 'mastodon-light'\n     = vite_preload_file_tag \"mastodon/locales/#{I18n.locale}.json\"\n     = render_initial_state\n---\napp/views/layouts/error.html.haml\n@@ -7,7 +7,7 @@\n     %meta{ content: 'width=device-width,initial-scale=1', name: 'viewport' }/\n     = vite_client_tag\n     = vite_react_refresh_tag\n-    = vite_polyfill_tag crossorigin: 'anonymous'\n+    = vite_polyfills_tag\n     = theme_style_tags Setting.default_settings['theme']\n     = vite_typescript_tag 'error.ts', crossorigin: 'anonymous'\n   %body.error\n---\nlib/vite_ruby/sri_extensions.rb\n@@ -120,10 +120,12 @@ def vite_preload_file_tag(name,\n     # Ignore this error, it is not critical if the file is not preloaded\n   end\n \n-  def vite_polyfill_tag(**)\n-    entry = vite_manifest.path_and_integrity_for('polyfill', type: :virtual)\n+  def vite_polyfills_tag(crossorigin: 'anonymous', **)\n+    return if ViteRuby.instance.dev_server_running?\n \n-    javascript_include_tag(type: 'module', src: entry[:path], integrity: entry[:integrity], **)\n+    entry = vite_manifest.path_and_integrity_for('polyfills', type: :virtual)\n+\n+    javascript_include_tag(entry[:path], type: 'module', integrity: entry[:integrity], crossorigin: crossorigin, **)\n   end\n end\n \n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/video/components/hotkey_indicator.tsx\n@@ -24,7 +24,9 @@ export const HotkeyIndicator: React.FC<{\n     enter: [{ opacity: 1 }],\n     leave: [{ opacity: 0 }],\n     onRest: (_result, _ctrl, item) => {\n-      onDismiss(item);\n+      if (item) {\n+        onDismiss(item);\n+      }\n     },\n   });\n \n---\npackage.json\n@@ -44,7 +44,7 @@\n     \"@github/webauthn-json\": \"^2.1.1\",\n     \"@optimize-lodash/rollup-plugin\": \"^5.0.2\",\n     \"@rails/ujs\": \"7.1.501\",\n-    \"@react-spring/web\": \"^9.7.5\",\n+    \"@react-spring/web\": \"^10.0.0\",\n     \"@reduxjs/toolkit\": \"^2.0.1\",\n     \"@use-gesture/react\": \"^10.3.1\",\n     \"@vitejs/plugin-react\": \"^4.2.1\",\n---\nyarn.lock\n@@ -2451,7 +2451,7 @@ __metadata:\n     \"@github/webauthn-json\": \"npm:^2.1.1\"\n     \"@optimize-lodash/rollup-plugin\": \"npm:^5.0.2\"\n     \"@rails/ujs\": \"npm:7.1.501\"\n-    \"@react-spring/web\": \"npm:^9.7.5\"\n+    \"@react-spring/web\": \"npm:^10.0.0\"\n     \"@reduxjs/toolkit\": \"npm:^2.0.1\"\n     \"@testing-library/dom\": \"npm:^10.2.0\"\n     \"@testing-library/react\": \"npm:^16.0.0\"\n@@ -2877,69 +2877,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/animated@npm:9.7.5\"\n+\"@react-spring/animated@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/animated@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/f8c2473c60f39a878c7dd0fdfcfcdbc720521e1506aa3f63c9de64780694a0a73d5ccc535a5ccec3520ddb70a71cf43b038b32c18e99531522da5388c510ecd7\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/a8c40aff22def6dbe964b1f79fa4a7774c44bf5eb47c2ef969c8ecb2a426b4c972b147bf18635d6972dbec3fb95e70dd84f22b43c904c32dfc7a57ad144a0879\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/core@npm:9.7.5\"\n+\"@react-spring/core@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/core@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~9.7.5\"\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/animated\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/5bfd83dfe248cd91889f215f015d908c7714ef445740fd5afa054b27ebc7d5a456abf6c309e2459d9b5b436e78d6fda16b62b9601f96352e9130552c02270830\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/39036a153dbd973443e23d90cb8e7be83201b1f0e4105f8427ddb4c9e9e50e590e1b46282829e0bb6f3deebfab004e30dcb4eec0e34c5ebb234d5060c06ecae5\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/rafz@npm:9.7.5\"\n-  checksum: 10c0/8bdad180feaa9a0e870a513043a5e98a4e9b7292a9f887575b7e6fadab2677825bc894b7ff16c38511b35bfe6cc1072df5851c5fee64448d67551559578ca759\n+\"@react-spring/rafz@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/rafz@npm:10.0.0\"\n+  checksum: 10c0/8d92bc553172fa883ec2121b9cc62bfb43ff5d6c4e76363c8ce100fb6c3dd67c3dd629931786f9d1d63ac95a5d6996e4a08693cd56dda685bdbaf39b60e97f66\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/shared@npm:9.7.5\"\n+\"@react-spring/shared@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/shared@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/rafz\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/0207eacccdedd918a2fc55e78356ce937f445ce27ad9abd5d3accba8f9701a39349b55115641dc2b39bb9d3a155b058c185b411d292dc8cc5686bfa56f73b94f\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/833c3f42d35d22ac47a2f756ac47d85a81bc1decc5e7915f46013823344374378f883135754de94d5b43d8fff3c55fc4a359044c9a44f9095bd1ef1f11a20d4d\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/types@npm:9.7.5\"\n-  checksum: 10c0/85c05121853cacb64f7cf63a4855e9044635e1231f70371cd7b8c78bc10be6f4dd7c68f592f92a2607e8bb68051540989b4677a2ccb525dba937f5cd95dc8bc1\n+\"@react-spring/types@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/types@npm:10.0.0\"\n+  checksum: 10c0/ce1b959eaa8964f4004481d1e7c6eca0a8d636eb9f35ca654bdf77a78a860c0ff9eaa6bdc0cab84fc8a16be5c5fbb22b114249a2721bfc16191666670c0f44b3\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/web@npm:^9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/web@npm:9.7.5\"\n+\"@react-spring/web@npm:^10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/web@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~9.7.5\"\n-    \"@react-spring/core\": \"npm:~9.7.5\"\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/animated\": \"npm:~10.0.0\"\n+    \"@react-spring/core\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/bcd1e052e1b16341a12a19bf4515f153ca09d1fa86ff7752a5d02d7c4db58e8baf80e6283e64411f1e388c65340dce2254b013083426806b5dbae38bd151e53e\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/2218c87d9bfafab78b3079d94ea89ab9b95cb174910be5682fd8f5fc73e326ca956e9b844e5b255d1e3402138ad26981fae2fc1091d682a78359044a63b6421e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nRef MAS-414\r\n\r\n### Changes proposed in this PR:\r\n- Displays quotes nested within quotes as \"Post by {author name}\" links. Quote permissions are still taken into account, so if the quote was revoked or deleted, the usual error will be displayed instead of the link.\r\n- Slimmer spacing next to quote posts on mobile (quotes are still quite squished \u2013 but it's better than before)\r\n- Improves documentation around adding new Material icons\r\n- Addresses TS comments from previous PR #34738\r\n\r\n### Screenshot\r\n\r\n![image](https://github.com/user-attachments/assets/1f71bde1-07e6-40a7-b251-4a89b0355e76)\r\n\r\n| Before | After |\r\n|--------|--------|\r\n| ![image](https://github.com/user-attachments/assets/890e16cc-6731-4cdd-bfbb-7fa6c2139d05) | ![image](https://github.com/user-attachments/assets/5dc23ff6-9524-4649-ba93-d46d26f04d5f) | \r\n\n\n---\n\nChoice A:\nGemfile\n@@ -74,7 +74,7 @@ gem 'premailer-rails'\n gem 'public_suffix', '~> 6.0'\n gem 'pundit', '~> 2.3'\n gem 'rack-attack', '~> 6.6'\n-gem 'rack-cors', '~> 2.0', require: 'rack/cors'\n+gem 'rack-cors', '~> 3.0', require: 'rack/cors'\n gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n---\n\n\n---\n\nChoice B:\ndb/migrate/20250425134308_quote_ids_to_timestamp_ids.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class QuoteIdsToTimestampIds < ActiveRecord::Migration[8.0]\n+  def up\n+    # Set up the media_attachments.id column to use our timestamp-based IDs.\n+    safety_assured do\n+      execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT timestamp_id('quotes')\")\n+    end\n+\n+    # Make sure we have a sequence to use.\n+    Mastodon::Snowflake.ensure_id_sequences_exist\n+  end\n+\n+  def down\n+    execute('LOCK quotes')\n+    execute(\"SELECT setval('quotes_id_seq', (SELECT MAX(id) FROM quotes))\")\n+    execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT nextval('quotes_id_seq')\")\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_22_085303) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_25_134654) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -871,7 +871,7 @@\n     t.string \"url\"\n   end\n \n-  create_table \"quotes\", force: :cascade do |t|\n+  create_table \"quotes\", id: :bigint, default: -> { \"timestamp_id('quotes'::text)\" }, force: :cascade do |t|\n     t.bigint \"account_id\", null: false\n     t.bigint \"status_id\", null: false\n     t.bigint \"quoted_status_id\"\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -1,18 +1,24 @@\n import { FormattedMessage } from 'react-intl';\n \n import classNames from 'classnames';\n+import { Link } from 'react-router-dom';\n \n import type { Map as ImmutableMap } from 'immutable';\n \n+import ArticleIcon from '@/material-icons/400-24px/article.svg?react';\n+import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react';\n import { Icon } from 'mastodon/components/icon';\n import StatusContainer from 'mastodon/containers/status_container';\n+import type { Status } from 'mastodon/models/status';\n import { useAppSelector } from 'mastodon/store';\n \n import QuoteIcon from '../../images/quote.svg?react';\n \n+const MAX_QUOTE_POSTS_NESTING_LEVEL = 1;\n+\n const QuoteWrapper: React.FC<{\n   isError?: boolean;\n-  children: React.ReactNode;\n+  children: React.ReactElement;\n }> = ({ isError, children }) => {\n   return (\n     <div\n@@ -26,16 +32,52 @@ const QuoteWrapper: React.FC<{\n   );\n };\n \n+const QuoteLink: React.FC<{\n+  status: Status;\n+}> = ({ status }) => {\n+  const accountId = status.get('account') as string;\n+  const account = useAppSelector((state) =>\n+    accountId ? state.accounts.get(accountId) : undefined,\n+  );\n+\n+  const quoteAuthorName = account?.display_name_html;\n+\n+  if (!quoteAuthorName) {\n+    return null;\n+  }\n+\n+  const quoteAuthorElement = (\n+    <span dangerouslySetInnerHTML={{ __html: quoteAuthorName }} />\n+  );\n+  const quoteUrl = `/@${account.get('acct')}/${status.get('id') as string}`;\n+\n+  return (\n+    <Link to={quoteUrl} className='status__quote-author-button'>\n+      <FormattedMessage\n+        id='status.quote_post_author'\n+        defaultMessage='Post by {name}'\n+        values={{ name: quoteAuthorElement }}\n+      />\n+      <Icon id='chevron_right' icon={ChevronRightIcon} />\n+      <Icon id='article' icon={ArticleIcon} />\n+    </Link>\n+  );\n+};\n+\n type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n \n-export const QuotedStatus: React.FC<{ quote: QuoteMap }> = ({ quote }) => {\n+export const QuotedStatus: React.FC<{\n+  quote: QuoteMap;\n+  variant?: 'full' | 'link';\n+  nestingLevel?: number;\n+}> = ({ quote, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n   const state = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n \n-  let quoteError: React.ReactNode | null = null;\n+  let quoteError: React.ReactNode = null;\n \n   if (state === 'deleted') {\n     quoteError = (\n@@ -78,14 +120,28 @@ export const QuotedStatus: React.FC<{ quote: QuoteMap }> = ({ quote }) => {\n     return <QuoteWrapper isError>{quoteError}</QuoteWrapper>;\n   }\n \n+  if (variant === 'link' && status) {\n+    return <QuoteLink status={status} />;\n+  }\n+\n+  const childQuote = status?.get('quote') as QuoteMap | undefined;\n+  const canRenderChildQuote =\n+    childQuote && nestingLevel <= MAX_QUOTE_POSTS_NESTING_LEVEL;\n+\n   return (\n     <QuoteWrapper>\n-      <StatusContainer\n-        // @ts-expect-error Status isn't typed yet\n-        isQuotedPost\n-        id={quotedStatusId}\n-        avatarSize={40}\n-      />\n+      {/* @ts-expect-error Status is not yet typed */}\n+      <StatusContainer isQuotedPost id={quotedStatusId} avatarSize={40}>\n+        {canRenderChildQuote && (\n+          <QuotedStatus\n+            quote={childQuote}\n+            variant={\n+              nestingLevel === MAX_QUOTE_POSTS_NESTING_LEVEL ? 'link' : 'full'\n+            }\n+            nestingLevel={nestingLevel + 1}\n+          />\n+        )}\n+      </StatusContainer>\n     </QuoteWrapper>\n   );\n };\n---\napp/javascript/mastodon/locales/en.json\n@@ -868,6 +868,7 @@\n   \"status.quote_error.rejected\": \"This post cannot be displayed as the original author does not allow it to be quoted.\",\n   \"status.quote_error.removed\": \"This post was removed by its author.\",\n   \"status.quote_error.unauthorized\": \"This post cannot be displayed as you are not authorized to view it.\",\n+  \"status.quote_post_author\": \"Post by {name}\",\n   \"status.read_more\": \"Read more\",\n   \"status.reblog\": \"Boost\",\n   \"status.reblog_private\": \"Boost with original visibility\",\n---\napp/javascript/material-icons/400-24px/article-fill.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm80-160h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/article.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M280-280h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Zm-80 480q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/README.md\n@@ -1 +1,12 @@\n-Files in this directory are Material Symbols icons fetched using the `icons:download` task.\n+Files in this directory are Material Symbols icons fetched using the `icons:download` rake task (see `/lib/tasks/icons.rake`).\n+\n+To add another icon, follow these steps:\n+\n+- Determine the name of the Material Symbols icon you want to download.\n+  You can find a searchable overview of all icons on [https://fonts.google.com/icons].\n+  Click on the icon you want to use and find the icon name towards the bottom of the slide-out panel (it'll be something like `icon_name`)\n+- Import the icon in your React component using the following format:\n+  `import IconName from '@/material-icons/400-24px/icon_name.svg?react';`\n+- Run `RAILS_ENV=development rails icons:download` to download any newly imported icons.\n+\n+The import should now work and the icon should appear when passed to the `<Icon icon={IconName} /> component\n---\napp/javascript/styles/mastodon/components.scss\n@@ -1880,11 +1880,15 @@ body > [data-popper-placement] {\n .status__quote {\n   position: relative;\n   margin-block-start: 16px;\n-  margin-inline-start: 56px;\n+  margin-inline-start: 36px;\n   border-radius: 8px;\n   color: var(--nested-card-text);\n   background: var(--nested-card-background);\n   border: var(--nested-card-border);\n+\n+  @media screen and (min-width: $mobile-breakpoint) {\n+    margin-inline-start: 56px;\n+  }\n }\n \n .status__quote--error {\n@@ -1895,10 +1899,42 @@ body > [data-popper-placement] {\n   font-size: 15px;\n }\n \n+.status__quote-author-button {\n+  position: relative;\n+  overflow: hidden;\n+  display: inline-flex;\n+  width: auto;\n+  margin-block-start: 10px;\n+  padding: 5px 12px;\n+  align-items: center;\n+  gap: 6px;\n+  font-family: inherit;\n+  font-size: 14px;\n+  font-weight: 700;\n+  line-height: normal;\n+  letter-spacing: 0;\n+  text-decoration: none;\n+  color: $highlight-text-color;\n+  background: var(--nested-card-background);\n+  border: var(--nested-card-border);\n+  border-radius: 4px;\n+\n+  &:active,\n+  &:focus,\n+  &:hover {\n+    border-color: lighten($highlight-text-color, 4%);\n+    color: lighten($highlight-text-color, 4%);\n+  }\n+\n+  &:focus-visible {\n+    outline: $ui-button-icon-focus-outline;\n+  }\n+}\n+\n .status__quote-icon {\n   position: absolute;\n   inset-block-start: 18px;\n-  inset-inline-start: -50px;\n+  inset-inline-start: -40px;\n   display: block;\n   width: 26px;\n   height: 26px;\n@@ -1910,6 +1946,10 @@ body > [data-popper-placement] {\n     inset-block-start: 50%;\n     transform: translateY(-50%);\n   }\n+\n+  @media screen and (min-width: $mobile-breakpoint) {\n+    inset-inline-start: -50px;\n+  }\n }\n \n .detailed-status__link {\n---\n\n\n---\n\nChoice D:\nspec/system/account_notes_spec.rb\n@@ -11,13 +11,13 @@\n   let(:finished_onboarding) { true }\n \n   let!(:other_account) { Fabricate(:account) }\n+  let(:note_text) { 'This is a personal note' }\n \n   before { as_a_logged_in_user }\n \n   it 'can be written and viewed' do\n     visit_profile(other_account)\n \n-    note_text = 'This is a personal note'\n     fill_in frontend_translations('account_note.placeholder'), with: note_text\n \n     # This is a bit awkward since there is no button to save the change\n---\nspec/system/new_statuses_spec.rb\n@@ -9,12 +9,12 @@\n   let(:password)            { 'password' }\n   let(:confirmed_at)        { Time.zone.now }\n   let(:finished_onboarding) { true }\n+  let(:status_text) { 'This is a new status!' }\n \n   before { as_a_logged_in_user }\n \n   it 'can be posted' do\n     visit_homepage\n-    status_text = 'This is a new status!'\n \n     within('.compose-form') do\n       fill_in frontend_translations('compose_form.placeholder'), with: status_text\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| ruby-prof | `1.7.1` -> `1.7.2` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/ruby-prof/1.7.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/ruby-prof/1.7.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/ruby-prof/1.7.1/1.7.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/ruby-prof/1.7.1/1.7.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xNi4wIiwidXBkYXRlZEluVmVyIjoiNDAuMTYuMCIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\napp/views/auth/registrations/new.html.haml\n@@ -56,7 +56,7 @@\n     .fields-group\n       = f.input :date_of_birth,\n                 as: :date_of_birth,\n-                hint: t('simple_form.hints.user.date_of_birth', age: Setting.min_age.to_i),\n+                hint: t('simple_form.hints.user.date_of_birth', count: Setting.min_age.to_i),\n                 required: true,\n                 wrapper: :with_block_label\n \n---\nconfig/locales/simple_form.en.yml\n@@ -148,7 +148,9 @@ en:\n         min_age: Should not be below the minimum age required by the laws of your jurisdiction.\n       user:\n         chosen_languages: When checked, only posts in selected languages will be displayed in public timelines\n-        date_of_birth: We have to make sure you're at least %{age} to use Mastodon. We won't store this.\n+        date_of_birth:\n+          one: We have to make sure you're at least %{count} to use Mastodon. We won't store this.\n+          other: We have to make sure you're at least %{count} to use Mastodon. We won't store this.\n         role: The role controls which permissions the user has.\n       user_role:\n         color: Color to be used for the role throughout the UI, as RGB in hex format\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -779,7 +779,8 @@ GEM\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n       rubocop-rspec (~> 3.5)\n-    ruby-prof (1.7.1)\n+    ruby-prof (1.7.2)\n+      base64\n     ruby-progressbar (1.13.0)\n     ruby-saml (1.18.0)\n       nokogiri (>= 1.13.10)\n---\n\n\n---\n\nChoice C:\n.github/workflows/test-ruby.yml\n@@ -143,7 +143,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick libpam-dev\n+          additional-system-dependencies: ffmpeg libpam-dev\n \n       - name: Load database schema\n         run: |\n@@ -173,8 +173,8 @@ jobs:\n         env:\n           CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}\n \n-  test-libvips:\n-    name: Libvips tests\n+  test-imagemagick:\n+    name: ImageMagick tests\n     runs-on: ubuntu-latest\n \n     needs:\n@@ -220,7 +220,7 @@ jobs:\n       CAS_ENABLED: true\n       BUNDLE_WITH: 'pam_authentication test'\n       GITHUB_RSPEC: ${{ matrix.ruby-version == '.ruby-version' && github.event.pull_request && 'true' }}\n-      MASTODON_USE_LIBVIPS: true\n+      MASTODON_USE_LIBVIPS: false\n \n     strategy:\n       fail-fast: false\n@@ -245,7 +245,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg libpam-dev\n+          additional-system-dependencies: ffmpeg imagemagick libpam-dev\n \n       - name: Load database schema\n         run: './bin/rails db:create db:schema:load db:seed'\n@@ -324,7 +324,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick\n+          additional-system-dependencies: ffmpeg\n \n       - name: Set up Javascript environment\n         uses: ./.github/actions/setup-javascript\n@@ -443,7 +443,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick\n+          additional-system-dependencies: ffmpeg\n \n       - name: Set up Javascript environment\n         uses: ./.github/actions/setup-javascript\n---\nconfig/application.rb\n@@ -95,7 +95,7 @@ class Application < Rails::Application\n       require 'mastodon/redis_configuration'\n       ::REDIS_CONFIGURATION = Mastodon::RedisConfiguration.new\n \n-      config.x.use_vips = ENV['MASTODON_USE_LIBVIPS'] == 'true'\n+      config.x.use_vips = ENV['MASTODON_USE_LIBVIPS'] != 'false'\n \n       if config.x.use_vips\n         require_relative '../lib/paperclip/vips_lazy_thumbnail'\n---\nconfig/initializers/deprecations.rb\n@@ -16,3 +16,9 @@\n \n   abort message\n end\n+\n+if ENV['MASTODON_USE_LIBVIPS'] == 'false'\n+  warn <<~MESSAGE\n+    WARNING: Mastodon support for ImageMagick is deprecated and will be removed in future versions. Please consider using libvips instead.\n+  MESSAGE\n+end\n---\n\n\n---\n\nChoice D:\nconfig/environments/production.rb\n@@ -52,17 +52,14 @@\n     },\n   }\n \n-  # Log to STDOUT by default\n-  config.logger = ActiveSupport::Logger.new($stdout)\n-                                       .tap  { |logger| logger.formatter = ::Logger::Formatter.new }\n-                                       .then { |logger| ActiveSupport::TaggedLogging.new(logger) }\n+  # Use default logging formatter so that PID and timestamp are not suppressed.\n+  config.log_formatter = Logger::Formatter.new\n \n-  # Prepend all log lines with the following tags.\n+  # Log to STDOUT with the current request id as a default log tag.\n   config.log_tags = [:request_id]\n+  config.logger = ActiveSupport::TaggedLogging.logger($stdout, formatter: config.log_formatter)\n \n-  # \"info\" includes generic and useful information about system operation, but avoids logging too much\n-  # information to avoid inadvertent exposure of personally identifiable information (PII). If you\n-  # want to log everything, set the level to \"debug\".\n+  # Change to \"debug\" to log everything (including potentially personally-identifiable information!)\n   config.log_level = ENV.fetch('RAILS_LOG_LEVEL', 'info')\n \n   # Use a different cache store in production.\n@@ -90,9 +87,6 @@\n   # Don't log any deprecations.\n   config.active_support.report_deprecations = false\n \n-  # Use default logging formatter so that PID and timestamp are not suppressed.\n-  config.log_formatter = ::Logger::Formatter.new\n-\n   # Better log formatting\n   config.lograge.enabled = true\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rack](https://redirect.github.com/rack/rack) ([changelog](https://redirect.github.com/rack/rack/blob/main/CHANGELOG.md)) | `2.2.15` -> `2.2.16` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rack/2.2.16?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rack/2.2.16?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rack/2.2.15/2.2.16?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rack/2.2.15/2.2.16?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>rack/rack (rack)</summary>\n\n### [`v2.2.16`](https://redirect.github.com/rack/rack/blob/HEAD/CHANGELOG.md#2216---2025-05-22)\n\n[Compare Source](https://redirect.github.com/rack/rack/compare/v2.2.15...v2.2.16)\n\n-   Fix incorrect backport of optional `CGI::Cookie` support. ([#&#8203;2335](https://redirect.github.com/rack/rack/pull/2335), \\[[@&#8203;jeremyevans](https://redirect.github.com/jeremyevans)])\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xNi4wIiwidXBkYXRlZEluVmVyIjoiNDAuMTYuMCIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.15)\n+    rack (2.2.16)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n---\n\n\n---\n\nChoice B:\napp/services/post_status_service.rb\n@@ -18,6 +18,7 @@ def initialize(message, accounts)\n   # @param [Hash] options\n   # @option [String] :text Message\n   # @option [Status] :thread Optional status to reply to\n+  # @option [Status] :quoted_status Optional status to quote\n   # @option [Boolean] :sensitive\n   # @option [String] :visibility\n   # @option [String] :spoiler_text\n@@ -35,6 +36,7 @@ def call(account, options = {})\n     @options     = options\n     @text        = @options[:text] || ''\n     @in_reply_to = @options[:thread]\n+    @quoted_status = @options[:quoted_status]\n \n     @antispam = Antispam.new\n \n@@ -78,6 +80,7 @@ def process_status!\n     @status = @account.statuses.new(status_attributes)\n     process_mentions_service.call(@status, save_records: false)\n     safeguard_mentions!(@status)\n+    attach_quote!(@status)\n     @antispam.local_preflight_check!(@status)\n \n     # The following transaction block is needed to wrap the UPDATEs to\n@@ -87,6 +90,21 @@ def process_status!\n     end\n   end\n \n+  def attach_quote!(status)\n+    return if @quoted_status.nil?\n+\n+    # NOTE: for now this is only for convenience in testing, as we don't support the request flow nor serialize quotes in ActivityPub\n+    # we only support incoming quotes so far\n+\n+    status.quote = Quote.new(quoted_status: @quoted_status)\n+    status.quote.accept! if @status.account == @quoted_status.account || @quoted_status.active_mentions.exists?(mentions: { account_id: status.account_id })\n+\n+    # TODO: the following has yet to be implemented:\n+    # - handle approval of local users (requires the interactionPolicy PR)\n+    # - produce a QuoteAuthorization for quotes of local users\n+    # - send a QuoteRequest for quotes of remote users\n+  end\n+\n   def safeguard_mentions!(status)\n     return if @options[:allowed_mentions].nil?\n \n@@ -223,6 +241,7 @@ def scheduled_options\n     @options.dup.tap do |options_hash|\n       options_hash[:in_reply_to_id]  = options_hash.delete(:thread)&.id\n       options_hash[:application_id]  = options_hash.delete(:application)&.id\n+      options_hash[:quoted_status_id] = options_hash.delete(:quoted_status)&.id\n       options_hash[:scheduled_at]    = nil\n       options_hash[:idempotency]     = nil\n       options_hash[:with_rate_limit] = false\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -469,7 +469,7 @@ GEM\n     omniauth-rails_csrf_protection (1.0.2)\n       actionpack (>= 4.2)\n       omniauth (~> 2.0)\n-    omniauth-saml (2.2.3)\n+    omniauth-saml (2.2.4)\n       omniauth (~> 2.1)\n       ruby-saml (~> 1.18)\n     omniauth_openid_connect (0.8.0)\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -48,7 +48,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/code-frame@npm:^7.0.0, @babel/code-frame@npm:^7.10.4, @babel/code-frame@npm:^7.26.2, @babel/code-frame@npm:^7.27.1\":\n+\"@babel/code-frame@npm:^7.0.0, @babel/code-frame@npm:^7.10.4, @babel/code-frame@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/code-frame@npm:7.27.1\"\n   dependencies:\n@@ -67,29 +67,29 @@ __metadata:\n   linkType: hard\n \n \"@babel/core@npm:^7.12.3, @babel/core@npm:^7.21.3, @babel/core@npm:^7.22.1, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n-  version: 7.26.10\n-  resolution: \"@babel/core@npm:7.26.10\"\n+  version: 7.27.1\n+  resolution: \"@babel/core@npm:7.27.1\"\n   dependencies:\n     \"@ampproject/remapping\": \"npm:^2.2.0\"\n-    \"@babel/code-frame\": \"npm:^7.26.2\"\n-    \"@babel/generator\": \"npm:^7.26.10\"\n-    \"@babel/helper-compilation-targets\": \"npm:^7.26.5\"\n-    \"@babel/helper-module-transforms\": \"npm:^7.26.0\"\n-    \"@babel/helpers\": \"npm:^7.26.10\"\n-    \"@babel/parser\": \"npm:^7.26.10\"\n-    \"@babel/template\": \"npm:^7.26.9\"\n-    \"@babel/traverse\": \"npm:^7.26.10\"\n-    \"@babel/types\": \"npm:^7.26.10\"\n+    \"@babel/code-frame\": \"npm:^7.27.1\"\n+    \"@babel/generator\": \"npm:^7.27.1\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/helper-module-transforms\": \"npm:^7.27.1\"\n+    \"@babel/helpers\": \"npm:^7.27.1\"\n+    \"@babel/parser\": \"npm:^7.27.1\"\n+    \"@babel/template\": \"npm:^7.27.1\"\n+    \"@babel/traverse\": \"npm:^7.27.1\"\n+    \"@babel/types\": \"npm:^7.27.1\"\n     convert-source-map: \"npm:^2.0.0\"\n     debug: \"npm:^4.1.0\"\n     gensync: \"npm:^1.0.0-beta.2\"\n     json5: \"npm:^2.2.3\"\n     semver: \"npm:^6.3.1\"\n-  checksum: 10c0/e046e0e988ab53841b512ee9d263ca409f6c46e2a999fe53024688b92db394346fa3aeae5ea0866331f62133982eee05a675d22922a4603c3f603aa09a581d62\n+  checksum: 10c0/0fc31f87f5401ac5d375528cb009f4ea5527fc8c5bb5b64b5b22c033b60fd0ad723388933a5f3f5db14e1edd13c958e9dd7e5c68f9b68c767aeb496199c8a4bb\n   languageName: node\n   linkType: hard\n \n-\"@babel/generator@npm:^7.26.10, @babel/generator@npm:^7.27.1\":\n+\"@babel/generator@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/generator@npm:7.27.1\"\n   dependencies:\n@@ -121,7 +121,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.26.5, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n+\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n   version: 7.27.2\n   resolution: \"@babel/helper-compilation-targets@npm:7.27.2\"\n   dependencies:\n@@ -199,7 +199,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-module-transforms@npm:^7.26.0, @babel/helper-module-transforms@npm:^7.27.1\":\n+\"@babel/helper-module-transforms@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/helper-module-transforms@npm:7.27.1\"\n   dependencies:\n@@ -296,17 +296,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helpers@npm:^7.26.10\":\n-  version: 7.26.10\n-  resolution: \"@babel/helpers@npm:7.26.10\"\n+\"@babel/helpers@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helpers@npm:7.27.1\"\n   dependencies:\n-    \"@babel/template\": \"npm:^7.26.9\"\n-    \"@babel/types\": \"npm:^7.26.10\"\n-  checksum: 10c0/f99e1836bcffce96db43158518bb4a24cf266820021f6461092a776cba2dc01d9fc8b1b90979d7643c5c2ab7facc438149064463a52dd528b21c6ab32509784f\n+    \"@babel/template\": \"npm:^7.27.1\"\n+    \"@babel/types\": \"npm:^7.27.1\"\n+  checksum: 10c0/e078257b9342dae2c041ac050276c5a28701434ad09478e6dc6976abd99f721a5a92e4bebddcbca6b1c3a7e8acace56a946340c701aad5e7507d2c87446459ba\n   languageName: node\n   linkType: hard\n \n-\"@babel/parser@npm:^7.1.0, @babel/parser@npm:^7.20.7, @babel/parser@npm:^7.26.10, @babel/parser@npm:^7.27.1\":\n+\"@babel/parser@npm:^7.1.0, @babel/parser@npm:^7.20.7, @babel/parser@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/parser@npm:7.27.1\"\n   dependencies:\n@@ -1292,7 +1292,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/template@npm:^7.26.9, @babel/template@npm:^7.27.1\":\n+\"@babel/template@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/template@npm:7.27.1\"\n   dependencies:\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nAdded a link to SECURITY.md in the CONTRIBUTING.md guide.\r\nUpdated the copyright year references in README.md.\n\n---\n\nChoice A:\nCONTRIBUTING.md\n@@ -23,6 +23,11 @@ Bug reports and feature suggestions must use descriptive and concise titles and\n be submitted to [GitHub Issues]. Please use the search function to make sure\n there are not duplicate bug reports or feature requests.\n \n+## Security Issues\n+\n+If you believe you have identified a security issue in Mastodon or our own apps,\n+check [SECURITY].\n+\n ## Translations\n \n Translations are community contributed via [Crowdin]. They are periodically\n@@ -83,3 +88,4 @@ and API docs. Improvements are made via PRs to the [documentation repository].\n [GitHub Issues]: https://github.com/mastodon/mastodon/issues\n [keepachangelog]: https://keepachangelog.com/en/1.0.0/\n [Mastodon documentation]: https://docs.joinmastodon.org\n+[SECURITY]: SECURITY.md\n---\nREADME.md\n@@ -77,12 +77,12 @@ accepted into Mastodon, you can request to be paid through our [OpenCollective].\n \n ## License\n \n-Copyright (c) 2016-2024 Eugen Rochko (+ [`mastodon authors`](AUTHORS.md))\n+Copyright (c) 2016-2025 Eugen Rochko (+ [`mastodon authors`](AUTHORS.md))\n \n Licensed under GNU Affero General Public License as stated in the [LICENSE](LICENSE):\n \n ```\n-Copyright (c) 2016-2024 Eugen Rochko & other Mastodon contributors\n+Copyright (c) 2016-2025 Eugen Rochko & other Mastodon contributors\n \n This program is free software: you can redistribute it and/or modify it under\n the terms of the GNU Affero General Public License as published by the Free\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/actions/accounts_typed.ts\n@@ -1,7 +1,9 @@\n import { createAction } from '@reduxjs/toolkit';\n \n+import { apiRemoveAccountFromFollowers } from 'mastodon/api/accounts';\n import type { ApiAccountJSON } from 'mastodon/api_types/accounts';\n import type { ApiRelationshipJSON } from 'mastodon/api_types/relationships';\n+import { createDataLoadingThunk } from 'mastodon/store/typed_functions';\n \n export const revealAccount = createAction<{\n   id: string;\n@@ -95,3 +97,10 @@ export const fetchRelationshipsSuccess = createAction(\n   'relationships/fetch/SUCCESS',\n   actionWithSkipLoadingTrue<{ relationships: ApiRelationshipJSON[] }>,\n );\n+\n+export const removeAccountFromFollowers = createDataLoadingThunk(\n+  'accounts/remove_from_followers',\n+  ({ accountId }: { accountId: string }) =>\n+    apiRemoveAccountFromFollowers(accountId),\n+  (relationship) => ({ relationship }),\n+);\n---\napp/javascript/mastodon/api/accounts.ts\n@@ -18,3 +18,8 @@ export const apiFollowAccount = (\n \n export const apiUnfollowAccount = (id: string) =>\n   apiRequestPost<ApiRelationshipJSON>(`v1/accounts/${id}/unfollow`);\n+\n+export const apiRemoveAccountFromFollowers = (id: string) =>\n+  apiRequestPost<ApiRelationshipJSON>(\n+    `v1/accounts/${id}/remove_from_followers`,\n+  );\n---\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -18,6 +18,7 @@ import {\n   unmuteAccount,\n   pinAccount,\n   unpinAccount,\n+  removeAccountFromFollowers,\n } from 'mastodon/actions/accounts';\n import { initBlockModal } from 'mastodon/actions/blocks';\n import { mentionCompose, directCompose } from 'mastodon/actions/compose';\n@@ -152,6 +153,23 @@ const messages = defineMessages({\n     id: 'account.open_original_page',\n     defaultMessage: 'Open original page',\n   },\n+  removeFromFollowers: {\n+    id: 'account.remove_from_followers',\n+    defaultMessage: 'Remove {name} from followers',\n+  },\n+  confirmRemoveFromFollowersTitle: {\n+    id: 'confirmations.remove_from_followers.title',\n+    defaultMessage: 'Remove follower?',\n+  },\n+  confirmRemoveFromFollowersMessage: {\n+    id: 'confirmations.remove_from_followers.message',\n+    defaultMessage:\n+      '{name} will stop following you. Are you sure you want to proceed?',\n+  },\n+  confirmRemoveFromFollowersButton: {\n+    id: 'confirmations.remove_from_followers.confirm',\n+    defaultMessage: 'Remove follower',\n+  },\n });\n \n const titleFromAccount = (account: Account) => {\n@@ -494,6 +512,39 @@ export const AccountHeader: React.FC<{\n         arr.push(null);\n       }\n \n+      if (relationship?.followed_by) {\n+        const handleRemoveFromFollowers = () => {\n+          dispatch(\n+            openModal({\n+              modalType: 'CONFIRM',\n+              modalProps: {\n+                title: intl.formatMessage(\n+                  messages.confirmRemoveFromFollowersTitle,\n+                ),\n+                message: intl.formatMessage(\n+                  messages.confirmRemoveFromFollowersMessage,\n+                  { name: <strong>{account.acct}</strong> },\n+                ),\n+                confirm: intl.formatMessage(\n+                  messages.confirmRemoveFromFollowersButton,\n+                ),\n+                onConfirm: () => {\n+                  void dispatch(removeAccountFromFollowers({ accountId }));\n+                },\n+              },\n+            }),\n+          );\n+        };\n+\n+        arr.push({\n+          text: intl.formatMessage(messages.removeFromFollowers, {\n+            name: account.username,\n+          }),\n+          action: handleRemoveFromFollowers,\n+          dangerous: true,\n+        });\n+      }\n+\n       if (relationship?.muting) {\n         arr.push({\n           text: intl.formatMessage(messages.unmute, {\n@@ -592,6 +643,8 @@ export const AccountHeader: React.FC<{\n \n     return arr;\n   }, [\n+    dispatch,\n+    accountId,\n     account,\n     relationship,\n     permissions,\n---\napp/javascript/mastodon/locales/en.json\n@@ -62,6 +62,7 @@\n   \"account.open_original_page\": \"Open original page\",\n   \"account.posts\": \"Posts\",\n   \"account.posts_with_replies\": \"Posts and replies\",\n+  \"account.remove_from_followers\": \"Remove {name} from followers\",\n   \"account.report\": \"Report @{name}\",\n   \"account.requested\": \"Awaiting approval. Click to cancel follow request\",\n   \"account.requested_follow\": \"{name} has requested to follow you\",\n@@ -233,6 +234,9 @@\n   \"confirmations.redraft.confirm\": \"Delete & redraft\",\n   \"confirmations.redraft.message\": \"Are you sure you want to delete this post and re-draft it? Favorites and boosts will be lost, and replies to the original post will be orphaned.\",\n   \"confirmations.redraft.title\": \"Delete & redraft post?\",\n+  \"confirmations.remove_from_followers.confirm\": \"Remove follower\",\n+  \"confirmations.remove_from_followers.message\": \"{name} will stop following you. Are you sure you want to proceed?\",\n+  \"confirmations.remove_from_followers.title\": \"Remove follower?\",\n   \"confirmations.reply.confirm\": \"Reply\",\n   \"confirmations.reply.message\": \"Replying now will overwrite the message you are currently composing. Are you sure you want to proceed?\",\n   \"confirmations.reply.title\": \"Overwrite post?\",\n---\napp/javascript/mastodon/reducers/relationships.ts\n@@ -24,6 +24,7 @@ import {\n   pinAccountSuccess,\n   unpinAccountSuccess,\n   fetchRelationshipsSuccess,\n+  removeAccountFromFollowers,\n } from '../actions/accounts_typed';\n import {\n   blockDomainSuccess,\n@@ -109,7 +110,8 @@ export const relationshipsReducer: Reducer<State> = (\n     unmuteAccountSuccess.match(action) ||\n     pinAccountSuccess.match(action) ||\n     unpinAccountSuccess.match(action) ||\n-    isFulfilled(submitAccountNote)(action)\n+    isFulfilled(submitAccountNote)(action) ||\n+    isFulfilled(removeAccountFromFollowers)(action)\n   )\n     return normalizeRelationship(state, action.payload.relationship);\n   else if (fetchRelationshipsSuccess.match(action))\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -1023,7 +1023,7 @@ export const AccountHeader: React.FC<{\n                   />\n                 </NavLink>\n               </div>\n-              <FamiliarFollowers accountId={accountId} />\n+              {signedIn && <FamiliarFollowers accountId={accountId} />}\n             </div>\n           )}\n         </div>\n---\n\n\n---\n\nChoice D:\nspec/helpers/theme_helper_spec.rb\n@@ -6,10 +6,10 @@\n   describe 'theme_style_tags' do\n     let(:result) { helper.theme_style_tags(theme) }\n \n-    context 'when using system theme' do\n+    context 'when using \"system\" theme' do\n       let(:theme) { 'system' }\n \n-      it 'returns the mastodon-light and default stylesheets with correct color schemes' do\n+      it 'returns the mastodon-light and application stylesheets with correct color schemes' do\n         expect(html_links.first.attributes.symbolize_keys)\n           .to include(\n             href: have_attributes(value: match(/mastodon-light/)),\n@@ -23,6 +23,17 @@\n       end\n     end\n \n+    context 'when using \"default\" theme' do\n+      let(:theme) { 'default' }\n+\n+      it 'returns the application stylesheet' do\n+        expect(html_links.last.attributes.symbolize_keys)\n+          .to include(\n+            href: have_attributes(value: match(/application/))\n+          )\n+      end\n+    end\n+\n     context 'when using other theme' do\n       let(:theme) { 'contrast' }\n \n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Update | Change |\n|---|---|---|\n| [node](https://nodejs.org) ([source](https://redirect.github.com/nodejs/node)) | minor | `22.15` -> `22.16` |\n\n---\n\n### Release Notes\n\n<details>\n<summary>nodejs/node (node)</summary>\n\n### [`v22.16.0`](https://redirect.github.com/nodejs/node/releases/tag/v22.16.0): 2025-05-21, Version 22.16.0 &#x27;Jod&#x27; (LTS), @&#8203;aduh95\n\n[Compare Source](https://redirect.github.com/nodejs/node/compare/v22.15.1...v22.16.0)\n\n##### Notable Changes\n\n-   \\[[`c3ceaebb7a`](https://redirect.github.com/nodejs/node/commit/c3ceaebb7a)] - **deps**: update timezone to 2025b (Node.js GitHub Bot) [#&#8203;57857](https://redirect.github.com/nodejs/node/pull/57857)\n-   \\[[`5059a746ec`](https://redirect.github.com/nodejs/node/commit/5059a746ec)] - **doc**: add dario-piotrowicz to collaborators (Dario Piotrowicz) [#&#8203;58102](https://redirect.github.com/nodejs/node/pull/58102)\n-   \\[[`c8ceaaf397`](https://redirect.github.com/nodejs/node/commit/c8ceaaf397)] - **(SEMVER-MINOR)** **doc**: graduate multiple experimental apis (James M Snell) [#&#8203;57765](https://redirect.github.com/nodejs/node/pull/57765)\n-   \\[[`e21b37d9df`](https://redirect.github.com/nodejs/node/commit/e21b37d9df)] - **(SEMVER-MINOR)** **esm**: graduate import.meta properties (James M Snell) [#&#8203;58011](https://redirect.github.com/nodejs/node/pull/58011)\n-   \\[[`832640c35e`](https://redirect.github.com/nodejs/node/commit/832640c35e)] - **(SEMVER-MINOR)** **esm**: support top-level Wasm without package type (Guy Bedford) [#&#8203;57610](https://redirect.github.com/nodejs/node/pull/57610)\n-   \\[[`c510391d2f`](https://redirect.github.com/nodejs/node/commit/c510391d2f)] - **(SEMVER-MINOR)** **sqlite**: add StatementSync.prototype.columns() (Colin Ihrig) [#&#8203;57490](https://redirect.github.com/nodejs/node/pull/57490)\n-   \\[[`5d1230bec0`](https://redirect.github.com/nodejs/node/commit/5d1230bec0)] - **(SEMVER-MINOR)** **src**: set default config as `node.config.json` (Marco Ippolito) [#&#8203;57171](https://redirect.github.com/nodejs/node/pull/57171)\n-   \\[[`30bb1ccbb0`](https://redirect.github.com/nodejs/node/commit/30bb1ccbb0)] - **(SEMVER-MINOR)** **src**: create `THROW_ERR_OPTIONS_BEFORE_BOOTSTRAPPING` (Marco Ippolito) [#&#8203;57016](https://redirect.github.com/nodejs/node/pull/57016)\n-   \\[[`0350c6f478`](https://redirect.github.com/nodejs/node/commit/0350c6f478)] - **(SEMVER-MINOR)** **src**: add config file support (Marco Ippolito) [#&#8203;57016](https://redirect.github.com/nodejs/node/pull/57016)\n-   \\[[`e1d3a9e192`](https://redirect.github.com/nodejs/node/commit/e1d3a9e192)] - **(SEMVER-MINOR)** **src**: add ExecutionAsyncId getter for any Context (Attila Szegedi) [#&#8203;57820](https://redirect.github.com/nodejs/node/pull/57820)\n-   \\[[`0ec912f452`](https://redirect.github.com/nodejs/node/commit/0ec912f452)] - **(SEMVER-MINOR)** **stream**: preserve AsyncLocalStorage context in finished() (G\u00fcrg\u00fcn Day\u0131o\u011flu) [#&#8203;57865](https://redirect.github.com/nodejs/node/pull/57865)\n-   \\[[`43490c8797`](https://redirect.github.com/nodejs/node/commit/43490c8797)] - **(SEMVER-MINOR)** **util**: add `types.isFloat16Array()` (Livia Medeiros) [#&#8203;57879](https://redirect.github.com/nodejs/node/pull/57879)\n-   \\[[`dda6ca9172`](https://redirect.github.com/nodejs/node/commit/dda6ca9172)] - **(SEMVER-MINOR)** **worker**: add worker.getHeapStatistics() (Matteo Collina) [#&#8203;57888](https://redirect.github.com/nodejs/node/pull/57888)\n\n##### Commits\n\n-   \\[[`4252dc798c`](https://redirect.github.com/nodejs/node/commit/4252dc798c)] - **assert**: support `Float16Array` in loose deep equality checks (Livia Medeiros) [#&#8203;57881](https://redirect.github.com/nodejs/node/pull/57881)\n-   \\[[`1c7396b078`](https://redirect.github.com/nodejs/node/commit/1c7396b078)] - **assert,util**: fix constructor lookup in deep equal comparison (Ruben Bridgewater) [#&#8203;57876](https://redirect.github.com/nodejs/node/pull/57876)\n-   \\[[`1ded5f25c8`](https://redirect.github.com/nodejs/node/commit/1ded5f25c8)] - **assert,util**: improve deep object comparison performance (Ruben Bridgewater) [#&#8203;57648](https://redirect.github.com/nodejs/node/pull/57648)\n-   \\[[`696b5f85ca`](https://redirect.github.com/nodejs/node/commit/696b5f85ca)] - **assert,util**: improve unequal number comparison performance (Ruben Bridgewater) [#&#8203;57619](https://redirect.github.com/nodejs/node/pull/57619)\n-   \\[[`775ee4d40f`](https://redirect.github.com/nodejs/node/commit/775ee4d40f)] - **assert,util**: improve array comparison (Ruben Bridgewater) [#&#8203;57619](https://redirect.github.com/nodejs/node/pull/57619)\n-   \\[[`3766992ba4`](https://redirect.github.com/nodejs/node/commit/3766992ba4)] - **benchmark**: add sqlite prepare select get (Vin\u00edcius Louren\u00e7o) [#&#8203;58040](https://redirect.github.com/nodejs/node/pull/58040)\n-   \\[[`8390276be3`](https://redirect.github.com/nodejs/node/commit/8390276be3)] - **benchmark**: add sqlite prepare select all (Vin\u00edcius Louren\u00e7o) [#&#8203;58040](https://redirect.github.com/nodejs/node/pull/58040)\n-   \\[[`6a9b79e5c1`](https://redirect.github.com/nodejs/node/commit/6a9b79e5c1)] - **benchmark**: add sqlite is transaction (Vin\u00edcius Louren\u00e7o) [#&#8203;58040](https://redirect.github.com/nodejs/node/pull/58040)\n-   \\[[`f689f98344`](https://redirect.github.com/nodejs/node/commit/f689f98344)] - **benchmark**: add sqlite prepare insert (Vin\u00edcius Louren\u00e7o) [#&#8203;58040](https://redirect.github.com/nodejs/node/pull/58040)\n-   \\[[`14a82804d7`](https://redirect.github.com/nodejs/node/commit/14a82804d7)] - **benchmark**: disambiguate `filename` and `dirname` read perf (Antoine du Hamel) [#&#8203;58056](https://redirect.github.com/nodejs/node/pull/58056)\n-   \\[[`e7e8256d35`](https://redirect.github.com/nodejs/node/commit/e7e8256d35)] - **buffer**: avoid creating unnecessary environment (Yagiz Nizipli) [#&#8203;58053](https://redirect.github.com/nodejs/node/pull/58053)\n-   \\[[`d7d8e8e994`](https://redirect.github.com/nodejs/node/commit/d7d8e8e994)] - **buffer**: define global v8::CFunction objects as const (Mert Can Altin) [#&#8203;57676](https://redirect.github.com/nodejs/node/pull/57676)\n-   \\[[`f37633e85a`](https://redirect.github.com/nodejs/node/commit/f37633e85a)] - **build**: use `$(BUILDTYPE)` when cleaning coverage files (Aviv Keller) [#&#8203;57995](https://redirect.github.com/nodejs/node/pull/57995)\n-   \\[[`e5bf67fe77`](https://redirect.github.com/nodejs/node/commit/e5bf67fe77)] - **build**: define python when generating `out/Makefile` (Aviv Keller) [#&#8203;57970](https://redirect.github.com/nodejs/node/pull/57970)\n-   \\[[`718f874ae0`](https://redirect.github.com/nodejs/node/commit/718f874ae0)] - **build**: fix zstd libname (Antoine du Hamel) [#&#8203;57999](https://redirect.github.com/nodejs/node/pull/57999)\n-   \\[[`53c5fdcae1`](https://redirect.github.com/nodejs/node/commit/53c5fdcae1)] - **crypto**: fix cross-realm `SharedArrayBuffer` validation (Antoine du Hamel) [#&#8203;57974](https://redirect.github.com/nodejs/node/pull/57974)\n-   \\[[`78f4ffee5d`](https://redirect.github.com/nodejs/node/commit/78f4ffee5d)] - **crypto**: fix cross-realm check of `ArrayBuffer` (Felipe Forbeck) [#&#8203;57828](https://redirect.github.com/nodejs/node/pull/57828)\n-   \\[[`f606352b63`](https://redirect.github.com/nodejs/node/commit/f606352b63)] - **crypto**: forbid passing `Float16Array` to `getRandomValues()` (Livia Medeiros) [#&#8203;57880](https://redirect.github.com/nodejs/node/pull/57880)\n-   \\[[`23c4e941c2`](https://redirect.github.com/nodejs/node/commit/23c4e941c2)] - **crypto**: remove BoringSSL dh-primes addition (Shelley Vohr) [#&#8203;57023](https://redirect.github.com/nodejs/node/pull/57023)\n-   \\[[`8339d9bc14`](https://redirect.github.com/nodejs/node/commit/8339d9bc14)] - **deps**: V8: cherry-pick [`f915fa4`](https://redirect.github.com/nodejs/node/commit/f915fa4c9f41) (Chengzhong Wu) [#&#8203;55484](https://redirect.github.com/nodejs/node/pull/55484)\n-   \\[[`c2111dd126`](https://redirect.github.com/nodejs/node/commit/c2111dd126)] - **deps**: V8: backport [`e5dbbba`](https://redirect.github.com/nodejs/node/commit/e5dbbbadcbff) (Darshan Sen) [#&#8203;58120](https://redirect.github.com/nodejs/node/pull/58120)\n-   \\[[`4cc49be951`](https://redirect.github.com/nodejs/node/commit/4cc49be951)] - **deps**: update zstd to 1.5.7 (Node.js GitHub Bot) [#&#8203;57940](https://redirect.github.com/nodejs/node/pull/57940)\n-   \\[[`c956d37c84`](https://redirect.github.com/nodejs/node/commit/c956d37c84)] - **deps**: update zlib to 1.3.0.1-motley-780819f (Node.js GitHub Bot) [#&#8203;57768](https://redirect.github.com/nodejs/node/pull/57768)\n-   \\[[`c3ceaebb7a`](https://redirect.github.com/nodejs/node/commit/c3ceaebb7a)] - **deps**: update timezone to 2025b (Node.js GitHub Bot) [#&#8203;57857](https://redirect.github.com/nodejs/node/pull/57857)\n-   \\[[`b5cd0eb590`](https://redirect.github.com/nodejs/node/commit/b5cd0eb590)] - **deps**: update simdutf to 6.4.2 (Node.js GitHub Bot) [#&#8203;57855](https://redirect.github.com/nodejs/node/pull/57855)\n-   \\[[`3eb6b814e9`](https://redirect.github.com/nodejs/node/commit/3eb6b814e9)] - **deps**: update simdutf to 6.4.0 (Node.js GitHub Bot) [#&#8203;56764](https://redirect.github.com/nodejs/node/pull/56764)\n-   \\[[`0be9fa3218`](https://redirect.github.com/nodejs/node/commit/0be9fa3218)] - **deps**: update icu to 77.1 (Node.js GitHub Bot) [#&#8203;57455](https://redirect.github.com/nodejs/node/pull/57455)\n-   \\[[`d5cf4254fb`](https://redirect.github.com/nodejs/node/commit/d5cf4254fb)] - **doc**: add HBSPS as triager (Wiyeong Seo) [#&#8203;57980](https://redirect.github.com/nodejs/node/pull/57980)\n-   \\[[`ad0861dba0`](https://redirect.github.com/nodejs/node/commit/ad0861dba0)] - **doc**: add ambassaor message (Brian Muenzenmeyer) [#&#8203;57600](https://redirect.github.com/nodejs/node/pull/57600)\n-   \\[[`0d3ec1aafe`](https://redirect.github.com/nodejs/node/commit/0d3ec1aafe)] - **doc**: fix misaligned options in vm.compileFunction() (Jimmy Leung) [#&#8203;58145](https://redirect.github.com/nodejs/node/pull/58145)\n-   \\[[`1f70baf3b0`](https://redirect.github.com/nodejs/node/commit/1f70baf3b0)] - **doc**: add missing options.signal to readlinePromises.createInterface() (Jimmy Leung) [#&#8203;55456](https://redirect.github.com/nodejs/node/pull/55456)\n-   \\[[`ec6a48621f`](https://redirect.github.com/nodejs/node/commit/ec6a48621f)] - **doc**: fix typo of file `zlib.md` (yusheng chen) [#&#8203;58093](https://redirect.github.com/nodejs/node/pull/58093)\n-   \\[[`37e360e386`](https://redirect.github.com/nodejs/node/commit/37e360e386)] - **doc**: make stability labels more consistent (Antoine du Hamel) [#&#8203;57516](https://redirect.github.com/nodejs/node/pull/57516)\n-   \\[[`2b5d63d36e`](https://redirect.github.com/nodejs/node/commit/2b5d63d36e)] - **doc**: allow the $schema property in node.config.json (Remco Haszing) [#&#8203;57560](https://redirect.github.com/nodejs/node/pull/57560)\n-   \\[[`a2063638e2`](https://redirect.github.com/nodejs/node/commit/a2063638e2)] - **doc**: fix `AsyncLocalStorage` example response changes after node v18 (Naor Tedgi (Abu Emma)) [#&#8203;57969](https://redirect.github.com/nodejs/node/pull/57969)\n-   \\[[`474c2b14c3`](https://redirect.github.com/nodejs/node/commit/474c2b14c3)] - **doc**: mark Node.js 18 as End-of-Life (Richard Lau) [#&#8203;58084](https://redirect.github.com/nodejs/node/pull/58084)\n-   \\[[`5059a746ec`](https://redirect.github.com/nodejs/node/commit/5059a746ec)] - **doc**: add dario-piotrowicz to collaborators (Dario Piotrowicz) [#&#8203;58102](https://redirect.github.com/nodejs/node/pull/58102)\n-   \\[[`1eec170fc3`](https://redirect.github.com/nodejs/node/commit/1eec170fc3)] - **doc**: fix formatting of `import.meta.filename` section (Antoine du Hamel) [#&#8203;58079](https://redirect.github.com/nodejs/node/pull/58079)\n-   \\[[`7f108de525`](https://redirect.github.com/nodejs/node/commit/7f108de525)] - **doc**: fix env variable name in `util.styleText` (Antoine du Hamel) [#&#8203;58072](https://redirect.github.com/nodejs/node/pull/58072)\n-   \\[[`54b3f7fffc`](https://redirect.github.com/nodejs/node/commit/54b3f7fffc)] - **doc**: add returns for https.get (Eng Zer Jun) [#&#8203;58025](https://redirect.github.com/nodejs/node/pull/58025)\n-   \\[[`66f2c605a8`](https://redirect.github.com/nodejs/node/commit/66f2c605a8)] - **doc**: fix typo in `buffer.md` (chocolateboy) [#&#8203;58052](https://redirect.github.com/nodejs/node/pull/58052)\n-   \\[[`b0256dd42b`](https://redirect.github.com/nodejs/node/commit/b0256dd42b)] - **doc**: correct deprecation type of `assert.CallTracker` (Ren\u00e9) [#&#8203;57997](https://redirect.github.com/nodejs/node/pull/57997)\n-   \\[[`581439c9e6`](https://redirect.github.com/nodejs/node/commit/581439c9e6)] - **doc**: mark devtools integration section as active development (Chengzhong Wu) [#&#8203;57886](https://redirect.github.com/nodejs/node/pull/57886)\n-   \\[[`a2a2a2f027`](https://redirect.github.com/nodejs/node/commit/a2a2a2f027)] - **doc**: fix typo in `module.md` (Alex Schwartz) [#&#8203;57889](https://redirect.github.com/nodejs/node/pull/57889)\n-   \\[[`c0ec4e2935`](https://redirect.github.com/nodejs/node/commit/c0ec4e2935)] - **doc**: increase z-index of header element (Dario Piotrowicz) [#&#8203;57851](https://redirect.github.com/nodejs/node/pull/57851)\n-   \\[[`93d19ec6cd`](https://redirect.github.com/nodejs/node/commit/93d19ec6cd)] - **doc**: add missing TS formats for `load` hooks (Antoine du Hamel) [#&#8203;57837](https://redirect.github.com/nodejs/node/pull/57837)\n-   \\[[`f5ea06c61f`](https://redirect.github.com/nodejs/node/commit/f5ea06c61f)] - **doc**: clarify the multi REPL example (Dario Piotrowicz) [#&#8203;57759](https://redirect.github.com/nodejs/node/pull/57759)\n-   \\[[`80c4fe1b70`](https://redirect.github.com/nodejs/node/commit/80c4fe1b70)] - **doc**: fix deprecation type for `DEP0148` (Livia Medeiros) [#&#8203;57785](https://redirect.github.com/nodejs/node/pull/57785)\n-   \\[[`01cad99da0`](https://redirect.github.com/nodejs/node/commit/01cad99da0)] - **doc**: list DOMException as a potential error raised by Node.js (Chengzhong Wu) [#&#8203;57783](https://redirect.github.com/nodejs/node/pull/57783)\n-   \\[[`a08b714a46`](https://redirect.github.com/nodejs/node/commit/a08b714a46)] - **doc**: add missing v0.x changelog entries (Antoine du Hamel) [#&#8203;57779](https://redirect.github.com/nodejs/node/pull/57779)\n-   \\[[`d0b48350fd`](https://redirect.github.com/nodejs/node/commit/d0b48350fd)] - **doc**: fix typo in writing-docs (Sebastian Beltran) [#&#8203;57776](https://redirect.github.com/nodejs/node/pull/57776)\n-   \\[[`bde3725f8b`](https://redirect.github.com/nodejs/node/commit/bde3725f8b)] - **doc**: clarify examples section in REPL doc (Dario Piotrowicz) [#&#8203;57762](https://redirect.github.com/nodejs/node/pull/57762)\n-   \\[[`c8ceaaf397`](https://redirect.github.com/nodejs/node/commit/c8ceaaf397)] - **(SEMVER-MINOR)** **doc**: graduate multiple experimental apis (James M Snell) [#&#8203;57765](https://redirect.github.com/nodejs/node/pull/57765)\n-   \\[[`92428c2609`](https://redirect.github.com/nodejs/node/commit/92428c2609)] - **doc**: explicitly state that corepack will be removed in v25+ (Trivikram Kamat) [#&#8203;57747](https://redirect.github.com/nodejs/node/pull/57747)\n-   \\[[`298969e1dd`](https://redirect.github.com/nodejs/node/commit/298969e1dd)] - **doc**: update position type to integer | null in fs (Yukihiro Hasegawa) [#&#8203;57745](https://redirect.github.com/nodejs/node/pull/57745)\n-   \\[[`a9d28e27c9`](https://redirect.github.com/nodejs/node/commit/a9d28e27c9)] - **doc**: update CI instructions (Antoine du Hamel) [#&#8203;57743](https://redirect.github.com/nodejs/node/pull/57743)\n-   \\[[`133d2878a1`](https://redirect.github.com/nodejs/node/commit/133d2878a1)] - **doc**: update example of using `await` in REPL (Dario Piotrowicz) [#&#8203;57653](https://redirect.github.com/nodejs/node/pull/57653)\n-   \\[[`fc5f126629`](https://redirect.github.com/nodejs/node/commit/fc5f126629)] - **doc**: add back mention of visa fees to onboarding doc (Darshan Sen) [#&#8203;57730](https://redirect.github.com/nodejs/node/pull/57730)\n-   \\[[`945f4ac538`](https://redirect.github.com/nodejs/node/commit/945f4ac538)] - **doc**: process.execve is only unavailable for Windows (Yaksh Bariya) [#&#8203;57726](https://redirect.github.com/nodejs/node/pull/57726)\n-   \\[[`f3b885bb5e`](https://redirect.github.com/nodejs/node/commit/f3b885bb5e)] - **doc**: clarify `unhandledRejection` events behaviors in process doc (Dario Piotrowicz) [#&#8203;57654](https://redirect.github.com/nodejs/node/pull/57654)\n-   \\[[`7326dda5b0`](https://redirect.github.com/nodejs/node/commit/7326dda5b0)] - **doc**: improved fetch docs (Alessandro Miliucci) [#&#8203;57296](https://redirect.github.com/nodejs/node/pull/57296)\n-   \\[[`6906c5eb1f`](https://redirect.github.com/nodejs/node/commit/6906c5eb1f)] - **doc**: document REPL custom eval arguments (Dario Piotrowicz) [#&#8203;57690](https://redirect.github.com/nodejs/node/pull/57690)\n-   \\[[`47a7564e8f`](https://redirect.github.com/nodejs/node/commit/47a7564e8f)] - **doc**: classify Chrome DevTools Protocol as tier 2 (Chengzhong Wu) [#&#8203;57634](https://redirect.github.com/nodejs/node/pull/57634)\n-   \\[[`e274cc1310`](https://redirect.github.com/nodejs/node/commit/e274cc1310)] - **doc**: replace NOTE that does not render properly (Colin Ihrig) [#&#8203;57484](https://redirect.github.com/nodejs/node/pull/57484)\n-   \\[[`bef06b11df`](https://redirect.github.com/nodejs/node/commit/bef06b11df)] - **esm**: avoid `import.meta` setup costs for unused properties (Antoine du Hamel) [#&#8203;57286](https://redirect.github.com/nodejs/node/pull/57286)\n-   \\[[`e21b37d9df`](https://redirect.github.com/nodejs/node/commit/e21b37d9df)] - **(SEMVER-MINOR)** **esm**: graduate import.meta properties (James M Snell) [#&#8203;58011](https://redirect.github.com/nodejs/node/pull/58011)\n-   \\[[`832640c35e`](https://redirect.github.com/nodejs/node/commit/832640c35e)] - **(SEMVER-MINOR)** **esm**: support top-level Wasm without package type (Guy Bedford) [#&#8203;57610](https://redirect.github.com/nodejs/node/pull/57610)\n-   \\[[`8f643471ef`](https://redirect.github.com/nodejs/node/commit/8f643471ef)] - **fs**: improve globSync performance (Rich Trott) [#&#8203;57725](https://redirect.github.com/nodejs/node/pull/57725)\n-   \\[[`bf9e17ecc6`](https://redirect.github.com/nodejs/node/commit/bf9e17ecc6)] - **http2**: use args.This() instead of args.Holder() (Joyee Cheung) [#&#8203;58004](https://redirect.github.com/nodejs/node/pull/58004)\n-   \\[[`137717354f`](https://redirect.github.com/nodejs/node/commit/137717354f)] - **http2**: fix graceful session close (Kushagra Pandey) [#&#8203;57808](https://redirect.github.com/nodejs/node/pull/57808)\n-   \\[[`9baf580269`](https://redirect.github.com/nodejs/node/commit/9baf580269)] - **http2**: fix check for `frame->hd.type` (hanguanqiang) [#&#8203;57644](https://redirect.github.com/nodejs/node/pull/57644)\n-   \\[[`b8189242b2`](https://redirect.github.com/nodejs/node/commit/b8189242b2)] - **http2**: skip writeHead if stream is closed (Shima Ryuhei) [#&#8203;57686](https://redirect.github.com/nodejs/node/pull/57686)\n-   \\[[`4e02a1650a`](https://redirect.github.com/nodejs/node/commit/4e02a1650a)] - **lib**: remove unused file `fetch_module` (Micha\u00ebl Zasso) [#&#8203;55880](https://redirect.github.com/nodejs/node/pull/55880)\n-   \\[[`d9700fef26`](https://redirect.github.com/nodejs/node/commit/d9700fef26)] - **lib**: avoid StackOverflow on `serializeError` (Chengzhong Wu) [#&#8203;58075](https://redirect.github.com/nodejs/node/pull/58075)\n-   \\[[`f3a16b6d9c`](https://redirect.github.com/nodejs/node/commit/f3a16b6d9c)] - **lib**: resolve the issue of not adhering to the specified buffer size (0hm\u2618\ufe0f\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f) [#&#8203;55896](https://redirect.github.com/nodejs/node/pull/55896)\n-   \\[[`d4fc282f73`](https://redirect.github.com/nodejs/node/commit/d4fc282f73)] - **lib**: fix AbortSignal.any() with timeout signals (G\u00fcrg\u00fcn Day\u0131o\u011flu) [#&#8203;57867](https://redirect.github.com/nodejs/node/pull/57867)\n-   \\[[`f7e2902861`](https://redirect.github.com/nodejs/node/commit/f7e2902861)] - **lib**: use Map primordial for ActiveAsyncContextFrame (G\u00fcrg\u00fcn Day\u0131o\u011flu) [#&#8203;57670](https://redirect.github.com/nodejs/node/pull/57670)\n-   \\[[`8652b0e168`](https://redirect.github.com/nodejs/node/commit/8652b0e168)] - **meta**: set nodejs/config as codeowner (Marco Ippolito) [#&#8203;57237](https://redirect.github.com/nodejs/node/pull/57237)\n-   \\[[`e98504ed95`](https://redirect.github.com/nodejs/node/commit/e98504ed95)] - **meta**: allow penetration testing on live system with prior authorization (Matteo Collina) [#&#8203;57966](https://redirect.github.com/nodejs/node/pull/57966)\n-   \\[[`340731bea0`](https://redirect.github.com/nodejs/node/commit/340731bea0)] - **meta**: fix subsystem in commit title (Luigi Pinca) [#&#8203;57945](https://redirect.github.com/nodejs/node/pull/57945)\n-   \\[[`d767cbffcf`](https://redirect.github.com/nodejs/node/commit/d767cbffcf)] - **meta**: bump Mozilla-Actions/sccache-action from 0.0.8 to 0.0.9 (dependabot\\[bot]) [#&#8203;57720](https://redirect.github.com/nodejs/node/pull/57720)\n-   \\[[`575f904b13`](https://redirect.github.com/nodejs/node/commit/575f904b13)] - **meta**: bump actions/download-artifact from 4.1.9 to 4.2.1 (dependabot\\[bot]) [#&#8203;57719](https://redirect.github.com/nodejs/node/pull/57719)\n-   \\[[`acd323c069`](https://redirect.github.com/nodejs/node/commit/acd323c069)] - **meta**: bump actions/setup-python from 5.4.0 to 5.5.0 (dependabot\\[bot]) [#&#8203;57718](https://redirect.github.com/nodejs/node/pull/57718)\n-   \\[[`21246fec20`](https://redirect.github.com/nodejs/node/commit/21246fec20)] - **meta**: bump peter-evans/create-pull-request from 7.0.7 to 7.0.8 (dependabot\\[bot]) [#&#8203;57717](https://redirect.github.com/nodejs/node/pull/57717)\n-   \\[[`97f32d5849`](https://redirect.github.com/nodejs/node/commit/97f32d5849)] - **meta**: bump github/codeql-action from 3.28.10 to 3.28.13 (dependabot\\[bot]) [#&#8203;57716](https://redirect.github.com/nodejs/node/pull/57716)\n-   \\[[`90ddbb8cfa`](https://redirect.github.com/nodejs/node/commit/90ddbb8cfa)] - **meta**: bump actions/cache from 4.2.2 to 4.2.3 (dependabot\\[bot]) [#&#8203;57715](https://redirect.github.com/nodejs/node/pull/57715)\n-   \\[[`728425d03e`](https://redirect.github.com/nodejs/node/commit/728425d03e)] - **meta**: bump actions/setup-node from 4.2.0 to 4.3.0 (dependabot\\[bot]) [#&#8203;57714](https://redirect.github.com/nodejs/node/pull/57714)\n-   \\[[`1f799140e0`](https://redirect.github.com/nodejs/node/commit/1f799140e0)] - **meta**: bump actions/upload-artifact from 4.6.1 to 4.6.2 (dependabot\\[bot]) [#&#8203;57713](https://redirect.github.com/nodejs/node/pull/57713)\n-   \\[[`021b174a1f`](https://redirect.github.com/nodejs/node/commit/021b174a1f)] - **module**: tidy code string concat \u2192 string templates (Jacob Smith) [#&#8203;55820](https://redirect.github.com/nodejs/node/pull/55820)\n-   \\[[`44c5718476`](https://redirect.github.com/nodejs/node/commit/44c5718476)] - **module**: fix incorrect formatting in require(esm) cycle error message (haykam821) [#&#8203;57453](https://redirect.github.com/nodejs/node/pull/57453)\n-   \\[[`bb09b4d4ae`](https://redirect.github.com/nodejs/node/commit/bb09b4d4ae)] - **module**: improve `getPackageType` performance (Dario Piotrowicz) [#&#8203;57599](https://redirect.github.com/nodejs/node/pull/57599)\n-   \\[[`9e6054e715`](https://redirect.github.com/nodejs/node/commit/9e6054e715)] - **module**: remove unnecessary `readPackage` function (Dario Piotrowicz) [#&#8203;57596](https://redirect.github.com/nodejs/node/pull/57596)\n-   \\[[`4a8db273ba`](https://redirect.github.com/nodejs/node/commit/4a8db273ba)] - **node-api**: add nested object wrap and napi_ref test (Chengzhong Wu) [#&#8203;57981](https://redirect.github.com/nodejs/node/pull/57981)\n-   \\[[`3c65058f20`](https://redirect.github.com/nodejs/node/commit/3c65058f20)] - **node-api**: convert NewEnv to node_napi_env\\_\\_::New (Vladimir Morozov) [#&#8203;57834](https://redirect.github.com/nodejs/node/pull/57834)\n-   \\[[`a4105db1f7`](https://redirect.github.com/nodejs/node/commit/a4105db1f7)] - **os**: fix netmask format check condition in getCIDR function (Wiyeong Seo) [#&#8203;57324](https://redirect.github.com/nodejs/node/pull/57324)\n-   \\[[`248c938139`](https://redirect.github.com/nodejs/node/commit/248c938139)] - **process**: disable building execve on IBM i (Abdirahim Musse) [#&#8203;57883](https://redirect.github.com/nodejs/node/pull/57883)\n-   \\[[`972275697a`](https://redirect.github.com/nodejs/node/commit/972275697a)] - **repl**: deprecate `repl.builtinModules` (Dario Piotrowicz) [#&#8203;57508](https://redirect.github.com/nodejs/node/pull/57508)\n-   \\[[`7485309d7e`](https://redirect.github.com/nodejs/node/commit/7485309d7e)] - **sqlite**: add location method (Edy Silva) [#&#8203;57860](https://redirect.github.com/nodejs/node/pull/57860)\n-   \\[[`c12cd2a190`](https://redirect.github.com/nodejs/node/commit/c12cd2a190)] - **sqlite**: add timeout options to DatabaseSync (Edy Silva) [#&#8203;57752](https://redirect.github.com/nodejs/node/pull/57752)\n-   \\[[`5e0503a967`](https://redirect.github.com/nodejs/node/commit/5e0503a967)] - **sqlite**: add setReturnArrays method to StatementSync (G\u00fcrg\u00fcn Day\u0131o\u011flu) [#&#8203;57542](https://redirect.github.com/nodejs/node/pull/57542)\n-   \\[[`ed9d2fd51a`](https://redirect.github.com/nodejs/node/commit/ed9d2fd51a)] - **sqlite**: enable common flags (Edy Silva) [#&#8203;57621](https://redirect.github.com/nodejs/node/pull/57621)\n-   \\[[`06dcb318bc`](https://redirect.github.com/nodejs/node/commit/06dcb318bc)] - **sqlite**: refactor prepared statement iterator (Colin Ihrig) [#&#8203;57569](https://redirect.github.com/nodejs/node/pull/57569)\n-   \\[[`c510391d2f`](https://redirect.github.com/nodejs/node/commit/c510391d2f)] - **(SEMVER-MINOR)** **sqlite**: add StatementSync.prototype.columns() (Colin Ihrig) [#&#8203;57490](https://redirect.github.com/nodejs/node/pull/57490)\n-   \\[[`4e24456a1a`](https://redirect.github.com/nodejs/node/commit/4e24456a1a)] - **sqlite**: reset statement immediately in run() (Colin Ihrig) [#&#8203;57350](https://redirect.github.com/nodejs/node/pull/57350)\n-   \\[[`a9a6891b0b`](https://redirect.github.com/nodejs/node/commit/a9a6891b0b)] - **sqlite**: fix coverity warnings related to backup() (Colin Ihrig) [#&#8203;56961](https://redirect.github.com/nodejs/node/pull/56961)\n-   \\[[`d2e1bcf3d4`](https://redirect.github.com/nodejs/node/commit/d2e1bcf3d4)] - **sqlite**: fix use-after-free in StatementSync due to premature GC (Divy Srivastava) [#&#8203;56840](https://redirect.github.com/nodejs/node/pull/56840)\n-   \\[[`cfe15ca7b4`](https://redirect.github.com/nodejs/node/commit/cfe15ca7b4)] - **sqlite**: handle conflicting SQLite and JS errors (Colin Ihrig) [#&#8203;56787](https://redirect.github.com/nodejs/node/pull/56787)\n-   \\[[`0e999eb65f`](https://redirect.github.com/nodejs/node/commit/0e999eb65f)] - **sqlite**: add getter to detect transactions (Colin Ihrig) [#&#8203;57925](https://redirect.github.com/nodejs/node/pull/57925)\n-   \\[[`20b27331c0`](https://redirect.github.com/nodejs/node/commit/20b27331c0)] - **sqlite, test**: expose sqlite online backup api (Edy Silva) [#&#8203;56253](https://redirect.github.com/nodejs/node/pull/56253)\n-   \\[[`8856712171`](https://redirect.github.com/nodejs/node/commit/8856712171)] - **sqlite,doc,test**: add aggregate function (Edy Silva) [#&#8203;56600](https://redirect.github.com/nodejs/node/pull/56600)\n-   \\[[`120050db97`](https://redirect.github.com/nodejs/node/commit/120050db97)] - **sqlite,src**: refactor sqlite value conversion (Edy Silva) [#&#8203;57571](https://redirect.github.com/nodejs/node/pull/57571)\n-   \\[[`4c5555d558`](https://redirect.github.com/nodejs/node/commit/4c5555d558)] - **src**: initialize privateSymbols for per_context (Jason Zhang) [#&#8203;57479](https://redirect.github.com/nodejs/node/pull/57479)\n-   \\[[`d2ce9023b1`](https://redirect.github.com/nodejs/node/commit/d2ce9023b1)] - **src**: ensure primordials are initialized exactly once (Chengzhong Wu) [#&#8203;57519](https://redirect.github.com/nodejs/node/pull/57519)\n-   \\[[`06179be6ca`](https://redirect.github.com/nodejs/node/commit/06179be6ca)] - **src**: disable abseil deadlock detection (Chengzhong Wu) [#&#8203;57582](https://redirect.github.com/nodejs/node/pull/57582)\n-   \\[[`5121c47990`](https://redirect.github.com/nodejs/node/commit/5121c47990)] - **src**: fix node_config_file.h compilation error in GN build (Cheng) [#&#8203;57210](https://redirect.github.com/nodejs/node/pull/57210)\n-   \\[[`5d1230bec0`](https://redirect.github.com/nodejs/node/commit/5d1230bec0)] - **(SEMVER-MINOR)** **src**: set default config as `node.config.json` (Marco Ippolito) [#&#8203;57171](https://redirect.github.com/nodejs/node/pull/57171)\n-   \\[[`ccee741c43`](https://redirect.github.com/nodejs/node/commit/ccee741c43)] - **src**: namespace config file flags (Marco Ippolito) [#&#8203;57170](https://redirect.github.com/nodejs/node/pull/57170)\n-   \\[[`30bb1ccbb0`](https://redirect.github.com/nodejs/node/commit/30bb1ccbb0)] - **(SEMVER-MINOR)** **src**: create `THROW_ERR_OPTIONS_BEFORE_BOOTSTRAPPING` (Marco Ippolito) [#&#8203;57016](https://redirect.github.com/nodejs/node/pull/57016)\n-   \\[[`0350c6f478`](https://redirect.github.com/nodejs/node/commit/0350c6f478)] - **(SEMVER-MINOR)** **src**: add config file support (Marco Ippolito) [#&#8203;57016](https://redirect.github.com/nodejs/node/pull/57016)\n-   \\[[`eef37d00cb`](https://redirect.github.com/nodejs/node/commit/eef37d00cb)] - **src**: add more debug logs and comments in NodePlatform (Joyee Cheung) [#&#8203;58047](https://redirect.github.com/nodejs/node/pull/58047)\n-   \\[[`678e8f57c0`](https://redirect.github.com/nodejs/node/commit/678e8f57c0)] - **src**: add dcheck_eq for Object::New constructor calls (Jonas) [#&#8203;57943](https://redirect.github.com/nodejs/node/pull/57943)\n-   \\[[`aee45e2036`](https://redirect.github.com/nodejs/node/commit/aee45e2036)] - **src**: move windows specific fns to `_WIN32` (Yagiz Nizipli) [#&#8203;57951](https://redirect.github.com/nodejs/node/pull/57951)\n-   \\[[`6206a8edbc`](https://redirect.github.com/nodejs/node/commit/6206a8edbc)] - **src**: improve thread safety of TaskQueue (Shelley Vohr) [#&#8203;57910](https://redirect.github.com/nodejs/node/pull/57910)\n-   \\[[`03936f31c1`](https://redirect.github.com/nodejs/node/commit/03936f31c1)] - **src**: fixup errorhandling more in various places (James M Snell) [#&#8203;57852](https://redirect.github.com/nodejs/node/pull/57852)\n-   \\[[`010dd91a19`](https://redirect.github.com/nodejs/node/commit/010dd91a19)] - **src**: fix typo in comments (Edy Silva) [#&#8203;57868](https://redirect.github.com/nodejs/node/pull/57868)\n-   \\[[`e00c1ecbd2`](https://redirect.github.com/nodejs/node/commit/e00c1ecbd2)] - **src**: add BaseObjectPtr nullptr operations (Chengzhong Wu) [#&#8203;56585](https://redirect.github.com/nodejs/node/pull/56585)\n-   \\[[`648ad252e1`](https://redirect.github.com/nodejs/node/commit/648ad252e1)] - **src**: remove `void*` -> `char*` -> `void*` casts (Tobias Nie\u00dfen) [#&#8203;57791](https://redirect.github.com/nodejs/node/pull/57791)\n-   \\[[`680b434a62`](https://redirect.github.com/nodejs/node/commit/680b434a62)] - **src**: improve error handing in node_messaging (James M Snell) [#&#8203;57760](https://redirect.github.com/nodejs/node/pull/57760)\n-   \\[[`18f5301747`](https://redirect.github.com/nodejs/node/commit/18f5301747)] - **src**: remove unused detachArrayBuffer method (Yagiz Nizipli) [#&#8203;58055](https://redirect.github.com/nodejs/node/pull/58055)\n-   \\[[`065e8cd670`](https://redirect.github.com/nodejs/node/commit/065e8cd670)] - **src**: use macros to reduce code duplication is cares_wrap (James M Snell) [#&#8203;57937](https://redirect.github.com/nodejs/node/pull/57937)\n-   \\[[`39af5d678f`](https://redirect.github.com/nodejs/node/commit/39af5d678f)] - **src**: improve error handling in cares_wrap (James M Snell) [#&#8203;57937](https://redirect.github.com/nodejs/node/pull/57937)\n-   \\[[`ca020fdc4e`](https://redirect.github.com/nodejs/node/commit/ca020fdc4e)] - **src**: fix -Wunreachable-code-return in node_sea (Shelley Vohr) [#&#8203;57664](https://redirect.github.com/nodejs/node/pull/57664)\n-   \\[[`32b6e7094a`](https://redirect.github.com/nodejs/node/commit/32b6e7094a)] - **src**: change DCHECK to CHECK (Wuli Zuo) [#&#8203;57948](https://redirect.github.com/nodejs/node/pull/57948)\n-   \\[[`e1d3a9e192`](https://redirect.github.com/nodejs/node/commit/e1d3a9e192)] - **(SEMVER-MINOR)** **src**: add ExecutionAsyncId getter for any Context (Attila Szegedi) [#&#8203;57820](https://redirect.github.com/nodejs/node/pull/57820)\n-   \\[[`96243a723a`](https://redirect.github.com/nodejs/node/commit/96243a723a)] - **src**: update std::vector\\<v8::Local\\<T>> to use v8::LocalVector\\<T> (Aditi) [#&#8203;57646](https://redirect.github.com/nodejs/node/pull/57646)\n-   \\[[`0f2cbc17c7`](https://redirect.github.com/nodejs/node/commit/0f2cbc17c7)] - **src**: update std::vector\\<v8::Local\\<T>> to use v8::LocalVector\\<T> (Aditi) [#&#8203;57642](https://redirect.github.com/nodejs/node/pull/57642)\n-   \\[[`d1c6f861d5`](https://redirect.github.com/nodejs/node/commit/d1c6f861d5)] - **src**: update std::vector\\<v8::Local\\<T>> to use v8::LocalVector\\<T> (Aditi) [#&#8203;57578](https://redirect.github.com/nodejs/node/pull/57578)\n-   \\[[`ab0d3a38db`](https://redirect.github.com/nodejs/node/commit/ab0d3a38db)] - **src**: improve error message for invalid child stdio type in spawn_sync (Dario Piotrowicz) [#&#8203;57589](https://redirect.github.com/nodejs/node/pull/57589)\n-   \\[[`24b182e7b3`](https://redirect.github.com/nodejs/node/commit/24b182e7b3)] - **src**: implement util.types fast API calls (Ruben Bridgewater) [#&#8203;57819](https://redirect.github.com/nodejs/node/pull/57819)\n-   \\[[`dda6423be9`](https://redirect.github.com/nodejs/node/commit/dda6423be9)] - **src**: enter and lock isolate properly in json parser (Joyee Cheung) [#&#8203;57823](https://redirect.github.com/nodejs/node/pull/57823)\n-   \\[[`4754c693f8`](https://redirect.github.com/nodejs/node/commit/4754c693f8)] - **src**: improve error handling in `node_env_var.cc` (Antoine du Hamel) [#&#8203;57767](https://redirect.github.com/nodejs/node/pull/57767)\n-   \\[[`db483bbe63`](https://redirect.github.com/nodejs/node/commit/db483bbe63)] - **src**: improve error handling in node_http2 (James M Snell) [#&#8203;57764](https://redirect.github.com/nodejs/node/pull/57764)\n-   \\[[`b0277700d6`](https://redirect.github.com/nodejs/node/commit/b0277700d6)] - **src**: improve error handling in crypto_x509 (James M Snell) [#&#8203;57757](https://redirect.github.com/nodejs/node/pull/57757)\n-   \\[[`353587f984`](https://redirect.github.com/nodejs/node/commit/353587f984)] - **src**: improve error handling in callback.cc (James M Snell) [#&#8203;57758](https://redirect.github.com/nodejs/node/pull/57758)\n-   \\[[`bec053ab20`](https://redirect.github.com/nodejs/node/commit/bec053ab20)] - **src**: remove unused variable in crypto_x509.cc (Micha\u00ebl Zasso) [#&#8203;57754](https://redirect.github.com/nodejs/node/pull/57754)\n-   \\[[`38a329a857`](https://redirect.github.com/nodejs/node/commit/38a329a857)] - **src**: fix kill signal 0 on Windows (Stefan Stojanovic) [#&#8203;57695](https://redirect.github.com/nodejs/node/pull/57695)\n-   \\[[`70bb387f82`](https://redirect.github.com/nodejs/node/commit/70bb387f82)] - **src**: fix inefficient usage of v8\\_inspector::StringView (Simon Z\u00fcnd) [#&#8203;52372](https://redirect.github.com/nodejs/node/pull/52372)\n-   \\[[`be038f0273`](https://redirect.github.com/nodejs/node/commit/be038f0273)] - **src,permission**: make ERR_ACCESS_DENIED more descriptive (Rafael Gonzaga) [#&#8203;57585](https://redirect.github.com/nodejs/node/pull/57585)\n-   \\[[`0ec912f452`](https://redirect.github.com/nodejs/node/commit/0ec912f452)] - **(SEMVER-MINOR)** **stream**: preserve AsyncLocalStorage context in finished() (G\u00fcrg\u00fcn Day\u0131o\u011flu) [#&#8203;57865](https://redirect.github.com/nodejs/node/pull/57865)\n-   \\[[`6ffb66f82f`](https://redirect.github.com/nodejs/node/commit/6ffb66f82f)] - **test**: fix permission fixtures lint (Rafael Gonzaga) [#&#8203;55819](https://redirect.github.com/nodejs/node/pull/55819)\n-   \\[[`fd37891186`](https://redirect.github.com/nodejs/node/commit/fd37891186)] - **test**: add repl preview timeout test (Chengzhong Wu) [#&#8203;55484](https://redirect.github.com/nodejs/node/pull/55484)\n-   \\[[`1be5a8c1b4`](https://redirect.github.com/nodejs/node/commit/1be5a8c1b4)] - **test**: skip `test-config-json-schema` with quic (Richard Lau) [#&#8203;57225](https://redirect.github.com/nodejs/node/pull/57225)\n-   \\[[`e90583b657`](https://redirect.github.com/nodejs/node/commit/e90583b657)] - **test**: add more coverage to `node_config_file` (Marco Ippolito) [#&#8203;57170](https://redirect.github.com/nodejs/node/pull/57170)\n-   \\[[`df2a36bfcc`](https://redirect.github.com/nodejs/node/commit/df2a36bfcc)] - **test**: remove deadlock workaround (Joyee Cheung) [#&#8203;58047](https://redirect.github.com/nodejs/node/pull/58047)\n-   \\[[`103034b051`](https://redirect.github.com/nodejs/node/commit/103034b051)] - **test**: prevent extraneous HOSTNAME substitution in test-runner-output (Ren\u00e9) [#&#8203;58076](https://redirect.github.com/nodejs/node/pull/58076)\n-   \\[[`3e58f81a38`](https://redirect.github.com/nodejs/node/commit/3e58f81a38)] - **test**: update WPT for WebCryptoAPI to [`b48efd6`](https://redirect.github.com/nodejs/node/commit/b48efd681e) (Node.js GitHub Bot) [#&#8203;58044](https://redirect.github.com/nodejs/node/pull/58044)\n-   \\[[`2f4e4164a3`](https://redirect.github.com/nodejs/node/commit/2f4e4164a3)] - **test**: add missing newlines to repl .exit writes (Dario Piotrowicz) [#&#8203;58041](https://redirect.github.com/nodejs/node/pull/58041)\n-   \\[[`b40769292e`](https://redirect.github.com/nodejs/node/commit/b40769292e)] - **test**: add fast api tests for getLibuvNow() (Yagiz Nizipli) [#&#8203;58022](https://redirect.github.com/nodejs/node/pull/58022)\n-   \\[[`cbd5768d47`](https://redirect.github.com/nodejs/node/commit/cbd5768d47)] - **test**: add ALS test using http agent keep alive (Gerhard St\u00f6bich) [#&#8203;58017](https://redirect.github.com/nodejs/node/pull/58017)\n-   \\[[`9e31ab502a`](https://redirect.github.com/nodejs/node/commit/9e31ab502a)] - **test**: deflake test-http2-options-max-headers-block-length (Luigi Pinca) [#&#8203;57959](https://redirect.github.com/nodejs/node/pull/57959)\n-   \\[[`13f8f9cc12`](https://redirect.github.com/nodejs/node/commit/13f8f9cc12)] - **test**: rename to getCallSites (Wuli Zuo) [#&#8203;57948](https://redirect.github.com/nodejs/node/pull/57948)\n-   \\[[`92dce6ed6b`](https://redirect.github.com/nodejs/node/commit/92dce6ed6b)] - **test**: force GC in test-file-write-stream4 (Luigi Pinca) [#&#8203;57930](https://redirect.github.com/nodejs/node/pull/57930)\n-   \\[[`aa755d3acf`](https://redirect.github.com/nodejs/node/commit/aa755d3acf)] - **test**: enable skipped colorize test (Shima Ryuhei) [#&#8203;57887](https://redirect.github.com/nodejs/node/pull/57887)\n-   \\[[`331f44c78c`](https://redirect.github.com/nodejs/node/commit/331f44c78c)] - **test**: update WPT for WebCryptoAPI to [`164426a`](https://redirect.github.com/nodejs/node/commit/164426ace2) (Node.js GitHub Bot) [#&#8203;57854](https://redirect.github.com/nodejs/node/pull/57854)\n-   \\[[`4aaa8438b4`](https://redirect.github.com/nodejs/node/commit/4aaa8438b4)] - **test**: add test for frame count being 0.5 (Jake Yuesong Li) [#&#8203;57732](https://redirect.github.com/nodejs/node/pull/57732)\n-   \\[[`fb51d3a0c5`](https://redirect.github.com/nodejs/node/commit/fb51d3a0c5)] - **test**: fix the decimal fractions explaination (Jake Yuesong Li) [#&#8203;57732](https://redirect.github.com/nodejs/node/pull/57732)\n-   \\[[`c6a45a9087`](https://redirect.github.com/nodejs/node/commit/c6a45a9087)] - ***Revert*** \"**test**: add tests for REPL custom evals\" (Tobias Nie\u00dfen) [#&#8203;57793](https://redirect.github.com/nodejs/node/pull/57793)\n-   \\[[`f3a4d03963`](https://redirect.github.com/nodejs/node/commit/f3a4d03963)] - **test**: add tests for REPL custom evals (Dario Piotrowicz) [#&#8203;57691](https://redirect.github.com/nodejs/node/pull/57691)\n-   \\[[`a3be0df337`](https://redirect.github.com/nodejs/node/commit/a3be0df337)] - **test**: update expected error message for macOS (Antoine du Hamel) [#&#8203;57742](https://redirect.github.com/nodejs/node/pull/57742)\n-   \\[[`a7e73a0a74`](https://redirect.github.com/nodejs/node/commit/a7e73a0a74)] - **test**: fix dangling promise in test_runner no isolation test setup (Jacob Smith) [#&#8203;57595](https://redirect.github.com/nodejs/node/pull/57595)\n-   \\[[`edb7dd1ec7`](https://redirect.github.com/nodejs/node/commit/edb7dd1ec7)] - **test_runner**: match minimum file column to 'all files' (Shima Ryuhei) [#&#8203;57848](https://redirect.github.com/nodejs/node/pull/57848)\n-   \\[[`c56f495e83`](https://redirect.github.com/nodejs/node/commit/c56f495e83)] - **tools**: extract target abseil to abseil.gyp (Chengzhong Wu) [#&#8203;57289](https://redirect.github.com/nodejs/node/pull/57289)\n-   \\[[`1b37161a27`](https://redirect.github.com/nodejs/node/commit/1b37161a27)] - **tools**: ignore V8 tests in CodeQL scans (Rich Trott) [#&#8203;58081](https://redirect.github.com/nodejs/node/pull/58081)\n-   \\[[`23386308dd`](https://redirect.github.com/nodejs/node/commit/23386308dd)] - **tools**: enable CodeQL config file (Rich Trott) [#&#8203;58036](https://redirect.github.com/nodejs/node/pull/58036)\n-   \\[[`9c21abc169`](https://redirect.github.com/nodejs/node/commit/9c21abc169)] - **tools**: ignore test directory in CodeQL scans (Rich Trott) [#&#8203;57978](https://redirect.github.com/nodejs/node/pull/57978)\n-   \\[[`f210a1530d`](https://redirect.github.com/nodejs/node/commit/f210a1530d)] - **tools**: add semver-major release support to release-lint (Antoine du Hamel) [#&#8203;57892](https://redirect.github.com/nodejs/node/pull/57892)\n-   \\[[`234c417e98`](https://redirect.github.com/nodejs/node/commit/234c417e98)] - **tools**: add codeql nightly (Rafael Gonzaga) [#&#8203;57788](https://redirect.github.com/nodejs/node/pull/57788)\n-   \\[[`938f1532da`](https://redirect.github.com/nodejs/node/commit/938f1532da)] - **tools**: edit create-release-proposal workflow to handle pr body length (Elves Vieira) [#&#8203;57841](https://redirect.github.com/nodejs/node/pull/57841)\n-   \\[[`b362339f72`](https://redirect.github.com/nodejs/node/commit/b362339f72)] - **tools**: add zstd updater to workflow (KASEYA\\yahor.siarheyenka) [#&#8203;57831](https://redirect.github.com/nodejs/node/pull/57831)\n-   \\[[`61180db9c0`](https://redirect.github.com/nodejs/node/commit/61180db9c0)] - **tools**: remove unused `osx-pkg-postinstall.sh` (Antoine du Hamel) [#&#8203;57667](https://redirect.github.com/nodejs/node/pull/57667)\n-   \\[[`3ae04c94eb`](https://redirect.github.com/nodejs/node/commit/3ae04c94eb)] - **tools**: do not use temp files when merging PRs (Antoine du Hamel) [#&#8203;57790](https://redirect.github.com/nodejs/node/pull/57790)\n-   \\[[`d623c2c2b4`](https://redirect.github.com/nodejs/node/commit/d623c2c2b4)] - **tools**: update gyp-next to 0.20.0 (Node.js GitHub Bot) [#&#8203;57683](https://redirect.github.com/nodejs/node/pull/57683)\n-   \\[[`43ea4c532a`](https://redirect.github.com/nodejs/node/commit/43ea4c532a)] - **tools**: bump the eslint group in /tools/eslint with 4 updates (dependabot\\[bot]) [#&#8203;57721](https://redirect.github.com/nodejs/node/pull/57721)\n-   \\[[`5703147470`](https://redirect.github.com/nodejs/node/commit/5703147470)] - **tools**: enable linter in `test/fixtures/source-map/output` (Antoine du Hamel) [#&#8203;57700](https://redirect.github.com/nodejs/node/pull/57700)\n-   \\[[`80d58c372d`](https://redirect.github.com/nodejs/node/commit/80d58c372d)] - **tools**: enable linter in `test/fixtures/errors` (Antoine du Hamel) [#&#8203;57701](https://redirect.github.com/nodejs/node/pull/57701)\n-   \\[[`ef5275b7be`](https://redirect.github.com/nodejs/node/commit/ef5275b7be)] - **tools**: enable linter in `test/fixtures/test-runner/output` (Antoine du Hamel) [#&#8203;57698](https://redirect.github.com/nodejs/node/pull/57698)\n-   \\[[`631733e41f`](https://redirect.github.com/nodejs/node/commit/631733e41f)] - **tools**: enable linter in `test/fixtures/eval` (Antoine du Hamel) [#&#8203;57699](https://redirect.github.com/nodejs/node/pull/57699)\n-   \\[[`6d0128695f`](https://redirect.github.com/nodejs/node/commit/6d0128695f)] - **tools**: enable linter on some fixtures file (Antoine du Hamel) [#&#8203;57674](https://redirect.github.com/nodejs/node/pull/57674)\n-   \\[[`f4d7cbae89`](https://redirect.github.com/nodejs/node/commit/f4d7cbae89)] - **tools**: update ESLint to 9.23 (Antoine du Hamel) [#&#8203;57673](https://redirect.github.com/nodejs/node/pull/57673)\n-   \\[[`5a39a24cd1`](https://redirect.github.com/nodejs/node/commit/5a39a24cd1)] - **typings**: fix `ModulesBinding` types (Antoine du Hamel) [#&#8203;55549](https://redirect.github.com/nodejs/node/pull/55549)\n-   \\[[`2df7ce9ebd`](https://redirect.github.com/nodejs/node/commit/2df7ce9ebd)] - **util**: fix parseEnv handling of invalid lines (Augustin Mauroy) [#&#8203;57798](https://redirect.github.com/nodejs/node/pull/57798)\n-   \\[[`416052a9f2`](https://redirect.github.com/nodejs/node/commit/416052a9f2)] - **util**: fix formatting of objects with built-in Symbol.toPrimitive (Shima Ryuhei) [#&#8203;57832](https://redirect.github.com/nodejs/node/pull/57832)\n-   \\[[`43490c8797`](https://redirect.github.com/nodejs/node/commit/43490c8797)] - **(SEMVER-MINOR)** **util**: add `types.isFloat16Array()` (Livia Medeiros) [#&#8203;57879](https://redirect.github.com/nodejs/node/pull/57879)\n-   \\[[`30060e13d3`](https://redirect.github.com/nodejs/node/commit/30060e13d3)] - **util**: preserve `length` of deprecated functions (Livia Medeiros) [#&#8203;57806](https://redirect.github.com/nodejs/node/pull/57806)\n-   \\[[`9837e08a84`](https://redirect.github.com/nodejs/node/commit/9837e08a84)] - **util**: fix parseEnv incorrectly splitting multiple \u2018=\u2018 in value (HEESEUNG) [#&#8203;57421](https://redirect.github.com/nodejs/node/pull/57421)\n-   \\[[`af41dd3c07`](https://redirect.github.com/nodejs/node/commit/af41dd3c07)] - **watch**: clarify completion/failure watch mode messages (Dario Piotrowicz) [#&#8203;57926](https://redirect.github.com/nodejs/node/pull/57926)\n-   \\[[`7229a29b47`](https://redirect.github.com/nodejs/node/commit/7229a29b47)] - **watch**: check parent and child path properly (Jason Zhang) [#&#8203;57425](https://redirect.github.com/nodejs/node/pull/57425)\n-   \\[[`1b5a7c6dc8`](https://redirect.github.com/nodejs/node/commit/1b5a7c6dc8)] - **win**: fix SIGQUIT on ClangCL (Stefan Stojanovic) [#&#8203;57659](https://redirect.github.com/nodejs/node/pull/57659)\n-   \\[[`e935c3c6f2`](https://redirect.github.com/nodejs/node/commit/e935c3c6f2)] - **worker**: add ESM version examples to worker docs (fisker Cheung) [#&#8203;57645](https://redirect.github.com/nodejs/node/pull/57645)\n-   \\[[`dda6ca9172`](https://redirect.github.com/nodejs/node/commit/dda6ca9172)] - **(SEMVER-MINOR)** **worker**: add worker.getHeapStatistics() (Matteo Collina) [#&#8203;57888](https://redirect.github.com/nodejs/node/pull/57888)\n-   \\[[`f2159f2a44`](https://redirect.github.com/nodejs/node/commit/f2159f2a44)] - **zlib**: fix pointer alignment (jhofstee) [#&#8203;57727](https://redirect.github.com/nodejs/node/pull/57727)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xNi4wIiwidXBkYXRlZEluVmVyIjoiNDAuMTYuMCIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwiamF2YXNjcmlwdCJdfQ==-->\n\n\n---\n\nChoice A:\ndocker-compose.yml\n@@ -115,7 +115,7 @@ services:\n     volumes:\n       - ./public/system:/mastodon/public/system\n     healthcheck:\n-      test: ['CMD-SHELL', \"ps aux | grep '[s]idekiq\\ 6' || false\"]\n+      test: ['CMD-SHELL', \"ps aux | grep '[s]idekiq\\ 7' || false\"]\n \n   ## Uncomment to enable federation with tor instances along with adding the following ENV variables\n   ## http_hidden_proxy=http://privoxy:8118\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/account/components/account_note.jsx\n@@ -8,6 +8,8 @@ import ImmutablePureComponent from 'react-immutable-pure-component';\n \n import Textarea from 'react-textarea-autosize';\n \n+import { LoadingIndicator } from '@/mastodon/components/loading_indicator';\n+\n const messages = defineMessages({\n   placeholder: { id: 'account_note.placeholder', defaultMessage: 'Click to add a note' },\n });\n@@ -153,17 +155,23 @@ class AccountNote extends ImmutablePureComponent {\n           <FormattedMessage id='account.account_note_header' defaultMessage='Personal note' /> <InlineAlert show={saved} />\n         </label>\n \n-        <Textarea\n-          id={`account-note-${accountId}`}\n-          className='account__header__account-note__content'\n-          disabled={this.props.value === null || value === null}\n-          placeholder={intl.formatMessage(messages.placeholder)}\n-          value={value || ''}\n-          onChange={this.handleChange}\n-          onKeyDown={this.handleKeyDown}\n-          onBlur={this.handleBlur}\n-          ref={this.setTextareaRef}\n-        />\n+        {this.props.value === undefined ? (\n+          <div className='account__header__account-note__loading-indicator-wrapper'>\n+            <LoadingIndicator />\n+          </div>\n+        ) : (\n+          <Textarea\n+            id={`account-note-${accountId}`}\n+            className='account__header__account-note__content'\n+            disabled={value === null}\n+            placeholder={intl.formatMessage(messages.placeholder)}\n+            value={value || ''}\n+            onChange={this.handleChange}\n+            onKeyDown={this.handleKeyDown}\n+            onBlur={this.handleBlur}\n+            ref={this.setTextareaRef}\n+          />\n+        )}\n       </div>\n     );\n   }\n---\napp/javascript/styles/mastodon/components.scss\n@@ -8194,6 +8194,20 @@ noscript {\n     font-weight: 400;\n     margin-bottom: 10px;\n \n+    &__loading-indicator-wrapper {\n+      position: relative;\n+      height: 37px;\n+\n+      .loading-indicator {\n+        left: 10px;\n+      }\n+\n+      .circular-progress {\n+        width: 14px;\n+        height: 14px;\n+      }\n+    }\n+\n     label {\n       display: block;\n       font-size: 12px;\n---\n\n\n---\n\nChoice C:\n.nvmrc\n@@ -1 +1 @@\n-22.15\n+22.16\n---\n\n\n---\n\nChoice D:\napp/controllers/api/v1/lists_controller.rb\n@@ -7,10 +7,6 @@ class Api::V1::ListsController < Api::BaseController\n   before_action :require_user!\n   before_action :set_list, except: [:index, :create]\n \n-  rescue_from ArgumentError do |e|\n-    render json: { error: e.to_s }, status: 422\n-  end\n-\n   def index\n     @lists = List.where(account: current_account).all\n     render json: @lists, each_serializer: REST::ListSerializer\n---\napp/models/list.rb\n@@ -18,7 +18,7 @@ class List < ApplicationRecord\n \n   PER_ACCOUNT_LIMIT = 50\n \n-  enum :replies_policy, { list: 0, followed: 1, none: 2 }, prefix: :show\n+  enum :replies_policy, { list: 0, followed: 1, none: 2 }, prefix: :show, validate: true\n \n   belongs_to :account\n \n---\nspec/requests/api/v1/lists_spec.rb\n@@ -132,9 +132,12 @@\n       it 'returns http unprocessable entity' do\n         subject\n \n-        expect(response).to have_http_status(422)\n+        expect(response)\n+          .to have_http_status(422)\n         expect(response.content_type)\n           .to start_with('application/json')\n+        expect(response.parsed_body)\n+          .to include(error: /Replies policy is not included/)\n       end\n     end\n   end\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rubocop](https://rubocop.org/) ([source](https://redirect.github.com/rubocop/rubocop), [changelog](https://redirect.github.com/rubocop/rubocop/releases/tag/v1.75.7)) | `1.75.6` -> `1.75.7` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rubocop/1.75.7?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rubocop/1.75.7?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rubocop/1.75.6/1.75.7?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rubocop/1.75.6/1.75.7?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>rubocop/rubocop (rubocop)</summary>\n\n### [`v1.75.7`](https://redirect.github.com/rubocop/rubocop/blob/HEAD/CHANGELOG.md#1757-2025-05-21)\n\n[Compare Source](https://redirect.github.com/rubocop/rubocop/compare/v1.75.6...v1.75.7)\n\n##### Bug fixes\n\n-   [#&#8203;14185](https://redirect.github.com/rubocop/rubocop/pull/14185): Fix an error for `Style/IfUnlessModifierOfIfUnless` when using nested modifier. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14192](https://redirect.github.com/rubocop/rubocop/pull/14192): Fix negatives for `Layout/SpaceBeforeBrackets` when using space between method argument parentheses and left bracket. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14189](https://redirect.github.com/rubocop/rubocop/issues/14189): Fix incorrect autocorrect for `Layout/SpaceBeforeBrackets` when using space between receiver and left brackets, and a space inside left bracket. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14170](https://redirect.github.com/rubocop/rubocop/pull/14170): Fix `Style/AccessModifierDeclarations` cop error on semicolon after modifier. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14195](https://redirect.github.com/rubocop/rubocop/pull/14195): Fix `Style/AccessModifierDeclarations` cop error on symbol modifier without surrounding scope. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14172](https://redirect.github.com/rubocop/rubocop/pull/14172): Fix `Style/AccessModifierDeclarations` cop false positives when there are no method definitions and style is `inline`. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14193](https://redirect.github.com/rubocop/rubocop/issues/14193): Fix `Lint/UselessAssignment` cop error when using nested assignment with splat. (\\[[@&#8203;earlopain](https://redirect.github.com/earlopain)]\\[])\n\n##### Changes\n\n-   [#&#8203;14188](https://redirect.github.com/rubocop/rubocop/pull/14188): Enhance `Gemspec/DuplicatedAssignment` cop to detect duplicated indexed assignment. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14183](https://redirect.github.com/rubocop/rubocop/pull/14183): Recognize `prefix` argument for `delegate` method in `Lint/DuplicateMethods`. (\\[[@&#8203;lovro-bikic](https://redirect.github.com/lovro-bikic)]\\[])\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xNi4wIiwidXBkYXRlZEluVmVyIjoiNDAuMTYuMCIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\napp/javascript/styles/mastodon/components.scss\n@@ -7068,18 +7068,19 @@ a.status-card {\n }\n \n .audio-player {\n-  overflow: hidden;\n   box-sizing: border-box;\n+  container: audio-player / inline-size;\n   position: relative;\n-  background: var(--player-background-color, var(--background-color));\n+  overflow: hidden;\n+  display: flex;\n+  flex-direction: column;\n+  width: 100%;\n+  aspect-ratio: 16 / 9;\n   color: var(--player-foreground-color);\n+  background: var(--player-background-color, var(--background-color));\n   border-radius: 8px;\n-  padding-bottom: 44px;\n-  width: 100%;\n   outline: 1px solid var(--media-outline-color);\n   outline-offset: -1px;\n-  aspect-ratio: 16 / 9;\n-  container: audio-player / inline-size;\n \n   &__controls {\n     display: grid;\n@@ -7128,9 +7129,17 @@ a.status-card {\n   }\n \n   &__visualizer {\n+    width: 100%;\n     max-width: 200px;\n   }\n \n+  .video-player__seek {\n+    position: absolute;\n+    inset: 0 0 auto;\n+    height: 24px;\n+    z-index: 1; /* Ensure this renders on top of audio player controls */\n+  }\n+\n   &.inactive {\n     .video-player__seek,\n     .audio-player__controls,\n---\n\n\n---\n\nChoice B:\napp/javascript/styles/mastodon/components.scss\n@@ -11044,7 +11044,7 @@ noscript {\n   overflow: hidden;\n   flex-shrink: 0;\n   border-bottom: 1px solid var(--background-border-color);\n-  touch-action: pan-x;\n+  touch-action: pan-y;\n \n   &__slides {\n     display: flex;\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -66,7 +66,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n+\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n   version: 7.26.10\n   resolution: \"@babel/core@npm:7.26.10\"\n   dependencies:\n@@ -211,10 +211,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.24.0, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5\":\n-  version: 7.26.5\n-  resolution: \"@babel/helper-plugin-utils@npm:7.26.5\"\n-  checksum: 10c0/cdaba71d4b891aa6a8dfbe5bac2f94effb13e5fa4c2c487667fdbaa04eae059b78b28d85a885071f45f7205aeb56d16759e1bed9c118b94b16e4720ef1ab0f65\n+\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5, @babel/helper-plugin-utils@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helper-plugin-utils@npm:7.27.1\"\n+  checksum: 10c0/94cf22c81a0c11a09b197b41ab488d416ff62254ce13c57e62912c85700dc2e99e555225787a4099ff6bae7a1812d622c80fbaeda824b79baa10a6c5ac4cf69b\n   languageName: node\n   linkType: hard\n \n@@ -869,25 +869,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-self@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-self@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea362ff94b535c753f560eb1f5e063dc72bbbca17ed58837a949a7b289d5eacc7b0a28296d1932c94429b168d6040cdee5484a59b9e3c021f169e0ee137e6a27\n+  checksum: 10c0/00a4f917b70a608f9aca2fb39aabe04a60aa33165a7e0105fd44b3a8531630eb85bf5572e9f242f51e6ad2fa38c2e7e780902176c863556c58b5ba6f6e164031\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-source@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-source@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea8e3263c0dc51fbc97c156cc647150a757cc56de10781287353d0ce9b2dcd6b6d93d573c0142d7daf5d6fb554c74fa1971ae60764924ea711161d8458739b63\n+  checksum: 10c0/5e67b56c39c4d03e59e03ba80692b24c5a921472079b63af711b1d250fc37c1733a17069b63537f750f3e937ec44a42b1ee6a46cd23b1a0df5163b17f741f7f2\n   languageName: node\n   linkType: hard\n \n@@ -4135,17 +4135,17 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.2.1\n-  resolution: \"@vitejs/plugin-react@npm:4.2.1\"\n+  version: 4.4.1\n+  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n   dependencies:\n-    \"@babel/core\": \"npm:^7.23.5\"\n-    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.23.3\"\n-    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.23.3\"\n+    \"@babel/core\": \"npm:^7.26.10\"\n+    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n+    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n-    react-refresh: \"npm:^0.14.0\"\n+    react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n-    vite: ^4.2.0 || ^5.0.0\n-  checksum: 10c0/de1eec44d703f32e5b58e776328ca20793657fe991835d15b290230b19a2a08be5d31501d424279ae13ecfed28044c117b69d746891c8d9b92c69e8a8907e989\n+    vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n+  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n   languageName: node\n   linkType: hard\n \n@@ -10069,10 +10069,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-refresh@npm:^0.14.0\":\n-  version: 0.14.0\n-  resolution: \"react-refresh@npm:0.14.0\"\n-  checksum: 10c0/b8ae07ad153357d77830928a7f1fc2df837aabefee907fa273ba04c7643f3b860e986f1d4b7ada9b721c8d79b8c24b5b911a314a1a2398b105f1b13d19ea2b8d\n+\"react-refresh@npm:^0.17.0\":\n+  version: 0.17.0\n+  resolution: \"react-refresh@npm:0.17.0\"\n+  checksum: 10c0/002cba940384c9930008c0bce26cac97a9d5682bc623112c2268ba0c155127d9c178a9a5cc2212d560088d60dfd503edd808669a25f9b377f316a32361d0b23c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -742,7 +742,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.6)\n+    rubocop (1.75.7)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nBefore the migration to Vite, we had `babel-preset-env` adding automatic polyfills for modern JS features based on our `browserslist`.\r\n\r\nBut Vite does only syntax-level polyfills, not function level with `core-js` by default. This adds back `core-js` polyfills automatically, using the legacy Vite plugin.\r\n\r\nI tested that updating our `browserslist` changes the size of the `polyfills` chunk, so it is correctly taken into account.\n\n---\n\nChoice A:\napp/lib/admin/system_check/elasticsearch_check.rb\n@@ -17,7 +17,7 @@ def pass?\n     return true unless Chewy.enabled?\n \n     running_version.present? && compatible_version? && cluster_health['status'] == 'green' && indexes_match? && specifications_match? && preset_matches?\n-  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error\n+  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error, HTTPClient::KeepAliveDisconnected\n     false\n   end\n \n@@ -54,7 +54,7 @@ def message\n     else\n       Admin::SystemCheck::Message.new(:elasticsearch_preset, nil, 'https://docs.joinmastodon.org/admin/elasticsearch/#scaling')\n     end\n-  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error\n+  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error, HTTPClient::KeepAliveDisconnected\n     Admin::SystemCheck::Message.new(:elasticsearch_running_check)\n   end\n \n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.15)\n+    rack (2.2.16)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n---\n\n\n---\n\nChoice C:\neslint.config.mjs\n@@ -1,5 +1,7 @@\n // @ts-check\n \n+import path from 'node:path';\n+\n import js from '@eslint/js';\n import { globalIgnores } from 'eslint/config';\n import formatjs from 'eslint-plugin-formatjs';\n@@ -204,7 +206,9 @@ export default tseslint.config([\n       'import/ignore': ['node_modules', '\\\\.(css|scss|json)$'],\n \n       'import/resolver': {\n-        typescript: {},\n+        typescript: {\n+          project: path.resolve(import.meta.dirname, './tsconfig.json'),\n+        },\n       },\n     },\n \n---\nstreaming/eslint.config.mjs\n@@ -1,5 +1,7 @@\n // @ts-check\n \n+import path from 'node:path';\n+\n import globals from 'globals';\n import tseslint from 'typescript-eslint';\n \n@@ -20,7 +22,9 @@ export default tseslint.config([\n     settings: {\n       'import/ignore': ['node_modules', '\\\\.(json)$'],\n       'import/resolver': {\n-        typescript: {},\n+        typescript: {\n+          project: path.resolve(import.meta.dirname, './tsconfig.json'),\n+        },\n       },\n     },\n \n---\n\n\n---\n\nChoice D:\napp/views/layouts/application.html.haml\n@@ -28,6 +28,7 @@\n     = theme_style_tags current_theme\n     = vite_client_tag\n     = vite_react_refresh_tag\n+    = vite_polyfill_tag crossorigin: 'anonymous'\n     -# Needed for the wicg-inert polyfill. It needs to be on it's own <style> tag, with this `id`\n     = vite_stylesheet_tag 'styles/entrypoints/inert.scss', media: 'all', id: 'inert-style'\n     = vite_typescript_tag 'common.ts', crossorigin: 'anonymous'\n---\napp/views/layouts/embedded.html.haml\n@@ -13,6 +13,7 @@\n \n     = vite_client_tag\n     = vite_react_refresh_tag\n+    = vite_polyfill_tag crossorigin: 'anonymous'\n     = theme_style_tags 'mastodon-light'\n     = vite_preload_file_tag \"mastodon/locales/#{I18n.locale}.json\"\n     = render_initial_state\n---\napp/views/layouts/error.html.haml\n@@ -7,6 +7,7 @@\n     %meta{ content: 'width=device-width,initial-scale=1', name: 'viewport' }/\n     = vite_client_tag\n     = vite_react_refresh_tag\n+    = vite_polyfill_tag crossorigin: 'anonymous'\n     = theme_style_tags Setting.default_settings['theme']\n     = vite_typescript_tag 'error.ts', crossorigin: 'anonymous'\n   %body.error\n---\nlib/vite_ruby/sri_extensions.rb\n@@ -119,6 +119,12 @@ def vite_preload_file_tag(name,\n   rescue ViteRuby::MissingEntrypointError\n     # Ignore this error, it is not critical if the file is not preloaded\n   end\n+\n+  def vite_polyfill_tag(**)\n+    entry = vite_manifest.path_and_integrity_for('polyfill', type: :virtual)\n+\n+    javascript_include_tag(type: 'module', src: entry[:path], integrity: entry[:integrity], **)\n+  end\n end\n \n ViteRails::TagHelpers.prepend ViteRails::TagHelpers::IntegrityExtension\n---\npackage.json\n@@ -47,6 +47,7 @@\n     \"@react-spring/web\": \"^10.0.0\",\n     \"@reduxjs/toolkit\": \"^2.0.1\",\n     \"@use-gesture/react\": \"^10.3.1\",\n+    \"@vitejs/plugin-legacy\": \"^6.1.1\",\n     \"@vitejs/plugin-react\": \"^4.2.1\",\n     \"arrow-key-navigation\": \"^1.2.0\",\n     \"async-mutex\": \"^0.5.0\",\n---\nvite.config.mts\n@@ -10,6 +10,7 @@ import RailsPlugin from 'vite-plugin-rails';\n import { VitePWA } from 'vite-plugin-pwa';\n import tsconfigPaths from 'vite-tsconfig-paths';\n import yaml from 'js-yaml';\n+import legacy from '@vitejs/plugin-legacy';\n \n import { defineConfig, UserConfigFnPromise, UserConfig } from 'vite';\n import postcssPresetEnv from 'postcss-preset-env';\n@@ -119,6 +120,10 @@ export const config: UserConfigFnPromise = async ({ mode, command }) => {\n       }),\n       MastodonServiceWorkerLocales(),\n       MastodonEmojiCompressed(),\n+      legacy({\n+        renderLegacyChunks: false,\n+        modernPolyfills: true,\n+      }),\n       VitePWA({\n         srcDir: 'mastodon/service_worker',\n         // We need to use injectManifest because we use our own service worker\n---\nyarn.lock\n@@ -1029,7 +1029,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/preset-env@npm:^7.11.0\":\n+\"@babel/preset-env@npm:^7.11.0, @babel/preset-env@npm:^7.26.9\":\n   version: 7.27.2\n   resolution: \"@babel/preset-env@npm:7.27.2\"\n   dependencies:\n@@ -2488,6 +2488,7 @@ __metadata:\n     \"@types/redux-immutable\": \"npm:^4.0.3\"\n     \"@types/requestidlecallback\": \"npm:^0.3.5\"\n     \"@use-gesture/react\": \"npm:^10.3.1\"\n+    \"@vitejs/plugin-legacy\": \"npm:^6.1.1\"\n     \"@vitejs/plugin-react\": \"npm:^4.2.1\"\n     arrow-key-navigation: \"npm:^1.2.0\"\n     async-mutex: \"npm:^0.5.0\"\n@@ -4159,6 +4160,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"@vitejs/plugin-legacy@npm:^6.1.1\":\n+  version: 6.1.1\n+  resolution: \"@vitejs/plugin-legacy@npm:6.1.1\"\n+  dependencies:\n+    \"@babel/core\": \"npm:^7.26.10\"\n+    \"@babel/preset-env\": \"npm:^7.26.9\"\n+    browserslist: \"npm:^4.24.4\"\n+    browserslist-to-esbuild: \"npm:^2.1.1\"\n+    core-js: \"npm:^3.41.0\"\n+    magic-string: \"npm:^0.30.17\"\n+    regenerator-runtime: \"npm:^0.14.1\"\n+    systemjs: \"npm:^6.15.1\"\n+  peerDependencies:\n+    terser: ^5.16.0\n+    vite: ^6.0.0\n+  checksum: 10c0/3a41098e422246d7ddbb6add678c1317474679a5e82e011947898cea5336fa8da9bb8fa625ab1284265f6ba123278fc2bf7c5b0b9b87febaaf865f14ac8e6ece\n+  languageName: node\n+  linkType: hard\n+\n \"@vitejs/plugin-react@npm:^4.2.1\":\n   version: 4.4.1\n   resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n@@ -4805,6 +4825,19 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"browserslist-to-esbuild@npm:^2.1.1\":\n+  version: 2.1.1\n+  resolution: \"browserslist-to-esbuild@npm:2.1.1\"\n+  dependencies:\n+    meow: \"npm:^13.0.0\"\n+  peerDependencies:\n+    browserslist: \"*\"\n+  bin:\n+    browserslist-to-esbuild: cli/index.js\n+  checksum: 10c0/4d1968efd72850949d5dfa355f4663c695a8fd7b259b19cc81ecd0ed33dd37bbd327475c644de3f2beb53e737c6e511c6e84ed3e97a2ff49f117505a7707c72d\n+  languageName: node\n+  linkType: hard\n+\n \"browserslist@npm:^4.24.0, browserslist@npm:^4.24.4\":\n   version: 4.24.4\n   resolution: \"browserslist@npm:4.24.4\"\n@@ -5202,7 +5235,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"core-js@npm:^3.30.2\":\n+\"core-js@npm:^3.30.2, core-js@npm:^3.41.0\":\n   version: 3.42.0\n   resolution: \"core-js@npm:3.42.0\"\n   checksum: 10c0/2913d3d5452d54ad92f058d66046782d608c05e037bcc523aab79c04454fe640998f94e6011292969d66dfa472f398b085ce843dcb362056532a5799c627184e\n@@ -8327,7 +8360,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"meow@npm:^13.2.0\":\n+\"meow@npm:^13.0.0, meow@npm:^13.2.0\":\n   version: 13.2.0\n   resolution: \"meow@npm:13.2.0\"\n   checksum: 10c0/d5b339ae314715bcd0b619dd2f8a266891928e21526b4800d49b4fba1cc3fff7e2c1ff5edd3344149fac841bc2306157f858e8c4d5eaee4d52ce52ad925664ce\n@@ -10405,7 +10438,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"regenerator-runtime@npm:^0.14.0\":\n+\"regenerator-runtime@npm:^0.14.0, regenerator-runtime@npm:^0.14.1\":\n   version: 0.14.1\n   resolution: \"regenerator-runtime@npm:0.14.1\"\n   checksum: 10c0/1b16eb2c4bceb1665c89de70dcb64126a22bc8eb958feef3cd68fe11ac6d2a4899b5cd1b80b0774c7c03591dc57d16631a7f69d2daa2ec98100e2f29f7ec4cc4\n@@ -11689,6 +11722,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"systemjs@npm:^6.15.1\":\n+  version: 6.15.1\n+  resolution: \"systemjs@npm:6.15.1\"\n+  checksum: 10c0/106e5751a49dbe4acb17fa1474a43b27fd26efbee1b322c00c04c08f3e95de756adfba828d743af89bef7fa10888da8a5c5ceb55dae5c42e4909b151168ad192\n+  languageName: node\n+  linkType: hard\n+\n \"table@npm:^6.9.0\":\n   version: 6.9.0\n   resolution: \"table@npm:6.9.0\"\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nBackground: https://github.com/mastodon/mastodon/pull/34748#issuecomment-2897908481\r\n\r\nThis is the env-var-only stuff from that PR. It leaves the in-code config in place for now, pending more discussion on original PR.\n\n---\n\nChoice A:\n.env.production.sample\n@@ -43,7 +43,6 @@ ES_PASS=password\n # Make sure to use `bundle exec rails secret` to generate secrets\n # -------\n SECRET_KEY_BASE=\n-OTP_SECRET=\n \n # Encryption secrets\n # ------------------\n---\napp.json\n@@ -17,10 +17,6 @@\n       \"description\": \"The secret key base\",\n       \"generator\": \"secret\"\n     },\n-    \"OTP_SECRET\": {\n-      \"description\": \"One-time password secret\",\n-      \"generator\": \"secret\"\n-    },\n     \"SINGLE_USER_MODE\": {\n       \"description\": \"Should the instance run in single user mode? (Disable registrations, redirect to front page)\",\n       \"value\": \"false\",\n---\nlib/tasks/mastodon.rake\n@@ -32,7 +32,7 @@ namespace :mastodon do\n       prompt.say('Single user mode disables registrations and redirects the landing page to your public profile.')\n       env['SINGLE_USER_MODE'] = prompt.yes?('Do you want to enable single user mode?', default: false)\n \n-      %w(SECRET_KEY_BASE OTP_SECRET).each do |key|\n+      %w(SECRET_KEY_BASE).each do |key|\n         env[key] = SecureRandom.hex(64)\n       end\n \n---\nscalingo.json\n@@ -12,10 +12,6 @@\n       \"description\": \"The secret key base\",\n       \"generator\": \"secret\"\n     },\n-    \"OTP_SECRET\": {\n-      \"description\": \"One-time password secret\",\n-      \"generator\": \"secret\"\n-    },\n     \"SINGLE_USER_MODE\": {\n       \"description\": \"Should the instance run in single user mode? (Disable registrations, redirect to front page)\",\n       \"value\": \"false\",\n---\n\n\n---\n\nChoice B:\napp/views/layouts/application.html.haml\n@@ -31,7 +31,7 @@\n     -# Needed for the wicg-inert polyfill. It needs to be on it's own <style> tag, with this `id`\n     = vite_stylesheet_tag 'styles/inert.scss', media: 'all', id: 'inert-style'\n \n-    -# = vite_preload_tag \"mastodon/locales/#{I18n.locale}.json\", :crossorigin => 'anonymous'\n+    = vite_preload_file_tag \"mastodon/locales/#{I18n.locale}.json\"\n     = csrf_meta_tags unless skip_csrf_meta_tags?\n     %meta{ name: 'style-nonce', content: request.content_security_policy_nonce }\n \n---\napp/views/layouts/embedded.html.haml\n@@ -14,7 +14,7 @@\n     = vite_client_tag\n     = vite_react_refresh_tag\n     = theme_style_tags 'mastodon-light'\n-    -# = vite_preload_tag \"mastodon/locales/#{I18n.locale}.json\", :crossorigin => 'anonymous'\n+    = vite_preload_file_tag \"mastodon/locales/#{I18n.locale}.json\"\n     = render_initial_state\n     = vite_typescript_tag 'embed.tsx', integrity: true, crossorigin: 'anonymous'\n   %body.embed\n---\nlib/vite_ruby/sri_extensions.rb\n@@ -35,6 +35,16 @@ def resolve_entries_with_integrity(*names, **options)\n       stylesheets: dev_server_running? ? [] : (entries + imports).flat_map { |entry| entry['css'] }.compact.uniq,\n     }\n   end\n+\n+  # We need to override this method to not include the manifest, as in our case it is too large and will cause a JSON max nesting error rather than raising the expected exception\n+  def missing_entry_error(name, **)\n+    raise ViteRuby::MissingEntrypointError.new(\n+      file_name: resolve_entry_name(name, **),\n+      last_build: builder.last_build_metadata,\n+      manifest: '',\n+      config: config\n+    )\n+  end\n end\n \n ViteRuby::Manifest.prepend ViteRuby::ManifestIntegrityExtension\n@@ -95,6 +105,20 @@ def vite_stylesheet_tag(*names, **options)\n       end\n     end\n   end\n+\n+  def vite_preload_file_tag(name,\n+                            asset_type: :javascript,\n+                            crossorigin: 'anonymous', **options)\n+    ''.html_safe.tap do |tags|\n+      entries = vite_manifest.resolve_entries_with_integrity(name, type: asset_type)\n+\n+      entries.fetch(:scripts).each do |script|\n+        tags << vite_preload_tag(script[:file], integrity: script[:integrity], crossorigin: crossorigin, **options)\n+      end\n+    end\n+  rescue ViteRuby::MissingEntrypointError\n+    # Ignore this error, it is not critical if the file is not preloaded\n+  end\n end\n \n ViteRails::TagHelpers.prepend ViteRails::TagHelpers::IntegrityExtension\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.223.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1096.0)\n+    aws-sdk-core (3.223.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.223.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.15)\n+    rack (2.2.16)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\n- Adds `vips` to the list of required project deps\r\n- Adds a note about specifying a custom path for `libidn` (I need to run this to be able to complete `bin/setup`, not sure how common this is)\n\n---\n\nChoice A:\napp/views/auth/registrations/new.html.haml\n@@ -56,7 +56,7 @@\n     .fields-group\n       = f.input :date_of_birth,\n                 as: :date_of_birth,\n-                hint: t('simple_form.hints.user.date_of_birth', age: Setting.min_age.to_i),\n+                hint: t('simple_form.hints.user.date_of_birth', count: Setting.min_age.to_i),\n                 required: true,\n                 wrapper: :with_block_label\n \n---\nconfig/locales/simple_form.en.yml\n@@ -148,7 +148,9 @@ en:\n         min_age: Should not be below the minimum age required by the laws of your jurisdiction.\n       user:\n         chosen_languages: When checked, only posts in selected languages will be displayed in public timelines\n-        date_of_birth: We have to make sure you're at least %{age} to use Mastodon. We won't store this.\n+        date_of_birth:\n+          one: We have to make sure you're at least %{count} to use Mastodon. We won't store this.\n+          other: We have to make sure you're at least %{count} to use Mastodon. We won't store this.\n         role: The role controls which permissions the user has.\n       user_role:\n         color: Color to be used for the role throughout the UI, as RGB in hex format\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.15)\n+    rack (2.2.16)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n---\n\n\n---\n\nChoice C:\napp/lib/status_filter.rb\n@@ -38,7 +38,7 @@ def muting_account?\n   end\n \n   def silenced_account?\n-    !account&.silenced? && status_account_silenced? && !account_following_status_account?\n+    status_account_silenced? && !account_following_status_account?\n   end\n \n   def status_account_silenced?\n---\n\n\n---\n\nChoice D:\ndocs/DEVELOPMENT.md\n@@ -37,14 +37,17 @@ complete the following steps:\n To set up **macOS** for native development, complete the following steps:\n \n - Install [Homebrew] and run:\n-  `brew install postgresql@14 redis imagemagick libidn nvm`\n+  `brew install postgresql@14 redis libidn nvm vips`\n   to install the required project dependencies\n - Use a Ruby version manager to activate the ruby in `.ruby-version` and run\n   `nvm use` to activate the node version from `.nvmrc`\n - Start the database services by running `brew services start postgresql` and\n   `brew services start redis`\n - Run `RAILS_ENV=development bin/setup`, which will install the required ruby gems and node\n   packages and prepare the database for local development\n+\n+  (Note: If you are on Apple Silicon and get an error related to `libidn`, you should be able to fix this by running `gem install idn-ruby -- --with-idn-dir=$(brew --prefix libidn)`, then re-running the command above.)\n+\n - Finally, run the `bin/dev` script which will launch services via `overmind`\n   (if installed) or `foreman`\n \n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [@react-spring/web](https://redirect.github.com/pmndrs/react-spring) | [`10.0.0` -> `10.0.1`](https://renovatebot.com/diffs/npm/@react-spring%2fweb/10.0.0/10.0.1) | [![age](https://developer.mend.io/api/mc/badges/age/npm/@react-spring%2fweb/10.0.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/@react-spring%2fweb/10.0.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/@react-spring%2fweb/10.0.0/10.0.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/@react-spring%2fweb/10.0.0/10.0.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>pmndrs/react-spring (@&#8203;react-spring/web)</summary>\n\n### [`v10.0.1`](https://redirect.github.com/pmndrs/react-spring/compare/v10.0.0...de1244b8777a87305b6a359db3851dd36e72b78b)\n\n[Compare Source](https://redirect.github.com/pmndrs/react-spring/compare/v10.0.0...de1244b8777a87305b6a359db3851dd36e72b78b)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xNi4wIiwidXBkYXRlZEluVmVyIjoiNDAuMTYuMCIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwiamF2YXNjcmlwdCJdfQ==-->\n\n\n---\n\nChoice A:\napp/javascript/mastodon/actions/accounts.js\n@@ -2,6 +2,7 @@ import { browserHistory } from 'mastodon/components/router';\n import { debounceWithDispatchAndArguments } from 'mastodon/utils/debounce';\n \n import api, { getLinks } from '../api';\n+import { me } from '../initial_state';\n \n import {\n   followAccountSuccess, unfollowAccountSuccess,\n@@ -12,6 +13,7 @@ import {\n   blockAccountSuccess, unblockAccountSuccess,\n   pinAccountSuccess, unpinAccountSuccess,\n   fetchRelationshipsSuccess,\n+  fetchEndorsedAccounts,\n } from './accounts_typed';\n import { importFetchedAccount, importFetchedAccounts } from './importer';\n \n@@ -634,6 +636,7 @@ export function pinAccount(id) {\n \n     api().post(`/api/v1/accounts/${id}/pin`).then(response => {\n       dispatch(pinAccountSuccess({ relationship: response.data }));\n+      dispatch(fetchEndorsedAccounts({ accountId: me }));\n     }).catch(error => {\n       dispatch(pinAccountFail(error));\n     });\n@@ -646,6 +649,7 @@ export function unpinAccount(id) {\n \n     api().post(`/api/v1/accounts/${id}/unpin`).then(response => {\n       dispatch(unpinAccountSuccess({ relationship: response.data }));\n+      dispatch(fetchEndorsedAccounts({ accountId: me }));\n     }).catch(error => {\n       dispatch(unpinAccountFail(error));\n     });\n---\napp/javascript/mastodon/components/account.tsx\n@@ -12,6 +12,8 @@ import {\n   muteAccount,\n   unmuteAccount,\n   followAccountSuccess,\n+  unpinAccount,\n+  pinAccount,\n } from 'mastodon/actions/accounts';\n import { showAlertForError } from 'mastodon/actions/alerts';\n import { openModal } from 'mastodon/actions/modal';\n@@ -62,14 +64,23 @@ const messages = defineMessages({\n   },\n });\n \n-export const Account: React.FC<{\n+interface AccountProps {\n   size?: number;\n   id: string;\n   hidden?: boolean;\n   minimal?: boolean;\n   defaultAction?: 'block' | 'mute';\n   withBio?: boolean;\n-}> = ({ id, size = 46, hidden, minimal, defaultAction, withBio }) => {\n+}\n+\n+export const Account: React.FC<AccountProps> = ({\n+  id,\n+  size = 46,\n+  hidden,\n+  minimal,\n+  defaultAction,\n+  withBio,\n+}) => {\n   const intl = useIntl();\n   const { signedIn } = useIdentity();\n   const account = useAppSelector((state) => state.accounts.get(id));\n@@ -119,8 +130,6 @@ export const Account: React.FC<{\n         },\n       ];\n     } else if (defaultAction !== 'block') {\n-      arr = [];\n-\n       if (isRemote && accountUrl) {\n         arr.push({\n           text: intl.formatMessage(messages.openOriginalPage),\n@@ -173,6 +182,25 @@ export const Account: React.FC<{\n           text: intl.formatMessage(messages.addToLists),\n           action: handleAddToLists,\n         });\n+\n+        if (id !== me && (relationship?.following || relationship?.requested)) {\n+          const handleEndorseToggle = () => {\n+            if (relationship.endorsed) {\n+              dispatch(unpinAccount(id));\n+            } else {\n+              dispatch(pinAccount(id));\n+            }\n+          };\n+          arr.push({\n+            text: intl.formatMessage(\n+              // Defined in features/account_timeline/components/account_header.tsx\n+              relationship.endorsed\n+                ? { id: 'account.unendorse' }\n+                : { id: 'account.endorse' },\n+            ),\n+            action: handleEndorseToggle,\n+          });\n+        }\n       }\n     }\n \n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -13279,14 +13279,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-cloudflare@npm:^1.2.0\":\n-  version: 1.2.0\n-  resolution: \"pg-cloudflare@npm:1.2.0\"\n-  checksum: 10c0/d6f2d032aeab291b17d627b051aae85420aea86a3371895a77b55fec93e3dac05880fbf09e5de33486ad3a2e6d7d56a025a8aa66f0d5883984f9834e4cd6f6a4\n+\"pg-cloudflare@npm:^1.2.5\":\n+  version: 1.2.5\n+  resolution: \"pg-cloudflare@npm:1.2.5\"\n+  checksum: 10c0/48b9105ef027c7b3f57ef88ceaec3634cd82120059bd68273cce06989a1ec547e0b0fbb5d1afdd0711824f409c8b410f9bdec2f6c8034728992d3658c0b36f86\n   languageName: node\n   linkType: hard\n \n-\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n+\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.5\":\n   version: 2.8.5\n   resolution: \"pg-connection-string@npm:2.8.5\"\n   checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n@@ -13307,19 +13307,19 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.9.1\":\n-  version: 3.9.1\n-  resolution: \"pg-pool@npm:3.9.1\"\n+\"pg-pool@npm:^3.9.5\":\n+  version: 3.9.5\n+  resolution: \"pg-pool@npm:3.9.5\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/2bbc0892ab7325486b7d5ad8ade59ec925476666ac3959cb4850814c5334bb2f1344258707f8d0445093b59dd6e94401508cebcee490d4827821549147a2ebd9\n+  checksum: 10c0/ebb36b6a1fd753213263a2e0e73d06ffe9fc93907deceae484c7fe4b464f6e9c41a578eb096b4b6012beec94a5d6e0e47728dfc4425e06d283744aa7432365a4\n   languageName: node\n   linkType: hard\n \n-\"pg-protocol@npm:*, pg-protocol@npm:^1.9.0\":\n-  version: 1.9.0\n-  resolution: \"pg-protocol@npm:1.9.0\"\n-  checksum: 10c0/c37e61d7fafa97f22eabf12de69863f42fdabb3671df9cc2623bd0ffd6bdedc212e7e8460ad2c721c8a08d8477b4f128a923bf2381905d68a23a532ec7517c77\n+\"pg-protocol@npm:*, pg-protocol@npm:^1.9.5\":\n+  version: 1.9.5\n+  resolution: \"pg-protocol@npm:1.9.5\"\n+  checksum: 10c0/5cb3444cf973adadd22ee9ea26bb1674f0d980ef8f9c66d426bbe67fc9cb5f0ca4a204bf7e432b3ab2ab59ac8227f4b18ab3b2e64eaed537e037e916991c7319\n   languageName: node\n   linkType: hard\n \n@@ -13352,13 +13352,13 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.15.1\n-  resolution: \"pg@npm:8.15.1\"\n+  version: 8.15.5\n+  resolution: \"pg@npm:8.15.5\"\n   dependencies:\n-    pg-cloudflare: \"npm:^1.2.0\"\n-    pg-connection-string: \"npm:^2.8.1\"\n-    pg-pool: \"npm:^3.9.1\"\n-    pg-protocol: \"npm:^1.9.0\"\n+    pg-cloudflare: \"npm:^1.2.5\"\n+    pg-connection-string: \"npm:^2.8.5\"\n+    pg-pool: \"npm:^3.9.5\"\n+    pg-protocol: \"npm:^1.9.5\"\n     pg-types: \"npm:^2.1.0\"\n     pgpass: \"npm:1.x\"\n   peerDependencies:\n@@ -13369,7 +13369,7 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/c6e5fd9cd6af7fc3208e48f860fd9ec9f7bc20192e449b0b36b096a9d5889de50706c705f6996e51a765bd4b7331179d7ffb43528a141bb996ee6f2c8f994c9a\n+  checksum: 10c0/4c118cd9bec37c8880b4489b9acbd10cf1eaa86a0a9024de2dac83f4ce5adedecc4cab54b66fa3bcb204aab7297c08d03617ae15499538939692b48651cc52d1\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/locales/de.json\n@@ -56,8 +56,8 @@\n   \"account.mute_notifications_short\": \"Benachrichtigungen stummschalten\",\n   \"account.mute_short\": \"Stummschalten\",\n   \"account.muted\": \"Stummgeschaltet\",\n-  \"account.muting\": \"Wird stummgeschaltet\",\n-  \"account.mutual\": \"Ihr folgt euch\",\n+  \"account.muting\": \"Stummgeschaltet\",\n+  \"account.mutual\": \"Ihr folgt einander\",\n   \"account.no_bio\": \"Keine Beschreibung verf\u00fcgbar.\",\n   \"account.open_original_page\": \"Urspr\u00fcngliche Seite \u00f6ffnen\",\n   \"account.posts\": \"Beitr\u00e4ge\",\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -2886,69 +2886,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/animated@npm:10.0.0\"\n+\"@react-spring/animated@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/animated@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/a8c40aff22def6dbe964b1f79fa4a7774c44bf5eb47c2ef969c8ecb2a426b4c972b147bf18635d6972dbec3fb95e70dd84f22b43c904c32dfc7a57ad144a0879\n+  checksum: 10c0/aaccd4a8b0280ac846d463b253ad8f092ee4afc9dbedc8e77616adf5399ffec755344f09fdd8487cadaf815840dff84d354d1143579c27c2fcd6937549b5fc40\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/core@npm:10.0.0\"\n+\"@react-spring/core@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/core@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.0\"\n-    \"@react-spring/shared\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/animated\": \"npm:~10.0.1\"\n+    \"@react-spring/shared\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/39036a153dbd973443e23d90cb8e7be83201b1f0e4105f8427ddb4c9e9e50e590e1b46282829e0bb6f3deebfab004e30dcb4eec0e34c5ebb234d5060c06ecae5\n+  checksum: 10c0/059b122dda4138e5e7e461abd49350921e326735ca9a1d8aa19b1fdbae0937661b5f71af6fe82fd8f59e8db5549627849b38cc3f7ef2ec7ee9c93c3d6225174f\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/rafz@npm:10.0.0\"\n-  checksum: 10c0/8d92bc553172fa883ec2121b9cc62bfb43ff5d6c4e76363c8ce100fb6c3dd67c3dd629931786f9d1d63ac95a5d6996e4a08693cd56dda685bdbaf39b60e97f66\n+\"@react-spring/rafz@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/rafz@npm:10.0.1\"\n+  checksum: 10c0/cba76f143d3a06f79dd0c09f7aefd17df9cca9b2c1ef7f9103255e5351326f4a42a5a1366f731a78f74380d96ba683bcc2a49312ed1e4b9e9e249e72c9ff68cb\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/shared@npm:10.0.0\"\n+\"@react-spring/shared@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/shared@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/rafz\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/833c3f42d35d22ac47a2f756ac47d85a81bc1decc5e7915f46013823344374378f883135754de94d5b43d8fff3c55fc4a359044c9a44f9095bd1ef1f11a20d4d\n+  checksum: 10c0/f056aaa018b3744afd8244e8eea24534d32f92fad9ace815b80e159b296fb5db148e2c9bd840ad9a5188e7a3c0778fd564b8af9ae02cd500e019a228398fb3cf\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/types@npm:10.0.0\"\n-  checksum: 10c0/ce1b959eaa8964f4004481d1e7c6eca0a8d636eb9f35ca654bdf77a78a860c0ff9eaa6bdc0cab84fc8a16be5c5fbb22b114249a2721bfc16191666670c0f44b3\n+\"@react-spring/types@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/types@npm:10.0.1\"\n+  checksum: 10c0/260890f9c156dc69b77c846510017156d8c0a07cce70edc7c108e57b0cf4122b26a15e724b191481a51b2c914296de9e81d56618b2c339339d4b221930691baa\n   languageName: node\n   linkType: hard\n \n \"@react-spring/web@npm:^10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/web@npm:10.0.0\"\n+  version: 10.0.1\n+  resolution: \"@react-spring/web@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.0\"\n-    \"@react-spring/core\": \"npm:~10.0.0\"\n-    \"@react-spring/shared\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/animated\": \"npm:~10.0.1\"\n+    \"@react-spring/core\": \"npm:~10.0.1\"\n+    \"@react-spring/shared\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n     react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/2218c87d9bfafab78b3079d94ea89ab9b95cb174910be5682fd8f5fc73e326ca956e9b844e5b255d1e3402138ad26981fae2fc1091d682a78359044a63b6421e\n+  checksum: 10c0/a0c788c9fd881ccb834feb22fc0694e74e59f7b76e498f0096f5b65e2c9812513955bf45ee27d7c5348f56a7bba7c5a6961d4be663728bb2172fe5aa6b6bdfc4\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nhttps://github.com/mastodon/mastodon/blob/f7182ddc8b44f71f6991941b9356454e4468bcd7/app/lib/entity_cache.rb#L34\r\n\r\nIn the rare case where `cached[to_key(:emoji, shortcode, domain)]` resolves to `nil` and `uncached` is also `nil`, this can throw an error while attempting to access `nil[shortcode]` that causes the `/api/v1/timelines/home` to return an error 500 and no data. Safely accessing `uncached` here results in the ultimate error state of \"we have no cached or uncached data for this emoji\" to be a simple rendering of the emoji shortcode in the text of the post, like so:\r\n\r\n![image](https://github.com/user-attachments/assets/1993023b-fb5d-4dfc-a3b3-0b2f82132e86)\r\n\r\nNote: I have no idea what's idiomatic in Ruby these days but it seems like the Mastodon source code in general prefers appending `if uncached` for safety rather than something like `uncached&.[](shortcode)`\n\n---\n\nChoice A:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -912,7 +912,9 @@ export const AccountHeader: React.FC<{\n             <div className='account__header__badges'>{badges}</div>\n           )}\n \n-          {signedIn && <FamiliarFollowers accountId={accountId} />}\n+          {account.id !== me && signedIn && (\n+            <FamiliarFollowers accountId={accountId} />\n+          )}\n \n           {!(suspended || hidden) && (\n             <div className='account__header__extra'>\n---\napp/javascript/styles/mastodon/components.scss\n@@ -2179,7 +2179,7 @@ a .account__avatar {\n   flex-wrap: nowrap;\n \n   & > :not(:first-child) {\n-    margin-inline-start: -8px;\n+    margin-inline-start: -12px;\n   }\n \n   & > :first-child {\n---\n\n\n---\n\nChoice B:\n.rubocop/naming.yml\n@@ -1,3 +1,6 @@\n ---\n Naming/BlockForwarding:\n   EnforcedStyle: explicit\n+\n+Naming/PredicateMethod:\n+  Enabled: false\n---\n.rubocop_todo.yml\n@@ -1,6 +1,6 @@\n # This configuration was generated by\n # `rubocop --auto-gen-config --auto-gen-only-exclude --no-offense-counts --no-auto-gen-timestamp`\n-# using RuboCop version 1.75.8.\n+# using RuboCop version 1.76.0.\n # The point is for the user to remove these configuration records\n # one by one as the offenses are removed from the code base.\n # Note that changes in the inspected code, or installation of new\n---\nGemfile.lock\n@@ -751,18 +751,18 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.8)\n+    rubocop (1.76.0)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n       parallel (~> 1.10)\n       parser (>= 3.3.0.2)\n       rainbow (>= 2.2.2, < 4.0)\n       regexp_parser (>= 2.9.3, < 3.0)\n-      rubocop-ast (>= 1.44.0, < 2.0)\n+      rubocop-ast (>= 1.45.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.1)\n+    rubocop-ast (1.45.0)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n---\napp/controllers/auth/registrations_controller.rb\n@@ -138,7 +138,7 @@ def require_rules_acceptance!\n     set_locale { render :rules }\n   end\n \n-  def is_flashing_format? # rubocop:disable Naming/PredicateName\n+  def is_flashing_format? # rubocop:disable Naming/PredicatePrefix\n     if params[:action] == 'create'\n       false # Disable flash messages for sign-up\n     else\n---\napp/models/concerns/attachmentable.rb\n@@ -22,7 +22,7 @@ module Attachmentable\n   ).freeze\n \n   included do\n-    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicateName\n+    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicatePrefix\n       super\n \n       send(:\"before_#{name}_validate\", prepend: true) do\n---\napp/models/user_settings/glue.rb\n@@ -17,7 +17,7 @@ def type_for_attribute(key)\n     self.class.definition_for(key)&.type\n   end\n \n-  def has_attribute?(key) # rubocop:disable Naming/PredicateName\n+  def has_attribute?(key) # rubocop:disable Naming/PredicatePrefix\n     self.class.definition_for?(key)\n   end\n end\n---\nconfig/initializers/1_hosts.rb\n@@ -21,7 +21,7 @@\n \n   config.x.streaming_api_base_url = ENV.fetch('STREAMING_API_BASE_URL') do\n     if Rails.env.production?\n-      \"ws#{https ? 's' : ''}://#{web_host}\"\n+      \"ws#{'s' if https}://#{web_host}\"\n     else\n       \"ws://#{host.split(':').first}:4000\"\n     end\n---\nconfig/initializers/content_security_policy.rb\n@@ -32,7 +32,7 @@\n \n   if Rails.env.development?\n     vite_public_host = ENV.fetch('VITE_DEV_SERVER_PUBLIC', \"localhost:#{ViteRuby.config.port}\")\n-    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{ViteRuby.config.https ? 's' : ''}://#{vite_public_host}\" }\n+    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{'s' if ViteRuby.config.https}://#{vite_public_host}\" }\n \n     p.connect_src :self, :data, :blob, *media_hosts, Rails.configuration.x.streaming_api_base_url, *front_end_build_urls\n     p.script_src  :self, :unsafe_inline, :unsafe_eval, assets_host\n---\nlib/mastodon/migration_warning.rb\n@@ -23,7 +23,7 @@ def migration_duration_warning(explanation = nil)\n \n     def announce_countdown\n       WARNING_SECONDS.downto(1) do |i|\n-        say \"Continuing in #{i} second#{i == 1 ? '' : 's'}...\", true\n+        say \"Continuing in #{i} second#{'s' unless i == 1}...\", true\n         sleep 1\n       end\n     end\n---\nlib/mastodon/version.rb\n@@ -75,7 +75,7 @@ def source_commit\n     end\n \n     def user_agent\n-      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{Rails.configuration.x.use_https ? 's' : ''}://#{Rails.configuration.x.web_domain}/)\"\n+      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{'s' if Rails.configuration.x.use_https}://#{Rails.configuration.x.web_domain}/)\"\n     end\n \n     def version_configuration\n---\n\n\n---\n\nChoice C:\n.github/renovate.json5\n@@ -28,6 +28,9 @@\n         // react-router: Requires manual upgrade\n         'history',\n         'react-router-dom',\n+\n+        // react-spring: Requires manual upgrade when upgrading react\n+        '@react-spring/web',\n       ],\n       matchUpdateTypes: ['major'],\n       dependencyDashboardApproval: true,\n---\napp/javascript/mastodon/features/video/components/hotkey_indicator.tsx\n@@ -24,9 +24,7 @@ export const HotkeyIndicator: React.FC<{\n     enter: [{ opacity: 1 }],\n     leave: [{ opacity: 0 }],\n     onRest: (_result, _ctrl, item) => {\n-      if (item) {\n-        onDismiss(item);\n-      }\n+      onDismiss(item);\n     },\n   });\n \n---\npackage.json\n@@ -44,7 +44,7 @@\n     \"@github/webauthn-json\": \"^2.1.1\",\n     \"@optimize-lodash/rollup-plugin\": \"^5.0.2\",\n     \"@rails/ujs\": \"7.1.501\",\n-    \"@react-spring/web\": \"^10.0.0\",\n+    \"@react-spring/web\": \"^9.7.5\",\n     \"@reduxjs/toolkit\": \"^2.0.1\",\n     \"@use-gesture/react\": \"^10.3.1\",\n     \"@vitejs/plugin-legacy\": \"^6.1.1\",\n---\nyarn.lock\n@@ -2460,7 +2460,7 @@ __metadata:\n     \"@github/webauthn-json\": \"npm:^2.1.1\"\n     \"@optimize-lodash/rollup-plugin\": \"npm:^5.0.2\"\n     \"@rails/ujs\": \"npm:7.1.501\"\n-    \"@react-spring/web\": \"npm:^10.0.0\"\n+    \"@react-spring/web\": \"npm:^9.7.5\"\n     \"@reduxjs/toolkit\": \"npm:^2.0.1\"\n     \"@testing-library/dom\": \"npm:^10.2.0\"\n     \"@testing-library/react\": \"npm:^16.0.0\"\n@@ -2887,69 +2887,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/animated@npm:10.0.1\"\n+\"@react-spring/animated@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/animated@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/shared\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/aaccd4a8b0280ac846d463b253ad8f092ee4afc9dbedc8e77616adf5399ffec755344f09fdd8487cadaf815840dff84d354d1143579c27c2fcd6937549b5fc40\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/f8c2473c60f39a878c7dd0fdfcfcdbc720521e1506aa3f63c9de64780694a0a73d5ccc535a5ccec3520ddb70a71cf43b038b32c18e99531522da5388c510ecd7\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/core@npm:10.0.1\"\n+\"@react-spring/core@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/core@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.1\"\n-    \"@react-spring/shared\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/animated\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/059b122dda4138e5e7e461abd49350921e326735ca9a1d8aa19b1fdbae0937661b5f71af6fe82fd8f59e8db5549627849b38cc3f7ef2ec7ee9c93c3d6225174f\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/5bfd83dfe248cd91889f215f015d908c7714ef445740fd5afa054b27ebc7d5a456abf6c309e2459d9b5b436e78d6fda16b62b9601f96352e9130552c02270830\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/rafz@npm:10.0.1\"\n-  checksum: 10c0/cba76f143d3a06f79dd0c09f7aefd17df9cca9b2c1ef7f9103255e5351326f4a42a5a1366f731a78f74380d96ba683bcc2a49312ed1e4b9e9e249e72c9ff68cb\n+\"@react-spring/rafz@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/rafz@npm:9.7.5\"\n+  checksum: 10c0/8bdad180feaa9a0e870a513043a5e98a4e9b7292a9f887575b7e6fadab2677825bc894b7ff16c38511b35bfe6cc1072df5851c5fee64448d67551559578ca759\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/shared@npm:10.0.1\"\n+\"@react-spring/shared@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/shared@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/rafz\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/f056aaa018b3744afd8244e8eea24534d32f92fad9ace815b80e159b296fb5db148e2c9bd840ad9a5188e7a3c0778fd564b8af9ae02cd500e019a228398fb3cf\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/0207eacccdedd918a2fc55e78356ce937f445ce27ad9abd5d3accba8f9701a39349b55115641dc2b39bb9d3a155b058c185b411d292dc8cc5686bfa56f73b94f\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/types@npm:10.0.1\"\n-  checksum: 10c0/260890f9c156dc69b77c846510017156d8c0a07cce70edc7c108e57b0cf4122b26a15e724b191481a51b2c914296de9e81d56618b2c339339d4b221930691baa\n+\"@react-spring/types@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/types@npm:9.7.5\"\n+  checksum: 10c0/85c05121853cacb64f7cf63a4855e9044635e1231f70371cd7b8c78bc10be6f4dd7c68f592f92a2607e8bb68051540989b4677a2ccb525dba937f5cd95dc8bc1\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/web@npm:^10.0.0\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/web@npm:10.0.1\"\n+\"@react-spring/web@npm:^9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/web@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.1\"\n-    \"@react-spring/core\": \"npm:~10.0.1\"\n-    \"@react-spring/shared\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/animated\": \"npm:~9.7.5\"\n+    \"@react-spring/core\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/a0c788c9fd881ccb834feb22fc0694e74e59f7b76e498f0096f5b65e2c9812513955bf45ee27d7c5348f56a7bba7c5a6961d4be663728bb2172fe5aa6b6bdfc4\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/bcd1e052e1b16341a12a19bf4515f153ca09d1fa86ff7752a5d02d7c4db58e8baf80e6283e64411f1e388c65340dce2254b013083426806b5dbae38bd151e53e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\napp/lib/entity_cache.rb\n@@ -26,7 +26,9 @@ def emoji(shortcodes, domain)\n       uncached_ids << shortcode unless cached.key?(to_key(:emoji, shortcode, domain))\n     end\n \n-    unless uncached_ids.empty?\n+    if uncached_ids.empty?\n+      uncached = {}\n+    else\n       uncached = CustomEmoji.enabled.where(shortcode: shortcodes, domain: domain).index_by(&:shortcode)\n       uncached.each_value { |item| Rails.cache.write(to_key(:emoji, item.shortcode, domain), item, expires_in: MAX_EXPIRATION) }\n     end\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFollow-up on https://github.com/mastodon/mastodon/pull/34743\r\n\r\n\n\n---\n\nChoice A:\n.nvmrc\n@@ -1 +1 @@\n-22.15\n+22.16\n---\n\n\n---\n\nChoice B:\napp/models/user.rb\n@@ -73,7 +73,6 @@ class User < ApplicationRecord\n   ACTIVE_DURATION = ENV.fetch('USER_ACTIVE_DAYS', 7).to_i.days.freeze\n \n   devise :two_factor_authenticatable,\n-         otp_secret_encryption_key: Rails.configuration.x.otp_secret,\n          otp_secret_length: 32\n \n   devise :two_factor_backupable,\n---\nconfig/environments/development.rb\n@@ -84,9 +84,6 @@\n   # Otherwise, use letter_opener, which launches a browser window to view sent mail.\n   config.action_mailer.delivery_method = ENV['HEROKU'] || ENV['VAGRANT'] || ENV['REMOTE_DEV'] ? :letter_opener_web : :letter_opener\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = ENV.fetch('OTP_SECRET', '1fc2b87989afa6351912abeebe31ffc5c476ead9bf8b3d74cbc4a302c7b69a45b40b1bbef3506ddad73e942e15ed5ca4b402bf9a66423626051104f4b5f05109')\n-\n   # Raise error when a before_action's only/except options reference missing actions.\n   config.action_controller.raise_on_missing_callback_actions = true\n \n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/actions/search.ts\n@@ -121,10 +121,15 @@ export const clickSearchResult = createAppAsyncThunk(\n \n export const forgetSearchResult = createAppAsyncThunk(\n   'search/forgetResult',\n-  (q: string, { dispatch, getState }) => {\n+  (\n+    { q, type }: { q: string; type?: RecentSearchType },\n+    { dispatch, getState },\n+  ) => {\n     const previous = getState().search.recent;\n     const me = getState().meta.get('me') as string;\n-    const current = previous.filter((result) => result.q !== q);\n+    const current = previous.filter(\n+      (result) => result.q !== q || result.type !== type,\n+    );\n \n     searchHistory.set(me, current);\n     dispatch(updateSearchHistory(current));\n---\napp/javascript/mastodon/features/compose/components/search.tsx\n@@ -221,7 +221,7 @@ export const Search: React.FC<{\n     },\n     forget: (e) => {\n       e.stopPropagation();\n-      void dispatch(forgetSearchResult(search.q));\n+      void dispatch(forgetSearchResult(search));\n     },\n   }));\n \n@@ -497,8 +497,10 @@ export const Search: React.FC<{\n             <div className='search__popout__menu'>\n               {recentOptions.length > 0 ? (\n                 recentOptions.map(({ label, key, action, forget }, i) => (\n-                  <button\n+                  <div\n                     key={key}\n+                    tabIndex={0}\n+                    role='button'\n                     onMouseDown={action}\n                     className={classNames(\n                       'search__popout__menu__item search__popout__menu__item--flex',\n@@ -509,7 +511,7 @@ export const Search: React.FC<{\n                     <button className='icon-button' onMouseDown={forget}>\n                       <Icon id='times' icon={CloseIcon} />\n                     </button>\n-                  </button>\n+                  </div>\n                 ))\n               ) : (\n                 <div className='search__popout__menu__message'>\n---\n\n\n---\n\nChoice D:\nlib/chewy/index_extensions.rb\n@@ -12,6 +12,13 @@ def index_preset(base_options = {})\n         base_options.merge(number_of_replicas: 1, number_of_shards: (base_options[:number_of_shards] || 1) * 2)\n       end\n     end\n+\n+    def update_specification\n+      client.indices.close index: index_name\n+      client.indices.put_settings index: index_name, body: { settings: { analysis: settings_hash[:settings][:analysis] } }\n+      client.indices.put_mapping index: index_name, body: root.mappings_hash\n+      client.indices.open index: index_name\n+    end\n   end\n end\n \n---\nlib/mastodon/cli/search.rb\n@@ -56,7 +56,7 @@ def deploy\n       if options[:only_mapping]\n         indices.select { |index| index.specification.changed? }.each do |index|\n           progress.title = \"Updating mapping for #{index} \"\n-          index.update_mapping\n+          index.update_specification\n           index.specification.lock!\n         end\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis does for the production environment what https://github.com/mastodon/mastodon/pull/34734 did in development -- just shorthand method to wrap the tagged logger setup.\r\n\r\nOnly other stuff here:\r\n\r\n- We were previously setting the `log_formatter` config value, but then not using that setting (and instead re-assigning same formatter). I didn't do a full history dive on this but I suspect the order got shuffled at some point and that's why we repeated it? Updated to move the setting closer to (and above) the other log-related stuff, and to then use the setting by passing it in via `formatter` arg.\r\n- Aligned the `log_level` and `logger` comment lines to match output of rails 8 generator\r\n\r\nRan a few requests in production mode locally to verify format looks same as before.\n\n---\n\nChoice A:\nREADME.md\n@@ -57,7 +57,7 @@ Mastodon is a **free, open-source social network server** based on ActivityPub w\n \n ### Requirements\n \n-- **PostgreSQL** 12+\n+- **PostgreSQL** 13+\n - **Redis** 6.2+\n - **Ruby** 3.2+\n - **Node.js** 18+\n---\nconfig/initializers/strong_migrations.rb\n@@ -1,4 +1,4 @@\n # frozen_string_literal: true\n \n StrongMigrations.start_after = 2017_09_24_022025\n-StrongMigrations.target_version = 12\n+StrongMigrations.target_version = 13\n---\nlib/tasks/db.rake\n@@ -63,7 +63,7 @@ namespace :db do\n \n   task pre_migration_check: :environment do\n     pg_version = ActiveRecord::Base.connection.database_version\n-    abort 'This version of Mastodon requires PostgreSQL 12.0 or newer. Please update PostgreSQL before updating Mastodon.' if pg_version < 120_000\n+    abort 'This version of Mastodon requires PostgreSQL 13.0 or newer. Please update PostgreSQL before updating Mastodon.' if pg_version < 130_000\n \n     schema_version = ActiveRecord::Migrator.current_version\n     abort <<~MESSAGE if ENV['SKIP_POST_DEPLOYMENT_MIGRATIONS'] && schema_version < 2023_09_07_150100\n---\n\n\n---\n\nChoice B:\n.ruby-version\n@@ -1 +1 @@\n-3.4.3\n+3.4.4\n---\n\n\n---\n\nChoice C:\nconfig/environments/production.rb\n@@ -52,17 +52,14 @@\n     },\n   }\n \n-  # Log to STDOUT by default\n-  config.logger = ActiveSupport::Logger.new($stdout)\n-                                       .tap  { |logger| logger.formatter = ::Logger::Formatter.new }\n-                                       .then { |logger| ActiveSupport::TaggedLogging.new(logger) }\n+  # Use default logging formatter so that PID and timestamp are not suppressed.\n+  config.log_formatter = Logger::Formatter.new\n \n-  # Prepend all log lines with the following tags.\n+  # Log to STDOUT with the current request id as a default log tag.\n   config.log_tags = [:request_id]\n+  config.logger = ActiveSupport::TaggedLogging.logger($stdout, formatter: config.log_formatter)\n \n-  # \"info\" includes generic and useful information about system operation, but avoids logging too much\n-  # information to avoid inadvertent exposure of personally identifiable information (PII). If you\n-  # want to log everything, set the level to \"debug\".\n+  # Change to \"debug\" to log everything (including potentially personally-identifiable information!)\n   config.log_level = ENV.fetch('RAILS_LOG_LEVEL', 'info')\n \n   # Use a different cache store in production.\n@@ -90,9 +87,6 @@\n   # Don't log any deprecations.\n   config.active_support.report_deprecations = false\n \n-  # Use default logging formatter so that PID and timestamp are not suppressed.\n-  config.log_formatter = ::Logger::Formatter.new\n-\n   # Better log formatting\n   config.lograge.enabled = true\n \n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -66,10 +66,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/compat-data@npm:^7.22.6, @babel/compat-data@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/compat-data@npm:7.27.1\"\n-  checksum: 10c0/03e3a01b6772858dc5064f332ad4dc16fbbc0353f2180fd663a2651e8305058e35b6db57114e345d925def9b73cd7a322e95a45913428b8db705a098fd3dd289\n+\"@babel/compat-data@npm:^7.22.6, @babel/compat-data@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/compat-data@npm:7.27.2\"\n+  checksum: 10c0/077c9e01af3b90decee384a6a44dcf353898e980cee22ec7941f9074655dbbe97ec317345536cdc7ef7391521e1497930c522a3816af473076dd524be7fccd32\n   languageName: node\n   linkType: hard\n \n@@ -128,16 +128,16 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/helper-compilation-targets@npm:7.27.1\"\n+\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/helper-compilation-targets@npm:7.27.2\"\n   dependencies:\n-    \"@babel/compat-data\": \"npm:^7.27.1\"\n+    \"@babel/compat-data\": \"npm:^7.27.2\"\n     \"@babel/helper-validator-option\": \"npm:^7.27.1\"\n     browserslist: \"npm:^4.24.0\"\n     lru-cache: \"npm:^5.1.1\"\n     semver: \"npm:^6.3.1\"\n-  checksum: 10c0/1cfd3760a1bf1e367ea4a91214c041be7076197ba7a4f3c0710cab00fb5734eb010a2946efe6ecfb1ca9dc63e6c69644a1afa399db4082f374b9311e129f6f0b\n+  checksum: 10c0/f338fa00dcfea931804a7c55d1a1c81b6f0a09787e528ec580d5c21b3ecb3913f6cb0f361368973ce953b824d910d3ac3e8a8ee15192710d3563826447193ad1\n   languageName: node\n   linkType: hard\n \n@@ -934,16 +934,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-object-rest-spread@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/plugin-transform-object-rest-spread@npm:7.27.1\"\n+\"@babel/plugin-transform-object-rest-spread@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/plugin-transform-object-rest-spread@npm:7.27.2\"\n   dependencies:\n-    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.2\"\n     \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n+    \"@babel/plugin-transform-destructuring\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-parameters\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ac73caea178b51a64cc1c5e5ce1a67bacf89c1af664ef219aa1403d54258804113d6f267820c211768460e056f3aeb642c98ee14842c4fb548974c82f7dbe7dd\n+  checksum: 10c0/5e255b262dd65c8700078d9f6ed87bd45f951a905dda6b3414be28d7b2781b18e6b812e9d71421e61360c9cf51e1e619c1d48348593bb7399496f61f5f221446\n   languageName: node\n   linkType: hard\n \n@@ -1270,11 +1271,11 @@ __metadata:\n   linkType: hard\n \n \"@babel/preset-env@npm:^7.11.0, @babel/preset-env@npm:^7.12.1, @babel/preset-env@npm:^7.22.4\":\n-  version: 7.27.1\n-  resolution: \"@babel/preset-env@npm:7.27.1\"\n+  version: 7.27.2\n+  resolution: \"@babel/preset-env@npm:7.27.2\"\n   dependencies:\n-    \"@babel/compat-data\": \"npm:^7.27.1\"\n-    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/compat-data\": \"npm:^7.27.2\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.2\"\n     \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n     \"@babel/helper-validator-option\": \"npm:^7.27.1\"\n     \"@babel/plugin-bugfix-firefox-class-in-computed-class-key\": \"npm:^7.27.1\"\n@@ -1316,7 +1317,7 @@ __metadata:\n     \"@babel/plugin-transform-new-target\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-nullish-coalescing-operator\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-numeric-separator\": \"npm:^7.27.1\"\n-    \"@babel/plugin-transform-object-rest-spread\": \"npm:^7.27.1\"\n+    \"@babel/plugin-transform-object-rest-spread\": \"npm:^7.27.2\"\n     \"@babel/plugin-transform-object-super\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-optional-catch-binding\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-optional-chaining\": \"npm:^7.27.1\"\n@@ -1344,7 +1345,7 @@ __metadata:\n     semver: \"npm:^6.3.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/893b269f5e7e2084ee7fb60d3a1f154470c89169475170a8a595f1910cade9c9978b42df5405a46a699529dfdb1c6b0135cc4c0aa8f9e685ae230b1cb0172ad9\n+  checksum: 10c0/fd7ec310832a9ff26ed8d56bc0832cdbdb3a188e022050b74790796650649fb8373568af05b320b58b3ff922507979bad50ff95a4d504ab0081134480103504e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis is a reformulation of https://github.com/mastodon/mastodon/pull/25988 - but removes the \"remove all namespaces\" stuff from https://github.com/mastodon/mastodon/pull/34742\r\n\r\nI think this is the bare minimum set of changes needed to both upgrade sidekiq and get passing suite. Some notes:\r\n\r\n- Without specifically including `hiredis-client`, I got errors. Notes on that gem: https://github.com/redis-rb/redis-client?tab=readme-ov-file#drivers\r\n- We do need to also keep `hiredis` around\r\n- The `sidekiq-unique-jobs` gem bump is needed for sidekiq 7 support and from its changelog, all 8.x changes appear to be bugfixes or project meta stuff\r\n- The way some config stuff is accessed changed, updated for that\r\n- Even with the value set to nil, sidekiq was bubbling up errors if the `namespace` attribute was present at all in that config spot, hence removal\n\n---\n\nChoice A:\nGemfile.lock\n@@ -90,7 +90,7 @@ GEM\n       public_suffix (>= 2.0.2, < 7.0)\n     aes_key_wrap (1.1.0)\n     android_key_attestation (0.3.0)\n-    annotaterb (4.14.0)\n+    annotaterb (4.15.0)\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n---\n\n\n---\n\nChoice B:\nspec/lib/activitypub/activity/remove_spec.rb\n@@ -4,29 +4,60 @@\n \n RSpec.describe ActivityPub::Activity::Remove do\n   let(:sender) { Fabricate(:account, featured_collection_url: 'https://example.com/featured') }\n-  let(:status) { Fabricate(:status, account: sender) }\n-\n-  let(:json) do\n-    {\n-      '@context': 'https://www.w3.org/ns/activitystreams',\n-      id: 'foo',\n-      type: 'Add',\n-      actor: ActivityPub::TagManager.instance.uri_for(sender),\n-      object: ActivityPub::TagManager.instance.uri_for(status),\n-      target: sender.featured_collection_url,\n-    }.with_indifferent_access\n-  end\n \n   describe '#perform' do\n     subject { described_class.new(json, sender) }\n \n-    before do\n-      StatusPin.create!(account: sender, status: status)\n-      subject.perform\n+    context 'when removing a pinned status' do\n+      let(:status) { Fabricate(:status, account: sender) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: ActivityPub::TagManager.instance.uri_for(status),\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        StatusPin.create!(account: sender, status: status)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.pinned?(status) }.to(false)\n+      end\n     end\n \n-    it 'removes a pin' do\n-      expect(sender.pinned?(status)).to be false\n+    context 'when removing a featured tag' do\n+      let(:tag) { Fabricate(:tag) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: {\n+            type: 'Hashtag',\n+            name: \"##{tag.display_name}\",\n+            href: \"https://example.com/tags/#{tag.name}\",\n+          },\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        sender.featured_tags.find_or_create_by!(name: tag.name)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.featured_tags.exists?(tag: tag) }.to(false)\n+      end\n     end\n   end\n end\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -52,6 +52,7 @@ gem 'faraday-httpclient'\n gem 'fast_blank', '~> 1.0'\n gem 'fastimage'\n gem 'hiredis', '~> 0.6'\n+gem 'hiredis-client'\n gem 'htmlentities', '~> 4.3'\n gem 'http', '~> 5.2.0'\n gem 'http_accept_language', '~> 2.1'\n@@ -82,10 +83,10 @@ gem 'rqrcode', '~> 3.0'\n gem 'ruby-progressbar', '~> 1.13'\n gem 'sanitize', '~> 7.0'\n gem 'scenic', '~> 1.7'\n-gem 'sidekiq', '~> 6.5'\n+gem 'sidekiq', '< 8'\n gem 'sidekiq-bulk', '~> 0.2.0'\n gem 'sidekiq-scheduler', '~> 5.0'\n-gem 'sidekiq-unique-jobs', '~> 7.1'\n+gem 'sidekiq-unique-jobs', '> 8'\n gem 'simple_form', '~> 5.2'\n gem 'simple-navigation', '~> 4.4'\n gem 'stoplight', '~> 4.1'\n---\nGemfile.lock\n@@ -129,9 +129,6 @@ GEM\n     brakeman (7.0.2)\n       racc\n     browser (6.2.0)\n-    brpoplpush-redis_script (0.1.3)\n-      concurrent-ruby (~> 1.0, >= 1.0.5)\n-      redis (>= 1.0, < 6)\n     builder (3.3.0)\n     bundler-audit (0.9.2)\n       bundler (>= 1.2.0, < 3)\n@@ -294,6 +291,8 @@ GEM\n     highline (3.1.2)\n       reline\n     hiredis (0.6.3)\n+    hiredis-client (0.24.0)\n+      redis-client (= 0.24.0)\n     hkdf (0.3.0)\n     htmlentities (4.3.4)\n     http (5.2.0)\n@@ -696,6 +695,8 @@ GEM\n       psych (>= 4.0.0)\n     redcarpet (3.6.1)\n     redis (4.8.1)\n+    redis-client (0.24.0)\n+      connection_pool\n     redlock (1.3.2)\n       redis (>= 3.0.0, < 6.0)\n     regexp_parser (2.10.0)\n@@ -808,22 +809,22 @@ GEM\n       websocket (~> 1.0)\n     shoulda-matchers (6.5.0)\n       activesupport (>= 5.2.0)\n-    sidekiq (6.5.12)\n-      connection_pool (>= 2.2.5, < 3)\n-      rack (~> 2.0)\n-      redis (>= 4.5.0, < 5)\n+    sidekiq (7.3.9)\n+      base64\n+      connection_pool (>= 2.3.0)\n+      logger\n+      rack (>= 2.2.4)\n+      redis-client (>= 0.22.2)\n     sidekiq-bulk (0.2.0)\n       sidekiq\n     sidekiq-scheduler (5.0.6)\n       rufus-scheduler (~> 3.2)\n       sidekiq (>= 6, < 8)\n       tilt (>= 1.4.0, < 3)\n-    sidekiq-unique-jobs (7.1.33)\n-      brpoplpush-redis_script (> 0.1.1, <= 2.0.0)\n+    sidekiq-unique-jobs (8.0.10)\n       concurrent-ruby (~> 1.0, >= 1.0.5)\n-      redis (< 5.0)\n-      sidekiq (>= 5.0, < 7.0)\n-      thor (>= 0.20, < 3.0)\n+      sidekiq (>= 7.0.0, < 8.0.0)\n+      thor (>= 1.0, < 3.0)\n     simple-navigation (4.4.0)\n       activesupport (>= 2.3.2)\n     simple_form (5.3.1)\n@@ -976,6 +977,7 @@ DEPENDENCIES\n   haml_lint\n   hcaptcha (~> 7.1)\n   hiredis (~> 0.6)\n+  hiredis-client\n   htmlentities (~> 4.3)\n   http (~> 5.2.0)\n   http_accept_language (~> 2.1)\n@@ -1064,10 +1066,10 @@ DEPENDENCIES\n   scenic (~> 1.7)\n   selenium-webdriver\n   shoulda-matchers\n-  sidekiq (~> 6.5)\n+  sidekiq (< 8)\n   sidekiq-bulk (~> 0.2.0)\n   sidekiq-scheduler (~> 5.0)\n-  sidekiq-unique-jobs (~> 7.1)\n+  sidekiq-unique-jobs (> 8)\n   simple-navigation (~> 4.4)\n   simple_form (~> 5.2)\n   simplecov (~> 0.22)\n---\napp/lib/redis_connection.rb\n@@ -15,7 +15,7 @@ def pool\n \n     def pool_size\n       if Sidekiq.server?\n-        Sidekiq[:concurrency]\n+        Sidekiq.default_configuration[:concurrency]\n       else\n         ENV['MAX_THREADS'] || 5\n       end\n---\napp/workers/scheduler/self_destruct_scheduler.rb\n@@ -20,7 +20,7 @@ def perform\n   private\n \n   def sidekiq_overwhelmed?\n-    redis_mem_info = Sidekiq.redis_info\n+    redis_mem_info = Sidekiq.default_configuration.redis_info\n \n     Sidekiq::Stats.new.enqueued > MAX_ENQUEUED || redis_mem_info['used_memory'].to_f > redis_mem_info['total_system_memory'].to_f * MAX_REDIS_MEM_USAGE\n   end\n---\nconfig/database.yml\n@@ -1,6 +1,6 @@\n default: &default\n   adapter: postgresql\n-  pool: <%= ENV[\"DB_POOL\"] || (if Sidekiq.server? then Sidekiq[:concurrency] else ENV['MAX_THREADS'] end) || 5 %>\n+  pool: <%= ENV[\"DB_POOL\"] || (if Sidekiq.server? then Sidekiq.default_configuration[:concurrency] else ENV['MAX_THREADS'] end) || 5 %>\n   timeout: 5000\n   connect_timeout: 15\n   encoding: unicode\n---\nconfig/initializers/sidekiq.rb\n@@ -89,6 +89,8 @@\n     end\n   end\n \n+  config.logger.level = Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+\n   SidekiqUniqueJobs::Server.configure(config)\n end\n \n@@ -98,9 +100,9 @@\n   config.client_middleware do |chain|\n     chain.add SidekiqUniqueJobs::Middleware::Client\n   end\n-end\n \n-Sidekiq.logger.level = ::Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+  config.logger.level = Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+end\n \n SidekiqUniqueJobs.configure do |config|\n   config.enabled         = !Rails.env.test?\n---\nlib/mastodon/redis_configuration.rb\n@@ -9,7 +9,6 @@ class Mastodon::RedisConfiguration\n \n   def base\n     @base ||= setup_config(prefix: nil, defaults: DEFAULTS)\n-              .merge(namespace: nil)\n   end\n \n   def sidekiq\n@@ -23,7 +22,7 @@ def cache\n                  expires_in: 10.minutes,\n                  connect_timeout: 5,\n                  pool: {\n-                   size: Sidekiq.server? ? Sidekiq[:concurrency] : Integer(ENV['MAX_THREADS'] || 5),\n+                   size: Sidekiq.server? ? Sidekiq.default_configuration[:concurrency] : Integer(ENV['MAX_THREADS'] || 5),\n                    timeout: 5,\n                  },\n                })\n---\nspec/lib/mastodon/redis_configuration_spec.rb\n@@ -156,7 +156,6 @@\n         expect(subject).to eq({\n           url: 'redis://localhost:6379/0',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n@@ -172,7 +171,6 @@\n         expect(subject).to eq({\n           url: 'redis::/user@example.com/2',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n@@ -188,7 +186,6 @@\n         expect(subject).to eq({\n           url: 'redis://:testpass@redis.example.com:3333/3',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n---\nspec/rails_helper.rb\n@@ -53,7 +53,7 @@\n   allow_localhost: true,\n   allow: Chewy.settings[:host]\n )\n-Sidekiq.logger = nil\n+Sidekiq.default_configuration.logger = nil\n \n DatabaseCleaner.strategy = [:deletion]\n \n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -124,7 +124,7 @@ GEM\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n-    bootsnap (1.18.5)\n+    bootsnap (1.18.6)\n       msgpack (~> 1.2)\n     brakeman (7.0.2)\n       racc\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThere is no immediate reason for us to drop PostgreSQL 12, but PostgreSQL 12 is already End-of-Life and we do not want to be stuck with old releases for the lifetime of Mastodon 4.4.\n\n---\n\nChoice A:\npackage.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/mastodon\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.0\",\n+  \"packageManager\": \"yarn@4.9.1\",\n   \"engines\": {\n     \"node\": \">=18\"\n   },\n---\nstreaming/package.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/streaming\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.0\",\n+  \"packageManager\": \"yarn@4.9.1\",\n   \"engines\": {\n     \"node\": \">=18\"\n   },\n---\n\n\n---\n\nChoice B:\npackage.json\n@@ -107,7 +107,7 @@\n     \"react-overlays\": \"^5.2.1\",\n     \"react-redux\": \"^9.0.4\",\n     \"react-redux-loading-bar\": \"^5.0.8\",\n-    \"react-router\": \"^5.3.4\",\n+    \"react-router\": \"^7.0.0\",\n     \"react-router-dom\": \"^5.3.4\",\n     \"react-router-scroll-4\": \"^1.0.0-beta.1\",\n     \"react-select\": \"^5.7.3\",\n---\nyarn.lock\n@@ -2936,7 +2936,7 @@ __metadata:\n     react-overlays: \"npm:^5.2.1\"\n     react-redux: \"npm:^9.0.4\"\n     react-redux-loading-bar: \"npm:^5.0.8\"\n-    react-router: \"npm:^5.3.4\"\n+    react-router: \"npm:^7.0.0\"\n     react-router-dom: \"npm:^5.3.4\"\n     react-router-scroll-4: \"npm:^1.0.0-beta.1\"\n     react-select: \"npm:^5.7.3\"\n@@ -6662,6 +6662,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"cookie@npm:^1.0.1\":\n+  version: 1.0.2\n+  resolution: \"cookie@npm:1.0.2\"\n+  checksum: 10c0/fd25fe79e8fbcfcaf6aa61cd081c55d144eeeba755206c058682257cb38c4bd6795c6620de3f064c740695bb65b7949ebb1db7a95e4636efb8357a335ad3f54b\n+  languageName: node\n+  linkType: hard\n+\n \"copy-descriptor@npm:^0.1.0\":\n   version: 0.1.1\n   resolution: \"copy-descriptor@npm:0.1.1\"\n@@ -14929,7 +14936,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-router@npm:5.3.4, react-router@npm:^5.3.4\":\n+\"react-router@npm:5.3.4\":\n   version: 5.3.4\n   resolution: \"react-router@npm:5.3.4\"\n   dependencies:\n@@ -14948,6 +14955,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"react-router@npm:^7.0.0\":\n+  version: 7.5.2\n+  resolution: \"react-router@npm:7.5.2\"\n+  dependencies:\n+    cookie: \"npm:^1.0.1\"\n+    set-cookie-parser: \"npm:^2.6.0\"\n+    turbo-stream: \"npm:2.4.0\"\n+  peerDependencies:\n+    react: \">=18\"\n+    react-dom: \">=18\"\n+  peerDependenciesMeta:\n+    react-dom:\n+      optional: true\n+  checksum: 10c0/5972ecb783e0ac0512c500b84bd4ff475665ba49c67b69e13b79dc24c7ee0496d523858058bb43c70147367688e0cc0d6d6d0f51cabfdebfbc5556d559bff457\n+  languageName: node\n+  linkType: hard\n+\n \"react-select@npm:^5.7.3\":\n   version: 5.10.1\n   resolution: \"react-select@npm:5.10.1\"\n@@ -15944,6 +15968,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"set-cookie-parser@npm:^2.6.0\":\n+  version: 2.7.1\n+  resolution: \"set-cookie-parser@npm:2.7.1\"\n+  checksum: 10c0/060c198c4c92547ac15988256f445eae523f57f2ceefeccf52d30d75dedf6bff22b9c26f756bd44e8e560d44ff4ab2130b178bd2e52ef5571bf7be3bd7632d9a\n+  languageName: node\n+  linkType: hard\n+\n \"set-function-length@npm:^1.2.2\":\n   version: 1.2.2\n   resolution: \"set-function-length@npm:1.2.2\"\n@@ -17530,6 +17561,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"turbo-stream@npm:2.4.0\":\n+  version: 2.4.0\n+  resolution: \"turbo-stream@npm:2.4.0\"\n+  checksum: 10c0/e68b2569f1f16e6e9633d090c6024b2ae9f0e97bfeacb572451ca3732e120ebbb546f3bc4afc717c46cb57b5aea6104e04ef497f9912eef6a7641e809518e98a\n+  languageName: node\n+  linkType: hard\n+\n \"twemoji-parser@npm:^11.0.2\":\n   version: 11.0.2\n   resolution: \"twemoji-parser@npm:11.0.2\"\n---\n\n\n---\n\nChoice C:\nREADME.md\n@@ -57,7 +57,7 @@ Mastodon is a **free, open-source social network server** based on ActivityPub w\n \n ### Requirements\n \n-- **PostgreSQL** 12+\n+- **PostgreSQL** 13+\n - **Redis** 6.2+\n - **Ruby** 3.2+\n - **Node.js** 18+\n---\nconfig/initializers/strong_migrations.rb\n@@ -1,4 +1,4 @@\n # frozen_string_literal: true\n \n StrongMigrations.start_after = 2017_09_24_022025\n-StrongMigrations.target_version = 12\n+StrongMigrations.target_version = 13\n---\nlib/tasks/db.rake\n@@ -63,7 +63,7 @@ namespace :db do\n \n   task pre_migration_check: :environment do\n     pg_version = ActiveRecord::Base.connection.database_version\n-    abort 'This version of Mastodon requires PostgreSQL 12.0 or newer. Please update PostgreSQL before updating Mastodon.' if pg_version < 120_000\n+    abort 'This version of Mastodon requires PostgreSQL 13.0 or newer. Please update PostgreSQL before updating Mastodon.' if pg_version < 130_000\n \n     schema_version = ActiveRecord::Migrator.current_version\n     abort <<~MESSAGE if ENV['SKIP_POST_DEPLOYMENT_MIGRATIONS'] && schema_version < 2023_09_07_150100\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -160,7 +160,7 @@ GEM\n     cocoon (1.2.15)\n     color_diff (0.1)\n     concurrent-ruby (1.3.5)\n-    connection_pool (2.5.2)\n+    connection_pool (2.5.3)\n     cose (1.3.1)\n       cbor (~> 0.5.9)\n       openssl-signature_algorithm (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nPrep for sidekiq upgrade.\r\n\r\nI think that with https://github.com/mastodon/mastodon/pull/34665 merged, all the removed code paths here are already not being used?\r\n\r\n\n\n---\n\nChoice A:\nGemfile\n@@ -78,7 +78,6 @@ gem 'rack-cors', '~> 2.0', require: 'rack/cors'\n gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n-gem 'redis-namespace', '~> 1.10'\n gem 'rqrcode', '~> 3.0'\n gem 'ruby-progressbar', '~> 1.13'\n gem 'sanitize', '~> 7.0'\n---\nGemfile.lock\n@@ -696,8 +696,6 @@ GEM\n       psych (>= 4.0.0)\n     redcarpet (3.6.1)\n     redis (4.8.1)\n-    redis-namespace (1.11.0)\n-      redis (>= 4)\n     redlock (1.3.2)\n       redis (>= 3.0.0, < 6.0)\n     regexp_parser (2.10.0)\n@@ -1046,7 +1044,6 @@ DEPENDENCIES\n   rdf-normalize (~> 0.5)\n   redcarpet (~> 3.6)\n   redis (~> 4.5)\n-  redis-namespace (~> 1.10)\n   rqrcode (~> 3.0)\n   rspec-github (~> 3.0)\n   rspec-rails (~> 8.0)\n---\napp/lib/admin/metrics/dimension/software_versions_dimension.rb\n@@ -119,10 +119,6 @@ def ffmpeg_version\n   end\n \n   def redis_info\n-    @redis_info ||= if redis.is_a?(Redis::Namespace)\n-                      redis.redis.info\n-                    else\n-                      redis.info\n-                    end\n+    @redis_info ||= redis.info\n   end\n end\n---\napp/lib/admin/metrics/dimension/space_usage_dimension.rb\n@@ -58,11 +58,7 @@ def media_size\n   end\n \n   def redis_info\n-    @redis_info ||= if redis.is_a?(Redis::Namespace)\n-                      redis.redis.info\n-                    else\n-                      redis.info\n-                    end\n+    @redis_info ||= redis.info\n   end\n \n   def search_size\n---\napp/lib/redis_connection.rb\n@@ -29,12 +29,7 @@ def initialize\n   end\n \n   def connection\n-    namespace = config[:namespace]\n-    if namespace.present?\n-      Redis::Namespace.new(namespace, redis: raw_connection)\n-    else\n-      raw_connection\n-    end\n+    raw_connection\n   end\n \n   private\n---\nconfig/application.rb\n@@ -24,7 +24,6 @@\n \n require_relative '../lib/exceptions'\n require_relative '../lib/sanitize_ext/sanitize_config'\n-require_relative '../lib/redis/namespace_extensions'\n require_relative '../lib/paperclip/url_generator_extensions'\n require_relative '../lib/paperclip/attachment_extensions'\n \n---\nlib/redis/namespace_extensions.rb\n@@ -1,16 +0,0 @@\n-# frozen_string_literal: true\n-\n-class Redis\n-  module NamespaceExtensions\n-    def exists?(...)\n-      call_with_namespace('exists?', ...)\n-    end\n-\n-    def with\n-      yield self\n-    end\n-  end\n-end\n-\n-Redis::Namespace::COMMANDS['exists?'] = [:first]\n-Redis::Namespace.prepend(Redis::NamespaceExtensions)\n---\nspec/controllers/oauth/authorized_applications_controller_spec.rb\n@@ -43,7 +43,7 @@\n     let!(:application) { Fabricate(:application) }\n     let!(:access_token) { Fabricate(:accessible_access_token, application: application, resource_owner_id: user.id) }\n     let!(:web_push_subscription) { Fabricate(:web_push_subscription, user: user, access_token: access_token) }\n-    let(:redis_pipeline_stub) { instance_double(Redis::Namespace, publish: nil) }\n+    let(:redis_pipeline_stub) { instance_double(Redis::PipelinedConnection, publish: nil) }\n \n     before do\n       sign_in user, scope: :user\n---\nspec/models/user_spec.rb\n@@ -489,7 +489,7 @@ def within_duration_window_days\n     let!(:access_token) { Fabricate(:access_token, resource_owner_id: user.id) }\n     let!(:web_push_subscription) { Fabricate(:web_push_subscription, access_token: access_token) }\n \n-    let(:redis_pipeline_stub) { instance_double(Redis::Namespace, publish: nil) }\n+    let(:redis_pipeline_stub) { instance_double(Redis::PipelinedConnection, publish: nil) }\n \n     before { stub_redis }\n \n---\nspec/system/settings/applications_spec.rb\n@@ -101,7 +101,7 @@ def submit_form\n   end\n \n   describe 'Destroying an application' do\n-    let(:redis_pipeline_stub) { instance_double(Redis::Namespace, publish: nil) }\n+    let(:redis_pipeline_stub) { instance_double(Redis::PipelinedConnection, publish: nil) }\n     let!(:access_token) { Fabricate(:accessible_access_token, application: application) }\n \n     before { stub_redis_pipeline }\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/account_timeline/hooks/familiar_followers.ts\n@@ -1,6 +1,7 @@\n import { useEffect } from 'react';\n \n import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n+import { useIdentity } from '@/mastodon/identity_context';\n import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n import { me } from 'mastodon/initial_state';\n@@ -14,14 +15,15 @@ export const useFetchFamiliarFollowers = ({\n   const familiarFollowers = useAppSelector((state) =>\n     accountId ? getAccountFamiliarFollowers(state, accountId) : null,\n   );\n+  const { signedIn } = useIdentity();\n \n   const hasNoData = familiarFollowers === null;\n \n   useEffect(() => {\n-    if (hasNoData && accountId && accountId !== me) {\n+    if (hasNoData && signedIn && accountId && accountId !== me) {\n       void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n     }\n-  }, [dispatch, accountId, hasNoData]);\n+  }, [dispatch, accountId, hasNoData, signedIn]);\n \n   return {\n     familiarFollowers: hasNoData ? [] : familiarFollowers,\n---\n\n\n---\n\nChoice C:\n.rubocop_todo.yml\n@@ -36,7 +36,6 @@ Rails/OutputSafety:\n Style/FetchEnvVar:\n   Exclude:\n     - 'config/initializers/2_limited_federation_mode.rb'\n-    - 'config/initializers/3_omniauth.rb'\n     - 'config/initializers/paperclip.rb'\n     - 'lib/tasks/repo.rake'\n \n---\nconfig/initializers/3_omniauth.rb\n@@ -12,7 +12,7 @@\n   # CAS strategy\n   if ENV['CAS_ENABLED'] == 'true'\n     cas_options = {}\n-    cas_options[:display_name] = ENV['CAS_DISPLAY_NAME']\n+    cas_options[:display_name] = ENV.fetch('CAS_DISPLAY_NAME', nil)\n     cas_options[:url] = ENV['CAS_URL'] if ENV['CAS_URL']\n     cas_options[:host] = ENV['CAS_HOST'] if ENV['CAS_HOST']\n     cas_options[:port] = ENV['CAS_PORT'] if ENV['CAS_PORT']\n@@ -41,7 +41,7 @@\n   # SAML strategy\n   if ENV['SAML_ENABLED'] == 'true'\n     saml_options = {}\n-    saml_options[:display_name] = ENV['SAML_DISPLAY_NAME']\n+    saml_options[:display_name] = ENV.fetch('SAML_DISPLAY_NAME', nil)\n     saml_options[:assertion_consumer_service_url] = ENV['SAML_ACS_URL'] if ENV['SAML_ACS_URL']\n     saml_options[:issuer] = ENV['SAML_ISSUER'] if ENV['SAML_ISSUER']\n     saml_options[:idp_sso_target_url] = ENV['SAML_IDP_SSO_TARGET_URL'] if ENV['SAML_IDP_SSO_TARGET_URL']\n@@ -73,7 +73,7 @@\n   # OpenID Connect Strategy\n   if ENV['OIDC_ENABLED'] == 'true'\n     oidc_options = {}\n-    oidc_options[:display_name] = ENV['OIDC_DISPLAY_NAME'] # OPTIONAL\n+    oidc_options[:display_name] = ENV.fetch('OIDC_DISPLAY_NAME', nil) # OPTIONAL\n     oidc_options[:issuer] = ENV['OIDC_ISSUER'] if ENV['OIDC_ISSUER'] # NEED\n     oidc_options[:discovery] = ENV['OIDC_DISCOVERY'] == 'true' if ENV['OIDC_DISCOVERY'] # OPTIONAL (default: false)\n     oidc_options[:client_auth_method] = ENV['OIDC_CLIENT_AUTH_METHOD'] if ENV['OIDC_CLIENT_AUTH_METHOD'] # OPTIONAL (default: basic)\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -339,7 +339,7 @@ GEM\n       azure-blob (~> 0.5.2)\n       hashie (~> 5.0)\n     jmespath (1.6.2)\n-    json (2.12.0)\n+    json (2.12.2)\n     json-canonicalization (1.0.0)\n     json-jwt (1.16.7)\n       activesupport (>= 4.2)\n@@ -750,7 +750,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.7)\n+    rubocop (1.75.8)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nTo use ImageMagick instead of libvips, set the `MASTODON_USE_LIBVIPS` environment variable to `false`.\n\n---\n\nChoice A:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -68,15 +68,15 @@ type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n \n export const QuotedStatus: React.FC<{\n   quote: QuoteMap;\n+  contextType?: string;\n   variant?: 'full' | 'link';\n   nestingLevel?: number;\n-}> = ({ quote, nestingLevel = 1, variant = 'full' }) => {\n+}> = ({ quote, contextType, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n   const state = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n-\n   let quoteError: React.ReactNode = null;\n \n   if (state === 'deleted') {\n@@ -131,10 +131,16 @@ export const QuotedStatus: React.FC<{\n   return (\n     <QuoteWrapper>\n       {/* @ts-expect-error Status is not yet typed */}\n-      <StatusContainer isQuotedPost id={quotedStatusId} avatarSize={40}>\n+      <StatusContainer\n+        isQuotedPost\n+        id={quotedStatusId}\n+        contextType={contextType}\n+        avatarSize={40}\n+      >\n         {canRenderChildQuote && (\n           <QuotedStatus\n             quote={childQuote}\n+            contextType={contextType}\n             variant={\n               nestingLevel === MAX_QUOTE_POSTS_NESTING_LEVEL ? 'link' : 'full'\n             }\n@@ -148,6 +154,7 @@ export const QuotedStatus: React.FC<{\n \n interface StatusQuoteManagerProps {\n   id: string;\n+  contextType?: string;\n   [key: string]: unknown;\n }\n \n@@ -168,7 +175,7 @@ export const StatusQuoteManager = (props: StatusQuoteManagerProps) => {\n   if (quote) {\n     return (\n       <StatusContainer {...props}>\n-        <QuotedStatus quote={quote} />\n+        <QuotedStatus quote={quote} contextType={props.contextType} />\n       </StatusContainer>\n     );\n   }\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -2886,69 +2886,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/animated@npm:10.0.0\"\n+\"@react-spring/animated@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/animated@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/a8c40aff22def6dbe964b1f79fa4a7774c44bf5eb47c2ef969c8ecb2a426b4c972b147bf18635d6972dbec3fb95e70dd84f22b43c904c32dfc7a57ad144a0879\n+  checksum: 10c0/aaccd4a8b0280ac846d463b253ad8f092ee4afc9dbedc8e77616adf5399ffec755344f09fdd8487cadaf815840dff84d354d1143579c27c2fcd6937549b5fc40\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/core@npm:10.0.0\"\n+\"@react-spring/core@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/core@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.0\"\n-    \"@react-spring/shared\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/animated\": \"npm:~10.0.1\"\n+    \"@react-spring/shared\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/39036a153dbd973443e23d90cb8e7be83201b1f0e4105f8427ddb4c9e9e50e590e1b46282829e0bb6f3deebfab004e30dcb4eec0e34c5ebb234d5060c06ecae5\n+  checksum: 10c0/059b122dda4138e5e7e461abd49350921e326735ca9a1d8aa19b1fdbae0937661b5f71af6fe82fd8f59e8db5549627849b38cc3f7ef2ec7ee9c93c3d6225174f\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/rafz@npm:10.0.0\"\n-  checksum: 10c0/8d92bc553172fa883ec2121b9cc62bfb43ff5d6c4e76363c8ce100fb6c3dd67c3dd629931786f9d1d63ac95a5d6996e4a08693cd56dda685bdbaf39b60e97f66\n+\"@react-spring/rafz@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/rafz@npm:10.0.1\"\n+  checksum: 10c0/cba76f143d3a06f79dd0c09f7aefd17df9cca9b2c1ef7f9103255e5351326f4a42a5a1366f731a78f74380d96ba683bcc2a49312ed1e4b9e9e249e72c9ff68cb\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/shared@npm:10.0.0\"\n+\"@react-spring/shared@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/shared@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/rafz\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/833c3f42d35d22ac47a2f756ac47d85a81bc1decc5e7915f46013823344374378f883135754de94d5b43d8fff3c55fc4a359044c9a44f9095bd1ef1f11a20d4d\n+  checksum: 10c0/f056aaa018b3744afd8244e8eea24534d32f92fad9ace815b80e159b296fb5db148e2c9bd840ad9a5188e7a3c0778fd564b8af9ae02cd500e019a228398fb3cf\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/types@npm:10.0.0\"\n-  checksum: 10c0/ce1b959eaa8964f4004481d1e7c6eca0a8d636eb9f35ca654bdf77a78a860c0ff9eaa6bdc0cab84fc8a16be5c5fbb22b114249a2721bfc16191666670c0f44b3\n+\"@react-spring/types@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/types@npm:10.0.1\"\n+  checksum: 10c0/260890f9c156dc69b77c846510017156d8c0a07cce70edc7c108e57b0cf4122b26a15e724b191481a51b2c914296de9e81d56618b2c339339d4b221930691baa\n   languageName: node\n   linkType: hard\n \n \"@react-spring/web@npm:^10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/web@npm:10.0.0\"\n+  version: 10.0.1\n+  resolution: \"@react-spring/web@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.0\"\n-    \"@react-spring/core\": \"npm:~10.0.0\"\n-    \"@react-spring/shared\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/animated\": \"npm:~10.0.1\"\n+    \"@react-spring/core\": \"npm:~10.0.1\"\n+    \"@react-spring/shared\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n     react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/2218c87d9bfafab78b3079d94ea89ab9b95cb174910be5682fd8f5fc73e326ca956e9b844e5b255d1e3402138ad26981fae2fc1091d682a78359044a63b6421e\n+  checksum: 10c0/a0c788c9fd881ccb834feb22fc0694e74e59f7b76e498f0096f5b65e2c9812513955bf45ee27d7c5348f56a7bba7c5a6961d4be663728bb2172fe5aa6b6bdfc4\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\n.github/workflows/test-ruby.yml\n@@ -143,7 +143,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick libpam-dev\n+          additional-system-dependencies: ffmpeg libpam-dev\n \n       - name: Load database schema\n         run: |\n@@ -173,8 +173,8 @@ jobs:\n         env:\n           CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}\n \n-  test-libvips:\n-    name: Libvips tests\n+  test-imagemagick:\n+    name: ImageMagick tests\n     runs-on: ubuntu-latest\n \n     needs:\n@@ -220,7 +220,7 @@ jobs:\n       CAS_ENABLED: true\n       BUNDLE_WITH: 'pam_authentication test'\n       GITHUB_RSPEC: ${{ matrix.ruby-version == '.ruby-version' && github.event.pull_request && 'true' }}\n-      MASTODON_USE_LIBVIPS: true\n+      MASTODON_USE_LIBVIPS: false\n \n     strategy:\n       fail-fast: false\n@@ -245,7 +245,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg libpam-dev\n+          additional-system-dependencies: ffmpeg imagemagick libpam-dev\n \n       - name: Load database schema\n         run: './bin/rails db:create db:schema:load db:seed'\n@@ -324,7 +324,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick\n+          additional-system-dependencies: ffmpeg\n \n       - name: Set up Javascript environment\n         uses: ./.github/actions/setup-javascript\n@@ -443,7 +443,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick\n+          additional-system-dependencies: ffmpeg\n \n       - name: Set up Javascript environment\n         uses: ./.github/actions/setup-javascript\n---\nconfig/application.rb\n@@ -95,7 +95,7 @@ class Application < Rails::Application\n       require 'mastodon/redis_configuration'\n       ::REDIS_CONFIGURATION = Mastodon::RedisConfiguration.new\n \n-      config.x.use_vips = ENV['MASTODON_USE_LIBVIPS'] == 'true'\n+      config.x.use_vips = ENV['MASTODON_USE_LIBVIPS'] != 'false'\n \n       if config.x.use_vips\n         require_relative '../lib/paperclip/vips_lazy_thumbnail'\n---\nconfig/initializers/deprecations.rb\n@@ -16,3 +16,9 @@\n \n   abort message\n end\n+\n+if ENV['MASTODON_USE_LIBVIPS'] == 'false'\n+  warn <<~MESSAGE\n+    WARNING: Mastodon support for ImageMagick is deprecated and will be removed in future versions. Please consider using libvips instead.\n+  MESSAGE\n+end\n---\n\n\n---\n\nChoice D:\nstreaming/database.js\n@@ -1,5 +1,5 @@\n import pg from 'pg';\n-import pgConnectionString from 'pg-connection-string';\n+import { parse } from 'pg-connection-string';\n \n import { parseIntFromEnvValue } from './utils.js';\n \n@@ -16,15 +16,19 @@ export function configFromEnv(env, environment) {\n       password: env.DB_PASS || pg.defaults.password,\n       database: env.DB_NAME || 'mastodon_development',\n       host: env.DB_HOST || pg.defaults.host,\n-      port: parseIntFromEnvValue(env.DB_PORT, pg.defaults.port ?? 5432, 'DB_PORT')\n+      port: parseIntFromEnvValue(\n+        env.DB_PORT,\n+        pg.defaults.port ?? 5432,\n+        'DB_PORT',\n+      ),\n     },\n \n     production: {\n       user: env.DB_USER || 'mastodon',\n       password: env.DB_PASS || '',\n       database: env.DB_NAME || 'mastodon_production',\n       host: env.DB_HOST || 'localhost',\n-      port: parseIntFromEnvValue(env.DB_PORT, 5432, 'DB_PORT')\n+      port: parseIntFromEnvValue(env.DB_PORT, 5432, 'DB_PORT'),\n     },\n   };\n \n@@ -34,7 +38,7 @@ export function configFromEnv(env, environment) {\n   let baseConfig = {};\n \n   if (env.DATABASE_URL) {\n-    const parsedUrl = pgConnectionString.parse(env.DATABASE_URL);\n+    const parsedUrl = parse(env.DATABASE_URL);\n \n     // The result of dbUrlToConfig from pg-connection-string is not type\n     // compatible with pg.PoolConfig, since parts of the connection URL may be\n@@ -46,25 +50,34 @@ export function configFromEnv(env, environment) {\n     // https://github.com/brianc/node-postgres/issues/2280\n     //\n     // FIXME: clean up once brianc/node-postgres#3128 lands\n-    if (typeof parsedUrl.password === 'string') baseConfig.password = parsedUrl.password;\n+    if (typeof parsedUrl.password === 'string')\n+      baseConfig.password = parsedUrl.password;\n     if (typeof parsedUrl.host === 'string') baseConfig.host = parsedUrl.host;\n     if (typeof parsedUrl.user === 'string') baseConfig.user = parsedUrl.user;\n     if (typeof parsedUrl.port === 'string' && parsedUrl.port) {\n       const parsedPort = parseInt(parsedUrl.port, 10);\n       if (isNaN(parsedPort)) {\n-        throw new Error('Invalid port specified in DATABASE_URL environment variable');\n+        throw new Error(\n+          'Invalid port specified in DATABASE_URL environment variable',\n+        );\n       }\n       baseConfig.port = parsedPort;\n     }\n-    if (typeof parsedUrl.database === 'string') baseConfig.database = parsedUrl.database;\n-    if (typeof parsedUrl.options === 'string') baseConfig.options = parsedUrl.options;\n+    if (typeof parsedUrl.database === 'string')\n+      baseConfig.database = parsedUrl.database;\n+    if (typeof parsedUrl.options === 'string')\n+      baseConfig.options = parsedUrl.options;\n \n     // The pg-connection-string type definition isn't correct, as parsedUrl.ssl\n     // can absolutely be an Object, this is to work around these incorrect\n     // types, including the casting of parsedUrl.ssl to Record<string, any>\n     if (typeof parsedUrl.ssl === 'boolean') {\n       baseConfig.ssl = parsedUrl.ssl;\n-    } else if (typeof parsedUrl.ssl === 'object' && !Array.isArray(parsedUrl.ssl) && parsedUrl.ssl !== null) {\n+    } else if (\n+      typeof parsedUrl.ssl === 'object' &&\n+      !Array.isArray(parsedUrl.ssl) &&\n+      parsedUrl.ssl !== null\n+    ) {\n       /** @type {Record<string, any>} */\n       const sslOptions = parsedUrl.ssl;\n       baseConfig.ssl = {};\n@@ -83,17 +96,17 @@ export function configFromEnv(env, environment) {\n     baseConfig = pgConfigs[environment];\n \n     if (env.DB_SSLMODE) {\n-      switch(env.DB_SSLMODE) {\n-      case 'disable':\n-      case '':\n-        baseConfig.ssl = false;\n-        break;\n-      case 'no-verify':\n-        baseConfig.ssl = { rejectUnauthorized: false };\n-        break;\n-      default:\n-        baseConfig.ssl = {};\n-        break;\n+      switch (env.DB_SSLMODE) {\n+        case 'disable':\n+        case '':\n+          baseConfig.ssl = false;\n+          break;\n+        case 'no-verify':\n+          baseConfig.ssl = { rejectUnauthorized: false };\n+          break;\n+        default:\n+          baseConfig.ssl = {};\n+          break;\n       }\n     }\n   } else {\n@@ -134,16 +147,23 @@ export function getPool(config, environment, logger) {\n       return async (queryTextOrConfig, values, ...rest) => {\n         const start = process.hrtime();\n \n-        const result = await originalQuery.apply(pool, [queryTextOrConfig, values, ...rest]);\n+        const result = await originalQuery.apply(pool, [\n+          queryTextOrConfig,\n+          values,\n+          ...rest,\n+        ]);\n \n         const duration = process.hrtime(start);\n         const durationInMs = (duration[0] * 1000000000 + duration[1]) / 1000000;\n \n-        logger.debug({\n-          query: queryTextOrConfig,\n-          values,\n-          duration: durationInMs\n-        }, 'Executed database query');\n+        logger.debug(\n+          {\n+            query: queryTextOrConfig,\n+            values,\n+            duration: durationInMs,\n+          },\n+          'Executed database query',\n+        );\n \n         return result;\n       };\n---\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.7.0\":\n-  version: 2.7.0\n-  resolution: \"pg-connection-string@npm:2.7.0\"\n-  checksum: 10c0/50a1496a1c858f9495d78a2c7a66d93ef3602e718aff2953bb5738f3ea616d7f727f32fc20513c9bed127650cd14c1ddc7b458396f4000e689d4b64c65c5c51e\n+  version: 2.8.0\n+  resolution: \"pg-connection-string@npm:2.8.0\"\n+  checksum: 10c0/5600e3992ddacaa1022e4260a7bb8f24cc187cec1fc5d1526a274a4edc8db8b446f2a9c7f552c6f71f2dc7b3b391ceedebfef93de26b4943b6a26dfaecdd5bbc\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nPresumably because `videoRef.current.duration` is unknown or zero before the video starts, but I opted for a more defensive `isNaN` than checking on `videoRef.current.duration` specifically.\n\n---\n\nChoice A:\napp/lib/activitypub/parser/status_parser.rb\n@@ -95,11 +95,11 @@ def language\n   end\n \n   def favourites_count\n-    @object.dig('likes', 'totalItems')\n+    @object.dig('likes', 'totalItems') if @object.is_a?(Hash)\n   end\n \n   def reblogs_count\n-    @object.dig('shares', 'totalItems')\n+    @object.dig('shares', 'totalItems') if @object.is_a?(Hash)\n   end\n \n   def quote_policy\n---\nspec/lib/activitypub/activity/create_spec.rb\n@@ -20,7 +20,7 @@\n       type: 'Create',\n       actor: ActivityPub::TagManager.instance.uri_for(sender),\n       object: object_json,\n-    }.with_indifferent_access\n+    }.deep_stringify_keys\n   end\n \n   before do\n@@ -102,7 +102,7 @@ def activity_for_object(json)\n         type: 'Create',\n         actor: ActivityPub::TagManager.instance.uri_for(sender),\n         object: json,\n-      }.with_indifferent_access\n+      }.deep_stringify_keys\n     end\n \n     before do\n@@ -1076,7 +1076,7 @@ def activity_for_object(json)\n           type: 'Create',\n           actor: ActivityPub::TagManager.instance.uri_for(sender),\n           object: Addressable::URI.new(scheme: 'bear', query_values: { t: token, u: object_json[:id] }).to_s,\n-        }.with_indifferent_access\n+        }.deep_stringify_keys\n       end\n \n       let(:object_json) do\n---\nspec/lib/activitypub/parser/status_parser_spec.rb\n@@ -16,7 +16,7 @@\n       type: 'Create',\n       actor: ActivityPub::TagManager.instance.uri_for(sender),\n       object: object_json,\n-    }.with_indifferent_access\n+    }.deep_stringify_keys\n   end\n \n   let(:object_json) do\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/video/index.tsx\n@@ -346,8 +346,10 @@ export const Video: React.FC<{\n     const updateProgress = () => {\n       nextFrame = requestAnimationFrame(() => {\n         if (videoRef.current) {\n+          const progress =\n+            videoRef.current.currentTime / videoRef.current.duration;\n           void api.start({\n-            progress: `${(videoRef.current.currentTime / videoRef.current.duration) * 100}%`,\n+            progress: isNaN(progress) ? '0%' : `${progress * 100}%`,\n             immediate: reduceMotion,\n             config: config.stiff,\n           });\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -201,7 +201,7 @@ group :development, :test do\n   gem 'faker', '~> 3.2'\n \n   # Generate factory objects\n-  gem 'fabrication', '~> 2.30'\n+  gem 'fabrication', '~> 3.0'\n \n   # Profiling tools\n   gem 'memory_profiler', require: false\n---\nGemfile.lock\n@@ -223,7 +223,7 @@ GEM\n       tzinfo\n     excon (1.2.5)\n       logger\n-    fabrication (2.31.0)\n+    fabrication (3.0.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n     faraday (2.13.1)\n@@ -972,7 +972,7 @@ DEPENDENCIES\n   doorkeeper (~> 5.6)\n   dotenv\n   email_spec\n-  fabrication (~> 2.30)\n+  fabrication (~> 3.0)\n   faker (~> 3.2)\n   faraday-httpclient\n   fast_blank (~> 1.0)\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -52,6 +52,7 @@ gem 'faraday-httpclient'\n gem 'fast_blank', '~> 1.0'\n gem 'fastimage'\n gem 'hiredis', '~> 0.6'\n+gem 'hiredis-client'\n gem 'htmlentities', '~> 4.3'\n gem 'http', '~> 5.2.0'\n gem 'http_accept_language', '~> 2.1'\n@@ -82,10 +83,10 @@ gem 'rqrcode', '~> 3.0'\n gem 'ruby-progressbar', '~> 1.13'\n gem 'sanitize', '~> 7.0'\n gem 'scenic', '~> 1.7'\n-gem 'sidekiq', '~> 6.5'\n+gem 'sidekiq', '< 8'\n gem 'sidekiq-bulk', '~> 0.2.0'\n gem 'sidekiq-scheduler', '~> 5.0'\n-gem 'sidekiq-unique-jobs', '~> 7.1'\n+gem 'sidekiq-unique-jobs', '> 8'\n gem 'simple_form', '~> 5.2'\n gem 'simple-navigation', '~> 4.4'\n gem 'stoplight', '~> 4.1'\n---\nGemfile.lock\n@@ -129,9 +129,6 @@ GEM\n     brakeman (7.0.2)\n       racc\n     browser (6.2.0)\n-    brpoplpush-redis_script (0.1.3)\n-      concurrent-ruby (~> 1.0, >= 1.0.5)\n-      redis (>= 1.0, < 6)\n     builder (3.3.0)\n     bundler-audit (0.9.2)\n       bundler (>= 1.2.0, < 3)\n@@ -294,6 +291,8 @@ GEM\n     highline (3.1.2)\n       reline\n     hiredis (0.6.3)\n+    hiredis-client (0.24.0)\n+      redis-client (= 0.24.0)\n     hkdf (0.3.0)\n     htmlentities (4.3.4)\n     http (5.2.0)\n@@ -696,6 +695,8 @@ GEM\n       psych (>= 4.0.0)\n     redcarpet (3.6.1)\n     redis (4.8.1)\n+    redis-client (0.24.0)\n+      connection_pool\n     redlock (1.3.2)\n       redis (>= 3.0.0, < 6.0)\n     regexp_parser (2.10.0)\n@@ -808,22 +809,22 @@ GEM\n       websocket (~> 1.0)\n     shoulda-matchers (6.5.0)\n       activesupport (>= 5.2.0)\n-    sidekiq (6.5.12)\n-      connection_pool (>= 2.2.5, < 3)\n-      rack (~> 2.0)\n-      redis (>= 4.5.0, < 5)\n+    sidekiq (7.3.9)\n+      base64\n+      connection_pool (>= 2.3.0)\n+      logger\n+      rack (>= 2.2.4)\n+      redis-client (>= 0.22.2)\n     sidekiq-bulk (0.2.0)\n       sidekiq\n     sidekiq-scheduler (5.0.6)\n       rufus-scheduler (~> 3.2)\n       sidekiq (>= 6, < 8)\n       tilt (>= 1.4.0, < 3)\n-    sidekiq-unique-jobs (7.1.33)\n-      brpoplpush-redis_script (> 0.1.1, <= 2.0.0)\n+    sidekiq-unique-jobs (8.0.10)\n       concurrent-ruby (~> 1.0, >= 1.0.5)\n-      redis (< 5.0)\n-      sidekiq (>= 5.0, < 7.0)\n-      thor (>= 0.20, < 3.0)\n+      sidekiq (>= 7.0.0, < 8.0.0)\n+      thor (>= 1.0, < 3.0)\n     simple-navigation (4.4.0)\n       activesupport (>= 2.3.2)\n     simple_form (5.3.1)\n@@ -976,6 +977,7 @@ DEPENDENCIES\n   haml_lint\n   hcaptcha (~> 7.1)\n   hiredis (~> 0.6)\n+  hiredis-client\n   htmlentities (~> 4.3)\n   http (~> 5.2.0)\n   http_accept_language (~> 2.1)\n@@ -1064,10 +1066,10 @@ DEPENDENCIES\n   scenic (~> 1.7)\n   selenium-webdriver\n   shoulda-matchers\n-  sidekiq (~> 6.5)\n+  sidekiq (< 8)\n   sidekiq-bulk (~> 0.2.0)\n   sidekiq-scheduler (~> 5.0)\n-  sidekiq-unique-jobs (~> 7.1)\n+  sidekiq-unique-jobs (> 8)\n   simple-navigation (~> 4.4)\n   simple_form (~> 5.2)\n   simplecov (~> 0.22)\n---\napp/lib/redis_connection.rb\n@@ -15,7 +15,7 @@ def pool\n \n     def pool_size\n       if Sidekiq.server?\n-        Sidekiq[:concurrency]\n+        Sidekiq.default_configuration[:concurrency]\n       else\n         ENV['MAX_THREADS'] || 5\n       end\n---\napp/workers/scheduler/self_destruct_scheduler.rb\n@@ -20,7 +20,7 @@ def perform\n   private\n \n   def sidekiq_overwhelmed?\n-    redis_mem_info = Sidekiq.redis_info\n+    redis_mem_info = Sidekiq.default_configuration.redis_info\n \n     Sidekiq::Stats.new.enqueued > MAX_ENQUEUED || redis_mem_info['used_memory'].to_f > redis_mem_info['total_system_memory'].to_f * MAX_REDIS_MEM_USAGE\n   end\n---\nconfig/database.yml\n@@ -1,6 +1,6 @@\n default: &default\n   adapter: postgresql\n-  pool: <%= ENV[\"DB_POOL\"] || (if Sidekiq.server? then Sidekiq[:concurrency] else ENV['MAX_THREADS'] end) || 5 %>\n+  pool: <%= ENV[\"DB_POOL\"] || (if Sidekiq.server? then Sidekiq.default_configuration[:concurrency] else ENV['MAX_THREADS'] end) || 5 %>\n   timeout: 5000\n   connect_timeout: 15\n   encoding: unicode\n---\nconfig/initializers/sidekiq.rb\n@@ -89,6 +89,8 @@\n     end\n   end\n \n+  config.logger.level = Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+\n   SidekiqUniqueJobs::Server.configure(config)\n end\n \n@@ -98,9 +100,9 @@\n   config.client_middleware do |chain|\n     chain.add SidekiqUniqueJobs::Middleware::Client\n   end\n-end\n \n-Sidekiq.logger.level = ::Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+  config.logger.level = Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+end\n \n SidekiqUniqueJobs.configure do |config|\n   config.enabled         = !Rails.env.test?\n---\nlib/mastodon/redis_configuration.rb\n@@ -9,7 +9,6 @@ class Mastodon::RedisConfiguration\n \n   def base\n     @base ||= setup_config(prefix: nil, defaults: DEFAULTS)\n-              .merge(namespace: nil)\n   end\n \n   def sidekiq\n@@ -23,7 +22,7 @@ def cache\n                  expires_in: 10.minutes,\n                  connect_timeout: 5,\n                  pool: {\n-                   size: Sidekiq.server? ? Sidekiq[:concurrency] : Integer(ENV['MAX_THREADS'] || 5),\n+                   size: Sidekiq.server? ? Sidekiq.default_configuration[:concurrency] : Integer(ENV['MAX_THREADS'] || 5),\n                    timeout: 5,\n                  },\n                })\n---\nspec/lib/mastodon/redis_configuration_spec.rb\n@@ -156,7 +156,6 @@\n         expect(subject).to eq({\n           url: 'redis://localhost:6379/0',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n@@ -172,7 +171,6 @@\n         expect(subject).to eq({\n           url: 'redis::/user@example.com/2',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n@@ -188,7 +186,6 @@\n         expect(subject).to eq({\n           url: 'redis://:testpass@redis.example.com:3333/3',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n---\nspec/rails_helper.rb\n@@ -53,7 +53,7 @@\n   allow_localhost: true,\n   allow: Chewy.settings[:host]\n )\n-Sidekiq.logger = nil\n+Sidekiq.default_configuration.logger = nil\n \n DatabaseCleaner.strategy = [:deletion]\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThe design is a bit rough, but it can be improved later.\r\n\r\nRules have always used a `priority` to order them, but that has never been exposed to admins. This PR simply re-sets the rules' `priority` to enforce the requested order.\r\n\r\n![image](https://github.com/user-attachments/assets/096820ad-4c56-448f-a5fd-9f602abd3988)\n\n---\n\nChoice A:\napp/controllers/admin/rules_controller.rb\n@@ -50,6 +50,22 @@ def destroy\n       redirect_to admin_rules_path\n     end\n \n+    def move_up\n+      authorize @rule, :update?\n+\n+      @rule.move!(-1)\n+\n+      redirect_to admin_rules_path\n+    end\n+\n+    def move_down\n+      authorize @rule, :update?\n+\n+      @rule.move!(+1)\n+\n+      redirect_to admin_rules_path\n+    end\n+\n     private\n \n     def set_rule\n---\napp/javascript/material-icons/400-24px/arrow_downward-fill.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-800v487L216-537l-56 57 320 320 320-320-56-57-224 224v-487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/arrow_downward.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-800v487L216-537l-56 57 320 320 320-320-56-57-224 224v-487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/arrow_upward-fill.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-160v-487L216-423l-56-57 320-320 320 320-56 57-224-224v487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/arrow_upward.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-160v-487L216-423l-56-57 320-320 320 320-56 57-224-224v487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/styles/mastodon/admin.scss\n@@ -1127,6 +1127,15 @@ a.name-tag,\n   }\n }\n \n+.rule-actions {\n+  display: flex;\n+  flex-direction: column;\n+\n+  a.table-action-link {\n+    padding-inline-start: 0;\n+  }\n+}\n+\n .dashboard__counters.admin-account-counters {\n   margin-top: 10px;\n }\n---\napp/models/rule.rb\n@@ -22,4 +22,18 @@ class Rule < ApplicationRecord\n   validates :text, presence: true, length: { maximum: TEXT_SIZE_LIMIT }\n \n   scope :ordered, -> { kept.order(priority: :asc, id: :asc) }\n+\n+  def move!(offset)\n+    rules = Rule.ordered.to_a\n+    position = rules.index(self)\n+\n+    rules.delete_at(position)\n+    rules.insert(position + offset, self)\n+\n+    transaction do\n+      rules.each.with_index do |rule, index|\n+        rule.update!(priority: index)\n+      end\n+    end\n+  end\n end\n---\napp/views/admin/rules/_rule.html.haml\n@@ -7,5 +7,7 @@\n     .announcements-list__item__meta\n       = rule.hint\n \n-    %div\n+    .rule-actions\n+      = table_link_to 'arrow_upward', t('admin.rules.move_up'), move_up_admin_rule_path(rule), method: :post if can?(:update, rule) && !rule_iteration.first?\n       = table_link_to 'delete', t('admin.rules.delete'), admin_rule_path(rule), method: :delete, data: { confirm: t('admin.accounts.are_you_sure') } if can?(:destroy, rule)\n+      = table_link_to 'arrow_downward', t('admin.rules.move_down'), move_down_admin_rule_path(rule), method: :post if can?(:update, rule) && !rule_iteration.last?\n---\nconfig/locales/en.yml\n@@ -790,6 +790,8 @@ en:\n       description_html: While most claim to have read and agree to the terms of service, usually people do not read through until after a problem arises. <strong>Make it easier to see your server's rules at a glance by providing them in a flat bullet point list.</strong> Try to keep individual rules short and simple, but try not to split them up into many separate items either.\n       edit: Edit rule\n       empty: No server rules have been defined yet.\n+      move_down: Move down\n+      move_up: Move up\n       title: Server rules\n     settings:\n       about:\n---\nconfig/routes/admin.rb\n@@ -93,7 +93,12 @@\n     end\n   end\n \n-  resources :rules, only: [:index, :new, :create, :edit, :update, :destroy]\n+  resources :rules, only: [:index, :new, :create, :edit, :update, :destroy] do\n+    member do\n+      post :move_up\n+      post :move_down\n+    end\n+  end\n \n   resources :webhooks do\n     member do\n---\nspec/models/rule_spec.rb\n@@ -16,4 +16,24 @@\n       end\n     end\n   end\n+\n+  describe '#move!' do\n+    let!(:first_rule) { Fabricate(:rule, text: 'foo') }\n+    let!(:second_rule) { Fabricate(:rule, text: 'bar') }\n+    let!(:third_rule) { Fabricate(:rule, text: 'baz') }\n+\n+    it 'moves the rules as expected' do\n+      expect { first_rule.move!(+1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(foo bar baz)).to(%w(bar foo baz))\n+\n+      expect { first_rule.move!(-1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(bar foo baz)).to(%w(foo bar baz))\n+\n+      expect { third_rule.move!(-1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(foo bar baz)).to(%w(foo baz bar))\n+\n+      expect { second_rule.move!(-1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(foo baz bar)).to(%w(foo bar baz))\n+    end\n+  end\n end\n---\nspec/system/admin/rules_spec.rb\n@@ -48,6 +48,29 @@ def submit_form\n       end\n     end\n \n+    describe 'Moving down an existing rule' do\n+      let!(:first_rule) { Fabricate(:rule, text: 'This is another rule') }\n+      let!(:second_rule) { Fabricate(:rule, text: 'This is a rule') }\n+\n+      it 'moves the rule down' do\n+        visit admin_rules_path\n+\n+        expect(page)\n+          .to have_content(I18n.t('admin.rules.title'))\n+\n+        expect(Rule.ordered.pluck(:text)).to eq ['This is another rule', 'This is a rule']\n+\n+        click_on(I18n.t('admin.rules.move_down'))\n+\n+        expect(page)\n+          .to have_content(I18n.t('admin.rules.title'))\n+          .and have_content(first_rule.text)\n+          .and have_content(second_rule.text)\n+\n+        expect(Rule.ordered.pluck(:text)).to eq ['This is a rule', 'This is another rule']\n+      end\n+    end\n+\n     describe 'Editing an existing rule' do\n       let!(:rule) { Fabricate :rule, text: 'Rule text' }\n \n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -200,7 +200,7 @@ GEM\n     doorkeeper (5.8.2)\n       railties (>= 5)\n     dotenv (3.1.8)\n-    drb (2.2.1)\n+    drb (2.2.3)\n     dry-cli (1.2.0)\n     elasticsearch (7.17.11)\n       elasticsearch-api (= 7.17.11)\n@@ -602,8 +602,8 @@ GEM\n     pastel (0.8.0)\n       tty-color (~> 0.5)\n     pg (1.5.9)\n-    pghero (3.6.2)\n-      activerecord (>= 6.1)\n+    pghero (3.7.0)\n+      activerecord (>= 7.1)\n     pp (0.6.2)\n       prettyprint\n     premailer (1.27.0)\n---\n\n\n---\n\nChoice C:\nconfig/initializers/chewy.rb\n@@ -5,8 +5,7 @@\n port            = ENV.fetch('ES_PORT') { 9200 }\n user            = ENV.fetch('ES_USER', nil).presence\n password        = ENV.fetch('ES_PASS', nil).presence\n-fallback_prefix = ENV.fetch('REDIS_NAMESPACE', nil).presence\n-prefix          = ENV.fetch('ES_PREFIX') { fallback_prefix }\n+prefix          = ENV.fetch('ES_PREFIX', nil)\n ca_file         = ENV.fetch('ES_CA_FILE', nil).presence\n \n transport_options = { ssl: { ca_file: ca_file } } if ca_file.present?\n---\nlib/mastodon/redis_configuration.rb\n@@ -9,18 +9,17 @@ class Mastodon::RedisConfiguration\n \n   def base\n     @base ||= setup_config(prefix: nil, defaults: DEFAULTS)\n-              .merge(namespace: base_namespace)\n+              .merge(namespace: nil)\n   end\n \n   def sidekiq\n     @sidekiq ||= setup_config(prefix: 'SIDEKIQ_')\n-                 .merge(namespace: sidekiq_namespace)\n   end\n \n   def cache\n     @cache ||= setup_config(prefix: 'CACHE_')\n                .merge({\n-                 namespace: cache_namespace,\n+                 namespace: 'cache',\n                  expires_in: 10.minutes,\n                  connect_timeout: 5,\n                  pool: {\n@@ -36,24 +35,6 @@ def driver\n     ENV['REDIS_DRIVER'] == 'ruby' ? :ruby : :hiredis\n   end\n \n-  def namespace\n-    @namespace ||= ENV.fetch('REDIS_NAMESPACE', nil)\n-  end\n-\n-  def base_namespace\n-    return \"mastodon_test#{ENV.fetch('TEST_ENV_NUMBER', nil)}\" if Rails.env.test?\n-\n-    namespace\n-  end\n-\n-  def sidekiq_namespace\n-    namespace\n-  end\n-\n-  def cache_namespace\n-    namespace ? \"#{namespace}_cache\" : 'cache'\n-  end\n-\n   def setup_config(prefix: nil, defaults: {})\n     prefix = \"#{prefix}REDIS_\"\n \n@@ -62,7 +43,7 @@ def setup_config(prefix: nil, defaults: {})\n     password = ENV.fetch(\"#{prefix}PASSWORD\", nil)\n     host     = ENV.fetch(\"#{prefix}HOST\", defaults[:host])\n     port     = ENV.fetch(\"#{prefix}PORT\", defaults[:port])\n-    db       = ENV.fetch(\"#{prefix}DB\", defaults[:db])\n+    db       = Rails.env.test? ? ENV.fetch('TEST_ENV_NUMBER', defaults[:db]).to_i + 1 : ENV.fetch(\"#{prefix}DB\", defaults[:db])\n \n     return { url:, driver: } if url\n \n---\nspec/lib/mastodon/redis_configuration_spec.rb\n@@ -26,20 +26,6 @@\n     end\n   end\n \n-  shared_examples 'setting a namespace' do\n-    context 'when setting the `REDIS_NAMESPACE` variable' do\n-      around do |example|\n-        ClimateControl.modify REDIS_NAMESPACE: 'testns' do\n-          example.run\n-        end\n-      end\n-\n-      it 'uses the value for the namespace' do\n-        expect(subject[:namespace]).to eq 'testns'\n-      end\n-    end\n-  end\n-\n   shared_examples 'secondary configuration' do |prefix|\n     context \"when no `#{prefix}_REDIS_` environment variables are present\" do\n       it 'uses the url from the base config' do\n@@ -208,7 +194,6 @@\n     end\n \n     it_behaves_like 'setting a different driver'\n-    it_behaves_like 'setting a namespace'\n     it_behaves_like 'sentinel support'\n   end\n \n@@ -217,7 +202,6 @@\n \n     it_behaves_like 'secondary configuration', 'SIDEKIQ'\n     it_behaves_like 'setting a different driver'\n-    it_behaves_like 'setting a namespace'\n     it_behaves_like 'sentinel support', 'SIDEKIQ'\n   end\n \n@@ -238,22 +222,8 @@\n       })\n     end\n \n-    context 'when `REDIS_NAMESPACE` is not set' do\n-      it 'uses the `cache` namespace' do\n-        expect(subject[:namespace]).to eq 'cache'\n-      end\n-    end\n-\n-    context 'when setting the `REDIS_NAMESPACE` variable' do\n-      around do |example|\n-        ClimateControl.modify REDIS_NAMESPACE: 'testns' do\n-          example.run\n-        end\n-      end\n-\n-      it 'attaches the `_cache` postfix to the namespace' do\n-        expect(subject[:namespace]).to eq 'testns_cache'\n-      end\n+    it 'uses the `cache` namespace' do\n+      expect(subject[:namespace]).to eq 'cache'\n     end\n \n     it_behaves_like 'secondary configuration', 'CACHE'\n---\nspec/support/streaming_server_manager.rb\n@@ -17,7 +17,7 @@ def start(port: 4020)\n     @running_thread = Thread.new do\n       Open3.popen2e(\n         {\n-          'REDIS_NAMESPACE' => REDIS_CONFIGURATION.base[:namespace],\n+          'REDIS_DB' => (ENV.fetch('TEST_ENV_NUMBER', 0).to_i + 1).to_s,\n           'DB_NAME' => \"#{ENV.fetch('DB_NAME', 'mastodon')}_test#{ENV.fetch('TEST_ENV_NUMBER', '')}\",\n           'RAILS_ENV' => ENV.fetch('RAILS_ENV', 'test'),\n           'NODE_ENV' => ENV.fetch('STREAMING_NODE_ENV', 'development'),\n---\nstreaming/redis.js\n@@ -4,7 +4,6 @@ import { parseIntFromEnvValue } from './utils.js';\n \n /**\n  * @typedef RedisConfiguration\n- * @property {string|undefined} namespace\n  * @property {string|undefined} url\n  * @property {import('ioredis').RedisOptions} options\n  */\n@@ -64,8 +63,6 @@ function getSentinelConfiguration(env, commonOptions) {\n  * @returns {RedisConfiguration} configuration for the Redis connection\n  */\n export function configFromEnv(env) {\n-  const redisNamespace = env.REDIS_NAMESPACE;\n-\n   // These options apply for both REDIS_URL based connections and connections\n   // using the other REDIS_* environment variables:\n   const commonOptions = {\n@@ -82,16 +79,14 @@ export function configFromEnv(env) {\n   if (typeof env.REDIS_URL === 'string' && env.REDIS_URL.length > 0) {\n     return {\n       url: env.REDIS_URL,\n-      options: commonOptions,\n-      namespace: redisNamespace\n+      options: commonOptions\n     };\n   }\n \n   // If we have configuration for Redis Sentinel mode, prefer that:\n   if (hasSentinelConfiguration(env)) {\n     return {\n-      options: getSentinelConfiguration(env, commonOptions),\n-      namespace: redisNamespace\n+      options: getSentinelConfiguration(env, commonOptions)\n     };\n   }\n \n@@ -110,8 +105,7 @@ export function configFromEnv(env) {\n   };\n \n   return {\n-    options,\n-    namespace: redisNamespace\n+    options\n   };\n }\n \n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.222.4', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1093.0)\n+    aws-sdk-core (3.222.3)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.222.4)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nSort of follow-up on https://github.com/mastodon/mastodon/pull/32357\r\n\r\nThis `logger` class method was added in rails 8 as a lightweight wrapper around the \"auto wrap a logger as a tagged logger\" idea - https://github.com/rails/rails/pull/52994 - end result should be the same here, and preserves dev mode logging along lines of https://github.com/mastodon/mastodon/pull/33057\r\n\r\nIf you set a logger at all, you also need to set a formatter, hence preserving that item here (the passed in args are sent along to the wrapped constructor, and set there).\r\n\r\nHave similar change for production env, but I have some sort of native gem issue currently preventing testing that locally. Will do as followup assuming no issues on this one.\n\n---\n\nChoice A:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.7.0\":\n-  version: 2.7.0\n-  resolution: \"pg-connection-string@npm:2.7.0\"\n-  checksum: 10c0/50a1496a1c858f9495d78a2c7a66d93ef3602e718aff2953bb5738f3ea616d7f727f32fc20513c9bed127650cd14c1ddc7b458396f4000e689d4b64c65c5c51e\n+  version: 2.8.1\n+  resolution: \"pg-connection-string@npm:2.8.1\"\n+  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -912,6 +912,8 @@ export const AccountHeader: React.FC<{\n             <div className='account__header__badges'>{badges}</div>\n           )}\n \n+          {signedIn && <FamiliarFollowers accountId={accountId} />}\n+\n           {!(suspended || hidden) && (\n             <div className='account__header__extra'>\n               <div\n@@ -1023,7 +1025,6 @@ export const AccountHeader: React.FC<{\n                   />\n                 </NavLink>\n               </div>\n-              {signedIn && <FamiliarFollowers accountId={accountId} />}\n             </div>\n           )}\n         </div>\n---\napp/javascript/mastodon/features/account_timeline/components/familiar_followers.tsx\n@@ -12,12 +12,16 @@ import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n \n const AccountLink: React.FC<{ account?: Account }> = ({ account }) => {\n-  // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n-  const name = account?.display_name || `@${account?.acct}`;\n+  if (!account) {\n+    return null;\n+  }\n+\n   return (\n-    <Link to={`/@${account?.acct}`} data-hover-card-account={account?.id}>\n-      {name}\n-    </Link>\n+    <Link\n+      to={`/@${account.acct}`}\n+      data-hover-card-account={account.id}\n+      dangerouslySetInnerHTML={{ __html: account.display_name_html }}\n+    />\n   );\n };\n \n@@ -50,7 +54,7 @@ const FamiliarFollowersReadout: React.FC<{ familiarFollowers: Account[] }> = ({\n     return (\n       <FormattedMessage\n         id='account.familiar_followers_many'\n-        defaultMessage='Followed by {name1}, {name2}, and {othersCount, plural, one {# other} other {# others}}'\n+        defaultMessage='Followed by {name1}, {name2}, and {othersCount, plural, one {one other you know} other {# others you know}}'\n         values={messageData}\n       />\n     );\n@@ -80,7 +84,7 @@ export const FamiliarFollowers: React.FC<{ accountId: string }> = ({\n   return (\n     <div className='account__header__familiar-followers'>\n       <AvatarGroup compact>\n-        {familiarFollowers.map((account) => (\n+        {familiarFollowers.slice(0, 3).map((account) => (\n           <Avatar withLink key={account.id} account={account} size={28} />\n         ))}\n       </AvatarGroup>\n---\napp/javascript/mastodon/locales/en.json\n@@ -28,7 +28,7 @@\n   \"account.edit_profile\": \"Edit profile\",\n   \"account.enable_notifications\": \"Notify me when @{name} posts\",\n   \"account.endorse\": \"Feature on profile\",\n-  \"account.familiar_followers_many\": \"Followed by {name1}, {name2}, and {othersCount, plural, one {# other} other {# others}}\",\n+  \"account.familiar_followers_many\": \"Followed by {name1}, {name2}, and {othersCount, plural, one {one other you know} other {# others you know}}\",\n   \"account.familiar_followers_one\": \"Followed by {name1}\",\n   \"account.familiar_followers_two\": \"Followed by {name1} and {name2}\",\n   \"account.featured\": \"Featured\",\n---\napp/javascript/styles/mastodon/components.scss\n@@ -2091,6 +2091,7 @@ body > [data-popper-placement] {\n   display: block;\n   position: relative;\n   border-radius: var(--avatar-border-radius);\n+  background: var(--surface-background-color);\n \n   img {\n     width: 100%;\n@@ -8151,16 +8152,13 @@ noscript {\n     display: flex;\n     align-items: center;\n     gap: 10px;\n-    margin-block-end: 16px;\n+    margin-block: 16px;\n     color: $darker-text-color;\n \n     a:any-link {\n-      color: inherit;\n-      text-decoration: underline;\n-    }\n-\n-    a:hover {\n+      font-weight: 500;\n       text-decoration: none;\n+      color: $primary-text-color;\n     }\n   }\n }\n---\n\n\n---\n\nChoice C:\nconfig/environments/development.rb\n@@ -37,10 +37,8 @@\n \n   config.action_controller.forgery_protection_origin_check = ENV['DISABLE_FORGERY_REQUEST_PROTECTION'].nil?\n \n-  ActiveSupport::Logger.new($stdout).tap do |logger|\n-    logger.formatter = config.log_formatter\n-    config.logger = ActiveSupport::TaggedLogging.new(logger)\n-  end\n+  # Override default file logging in favor of STDOUT logging in dev environment\n+  config.logger = ActiveSupport::TaggedLogging.logger($stdout, formatter: config.log_formatter)\n \n   # Generate random VAPID keys\n   Webpush.generate_key.tap do |vapid_key|\n---\n\n\n---\n\nChoice D:\n.rubocop_todo.yml\n@@ -35,7 +35,6 @@ Rails/OutputSafety:\n # Configuration parameters: AllowedVars.\n Style/FetchEnvVar:\n   Exclude:\n-    - 'config/environments/production.rb'\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/3_omniauth.rb'\n     - 'config/initializers/cache_buster.rb'\n---\nconfig/environments/production.rb\n@@ -113,7 +113,7 @@\n   enable_starttls = nil\n   enable_starttls_auto = nil\n \n-  case ENV['SMTP_ENABLE_STARTTLS']\n+  case ENV.fetch('SMTP_ENABLE_STARTTLS', nil)\n   when 'always'\n     enable_starttls = true\n   when 'never'\n@@ -125,14 +125,14 @@\n   end\n \n   config.action_mailer.smtp_settings = {\n-    port: ENV['SMTP_PORT'],\n-    address: ENV['SMTP_SERVER'],\n+    port: ENV.fetch('SMTP_PORT', nil),\n+    address: ENV.fetch('SMTP_SERVER', nil),\n     user_name: ENV['SMTP_LOGIN'].presence,\n     password: ENV['SMTP_PASSWORD'].presence,\n-    domain: ENV['SMTP_DOMAIN'] || ENV['LOCAL_DOMAIN'],\n+    domain: ENV['SMTP_DOMAIN'] || ENV.fetch('LOCAL_DOMAIN', nil),\n     authentication: ENV['SMTP_AUTH_METHOD'] == 'none' ? nil : ENV['SMTP_AUTH_METHOD'] || :plain,\n     ca_file: ENV['SMTP_CA_FILE'].presence || '/etc/ssl/certs/ca-certificates.crt',\n-    openssl_verify_mode: ENV['SMTP_OPENSSL_VERIFY_MODE'],\n+    openssl_verify_mode: ENV.fetch('SMTP_OPENSSL_VERIFY_MODE', nil),\n     enable_starttls: enable_starttls,\n     enable_starttls_auto: enable_starttls_auto,\n     tls: ENV['SMTP_TLS'].presence && ENV['SMTP_TLS'] == 'true',\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThe \"default\" value path was added in the vite PR. Add coverage for that path, small wording tweak on examples.\n\n---\n\nChoice A:\n.github/renovate.json5\n@@ -39,7 +39,6 @@\n       // Require Dependency Dashboard Approval for major version bumps of these Ruby packages\n       matchManagers: ['bundler'],\n       matchPackageNames: [\n-        'rack', // Needs to be synced with Rails version\n         'strong_migrations', // Requires manual upgrade\n         'sidekiq', // Requires manual upgrade\n         'sidekiq-unique-jobs', // Requires manual upgrades and sync with Sidekiq version\n---\nGemfile\n@@ -5,7 +5,6 @@ ruby '>= 3.2.0', '< 3.5.0'\n \n gem 'propshaft'\n gem 'puma', '~> 6.3'\n-gem 'rack', '~> 2.2.7'\n gem 'rails', '~> 8.0'\n gem 'thor', '~> 1.2'\n \n---\nGemfile.lock\n@@ -633,7 +633,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.16)\n+    rack (3.1.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -645,18 +645,19 @@ GEM\n       faraday-follow_redirects\n       json-jwt (>= 1.11.0)\n       rack (>= 2.1.0)\n-    rack-protection (3.2.0)\n+    rack-protection (4.1.1)\n       base64 (>= 0.1.0)\n-      rack (~> 2.2, >= 2.2.4)\n+      logger (>= 1.6.0)\n+      rack (>= 3.0.0, < 4)\n     rack-proxy (0.7.7)\n       rack\n-    rack-session (1.0.2)\n-      rack (< 3)\n+    rack-session (2.1.1)\n+      base64 (>= 0.1.0)\n+      rack (>= 3.0.0)\n     rack-test (2.2.0)\n       rack (>= 1.3)\n-    rackup (1.0.1)\n-      rack (< 3)\n-      webrick\n+    rackup (2.2.1)\n+      rack (>= 3)\n     rails (8.0.2)\n       actioncable (= 8.0.2)\n       actionmailbox (= 8.0.2)\n@@ -1044,7 +1045,6 @@ DEPENDENCIES\n   public_suffix (~> 6.0)\n   puma (~> 6.3)\n   pundit (~> 2.3)\n-  rack (~> 2.2.7)\n   rack-attack (~> 6.6)\n   rack-cors (~> 2.0)\n   rack-test (~> 2.1)\n---\nconfig/initializers/mime_types.rb\n@@ -2,6 +2,3 @@\n \n Mime::Type.register 'application/json', :json, %w(text/x-json application/jsonrequest application/jrd+json application/activity+json application/ld+json)\n Mime::Type.register 'text/xml',         :xml,  %w(application/xml application/atom+xml application/xrd+xml)\n-\n-# WebP is not defined in Rack 2.2.\n-Rack::Mime::MIME_TYPES['.webp'] = 'image/webp'\n---\n\n\n---\n\nChoice B:\nspec/helpers/theme_helper_spec.rb\n@@ -6,10 +6,10 @@\n   describe 'theme_style_tags' do\n     let(:result) { helper.theme_style_tags(theme) }\n \n-    context 'when using system theme' do\n+    context 'when using \"system\" theme' do\n       let(:theme) { 'system' }\n \n-      it 'returns the mastodon-light and default stylesheets with correct color schemes' do\n+      it 'returns the mastodon-light and application stylesheets with correct color schemes' do\n         expect(html_links.first.attributes.symbolize_keys)\n           .to include(\n             href: have_attributes(value: match(/mastodon-light/)),\n@@ -23,6 +23,17 @@\n       end\n     end\n \n+    context 'when using \"default\" theme' do\n+      let(:theme) { 'default' }\n+\n+      it 'returns the application stylesheet' do\n+        expect(html_links.last.attributes.symbolize_keys)\n+          .to include(\n+            href: have_attributes(value: match(/application/))\n+          )\n+      end\n+    end\n+\n     context 'when using other theme' do\n       let(:theme) { 'contrast' }\n \n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n---\n\n\n---\n\nChoice D:\napp/lib/http_signature_draft.rb\n@@ -6,14 +6,13 @@\n class HttpSignatureDraft\n   REQUEST_TARGET = '(request-target)'\n \n-  def initialize(keypair, key_id, full_path: true)\n+  def initialize(keypair, key_id)\n     @keypair = keypair\n     @key_id = key_id\n-    @full_path = full_path\n   end\n \n   def request_target(verb, url)\n-    if url.query.nil? || !@full_path\n+    if url.query.nil?\n       \"#{verb} #{url.path}\"\n     else\n       \"#{verb} #{url.path}?#{url.query}\"\n---\napp/lib/request.rb\n@@ -75,7 +75,6 @@ def initialize(verb, url, **options)\n     @url         = Addressable::URI.parse(url).normalize\n     @http_client = options.delete(:http_client)\n     @allow_local = options.delete(:allow_local)\n-    @full_path   = !options.delete(:omit_query_string)\n     @options     = {\n       follow: {\n         max_hops: 3,\n@@ -102,7 +101,7 @@ def on_behalf_of(actor, sign_with: nil)\n \n     key_id = ActivityPub::TagManager.instance.key_uri_for(actor)\n     keypair = sign_with.present? ? OpenSSL::PKey::RSA.new(sign_with) : actor.keypair\n-    @signing = HttpSignatureDraft.new(keypair, key_id, full_path: @full_path)\n+    @signing = HttpSignatureDraft.new(keypair, key_id)\n \n     self\n   end\n---\napp/services/activitypub/fetch_replies_service.rb\n@@ -57,20 +57,7 @@ def fetch_collection(collection_or_uri)\n     return unless @allow_synchronous_requests\n     return if non_matching_uri_hosts?(@reference_uri, collection_or_uri)\n \n-    # NOTE: For backward compatibility reasons, Mastodon signs outgoing\n-    # queries incorrectly by default.\n-    #\n-    # While this is relevant for all URLs with query strings, this is\n-    # the only code path where this happens in practice.\n-    #\n-    # Therefore, retry with correct signatures if this fails.\n-    begin\n-      fetch_resource_without_id_validation(collection_or_uri, nil, raise_on_error: :temporary)\n-    rescue Mastodon::UnexpectedResponseError => e\n-      raise unless e.response && e.response.code == 401 && Addressable::URI.parse(collection_or_uri).query.present?\n-\n-      fetch_resource_without_id_validation(collection_or_uri, nil, raise_on_error: :temporary, request_options: { omit_query_string: false })\n-    end\n+    fetch_resource_without_id_validation(collection_or_uri, nil, raise_on_error: :temporary)\n   end\n \n   def filter_replies(items)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rack-cors](https://redirect.github.com/cyu/rack-cors) ([changelog](https://redirect.github.com/cyu/rack-cors/blob/master/CHANGELOG.md)) | `'~> 2.0'` -> `'~> 3.0'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rack-cors/3.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rack-cors/3.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rack-cors/2.0.2/3.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rack-cors/2.0.2/3.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>cyu/rack-cors (rack-cors)</summary>\n\n### [`v3.0.0`](https://redirect.github.com/cyu/rack-cors/blob/HEAD/CHANGELOG.md#300---2025-05-16)\n\n[Compare Source](https://redirect.github.com/cyu/rack-cors/compare/v2.0.2...v3.0.0)\n\n##### Changed\n\n-   Update Rack dependency to >= 3.0.14\n-   Remove support for Ruby 2.3\n-   Add logger as explicit dependency\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS4xOCIsInVwZGF0ZWRJblZlciI6IjQwLjExLjE4IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -94,7 +94,7 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1080.0)\n+    aws-partitions (1.1087.0)\n     aws-sdk-core (3.215.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n@@ -120,7 +120,7 @@ GEM\n       rack (>= 0.9.0)\n       rouge (>= 1.0.0)\n     bigdecimal (3.1.9)\n-    bindata (2.5.0)\n+    bindata (2.5.1)\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n@@ -227,7 +227,7 @@ GEM\n     fabrication (2.31.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n-    faraday (2.12.2)\n+    faraday (2.13.0)\n       faraday-net_http (>= 2.0, < 3.5)\n       json\n       logger\n@@ -239,7 +239,7 @@ GEM\n       net-http (>= 0.5.0)\n     fast_blank (1.0.1)\n     fastimage (2.4.0)\n-    ffi (1.17.1)\n+    ffi (1.17.2)\n     ffi-compiler (1.3.2)\n       ffi (>= 1.15.5)\n       rake\n@@ -426,7 +426,7 @@ GEM\n     mime-types (3.6.2)\n       logger\n       mime-types-data (~> 3.2015)\n-    mime-types-data (3.2025.0402)\n+    mime-types-data (3.2025.0408)\n     mini_mime (1.1.5)\n     mini_portile2 (2.8.8)\n     minitest (5.25.5)\n@@ -585,8 +585,8 @@ GEM\n     ostruct (0.6.1)\n     ox (2.14.22)\n       bigdecimal (>= 3.0)\n-    parallel (1.26.3)\n-    parser (3.3.7.4)\n+    parallel (1.27.0)\n+    parser (3.3.8.0)\n       ast (~> 2.4.1)\n       racc\n     parslet (2.0.0)\n@@ -751,7 +751,7 @@ GEM\n       rubocop-ast (>= 1.44.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.0)\n+    rubocop-ast (1.44.1)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n@@ -1085,4 +1085,4 @@ RUBY VERSION\n    ruby 3.4.1p0\n \n BUNDLED WITH\n-   2.6.7\n+   2.6.8\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/api.ts\n@@ -83,6 +83,7 @@ export default function api(withAuthorization = true) {\n   return instance;\n }\n \n+type ApiUrl = `v${1 | 2}/${string}`;\n type RequestParamsOrData = Record<string, unknown>;\n \n export async function apiRequest<ApiResponse = unknown>(\n@@ -105,28 +106,28 @@ export async function apiRequest<ApiResponse = unknown>(\n }\n \n export async function apiRequestGet<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   params?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('GET', url, { params });\n }\n \n export async function apiRequestPost<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   data?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('POST', url, { data });\n }\n \n export async function apiRequestPut<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   data?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('PUT', url, { data });\n }\n \n export async function apiRequestDelete<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   params?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('DELETE', url, { params });\n---\napp/javascript/mastodon/api/accounts.ts\n@@ -36,6 +36,6 @@ export const apiGetEndorsedAccounts = (id: string) =>\n   apiRequestGet<ApiAccountJSON>(`v1/accounts/${id}/endorsements`);\n \n export const apiGetFamiliarFollowers = (id: string) =>\n-  apiRequestGet<ApiFamiliarFollowersJSON>('/v1/accounts/familiar_followers', {\n+  apiRequestGet<ApiFamiliarFollowersJSON>('v1/accounts/familiar_followers', {\n     id,\n   });\n---\napp/javascript/mastodon/api/polls.ts\n@@ -2,9 +2,9 @@ import { apiRequestGet, apiRequestPost } from 'mastodon/api';\n import type { ApiPollJSON } from 'mastodon/api_types/polls';\n \n export const apiGetPoll = (pollId: string) =>\n-  apiRequestGet<ApiPollJSON>(`/v1/polls/${pollId}`);\n+  apiRequestGet<ApiPollJSON>(`v1/polls/${pollId}`);\n \n export const apiPollVote = (pollId: string, choices: string[]) =>\n-  apiRequestPost<ApiPollJSON>(`/v1/polls/${pollId}/votes`, {\n+  apiRequestPost<ApiPollJSON>(`v1/polls/${pollId}/votes`, {\n     choices,\n   });\n---\n\n\n---\n\nChoice C:\n.rubocop_todo.yml\n@@ -39,15 +39,6 @@ Style/FetchEnvVar:\n     - 'config/initializers/paperclip.rb'\n     - 'lib/tasks/repo.rake'\n \n-# This cop supports safe autocorrection (--autocorrect).\n-# Configuration parameters: EnforcedStyle, MaxUnannotatedPlaceholdersAllowed, Mode, AllowedMethods, AllowedPatterns.\n-# SupportedStyles: annotated, template, unannotated\n-# AllowedMethods: redirect\n-Style/FormatStringToken:\n-  Exclude:\n-    - 'config/initializers/devise.rb'\n-    - 'lib/paperclip/color_extractor.rb'\n-\n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: MinBodyLength, AllowConsecutiveConditionals.\n Style/GuardClause:\n---\nconfig/initializers/devise.rb\n@@ -394,7 +394,7 @@ def session_cookie\n     config.ldap_uid            = ENV.fetch('LDAP_UID', 'cn')\n     config.ldap_mail           = ENV.fetch('LDAP_MAIL', 'mail')\n     config.ldap_tls_no_verify  = ENV['LDAP_TLS_NO_VERIFY'] == 'true'\n-    config.ldap_search_filter  = ENV.fetch('LDAP_SEARCH_FILTER', '(|(%{uid}=%{email})(%{mail}=%{email}))')\n+    config.ldap_search_filter  = ENV.fetch('LDAP_SEARCH_FILTER', '(|(%<uid>s=%<email>s)(%<mail>s=%<email>s))')\n     config.ldap_uid_conversion_enabled  = ENV['LDAP_UID_CONVERSION_ENABLED'] == 'true'\n     config.ldap_uid_conversion_search   = ENV.fetch('LDAP_UID_CONVERSION_SEARCH', '.,- ')\n     config.ldap_uid_conversion_replace  = ENV.fetch('LDAP_UID_CONVERSION_REPLACE', '_')\n---\nlib/paperclip/color_extractor.rb\n@@ -239,7 +239,7 @@ def palette_from_im_histogram(result, quantity)\n     end\n \n     def rgb_to_hex(rgb)\n-      format('#%02x%02x%02x', rgb.r, rgb.g, rgb.b)\n+      format('#%02x%02x%02x', rgb.r, rgb.g, rgb.b) # rubocop:disable Style/FormatStringToken\n     end\n   end\n end\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -74,7 +74,7 @@ gem 'premailer-rails'\n gem 'public_suffix', '~> 6.0'\n gem 'pundit', '~> 2.3'\n gem 'rack-attack', '~> 6.6'\n-gem 'rack-cors', '~> 2.0', require: 'rack/cors'\n+gem 'rack-cors', '~> 3.0', require: 'rack/cors'\n gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [sass](https://redirect.github.com/sass/dart-sass) | [`1.88.0` -> `1.89.0`](https://renovatebot.com/diffs/npm/sass/1.88.0/1.89.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/sass/1.89.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/sass/1.89.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/sass/1.88.0/1.89.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/sass/1.88.0/1.89.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>sass/dart-sass (sass)</summary>\n\n### [`v1.89.0`](https://redirect.github.com/sass/dart-sass/blob/HEAD/CHANGELOG.md#1890)\n\n[Compare Source](https://redirect.github.com/sass/dart-sass/compare/1.88.0...1.89.0)\n\n-   Allow the Node package importer to load files even when there are multiple\n    potential resolutions, as long as those resolutions all point to the same\n    file.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS4xOCIsInVwZGF0ZWRJblZlciI6IjQwLjExLjE4IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -10785,8 +10785,8 @@ __metadata:\n   linkType: hard\n \n \"sass@npm:^1.62.1\":\n-  version: 1.88.0\n-  resolution: \"sass@npm:1.88.0\"\n+  version: 1.89.0\n+  resolution: \"sass@npm:1.89.0\"\n   dependencies:\n     \"@parcel/watcher\": \"npm:^2.4.1\"\n     chokidar: \"npm:^4.0.0\"\n@@ -10797,7 +10797,7 @@ __metadata:\n       optional: true\n   bin:\n     sass: sass.js\n-  checksum: 10c0/dcb16dc29116bfa5a90485d24fd8020d2b0d95155bd2e31285901588729343b59fefe44365c5f146b2ba5a9ebadef90b23a7220b902507bdbd91ca2ba0a0b688\n+  checksum: 10c0/8e31b48c5e0abd9d437edb201919a82863f605ace1c1536ccdc6b3133937a70fe29b92ad536af632ecae2f140733931e4ec971e1bfbf8b835c54d392b28331df\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\npackage.json\n@@ -107,7 +107,7 @@\n     \"react-overlays\": \"^5.2.1\",\n     \"react-redux\": \"^9.0.4\",\n     \"react-redux-loading-bar\": \"^5.0.8\",\n-    \"react-router\": \"^5.3.4\",\n+    \"react-router\": \"^7.0.0\",\n     \"react-router-dom\": \"^5.3.4\",\n     \"react-router-scroll-4\": \"^1.0.0-beta.1\",\n     \"react-select\": \"^5.7.3\",\n---\nyarn.lock\n@@ -2936,7 +2936,7 @@ __metadata:\n     react-overlays: \"npm:^5.2.1\"\n     react-redux: \"npm:^9.0.4\"\n     react-redux-loading-bar: \"npm:^5.0.8\"\n-    react-router: \"npm:^5.3.4\"\n+    react-router: \"npm:^7.0.0\"\n     react-router-dom: \"npm:^5.3.4\"\n     react-router-scroll-4: \"npm:^1.0.0-beta.1\"\n     react-select: \"npm:^5.7.3\"\n@@ -6662,6 +6662,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"cookie@npm:^1.0.1\":\n+  version: 1.0.2\n+  resolution: \"cookie@npm:1.0.2\"\n+  checksum: 10c0/fd25fe79e8fbcfcaf6aa61cd081c55d144eeeba755206c058682257cb38c4bd6795c6620de3f064c740695bb65b7949ebb1db7a95e4636efb8357a335ad3f54b\n+  languageName: node\n+  linkType: hard\n+\n \"copy-descriptor@npm:^0.1.0\":\n   version: 0.1.1\n   resolution: \"copy-descriptor@npm:0.1.1\"\n@@ -14929,7 +14936,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-router@npm:5.3.4, react-router@npm:^5.3.4\":\n+\"react-router@npm:5.3.4\":\n   version: 5.3.4\n   resolution: \"react-router@npm:5.3.4\"\n   dependencies:\n@@ -14948,6 +14955,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"react-router@npm:^7.0.0\":\n+  version: 7.5.2\n+  resolution: \"react-router@npm:7.5.2\"\n+  dependencies:\n+    cookie: \"npm:^1.0.1\"\n+    set-cookie-parser: \"npm:^2.6.0\"\n+    turbo-stream: \"npm:2.4.0\"\n+  peerDependencies:\n+    react: \">=18\"\n+    react-dom: \">=18\"\n+  peerDependenciesMeta:\n+    react-dom:\n+      optional: true\n+  checksum: 10c0/5972ecb783e0ac0512c500b84bd4ff475665ba49c67b69e13b79dc24c7ee0496d523858058bb43c70147367688e0cc0d6d6d0f51cabfdebfbc5556d559bff457\n+  languageName: node\n+  linkType: hard\n+\n \"react-select@npm:^5.7.3\":\n   version: 5.10.1\n   resolution: \"react-select@npm:5.10.1\"\n@@ -15944,6 +15968,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"set-cookie-parser@npm:^2.6.0\":\n+  version: 2.7.1\n+  resolution: \"set-cookie-parser@npm:2.7.1\"\n+  checksum: 10c0/060c198c4c92547ac15988256f445eae523f57f2ceefeccf52d30d75dedf6bff22b9c26f756bd44e8e560d44ff4ab2130b178bd2e52ef5571bf7be3bd7632d9a\n+  languageName: node\n+  linkType: hard\n+\n \"set-function-length@npm:^1.2.2\":\n   version: 1.2.2\n   resolution: \"set-function-length@npm:1.2.2\"\n@@ -17530,6 +17561,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"turbo-stream@npm:2.4.0\":\n+  version: 2.4.0\n+  resolution: \"turbo-stream@npm:2.4.0\"\n+  checksum: 10c0/e68b2569f1f16e6e9633d090c6024b2ae9f0e97bfeacb572451ca3732e120ebbb546f3bc4afc717c46cb57b5aea6104e04ef497f9912eef6a7641e809518e98a\n+  languageName: node\n+  linkType: hard\n+\n \"twemoji-parser@npm:^11.0.2\":\n   version: 11.0.2\n   resolution: \"twemoji-parser@npm:11.0.2\"\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.223.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1096.0)\n+    aws-sdk-core (3.223.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.223.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/account_timeline/hooks/familiar_followers.ts\n@@ -1,6 +1,7 @@\n import { useEffect } from 'react';\n \n import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n+import { useIdentity } from '@/mastodon/identity_context';\n import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n import { me } from 'mastodon/initial_state';\n@@ -14,14 +15,15 @@ export const useFetchFamiliarFollowers = ({\n   const familiarFollowers = useAppSelector((state) =>\n     accountId ? getAccountFamiliarFollowers(state, accountId) : null,\n   );\n+  const { signedIn } = useIdentity();\n \n   const hasNoData = familiarFollowers === null;\n \n   useEffect(() => {\n-    if (hasNoData && accountId && accountId !== me) {\n+    if (hasNoData && signedIn && accountId && accountId !== me) {\n       void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n     }\n-  }, [dispatch, accountId, hasNoData]);\n+  }, [dispatch, accountId, hasNoData, signedIn]);\n \n   return {\n     familiarFollowers: hasNoData ? [] : familiarFollowers,\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [pino](https://getpino.io) ([source](https://redirect.github.com/pinojs/pino)) | [`9.6.0` -> `9.7.0`](https://renovatebot.com/diffs/npm/pino/9.6.0/9.7.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/pino/9.7.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/pino/9.7.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/pino/9.6.0/9.7.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/pino/9.6.0/9.7.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>pinojs/pino (pino)</summary>\n\n### [`v9.7.0`](https://redirect.github.com/pinojs/pino/compare/v9.6.0...6705c624a5e5108431668902b0ec75bedfbe3ed2)\n\n[Compare Source](https://redirect.github.com/pinojs/pino/compare/v9.6.0...v9.7.0)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS4xOCIsInVwZGF0ZWRJblZlciI6IjQwLjExLjE4IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.2)\n-    rubocop (1.75.2)\n+    rubocop (1.75.3)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n@@ -773,7 +773,7 @@ GEM\n       rack (>= 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n       rubocop-ast (>= 1.38.0, < 2.0)\n-    rubocop-rspec (3.5.0)\n+    rubocop-rspec (3.6.0)\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n     rubocop-rspec_rails (2.31.0)\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -9187,23 +9187,23 @@ __metadata:\n   linkType: hard\n \n \"pino@npm:^9.0.0\":\n-  version: 9.6.0\n-  resolution: \"pino@npm:9.6.0\"\n+  version: 9.7.0\n+  resolution: \"pino@npm:9.7.0\"\n   dependencies:\n     atomic-sleep: \"npm:^1.0.0\"\n     fast-redact: \"npm:^3.1.1\"\n     on-exit-leak-free: \"npm:^2.1.0\"\n     pino-abstract-transport: \"npm:^2.0.0\"\n     pino-std-serializers: \"npm:^7.0.0\"\n-    process-warning: \"npm:^4.0.0\"\n+    process-warning: \"npm:^5.0.0\"\n     quick-format-unescaped: \"npm:^4.0.3\"\n     real-require: \"npm:^0.2.0\"\n     safe-stable-stringify: \"npm:^2.3.1\"\n     sonic-boom: \"npm:^4.0.1\"\n     thread-stream: \"npm:^3.0.0\"\n   bin:\n     pino: bin.js\n-  checksum: 10c0/bcd1e9d9b301bea13b95689ca9ad7105ae9451928fb6c0b67b3e58c5fe37cea1d40665f3d6641e3da00be0bbc17b89031e67abbc8ea6aac6164f399309fd78e7\n+  checksum: 10c0/c7f8a83a9a9d728b4eff6d0f4b9367f031c91bcaa5806fbf0eedcc8e77faba593d59baf11a8fba0dd1c778bb17ca7ed01418ac1df4ec129faeedd4f3ecaff66f\n   languageName: node\n   linkType: hard\n \n@@ -9759,6 +9759,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"process-warning@npm:^5.0.0\":\n+  version: 5.0.0\n+  resolution: \"process-warning@npm:5.0.0\"\n+  checksum: 10c0/941f48863d368ec161e0b5890ba0c6af94170078f3d6b5e915c19b36fb59edb0dc2f8e834d25e0d375a8bf368a49d490f080508842168832b93489d17843ec29\n+  languageName: node\n+  linkType: hard\n+\n \"prom-client@npm:^15.0.0\":\n   version: 15.1.3\n   resolution: \"prom-client@npm:15.1.3\"\n---\n\n\n---\n\nChoice C:\napp/views/layouts/application.html.haml\n@@ -28,7 +28,7 @@\n     = theme_style_tags current_theme\n     = vite_client_tag\n     = vite_react_refresh_tag\n-    = vite_polyfill_tag crossorigin: 'anonymous'\n+    = vite_polyfills_tag\n     -# Needed for the wicg-inert polyfill. It needs to be on it's own <style> tag, with this `id`\n     = vite_stylesheet_tag 'styles/entrypoints/inert.scss', media: 'all', id: 'inert-style'\n     = vite_typescript_tag 'common.ts', crossorigin: 'anonymous'\n---\napp/views/layouts/embedded.html.haml\n@@ -13,7 +13,7 @@\n \n     = vite_client_tag\n     = vite_react_refresh_tag\n-    = vite_polyfill_tag crossorigin: 'anonymous'\n+    = vite_polyfills_tag\n     = theme_style_tags 'mastodon-light'\n     = vite_preload_file_tag \"mastodon/locales/#{I18n.locale}.json\"\n     = render_initial_state\n---\napp/views/layouts/error.html.haml\n@@ -7,7 +7,7 @@\n     %meta{ content: 'width=device-width,initial-scale=1', name: 'viewport' }/\n     = vite_client_tag\n     = vite_react_refresh_tag\n-    = vite_polyfill_tag crossorigin: 'anonymous'\n+    = vite_polyfills_tag\n     = theme_style_tags Setting.default_settings['theme']\n     = vite_typescript_tag 'error.ts', crossorigin: 'anonymous'\n   %body.error\n---\nlib/vite_ruby/sri_extensions.rb\n@@ -120,10 +120,12 @@ def vite_preload_file_tag(name,\n     # Ignore this error, it is not critical if the file is not preloaded\n   end\n \n-  def vite_polyfill_tag(**)\n-    entry = vite_manifest.path_and_integrity_for('polyfill', type: :virtual)\n+  def vite_polyfills_tag(crossorigin: 'anonymous', **)\n+    return if ViteRuby.instance.dev_server_running?\n \n-    javascript_include_tag(type: 'module', src: entry[:path], integrity: entry[:integrity], **)\n+    entry = vite_manifest.path_and_integrity_for('polyfills', type: :virtual)\n+\n+    javascript_include_tag(entry[:path], type: 'module', integrity: entry[:integrity], crossorigin: crossorigin, **)\n   end\n end\n \n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.4)\n+    rubocop (1.75.5)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\n### Changes proposed in this PR:\r\n- Allow long link names in the admin sidebar to wrap onto a new line. Prevent cut-off link labels to avoid having to increase the sidebar width as proposed in #34714 \r\n- The icons are aligned a tiny bit more nicely with their text (as a side-effect of using flex alignment for the item layout)\r\n\r\n### Screenshots\r\n\r\n| **BEFORE** | **AFTER** |\r\n|--------|--------|\r\n| ![image](https://github.com/user-attachments/assets/91f01c16-08a0-4e9a-be3a-0ce7158988d0) | ![image](https://github.com/user-attachments/assets/1f33a7cf-288f-4bb6-9911-3acda668c24b) |\n\n---\n\nChoice A:\napp/javascript/styles/mastodon/components.scss\n@@ -7068,18 +7068,19 @@ a.status-card {\n }\n \n .audio-player {\n-  overflow: hidden;\n   box-sizing: border-box;\n+  container: audio-player / inline-size;\n   position: relative;\n-  background: var(--player-background-color, var(--background-color));\n+  overflow: hidden;\n+  display: flex;\n+  flex-direction: column;\n+  width: 100%;\n+  aspect-ratio: 16 / 9;\n   color: var(--player-foreground-color);\n+  background: var(--player-background-color, var(--background-color));\n   border-radius: 8px;\n-  padding-bottom: 44px;\n-  width: 100%;\n   outline: 1px solid var(--media-outline-color);\n   outline-offset: -1px;\n-  aspect-ratio: 16 / 9;\n-  container: audio-player / inline-size;\n \n   &__controls {\n     display: grid;\n@@ -7128,9 +7129,17 @@ a.status-card {\n   }\n \n   &__visualizer {\n+    width: 100%;\n     max-width: 200px;\n   }\n \n+  .video-player__seek {\n+    position: absolute;\n+    inset: 0 0 auto;\n+    height: 24px;\n+    z-index: 1; /* Ensure this renders on top of audio player controls */\n+  }\n+\n   &.inactive {\n     .video-player__seek,\n     .audio-player__controls,\n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.224.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1103.0)\n+    aws-sdk-core (3.224.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.224.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice C:\napp/javascript/styles/mastodon/admin.scss\n@@ -114,15 +114,14 @@ $content-width: 840px;\n \n       a {\n         font-size: 14px;\n-        display: block;\n+        display: flex;\n+        align-items: center;\n+        gap: 6px;\n         padding: 15px;\n         color: $darker-text-color;\n         text-decoration: none;\n         transition: all 200ms linear;\n         transition-property: color, background-color;\n-        white-space: nowrap;\n-        overflow: hidden;\n-        text-overflow: ellipsis;\n \n         &:hover {\n           color: $primary-text-color;\n---\n\n\n---\n\nChoice D:\napp/services/fetch_link_card_service.rb\n@@ -19,7 +19,7 @@ def call(status)\n     @status       = status\n     @original_url = parse_urls\n \n-    return if @original_url.nil? || @status.with_preview_card?\n+    return if @original_url.nil? || @status.with_preview_card? || @status.with_media? || @status.quote.present?\n \n     @url = @original_url.to_s\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34723\n\n---\n\nChoice A:\napp/javascript/mastodon/components/hover_card_account.tsx\n@@ -45,6 +45,19 @@ export const HoverCardAccount = forwardRef<\n \n   const { familiarFollowers } = useFetchFamiliarFollowers({ accountId });\n \n+  const relationship = useAppSelector((state) =>\n+    accountId ? state.relationships.get(accountId) : undefined,\n+  );\n+  const isMutual = relationship?.followed_by && relationship.following;\n+  const isFollower = relationship?.followed_by;\n+  const hasRelationshipLoaded = !!relationship;\n+\n+  const shouldDisplayFamiliarFollowers =\n+    familiarFollowers.length > 0 &&\n+    hasRelationshipLoaded &&\n+    !isMutual &&\n+    !isFollower;\n+\n   return (\n     <div\n       ref={ref}\n@@ -85,7 +98,7 @@ export const HoverCardAccount = forwardRef<\n               value={account.followers_count}\n               renderer={FollowersCounter}\n             />\n-            {familiarFollowers.length > 0 && (\n+            {shouldDisplayFamiliarFollowers && (\n               <>\n                 &middot;\n                 <div className='hover-card__familiar-followers'>\n@@ -101,6 +114,22 @@ export const HoverCardAccount = forwardRef<\n                 </div>\n               </>\n             )}\n+            {(isMutual || isFollower) && (\n+              <>\n+                &middot;\n+                {isMutual ? (\n+                  <FormattedMessage\n+                    id='account.mutual'\n+                    defaultMessage='You follow each other'\n+                  />\n+                ) : (\n+                  <FormattedMessage\n+                    id='account.follows_you'\n+                    defaultMessage='Follows you'\n+                  />\n+                )}\n+              </>\n+            )}\n           </div>\n \n           <FollowButton accountId={accountId} />\n---\napp/javascript/styles/mastodon/components.scss\n@@ -10766,7 +10766,7 @@ noscript {\n     display: flex;\n     align-items: center;\n     flex-wrap: wrap;\n-    gap: 10px;\n+    gap: 2px 10px;\n   }\n \n   &__numbers {\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.2)\n-    rubocop (1.75.2)\n+    rubocop (1.75.3)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n@@ -773,7 +773,7 @@ GEM\n       rack (>= 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n       rubocop-ast (>= 1.38.0, < 2.0)\n-    rubocop-rspec (3.5.0)\n+    rubocop-rspec (3.6.0)\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n     rubocop-rspec_rails (2.31.0)\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -742,7 +742,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.6)\n+    rubocop (1.75.7)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\nChoice D:\napp/models/media_attachment.rb\n@@ -122,6 +122,7 @@ class MediaAttachment < ApplicationRecord\n         output: {\n           'loglevel' => 'fatal',\n           'map_metadata' => '-1',\n+          'movflags' => 'faststart', # Move metadata to start of file so playback can begin before download finishes\n           'c:v' => 'copy',\n           'c:a' => 'copy',\n         }.freeze,\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [@vitejs/plugin-react](https://redirect.github.com/vitejs/vite-plugin-react/tree/main/packages/plugin-react#readme) ([source](https://redirect.github.com/vitejs/vite-plugin-react/tree/HEAD/packages/plugin-react)) | [`4.2.1` -> `4.4.1`](https://renovatebot.com/diffs/npm/@vitejs%2fplugin-react/4.2.1/4.4.1) | [![age](https://developer.mend.io/api/mc/badges/age/npm/@vitejs%2fplugin-react/4.4.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/@vitejs%2fplugin-react/4.4.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/@vitejs%2fplugin-react/4.2.1/4.4.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/@vitejs%2fplugin-react/4.2.1/4.4.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>vitejs/vite-plugin-react (@&#8203;vitejs/plugin-react)</summary>\n\n### [`v4.4.1`](https://redirect.github.com/vitejs/vite-plugin-react/blob/HEAD/packages/plugin-react/CHANGELOG.md#441-2025-04-19)\n\n[Compare Source](https://redirect.github.com/vitejs/vite-plugin-react/compare/8beda4f36fe4ca8c0f795619988deb0849054f8c...57cc39869c319b842dac348b62c882a7bb963f7b)\n\nFix type issue when using `moduleResolution: \"node\"` in tsconfig [#&#8203;462](https://redirect.github.com/vitejs/vite-plugin-react/pull/4620)\n\n### [`v4.4.0`](https://redirect.github.com/vitejs/vite-plugin-react/blob/HEAD/packages/plugin-react/CHANGELOG.md#440-2025-04-15)\n\n[Compare Source](https://redirect.github.com/vitejs/vite-plugin-react/compare/v4.3.4...8beda4f36fe4ca8c0f795619988deb0849054f8c)\n\n##### Make compatible with rolldown-vite\n\nThis plugin is now compatible with rolldown-powered version of Vite.\nNote that currently the `__source` property value position might be incorrect. This will be fixed in the near future.\n\n### [`v4.3.4`](https://redirect.github.com/vitejs/vite-plugin-react/blob/HEAD/packages/plugin-react/CHANGELOG.md#434-2024-11-26)\n\n[Compare Source](https://redirect.github.com/vitejs/vite-plugin-react/compare/v4.3.3...v4.3.4)\n\n##### Add Vite 6 to peerDependencies range\n\nVite 6 is highly backward compatible, not much to add!\n\n##### Force Babel to output spec compliant import attributes [#&#8203;386](https://redirect.github.com/vitejs/vite-plugin-react/pull/386)\n\nThe default was an old spec (`with type: \"json\"`). We now enforce spec compliant (`with { type: \"json\" }`)\n\n### [`v4.3.3`](https://redirect.github.com/vitejs/vite-plugin-react/blob/HEAD/packages/plugin-react/CHANGELOG.md#433-2024-10-19)\n\n[Compare Source](https://redirect.github.com/vitejs/vite-plugin-react/compare/v4.3.2...v4.3.3)\n\n##### React Compiler runtimeModule option removed\n\nReact Compiler was updated to accept a `target` option and `runtimeModule` was removed. vite-plugin-react will still detect `runtimeModule` for backwards compatibility.\n\nWhen using a custom `runtimeModule` or `target !== '19'`, the plugin will not try to pre-optimize `react/compiler-runtime` dependency.\n\nThe [react-compiler-runtime](https://www.npmjs.com/package/react-compiler-runtime) is now available on npm can be used instead of the local shim for people using the compiler with React < 19.\n\nHere is the configuration to use the compiler with React 18 and correct source maps in development:\n\n```bash\nnpm install babel-plugin-react-compiler react-compiler-runtime @&#8203;babel/plugin-transform-react-jsx-development\n```\n\n```ts\nexport default defineConfig(({ command }) => {\n  const babelPlugins = [['babel-plugin-react-compiler', { target: '18' }]]\n  if (command === 'serve') {\n    babelPlugins.push(['@&#8203;babel/plugin-transform-react-jsx-development', {}])\n  }\n\n  return {\n    plugins: [react({ babel: { plugins: babelPlugins } })],\n  }\n})\n```\n\n### [`v4.3.2`](https://redirect.github.com/vitejs/vite-plugin-react/blob/HEAD/packages/plugin-react/CHANGELOG.md#432-2024-09-29)\n\n[Compare Source](https://redirect.github.com/vitejs/vite-plugin-react/compare/v4.3.1...v4.3.2)\n\nIgnore directive sourcemap error [#&#8203;369](https://redirect.github.com/vitejs/vite-plugin-react/issues/369)\n\n### [`v4.3.1`](https://redirect.github.com/vitejs/vite-plugin-react/blob/HEAD/packages/plugin-react/CHANGELOG.md#431-2024-06-10)\n\n[Compare Source](https://redirect.github.com/vitejs/vite-plugin-react/compare/v4.3.0...v4.3.1)\n\n##### Fix support for React Compiler with React 18\n\nThe previous version made this assumption that the compiler was only usable with React 19, but it's possible to use it with React 18 and a custom `runtimeModule`: https://gist.github.com/poteto/37c076bf112a07ba39d0e5f0645fec43\n\nWhen using a custom `runtimeModule`, the plugin will not try to pre-optimize `react/compiler-runtime` dependency.\n\nReminder: Vite expect code outside of `node_modules` to be ESM, so you will need to update the gist with `import React from 'react'`.\n\n### [`v4.3.0`](https://redirect.github.com/vitejs/vite-plugin-react/blob/HEAD/packages/plugin-react/CHANGELOG.md#430-2024-05-22)\n\n[Compare Source](https://redirect.github.com/vitejs/vite-plugin-react/compare/v4.2.1...v4.3.0)\n\n##### Fix support for React compiler\n\nDon't set `retainLines: true` when the React compiler is used. This creates whitespace issues and the compiler is modifying the JSX too much to get correct line numbers after that. If you want to use the React compiler and get back correct line numbers for tools like [vite-plugin-react-click-to-component](https://redirect.github.com/ArnaudBarre/vite-plugin-react-click-to-component) to work, you should update your config to something like:\n\n```ts\nexport default defineConfig(({ command }) => {\n  const babelPlugins = [['babel-plugin-react-compiler', {}]]\n  if (command === 'serve') {\n    babelPlugins.push(['@&#8203;babel/plugin-transform-react-jsx-development', {}])\n  }\n\n  return {\n    plugins: [react({ babel: { plugins: babelPlugins } })],\n  }\n})\n```\n\n##### Support HMR for class components\n\nThis is a long overdue and should fix some issues people had with HMR when migrating from CRA.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS4xOCIsInVwZGF0ZWRJblZlciI6IjQwLjExLjE4IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -66,7 +66,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n+\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n   version: 7.26.10\n   resolution: \"@babel/core@npm:7.26.10\"\n   dependencies:\n@@ -211,10 +211,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.24.0, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5\":\n-  version: 7.26.5\n-  resolution: \"@babel/helper-plugin-utils@npm:7.26.5\"\n-  checksum: 10c0/cdaba71d4b891aa6a8dfbe5bac2f94effb13e5fa4c2c487667fdbaa04eae059b78b28d85a885071f45f7205aeb56d16759e1bed9c118b94b16e4720ef1ab0f65\n+\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5, @babel/helper-plugin-utils@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helper-plugin-utils@npm:7.27.1\"\n+  checksum: 10c0/94cf22c81a0c11a09b197b41ab488d416ff62254ce13c57e62912c85700dc2e99e555225787a4099ff6bae7a1812d622c80fbaeda824b79baa10a6c5ac4cf69b\n   languageName: node\n   linkType: hard\n \n@@ -869,25 +869,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-self@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-self@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea362ff94b535c753f560eb1f5e063dc72bbbca17ed58837a949a7b289d5eacc7b0a28296d1932c94429b168d6040cdee5484a59b9e3c021f169e0ee137e6a27\n+  checksum: 10c0/00a4f917b70a608f9aca2fb39aabe04a60aa33165a7e0105fd44b3a8531630eb85bf5572e9f242f51e6ad2fa38c2e7e780902176c863556c58b5ba6f6e164031\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-source@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-source@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea8e3263c0dc51fbc97c156cc647150a757cc56de10781287353d0ce9b2dcd6b6d93d573c0142d7daf5d6fb554c74fa1971ae60764924ea711161d8458739b63\n+  checksum: 10c0/5e67b56c39c4d03e59e03ba80692b24c5a921472079b63af711b1d250fc37c1733a17069b63537f750f3e937ec44a42b1ee6a46cd23b1a0df5163b17f741f7f2\n   languageName: node\n   linkType: hard\n \n@@ -4135,17 +4135,17 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.2.1\n-  resolution: \"@vitejs/plugin-react@npm:4.2.1\"\n+  version: 4.4.1\n+  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n   dependencies:\n-    \"@babel/core\": \"npm:^7.23.5\"\n-    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.23.3\"\n-    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.23.3\"\n+    \"@babel/core\": \"npm:^7.26.10\"\n+    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n+    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n-    react-refresh: \"npm:^0.14.0\"\n+    react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n-    vite: ^4.2.0 || ^5.0.0\n-  checksum: 10c0/de1eec44d703f32e5b58e776328ca20793657fe991835d15b290230b19a2a08be5d31501d424279ae13ecfed28044c117b69d746891c8d9b92c69e8a8907e989\n+    vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n+  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n   languageName: node\n   linkType: hard\n \n@@ -10069,10 +10069,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-refresh@npm:^0.14.0\":\n-  version: 0.14.0\n-  resolution: \"react-refresh@npm:0.14.0\"\n-  checksum: 10c0/b8ae07ad153357d77830928a7f1fc2df837aabefee907fa273ba04c7643f3b860e986f1d4b7ada9b721c8d79b8c24b5b911a314a1a2398b105f1b13d19ea2b8d\n+\"react-refresh@npm:^0.17.0\":\n+  version: 0.17.0\n+  resolution: \"react-refresh@npm:0.17.0\"\n+  checksum: 10c0/002cba940384c9930008c0bce26cac97a9d5682bc623112c2268ba0c155127d9c178a9a5cc2212d560088d60dfd503edd808669a25f9b377f316a32361d0b23c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -124,7 +124,7 @@ GEM\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n-    bootsnap (1.18.4)\n+    bootsnap (1.18.5)\n       msgpack (~> 1.2)\n     brakeman (7.0.2)\n       racc\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/admin/ReportReasonSelector.jsx\n@@ -105,7 +105,7 @@ class ReportReasonSelector extends PureComponent {\n   };\n \n   componentDidMount() {\n-    api(false).get('/api/v1/instance').then(res => {\n+    api(false).get('/api/v2/instance').then(res => {\n       this.setState({\n         rules: res.data.rules,\n       });\n---\n\n\n---\n\nChoice D:\napp/models/user.rb\n@@ -112,7 +112,7 @@ class User < ApplicationRecord\n   validates_with RegistrationFormTimeValidator, on: :create\n   validates :website, absence: true, on: :create\n   validates :confirm_password, absence: true, on: :create\n-  validates :date_of_birth, presence: true, date_of_birth: true, on: :create, if: -> { Setting.min_age.present? }\n+  validates :date_of_birth, presence: true, date_of_birth: true, on: :create, if: -> { Setting.min_age.present? && !bypass_registration_checks? }\n   validate :validate_role_elevation\n \n   scope :account_not_suspended, -> { joins(:account).merge(Account.without_suspended) }\n@@ -144,7 +144,7 @@ class User < ApplicationRecord\n   delegate :can?, to: :role\n \n   attr_reader :invite_code, :date_of_birth\n-  attr_writer :external, :bypass_invite_request_check, :current_account\n+  attr_writer :external, :bypass_registration_checks, :current_account\n \n   def self.those_who_can(*any_of_privileges)\n     matching_role_ids = UserRole.that_can(*any_of_privileges).map(&:id)\n@@ -501,8 +501,8 @@ def external?\n     !!@external\n   end\n \n-  def bypass_invite_request_check?\n-    @bypass_invite_request_check\n+  def bypass_registration_checks?\n+    @bypass_registration_checks\n   end\n \n   def sanitize_role\n@@ -549,7 +549,7 @@ def validate_role_elevation\n   end\n \n   def invite_text_required?\n-    Setting.require_invite_text && !open_registrations? && !invited? && !external? && !bypass_invite_request_check?\n+    Setting.require_invite_text && !open_registrations? && !invited? && !external? && !bypass_registration_checks?\n   end\n \n   def trigger_webhooks\n---\nlib/mastodon/cli/accounts.rb\n@@ -79,7 +79,14 @@ def create(username)\n \n       account  = Account.new(username: username)\n       password = SecureRandom.hex\n-      user     = User.new(email: options[:email], password: password, agreement: true, role_id: role_id, confirmed_at: options[:confirmed] ? Time.now.utc : nil, bypass_invite_request_check: true)\n+      user = User.new(\n+        email: options[:email],\n+        password: password,\n+        agreement: true,\n+        role_id: role_id,\n+        confirmed_at: options[:confirmed] ? Time.now.utc : nil,\n+        bypass_registration_checks: true\n+      )\n \n       if options[:reattach]\n         account = Account.find_local(username) || Account.new(username: username)\n---\nlib/tasks/mastodon.rake\n@@ -552,7 +552,7 @@ namespace :mastodon do\n           password = SecureRandom.hex(16)\n \n           owner_role = UserRole.find_by(name: 'Owner')\n-          user = User.new(email: email, password: password, confirmed_at: Time.now.utc, account_attributes: { username: username }, bypass_invite_request_check: true, role: owner_role)\n+          user = User.new(email: email, password: password, confirmed_at: Time.now.utc, account_attributes: { username: username }, bypass_registration_checks: true, role: owner_role)\n           user.save(validate: false)\n           user.approve!\n \n---\nspec/lib/mastodon/cli/accounts_spec.rb\n@@ -70,6 +70,25 @@ def account_from_options\n         end\n       end\n \n+      context 'with min_age setting' do\n+        let(:options) { { email: 'tootctl@example.com', confirmed: true } }\n+\n+        before do\n+          Setting.min_age = 42\n+        end\n+\n+        it_behaves_like 'a new user with given email address and username'\n+\n+        it 'creates a new user with confirmed status' do\n+          expect { subject }\n+            .to output_results('New password')\n+\n+          user = User.find_by(email: options[:email])\n+\n+          expect(user.confirmed?).to be(true)\n+        end\n+      end\n+\n       context 'with --confirmed option' do\n         let(:options) { { email: 'tootctl@example.com', confirmed: true } }\n \n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rubocop-rails](https://docs.rubocop.org/rubocop-rails/) ([source](https://redirect.github.com/rubocop/rubocop-rails), [changelog](https://redirect.github.com/rubocop/rubocop-rails/blob/master/CHANGELOG.md)) | `2.31.0` -> `2.32.0` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rubocop-rails/2.32.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rubocop-rails/2.32.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rubocop-rails/2.31.0/2.32.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rubocop-rails/2.31.0/2.32.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>rubocop/rubocop-rails (rubocop-rails)</summary>\n\n### [`v2.32.0`](https://redirect.github.com/rubocop/rubocop-rails/blob/HEAD/CHANGELOG.md#2320-2025-05-17)\n\n[Compare Source](https://redirect.github.com/rubocop/rubocop-rails/compare/v2.31.0...v2.32.0)\n\n##### Bug fixes\n\n-   [#&#8203;1475](https://redirect.github.com/rubocop/rubocop-rails/pull/1475): Fix `Rails/TimeZone` cop error on invalid string literal encoding. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;1477](https://redirect.github.com/rubocop/rubocop-rails/issues/1477): Fix an error for `Rails/SchemaComment` when the comment is passed as a local variable. (\\[[@&#8203;earlopain](https://redirect.github.com/earlopain)]\\[])\n\n##### Changes\n\n-   [#&#8203;234](https://redirect.github.com/rubocop/rubocop-rails/issues/234): Use globs that are compatible with Engine or Packwerk. (\\[[@&#8203;tdeo](https://redirect.github.com/tdeo)]\\[])\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS4xOCIsInVwZGF0ZWRJblZlciI6IjQwLjExLjE4IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -9187,23 +9187,23 @@ __metadata:\n   linkType: hard\n \n \"pino@npm:^9.0.0\":\n-  version: 9.6.0\n-  resolution: \"pino@npm:9.6.0\"\n+  version: 9.7.0\n+  resolution: \"pino@npm:9.7.0\"\n   dependencies:\n     atomic-sleep: \"npm:^1.0.0\"\n     fast-redact: \"npm:^3.1.1\"\n     on-exit-leak-free: \"npm:^2.1.0\"\n     pino-abstract-transport: \"npm:^2.0.0\"\n     pino-std-serializers: \"npm:^7.0.0\"\n-    process-warning: \"npm:^4.0.0\"\n+    process-warning: \"npm:^5.0.0\"\n     quick-format-unescaped: \"npm:^4.0.3\"\n     real-require: \"npm:^0.2.0\"\n     safe-stable-stringify: \"npm:^2.3.1\"\n     sonic-boom: \"npm:^4.0.1\"\n     thread-stream: \"npm:^3.0.0\"\n   bin:\n     pino: bin.js\n-  checksum: 10c0/bcd1e9d9b301bea13b95689ca9ad7105ae9451928fb6c0b67b3e58c5fe37cea1d40665f3d6641e3da00be0bbc17b89031e67abbc8ea6aac6164f399309fd78e7\n+  checksum: 10c0/c7f8a83a9a9d728b4eff6d0f4b9367f031c91bcaa5806fbf0eedcc8e77faba593d59baf11a8fba0dd1c778bb17ca7ed01418ac1df4ec129faeedd4f3ecaff66f\n   languageName: node\n   linkType: hard\n \n@@ -9759,6 +9759,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"process-warning@npm:^5.0.0\":\n+  version: 5.0.0\n+  resolution: \"process-warning@npm:5.0.0\"\n+  checksum: 10c0/941f48863d368ec161e0b5890ba0c6af94170078f3d6b5e915c19b36fb59edb0dc2f8e834d25e0d375a8bf368a49d490f080508842168832b93489d17843ec29\n+  languageName: node\n+  linkType: hard\n+\n \"prom-client@npm:^15.0.0\":\n   version: 15.1.3\n   resolution: \"prom-client@npm:15.1.3\"\n---\n\n\n---\n\nChoice B:\napp/javascript/entrypoints/sign_up.ts\n@@ -4,9 +4,12 @@ import axios from 'axios';\n import ready from '../mastodon/ready';\n \n async function checkConfirmation() {\n-  const response = await axios.get('/api/v1/emails/check_confirmation');\n+  const response = await axios.get('/api/v1/emails/check_confirmation', {\n+    headers: { Accept: 'application/json' },\n+    withCredentials: true,\n+  });\n \n-  if (response.data) {\n+  if (response.status === 200 && response.data === true) {\n     window.location.href = '/start';\n   }\n }\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -768,12 +768,12 @@ GEM\n       lint_roller (~> 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n       rubocop-ast (>= 1.38.0, < 2.0)\n-    rubocop-rails (2.31.0)\n+    rubocop-rails (2.32.0)\n       activesupport (>= 4.2.0)\n       lint_roller (~> 1.1)\n       rack (>= 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n-      rubocop-ast (>= 1.38.0, < 2.0)\n+      rubocop-ast (>= 1.44.0, < 2.0)\n     rubocop-rspec (3.6.0)\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -201,7 +201,7 @@ group :development, :test do\n   gem 'faker', '~> 3.2'\n \n   # Generate factory objects\n-  gem 'fabrication', '~> 2.30'\n+  gem 'fabrication', '~> 3.0'\n \n   # Profiling tools\n   gem 'memory_profiler', require: false\n---\nGemfile.lock\n@@ -223,7 +223,7 @@ GEM\n       tzinfo\n     excon (1.2.5)\n       logger\n-    fabrication (2.31.0)\n+    fabrication (3.0.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n     faraday (2.13.1)\n@@ -972,7 +972,7 @@ DEPENDENCIES\n   doorkeeper (~> 5.6)\n   dotenv\n   email_spec\n-  fabrication (~> 2.30)\n+  fabrication (~> 3.0)\n   faker (~> 3.2)\n   faraday-httpclient\n   fast_blank (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [linzer](https://redirect.github.com/nomadium/linzer) ([changelog](https://redirect.github.com/nomadium/linzer/blob/master/CHANGELOG.md)) | `'~> 0.6.1'` -> `'~> 0.7.0'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/linzer/0.7.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/linzer/0.7.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/linzer/0.6.5/0.7.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/linzer/0.6.5/0.7.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>nomadium/linzer (linzer)</summary>\n\n### [`v0.7.1`](https://redirect.github.com/nomadium/linzer/blob/HEAD/CHANGELOG.md#071---2025-05-18)\n\n[Compare Source](https://redirect.github.com/nomadium/linzer/compare/v0.7.0...v0.7.1)\n\n-   Introduce specific exception classes for message signing errors\n    and signature verification exceptions (i.e. Linzer::SigningError\n    and Linzer::VerifyError)\n\n-   Fix bug in Linzer::HTTP client that prevented it from working with https URLs.\n\n### [`v0.7.0`](https://redirect.github.com/nomadium/linzer/blob/HEAD/CHANGELOG.md#070---2025-05-17)\n\n[Compare Source](https://redirect.github.com/nomadium/linzer/compare/0.6.5...v0.7.0)\n\n(No changes since the last beta release, this new stable release just\nbundles all the features/changes introduced during 0.7.0 beta releases)\n\n-   Introduce Rack::Auth::Signature middleware.\n\n-   Refactor and improve Rack::Auth::Signature code organization.\n\n-   Do not expose secret material on HMAC SHA-256 key when #inspect method is used.\n\n-   Update Rack::Auth::Signature configuration file options.\n\n-   Validate and test Rack::Auth::Signature with example Rails and Sinatra apps.\n\n-   Refactor to improve Linzer APIs and streamline its usage along with different\n    HTTP libraries. (Issues [#&#8203;6](https://redirect.github.com/nomadium/linzer/issues/6) and\n    [#&#8203;11](https://redirect.github.com/nomadium/linzer/issues/11))\n\n-   Provide integration with http.rb gem to allow signing outgoing HTTP requests.\n\n-   Add simple HTTP client module.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS4xOCIsInVwZGF0ZWRJblZlciI6IjQwLjExLjE4IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\napp/controllers/admin/rules_controller.rb\n@@ -50,6 +50,22 @@ def destroy\n       redirect_to admin_rules_path\n     end\n \n+    def move_up\n+      authorize @rule, :update?\n+\n+      @rule.move!(-1)\n+\n+      redirect_to admin_rules_path\n+    end\n+\n+    def move_down\n+      authorize @rule, :update?\n+\n+      @rule.move!(+1)\n+\n+      redirect_to admin_rules_path\n+    end\n+\n     private\n \n     def set_rule\n---\napp/javascript/material-icons/400-24px/arrow_downward-fill.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-800v487L216-537l-56 57 320 320 320-320-56-57-224 224v-487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/arrow_downward.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-800v487L216-537l-56 57 320 320 320-320-56-57-224 224v-487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/arrow_upward-fill.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-160v-487L216-423l-56-57 320-320 320 320-56 57-224-224v487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/arrow_upward.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-160v-487L216-423l-56-57 320-320 320 320-56 57-224-224v487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/styles/mastodon/admin.scss\n@@ -1127,6 +1127,15 @@ a.name-tag,\n   }\n }\n \n+.rule-actions {\n+  display: flex;\n+  flex-direction: column;\n+\n+  a.table-action-link {\n+    padding-inline-start: 0;\n+  }\n+}\n+\n .dashboard__counters.admin-account-counters {\n   margin-top: 10px;\n }\n---\napp/models/rule.rb\n@@ -22,4 +22,18 @@ class Rule < ApplicationRecord\n   validates :text, presence: true, length: { maximum: TEXT_SIZE_LIMIT }\n \n   scope :ordered, -> { kept.order(priority: :asc, id: :asc) }\n+\n+  def move!(offset)\n+    rules = Rule.ordered.to_a\n+    position = rules.index(self)\n+\n+    rules.delete_at(position)\n+    rules.insert(position + offset, self)\n+\n+    transaction do\n+      rules.each.with_index do |rule, index|\n+        rule.update!(priority: index)\n+      end\n+    end\n+  end\n end\n---\napp/views/admin/rules/_rule.html.haml\n@@ -7,5 +7,7 @@\n     .announcements-list__item__meta\n       = rule.hint\n \n-    %div\n+    .rule-actions\n+      = table_link_to 'arrow_upward', t('admin.rules.move_up'), move_up_admin_rule_path(rule), method: :post if can?(:update, rule) && !rule_iteration.first?\n       = table_link_to 'delete', t('admin.rules.delete'), admin_rule_path(rule), method: :delete, data: { confirm: t('admin.accounts.are_you_sure') } if can?(:destroy, rule)\n+      = table_link_to 'arrow_downward', t('admin.rules.move_down'), move_down_admin_rule_path(rule), method: :post if can?(:update, rule) && !rule_iteration.last?\n---\nconfig/locales/en.yml\n@@ -790,6 +790,8 @@ en:\n       description_html: While most claim to have read and agree to the terms of service, usually people do not read through until after a problem arises. <strong>Make it easier to see your server's rules at a glance by providing them in a flat bullet point list.</strong> Try to keep individual rules short and simple, but try not to split them up into many separate items either.\n       edit: Edit rule\n       empty: No server rules have been defined yet.\n+      move_down: Move down\n+      move_up: Move up\n       title: Server rules\n     settings:\n       about:\n---\nconfig/routes/admin.rb\n@@ -93,7 +93,12 @@\n     end\n   end\n \n-  resources :rules, only: [:index, :new, :create, :edit, :update, :destroy]\n+  resources :rules, only: [:index, :new, :create, :edit, :update, :destroy] do\n+    member do\n+      post :move_up\n+      post :move_down\n+    end\n+  end\n \n   resources :webhooks do\n     member do\n---\nspec/models/rule_spec.rb\n@@ -16,4 +16,24 @@\n       end\n     end\n   end\n+\n+  describe '#move!' do\n+    let!(:first_rule) { Fabricate(:rule, text: 'foo') }\n+    let!(:second_rule) { Fabricate(:rule, text: 'bar') }\n+    let!(:third_rule) { Fabricate(:rule, text: 'baz') }\n+\n+    it 'moves the rules as expected' do\n+      expect { first_rule.move!(+1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(foo bar baz)).to(%w(bar foo baz))\n+\n+      expect { first_rule.move!(-1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(bar foo baz)).to(%w(foo bar baz))\n+\n+      expect { third_rule.move!(-1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(foo bar baz)).to(%w(foo baz bar))\n+\n+      expect { second_rule.move!(-1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(foo baz bar)).to(%w(foo bar baz))\n+    end\n+  end\n end\n---\nspec/system/admin/rules_spec.rb\n@@ -48,6 +48,29 @@ def submit_form\n       end\n     end\n \n+    describe 'Moving down an existing rule' do\n+      let!(:first_rule) { Fabricate(:rule, text: 'This is another rule') }\n+      let!(:second_rule) { Fabricate(:rule, text: 'This is a rule') }\n+\n+      it 'moves the rule down' do\n+        visit admin_rules_path\n+\n+        expect(page)\n+          .to have_content(I18n.t('admin.rules.title'))\n+\n+        expect(Rule.ordered.pluck(:text)).to eq ['This is another rule', 'This is a rule']\n+\n+        click_on(I18n.t('admin.rules.move_down'))\n+\n+        expect(page)\n+          .to have_content(I18n.t('admin.rules.title'))\n+          .and have_content(first_rule.text)\n+          .and have_content(second_rule.text)\n+\n+        expect(Rule.ordered.pluck(:text)).to eq ['This is a rule', 'This is another rule']\n+      end\n+    end\n+\n     describe 'Editing an existing rule' do\n       let!(:rule) { Fabricate :rule, text: 'Rule text' }\n \n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -62,7 +62,7 @@ gem 'inline_svg'\n gem 'irb', '~> 1.8'\n gem 'kaminari', '~> 1.2'\n gem 'link_header', '~> 0.0'\n-gem 'linzer', '~> 0.6.1'\n+gem 'linzer', '~> 0.7.0'\n gem 'mario-redis-lock', '~> 1.2', require: 'redis_lock'\n gem 'mime-types', '~> 3.7.0', require: 'mime/types/columnar'\n gem 'mutex_m'\n---\nGemfile.lock\n@@ -148,6 +148,7 @@ GEM\n     case_transform (0.2)\n       activesupport\n     cbor (0.5.9.8)\n+    cgi (0.4.2)\n     charlock_holmes (0.7.9)\n     chewy (7.6.0)\n       activesupport (>= 5.2)\n@@ -262,6 +263,7 @@ GEM\n       fog-core (~> 2.1)\n       fog-json (>= 1.0)\n     formatador (1.1.0)\n+    forwardable (1.3.3)\n     fugit (1.11.1)\n       et-orbi (~> 1, >= 1.2.11)\n       raabro (~> 1.4)\n@@ -396,7 +398,11 @@ GEM\n       rexml\n     link_header (0.0.8)\n     lint_roller (1.1.0)\n-    linzer (0.6.5)\n+    linzer (0.7.0)\n+      cgi (~> 0.4.2)\n+      forwardable (~> 1.3, >= 1.3.3)\n+      logger (~> 1.7, >= 1.7.0)\n+      net-http (~> 0.6.0)\n       openssl (~> 3.0, >= 3.0.0)\n       rack (>= 2.2, < 4.0)\n       starry (~> 0.2)\n@@ -628,7 +634,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -995,7 +1001,7 @@ DEPENDENCIES\n   letter_opener (~> 1.8)\n   letter_opener_web (~> 3.0)\n   link_header (~> 0.0)\n-  linzer (~> 0.6.1)\n+  linzer (~> 0.7.0)\n   lograge (~> 0.12)\n   mail (~> 2.8)\n   mario-redis-lock (~> 1.2)\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/counters.tsx\n@@ -43,3 +43,17 @@ export const FollowersCounter = (\n     }}\n   />\n );\n+\n+export const FollowersYouKnowCounter = (\n+  displayNumber: React.ReactNode,\n+  pluralReady: number,\n+) => (\n+  <FormattedMessage\n+    id='account.followers_you_know_counter'\n+    defaultMessage='{counter} you know'\n+    values={{\n+      count: pluralReady,\n+      counter: <strong>{displayNumber}</strong>,\n+    }}\n+  />\n+);\n---\napp/javascript/mastodon/components/hover_card_account.tsx\n@@ -9,11 +9,16 @@ import { fetchAccount } from 'mastodon/actions/accounts';\n import { AccountBio } from 'mastodon/components/account_bio';\n import { AccountFields } from 'mastodon/components/account_fields';\n import { Avatar } from 'mastodon/components/avatar';\n-import { FollowersCounter } from 'mastodon/components/counters';\n+import { AvatarGroup } from 'mastodon/components/avatar_group';\n+import {\n+  FollowersCounter,\n+  FollowersYouKnowCounter,\n+} from 'mastodon/components/counters';\n import { DisplayName } from 'mastodon/components/display_name';\n import { FollowButton } from 'mastodon/components/follow_button';\n import { LoadingIndicator } from 'mastodon/components/loading_indicator';\n import { ShortNumber } from 'mastodon/components/short_number';\n+import { useFetchFamiliarFollowers } from 'mastodon/features/account_timeline/hooks/familiar_followers';\n import { domain } from 'mastodon/initial_state';\n import { useAppSelector, useAppDispatch } from 'mastodon/store';\n \n@@ -38,6 +43,8 @@ export const HoverCardAccount = forwardRef<\n     }\n   }, [dispatch, accountId, account]);\n \n+  const { familiarFollowers } = useFetchFamiliarFollowers({ accountId });\n+\n   return (\n     <div\n       ref={ref}\n@@ -73,11 +80,27 @@ export const HoverCardAccount = forwardRef<\n             )}\n           </div>\n \n-          <div className='hover-card__number'>\n+          <div className='hover-card__numbers'>\n             <ShortNumber\n               value={account.followers_count}\n               renderer={FollowersCounter}\n             />\n+            {familiarFollowers.length > 0 && (\n+              <>\n+                &middot;\n+                <div className='hover-card__familiar-followers'>\n+                  <ShortNumber\n+                    value={familiarFollowers.length}\n+                    renderer={FollowersYouKnowCounter}\n+                  />\n+                  <AvatarGroup compact>\n+                    {familiarFollowers.slice(0, 3).map((account) => (\n+                      <Avatar key={account.id} account={account} size={22} />\n+                    ))}\n+                  </AvatarGroup>\n+                </div>\n+              </>\n+            )}\n           </div>\n \n           <FollowButton accountId={accountId} />\n---\napp/javascript/mastodon/features/account_timeline/components/familiar_followers.tsx\n@@ -1,15 +1,12 @@\n-import { useEffect } from 'react';\n-\n import { FormattedMessage } from 'react-intl';\n \n import { Link } from 'react-router-dom';\n \n-import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n import { Avatar } from '@/mastodon/components/avatar';\n import { AvatarGroup } from '@/mastodon/components/avatar_group';\n import type { Account } from '@/mastodon/models/account';\n-import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n-import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n+\n+import { useFetchFamiliarFollowers } from '../hooks/familiar_followers';\n \n const AccountLink: React.FC<{ account?: Account }> = ({ account }) => {\n   if (!account) {\n@@ -64,20 +61,11 @@ const FamiliarFollowersReadout: React.FC<{ familiarFollowers: Account[] }> = ({\n export const FamiliarFollowers: React.FC<{ accountId: string }> = ({\n   accountId,\n }) => {\n-  const dispatch = useAppDispatch();\n-  const familiarFollowers = useAppSelector((state) =>\n-    getAccountFamiliarFollowers(state, accountId),\n-  );\n-\n-  const hasNoData = familiarFollowers === null;\n-\n-  useEffect(() => {\n-    if (hasNoData) {\n-      void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n-    }\n-  }, [dispatch, accountId, hasNoData]);\n+  const { familiarFollowers, isLoading } = useFetchFamiliarFollowers({\n+    accountId,\n+  });\n \n-  if (hasNoData || familiarFollowers.length === 0) {\n+  if (isLoading || familiarFollowers.length === 0) {\n     return null;\n   }\n \n---\napp/javascript/mastodon/features/account_timeline/hooks/familiar_followers.ts\n@@ -0,0 +1,30 @@\n+import { useEffect } from 'react';\n+\n+import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n+import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n+import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n+import { me } from 'mastodon/initial_state';\n+\n+export const useFetchFamiliarFollowers = ({\n+  accountId,\n+}: {\n+  accountId?: string;\n+}) => {\n+  const dispatch = useAppDispatch();\n+  const familiarFollowers = useAppSelector((state) =>\n+    accountId ? getAccountFamiliarFollowers(state, accountId) : null,\n+  );\n+\n+  const hasNoData = familiarFollowers === null;\n+\n+  useEffect(() => {\n+    if (hasNoData && accountId && accountId !== me) {\n+      void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n+    }\n+  }, [dispatch, accountId, hasNoData]);\n+\n+  return {\n+    familiarFollowers: hasNoData ? [] : familiarFollowers,\n+    isLoading: hasNoData,\n+  };\n+};\n---\napp/javascript/mastodon/locales/en.json\n@@ -42,6 +42,7 @@\n   \"account.followers\": \"Followers\",\n   \"account.followers.empty\": \"No one follows this user yet.\",\n   \"account.followers_counter\": \"{count, plural, one {{counter} follower} other {{counter} followers}}\",\n+  \"account.followers_you_know_counter\": \"{counter} you know\",\n   \"account.following\": \"Following\",\n   \"account.following_counter\": \"{count, plural, one {{counter} following} other {{counter} following}}\",\n   \"account.follows.empty\": \"This user doesn't follow anyone yet.\",\n---\napp/javascript/styles/mastodon/components.scss\n@@ -10705,7 +10705,15 @@ noscript {\n     color: inherit;\n   }\n \n-  &__number {\n+  &__numbers,\n+  &__familiar-followers {\n+    display: flex;\n+    align-items: center;\n+    flex-wrap: wrap;\n+    gap: 10px;\n+  }\n+\n+  &__numbers {\n     font-size: 15px;\n     line-height: 22px;\n     color: $secondary-text-color;\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.222.3', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1088.0)\n+    aws-sdk-core (3.222.2)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -931,7 +933,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.222.3)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [ws](https://redirect.github.com/websockets/ws) | [`8.18.1` -> `8.18.2`](https://renovatebot.com/diffs/npm/ws/8.18.1/8.18.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/ws/8.18.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/ws/8.18.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/ws/8.18.1/8.18.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/ws/8.18.1/8.18.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>websockets/ws (ws)</summary>\n\n### [`v8.18.2`](https://redirect.github.com/websockets/ws/releases/tag/8.18.2)\n\n[Compare Source](https://redirect.github.com/websockets/ws/compare/8.18.1...8.18.2)\n\n### Bug fixes\n\nFixed an issue that, during message decompression when the maximum size was\nexceeded, led to the emission of an inaccurate error and closure of the\nconnection with an improper close code ([#&#8203;2285](https://redirect.github.com/websockets/ws/issues/2285)).\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS4xOCIsInVwZGF0ZWRJblZlciI6IjQwLjExLjE4IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\napp/javascript/mastodon/components/status.jsx\n@@ -175,9 +175,8 @@ class Status extends ImmutablePureComponent {\n     }\n   };\n \n-  handleMouseUp = e => {\n+  handleHeaderClick = e => {\n     // Only handle clicks on the empty space above the content\n-\n     if (e.target !== e.currentTarget && e.detail >= 1) {\n       return;\n     }\n@@ -547,7 +546,7 @@ class Status extends ImmutablePureComponent {\n           <div className={classNames('status', `status-${status.get('visibility')}`, { 'status-reply': !!status.get('in_reply_to_id'), 'status--in-thread': !!rootId, 'status--first-in-thread': previousId && (!connectUp || connectToRoot), muted: this.props.muted })} data-id={status.get('id')}>\n             {(connectReply || connectUp || connectToRoot) && <div className={classNames('status__line', { 'status__line--full': connectReply, 'status__line--first': !status.get('in_reply_to_id') && !connectToRoot })} />}\n \n-            <div onMouseUp={this.handleMouseUp} className='status__info'>\n+            <div onClick={this.handleHeaderClick} onAuxClick={this.handleHeaderClick} className='status__info'>\n               <Link to={`/@${status.getIn(['account', 'acct'])}/${status.get('id')}`} className='status__relative-time'>\n                 <span className='status__visibility-icon'><VisibilityIcon visibility={status.get('visibility')} /></span>\n                 <RelativeTimestamp timestamp={status.get('created_at')} />{status.get('edited_at') && <abbr title={intl.formatMessage(messages.edited, { date: intl.formatDate(status.get('edited_at'), { year: 'numeric', month: 'short', day: '2-digit', hour: '2-digit', minute: '2-digit' }) })}> *</abbr>}\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/actions/notifications.js\n@@ -21,7 +21,6 @@ export const NOTIFICATIONS_SET_BROWSER_PERMISSION = 'NOTIFICATIONS_SET_BROWSER_P\n \n defineMessages({\n   mention: { id: 'notification.mention', defaultMessage: '{name} mentioned you' },\n-  mentioned_you: { id: 'notification.mentioned_you', defaultMessage: '{name} mentioned you' },\n   group: { id: 'notifications.group', defaultMessage: '{count} notifications' },\n });\n \n---\nconfig/vite/plugin-sw-locales.ts\n@@ -8,8 +8,21 @@\n import fs from 'node:fs';\n import path from 'node:path';\n \n+import { defineMessages } from 'react-intl';\n+\n import type { Plugin, ResolvedConfig } from 'vite';\n \n+const translations = defineMessages({\n+  mentioned_you: {\n+    id: 'notification.mentioned_you',\n+    defaultMessage: '{name} mentioned you',\n+  },\n+});\n+\n+const CUSTOM_TRANSLATIONS = {\n+  'notification.mention': translations.mentioned_you.id,\n+};\n+\n const KEEP_KEYS = [\n   'notification.favourite',\n   'notification.follow',\n@@ -67,7 +80,14 @@ export function MastodonServiceWorkerLocales(): Plugin {\n             const filteredLocale: Record<string, string> = {};\n \n             Object.entries(full).forEach(([key, value]) => {\n-              if (KEEP_KEYS.includes(key)) filteredLocale[key] = value;\n+              if (KEEP_KEYS.includes(key)) {\n+                filteredLocale[key] = value;\n+              }\n+            });\n+\n+            Object.entries(CUSTOM_TRANSLATIONS).forEach(([key, value]) => {\n+              const translation = full[value];\n+              if (translation) filteredLocale[key] = translation;\n             });\n \n             filteredLocales[locale] = filteredLocale;\n---\npackage.json\n@@ -18,7 +18,7 @@\n     \"fix\": \"yarn fix:js && yarn fix:css\",\n     \"format\": \"prettier --write --log-level warn .\",\n     \"format:check\": \"prettier --check --ignore-unknown .\",\n-    \"i18n:extract\": \"formatjs extract 'app/javascript/**/*.{js,jsx,ts,tsx}' --ignore '**/*.d.ts' --out-file app/javascript/mastodon/locales/en.json --format config/formatjs-formatter.js\",\n+    \"i18n:extract\": \"formatjs extract 'app/javascript/**/*.{js,jsx,ts,tsx}' config/vite/plugin-sw-locales.js --ignore '**/*.d.ts' --out-file app/javascript/mastodon/locales/en.json --format config/formatjs-formatter.js\",\n     \"lint:js\": \"cd $INIT_CWD && eslint --cache --report-unused-disable-directives\",\n     \"lint:css\": \"stylelint \\\"**/*.{css,scss}\\\"\",\n     \"lint\": \"yarn lint:js && yarn lint:css\",\n---\n\n\n---\n\nChoice C:\neslint.config.mjs\n@@ -1,5 +1,7 @@\n // @ts-check\n \n+import path from 'node:path';\n+\n import js from '@eslint/js';\n import { globalIgnores } from 'eslint/config';\n import formatjs from 'eslint-plugin-formatjs';\n@@ -204,7 +206,9 @@ export default tseslint.config([\n       'import/ignore': ['node_modules', '\\\\.(css|scss|json)$'],\n \n       'import/resolver': {\n-        typescript: {},\n+        typescript: {\n+          project: path.resolve(import.meta.dirname, './tsconfig.json'),\n+        },\n       },\n     },\n \n---\nstreaming/eslint.config.mjs\n@@ -1,5 +1,7 @@\n // @ts-check\n \n+import path from 'node:path';\n+\n import globals from 'globals';\n import tseslint from 'typescript-eslint';\n \n@@ -20,7 +22,9 @@ export default tseslint.config([\n     settings: {\n       'import/ignore': ['node_modules', '\\\\.(json)$'],\n       'import/resolver': {\n-        typescript: {},\n+        typescript: {\n+          project: path.resolve(import.meta.dirname, './tsconfig.json'),\n+        },\n       },\n     },\n \n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -13120,8 +13120,8 @@ __metadata:\n   linkType: hard\n \n \"ws@npm:^8.12.1, ws@npm:^8.18.0\":\n-  version: 8.18.1\n-  resolution: \"ws@npm:8.18.1\"\n+  version: 8.18.2\n+  resolution: \"ws@npm:8.18.2\"\n   peerDependencies:\n     bufferutil: ^4.0.1\n     utf-8-validate: \">=5.0.2\"\n@@ -13130,7 +13130,7 @@ __metadata:\n       optional: true\n     utf-8-validate:\n       optional: true\n-  checksum: 10c0/e498965d6938c63058c4310ffb6967f07d4fa06789d3364829028af380d299fe05762961742971c764973dce3d1f6a2633fe8b2d9410c9b52e534b4b882a99fa\n+  checksum: 10c0/4b50f67931b8c6943c893f59c524f0e4905bbd183016cfb0f2b8653aa7f28dad4e456b9d99d285bbb67cca4fedd9ce90dfdfaa82b898a11414ebd66ee99141e4\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rack](https://redirect.github.com/rack/rack) ([changelog](https://redirect.github.com/rack/rack/blob/main/CHANGELOG.md)) | `2.2.14` -> `2.2.15` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rack/2.2.15?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rack/2.2.15?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rack/2.2.14/2.2.15?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rack/2.2.14/2.2.15?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>rack/rack (rack)</summary>\n\n### [`v2.2.15`](https://redirect.github.com/rack/rack/blob/HEAD/CHANGELOG.md#2215---2025-05-18)\n\n[Compare Source](https://redirect.github.com/rack/rack/compare/v2.2.14...v2.2.15)\n\n-   Optional support for `CGI::Cookie` if not available. ([#&#8203;2327](https://redirect.github.com/rack/rack/pull/2327), [#&#8203;2333](https://redirect.github.com/rack/rack/pull/2333), \\[[@&#8203;earlopain](https://redirect.github.com/earlopain)])\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS4xOCIsInVwZGF0ZWRJblZlciI6IjQwLjExLjE4IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -742,7 +742,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.6)\n+    rubocop (1.75.7)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -633,7 +633,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (3.1.15)\n+    rack (3.1.16)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (3.0.0)\n---\n\n\n---\n\nChoice D:\napp/helpers/formatting_helper.rb\n@@ -27,14 +27,7 @@ def extract_status_plain_text(status)\n   module_function :extract_status_plain_text\n \n   def status_content_format(status)\n-    MastodonOTELTracer.in_span('HtmlAwareFormatter rendering') do |span|\n-      span.add_attributes(\n-        'app.formatter.content.type' => 'status',\n-        'app.formatter.content.origin' => status.local? ? 'local' : 'remote'\n-      )\n-\n-      html_aware_format(status.text, status.local?, preloaded_accounts: [status.account] + (status.respond_to?(:active_mentions) ? status.active_mentions.map(&:account) : []))\n-    end\n+    html_aware_format(status.text, status.local?, preloaded_accounts: [status.account] + (status.respond_to?(:active_mentions) ? status.active_mentions.map(&:account) : []))\n   end\n \n   def rss_status_content_format(status)\n@@ -46,14 +39,7 @@ def rss_status_content_format(status)\n   end\n \n   def account_bio_format(account)\n-    MastodonOTELTracer.in_span('HtmlAwareFormatter rendering') do |span|\n-      span.add_attributes(\n-        'app.formatter.content.type' => 'account_bio',\n-        'app.formatter.content.origin' => account.local? ? 'local' : 'remote'\n-      )\n-\n-      html_aware_format(account.note, account.local?)\n-    end\n+    html_aware_format(account.note, account.local?)\n   end\n \n   def account_field_value_format(field, with_rel_me: true)\n---\napp/lib/text_formatter.rb\n@@ -33,24 +33,17 @@ def entities\n   def to_s\n     return ''.html_safe if text.blank?\n \n-    html = nil\n-    MastodonOTELTracer.in_span('TextFormatter#to_s extract_and_rewrite') do\n-      html = rewrite do |entity|\n-        if entity[:url]\n-          link_to_url(entity)\n-        elsif entity[:hashtag]\n-          link_to_hashtag(entity)\n-        elsif entity[:screen_name]\n-          link_to_mention(entity)\n-        end\n+    html = rewrite do |entity|\n+      if entity[:url]\n+        link_to_url(entity)\n+      elsif entity[:hashtag]\n+        link_to_hashtag(entity)\n+      elsif entity[:screen_name]\n+        link_to_mention(entity)\n       end\n     end\n \n-    if multiline?\n-      MastodonOTELTracer.in_span('TextFormatter#to_s simple_format') do\n-        html = simple_format(html, {}, sanitize: false).delete(\"\\n\")\n-      end\n-    end\n+    html = simple_format(html, {}, sanitize: false).delete(\"\\n\") if multiline?\n \n     html.html_safe # rubocop:disable Rails/OutputSafety\n   end\n@@ -106,54 +99,48 @@ def rewrite\n   end\n \n   def link_to_url(entity)\n-    MastodonOTELTracer.in_span('TextFormatter#link_to_url') do\n-      TextFormatter.shortened_link(entity[:url], rel_me: with_rel_me?)\n-    end\n+    TextFormatter.shortened_link(entity[:url], rel_me: with_rel_me?)\n   end\n \n   def link_to_hashtag(entity)\n-    MastodonOTELTracer.in_span('TextFormatter#link_to_hashtag') do\n-      hashtag = entity[:hashtag]\n-      url     = tag_url(hashtag)\n+    hashtag = entity[:hashtag]\n+    url     = tag_url(hashtag)\n \n-      <<~HTML.squish\n-        <a href=\"#{h(url)}\" class=\"mention hashtag\" rel=\"tag\">#<span>#{h(hashtag)}</span></a>\n-      HTML\n-    end\n+    <<~HTML.squish\n+      <a href=\"#{h(url)}\" class=\"mention hashtag\" rel=\"tag\">#<span>#{h(hashtag)}</span></a>\n+    HTML\n   end\n \n   def link_to_mention(entity)\n-    MastodonOTELTracer.in_span('TextFormatter#link_to_mention') do\n-      username, domain = entity[:screen_name].split('@')\n-      domain           = nil if local_domain?(domain)\n-      account          = nil\n-\n-      if preloaded_accounts?\n-        same_username_hits = 0\n-\n-        preloaded_accounts.each do |other_account|\n-          same_username = other_account.username.casecmp(username).zero?\n-          same_domain   = other_account.domain.nil? ? domain.nil? : other_account.domain.casecmp(domain)&.zero?\n-\n-          if same_username && !same_domain\n-            same_username_hits += 1\n-          elsif same_username && same_domain\n-            account = other_account\n-          end\n+    username, domain = entity[:screen_name].split('@')\n+    domain           = nil if local_domain?(domain)\n+    account          = nil\n+\n+    if preloaded_accounts?\n+      same_username_hits = 0\n+\n+      preloaded_accounts.each do |other_account|\n+        same_username = other_account.username.casecmp(username).zero?\n+        same_domain   = other_account.domain.nil? ? domain.nil? : other_account.domain.casecmp(domain)&.zero?\n+\n+        if same_username && !same_domain\n+          same_username_hits += 1\n+        elsif same_username && same_domain\n+          account = other_account\n         end\n-      else\n-        account = entity_cache.mention(username, domain)\n       end\n+    else\n+      account = entity_cache.mention(username, domain)\n+    end\n \n-      return \"@#{h(entity[:screen_name])}\" if account.nil?\n+    return \"@#{h(entity[:screen_name])}\" if account.nil?\n \n-      url = ActivityPub::TagManager.instance.url_for(account)\n-      display_username = same_username_hits&.positive? || with_domains? ? account.pretty_acct : account.username\n+    url = ActivityPub::TagManager.instance.url_for(account)\n+    display_username = same_username_hits&.positive? || with_domains? ? account.pretty_acct : account.username\n \n-      <<~HTML.squish\n-        <span class=\"h-card\" translate=\"no\"><a href=\"#{h(url)}\" class=\"u-url mention\">@<span>#{h(display_username)}</span></a></span>\n-      HTML\n-    end\n+    <<~HTML.squish\n+      <span class=\"h-card\" translate=\"no\"><a href=\"#{h(url)}\" class=\"u-url mention\">@<span>#{h(display_username)}</span></a></span>\n+    HTML\n   end\n \n   def entity_cache\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nAttempt to mitigate Sidekiq jobs hanging during file MIME type detection #34716\n\n---\n\nChoice A:\napp/models/concerns/attachmentable.rb\n@@ -75,9 +75,16 @@ def appropriate_extension(attachment)\n   end\n \n   def calculated_content_type(attachment)\n-    Paperclip.run('file', '-b --mime :file', file: attachment.queued_for_write[:original].path).split(/[:;\\s]+/).first.chomp\n-  rescue Terrapin::CommandLineError\n-    ''\n+    begin\n+      Timeout.timeout(10) do\n+        Paperclip.run('file', '-b --mime :file', file: attachment.queued_for_write[:original].path).split(/[:;\\s]+/).first.chomp\n+      end\n+    rescue Timeout::Error\n+      Rails.logger.error \"file command timed out for #{attachment.queued_for_write[:original].path}\"\n+      ''\n+    rescue Terrapin::CommandLineError\n+      ''\n+    end\n   end\n \n   def obfuscate_file_name(attachment)\n---\n\n\n---\n\nChoice B:\napp/lib/activitypub/activity/create.rb\n@@ -226,8 +226,6 @@ def process_tags\n   end\n \n   def process_quote\n-    return unless Mastodon::Feature.inbound_quotes_enabled?\n-\n     @quote_uri = @status_parser.quote_uri\n     return if @quote_uri.blank?\n \n---\napp/lib/activitypub/activity/quote_request.rb\n@@ -4,7 +4,6 @@ class ActivityPub::Activity::QuoteRequest < ActivityPub::Activity\n   include Payloadable\n \n   def perform\n-    return unless Mastodon::Feature.inbound_quotes_enabled?\n     return if non_matching_uri_hosts?(@account.uri, @json['id'])\n \n     quoted_status = status_from_uri(object_uri)\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -271,8 +271,6 @@ def update_emojis!\n   end\n \n   def update_quote!\n-    return unless Mastodon::Feature.inbound_quotes_enabled?\n-\n     quote_uri = @status_parser.quote_uri\n \n     if quote_uri.present?\n---\nspec/lib/activitypub/activity/create_spec.rb\n@@ -887,7 +887,7 @@ def activity_for_object(json)\n         end\n       end\n \n-      context 'with an unverifiable quote of a known post', feature: :inbound_quotes do\n+      context 'with an unverifiable quote of a known post' do\n         let(:quoted_status) { Fabricate(:status) }\n \n         let(:object_json) do\n@@ -911,7 +911,7 @@ def activity_for_object(json)\n         end\n       end\n \n-      context 'with an unverifiable unknown post', feature: :inbound_quotes do\n+      context 'with an unverifiable unknown post' do\n         let(:unknown_post_uri) { 'https://unavailable.example.com/unavailable-post' }\n \n         let(:object_json) do\n@@ -939,7 +939,7 @@ def activity_for_object(json)\n         end\n       end\n \n-      context 'with a verifiable quote of a known post', feature: :inbound_quotes do\n+      context 'with a verifiable quote of a known post' do\n         let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n         let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n         let(:approval_uri) { 'https://quoted.example.com/quote-approval' }\n---\nspec/lib/activitypub/activity/quote_request_spec.rb\n@@ -2,7 +2,7 @@\n \n require 'rails_helper'\n \n-RSpec.describe ActivityPub::Activity::QuoteRequest, feature: :inbound_quotes do\n+RSpec.describe ActivityPub::Activity::QuoteRequest do\n   let(:sender)    { Fabricate(:account, domain: 'example.com') }\n   let(:recipient) { Fabricate(:account) }\n   let(:quoted_post) { Fabricate(:status, account: recipient) }\n---\nspec/services/activitypub/process_status_update_service_spec.rb\n@@ -435,7 +435,7 @@\n     end\n   end\n \n-  context 'when the status has an existing unverified quote and adds an approval link', feature: :inbound_quotes do\n+  context 'when the status has an existing unverified quote and adds an approval link' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: nil) }\n@@ -500,7 +500,7 @@\n     end\n   end\n \n-  context 'when the status has an existing verified quote and removes an approval link', feature: :inbound_quotes do\n+  context 'when the status has an existing verified quote and removes an approval link' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: approval_uri, state: :accepted) }\n@@ -535,7 +535,7 @@\n     end\n   end\n \n-  context 'when the status adds a verifiable quote', feature: :inbound_quotes do\n+  context 'when the status adds a verifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let(:approval_uri) { 'https://quoted.example.com/approvals/1' }\n@@ -600,7 +600,7 @@\n     end\n   end\n \n-  context 'when the status adds a unverifiable quote', feature: :inbound_quotes do\n+  context 'when the status adds a unverifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let(:approval_uri) { 'https://quoted.example.com/approvals/1' }\n@@ -635,7 +635,7 @@\n     end\n   end\n \n-  context 'when the status removes a verified quote', feature: :inbound_quotes do\n+  context 'when the status removes a verified quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: approval_uri, state: :accepted) }\n@@ -660,7 +660,7 @@\n     end\n   end\n \n-  context 'when the status removes an unverified quote', feature: :inbound_quotes do\n+  context 'when the status removes an unverified quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let!(:quote) { Fabricate(:quote, status: status, quoted_status: quoted_status, approval_uri: nil, state: :pending) }\n@@ -684,7 +684,7 @@\n     end\n   end\n \n-  context 'when the status swaps a verified quote with an unverifiable quote', feature: :inbound_quotes do\n+  context 'when the status swaps a verified quote with an unverifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n     let(:second_quoted_status) { Fabricate(:status, account: quoted_account) }\n@@ -752,7 +752,7 @@\n     end\n   end\n \n-  context 'when the status swaps a verified quote with another verifiable quote', feature: :inbound_quotes do\n+  context 'when the status swaps a verified quote with another verifiable quote' do\n     let(:quoted_account) { Fabricate(:account, domain: 'quoted.example.com') }\n     let(:second_quoted_account) { Fabricate(:account, domain: 'second-quoted.example.com') }\n     let(:quoted_status) { Fabricate(:status, account: quoted_account) }\n---\n\n\n---\n\nChoice C:\napp/presenters/status_relationships_presenter.rb\n@@ -7,14 +7,24 @@ class StatusRelationshipsPresenter\n               :bookmarks_map, :filters_map, :attributes_map\n \n   def initialize(statuses, current_account_id = nil, **options)\n+    @current_account_id = current_account_id\n+\n+    # Keeping a reference to @statuses is ok since `StatusRelationshipsPresenter`\n+    # basically never outlives the statuses collection it is passed\n+    @statuses = statuses\n+\n     if current_account_id.nil?\n-      @reblogs_map    = {}\n-      @favourites_map = {}\n-      @bookmarks_map  = {}\n-      @mutes_map      = {}\n-      @pins_map       = {}\n-      @filters_map    = {}\n+      @preloaded_account_relations = {}\n+      @filters_map     = {}\n+      @reblogs_map     = {}\n+      @favourites_map  = {}\n+      @bookmarks_map   = {}\n+      @mutes_map       = {}\n+      @pins_map        = {}\n+      @attributes_map  = {}\n     else\n+      @preloaded_account_relations = nil\n+\n       statuses            = statuses.compact\n       status_ids          = statuses.flat_map { |s| [s.id, s.reblog_of_id, s.proper.quote&.quoted_status_id] }.uniq.compact\n       conversation_ids    = statuses.flat_map { |s| [s.proper.conversation_id, s.proper.quote&.quoted_status&.conversation_id] }.uniq.compact\n@@ -30,6 +40,17 @@ def initialize(statuses, current_account_id = nil, **options)\n     end\n   end\n \n+  # This one is currently on-demand as it is only used for quote posts\n+  def preloaded_account_relations\n+    @preloaded_account_relations ||= begin\n+      accounts = @statuses.compact.flat_map { |s| [s.account, s.proper.account, s.proper.quote&.quoted_account] }.uniq.compact\n+\n+      account_ids = accounts.pluck(:id)\n+      account_domains = accounts.pluck(:domain).uniq\n+      Account.find(@current_account_id).relations_map(account_ids, account_domains)\n+    end\n+  end\n+\n   private\n \n   def build_filters_map(statuses, current_account_id)\n---\napp/serializers/rest/base_quote_serializer.rb\n@@ -20,6 +20,6 @@ def quoted_status\n   private\n \n   def status_filter\n-    @status_filter ||= StatusFilter.new(object.quoted_status, current_user&.account, instance_options[:relationships] || {})\n+    @status_filter ||= StatusFilter.new(object.quoted_status, current_user&.account, instance_options[:relationships]&.preloaded_account_relations || {})\n   end\n end\n---\nspec/requests/api/v1/timelines/home_spec.rb\n@@ -26,8 +26,13 @@\n       before do\n         user.account.follow!(bob)\n         user.account.follow!(ana)\n-        PostStatusService.new.call(bob, text: 'New toot from bob.')\n+        quoted = PostStatusService.new.call(bob, text: 'New toot from bob.')\n         PostStatusService.new.call(tim, text: 'New toot from tim.')\n+        reblogged = PostStatusService.new.call(tim, text: 'New toot from tim, which will end up boosted.')\n+        ReblogService.new.call(bob, reblogged)\n+        # TODO: use PostStatusService argument when available rather than manually creating quote\n+        quoting = PostStatusService.new.call(bob, text: 'Self-quote from bob.')\n+        Quote.create!(status: quoting, quoted_status: quoted, state: :accepted)\n         PostStatusService.new.call(ana, text: 'New toot from ana.')\n       end\n \n---\n\n\n---\n\nChoice D:\napp/javascript/styles/mastodon/admin.scss\n@@ -114,15 +114,14 @@ $content-width: 840px;\n \n       a {\n         font-size: 14px;\n-        display: block;\n+        display: flex;\n+        align-items: center;\n+        gap: 6px;\n         padding: 15px;\n         color: $darker-text-color;\n         text-decoration: none;\n         transition: all 200ms linear;\n         transition-property: color, background-color;\n-        white-space: nowrap;\n-        overflow: hidden;\n-        text-overflow: ellipsis;\n \n         &:hover {\n           color: $primary-text-color;\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nI can't reopen https://github.com/mastodon/mastodon/pull/27104 so here's a new one.\r\n\r\nI am getting a number of string truncations for the gd locale in the settings menu\r\n\r\n![truncations](https://github.com/mastodon/mastodon/assets/4095570/4bd4650b-8efc-49d4-8140-0b21af6cb7d6)\r\n\r\nI can't shorten the translations any further, so I have made the menu 30 pixels wider.\n\n---\n\nChoice A:\napp/lib/http_signature_draft.rb\n@@ -6,14 +6,13 @@\n class HttpSignatureDraft\n   REQUEST_TARGET = '(request-target)'\n \n-  def initialize(keypair, key_id, full_path: true)\n+  def initialize(keypair, key_id)\n     @keypair = keypair\n     @key_id = key_id\n-    @full_path = full_path\n   end\n \n   def request_target(verb, url)\n-    if url.query.nil? || !@full_path\n+    if url.query.nil?\n       \"#{verb} #{url.path}\"\n     else\n       \"#{verb} #{url.path}?#{url.query}\"\n---\napp/lib/request.rb\n@@ -75,7 +75,6 @@ def initialize(verb, url, **options)\n     @url         = Addressable::URI.parse(url).normalize\n     @http_client = options.delete(:http_client)\n     @allow_local = options.delete(:allow_local)\n-    @full_path   = !options.delete(:omit_query_string)\n     @options     = {\n       follow: {\n         max_hops: 3,\n@@ -102,7 +101,7 @@ def on_behalf_of(actor, sign_with: nil)\n \n     key_id = ActivityPub::TagManager.instance.key_uri_for(actor)\n     keypair = sign_with.present? ? OpenSSL::PKey::RSA.new(sign_with) : actor.keypair\n-    @signing = HttpSignatureDraft.new(keypair, key_id, full_path: @full_path)\n+    @signing = HttpSignatureDraft.new(keypair, key_id)\n \n     self\n   end\n---\napp/services/activitypub/fetch_replies_service.rb\n@@ -57,20 +57,7 @@ def fetch_collection(collection_or_uri)\n     return unless @allow_synchronous_requests\n     return if non_matching_uri_hosts?(@reference_uri, collection_or_uri)\n \n-    # NOTE: For backward compatibility reasons, Mastodon signs outgoing\n-    # queries incorrectly by default.\n-    #\n-    # While this is relevant for all URLs with query strings, this is\n-    # the only code path where this happens in practice.\n-    #\n-    # Therefore, retry with correct signatures if this fails.\n-    begin\n-      fetch_resource_without_id_validation(collection_or_uri, nil, raise_on_error: :temporary)\n-    rescue Mastodon::UnexpectedResponseError => e\n-      raise unless e.response && e.response.code == 401 && Addressable::URI.parse(collection_or_uri).query.present?\n-\n-      fetch_resource_without_id_validation(collection_or_uri, nil, raise_on_error: :temporary, request_options: { omit_query_string: false })\n-    end\n+    fetch_resource_without_id_validation(collection_or_uri, nil, raise_on_error: :temporary)\n   end\n \n   def filter_replies(items)\n---\n\n\n---\n\nChoice B:\n.rubocop_todo.yml\n@@ -1,6 +1,6 @@\n # This configuration was generated by\n # `rubocop --auto-gen-config --auto-gen-only-exclude --no-offense-counts --no-auto-gen-timestamp`\n-# using RuboCop version 1.75.3.\n+# using RuboCop version 1.75.7.\n # The point is for the user to remove these configuration records\n # one by one as the offenses are removed from the code base.\n # Note that changes in the inspected code, or installation of new\n@@ -69,9 +69,3 @@ Style/OptionalBooleanParameter:\n     - 'app/services/fetch_resource_service.rb'\n     - 'app/workers/domain_block_worker.rb'\n     - 'app/workers/unfollow_follow_worker.rb'\n-\n-# This cop supports safe autocorrection (--autocorrect).\n-Style/RedundantConstantBase:\n-  Exclude:\n-    - 'config/environments/production.rb'\n-    - 'config/initializers/sidekiq.rb'\n---\n\n\n---\n\nChoice C:\n.rubocop/naming.yml\n@@ -1,3 +1,6 @@\n ---\n Naming/BlockForwarding:\n   EnforcedStyle: explicit\n+\n+Naming/PredicateMethod:\n+  Enabled: false\n---\n.rubocop_todo.yml\n@@ -1,6 +1,6 @@\n # This configuration was generated by\n # `rubocop --auto-gen-config --auto-gen-only-exclude --no-offense-counts --no-auto-gen-timestamp`\n-# using RuboCop version 1.75.8.\n+# using RuboCop version 1.76.0.\n # The point is for the user to remove these configuration records\n # one by one as the offenses are removed from the code base.\n # Note that changes in the inspected code, or installation of new\n---\nGemfile.lock\n@@ -751,18 +751,18 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.8)\n+    rubocop (1.76.0)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n       parallel (~> 1.10)\n       parser (>= 3.3.0.2)\n       rainbow (>= 2.2.2, < 4.0)\n       regexp_parser (>= 2.9.3, < 3.0)\n-      rubocop-ast (>= 1.44.0, < 2.0)\n+      rubocop-ast (>= 1.45.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.1)\n+    rubocop-ast (1.45.0)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n---\napp/controllers/auth/registrations_controller.rb\n@@ -138,7 +138,7 @@ def require_rules_acceptance!\n     set_locale { render :rules }\n   end\n \n-  def is_flashing_format? # rubocop:disable Naming/PredicateName\n+  def is_flashing_format? # rubocop:disable Naming/PredicatePrefix\n     if params[:action] == 'create'\n       false # Disable flash messages for sign-up\n     else\n---\napp/models/concerns/attachmentable.rb\n@@ -22,7 +22,7 @@ module Attachmentable\n   ).freeze\n \n   included do\n-    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicateName\n+    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicatePrefix\n       super\n \n       send(:\"before_#{name}_validate\", prepend: true) do\n---\napp/models/user_settings/glue.rb\n@@ -17,7 +17,7 @@ def type_for_attribute(key)\n     self.class.definition_for(key)&.type\n   end\n \n-  def has_attribute?(key) # rubocop:disable Naming/PredicateName\n+  def has_attribute?(key) # rubocop:disable Naming/PredicatePrefix\n     self.class.definition_for?(key)\n   end\n end\n---\nconfig/initializers/1_hosts.rb\n@@ -21,7 +21,7 @@\n \n   config.x.streaming_api_base_url = ENV.fetch('STREAMING_API_BASE_URL') do\n     if Rails.env.production?\n-      \"ws#{https ? 's' : ''}://#{web_host}\"\n+      \"ws#{'s' if https}://#{web_host}\"\n     else\n       \"ws://#{host.split(':').first}:4000\"\n     end\n---\nconfig/initializers/content_security_policy.rb\n@@ -32,7 +32,7 @@\n \n   if Rails.env.development?\n     vite_public_host = ENV.fetch('VITE_DEV_SERVER_PUBLIC', \"localhost:#{ViteRuby.config.port}\")\n-    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{ViteRuby.config.https ? 's' : ''}://#{vite_public_host}\" }\n+    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{'s' if ViteRuby.config.https}://#{vite_public_host}\" }\n \n     p.connect_src :self, :data, :blob, *media_hosts, Rails.configuration.x.streaming_api_base_url, *front_end_build_urls\n     p.script_src  :self, :unsafe_inline, :unsafe_eval, assets_host\n---\nlib/mastodon/migration_warning.rb\n@@ -23,7 +23,7 @@ def migration_duration_warning(explanation = nil)\n \n     def announce_countdown\n       WARNING_SECONDS.downto(1) do |i|\n-        say \"Continuing in #{i} second#{i == 1 ? '' : 's'}...\", true\n+        say \"Continuing in #{i} second#{'s' unless i == 1}...\", true\n         sleep 1\n       end\n     end\n---\nlib/mastodon/version.rb\n@@ -75,7 +75,7 @@ def source_commit\n     end\n \n     def user_agent\n-      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{Rails.configuration.x.use_https ? 's' : ''}://#{Rails.configuration.x.web_domain}/)\"\n+      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{'s' if Rails.configuration.x.use_https}://#{Rails.configuration.x.web_domain}/)\"\n     end\n \n     def version_configuration\n---\n\n\n---\n\nChoice D:\napp/javascript/styles/mastodon/admin.scss\n@@ -3,7 +3,7 @@\n @use 'variables' as *;\n \n $no-columns-breakpoint: 890px;\n-$sidebar-width: 300px;\n+$sidebar-width: 360px;\n $content-width: 840px;\n \n .admin-wrapper {\n@@ -180,8 +180,8 @@ $content-width: 840px;\n   .content {\n     padding-top: 55px;\n     padding-bottom: 20px;\n-    padding-inline-start: 25px;\n-    padding-inline-end: 15px;\n+    padding-inline-start: 15px;\n+    padding-inline-end: 5px;\n \n     @media screen and (max-width: $no-columns-breakpoint) {\n       max-width: none;\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34468\r\nFixes MAS-404\r\n\r\n### Changes proposed in this PR:\r\n\r\n- When selecting \"Add or remove from lists\" for an account that you're not yet following, we're now displaying the \"Follow user?\" modal. If this is rejected, the list picker will not be displayed.\r\n\r\n### Screen capture:\r\n\r\nhttps://github.com/user-attachments/assets/bbf1d128-920e-48c7-84a0-28dabb909fcb\r\n\r\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -14795,8 +14795,8 @@ __metadata:\n   linkType: hard\n \n \"react-intl@npm:^7.1.10\":\n-  version: 7.1.10\n-  resolution: \"react-intl@npm:7.1.10\"\n+  version: 7.1.11\n+  resolution: \"react-intl@npm:7.1.11\"\n   dependencies:\n     \"@formatjs/ecma402-abstract\": \"npm:2.3.4\"\n     \"@formatjs/icu-messageformat-parser\": \"npm:2.11.2\"\n@@ -14812,7 +14812,7 @@ __metadata:\n   peerDependenciesMeta:\n     typescript:\n       optional: true\n-  checksum: 10c0/7d47ac7e2284eb6d920d26d5cdcfee33f54805eb27284dab969ac931139c5eacb2b24f60c8e7645a623b768d0fdfa5dfc4df63a9270301d57aa356ddf231c484\n+  checksum: 10c0/f20770fb7bcce7a67acec70b9183f5320b7f3f9bbcb263ca8f4787817297674d1be158687f94d1e2803a9c8696d4f93dd86a28898aba8bc5197e858313e3dd06\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/components/account.tsx\n@@ -11,9 +11,12 @@ import {\n   unblockAccount,\n   muteAccount,\n   unmuteAccount,\n+  followAccountSuccess,\n } from 'mastodon/actions/accounts';\n+import { showAlertForError } from 'mastodon/actions/alerts';\n import { openModal } from 'mastodon/actions/modal';\n import { initMuteModal } from 'mastodon/actions/mutes';\n+import { apiFollowAccount } from 'mastodon/api/accounts';\n import { Avatar } from 'mastodon/components/avatar';\n import { Button } from 'mastodon/components/button';\n import { FollowersCounter } from 'mastodon/components/counters';\n@@ -24,6 +27,7 @@ import { RelativeTimestamp } from 'mastodon/components/relative_timestamp';\n import { ShortNumber } from 'mastodon/components/short_number';\n import { Skeleton } from 'mastodon/components/skeleton';\n import { VerifiedBadge } from 'mastodon/components/verified_badge';\n+import { me } from 'mastodon/initial_state';\n import type { MenuItem } from 'mastodon/models/dropdown_menu';\n import { useAppSelector, useAppDispatch } from 'mastodon/store';\n \n@@ -113,14 +117,43 @@ export const Account: React.FC<{\n       ];\n     } else if (defaultAction !== 'block') {\n       const handleAddToLists = () => {\n-        dispatch(\n-          openModal({\n-            modalType: 'LIST_ADDER',\n-            modalProps: {\n-              accountId: id,\n-            },\n-          }),\n-        );\n+        const openAddToListModal = () => {\n+          dispatch(\n+            openModal({\n+              modalType: 'LIST_ADDER',\n+              modalProps: {\n+                accountId: id,\n+              },\n+            }),\n+          );\n+        };\n+        if (relationship?.following || relationship?.requested || id === me) {\n+          openAddToListModal();\n+        } else {\n+          dispatch(\n+            openModal({\n+              modalType: 'CONFIRM_FOLLOW_TO_LIST',\n+              modalProps: {\n+                accountId: id,\n+                onConfirm: () => {\n+                  apiFollowAccount(id)\n+                    .then((relationship) => {\n+                      dispatch(\n+                        followAccountSuccess({\n+                          relationship,\n+                          alreadyFollowing: false,\n+                        }),\n+                      );\n+                      openAddToListModal();\n+                    })\n+                    .catch((err: unknown) => {\n+                      dispatch(showAlertForError(err));\n+                    });\n+                },\n+              },\n+            }),\n+          );\n+        }\n       };\n \n       arr = [\n---\n\n\n---\n\nChoice C:\nspec/system/account_notes_spec.rb\n@@ -11,13 +11,13 @@\n   let(:finished_onboarding) { true }\n \n   let!(:other_account) { Fabricate(:account) }\n+  let(:note_text) { 'This is a personal note' }\n \n   before { as_a_logged_in_user }\n \n   it 'can be written and viewed' do\n     visit_profile(other_account)\n \n-    note_text = 'This is a personal note'\n     fill_in frontend_translations('account_note.placeholder'), with: note_text\n \n     # This is a bit awkward since there is no button to save the change\n---\nspec/system/new_statuses_spec.rb\n@@ -9,12 +9,12 @@\n   let(:password)            { 'password' }\n   let(:confirmed_at)        { Time.zone.now }\n   let(:finished_onboarding) { true }\n+  let(:status_text) { 'This is a new status!' }\n \n   before { as_a_logged_in_user }\n \n   it 'can be posted' do\n     visit_homepage\n-    status_text = 'This is a new status!'\n \n     within('.compose-form') do\n       fill_in frontend_translations('compose_form.placeholder'), with: status_text\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nNoticed this along with ruby 3.4.4\r\n\r\nFirst commit is bundler bump, other commit is misc small bumps (may overlap with some renovate PRs, will rebase if issue).\n\n---\n\nChoice A:\nGemfile.lock\n@@ -827,9 +827,9 @@ GEM\n       rufus-scheduler (~> 3.2)\n       sidekiq (>= 6, < 8)\n       tilt (>= 1.4.0, < 3)\n-    sidekiq-unique-jobs (8.0.10)\n+    sidekiq-unique-jobs (8.0.11)\n       concurrent-ruby (~> 1.0, >= 1.0.5)\n-      sidekiq (>= 7.0.0, < 8.0.0)\n+      sidekiq (>= 7.0.0, < 9.0.0)\n       thor (>= 1.0, < 3.0)\n     simple-navigation (4.4.0)\n       activesupport (>= 2.3.2)\n---\n\n\n---\n\nChoice B:\napp/workers/activitypub/fetch_all_replies_worker.rb\n@@ -80,7 +80,7 @@ def get_root_replies(root_status_uri, options = {})\n     root_status_body = fetch_resource(root_status_uri, true)\n     return if root_status_body.nil?\n \n-    FetchReplyWorker.perform_async(root_status_uri, { **options, prefetched_body: root_status_body })\n+    FetchReplyWorker.perform_async(root_status_uri, { **options.deep_stringify_keys, 'prefetched_body' => root_status_body })\n \n     get_replies(root_status_body, MAX_PAGES, options)\n   end\n---\nspec/workers/activitypub/fetch_all_replies_worker_spec.rb\n@@ -124,8 +124,6 @@\n \n   before do\n     stub_const('Status::FetchRepliesConcern::FETCH_REPLIES_ENABLED', true)\n-    allow(FetchReplyWorker).to receive(:push_bulk)\n-    allow(FetchReplyWorker).to receive(:perform_async)\n     all_items.each do |item|\n       next if [top_note_uri, reply_note_uri].include? item\n \n@@ -150,7 +148,7 @@\n \n     it 'fetches the top status only once' do\n       _ = subject.perform(status.id, { request_id: 0 })\n-      expect(FetchReplyWorker).to have_received(:perform_async).with(top_note_uri, { prefetched_body: top_object.deep_stringify_keys, request_id: 0 })\n+      expect(FetchReplyWorker).to have_enqueued_sidekiq_job(top_note_uri, { 'prefetched_body' => top_object.deep_stringify_keys, 'request_id' => 0 })\n       expect(a_request(:get, top_note_uri)).to have_been_made.once\n     end\n   end\n---\n\n\n---\n\nChoice C:\n.github/ISSUE_TEMPLATE/1.web_bug_report.yml\n@@ -48,24 +48,24 @@ body:\n     attributes:\n       label: Mastodon version\n       description: |\n-        This is displayed at the bottom of the About page, eg. `v4.4.0-alpha.1`\n-      placeholder: v4.3.0\n+        This is displayed at the bottom of the About page, eg. `v4.4.0-beta.1`\n+      placeholder: v4.4.0-beta.1\n     validations:\n       required: true\n   - type: input\n     attributes:\n       label: Browser name and version\n       description: |\n         What browser are you using when getting this bug? Please specify the version as well.\n-      placeholder: Firefox 131.0.0\n+      placeholder: Firefox 139.0.0\n     validations:\n       required: true\n   - type: input\n     attributes:\n       label: Operating system\n       description: |\n         What OS are you running? Please specify the version as well.\n-      placeholder: macOS 15.0.1\n+      placeholder: macOS 15.5\n     validations:\n       required: true\n   - type: textarea\n---\n.github/ISSUE_TEMPLATE/2.server_bug_report.yml\n@@ -49,8 +49,8 @@ body:\n     attributes:\n       label: Mastodon version\n       description: |\n-        This is displayed at the bottom of the About page, eg. `v4.4.0-alpha.1`\n-      placeholder: v4.3.0\n+        This is displayed at the bottom of the About page, eg. `v4.4.0-beta.1`\n+      placeholder: v4.4.0-beta.1\n     validations:\n       required: false\n   - type: textarea\n@@ -60,7 +60,7 @@ body:\n         Any additional technical details you may have, like logs or error traces\n       value: |\n         If this is happening on your own Mastodon server, please fill out those:\n-        - Ruby version: (from `ruby --version`, eg. v3.4.1)\n-        - Node.js version: (from `node --version`, eg. v20.18.0)\n+        - Ruby version: (from `ruby --version`, eg. v3.4.4)\n+        - Node.js version: (from `node --version`, eg. v22.16.0)\n     validations:\n       required: false\n---\n.github/ISSUE_TEMPLATE/3.troubleshooting.yml\n@@ -50,7 +50,7 @@ body:\n       label: Mastodon version\n       description: |\n         This is displayed at the bottom of the About page, eg. `v4.4.0-alpha.1`\n-      placeholder: v4.3.0\n+      placeholder: v4.4.0-beta.1\n     validations:\n       required: false\n   - type: textarea\n@@ -60,9 +60,9 @@ body:\n         Details about your environment, like how Mastodon is deployed, if containers are used, version numbers, etc.\n       value: |\n         Please at least include those informations:\n-        - Operating system: (eg. Ubuntu 22.04)\n-        - Ruby version: (from `ruby --version`, eg. v3.4.1)\n-        - Node.js version: (from `node --version`, eg. v20.18.0)\n+        - Operating system: (eg. Ubuntu 24.04.2)\n+        - Ruby version: (from `ruby --version`, eg. v3.4.4)\n+        - Node.js version: (from `node --version`, eg. v22.16.0)\n     validations:\n       required: false\n   - type: textarea\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -94,7 +94,7 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n+    aws-partitions (1.1103.0)\n     aws-sdk-core (3.215.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n@@ -109,7 +109,7 @@ GEM\n       aws-sigv4 (~> 1.5)\n     aws-sigv4 (1.11.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n-    azure-blob (0.5.7)\n+    azure-blob (0.5.8)\n       rexml\n     base64 (0.2.0)\n     bcp47_spec (0.2.1)\n@@ -124,7 +124,7 @@ GEM\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n-    bootsnap (1.18.5)\n+    bootsnap (1.18.6)\n       msgpack (~> 1.2)\n     brakeman (7.0.2)\n       racc\n@@ -194,7 +194,7 @@ GEM\n     devise_pam_authenticatable2 (9.2.0)\n       devise (>= 4.0.0)\n       rpam2 (~> 4.0)\n-    diff-lcs (1.6.1)\n+    diff-lcs (1.6.2)\n     discard (1.4.0)\n       activerecord (>= 4.2, < 9.0)\n     docile (1.4.1)\n@@ -228,7 +228,7 @@ GEM\n     fabrication (2.31.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n-    faraday (2.13.0)\n+    faraday (2.13.1)\n       faraday-net_http (>= 2.0, < 3.5)\n       json\n       logger\n@@ -267,10 +267,10 @@ GEM\n       raabro (~> 1.4)\n     globalid (1.2.1)\n       activesupport (>= 6.1)\n-    google-protobuf (4.30.2)\n+    google-protobuf (4.31.0)\n       bigdecimal\n       rake (>= 13)\n-    googleapis-common-protos-types (1.19.0)\n+    googleapis-common-protos-types (1.20.0)\n       google-protobuf (>= 3.18, < 5.a)\n     haml (6.3.0)\n       temple (>= 0.8.2)\n@@ -338,7 +338,7 @@ GEM\n       azure-blob (~> 0.5.2)\n       hashie (~> 5.0)\n     jmespath (1.6.2)\n-    json (2.10.2)\n+    json (2.12.0)\n     json-canonicalization (1.0.0)\n     json-jwt (1.16.7)\n       activesupport (>= 4.2)\n@@ -411,7 +411,7 @@ GEM\n       activesupport (>= 4)\n       railties (>= 4)\n       request_store (~> 1.0)\n-    loofah (2.24.0)\n+    loofah (2.24.1)\n       crass (~> 1.0.2)\n       nokogiri (>= 1.12.0)\n     mail (2.8.1)\n@@ -427,9 +427,9 @@ GEM\n     mime-types (3.7.0)\n       logger\n       mime-types-data (~> 3.2025, >= 3.2025.0507)\n-    mime-types-data (3.2025.0507)\n+    mime-types-data (3.2025.0514)\n     mini_mime (1.1.5)\n-    mini_portile2 (2.8.8)\n+    mini_portile2 (2.8.9)\n     minitest (5.25.5)\n     msgpack (1.8.0)\n     multi_json (1.15.0)\n@@ -504,7 +504,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-active_support (~> 0.7)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-action_pack (0.12.0)\n+    opentelemetry-instrumentation-action_pack (0.12.1)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n       opentelemetry-instrumentation-rack (~> 0.21)\n@@ -618,7 +618,7 @@ GEM\n       activesupport (>= 7.0.0)\n       rack\n       railties (>= 7.0.0)\n-    psych (5.2.3)\n+    psych (5.2.6)\n       date\n       stringio\n     public_suffix (6.0.2)\n@@ -710,7 +710,7 @@ GEM\n       railties (>= 5.2)\n     rexml (3.4.1)\n     rotp (6.3.0)\n-    rouge (4.5.1)\n+    rouge (4.5.2)\n     rpam2 (4.0.2)\n     rqrcode (3.1.0)\n       chunky_png (~> 1.0)\n@@ -727,7 +727,7 @@ GEM\n       rspec-support (~> 3.13.0)\n     rspec-github (3.0.0)\n       rspec-core (~> 3.0)\n-    rspec-mocks (3.13.3)\n+    rspec-mocks (3.13.4)\n       diff-lcs (>= 1.2.0, < 2.0)\n       rspec-support (~> 3.13.0)\n     rspec-rails (8.0.0)\n@@ -1092,4 +1092,4 @@ RUBY VERSION\n    ruby 3.4.1p0\n \n BUNDLED WITH\n-   2.6.8\n+   2.6.9\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Type | Update | Change |\n|---|---|---|---|\n| docker.io/ruby |  | patch | `3.4.3` -> `3.4.4` |\n| docker.io/ruby | final | patch | `3.4.3-slim-bookworm` -> `3.4.4-slim-bookworm` |\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about these updates again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS4xOCIsInVwZGF0ZWRJblZlciI6IjQwLjExLjE4IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJkb2NrZXIiXX0=-->\n\n\n---\n\nChoice A:\n.nvmrc\n@@ -1 +1 @@\n-22.15\n+22.16\n---\n\n\n---\n\nChoice B:\nDockerfile\n@@ -13,7 +13,7 @@ ARG BASE_REGISTRY=\"docker.io\"\n \n # Ruby image to use for base image, change with [--build-arg RUBY_VERSION=\"3.4.x\"]\n # renovate: datasource=docker depName=docker.io/ruby\n-ARG RUBY_VERSION=\"3.4.3\"\n+ARG RUBY_VERSION=\"3.4.4\"\n # # Node.js version to use in base image, change with [--build-arg NODE_MAJOR_VERSION=\"20\"]\n # renovate: datasource=node-version depName=node\n ARG NODE_MAJOR_VERSION=\"22\"\n---\n\n\n---\n\nChoice C:\napp/lib/activitypub/parser/status_parser.rb\n@@ -95,11 +95,11 @@ def language\n   end\n \n   def favourites_count\n-    @object.dig('likes', 'totalItems')\n+    @object.dig('likes', 'totalItems') if @object.is_a?(Hash)\n   end\n \n   def reblogs_count\n-    @object.dig('shares', 'totalItems')\n+    @object.dig('shares', 'totalItems') if @object.is_a?(Hash)\n   end\n \n   def quote_policy\n---\nspec/lib/activitypub/activity/create_spec.rb\n@@ -20,7 +20,7 @@\n       type: 'Create',\n       actor: ActivityPub::TagManager.instance.uri_for(sender),\n       object: object_json,\n-    }.with_indifferent_access\n+    }.deep_stringify_keys\n   end\n \n   before do\n@@ -102,7 +102,7 @@ def activity_for_object(json)\n         type: 'Create',\n         actor: ActivityPub::TagManager.instance.uri_for(sender),\n         object: json,\n-      }.with_indifferent_access\n+      }.deep_stringify_keys\n     end\n \n     before do\n@@ -1076,7 +1076,7 @@ def activity_for_object(json)\n           type: 'Create',\n           actor: ActivityPub::TagManager.instance.uri_for(sender),\n           object: Addressable::URI.new(scheme: 'bear', query_values: { t: token, u: object_json[:id] }).to_s,\n-        }.with_indifferent_access\n+        }.deep_stringify_keys\n       end\n \n       let(:object_json) do\n---\nspec/lib/activitypub/parser/status_parser_spec.rb\n@@ -16,7 +16,7 @@\n       type: 'Create',\n       actor: ActivityPub::TagManager.instance.uri_for(sender),\n       object: object_json,\n-    }.with_indifferent_access\n+    }.deep_stringify_keys\n   end\n \n   let(:object_json) do\n---\n\n\n---\n\nChoice D:\n.env.production.sample\n@@ -43,7 +43,6 @@ ES_PASS=password\n # Make sure to use `bundle exec rails secret` to generate secrets\n # -------\n SECRET_KEY_BASE=\n-OTP_SECRET=\n \n # Encryption secrets\n # ------------------\n---\napp.json\n@@ -17,10 +17,6 @@\n       \"description\": \"The secret key base\",\n       \"generator\": \"secret\"\n     },\n-    \"OTP_SECRET\": {\n-      \"description\": \"One-time password secret\",\n-      \"generator\": \"secret\"\n-    },\n     \"SINGLE_USER_MODE\": {\n       \"description\": \"Should the instance run in single user mode? (Disable registrations, redirect to front page)\",\n       \"value\": \"false\",\n---\nlib/tasks/mastodon.rake\n@@ -32,7 +32,7 @@ namespace :mastodon do\n       prompt.say('Single user mode disables registrations and redirects the landing page to your public profile.')\n       env['SINGLE_USER_MODE'] = prompt.yes?('Do you want to enable single user mode?', default: false)\n \n-      %w(SECRET_KEY_BASE OTP_SECRET).each do |key|\n+      %w(SECRET_KEY_BASE).each do |key|\n         env[key] = SecureRandom.hex(64)\n       end\n \n---\nscalingo.json\n@@ -12,10 +12,6 @@\n       \"description\": \"The secret key base\",\n       \"generator\": \"secret\"\n     },\n-    \"OTP_SECRET\": {\n-      \"description\": \"One-time password secret\",\n-      \"generator\": \"secret\"\n-    },\n     \"SINGLE_USER_MODE\": {\n       \"description\": \"Should the instance run in single user mode? (Disable registrations, redirect to front page)\",\n       \"value\": \"false\",\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rubocop](https://rubocop.org/) ([source](https://redirect.github.com/rubocop/rubocop), [changelog](https://redirect.github.com/rubocop/rubocop/releases/tag/v1.75.6)) | `1.75.5` -> `1.75.6` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rubocop/1.75.6?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rubocop/1.75.6?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rubocop/1.75.5/1.75.6?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rubocop/1.75.5/1.75.6?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>rubocop/rubocop (rubocop)</summary>\n\n### [`v1.75.6`](https://redirect.github.com/rubocop/rubocop/blob/HEAD/CHANGELOG.md#1756-2025-05-15)\n\n[Compare Source](https://redirect.github.com/rubocop/rubocop/compare/v1.75.5...v1.75.6)\n\n##### Bug fixes\n\n-   [#&#8203;14176](https://redirect.github.com/rubocop/rubocop/pull/14176): Fix an error for `Style/MultilineIfModifier` when using nested modifier. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14077](https://redirect.github.com/rubocop/rubocop/issues/14077): Change `nil` representation in todo file comments. (\\[[@&#8203;jonas054](https://redirect.github.com/jonas054)]\\[])\n-   [#&#8203;14164](https://redirect.github.com/rubocop/rubocop/pull/14164): Fix an error for `Lint/UselessAssignment` when variables are assigned using unary operator in chained assignment and remain unreferenced. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14173](https://redirect.github.com/rubocop/rubocop/pull/14173): Fix an error for `Style/StringConcatenation` when using implicit concatenation with string interpolation. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14177](https://redirect.github.com/rubocop/rubocop/issues/14177): Fix false positives for `Style/SoleNestedConditional` when using nested `if` and `not` in condition. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14152](https://redirect.github.com/rubocop/rubocop/pull/14152): Fix `Layout/SpaceInsideArrayLiteralBrackets` cop error on array pattern without brackets. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14153](https://redirect.github.com/rubocop/rubocop/pull/14153): Fix `Style/PercentQLiterals` cop error on Unicode escape sequence. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n\n##### Changes\n\n-   [#&#8203;14082](https://redirect.github.com/rubocop/rubocop/issues/14082): Mark `Style/ComparableBetween` as unsafe. (\\[[@&#8203;earlopain](https://redirect.github.com/earlopain)]\\[])\n-   [#&#8203;14181](https://redirect.github.com/rubocop/rubocop/issues/14181): Make `Lint/DuplicateMethods` aware of Active Support's `delegate` method. (\\[[@&#8203;lovro-bikic](https://redirect.github.com/lovro-bikic)]\\[])\n-   [#&#8203;14156](https://redirect.github.com/rubocop/rubocop/issues/14156): Make `Style/IfUnlessModifier` allow endless method definition in the `if` body. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS4xOCIsInVwZGF0ZWRJblZlciI6IjQwLjExLjE4IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\napp/controllers/api/v1/lists_controller.rb\n@@ -7,10 +7,6 @@ class Api::V1::ListsController < Api::BaseController\n   before_action :require_user!\n   before_action :set_list, except: [:index, :create]\n \n-  rescue_from ArgumentError do |e|\n-    render json: { error: e.to_s }, status: 422\n-  end\n-\n   def index\n     @lists = List.where(account: current_account).all\n     render json: @lists, each_serializer: REST::ListSerializer\n---\napp/models/list.rb\n@@ -18,7 +18,7 @@ class List < ApplicationRecord\n \n   PER_ACCOUNT_LIMIT = 50\n \n-  enum :replies_policy, { list: 0, followed: 1, none: 2 }, prefix: :show\n+  enum :replies_policy, { list: 0, followed: 1, none: 2 }, prefix: :show, validate: true\n \n   belongs_to :account\n \n---\nspec/requests/api/v1/lists_spec.rb\n@@ -132,9 +132,12 @@\n       it 'returns http unprocessable entity' do\n         subject\n \n-        expect(response).to have_http_status(422)\n+        expect(response)\n+          .to have_http_status(422)\n         expect(response.content_type)\n           .to start_with('application/json')\n+        expect(response.parsed_body)\n+          .to include(error: /Replies policy is not included/)\n       end\n     end\n   end\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -381,7 +381,7 @@ GEM\n       marcel (~> 1.0.1)\n       mime-types\n       terrapin (>= 0.6.0, < 2.0)\n-    language_server-protocol (3.17.0.4)\n+    language_server-protocol (3.17.0.5)\n     launchy (3.1.1)\n       addressable (~> 2.8)\n       childprocess (~> 5.0)\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.5)\n+    rubocop (1.75.6)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -110,7 +110,7 @@ group :opentelemetry do\n   gem 'opentelemetry-instrumentation-active_model_serializers', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-concurrent_ruby', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-excon', '~> 0.23.0', require: false\n-  gem 'opentelemetry-instrumentation-faraday', '~> 0.26.0', require: false\n+  gem 'opentelemetry-instrumentation-faraday', '~> 0.27.0', require: false\n   gem 'opentelemetry-instrumentation-http', '~> 0.24.0', require: false\n   gem 'opentelemetry-instrumentation-http_client', '~> 0.23.0', require: false\n   gem 'opentelemetry-instrumentation-net_http', '~> 0.23.0', require: false\n---\nGemfile.lock\n@@ -544,7 +544,7 @@ GEM\n     opentelemetry-instrumentation-excon (0.23.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-faraday (0.26.0)\n+    opentelemetry-instrumentation-faraday (0.27.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n     opentelemetry-instrumentation-http (0.24.0)\n@@ -1026,7 +1026,7 @@ DEPENDENCIES\n   opentelemetry-instrumentation-active_model_serializers (~> 0.22.0)\n   opentelemetry-instrumentation-concurrent_ruby (~> 0.22.0)\n   opentelemetry-instrumentation-excon (~> 0.23.0)\n-  opentelemetry-instrumentation-faraday (~> 0.26.0)\n+  opentelemetry-instrumentation-faraday (~> 0.27.0)\n   opentelemetry-instrumentation-http (~> 0.24.0)\n   opentelemetry-instrumentation-http_client (~> 0.23.0)\n   opentelemetry-instrumentation-net_http (~> 0.23.0)\n---\n\n\n---\n\nChoice D:\nspec/lib/activitypub/activity/create_spec.rb\n@@ -958,8 +958,7 @@ def activity_for_object(json)\n             '@context': [\n               'https://www.w3.org/ns/activitystreams',\n               {\n-                toot: 'http://joinmastodon.org/ns#',\n-                QuoteAuthorization: 'toot:QuoteAuthorization',\n+                QuoteAuthorization: 'https://w3id.org/fep/044f#QuoteAuthorization',\n                 gts: 'https://gotosocial.org/ns#',\n                 interactionPolicy: {\n                   '@id': 'gts:interactionPolicy',\n---\nspec/services/activitypub/process_status_update_service_spec.rb\n@@ -469,8 +469,7 @@\n         '@context': [\n           'https://www.w3.org/ns/activitystreams',\n           {\n-            toot: 'http://joinmastodon.org/ns#',\n-            QuoteAuthorization: 'toot:QuoteAuthorization',\n+            QuoteAuthorization: 'https://w3id.org/fep/044f#QuoteAuthorization',\n             gts: 'https://gotosocial.org/ns#',\n             interactionPolicy: {\n               '@id': 'gts:interactionPolicy',\n@@ -569,8 +568,7 @@\n         '@context': [\n           'https://www.w3.org/ns/activitystreams',\n           {\n-            toot: 'http://joinmastodon.org/ns#',\n-            QuoteAuthorization: 'toot:QuoteAuthorization',\n+            QuoteAuthorization: 'https://w3id.org/fep/044f#QuoteAuthorization',\n             gts: 'https://gotosocial.org/ns#',\n             interactionPolicy: {\n               '@id': 'gts:interactionPolicy',\n@@ -721,8 +719,7 @@\n         '@context': [\n           'https://www.w3.org/ns/activitystreams',\n           {\n-            toot: 'http://joinmastodon.org/ns#',\n-            QuoteAuthorization: 'toot:QuoteAuthorization',\n+            QuoteAuthorization: 'https://w3id.org/fep/044f#QuoteAuthorization',\n             gts: 'https://gotosocial.org/ns#',\n             interactionPolicy: {\n               '@id': 'gts:interactionPolicy',\n@@ -792,8 +789,7 @@\n         '@context': [\n           'https://www.w3.org/ns/activitystreams',\n           {\n-            toot: 'http://joinmastodon.org/ns#',\n-            QuoteAuthorization: 'toot:QuoteAuthorization',\n+            QuoteAuthorization: 'https://w3id.org/fep/044f#QuoteAuthorization',\n             gts: 'https://gotosocial.org/ns#',\n             interactionPolicy: {\n               '@id': 'gts:interactionPolicy',\n---\nspec/services/activitypub/verify_quote_service_spec.rb\n@@ -50,8 +50,7 @@\n         '@context': [\n           'https://www.w3.org/ns/activitystreams',\n           {\n-            toot: 'http://joinmastodon.org/ns#',\n-            QuoteAuthorization: 'toot:QuoteAuthorization',\n+            QuoteAuthorization: 'https://w3id.org/fep/044f#QuoteAuthorization',\n             gts: 'https://gotosocial.org/ns#',\n             interactionPolicy: {\n               '@id': 'gts:interactionPolicy',\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| bootsnap | `1.18.5` -> `1.18.6` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/bootsnap/1.18.6?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/bootsnap/1.18.6?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/bootsnap/1.18.5/1.18.6?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/bootsnap/1.18.5/1.18.6?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS4xOCIsInVwZGF0ZWRJblZlciI6IjQwLjExLjE4IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -7274,10 +7274,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"decimal.js@npm:^10.4.2, decimal.js@npm:^10.4.3\":\n-  version: 10.4.3\n-  resolution: \"decimal.js@npm:10.4.3\"\n-  checksum: 10c0/6d60206689ff0911f0ce968d40f163304a6c1bc739927758e6efc7921cfa630130388966f16bf6ef6b838cb33679fbe8e7a78a2f3c478afce841fd55ac8fb8ee\n+\"decimal.js@npm:^10.4.2, decimal.js@npm:^10.4.3, decimal.js@npm:^10.5.0\":\n+  version: 10.5.0\n+  resolution: \"decimal.js@npm:10.5.0\"\n+  checksum: 10c0/785c35279df32762143914668df35948920b6c1c259b933e0519a69b7003fc0a5ed2a766b1e1dda02574450c566b21738a45f15e274b47c2ac02072c0d1f3ac3\n   languageName: node\n   linkType: hard\n \n@@ -8996,7 +8996,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"form-data@npm:^4.0.0, form-data@npm:^4.0.1\":\n+\"form-data@npm:^4.0.0\":\n   version: 4.0.1\n   resolution: \"form-data@npm:4.0.1\"\n   dependencies:\n@@ -11373,13 +11373,12 @@ __metadata:\n   linkType: hard\n \n \"jsdom@npm:^26.0.0\":\n-  version: 26.0.0\n-  resolution: \"jsdom@npm:26.0.0\"\n+  version: 26.1.0\n+  resolution: \"jsdom@npm:26.1.0\"\n   dependencies:\n     cssstyle: \"npm:^4.2.1\"\n     data-urls: \"npm:^5.0.0\"\n-    decimal.js: \"npm:^10.4.3\"\n-    form-data: \"npm:^4.0.1\"\n+    decimal.js: \"npm:^10.5.0\"\n     html-encoding-sniffer: \"npm:^4.0.0\"\n     http-proxy-agent: \"npm:^7.0.2\"\n     https-proxy-agent: \"npm:^7.0.6\"\n@@ -11389,20 +11388,20 @@ __metadata:\n     rrweb-cssom: \"npm:^0.8.0\"\n     saxes: \"npm:^6.0.0\"\n     symbol-tree: \"npm:^3.2.4\"\n-    tough-cookie: \"npm:^5.0.0\"\n+    tough-cookie: \"npm:^5.1.1\"\n     w3c-xmlserializer: \"npm:^5.0.0\"\n     webidl-conversions: \"npm:^7.0.0\"\n     whatwg-encoding: \"npm:^3.1.1\"\n     whatwg-mimetype: \"npm:^4.0.0\"\n-    whatwg-url: \"npm:^14.1.0\"\n+    whatwg-url: \"npm:^14.1.1\"\n     ws: \"npm:^8.18.0\"\n     xml-name-validator: \"npm:^5.0.0\"\n   peerDependencies:\n     canvas: ^3.0.0\n   peerDependenciesMeta:\n     canvas:\n       optional: true\n-  checksum: 10c0/e48725ba4027edcfc9bca5799eaec72c6561ecffe3675a8ff87fe9c3541ca4ff9f82b4eff5b3d9c527302da0d859b2f60e9364347a5d42b77f5c76c436c569dc\n+  checksum: 10c0/5b14a5bc32ce077a06fb42d1ab95b1191afa5cbbce8859e3b96831c5143becbbcbf0511d4d4934e922d2901443ced2cdc3b734c1cf30b5f73b3e067ce457d0f4\n   languageName: node\n   linkType: hard\n \n@@ -17446,12 +17445,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"tough-cookie@npm:^5.0.0\":\n-  version: 5.0.0\n-  resolution: \"tough-cookie@npm:5.0.0\"\n+\"tough-cookie@npm:^5.1.1\":\n+  version: 5.1.2\n+  resolution: \"tough-cookie@npm:5.1.2\"\n   dependencies:\n     tldts: \"npm:^6.1.32\"\n-  checksum: 10c0/4a69c885bf6f45c5a64e60262af99e8c0d58a33bd3d0ce5da62121eeb9c00996d0128a72df8fc4614cbde59cc8b70aa3e21e4c3c98c2bbde137d7aba7fa00124\n+  checksum: 10c0/5f95023a47de0f30a902bba951664b359725597d8adeabc66a0b93a931c3af801e1e697dae4b8c21a012056c0ea88bd2bf4dfe66b2adcf8e2f42cd9796fe0626\n   languageName: node\n   linkType: hard\n \n@@ -17480,12 +17479,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"tr46@npm:^5.0.0\":\n-  version: 5.0.0\n-  resolution: \"tr46@npm:5.0.0\"\n+\"tr46@npm:^5.1.0\":\n+  version: 5.1.0\n+  resolution: \"tr46@npm:5.1.0\"\n   dependencies:\n     punycode: \"npm:^2.3.1\"\n-  checksum: 10c0/1521b6e7bbc8adc825c4561480f9fe48eb2276c81335eed9fa610aa4c44a48a3221f78b10e5f18b875769eb3413e30efbf209ed556a17a42aa8d690df44b7bee\n+  checksum: 10c0/d761f7144e0cb296187674ef245c74f761e334d7cf25ca73ef60e4c72c097c75051031c093fa1a2fee04b904977b316716a7915854bcae8fb1a371746513cbe8\n   languageName: node\n   linkType: hard\n \n@@ -18520,13 +18519,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"whatwg-url@npm:^14.0.0, whatwg-url@npm:^14.1.0\":\n-  version: 14.1.0\n-  resolution: \"whatwg-url@npm:14.1.0\"\n+\"whatwg-url@npm:^14.0.0, whatwg-url@npm:^14.1.1\":\n+  version: 14.2.0\n+  resolution: \"whatwg-url@npm:14.2.0\"\n   dependencies:\n-    tr46: \"npm:^5.0.0\"\n+    tr46: \"npm:^5.1.0\"\n     webidl-conversions: \"npm:^7.0.0\"\n-  checksum: 10c0/f00104f1c67ce086ba8ffedab529cbbd9aefd8c0a6555320026de7aeff31f91c38680f95818b140a7c9cc657cde3781e567835dda552ddb1e2b8faaba0ac3cb6\n+  checksum: 10c0/f746fc2f4c906607d09537de1227b13f9494c171141e5427ed7d2c0dd0b6a48b43d8e71abaae57d368d0c06b673fd8ec63550b32ad5ed64990c7b0266c2b4272\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\n.rubocop_todo.yml\n@@ -27,10 +27,6 @@ Metrics/CyclomaticComplexity:\n Metrics/PerceivedComplexity:\n   Max: 27\n \n-Rails/OutputSafety:\n-  Exclude:\n-    - 'config/initializers/simple_form.rb'\n-\n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: AllowedVars.\n Style/FetchEnvVar:\n---\nconfig/initializers/simple_form.rb\n@@ -5,7 +5,7 @@\n module AppendComponent\n   def append(_wrapper_options = nil)\n     @append ||= begin\n-      options[:append].to_s.html_safe if options[:append].present?\n+      options[:append].to_s.html_safe if options[:append].present? # rubocop:disable Rails/OutputSafety\n     end\n   end\n end\n@@ -24,7 +24,7 @@ def recommended(_wrapper_options = nil)\n module WarningHintComponent\n   def warning_hint(_wrapper_options = nil)\n     @warning_hint ||= begin\n-      options[:warning_hint].to_s.html_safe if options[:warning_hint].present?\n+      options[:warning_hint].to_s.html_safe if options[:warning_hint].present? # rubocop:disable Rails/OutputSafety\n     end\n   end\n end\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -124,7 +124,7 @@ GEM\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n-    bootsnap (1.18.5)\n+    bootsnap (1.18.6)\n       msgpack (~> 1.2)\n     brakeman (7.0.2)\n       racc\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -74,7 +74,7 @@ gem 'premailer-rails'\n gem 'public_suffix', '~> 6.0'\n gem 'pundit', '~> 2.3'\n gem 'rack-attack', '~> 6.6'\n-gem 'rack-cors', '~> 2.0', require: 'rack/cors'\n+gem 'rack-cors', require: 'rack/cors'\n gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n---\nGemfile.lock\n@@ -636,8 +636,9 @@ GEM\n     rack (3.1.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n-    rack-cors (2.0.2)\n-      rack (>= 2.0.0)\n+    rack-cors (3.0.0)\n+      logger\n+      rack (>= 3.0.14)\n     rack-oauth2 (2.2.1)\n       activesupport\n       attr_required\n@@ -1046,7 +1047,7 @@ DEPENDENCIES\n   puma (~> 6.3)\n   pundit (~> 2.3)\n   rack-attack (~> 6.6)\n-  rack-cors (~> 2.0)\n+  rack-cors\n   rack-test (~> 2.1)\n   rails (~> 8.0)\n   rails-i18n (~> 8.0)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFollow-up to #34615\r\n\r\nThe reason this wasn't caught in tests despite our use of `Sidekiq.strict_args!` is that `#perform_async` was stubbed by the spec.\n\n---\n\nChoice A:\n.rubocop_todo.yml\n@@ -39,15 +39,6 @@ Style/FetchEnvVar:\n     - 'config/initializers/paperclip.rb'\n     - 'lib/tasks/repo.rake'\n \n-# This cop supports safe autocorrection (--autocorrect).\n-# Configuration parameters: EnforcedStyle, MaxUnannotatedPlaceholdersAllowed, Mode, AllowedMethods, AllowedPatterns.\n-# SupportedStyles: annotated, template, unannotated\n-# AllowedMethods: redirect\n-Style/FormatStringToken:\n-  Exclude:\n-    - 'config/initializers/devise.rb'\n-    - 'lib/paperclip/color_extractor.rb'\n-\n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: MinBodyLength, AllowConsecutiveConditionals.\n Style/GuardClause:\n---\nconfig/initializers/devise.rb\n@@ -394,7 +394,7 @@ def session_cookie\n     config.ldap_uid            = ENV.fetch('LDAP_UID', 'cn')\n     config.ldap_mail           = ENV.fetch('LDAP_MAIL', 'mail')\n     config.ldap_tls_no_verify  = ENV['LDAP_TLS_NO_VERIFY'] == 'true'\n-    config.ldap_search_filter  = ENV.fetch('LDAP_SEARCH_FILTER', '(|(%{uid}=%{email})(%{mail}=%{email}))')\n+    config.ldap_search_filter  = ENV.fetch('LDAP_SEARCH_FILTER', '(|(%<uid>s=%<email>s)(%<mail>s=%<email>s))')\n     config.ldap_uid_conversion_enabled  = ENV['LDAP_UID_CONVERSION_ENABLED'] == 'true'\n     config.ldap_uid_conversion_search   = ENV.fetch('LDAP_UID_CONVERSION_SEARCH', '.,- ')\n     config.ldap_uid_conversion_replace  = ENV.fetch('LDAP_UID_CONVERSION_REPLACE', '_')\n---\nlib/paperclip/color_extractor.rb\n@@ -239,7 +239,7 @@ def palette_from_im_histogram(result, quantity)\n     end\n \n     def rgb_to_hex(rgb)\n-      format('#%02x%02x%02x', rgb.r, rgb.g, rgb.b)\n+      format('#%02x%02x%02x', rgb.r, rgb.g, rgb.b) # rubocop:disable Style/FormatStringToken\n     end\n   end\n end\n---\n\n\n---\n\nChoice B:\npackage.json\n@@ -64,7 +64,6 @@\n     \"emoji-mart\": \"npm:emoji-mart-lazyload@latest\",\n     \"escape-html\": \"^1.0.3\",\n     \"fuzzysort\": \"^3.0.0\",\n-    \"glob\": \"^10.2.6\",\n     \"history\": \"^4.10.1\",\n     \"hoist-non-react-statics\": \"^3.3.2\",\n     \"http-link-header\": \"^1.1.1\",\n---\nyarn.lock\n@@ -2514,7 +2514,6 @@ __metadata:\n     eslint-plugin-react: \"npm:^7.37.4\"\n     eslint-plugin-react-hooks: \"npm:^5.2.0\"\n     fuzzysort: \"npm:^3.0.0\"\n-    glob: \"npm:^10.2.6\"\n     globals: \"npm:^16.0.0\"\n     history: \"npm:^4.10.1\"\n     hoist-non-react-statics: \"npm:^3.3.2\"\n@@ -6919,7 +6918,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"glob@npm:^10.2.2, glob@npm:^10.2.6, glob@npm:^10.3.10\":\n+\"glob@npm:^10.2.2, glob@npm:^10.3.10\":\n   version: 10.4.5\n   resolution: \"glob@npm:10.4.5\"\n   dependencies:\n---\n\n\n---\n\nChoice C:\napp/workers/activitypub/fetch_all_replies_worker.rb\n@@ -80,7 +80,7 @@ def get_root_replies(root_status_uri, options = {})\n     root_status_body = fetch_resource(root_status_uri, true)\n     return if root_status_body.nil?\n \n-    FetchReplyWorker.perform_async(root_status_uri, { **options, prefetched_body: root_status_body })\n+    FetchReplyWorker.perform_async(root_status_uri, { **options.deep_stringify_keys, 'prefetched_body' => root_status_body })\n \n     get_replies(root_status_body, MAX_PAGES, options)\n   end\n---\nspec/workers/activitypub/fetch_all_replies_worker_spec.rb\n@@ -124,8 +124,6 @@\n \n   before do\n     stub_const('Status::FetchRepliesConcern::FETCH_REPLIES_ENABLED', true)\n-    allow(FetchReplyWorker).to receive(:push_bulk)\n-    allow(FetchReplyWorker).to receive(:perform_async)\n     all_items.each do |item|\n       next if [top_note_uri, reply_note_uri].include? item\n \n@@ -150,7 +148,7 @@\n \n     it 'fetches the top status only once' do\n       _ = subject.perform(status.id, { request_id: 0 })\n-      expect(FetchReplyWorker).to have_received(:perform_async).with(top_note_uri, { prefetched_body: top_object.deep_stringify_keys, request_id: 0 })\n+      expect(FetchReplyWorker).to have_enqueued_sidekiq_job(top_note_uri, { 'prefetched_body' => top_object.deep_stringify_keys, 'request_id' => 0 })\n       expect(a_request(:get, top_note_uri)).to have_been_made.once\n     end\n   end\n---\n\n\n---\n\nChoice D:\napp/helpers/context_helper.rb\n@@ -26,6 +26,13 @@ module ContextHelper\n     suspended: { 'toot' => 'http://joinmastodon.org/ns#', 'suspended' => 'toot:suspended' },\n     attribution_domains: { 'toot' => 'http://joinmastodon.org/ns#', 'attributionDomains' => { '@id' => 'toot:attributionDomains', '@type' => '@id' } },\n     quote_requests: { 'QuoteRequest' => 'https://w3id.org/fep/044f#QuoteRequest' },\n+    interaction_policies: {\n+      'gts' => 'https://gotosocial.org/ns#',\n+      'interactionPolicy' => { '@id' => 'gts:interactionPolicy', '@type' => '@id' },\n+      'canQuote' => { '@id' => 'gts:canQuote', '@type' => '@id' },\n+      'automaticApproval' => { '@id' => 'gts:automaticApproval', '@type' => '@id' },\n+      'manualApproval' => { '@id' => 'gts:manualApproval', '@type' => '@id' },\n+    },\n   }.freeze\n \n   def full_context\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34696\n\n---\n\nChoice A:\n.github/renovate.json5\n@@ -39,7 +39,6 @@\n       // Require Dependency Dashboard Approval for major version bumps of these Ruby packages\n       matchManagers: ['bundler'],\n       matchPackageNames: [\n-        'rack', // Needs to be synced with Rails version\n         'strong_migrations', // Requires manual upgrade\n         'sidekiq', // Requires manual upgrade\n         'sidekiq-unique-jobs', // Requires manual upgrades and sync with Sidekiq version\n---\nGemfile\n@@ -5,7 +5,6 @@ ruby '>= 3.2.0', '< 3.5.0'\n \n gem 'propshaft'\n gem 'puma', '~> 6.3'\n-gem 'rack', '~> 2.2.7'\n gem 'rails', '~> 8.0'\n gem 'thor', '~> 1.2'\n \n---\nGemfile.lock\n@@ -633,7 +633,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.16)\n+    rack (3.1.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -645,18 +645,19 @@ GEM\n       faraday-follow_redirects\n       json-jwt (>= 1.11.0)\n       rack (>= 2.1.0)\n-    rack-protection (3.2.0)\n+    rack-protection (4.1.1)\n       base64 (>= 0.1.0)\n-      rack (~> 2.2, >= 2.2.4)\n+      logger (>= 1.6.0)\n+      rack (>= 3.0.0, < 4)\n     rack-proxy (0.7.7)\n       rack\n-    rack-session (1.0.2)\n-      rack (< 3)\n+    rack-session (2.1.1)\n+      base64 (>= 0.1.0)\n+      rack (>= 3.0.0)\n     rack-test (2.2.0)\n       rack (>= 1.3)\n-    rackup (1.0.1)\n-      rack (< 3)\n-      webrick\n+    rackup (2.2.1)\n+      rack (>= 3)\n     rails (8.0.2)\n       actioncable (= 8.0.2)\n       actionmailbox (= 8.0.2)\n@@ -1044,7 +1045,6 @@ DEPENDENCIES\n   public_suffix (~> 6.0)\n   puma (~> 6.3)\n   pundit (~> 2.3)\n-  rack (~> 2.2.7)\n   rack-attack (~> 6.6)\n   rack-cors (~> 2.0)\n   rack-test (~> 2.1)\n---\nconfig/initializers/mime_types.rb\n@@ -2,6 +2,3 @@\n \n Mime::Type.register 'application/json', :json, %w(text/x-json application/jsonrequest application/jrd+json application/activity+json application/ld+json)\n Mime::Type.register 'text/xml',         :xml,  %w(application/xml application/atom+xml application/xrd+xml)\n-\n-# WebP is not defined in Rack 2.2.\n-Rack::Mime::MIME_TYPES['.webp'] = 'image/webp'\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -381,7 +381,7 @@ GEM\n       marcel (~> 1.0.1)\n       mime-types\n       terrapin (>= 0.6.0, < 2.0)\n-    language_server-protocol (3.17.0.4)\n+    language_server-protocol (3.17.0.5)\n     launchy (3.1.1)\n       addressable (~> 2.8)\n       childprocess (~> 5.0)\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.5)\n+    rubocop (1.75.6)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\nChoice C:\ndb/migrate/20250425134308_quote_ids_to_timestamp_ids.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class QuoteIdsToTimestampIds < ActiveRecord::Migration[8.0]\n+  def up\n+    # Set up the media_attachments.id column to use our timestamp-based IDs.\n+    safety_assured do\n+      execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT timestamp_id('quotes')\")\n+    end\n+\n+    # Make sure we have a sequence to use.\n+    Mastodon::Snowflake.ensure_id_sequences_exist\n+  end\n+\n+  def down\n+    execute('LOCK quotes')\n+    execute(\"SELECT setval('quotes_id_seq', (SELECT MAX(id) FROM quotes))\")\n+    execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT nextval('quotes_id_seq')\")\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_22_085303) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_25_134654) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -871,7 +871,7 @@\n     t.string \"url\"\n   end\n \n-  create_table \"quotes\", force: :cascade do |t|\n+  create_table \"quotes\", id: :bigint, default: -> { \"timestamp_id('quotes'::text)\" }, force: :cascade do |t|\n     t.bigint \"account_id\", null: false\n     t.bigint \"status_id\", null: false\n     t.bigint \"quoted_status_id\"\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/components/status.jsx\n@@ -175,9 +175,8 @@ class Status extends ImmutablePureComponent {\n     }\n   };\n \n-  handleMouseUp = e => {\n+  handleHeaderClick = e => {\n     // Only handle clicks on the empty space above the content\n-\n     if (e.target !== e.currentTarget && e.detail >= 1) {\n       return;\n     }\n@@ -547,7 +546,7 @@ class Status extends ImmutablePureComponent {\n           <div className={classNames('status', `status-${status.get('visibility')}`, { 'status-reply': !!status.get('in_reply_to_id'), 'status--in-thread': !!rootId, 'status--first-in-thread': previousId && (!connectUp || connectToRoot), muted: this.props.muted })} data-id={status.get('id')}>\n             {(connectReply || connectUp || connectToRoot) && <div className={classNames('status__line', { 'status__line--full': connectReply, 'status__line--first': !status.get('in_reply_to_id') && !connectToRoot })} />}\n \n-            <div onMouseUp={this.handleMouseUp} className='status__info'>\n+            <div onClick={this.handleHeaderClick} onAuxClick={this.handleHeaderClick} className='status__info'>\n               <Link to={`/@${status.getIn(['account', 'acct'])}/${status.get('id')}`} className='status__relative-time'>\n                 <span className='status__visibility-icon'><VisibilityIcon visibility={status.get('visibility')} /></span>\n                 <RelativeTimestamp timestamp={status.get('created_at')} />{status.get('edited_at') && <abbr title={intl.formatMessage(messages.edited, { date: intl.formatDate(status.get('edited_at'), { year: 'numeric', month: 'short', day: '2-digit', hour: '2-digit', minute: '2-digit' }) })}> *</abbr>}\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34698\r\n\r\nChanges proposed in this PR:\r\n- Hides \"Followers you know\" widget from your own profile\r\n- Makes avatars overlap more inside of compact avatar group\n\n---\n\nChoice A:\nGemfile\n@@ -13,7 +13,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.225.2', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -93,21 +93,23 @@ GEM\n     annotaterb (4.15.0)\n     ast (2.4.3)\n     attr_required (1.0.2)\n-    aws-eventstream (1.3.2)\n-    aws-partitions (1.1103.0)\n-    aws-sdk-core (3.215.1)\n+    aws-eventstream (1.4.0)\n+    aws-partitions (1.1112.0)\n+    aws-sdk-core (3.225.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n     aws-sdk-s3 (1.177.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sdk-kms (~> 1)\n       aws-sigv4 (~> 1.5)\n-    aws-sigv4 (1.11.0)\n+    aws-sigv4 (1.12.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n     azure-blob (0.5.8)\n       rexml\n@@ -946,7 +948,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.225.2)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -912,7 +912,9 @@ export const AccountHeader: React.FC<{\n             <div className='account__header__badges'>{badges}</div>\n           )}\n \n-          {signedIn && <FamiliarFollowers accountId={accountId} />}\n+          {account.id !== me && signedIn && (\n+            <FamiliarFollowers accountId={accountId} />\n+          )}\n \n           {!(suspended || hidden) && (\n             <div className='account__header__extra'>\n---\napp/javascript/styles/mastodon/components.scss\n@@ -2179,7 +2179,7 @@ a .account__avatar {\n   flex-wrap: nowrap;\n \n   & > :not(:first-child) {\n-    margin-inline-start: -8px;\n+    margin-inline-start: -12px;\n   }\n \n   & > :first-child {\n---\n\n\n---\n\nChoice C:\n.rubocop_todo.yml\n@@ -39,15 +39,6 @@ Style/FetchEnvVar:\n     - 'config/initializers/paperclip.rb'\n     - 'lib/tasks/repo.rake'\n \n-# This cop supports safe autocorrection (--autocorrect).\n-# Configuration parameters: EnforcedStyle, MaxUnannotatedPlaceholdersAllowed, Mode, AllowedMethods, AllowedPatterns.\n-# SupportedStyles: annotated, template, unannotated\n-# AllowedMethods: redirect\n-Style/FormatStringToken:\n-  Exclude:\n-    - 'config/initializers/devise.rb'\n-    - 'lib/paperclip/color_extractor.rb'\n-\n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: MinBodyLength, AllowConsecutiveConditionals.\n Style/GuardClause:\n---\nconfig/initializers/devise.rb\n@@ -394,7 +394,7 @@ def session_cookie\n     config.ldap_uid            = ENV.fetch('LDAP_UID', 'cn')\n     config.ldap_mail           = ENV.fetch('LDAP_MAIL', 'mail')\n     config.ldap_tls_no_verify  = ENV['LDAP_TLS_NO_VERIFY'] == 'true'\n-    config.ldap_search_filter  = ENV.fetch('LDAP_SEARCH_FILTER', '(|(%{uid}=%{email})(%{mail}=%{email}))')\n+    config.ldap_search_filter  = ENV.fetch('LDAP_SEARCH_FILTER', '(|(%<uid>s=%<email>s)(%<mail>s=%<email>s))')\n     config.ldap_uid_conversion_enabled  = ENV['LDAP_UID_CONVERSION_ENABLED'] == 'true'\n     config.ldap_uid_conversion_search   = ENV.fetch('LDAP_UID_CONVERSION_SEARCH', '.,- ')\n     config.ldap_uid_conversion_replace  = ENV.fetch('LDAP_UID_CONVERSION_REPLACE', '_')\n---\nlib/paperclip/color_extractor.rb\n@@ -239,7 +239,7 @@ def palette_from_im_histogram(result, quantity)\n     end\n \n     def rgb_to_hex(rgb)\n-      format('#%02x%02x%02x', rgb.r, rgb.g, rgb.b)\n+      format('#%02x%02x%02x', rgb.r, rgb.g, rgb.b) # rubocop:disable Style/FormatStringToken\n     end\n   end\n end\n---\n\n\n---\n\nChoice D:\napp/models/featured_tag.rb\n@@ -26,6 +26,8 @@ class FeaturedTag < ApplicationRecord\n \n   normalizes :name, with: ->(name) { name.strip.delete_prefix('#') }\n \n+  scope :by_name, ->(name) { joins(:tag).where(tag: { name: HashtagNormalizer.new.normalize(name) }) }\n+\n   before_validation :set_tag\n \n   before_create :reset_data\n---\nspec/lib/activitypub/activity/remove_spec.rb\n@@ -4,29 +4,60 @@\n \n RSpec.describe ActivityPub::Activity::Remove do\n   let(:sender) { Fabricate(:account, featured_collection_url: 'https://example.com/featured') }\n-  let(:status) { Fabricate(:status, account: sender) }\n-\n-  let(:json) do\n-    {\n-      '@context': 'https://www.w3.org/ns/activitystreams',\n-      id: 'foo',\n-      type: 'Add',\n-      actor: ActivityPub::TagManager.instance.uri_for(sender),\n-      object: ActivityPub::TagManager.instance.uri_for(status),\n-      target: sender.featured_collection_url,\n-    }.with_indifferent_access\n-  end\n \n   describe '#perform' do\n     subject { described_class.new(json, sender) }\n \n-    before do\n-      StatusPin.create!(account: sender, status: status)\n-      subject.perform\n+    context 'when removing a pinned status' do\n+      let(:status) { Fabricate(:status, account: sender) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: ActivityPub::TagManager.instance.uri_for(status),\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        StatusPin.create!(account: sender, status: status)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.pinned?(status) }.to(false)\n+      end\n     end\n \n-    it 'removes a pin' do\n-      expect(sender.pinned?(status)).to be false\n+    context 'when removing a featured tag' do\n+      let(:tag) { Fabricate(:tag) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: {\n+            type: 'Hashtag',\n+            name: \"##{tag.display_name}\",\n+            href: \"https://example.com/tags/#{tag.name}\",\n+          },\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        sender.featured_tags.find_or_create_by!(tag: tag)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.featured_tags.exists?(tag: tag) }.to(false)\n+      end\n     end\n   end\n end\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34687\r\n\r\nChanges proposed in this PR:\r\n- Fixes emoji rendering in the followers you know widget\r\n- Fixes the number of avatars not being limited to 3 anymore\r\n- Adds the word \"you know\" when there are more than 2 familiar followers\r\n- Make link styles more consistent (e.g. with the Notifications page)\r\n- Moves the widget up on the account page, underneath the user name and badges\r\n\r\n![image](https://github.com/user-attachments/assets/59d9d8d5-3f05-4337-8f99-689c868798b5)\n\n---\n\nChoice A:\napp/javascript/styles/mastodon/components.scss\n@@ -11044,7 +11044,7 @@ noscript {\n   overflow: hidden;\n   flex-shrink: 0;\n   border-bottom: 1px solid var(--background-border-color);\n-  touch-action: pan-x;\n+  touch-action: pan-y;\n \n   &__slides {\n     display: flex;\n---\n\n\n---\n\nChoice B:\napp/controllers/api/base_controller.rb\n@@ -50,6 +50,10 @@ def current_user\n     nil\n   end\n \n+  def require_client_credentials!\n+    render json: { error: 'This method requires an client credentials authentication' }, status: 403 if doorkeeper_token.resource_owner_id.present?\n+  end\n+\n   def require_authenticated_user!\n     render json: { error: 'This method requires an authenticated user' }, status: 401 unless current_user\n   end\n---\napp/controllers/api/v1/accounts_controller.rb\n@@ -10,6 +10,7 @@ class Api::V1::AccountsController < Api::BaseController\n   before_action -> { doorkeeper_authorize! :write, :'write:accounts' }, only: [:create]\n \n   before_action :require_user!, except: [:index, :show, :create]\n+  before_action :require_client_credentials!, only: [:create]\n   before_action :set_account, except: [:index, :create]\n   before_action :set_accounts, only: [:index]\n   before_action :check_account_approval, except: [:index, :create]\n---\nspec/fabricators/client_credentials_token_fabricator.rb\n@@ -0,0 +1,5 @@\n+# frozen_string_literal: true\n+\n+Fabricator :client_credentials_token, from: :accessible_access_token do\n+  resource_owner_id { nil }\n+end\n---\nspec/requests/api/v1/accounts_spec.rb\n@@ -78,10 +78,27 @@\n     end\n \n     let(:client_app) { Fabricate(:application) }\n-    let(:token) { Doorkeeper::AccessToken.find_or_create_for(application: client_app, resource_owner: nil, scopes: 'read write', use_refresh_token: false) }\n+    let(:token) { Fabricate(:client_credentials_token, application: client_app, scopes: 'read write') }\n     let(:agreement) { nil }\n     let(:date_of_birth) { nil }\n \n+    context 'when not using client credentials token' do\n+      let(:token) { Fabricate(:accessible_access_token, application: client_app, scopes: 'read write', resource_owner_id: user.id) }\n+\n+      it 'returns http forbidden error' do\n+        subject\n+\n+        expect(response).to have_http_status(403)\n+        expect(response.content_type)\n+          .to start_with('application/json')\n+\n+        expect(response.parsed_body)\n+          .to include(\n+            error: 'This method requires an client credentials authentication'\n+          )\n+      end\n+    end\n+\n     context 'when age verification is enabled' do\n       before do\n         Setting.min_age = 16\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -12001,9 +12001,9 @@ __metadata:\n   linkType: hard\n \n \"marky@npm:^1.2.5\":\n-  version: 1.2.5\n-  resolution: \"marky@npm:1.2.5\"\n-  checksum: 10c0/ca8a011f287dab1ac3291df720fc32b366c4cd767347b63722966650405ce71ec6566f71d1e22e1768bf6461a7fd689b9038e7df0fcfb62eacf3a5a6dcac249e\n+  version: 1.3.0\n+  resolution: \"marky@npm:1.3.0\"\n+  checksum: 10c0/6619cdb132fdc4f7cd3e2bed6eebf81a38e50ff4b426bbfb354db68731e4adfebf35ebfd7c8e5a6e846cbf9b872588c4f76db25782caee8c1529ec9d483bf98b\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -912,6 +912,8 @@ export const AccountHeader: React.FC<{\n             <div className='account__header__badges'>{badges}</div>\n           )}\n \n+          {signedIn && <FamiliarFollowers accountId={accountId} />}\n+\n           {!(suspended || hidden) && (\n             <div className='account__header__extra'>\n               <div\n@@ -1023,7 +1025,6 @@ export const AccountHeader: React.FC<{\n                   />\n                 </NavLink>\n               </div>\n-              {signedIn && <FamiliarFollowers accountId={accountId} />}\n             </div>\n           )}\n         </div>\n---\napp/javascript/mastodon/features/account_timeline/components/familiar_followers.tsx\n@@ -12,12 +12,16 @@ import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n \n const AccountLink: React.FC<{ account?: Account }> = ({ account }) => {\n-  // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n-  const name = account?.display_name || `@${account?.acct}`;\n+  if (!account) {\n+    return null;\n+  }\n+\n   return (\n-    <Link to={`/@${account?.acct}`} data-hover-card-account={account?.id}>\n-      {name}\n-    </Link>\n+    <Link\n+      to={`/@${account.acct}`}\n+      data-hover-card-account={account.id}\n+      dangerouslySetInnerHTML={{ __html: account.display_name_html }}\n+    />\n   );\n };\n \n@@ -50,7 +54,7 @@ const FamiliarFollowersReadout: React.FC<{ familiarFollowers: Account[] }> = ({\n     return (\n       <FormattedMessage\n         id='account.familiar_followers_many'\n-        defaultMessage='Followed by {name1}, {name2}, and {othersCount, plural, one {# other} other {# others}}'\n+        defaultMessage='Followed by {name1}, {name2}, and {othersCount, plural, one {one other you know} other {# others you know}}'\n         values={messageData}\n       />\n     );\n@@ -80,7 +84,7 @@ export const FamiliarFollowers: React.FC<{ accountId: string }> = ({\n   return (\n     <div className='account__header__familiar-followers'>\n       <AvatarGroup compact>\n-        {familiarFollowers.map((account) => (\n+        {familiarFollowers.slice(0, 3).map((account) => (\n           <Avatar withLink key={account.id} account={account} size={28} />\n         ))}\n       </AvatarGroup>\n---\napp/javascript/mastodon/locales/en.json\n@@ -28,7 +28,7 @@\n   \"account.edit_profile\": \"Edit profile\",\n   \"account.enable_notifications\": \"Notify me when @{name} posts\",\n   \"account.endorse\": \"Feature on profile\",\n-  \"account.familiar_followers_many\": \"Followed by {name1}, {name2}, and {othersCount, plural, one {# other} other {# others}}\",\n+  \"account.familiar_followers_many\": \"Followed by {name1}, {name2}, and {othersCount, plural, one {one other you know} other {# others you know}}\",\n   \"account.familiar_followers_one\": \"Followed by {name1}\",\n   \"account.familiar_followers_two\": \"Followed by {name1} and {name2}\",\n   \"account.featured\": \"Featured\",\n---\napp/javascript/styles/mastodon/components.scss\n@@ -2091,6 +2091,7 @@ body > [data-popper-placement] {\n   display: block;\n   position: relative;\n   border-radius: var(--avatar-border-radius);\n+  background: var(--surface-background-color);\n \n   img {\n     width: 100%;\n@@ -8151,16 +8152,13 @@ noscript {\n     display: flex;\n     align-items: center;\n     gap: 10px;\n-    margin-block-end: 16px;\n+    margin-block: 16px;\n     color: $darker-text-color;\n \n     a:any-link {\n-      color: inherit;\n-      text-decoration: underline;\n-    }\n-\n-    a:hover {\n+      font-weight: 500;\n       text-decoration: none;\n+      color: $primary-text-color;\n     }\n   }\n }\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [@react-spring/web](https://redirect.github.com/pmndrs/react-spring) | [`^9.7.5` -> `^10.0.0`](https://renovatebot.com/diffs/npm/@react-spring%2fweb/9.7.5/10.0.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/@react-spring%2fweb/10.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/@react-spring%2fweb/10.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/@react-spring%2fweb/9.7.5/10.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/@react-spring%2fweb/9.7.5/10.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>pmndrs/react-spring (@&#8203;react-spring/web)</summary>\n\n### [`v10.0.0`](https://redirect.github.com/pmndrs/react-spring/releases/tag/v10.0.0)\n\n[Compare Source](https://redirect.github.com/pmndrs/react-spring/compare/v9.7.5...v10.0.0)\n\n#### What's Changed\n\n-   chore(deps): update dependency concurrently to v9 by [@&#8203;renovate](https://redirect.github.com/renovate) in [https://github.com/pmndrs/react-spring/pull/2326](https://redirect.github.com/pmndrs/react-spring/pull/2326)\n-   chore: update TSUP to v8 by [@&#8203;joshuaellis](https://redirect.github.com/joshuaellis) in [https://github.com/pmndrs/react-spring/pull/2328](https://redirect.github.com/pmndrs/react-spring/pull/2328)\n-   chore(deps): update dependency chokidar to v4 by [@&#8203;renovate](https://redirect.github.com/renovate) in [https://github.com/pmndrs/react-spring/pull/2325](https://redirect.github.com/pmndrs/react-spring/pull/2325)\n-   chore(deps): update all non-major dependencies by [@&#8203;renovate](https://redirect.github.com/renovate) in [https://github.com/pmndrs/react-spring/pull/2274](https://redirect.github.com/pmndrs/react-spring/pull/2274)\n-   chore(ci): fix bad spelling of package name by [@&#8203;joshuaellis](https://redirect.github.com/joshuaellis) in [https://github.com/pmndrs/react-spring/pull/2350](https://redirect.github.com/pmndrs/react-spring/pull/2350)\n-   chore(deps): update dependency vite-tsconfig-paths to v5 by [@&#8203;renovate](https://redirect.github.com/renovate) in [https://github.com/pmndrs/react-spring/pull/2338](https://redirect.github.com/pmndrs/react-spring/pull/2338)\n-   chore(deps): update dependency vite to v6 by [@&#8203;renovate](https://redirect.github.com/renovate) in [https://github.com/pmndrs/react-spring/pull/2337](https://redirect.github.com/pmndrs/react-spring/pull/2337)\n-   fix(deps): update all non-major dependencies by [@&#8203;renovate](https://redirect.github.com/renovate) in [https://github.com/pmndrs/react-spring/pull/2330](https://redirect.github.com/pmndrs/react-spring/pull/2330)\n-   Clarify what `immediate` does by [@&#8203;jorisw](https://redirect.github.com/jorisw) in [https://github.com/pmndrs/react-spring/pull/2357](https://redirect.github.com/pmndrs/react-spring/pull/2357)\n-   chore(deps): update dependency [@&#8203;vanilla-extract/vite-plugin](https://redirect.github.com/vanilla-extract/vite-plugin) to v5 by [@&#8203;renovate](https://redirect.github.com/renovate) in [https://github.com/pmndrs/react-spring/pull/2360](https://redirect.github.com/pmndrs/react-spring/pull/2360)\n-   feat!: react 19 support by [@&#8203;dagatsoin](https://redirect.github.com/dagatsoin) in [https://github.com/pmndrs/react-spring/pull/2368](https://redirect.github.com/pmndrs/react-spring/pull/2368)\n-   chore(deps): update node.js to v22 by [@&#8203;renovate](https://redirect.github.com/renovate) in [https://github.com/pmndrs/react-spring/pull/2339](https://redirect.github.com/pmndrs/react-spring/pull/2339)\n-   chore(deps): update dependency cypress to v14 by [@&#8203;renovate](https://redirect.github.com/renovate) in [https://github.com/pmndrs/react-spring/pull/2367](https://redirect.github.com/pmndrs/react-spring/pull/2367)\n-   fix(deps): update dependency cookie to v1 by [@&#8203;renovate](https://redirect.github.com/renovate) in [https://github.com/pmndrs/react-spring/pull/2348](https://redirect.github.com/pmndrs/react-spring/pull/2348)\n\n#### New Contributors\n\n-   [@&#8203;jorisw](https://redirect.github.com/jorisw) made their first contribution in [https://github.com/pmndrs/react-spring/pull/2357](https://redirect.github.com/pmndrs/react-spring/pull/2357)\n-   [@&#8203;dagatsoin](https://redirect.github.com/dagatsoin) made their first contribution in [https://github.com/pmndrs/react-spring/pull/2368](https://redirect.github.com/pmndrs/react-spring/pull/2368)\n\n**Full Changelog**: https://github.com/pmndrs/react-spring/compare/v9.7.5...v10.0.0\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS45IiwidXBkYXRlZEluVmVyIjoiNDAuMTEuOSIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwiamF2YXNjcmlwdCJdfQ==-->\n\n\n---\n\nChoice A:\napp/javascript/mastodon/api.ts\n@@ -83,6 +83,7 @@ export default function api(withAuthorization = true) {\n   return instance;\n }\n \n+type ApiUrl = `v${1 | 2}/${string}`;\n type RequestParamsOrData = Record<string, unknown>;\n \n export async function apiRequest<ApiResponse = unknown>(\n@@ -105,28 +106,28 @@ export async function apiRequest<ApiResponse = unknown>(\n }\n \n export async function apiRequestGet<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   params?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('GET', url, { params });\n }\n \n export async function apiRequestPost<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   data?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('POST', url, { data });\n }\n \n export async function apiRequestPut<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   data?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('PUT', url, { data });\n }\n \n export async function apiRequestDelete<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   params?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('DELETE', url, { params });\n---\napp/javascript/mastodon/api/accounts.ts\n@@ -36,6 +36,6 @@ export const apiGetEndorsedAccounts = (id: string) =>\n   apiRequestGet<ApiAccountJSON>(`v1/accounts/${id}/endorsements`);\n \n export const apiGetFamiliarFollowers = (id: string) =>\n-  apiRequestGet<ApiFamiliarFollowersJSON>('/v1/accounts/familiar_followers', {\n+  apiRequestGet<ApiFamiliarFollowersJSON>('v1/accounts/familiar_followers', {\n     id,\n   });\n---\napp/javascript/mastodon/api/polls.ts\n@@ -2,9 +2,9 @@ import { apiRequestGet, apiRequestPost } from 'mastodon/api';\n import type { ApiPollJSON } from 'mastodon/api_types/polls';\n \n export const apiGetPoll = (pollId: string) =>\n-  apiRequestGet<ApiPollJSON>(`/v1/polls/${pollId}`);\n+  apiRequestGet<ApiPollJSON>(`v1/polls/${pollId}`);\n \n export const apiPollVote = (pollId: string, choices: string[]) =>\n-  apiRequestPost<ApiPollJSON>(`/v1/polls/${pollId}/votes`, {\n+  apiRequestPost<ApiPollJSON>(`v1/polls/${pollId}/votes`, {\n     choices,\n   });\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/video/components/hotkey_indicator.tsx\n@@ -24,7 +24,9 @@ export const HotkeyIndicator: React.FC<{\n     enter: [{ opacity: 1 }],\n     leave: [{ opacity: 0 }],\n     onRest: (_result, _ctrl, item) => {\n-      onDismiss(item);\n+      if (item) {\n+        onDismiss(item);\n+      }\n     },\n   });\n \n---\npackage.json\n@@ -44,7 +44,7 @@\n     \"@github/webauthn-json\": \"^2.1.1\",\n     \"@optimize-lodash/rollup-plugin\": \"^5.0.2\",\n     \"@rails/ujs\": \"7.1.501\",\n-    \"@react-spring/web\": \"^9.7.5\",\n+    \"@react-spring/web\": \"^10.0.0\",\n     \"@reduxjs/toolkit\": \"^2.0.1\",\n     \"@use-gesture/react\": \"^10.3.1\",\n     \"@vitejs/plugin-react\": \"^4.2.1\",\n---\nyarn.lock\n@@ -2451,7 +2451,7 @@ __metadata:\n     \"@github/webauthn-json\": \"npm:^2.1.1\"\n     \"@optimize-lodash/rollup-plugin\": \"npm:^5.0.2\"\n     \"@rails/ujs\": \"npm:7.1.501\"\n-    \"@react-spring/web\": \"npm:^9.7.5\"\n+    \"@react-spring/web\": \"npm:^10.0.0\"\n     \"@reduxjs/toolkit\": \"npm:^2.0.1\"\n     \"@testing-library/dom\": \"npm:^10.2.0\"\n     \"@testing-library/react\": \"npm:^16.0.0\"\n@@ -2877,69 +2877,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/animated@npm:9.7.5\"\n+\"@react-spring/animated@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/animated@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/f8c2473c60f39a878c7dd0fdfcfcdbc720521e1506aa3f63c9de64780694a0a73d5ccc535a5ccec3520ddb70a71cf43b038b32c18e99531522da5388c510ecd7\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/a8c40aff22def6dbe964b1f79fa4a7774c44bf5eb47c2ef969c8ecb2a426b4c972b147bf18635d6972dbec3fb95e70dd84f22b43c904c32dfc7a57ad144a0879\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/core@npm:9.7.5\"\n+\"@react-spring/core@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/core@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~9.7.5\"\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/animated\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/5bfd83dfe248cd91889f215f015d908c7714ef445740fd5afa054b27ebc7d5a456abf6c309e2459d9b5b436e78d6fda16b62b9601f96352e9130552c02270830\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/39036a153dbd973443e23d90cb8e7be83201b1f0e4105f8427ddb4c9e9e50e590e1b46282829e0bb6f3deebfab004e30dcb4eec0e34c5ebb234d5060c06ecae5\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/rafz@npm:9.7.5\"\n-  checksum: 10c0/8bdad180feaa9a0e870a513043a5e98a4e9b7292a9f887575b7e6fadab2677825bc894b7ff16c38511b35bfe6cc1072df5851c5fee64448d67551559578ca759\n+\"@react-spring/rafz@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/rafz@npm:10.0.0\"\n+  checksum: 10c0/8d92bc553172fa883ec2121b9cc62bfb43ff5d6c4e76363c8ce100fb6c3dd67c3dd629931786f9d1d63ac95a5d6996e4a08693cd56dda685bdbaf39b60e97f66\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/shared@npm:9.7.5\"\n+\"@react-spring/shared@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/shared@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/rafz\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/0207eacccdedd918a2fc55e78356ce937f445ce27ad9abd5d3accba8f9701a39349b55115641dc2b39bb9d3a155b058c185b411d292dc8cc5686bfa56f73b94f\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/833c3f42d35d22ac47a2f756ac47d85a81bc1decc5e7915f46013823344374378f883135754de94d5b43d8fff3c55fc4a359044c9a44f9095bd1ef1f11a20d4d\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/types@npm:9.7.5\"\n-  checksum: 10c0/85c05121853cacb64f7cf63a4855e9044635e1231f70371cd7b8c78bc10be6f4dd7c68f592f92a2607e8bb68051540989b4677a2ccb525dba937f5cd95dc8bc1\n+\"@react-spring/types@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/types@npm:10.0.0\"\n+  checksum: 10c0/ce1b959eaa8964f4004481d1e7c6eca0a8d636eb9f35ca654bdf77a78a860c0ff9eaa6bdc0cab84fc8a16be5c5fbb22b114249a2721bfc16191666670c0f44b3\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/web@npm:^9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/web@npm:9.7.5\"\n+\"@react-spring/web@npm:^10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/web@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~9.7.5\"\n-    \"@react-spring/core\": \"npm:~9.7.5\"\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/animated\": \"npm:~10.0.0\"\n+    \"@react-spring/core\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/bcd1e052e1b16341a12a19bf4515f153ca09d1fa86ff7752a5d02d7c4db58e8baf80e6283e64411f1e388c65340dce2254b013083426806b5dbae38bd151e53e\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/2218c87d9bfafab78b3079d94ea89ab9b95cb174910be5682fd8f5fc73e326ca956e9b844e5b255d1e3402138ad26981fae2fc1091d682a78359044a63b6421e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -751,18 +751,18 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.8)\n+    rubocop (1.76.0)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n       parallel (~> 1.10)\n       parser (>= 3.3.0.2)\n       rainbow (>= 2.2.2, < 4.0)\n       regexp_parser (>= 2.9.3, < 3.0)\n-      rubocop-ast (>= 1.44.0, < 2.0)\n+      rubocop-ast (>= 1.45.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.1)\n+    rubocop-ast (1.45.0)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n-  version: 2.8.1\n-  resolution: \"pg-connection-string@npm:2.8.1\"\n-  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n+  version: 2.8.5\n+  resolution: \"pg-connection-string@npm:2.8.5\"\n+  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Update | Change |\n|---|---|---|\n| [ruby](https://www.ruby-lang.org) ([source](https://redirect.github.com/ruby/ruby)) | patch | `3.4.3` -> `3.4.4` |\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS45IiwidXBkYXRlZEluVmVyIjoiNDAuMTEuOSIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\n.rubocop_todo.yml\n@@ -33,7 +33,6 @@ Style/FetchEnvVar:\n   Exclude:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/paperclip.rb'\n-    - 'lib/tasks/repo.rake'\n \n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: MinBodyLength, AllowConsecutiveConditionals.\n---\nlib/tasks/repo.rake\n@@ -57,7 +57,7 @@ namespace :repo do\n                 response = nil\n \n                 loop do\n-                  response = HTTP.headers('Authorization' => \"token #{ENV['GITHUB_API_TOKEN']}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n+                  response = HTTP.headers('Authorization' => \"token #{ENV.fetch('GITHUB_API_TOKEN')}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n \n                   if response.code == 403\n                     sleep_for = (response.headers['X-RateLimit-Reset'].to_i - Time.now.to_i).abs\n---\n\n\n---\n\nChoice B:\n.nvmrc\n@@ -1 +1 @@\n-22.15\n+22.16\n---\n\n\n---\n\nChoice C:\n.github/renovate.json5\n@@ -28,6 +28,9 @@\n         // react-router: Requires manual upgrade\n         'history',\n         'react-router-dom',\n+\n+        // react-spring: Requires manual upgrade when upgrading react\n+        '@react-spring/web',\n       ],\n       matchUpdateTypes: ['major'],\n       dependencyDashboardApproval: true,\n---\napp/javascript/mastodon/features/video/components/hotkey_indicator.tsx\n@@ -24,9 +24,7 @@ export const HotkeyIndicator: React.FC<{\n     enter: [{ opacity: 1 }],\n     leave: [{ opacity: 0 }],\n     onRest: (_result, _ctrl, item) => {\n-      if (item) {\n-        onDismiss(item);\n-      }\n+      onDismiss(item);\n     },\n   });\n \n---\npackage.json\n@@ -44,7 +44,7 @@\n     \"@github/webauthn-json\": \"^2.1.1\",\n     \"@optimize-lodash/rollup-plugin\": \"^5.0.2\",\n     \"@rails/ujs\": \"7.1.501\",\n-    \"@react-spring/web\": \"^10.0.0\",\n+    \"@react-spring/web\": \"^9.7.5\",\n     \"@reduxjs/toolkit\": \"^2.0.1\",\n     \"@use-gesture/react\": \"^10.3.1\",\n     \"@vitejs/plugin-legacy\": \"^6.1.1\",\n---\nyarn.lock\n@@ -2460,7 +2460,7 @@ __metadata:\n     \"@github/webauthn-json\": \"npm:^2.1.1\"\n     \"@optimize-lodash/rollup-plugin\": \"npm:^5.0.2\"\n     \"@rails/ujs\": \"npm:7.1.501\"\n-    \"@react-spring/web\": \"npm:^10.0.0\"\n+    \"@react-spring/web\": \"npm:^9.7.5\"\n     \"@reduxjs/toolkit\": \"npm:^2.0.1\"\n     \"@testing-library/dom\": \"npm:^10.2.0\"\n     \"@testing-library/react\": \"npm:^16.0.0\"\n@@ -2887,69 +2887,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/animated@npm:10.0.1\"\n+\"@react-spring/animated@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/animated@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/shared\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/aaccd4a8b0280ac846d463b253ad8f092ee4afc9dbedc8e77616adf5399ffec755344f09fdd8487cadaf815840dff84d354d1143579c27c2fcd6937549b5fc40\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/f8c2473c60f39a878c7dd0fdfcfcdbc720521e1506aa3f63c9de64780694a0a73d5ccc535a5ccec3520ddb70a71cf43b038b32c18e99531522da5388c510ecd7\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/core@npm:10.0.1\"\n+\"@react-spring/core@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/core@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.1\"\n-    \"@react-spring/shared\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/animated\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/059b122dda4138e5e7e461abd49350921e326735ca9a1d8aa19b1fdbae0937661b5f71af6fe82fd8f59e8db5549627849b38cc3f7ef2ec7ee9c93c3d6225174f\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/5bfd83dfe248cd91889f215f015d908c7714ef445740fd5afa054b27ebc7d5a456abf6c309e2459d9b5b436e78d6fda16b62b9601f96352e9130552c02270830\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/rafz@npm:10.0.1\"\n-  checksum: 10c0/cba76f143d3a06f79dd0c09f7aefd17df9cca9b2c1ef7f9103255e5351326f4a42a5a1366f731a78f74380d96ba683bcc2a49312ed1e4b9e9e249e72c9ff68cb\n+\"@react-spring/rafz@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/rafz@npm:9.7.5\"\n+  checksum: 10c0/8bdad180feaa9a0e870a513043a5e98a4e9b7292a9f887575b7e6fadab2677825bc894b7ff16c38511b35bfe6cc1072df5851c5fee64448d67551559578ca759\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/shared@npm:10.0.1\"\n+\"@react-spring/shared@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/shared@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/rafz\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/f056aaa018b3744afd8244e8eea24534d32f92fad9ace815b80e159b296fb5db148e2c9bd840ad9a5188e7a3c0778fd564b8af9ae02cd500e019a228398fb3cf\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/0207eacccdedd918a2fc55e78356ce937f445ce27ad9abd5d3accba8f9701a39349b55115641dc2b39bb9d3a155b058c185b411d292dc8cc5686bfa56f73b94f\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/types@npm:10.0.1\"\n-  checksum: 10c0/260890f9c156dc69b77c846510017156d8c0a07cce70edc7c108e57b0cf4122b26a15e724b191481a51b2c914296de9e81d56618b2c339339d4b221930691baa\n+\"@react-spring/types@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/types@npm:9.7.5\"\n+  checksum: 10c0/85c05121853cacb64f7cf63a4855e9044635e1231f70371cd7b8c78bc10be6f4dd7c68f592f92a2607e8bb68051540989b4677a2ccb525dba937f5cd95dc8bc1\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/web@npm:^10.0.0\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/web@npm:10.0.1\"\n+\"@react-spring/web@npm:^9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/web@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.1\"\n-    \"@react-spring/core\": \"npm:~10.0.1\"\n-    \"@react-spring/shared\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/animated\": \"npm:~9.7.5\"\n+    \"@react-spring/core\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/a0c788c9fd881ccb834feb22fc0694e74e59f7b76e498f0096f5b65e2c9812513955bf45ee27d7c5348f56a7bba7c5a6961d4be663728bb2172fe5aa6b6bdfc4\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/bcd1e052e1b16341a12a19bf4515f153ca09d1fa86ff7752a5d02d7c4db58e8baf80e6283e64411f1e388c65340dce2254b013083426806b5dbae38bd151e53e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\n.ruby-version\n@@ -1 +1 @@\n-3.4.3\n+3.4.4\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| bootsnap | `1.18.4` -> `1.18.5` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/bootsnap/1.18.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/bootsnap/1.18.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/bootsnap/1.18.4/1.18.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/bootsnap/1.18.4/1.18.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS45IiwidXBkYXRlZEluVmVyIjoiNDAuMTEuOSIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -5448,13 +5448,13 @@ __metadata:\n   linkType: hard\n \n \"axios@npm:^1.4.0\":\n-  version: 1.8.4\n-  resolution: \"axios@npm:1.8.4\"\n+  version: 1.9.0\n+  resolution: \"axios@npm:1.9.0\"\n   dependencies:\n     follow-redirects: \"npm:^1.15.6\"\n     form-data: \"npm:^4.0.0\"\n     proxy-from-env: \"npm:^1.1.0\"\n-  checksum: 10c0/450993c2ba975ffccaf0d480b68839a3b2435a5469a71fa2fb0b8a55cdb2c2ae47e609360b9c1e2b2534b73dfd69e2733a1cf9f8215bee0bcd729b72f801b0ce\n+  checksum: 10c0/9371a56886c2e43e4ff5647b5c2c3c046ed0a3d13482ef1d0135b994a628c41fbad459796f101c655e62f0c161d03883454474d2e435b2e021b1924d9f24994c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\napp/javascript/styles/mastodon/admin.scss\n@@ -114,15 +114,14 @@ $content-width: 840px;\n \n       a {\n         font-size: 14px;\n-        display: block;\n+        display: flex;\n+        align-items: center;\n+        gap: 6px;\n         padding: 15px;\n         color: $darker-text-color;\n         text-decoration: none;\n         transition: all 200ms linear;\n         transition-property: color, background-color;\n-        white-space: nowrap;\n-        overflow: hidden;\n-        text-overflow: ellipsis;\n \n         &:hover {\n           color: $primary-text-color;\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -1023,7 +1023,7 @@ export const AccountHeader: React.FC<{\n                   />\n                 </NavLink>\n               </div>\n-              <FamiliarFollowers accountId={accountId} />\n+              {signedIn && <FamiliarFollowers accountId={accountId} />}\n             </div>\n           )}\n         </div>\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -124,7 +124,7 @@ GEM\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n-    bootsnap (1.18.4)\n+    bootsnap (1.18.5)\n       msgpack (~> 1.2)\n     brakeman (7.0.2)\n       racc\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34647\r\n\r\nI am honestly not sure why those errors are occurring, or why they aren't caught/wrapped by the Chewy, Elasticsearch or Faraday gems.\n\n---\n\nChoice A:\napp/javascript/mastodon/components/avatar_group.tsx\n@@ -7,10 +7,16 @@ import classNames from 'classnames';\n \n export const AvatarGroup: React.FC<{\n   compact?: boolean;\n+  avatarHeight?: number;\n   children: React.ReactNode;\n-}> = ({ children, compact = false }) => (\n+}> = ({ children, compact = false, avatarHeight }) => (\n   <div\n     className={classNames('avatar-group', { 'avatar-group--compact': compact })}\n+    style={\n+      avatarHeight\n+        ? ({ '--avatar-height': `${avatarHeight}px` } as React.CSSProperties)\n+        : undefined\n+    }\n   >\n     {children}\n   </div>\n---\napp/javascript/mastodon/components/more_from_author.jsx\n@@ -1,17 +0,0 @@\n-import PropTypes from 'prop-types';\n-\n-import { FormattedMessage } from 'react-intl';\n-\n-import { IconLogo } from 'mastodon/components/logo';\n-import { AuthorLink } from 'mastodon/features/explore/components/author_link';\n-\n-export const MoreFromAuthor = ({ accountId }) => (\n-  <div className='more-from-author'>\n-    <IconLogo />\n-    <FormattedMessage id='link_preview.more_from_author' defaultMessage='More from {name}' values={{ name: <AuthorLink accountId={accountId} /> }} />\n-  </div>\n-);\n-\n-MoreFromAuthor.propTypes = {\n-  accountId: PropTypes.string.isRequired,\n-};\n---\napp/javascript/mastodon/components/more_from_author.tsx\n@@ -0,0 +1,21 @@\n+import { FormattedMessage } from 'react-intl';\n+\n+import { IconLogo } from 'mastodon/components/logo';\n+import { AuthorLink } from 'mastodon/features/explore/components/author_link';\n+\n+export const MoreFromAuthor: React.FC<{ accountId: string }> = ({\n+  accountId,\n+}) => (\n+  <FormattedMessage\n+    id='link_preview.more_from_author'\n+    defaultMessage='More from {name}'\n+    values={{ name: <AuthorLink accountId={accountId} /> }}\n+  >\n+    {(chunks) => (\n+      <div className='more-from-author'>\n+        <IconLogo />\n+        {chunks}\n+      </div>\n+    )}\n+  </FormattedMessage>\n+);\n---\napp/javascript/mastodon/features/notifications_v2/components/notification_group_with_status.tsx\n@@ -18,12 +18,14 @@ import { useAppSelector, useAppDispatch } from 'mastodon/store';\n import { DisplayedName } from './displayed_name';\n import { EmbeddedStatus } from './embedded_status';\n \n+const AVATAR_SIZE = 28;\n+\n export const AvatarById: React.FC<{ accountId: string }> = ({ accountId }) => {\n   const account = useAppSelector((state) => state.accounts.get(accountId));\n \n   if (!account) return null;\n \n-  return <Avatar withLink account={account} size={28} />;\n+  return <Avatar withLink account={account} size={AVATAR_SIZE} />;\n };\n \n export type LabelRenderer = (\n@@ -108,7 +110,7 @@ export const NotificationGroupWithStatus: React.FC<{\n         <div className='notification-group__main'>\n           <div className='notification-group__main__header'>\n             <div className='notification-group__main__header__wrapper'>\n-              <AvatarGroup>\n+              <AvatarGroup avatarHeight={AVATAR_SIZE}>\n                 {accountIds\n                   .slice(0, NOTIFICATIONS_GROUP_MAX_AVATARS)\n                   .map((id) => (\n@@ -123,7 +125,14 @@ export const NotificationGroupWithStatus: React.FC<{\n \n             <div className='notification-group__main__header__label'>\n               {label}\n-              {timestamp && <RelativeTimestamp timestamp={timestamp} />}\n+              {timestamp && (\n+                <>\n+                  <span className='notification-group__main__header__label-separator'>\n+                    &middot;\n+                  </span>\n+                  <RelativeTimestamp timestamp={timestamp} />\n+                </>\n+              )}\n             </div>\n           </div>\n \n---\napp/javascript/styles/mastodon/components.scss\n@@ -2249,14 +2249,18 @@ a .account__avatar {\n \n .avatar-group {\n   display: flex;\n-  gap: 8px;\n-  flex-wrap: wrap;\n+\n+  --avatar-height: 28px;\n+\n+  &:not(.avatar-group--compact) {\n+    gap: 8px;\n+    flex-wrap: wrap;\n+    height: var(--avatar-height);\n+    overflow-y: clip;\n+  }\n }\n \n .avatar-group--compact {\n-  gap: 0;\n-  flex-wrap: nowrap;\n-\n   & > :not(:first-child) {\n     margin-inline-start: -12px;\n   }\n@@ -10408,7 +10412,8 @@ noscript {\n   padding: 15px;\n   display: flex;\n   align-items: center;\n-  gap: 8px;\n+  flex-wrap: wrap;\n+  gap: 4px 8px;\n \n   .logo {\n     width: 16px;\n@@ -10502,12 +10507,6 @@ noscript {\n     overflow: hidden;\n     container-type: inline-size;\n \n-    @container (width < 350px) {\n-      &__header time {\n-        display: none;\n-      }\n-    }\n-\n     &__header {\n       display: flex;\n       flex-direction: column;\n@@ -10520,7 +10519,8 @@ noscript {\n \n       &__label {\n         display: flex;\n-        gap: 8px;\n+        flex-wrap: wrap;\n+        gap: 2px 8px;\n         font-size: 15px;\n         line-height: 22px;\n         color: $darker-text-color;\n@@ -10538,6 +10538,13 @@ noscript {\n         time {\n           color: $dark-text-color;\n         }\n+\n+        @container (width < 350px) {\n+          time,\n+          &-separator {\n+            display: none;\n+          }\n+        }\n       }\n     }\n \n---\n\n\n---\n\nChoice B:\napp/lib/admin/system_check/elasticsearch_check.rb\n@@ -17,7 +17,7 @@ def pass?\n     return true unless Chewy.enabled?\n \n     running_version.present? && compatible_version? && cluster_health['status'] == 'green' && indexes_match? && specifications_match? && preset_matches?\n-  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error\n+  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error, HTTPClient::KeepAliveDisconnected\n     false\n   end\n \n@@ -54,7 +54,7 @@ def message\n     else\n       Admin::SystemCheck::Message.new(:elasticsearch_preset, nil, 'https://docs.joinmastodon.org/admin/elasticsearch/#scaling')\n     end\n-  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error\n+  rescue Faraday::ConnectionFailed, Elasticsearch::Transport::Transport::Error, HTTPClient::KeepAliveDisconnected\n     Admin::SystemCheck::Message.new(:elasticsearch_running_check)\n   end\n \n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -13307,12 +13307,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.9.5\":\n-  version: 3.9.5\n-  resolution: \"pg-pool@npm:3.9.5\"\n+\"pg-pool@npm:^3.9.6\":\n+  version: 3.9.6\n+  resolution: \"pg-pool@npm:3.9.6\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/ebb36b6a1fd753213263a2e0e73d06ffe9fc93907deceae484c7fe4b464f6e9c41a578eb096b4b6012beec94a5d6e0e47728dfc4425e06d283744aa7432365a4\n+  checksum: 10c0/458d50a4e7260977f076472d40d0796fa8b513af7e3ce1bf65557e10724e9c13653661c883f6650dff92d0a1a5ff4e7a001a8262b786c1ad4cfbd35c3354353e\n   languageName: node\n   linkType: hard\n \n@@ -13352,12 +13352,12 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.15.5\n-  resolution: \"pg@npm:8.15.5\"\n+  version: 8.15.6\n+  resolution: \"pg@npm:8.15.6\"\n   dependencies:\n     pg-cloudflare: \"npm:^1.2.5\"\n     pg-connection-string: \"npm:^2.8.5\"\n-    pg-pool: \"npm:^3.9.5\"\n+    pg-pool: \"npm:^3.9.6\"\n     pg-protocol: \"npm:^1.9.5\"\n     pg-types: \"npm:^2.1.0\"\n     pgpass: \"npm:1.x\"\n@@ -13369,7 +13369,7 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/4c118cd9bec37c8880b4489b9acbd10cf1eaa86a0a9024de2dac83f4ce5adedecc4cab54b66fa3bcb204aab7297c08d03617ae15499538939692b48651cc52d1\n+  checksum: 10c0/d4dc81020ebd137b6cf6228e43c643067acb8240079a07f7b9a7e97be0f33ad4d8c6f2a3f5b512ad87180e3d48e651fbd72885aa807ab58a715da8f3efea0fab\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -13,7 +13,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.225.2', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -93,21 +93,23 @@ GEM\n     annotaterb (4.15.0)\n     ast (2.4.3)\n     attr_required (1.0.2)\n-    aws-eventstream (1.3.2)\n-    aws-partitions (1.1103.0)\n-    aws-sdk-core (3.215.1)\n+    aws-eventstream (1.4.0)\n+    aws-partitions (1.1112.0)\n+    aws-sdk-core (3.225.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n     aws-sdk-s3 (1.177.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sdk-kms (~> 1)\n       aws-sigv4 (~> 1.5)\n-    aws-sigv4 (1.11.0)\n+    aws-sigv4 (1.12.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n     azure-blob (0.5.8)\n       rexml\n@@ -946,7 +948,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.225.2)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFollow-up to #34615\r\n\r\n`raise RuntimeError(\u2026)` would fail with `NoMethodError` since `RuntimeError` is not a method.\r\n\r\nInstead of changing it to `raise RuntimeError.new(\u2026)`, I opted to simply return `nil`, as that was the previous behavior, and in most case an error at this point would not be fixed by retrying, so having the job be retried would simply waste resources.\n\n---\n\nChoice A:\napp/workers/activitypub/fetch_all_replies_worker.rb\n@@ -78,7 +78,7 @@ def get_replies_uri(parent_status)\n   # @param root_status_uri [String]\n   def get_root_replies(root_status_uri, options = {})\n     root_status_body = fetch_resource(root_status_uri, true)\n-    raise RuntimeError(\"FetchAllRepliesWorker - #{@root_status.uri}: Root status could not be fetched\") if root_status_body.nil?\n+    return if root_status_body.nil?\n \n     FetchReplyWorker.perform_async(root_status_uri, { **options, prefetched_body: root_status_body })\n \n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/actions/accounts.js\n@@ -2,6 +2,7 @@ import { browserHistory } from 'mastodon/components/router';\n import { debounceWithDispatchAndArguments } from 'mastodon/utils/debounce';\n \n import api, { getLinks } from '../api';\n+import { me } from '../initial_state';\n \n import {\n   followAccountSuccess, unfollowAccountSuccess,\n@@ -12,6 +13,7 @@ import {\n   blockAccountSuccess, unblockAccountSuccess,\n   pinAccountSuccess, unpinAccountSuccess,\n   fetchRelationshipsSuccess,\n+  fetchEndorsedAccounts,\n } from './accounts_typed';\n import { importFetchedAccount, importFetchedAccounts } from './importer';\n \n@@ -634,6 +636,7 @@ export function pinAccount(id) {\n \n     api().post(`/api/v1/accounts/${id}/pin`).then(response => {\n       dispatch(pinAccountSuccess({ relationship: response.data }));\n+      dispatch(fetchEndorsedAccounts({ accountId: me }));\n     }).catch(error => {\n       dispatch(pinAccountFail(error));\n     });\n@@ -646,6 +649,7 @@ export function unpinAccount(id) {\n \n     api().post(`/api/v1/accounts/${id}/unpin`).then(response => {\n       dispatch(unpinAccountSuccess({ relationship: response.data }));\n+      dispatch(fetchEndorsedAccounts({ accountId: me }));\n     }).catch(error => {\n       dispatch(unpinAccountFail(error));\n     });\n---\napp/javascript/mastodon/components/account.tsx\n@@ -12,6 +12,8 @@ import {\n   muteAccount,\n   unmuteAccount,\n   followAccountSuccess,\n+  unpinAccount,\n+  pinAccount,\n } from 'mastodon/actions/accounts';\n import { showAlertForError } from 'mastodon/actions/alerts';\n import { openModal } from 'mastodon/actions/modal';\n@@ -62,14 +64,23 @@ const messages = defineMessages({\n   },\n });\n \n-export const Account: React.FC<{\n+interface AccountProps {\n   size?: number;\n   id: string;\n   hidden?: boolean;\n   minimal?: boolean;\n   defaultAction?: 'block' | 'mute';\n   withBio?: boolean;\n-}> = ({ id, size = 46, hidden, minimal, defaultAction, withBio }) => {\n+}\n+\n+export const Account: React.FC<AccountProps> = ({\n+  id,\n+  size = 46,\n+  hidden,\n+  minimal,\n+  defaultAction,\n+  withBio,\n+}) => {\n   const intl = useIntl();\n   const { signedIn } = useIdentity();\n   const account = useAppSelector((state) => state.accounts.get(id));\n@@ -119,8 +130,6 @@ export const Account: React.FC<{\n         },\n       ];\n     } else if (defaultAction !== 'block') {\n-      arr = [];\n-\n       if (isRemote && accountUrl) {\n         arr.push({\n           text: intl.formatMessage(messages.openOriginalPage),\n@@ -173,6 +182,25 @@ export const Account: React.FC<{\n           text: intl.formatMessage(messages.addToLists),\n           action: handleAddToLists,\n         });\n+\n+        if (id !== me && (relationship?.following || relationship?.requested)) {\n+          const handleEndorseToggle = () => {\n+            if (relationship.endorsed) {\n+              dispatch(unpinAccount(id));\n+            } else {\n+              dispatch(pinAccount(id));\n+            }\n+          };\n+          arr.push({\n+            text: intl.formatMessage(\n+              // Defined in features/account_timeline/components/account_header.tsx\n+              relationship.endorsed\n+                ? { id: 'account.unendorse' }\n+                : { id: 'account.endorse' },\n+            ),\n+            action: handleEndorseToggle,\n+          });\n+        }\n       }\n     }\n \n---\n\n\n---\n\nChoice C:\napp/javascript/styles/mastodon/admin.scss\n@@ -114,15 +114,14 @@ $content-width: 840px;\n \n       a {\n         font-size: 14px;\n-        display: block;\n+        display: flex;\n+        align-items: center;\n+        gap: 6px;\n         padding: 15px;\n         color: $darker-text-color;\n         text-decoration: none;\n         transition: all 200ms linear;\n         transition-property: color, background-color;\n-        white-space: nowrap;\n-        overflow: hidden;\n-        text-overflow: ellipsis;\n \n         &:hover {\n           color: $primary-text-color;\n---\n\n\n---\n\nChoice D:\napp/helpers/context_helper.rb\n@@ -26,6 +26,13 @@ module ContextHelper\n     suspended: { 'toot' => 'http://joinmastodon.org/ns#', 'suspended' => 'toot:suspended' },\n     attribution_domains: { 'toot' => 'http://joinmastodon.org/ns#', 'attributionDomains' => { '@id' => 'toot:attributionDomains', '@type' => '@id' } },\n     quote_requests: { 'QuoteRequest' => 'https://w3id.org/fep/044f#QuoteRequest' },\n+    interaction_policies: {\n+      'gts' => 'https://gotosocial.org/ns#',\n+      'interactionPolicy' => { '@id' => 'gts:interactionPolicy', '@type' => '@id' },\n+      'canQuote' => { '@id' => 'gts:canQuote', '@type' => '@id' },\n+      'automaticApproval' => { '@id' => 'gts:automaticApproval', '@type' => '@id' },\n+      'manualApproval' => { '@id' => 'gts:manualApproval', '@type' => '@id' },\n+    },\n   }.freeze\n \n   def full_context\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nChanges proposed in this PR:\r\n- Constrains the `url` parameter of the functions `apiRequestGet`, `apiRequestPost`, `apiRequestPut`, and `apiRequestDelete`to start with `v1/` or `v2/` instead of allowing any string\r\n- Fixes the three occurrences of the leading slash\n\n---\n\nChoice A:\nGemfile\n@@ -74,7 +74,7 @@ gem 'premailer-rails'\n gem 'public_suffix', '~> 6.0'\n gem 'pundit', '~> 2.3'\n gem 'rack-attack', '~> 6.6'\n-gem 'rack-cors', '~> 2.0', require: 'rack/cors'\n+gem 'rack-cors', require: 'rack/cors'\n gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n---\nGemfile.lock\n@@ -636,8 +636,9 @@ GEM\n     rack (3.1.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n-    rack-cors (2.0.2)\n-      rack (>= 2.0.0)\n+    rack-cors (3.0.0)\n+      logger\n+      rack (>= 3.0.14)\n     rack-oauth2 (2.2.1)\n       activesupport\n       attr_required\n@@ -1046,7 +1047,7 @@ DEPENDENCIES\n   puma (~> 6.3)\n   pundit (~> 2.3)\n   rack-attack (~> 6.6)\n-  rack-cors (~> 2.0)\n+  rack-cors\n   rack-test (~> 2.1)\n   rails (~> 8.0)\n   rails-i18n (~> 8.0)\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -10785,8 +10785,8 @@ __metadata:\n   linkType: hard\n \n \"sass@npm:^1.62.1\":\n-  version: 1.88.0\n-  resolution: \"sass@npm:1.88.0\"\n+  version: 1.89.0\n+  resolution: \"sass@npm:1.89.0\"\n   dependencies:\n     \"@parcel/watcher\": \"npm:^2.4.1\"\n     chokidar: \"npm:^4.0.0\"\n@@ -10797,7 +10797,7 @@ __metadata:\n       optional: true\n   bin:\n     sass: sass.js\n-  checksum: 10c0/dcb16dc29116bfa5a90485d24fd8020d2b0d95155bd2e31285901588729343b59fefe44365c5f146b2ba5a9ebadef90b23a7220b902507bdbd91ca2ba0a0b688\n+  checksum: 10c0/8e31b48c5e0abd9d437edb201919a82863f605ace1c1536ccdc6b3133937a70fe29b92ad536af632ecae2f140733931e4ec971e1bfbf8b835c54d392b28331df\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/api.ts\n@@ -83,6 +83,7 @@ export default function api(withAuthorization = true) {\n   return instance;\n }\n \n+type ApiUrl = `v${1 | 2}/${string}`;\n type RequestParamsOrData = Record<string, unknown>;\n \n export async function apiRequest<ApiResponse = unknown>(\n@@ -105,28 +106,28 @@ export async function apiRequest<ApiResponse = unknown>(\n }\n \n export async function apiRequestGet<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   params?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('GET', url, { params });\n }\n \n export async function apiRequestPost<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   data?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('POST', url, { data });\n }\n \n export async function apiRequestPut<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   data?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('PUT', url, { data });\n }\n \n export async function apiRequestDelete<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   params?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('DELETE', url, { params });\n---\napp/javascript/mastodon/api/accounts.ts\n@@ -36,6 +36,6 @@ export const apiGetEndorsedAccounts = (id: string) =>\n   apiRequestGet<ApiAccountJSON>(`v1/accounts/${id}/endorsements`);\n \n export const apiGetFamiliarFollowers = (id: string) =>\n-  apiRequestGet<ApiFamiliarFollowersJSON>('/v1/accounts/familiar_followers', {\n+  apiRequestGet<ApiFamiliarFollowersJSON>('v1/accounts/familiar_followers', {\n     id,\n   });\n---\napp/javascript/mastodon/api/polls.ts\n@@ -2,9 +2,9 @@ import { apiRequestGet, apiRequestPost } from 'mastodon/api';\n import type { ApiPollJSON } from 'mastodon/api_types/polls';\n \n export const apiGetPoll = (pollId: string) =>\n-  apiRequestGet<ApiPollJSON>(`/v1/polls/${pollId}`);\n+  apiRequestGet<ApiPollJSON>(`v1/polls/${pollId}`);\n \n export const apiPollVote = (pollId: string, choices: string[]) =>\n-  apiRequestPost<ApiPollJSON>(`/v1/polls/${pollId}/votes`, {\n+  apiRequestPost<ApiPollJSON>(`v1/polls/${pollId}/votes`, {\n     choices,\n   });\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -12474,9 +12474,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.5\":\n-  version: 2.8.5\n-  resolution: \"pg-connection-string@npm:2.8.5\"\n-  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n+  version: 2.9.0\n+  resolution: \"pg-connection-string@npm:2.9.0\"\n+  checksum: 10c0/7145d00688200685a9d9931a7fc8d61c75f348608626aef88080ece956ceb4ff1cbdee29c3284e41b7a3345bab0e4f50f9edc256e270bfa3a563af4ea78bb490\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nChanges in this PR:\r\n- Hide the `FamiliarFollowers` component when logged out, preventing a 401 error\n\n---\n\nChoice A:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -1023,7 +1023,7 @@ export const AccountHeader: React.FC<{\n                   />\n                 </NavLink>\n               </div>\n-              <FamiliarFollowers accountId={accountId} />\n+              {signedIn && <FamiliarFollowers accountId={accountId} />}\n             </div>\n           )}\n         </div>\n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.223.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1096.0)\n+    aws-sdk-core (3.223.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.223.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice C:\nspec/helpers/theme_helper_spec.rb\n@@ -6,10 +6,10 @@\n   describe 'theme_style_tags' do\n     let(:result) { helper.theme_style_tags(theme) }\n \n-    context 'when using system theme' do\n+    context 'when using \"system\" theme' do\n       let(:theme) { 'system' }\n \n-      it 'returns the mastodon-light and default stylesheets with correct color schemes' do\n+      it 'returns the mastodon-light and application stylesheets with correct color schemes' do\n         expect(html_links.first.attributes.symbolize_keys)\n           .to include(\n             href: have_attributes(value: match(/mastodon-light/)),\n@@ -23,6 +23,17 @@\n       end\n     end\n \n+    context 'when using \"default\" theme' do\n+      let(:theme) { 'default' }\n+\n+      it 'returns the application stylesheet' do\n+        expect(html_links.last.attributes.symbolize_keys)\n+          .to include(\n+            href: have_attributes(value: match(/application/))\n+          )\n+      end\n+    end\n+\n     context 'when using other theme' do\n       let(:theme) { 'contrast' }\n \n---\n\n\n---\n\nChoice D:\napp/helpers/json_ld_helper.rb\n@@ -72,6 +72,18 @@ def non_matching_uri_hosts?(base_url, comparison_url)\n     !haystack.casecmp(needle).zero?\n   end\n \n+  def safe_prefetched_embed(account, object, context)\n+    return unless object.is_a?(Hash)\n+\n+    # NOTE: Replacing the object's context by that of the parent activity is\n+    # not sound, but it's consistent with the rest of the codebase\n+    object = object.merge({ '@context' => context })\n+\n+    return if value_or_id(first_of_value(object['attributedTo'])) != account.uri || non_matching_uri_hosts?(account.uri, object['id'])\n+\n+    object\n+  end\n+\n   def canonicalize(json)\n     graph = RDF::Graph.new << JSON::LD::API.toRdf(json, documentLoader: method(:load_jsonld_context))\n     graph.dump(:normalize)\n---\napp/lib/activitypub/activity/create.rb\n@@ -204,7 +204,9 @@ def attach_quote(status)\n \n     @quote.status = status\n     @quote.save\n-    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, request_id: @options[:request_id])\n+\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, prefetched_quoted_object: embedded_quote, request_id: @options[:request_id])\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n     ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, @quote.id, @quote_uri, { 'request_id' => @options[:request_id] })\n   end\n---\napp/lib/activitypub/parser/status_parser.rb\n@@ -120,6 +120,11 @@ def quote_uri\n     end.first\n   end\n \n+  # The inlined quote; out of the attributes we support, only `https://w3id.org/fep/044f#quote` explicitly supports inlined objects\n+  def quoted_object\n+    as_array(@object['quote']).first\n+  end\n+\n   def quote_approval_uri\n     as_array(@object['quoteAuthorization']).first\n   end\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -273,7 +273,6 @@ def update_emojis!\n   def update_quote!\n     return unless Mastodon::Feature.inbound_quotes_enabled?\n \n-    quote = nil\n     quote_uri = @status_parser.quote_uri\n \n     if quote_uri.present?\n@@ -294,21 +293,23 @@ def update_quote!\n         quote = Quote.create(status: @status, approval_uri: approval_uri)\n         @quote_changed = true\n       end\n-    end\n \n-    if quote.present?\n-      begin\n-        quote.save\n-        ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, request_id: @request_id)\n-      rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n-        ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n-      end\n+      quote.save\n+\n+      fetch_and_verify_quote!(quote, quote_uri)\n     elsif @status.quote.present?\n       @status.quote.destroy!\n       @quote_changed = true\n     end\n   end\n \n+  def fetch_and_verify_quote!(quote, quote_uri)\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @activity_json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, prefetched_quoted_object: embedded_quote, request_id: @request_id)\n+  rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n+    ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n+  end\n+\n   def update_counts!\n     likes = @status_parser.favourites_count\n     shares =  @status_parser.reblogs_count\n---\napp/services/activitypub/verify_quote_service.rb\n@@ -4,15 +4,15 @@ class ActivityPub::VerifyQuoteService < BaseService\n   include JsonLdHelper\n \n   # Optionally fetch quoted post, and verify the quote is authorized\n-  def call(quote, fetchable_quoted_uri: nil, prefetched_body: nil, request_id: nil)\n+  def call(quote, fetchable_quoted_uri: nil, prefetched_quoted_object: nil, prefetched_approval: nil, request_id: nil)\n     @request_id = request_id\n     @quote = quote\n     @fetching_error = nil\n \n-    fetch_quoted_post_if_needed!(fetchable_quoted_uri)\n+    fetch_quoted_post_if_needed!(fetchable_quoted_uri, prefetched_body: prefetched_quoted_object)\n     return if fast_track_approval! || quote.approval_uri.blank?\n \n-    @json = fetch_approval_object(quote.approval_uri, prefetched_body:)\n+    @json = fetch_approval_object(quote.approval_uri, prefetched_body: prefetched_approval)\n     return quote.reject! if @json.nil?\n \n     return if non_matching_uri_hosts?(quote.approval_uri, value_or_id(@json['attributedTo']))\n@@ -68,11 +68,11 @@ def matching_quote_uri?\n     ActivityPub::TagManager.instance.uri_for(@quote.status) == value_or_id(@json['interactingObject'])\n   end\n \n-  def fetch_quoted_post_if_needed!(uri)\n+  def fetch_quoted_post_if_needed!(uri, prefetched_body: nil)\n     return if uri.nil? || @quote.quoted_status.present?\n \n     status = ActivityPub::TagManager.instance.uri_to_resource(uri, Status)\n-    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, request_id: @request_id)\n+    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, prefetched_body:, request_id: @request_id)\n \n     @quote.update(quoted_status: status) if status.present?\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS => e\n---\nspec/services/activitypub/verify_quote_service_spec.rb\n@@ -89,6 +89,37 @@\n       end\n     end\n \n+    context 'with a valid activity for a post that cannot be fetched but is passed as fetched_quoted_object' do\n+      let(:quoted_status) { nil }\n+\n+      let(:approval_interaction_target) { 'https://b.example.com/unknown-quoted' }\n+      let(:prefetched_object) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          type: 'Note',\n+          id: 'https://b.example.com/unknown-quoted',\n+          to: 'https://www.w3.org/ns/activitystreams#Public',\n+          attributedTo: ActivityPub::TagManager.instance.uri_for(quoted_account),\n+          content: 'previously unknown post',\n+        }.with_indifferent_access\n+      end\n+\n+      before do\n+        stub_request(:get, 'https://b.example.com/unknown-quoted')\n+          .to_return(status: 404)\n+      end\n+\n+      it 'updates the status' do\n+        expect { subject.call(quote, fetchable_quoted_uri: 'https://b.example.com/unknown-quoted', prefetched_quoted_object: prefetched_object) }\n+          .to change(quote, :state).to('accepted')\n+\n+        expect(a_request(:get, approval_uri))\n+          .to have_been_made.once\n+\n+        expect(quote.reload.quoted_status.content).to eq 'previously unknown post'\n+      end\n+    end\n+\n     context 'with a valid activity for a post that cannot be fetched but is inlined' do\n       let(:quoted_status) { nil }\n \n@@ -148,7 +179,7 @@\n \n     context 'with a valid activity for already-fetched posts, with a pre-fetched approval' do\n       it 'updates the status without fetching the activity' do\n-        expect { subject.call(quote, prefetched_body: Oj.dump(json)) }\n+        expect { subject.call(quote, prefetched_approval: Oj.dump(json)) }\n           .to change(quote, :state).to('accepted')\n \n         expect(a_request(:get, approval_uri))\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis fixes a bug with #33395 that increased the bundle size by a large amount. This was due to the addition of the uncompressed emoji object being appended to the output of `emoji_compressed.js`, which is imported in multiple places.\r\n\r\nThat data is only used by the picker, as the prior PR switched to the `NimblePicker` which allows custom sheets. This PR moves that import and sets common default props in new wrapper components that are lazy-loaded.\r\n\r\nSize stats according the Webpack Bundle Analyzer:\r\n- Pre #33395 sizes are 8.15MB total, with 1.77MB of that from the common bundle, and ~660KB of that from the emoji picker.\r\n- Post #33395 sizes are 8.66MB total, with 2.77MB in common, and ~11KB from the emoji picker.\r\n- This PR's sizes are 8.43MB total, with 1.85MB from common, and ~760KB from the picker.\r\n\r\nAll reports can be found in this archive: [reports.zip](https://github.com/user-attachments/files/20189015/reports.zip)\n\n---\n\nChoice A:\napp/services/post_status_service.rb\n@@ -18,6 +18,7 @@ def initialize(message, accounts)\n   # @param [Hash] options\n   # @option [String] :text Message\n   # @option [Status] :thread Optional status to reply to\n+  # @option [Status] :quoted_status Optional status to quote\n   # @option [Boolean] :sensitive\n   # @option [String] :visibility\n   # @option [String] :spoiler_text\n@@ -35,6 +36,7 @@ def call(account, options = {})\n     @options     = options\n     @text        = @options[:text] || ''\n     @in_reply_to = @options[:thread]\n+    @quoted_status = @options[:quoted_status]\n \n     @antispam = Antispam.new\n \n@@ -78,6 +80,7 @@ def process_status!\n     @status = @account.statuses.new(status_attributes)\n     process_mentions_service.call(@status, save_records: false)\n     safeguard_mentions!(@status)\n+    attach_quote!(@status)\n     @antispam.local_preflight_check!(@status)\n \n     # The following transaction block is needed to wrap the UPDATEs to\n@@ -87,6 +90,21 @@ def process_status!\n     end\n   end\n \n+  def attach_quote!(status)\n+    return if @quoted_status.nil?\n+\n+    # NOTE: for now this is only for convenience in testing, as we don't support the request flow nor serialize quotes in ActivityPub\n+    # we only support incoming quotes so far\n+\n+    status.quote = Quote.new(quoted_status: @quoted_status)\n+    status.quote.accept! if @status.account == @quoted_status.account || @quoted_status.active_mentions.exists?(mentions: { account_id: status.account_id })\n+\n+    # TODO: the following has yet to be implemented:\n+    # - handle approval of local users (requires the interactionPolicy PR)\n+    # - produce a QuoteAuthorization for quotes of local users\n+    # - send a QuoteRequest for quotes of remote users\n+  end\n+\n   def safeguard_mentions!(status)\n     return if @options[:allowed_mentions].nil?\n \n@@ -223,6 +241,7 @@ def scheduled_options\n     @options.dup.tap do |options_hash|\n       options_hash[:in_reply_to_id]  = options_hash.delete(:thread)&.id\n       options_hash[:application_id]  = options_hash.delete(:application)&.id\n+      options_hash[:quoted_status_id] = options_hash.delete(:quoted_status)&.id\n       options_hash[:scheduled_at]    = nil\n       options_hash[:idempotency]     = nil\n       options_hash[:with_rate_limit] = false\n---\n\n\n---\n\nChoice B:\n.rubocop_todo.yml\n@@ -36,7 +36,6 @@ Rails/OutputSafety:\n Style/FetchEnvVar:\n   Exclude:\n     - 'config/initializers/2_limited_federation_mode.rb'\n-    - 'config/initializers/3_omniauth.rb'\n     - 'config/initializers/paperclip.rb'\n     - 'lib/tasks/repo.rake'\n \n---\nconfig/initializers/3_omniauth.rb\n@@ -12,7 +12,7 @@\n   # CAS strategy\n   if ENV['CAS_ENABLED'] == 'true'\n     cas_options = {}\n-    cas_options[:display_name] = ENV['CAS_DISPLAY_NAME']\n+    cas_options[:display_name] = ENV.fetch('CAS_DISPLAY_NAME', nil)\n     cas_options[:url] = ENV['CAS_URL'] if ENV['CAS_URL']\n     cas_options[:host] = ENV['CAS_HOST'] if ENV['CAS_HOST']\n     cas_options[:port] = ENV['CAS_PORT'] if ENV['CAS_PORT']\n@@ -41,7 +41,7 @@\n   # SAML strategy\n   if ENV['SAML_ENABLED'] == 'true'\n     saml_options = {}\n-    saml_options[:display_name] = ENV['SAML_DISPLAY_NAME']\n+    saml_options[:display_name] = ENV.fetch('SAML_DISPLAY_NAME', nil)\n     saml_options[:assertion_consumer_service_url] = ENV['SAML_ACS_URL'] if ENV['SAML_ACS_URL']\n     saml_options[:issuer] = ENV['SAML_ISSUER'] if ENV['SAML_ISSUER']\n     saml_options[:idp_sso_target_url] = ENV['SAML_IDP_SSO_TARGET_URL'] if ENV['SAML_IDP_SSO_TARGET_URL']\n@@ -73,7 +73,7 @@\n   # OpenID Connect Strategy\n   if ENV['OIDC_ENABLED'] == 'true'\n     oidc_options = {}\n-    oidc_options[:display_name] = ENV['OIDC_DISPLAY_NAME'] # OPTIONAL\n+    oidc_options[:display_name] = ENV.fetch('OIDC_DISPLAY_NAME', nil) # OPTIONAL\n     oidc_options[:issuer] = ENV['OIDC_ISSUER'] if ENV['OIDC_ISSUER'] # NEED\n     oidc_options[:discovery] = ENV['OIDC_DISCOVERY'] == 'true' if ENV['OIDC_DISCOVERY'] # OPTIONAL (default: false)\n     oidc_options[:client_auth_method] = ENV['OIDC_CLIENT_AUTH_METHOD'] if ENV['OIDC_CLIENT_AUTH_METHOD'] # OPTIONAL (default: basic)\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/compose/components/emoji_picker_dropdown.jsx\n@@ -12,14 +12,10 @@ import Overlay from 'react-overlays/Overlay';\n \n import MoodIcon from '@/material-icons/400-20px/mood.svg?react';\n import { IconButton } from 'mastodon/components/icon_button';\n-import emojiCompressed from 'mastodon/features/emoji/emoji_compressed';\n-import { assetHost } from 'mastodon/utils/config';\n \n import { buildCustomEmojis, categoriesFromEmojis } from '../../emoji/emoji';\n import { EmojiPicker as EmojiPickerAsync } from '../../ui/util/async-components';\n \n-const nimblePickerData = emojiCompressed[5];\n-\n const messages = defineMessages({\n   emoji: { id: 'emoji_button.label', defaultMessage: 'Insert emoji' },\n   emoji_search: { id: 'emoji_button.search', defaultMessage: 'Search...' },\n@@ -40,19 +36,11 @@ let EmojiPicker, Emoji; // load asynchronously\n \n const listenerOptions = supportsPassiveEvents ? { passive: true, capture: true } : true;\n \n-const backgroundImageFn = () => `${assetHost}/emoji/sheet_15_1.png`;\n-\n const notFoundFn = () => (\n   <div className='emoji-mart-no-results'>\n     <Emoji\n-      data={nimblePickerData}\n       emoji='sleuth_or_spy'\n-      set='twitter'\n       size={32}\n-      sheetSize={32}\n-      sheetColumns={62}\n-      sheetRows={62}\n-      backgroundImageFn={backgroundImageFn}\n     />\n \n     <div className='emoji-mart-no-results-label'>\n@@ -110,12 +98,12 @@ class ModifierPickerMenu extends PureComponent {\n \n     return (\n       <div className='emoji-picker-dropdown__modifiers__menu' style={{ display: active ? 'block' : 'none' }} ref={this.setRef}>\n-        <button type='button' onClick={this.handleClick} data-index={1}><Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={1} backgroundImageFn={backgroundImageFn} /></button>\n-        <button type='button' onClick={this.handleClick} data-index={2}><Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={2} backgroundImageFn={backgroundImageFn} /></button>\n-        <button type='button' onClick={this.handleClick} data-index={3}><Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={3} backgroundImageFn={backgroundImageFn} /></button>\n-        <button type='button' onClick={this.handleClick} data-index={4}><Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={4} backgroundImageFn={backgroundImageFn} /></button>\n-        <button type='button' onClick={this.handleClick} data-index={5}><Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={5} backgroundImageFn={backgroundImageFn} /></button>\n-        <button type='button' onClick={this.handleClick} data-index={6}><Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={6} backgroundImageFn={backgroundImageFn} /></button>\n+        <button type='button' onClick={this.handleClick} data-index={1}><Emoji emoji='fist' size={22} skin={1} /></button>\n+        <button type='button' onClick={this.handleClick} data-index={2}><Emoji emoji='fist' size={22} skin={2} /></button>\n+        <button type='button' onClick={this.handleClick} data-index={3}><Emoji emoji='fist' size={22} skin={3} /></button>\n+        <button type='button' onClick={this.handleClick} data-index={4}><Emoji emoji='fist' size={22} skin={4} /></button>\n+        <button type='button' onClick={this.handleClick} data-index={5}><Emoji emoji='fist' size={22} skin={5} /></button>\n+        <button type='button' onClick={this.handleClick} data-index={6}><Emoji emoji='fist' size={22} skin={6} /></button>\n       </div>\n     );\n   }\n@@ -150,7 +138,7 @@ class ModifierPicker extends PureComponent {\n \n     return (\n       <div className='emoji-picker-dropdown__modifiers'>\n-        <Emoji data={nimblePickerData} sheetColumns={62} sheetRows={62} emoji='fist' set='twitter' size={22} sheetSize={32} skin={modifier} onClick={this.handleClick} backgroundImageFn={backgroundImageFn} />\n+        <Emoji emoji='fist' size={22} skin={modifier} onClick={this.handleClick} />\n         <ModifierPickerMenu active={active} onSelect={this.handleSelect} onClose={this.props.onClose} />\n       </div>\n     );\n@@ -286,16 +274,11 @@ class EmojiPickerMenuImpl extends PureComponent {\n     return (\n       <div className={classNames('emoji-picker-dropdown__menu', { selecting: modifierOpen })} style={style} ref={this.setRef}>\n         <EmojiPicker\n-          data={nimblePickerData}\n-          sheetColumns={62}\n-          sheetRows={62}\n           perLine={8}\n           emojiSize={22}\n-          sheetSize={32}\n           custom={buildCustomEmojis(custom_emojis)}\n           color=''\n           emoji=''\n-          set='twitter'\n           title={title}\n           i18n={this.getI18n()}\n           onClick={this.handleClick}\n@@ -304,7 +287,6 @@ class EmojiPickerMenuImpl extends PureComponent {\n           skin={skinTone}\n           showPreview={false}\n           showSkinTones={false}\n-          backgroundImageFn={backgroundImageFn}\n           notFound={notFoundFn}\n           autoFocus={this.state.readyToFocus}\n           emojiTooltip\n---\napp/javascript/mastodon/features/emoji/emoji_compressed.d.ts\n@@ -45,7 +45,6 @@ type EmojiCompressed = [\n   Category[],\n   Data['aliases'],\n   EmojisWithoutShortCodes,\n-  Data,\n ];\n \n /*\n---\napp/javascript/mastodon/features/emoji/emoji_compressed.js\n@@ -132,6 +132,5 @@ module.exports = JSON.parse(JSON.stringify([\n   emojiMartData.skins,\n   emojiMartData.categories,\n   emojiMartData.aliases,\n-  emojisWithoutShortCodes,\n-  emojiMartData\n+  emojisWithoutShortCodes\n ]));\n---\napp/javascript/mastodon/features/emoji/emoji_picker.js\n@@ -1,7 +0,0 @@\n-import Emoji from 'emoji-mart/dist-es/components/emoji/nimble-emoji';\n-import Picker from 'emoji-mart/dist-es/components/picker/nimble-picker';\n-\n-export {\n-  Picker,\n-  Emoji,\n-};\n---\napp/javascript/mastodon/features/emoji/emoji_picker.tsx\n@@ -0,0 +1,53 @@\n+import type { EmojiProps, PickerProps } from 'emoji-mart';\n+import EmojiRaw from 'emoji-mart/dist-es/components/emoji/nimble-emoji';\n+import PickerRaw from 'emoji-mart/dist-es/components/picker/nimble-picker';\n+\n+import { assetHost } from 'mastodon/utils/config';\n+\n+import EmojiData from './emoji_data.json';\n+\n+const backgroundImageFnDefault = () => `${assetHost}/emoji/sheet_15_1.png`;\n+\n+const Emoji = ({\n+  set = 'twitter',\n+  sheetSize = 32,\n+  sheetColumns = 62,\n+  sheetRows = 62,\n+  backgroundImageFn = backgroundImageFnDefault,\n+  ...props\n+}: EmojiProps) => {\n+  return (\n+    <EmojiRaw\n+      data={EmojiData}\n+      set={set}\n+      sheetSize={sheetSize}\n+      sheetColumns={sheetColumns}\n+      sheetRows={sheetRows}\n+      backgroundImageFn={backgroundImageFn}\n+      {...props}\n+    />\n+  );\n+};\n+\n+const Picker = ({\n+  set = 'twitter',\n+  sheetSize = 32,\n+  sheetColumns = 62,\n+  sheetRows = 62,\n+  backgroundImageFn = backgroundImageFnDefault,\n+  ...props\n+}: PickerProps) => {\n+  return (\n+    <PickerRaw\n+      data={EmojiData}\n+      set={set}\n+      sheetSize={sheetSize}\n+      sheetColumns={sheetColumns}\n+      sheetRows={sheetRows}\n+      backgroundImageFn={backgroundImageFn}\n+      {...props}\n+    />\n+  );\n+};\n+\n+export { Picker, Emoji };\n---\napp/javascript/types/emoji_picker.d.ts\n@@ -0,0 +1,8 @@\n+declare module 'emoji-mart' {\n+  interface PickerProps {\n+    sheetColumns?: number;\n+    sheetRows?: number;\n+  }\n+}\n+\n+export {};\n---\ntsconfig.json\n@@ -5,6 +5,7 @@\n     \"module\": \"CommonJS\",\n     \"moduleResolution\": \"node\",\n     \"allowJs\": true,\n+    \"resolveJsonModule\": true,\n     \"noEmit\": true,\n     \"strict\": true,\n     \"noImplicitReturns\": true,\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/actions/accounts_typed.ts\n@@ -1,7 +1,9 @@\n import { createAction } from '@reduxjs/toolkit';\n \n+import { apiRemoveAccountFromFollowers } from 'mastodon/api/accounts';\n import type { ApiAccountJSON } from 'mastodon/api_types/accounts';\n import type { ApiRelationshipJSON } from 'mastodon/api_types/relationships';\n+import { createDataLoadingThunk } from 'mastodon/store/typed_functions';\n \n export const revealAccount = createAction<{\n   id: string;\n@@ -95,3 +97,10 @@ export const fetchRelationshipsSuccess = createAction(\n   'relationships/fetch/SUCCESS',\n   actionWithSkipLoadingTrue<{ relationships: ApiRelationshipJSON[] }>,\n );\n+\n+export const removeAccountFromFollowers = createDataLoadingThunk(\n+  'accounts/remove_from_followers',\n+  ({ accountId }: { accountId: string }) =>\n+    apiRemoveAccountFromFollowers(accountId),\n+  (relationship) => ({ relationship }),\n+);\n---\napp/javascript/mastodon/api/accounts.ts\n@@ -18,3 +18,8 @@ export const apiFollowAccount = (\n \n export const apiUnfollowAccount = (id: string) =>\n   apiRequestPost<ApiRelationshipJSON>(`v1/accounts/${id}/unfollow`);\n+\n+export const apiRemoveAccountFromFollowers = (id: string) =>\n+  apiRequestPost<ApiRelationshipJSON>(\n+    `v1/accounts/${id}/remove_from_followers`,\n+  );\n---\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -18,6 +18,7 @@ import {\n   unmuteAccount,\n   pinAccount,\n   unpinAccount,\n+  removeAccountFromFollowers,\n } from 'mastodon/actions/accounts';\n import { initBlockModal } from 'mastodon/actions/blocks';\n import { mentionCompose, directCompose } from 'mastodon/actions/compose';\n@@ -152,6 +153,23 @@ const messages = defineMessages({\n     id: 'account.open_original_page',\n     defaultMessage: 'Open original page',\n   },\n+  removeFromFollowers: {\n+    id: 'account.remove_from_followers',\n+    defaultMessage: 'Remove {name} from followers',\n+  },\n+  confirmRemoveFromFollowersTitle: {\n+    id: 'confirmations.remove_from_followers.title',\n+    defaultMessage: 'Remove follower?',\n+  },\n+  confirmRemoveFromFollowersMessage: {\n+    id: 'confirmations.remove_from_followers.message',\n+    defaultMessage:\n+      '{name} will stop following you. Are you sure you want to proceed?',\n+  },\n+  confirmRemoveFromFollowersButton: {\n+    id: 'confirmations.remove_from_followers.confirm',\n+    defaultMessage: 'Remove follower',\n+  },\n });\n \n const titleFromAccount = (account: Account) => {\n@@ -494,6 +512,39 @@ export const AccountHeader: React.FC<{\n         arr.push(null);\n       }\n \n+      if (relationship?.followed_by) {\n+        const handleRemoveFromFollowers = () => {\n+          dispatch(\n+            openModal({\n+              modalType: 'CONFIRM',\n+              modalProps: {\n+                title: intl.formatMessage(\n+                  messages.confirmRemoveFromFollowersTitle,\n+                ),\n+                message: intl.formatMessage(\n+                  messages.confirmRemoveFromFollowersMessage,\n+                  { name: <strong>{account.acct}</strong> },\n+                ),\n+                confirm: intl.formatMessage(\n+                  messages.confirmRemoveFromFollowersButton,\n+                ),\n+                onConfirm: () => {\n+                  void dispatch(removeAccountFromFollowers({ accountId }));\n+                },\n+              },\n+            }),\n+          );\n+        };\n+\n+        arr.push({\n+          text: intl.formatMessage(messages.removeFromFollowers, {\n+            name: account.username,\n+          }),\n+          action: handleRemoveFromFollowers,\n+          dangerous: true,\n+        });\n+      }\n+\n       if (relationship?.muting) {\n         arr.push({\n           text: intl.formatMessage(messages.unmute, {\n@@ -592,6 +643,8 @@ export const AccountHeader: React.FC<{\n \n     return arr;\n   }, [\n+    dispatch,\n+    accountId,\n     account,\n     relationship,\n     permissions,\n---\napp/javascript/mastodon/locales/en.json\n@@ -62,6 +62,7 @@\n   \"account.open_original_page\": \"Open original page\",\n   \"account.posts\": \"Posts\",\n   \"account.posts_with_replies\": \"Posts and replies\",\n+  \"account.remove_from_followers\": \"Remove {name} from followers\",\n   \"account.report\": \"Report @{name}\",\n   \"account.requested\": \"Awaiting approval. Click to cancel follow request\",\n   \"account.requested_follow\": \"{name} has requested to follow you\",\n@@ -233,6 +234,9 @@\n   \"confirmations.redraft.confirm\": \"Delete & redraft\",\n   \"confirmations.redraft.message\": \"Are you sure you want to delete this post and re-draft it? Favorites and boosts will be lost, and replies to the original post will be orphaned.\",\n   \"confirmations.redraft.title\": \"Delete & redraft post?\",\n+  \"confirmations.remove_from_followers.confirm\": \"Remove follower\",\n+  \"confirmations.remove_from_followers.message\": \"{name} will stop following you. Are you sure you want to proceed?\",\n+  \"confirmations.remove_from_followers.title\": \"Remove follower?\",\n   \"confirmations.reply.confirm\": \"Reply\",\n   \"confirmations.reply.message\": \"Replying now will overwrite the message you are currently composing. Are you sure you want to proceed?\",\n   \"confirmations.reply.title\": \"Overwrite post?\",\n---\napp/javascript/mastodon/reducers/relationships.ts\n@@ -24,6 +24,7 @@ import {\n   pinAccountSuccess,\n   unpinAccountSuccess,\n   fetchRelationshipsSuccess,\n+  removeAccountFromFollowers,\n } from '../actions/accounts_typed';\n import {\n   blockDomainSuccess,\n@@ -109,7 +110,8 @@ export const relationshipsReducer: Reducer<State> = (\n     unmuteAccountSuccess.match(action) ||\n     pinAccountSuccess.match(action) ||\n     unpinAccountSuccess.match(action) ||\n-    isFulfilled(submitAccountNote)(action)\n+    isFulfilled(submitAccountNote)(action) ||\n+    isFulfilled(removeAccountFromFollowers)(action)\n   )\n     return normalizeRelationship(state, action.payload.relationship);\n   else if (fetchRelationshipsSuccess.match(action))\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nExtends the docs on local development with some information that I was missing when setting up mine:\r\n\r\n- Adds a TOC for the documented environments\r\n- Adds a step around starting the database services on macOS\r\n- Adds a section on Linux which simply links off to https://docs.joinmastodon.org/dev/setup/ (I'm not sure about how up-to-date these docs are \u2013 the Vagrant instructions are quite different from the ones in this file. So this might need further tweaking.)\r\n- Adds a \"Next steps\" section with some key information that could previously be found in the main docs only\n\n---\n\nChoice A:\napp/javascript/styles/mastodon/admin.scss\n@@ -3,7 +3,7 @@\n @use 'variables' as *;\n \n $no-columns-breakpoint: 890px;\n-$sidebar-width: 300px;\n+$sidebar-width: 360px;\n $content-width: 840px;\n \n .admin-wrapper {\n@@ -180,8 +180,8 @@ $content-width: 840px;\n   .content {\n     padding-top: 55px;\n     padding-bottom: 20px;\n-    padding-inline-start: 25px;\n-    padding-inline-end: 15px;\n+    padding-inline-start: 15px;\n+    padding-inline-end: 5px;\n \n     @media screen and (max-width: $no-columns-breakpoint) {\n       max-width: none;\n---\n\n\n---\n\nChoice B:\ndocs/DEVELOPMENT.md\n@@ -7,6 +7,19 @@ what changes are desirable and what general processes to use.\n \n ## Environments\n \n+The following instructions will guide you through the process of setting up a local development instance of Mastodon on your computer.\n+\n+There are instructions for these environments:\n+\n+- [Vagrant](#vagrant)\n+- [macOS](#macos)\n+- [Linux](#linux)\n+- [Docker](#docker)\n+- [Dev Containers](#dev-containers)\n+- [GitHub Codespaces](#github-codespaces)\n+\n+Once completed, continue with the [Next steps](#next-steps) section below.\n+\n ### Vagrant\n \n A **Vagrant** configuration is included for development purposes. To use it,\n@@ -28,11 +41,17 @@ To set up **macOS** for native development, complete the following steps:\n   to install the required project dependencies\n - Use a Ruby version manager to activate the ruby in `.ruby-version` and run\n   `nvm use` to activate the node version from `.nvmrc`\n-- Run the `bin/setup` script, which will install the required ruby gems and node\n+- Start the database services by running `brew services start postgresql` and\n+  `brew services start redis`\n+- Run `RAILS_ENV=development bin/setup`, which will install the required ruby gems and node\n   packages and prepare the database for local development\n - Finally, run the `bin/dev` script which will launch services via `overmind`\n   (if installed) or `foreman`\n \n+### Linux\n+\n+The Mastodon documentation has a [guide on installing Mastodon from source](https://docs.joinmastodon.org/dev/setup/#manual) on Linux.\n+\n ### Docker\n \n For production hosting and deployment with **Docker**, use the `Dockerfile` and\n@@ -66,10 +85,17 @@ development environment configured with the software needed for this project.\n - Wait for an _Open in Browser_ prompt. This will open Mastodon\n - On the _Ports_ tab \"stream\" setting change _Port visibility_ \u2192 _Public_\n \n+## Next steps\n+\n+- Once you have successfully set up a development environment, it will be available on http://localhost:3000\n+- Log in as the default admin user with the username `admin@mastodon.local` and the password `mastodonadmin`.\n+- Check out the [Mastodon docs] for tips on working with emails in development (you'll need this when creating new user accounts) as well as a list of useful commands for testing and updating your dev instance.\n+\n [codespace]: https://codespaces.new/mastodon/mastodon?quickstart=1&devcontainer_path=.devcontainer%2Fcodespaces%2Fdevcontainer.json\n [CONTRIBUTING]: ../CONTRIBUTING.md\n [Dev Container extension]: https://containers.dev/supporting#dev-containers\n [Development Containers]: https://containers.dev/supporting\n [Docker]: https://docs.docker.com\n [GitHub Codespaces]: https://docs.github.com/en/codespaces\n [Homebrew]: https://brew.sh\n+[Mastodon docs]: https://docs.joinmastodon.org/dev/setup/#working-with-emails-in-development\n---\n\n\n---\n\nChoice C:\napp/services/activitypub/fetch_featured_collection_service.rb\n@@ -9,6 +9,7 @@ def call(account, **options)\n     @account = account\n     @options = options\n     @json    = fetch_collection(options[:collection].presence || @account.featured_collection_url)\n+    return if @json.blank?\n \n     process_items(collection_items(@json))\n   end\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -201,7 +201,7 @@ group :development, :test do\n   gem 'faker', '~> 3.2'\n \n   # Generate factory objects\n-  gem 'fabrication', '~> 2.30'\n+  gem 'fabrication'\n \n   # Profiling tools\n   gem 'memory_profiler', require: false\n---\nGemfile.lock\n@@ -223,7 +223,7 @@ GEM\n       tzinfo\n     excon (1.2.5)\n       logger\n-    fabrication (2.31.0)\n+    fabrication (3.0.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n     faraday (2.13.1)\n@@ -972,7 +972,7 @@ DEPENDENCIES\n   doorkeeper (~> 5.6)\n   dotenv\n   email_spec\n-  fabrication (~> 2.30)\n+  fabrication\n   faker (~> 3.2)\n   faraday-httpclient\n   fast_blank (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [database_cleaner-active_record](https://redirect.github.com/DatabaseCleaner/database_cleaner-active_record) | `2.2.0` -> `2.2.1` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/database_cleaner-active_record/2.2.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/database_cleaner-active_record/2.2.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/database_cleaner-active_record/2.2.0/2.2.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/database_cleaner-active_record/2.2.0/2.2.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>DatabaseCleaner/database_cleaner-active_record (database_cleaner-active_record)</summary>\n\n### [`v2.2.1`](https://redirect.github.com/DatabaseCleaner/database_cleaner-active_record/blob/HEAD/CHANGELOG.md#v221-2025-05-13)\n\n[Compare Source](https://redirect.github.com/DatabaseCleaner/database_cleaner-active_record/compare/v2.2.0...v2.2.1)\n\n-   [https://github.com/DatabaseCleaner/database_cleaner-active_record/pull/111](https://redirect.github.com/DatabaseCleaner/database_cleaner-active_record/pull/111) by [@&#8203;tagliala](https://redirect.github.com/tagliala)\n-   [https://github.com/DatabaseCleaner/database_cleaner-active_record/pull/104](https://redirect.github.com/DatabaseCleaner/database_cleaner-active_record/pull/104) by [@&#8203;fatkodima](https://redirect.github.com/fatkodima)\n-   [https://github.com/DatabaseCleaner/database_cleaner-active_record/pull/118](https://redirect.github.com/DatabaseCleaner/database_cleaner-active_record/pull/118) by [@&#8203;pat](https://redirect.github.com/pat), [@&#8203;thegeorgeous](https://redirect.github.com/thegeorgeous), and [@&#8203;nnishimura](https://redirect.github.com/nnishimura)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC4xMS45IiwidXBkYXRlZEluVmVyIjoiNDAuMTEuOSIsInRhcmdldEJyYW5jaCI6Im1haW4iLCJsYWJlbHMiOlsiZGVwZW5kZW5jaWVzIiwicnVieSJdfQ==-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -171,7 +171,7 @@ GEM\n     css_parser (1.21.1)\n       addressable\n     csv (3.3.4)\n-    database_cleaner-active_record (2.2.0)\n+    database_cleaner-active_record (2.2.1)\n       activerecord (>= 5.a)\n       database_cleaner-core (~> 2.0.0)\n     database_cleaner-core (2.0.1)\n---\n\n\n---\n\nChoice B:\napp/javascript/styles/mastodon/admin.scss\n@@ -114,15 +114,14 @@ $content-width: 840px;\n \n       a {\n         font-size: 14px;\n-        display: block;\n+        display: flex;\n+        align-items: center;\n+        gap: 6px;\n         padding: 15px;\n         color: $darker-text-color;\n         text-decoration: none;\n         transition: all 200ms linear;\n         transition-property: color, background-color;\n-        white-space: nowrap;\n-        overflow: hidden;\n-        text-overflow: ellipsis;\n \n         &:hover {\n           color: $primary-text-color;\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -9177,14 +9177,14 @@ __metadata:\n   linkType: hard\n \n \"pino-http@npm:^10.0.0\":\n-  version: 10.4.0\n-  resolution: \"pino-http@npm:10.4.0\"\n+  version: 10.5.0\n+  resolution: \"pino-http@npm:10.5.0\"\n   dependencies:\n     get-caller-file: \"npm:^2.0.5\"\n     pino: \"npm:^9.0.0\"\n     pino-std-serializers: \"npm:^7.0.0\"\n-    process-warning: \"npm:^4.0.0\"\n-  checksum: 10c0/64144e2c94e939070f56ad82dfb012b6a98d21582e0660cf821e7cee64d4e06f7724aa40bc5bf9cd1254d58ab7cbd972dec287b7989eba647d384f6edd8d95fd\n+    process-warning: \"npm:^5.0.0\"\n+  checksum: 10c0/17597d653a4088f7faed4d58500a5ef51d4d05247307696760006313c33c1d23177af98fb902e15b8e2cd92d81306c884673f841ba5b9bf0c064802f3c0bd775\n   languageName: node\n   linkType: hard\n \n@@ -9748,13 +9748,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"process-warning@npm:^4.0.0\":\n-  version: 4.0.0\n-  resolution: \"process-warning@npm:4.0.0\"\n-  checksum: 10c0/5312a72b69d37a1b82ad03f3dfa0090dab3804a8fd995d06c28e3c002852bd82f5584217d9f4a3f197892bb2afc22d57e2c662c7e906b5abb48c0380c7b0880d\n-  languageName: node\n-  linkType: hard\n-\n \"process-warning@npm:^5.0.0\":\n   version: 5.0.0\n   resolution: \"process-warning@npm:5.0.0\"\n---\n\n\n---\n\nChoice D:\napp/javascript/styles/mastodon/components.scss\n@@ -10399,6 +10399,10 @@ noscript {\n       bdi {\n         color: $darker-text-color;\n       }\n+\n+      .account__avatar {\n+        flex: 0 0 auto;\n+      }\n     }\n \n     &__content {\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [pg-connection-string](https://redirect.github.com/brianc/node-postgres/tree/master/packages/pg-connection-string) ([source](https://redirect.github.com/brianc/node-postgres/tree/HEAD/packages/pg-connection-string)) | [`2.8.5` -> `2.9.0`](https://renovatebot.com/diffs/npm/pg-connection-string/2.8.5/2.9.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/pg-connection-string/2.9.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/pg-connection-string/2.9.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/pg-connection-string/2.8.5/2.9.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/pg-connection-string/2.8.5/2.9.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>brianc/node-postgres (pg-connection-string)</summary>\n\n### [`v2.9.0`](https://redirect.github.com/brianc/node-postgres/blob/HEAD/CHANGELOG.md#v290)\n\n[Compare Source](https://redirect.github.com/brianc/node-postgres/compare/pg-connection-string@2.8.5...pg-connection-string@2.9.0)\n\n-   Add better support for [unix domain socket](https://redirect.github.com/brianc/node-postgres/pull/487) connections\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC43LjEiLCJ1cGRhdGVkSW5WZXIiOiI0MC43LjEiLCJ0YXJnZXRCcmFuY2giOiJtYWluIiwibGFiZWxzIjpbImRlcGVuZGVuY2llcyIsImphdmFzY3JpcHQiXX0=-->\n\n\n---\n\nChoice A:\ndocker-compose.yml\n@@ -115,7 +115,7 @@ services:\n     volumes:\n       - ./public/system:/mastodon/public/system\n     healthcheck:\n-      test: ['CMD-SHELL', \"ps aux | grep '[s]idekiq\\ 6' || false\"]\n+      test: ['CMD-SHELL', \"ps aux | grep '[s]idekiq\\ 7' || false\"]\n \n   ## Uncomment to enable federation with tor instances along with adding the following ENV variables\n   ## http_hidden_proxy=http://privoxy:8118\n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.222.3', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1088.0)\n+    aws-sdk-core (3.222.2)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -931,7 +933,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.222.3)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -12474,9 +12474,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.5\":\n-  version: 2.8.5\n-  resolution: \"pg-connection-string@npm:2.8.5\"\n-  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n+  version: 2.9.0\n+  resolution: \"pg-connection-string@npm:2.9.0\"\n+  checksum: 10c0/7145d00688200685a9d9931a7fc8d61c75f348608626aef88080ece956ceb4ff1cbdee29c3284e41b7a3345bab0e4f50f9edc256e270bfa3a563af4ea78bb490\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -68,15 +68,15 @@ type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n \n export const QuotedStatus: React.FC<{\n   quote: QuoteMap;\n+  contextType?: string;\n   variant?: 'full' | 'link';\n   nestingLevel?: number;\n-}> = ({ quote, nestingLevel = 1, variant = 'full' }) => {\n+}> = ({ quote, contextType, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n   const state = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n-\n   let quoteError: React.ReactNode = null;\n \n   if (state === 'deleted') {\n@@ -131,10 +131,16 @@ export const QuotedStatus: React.FC<{\n   return (\n     <QuoteWrapper>\n       {/* @ts-expect-error Status is not yet typed */}\n-      <StatusContainer isQuotedPost id={quotedStatusId} avatarSize={40}>\n+      <StatusContainer\n+        isQuotedPost\n+        id={quotedStatusId}\n+        contextType={contextType}\n+        avatarSize={40}\n+      >\n         {canRenderChildQuote && (\n           <QuotedStatus\n             quote={childQuote}\n+            contextType={contextType}\n             variant={\n               nestingLevel === MAX_QUOTE_POSTS_NESTING_LEVEL ? 'link' : 'full'\n             }\n@@ -148,6 +154,7 @@ export const QuotedStatus: React.FC<{\n \n interface StatusQuoteManagerProps {\n   id: string;\n+  contextType?: string;\n   [key: string]: unknown;\n }\n \n@@ -168,7 +175,7 @@ export const StatusQuoteManager = (props: StatusQuoteManagerProps) => {\n   if (quote) {\n     return (\n       <StatusContainer {...props}>\n-        <QuotedStatus quote={quote} />\n+        <QuotedStatus quote={quote} contextType={props.contextType} />\n       </StatusContainer>\n     );\n   }\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [pg](https://redirect.github.com/brianc/node-postgres) ([source](https://redirect.github.com/brianc/node-postgres/tree/HEAD/packages/pg)) | [`8.15.6` -> `8.16.0`](https://renovatebot.com/diffs/npm/pg/8.15.6/8.16.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/pg/8.16.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/pg/8.16.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/pg/8.15.6/8.16.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/pg/8.15.6/8.16.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>brianc/node-postgres (pg)</summary>\n\n### [`v8.16.0`](https://redirect.github.com/brianc/node-postgres/blob/HEAD/CHANGELOG.md#pg8160)\n\n[Compare Source](https://redirect.github.com/brianc/node-postgres/compare/pg@8.15.6...pg@8.16.0)\n\n-   Add support for [min connection pool size](https://redirect.github.com/brianc/node-postgres/pull/3438).\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC43LjEiLCJ1cGRhdGVkSW5WZXIiOiI0MC43LjEiLCJ0YXJnZXRCcmFuY2giOiJtYWluIiwibGFiZWxzIjpbImRlcGVuZGVuY2llcyIsImphdmFzY3JpcHQiXX0=-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -711,7 +711,7 @@ GEM\n     rotp (6.3.0)\n     rouge (4.5.1)\n     rpam2 (4.0.2)\n-    rqrcode (3.0.0)\n+    rqrcode (3.1.0)\n       chunky_png (~> 1.0)\n       rqrcode_core (~> 2.0)\n     rqrcode_core (2.0.0)\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/components/hover_card_account.tsx\n@@ -45,6 +45,19 @@ export const HoverCardAccount = forwardRef<\n \n   const { familiarFollowers } = useFetchFamiliarFollowers({ accountId });\n \n+  const relationship = useAppSelector((state) =>\n+    accountId ? state.relationships.get(accountId) : undefined,\n+  );\n+  const isMutual = relationship?.followed_by && relationship.following;\n+  const isFollower = relationship?.followed_by;\n+  const hasRelationshipLoaded = !!relationship;\n+\n+  const shouldDisplayFamiliarFollowers =\n+    familiarFollowers.length > 0 &&\n+    hasRelationshipLoaded &&\n+    !isMutual &&\n+    !isFollower;\n+\n   return (\n     <div\n       ref={ref}\n@@ -85,7 +98,7 @@ export const HoverCardAccount = forwardRef<\n               value={account.followers_count}\n               renderer={FollowersCounter}\n             />\n-            {familiarFollowers.length > 0 && (\n+            {shouldDisplayFamiliarFollowers && (\n               <>\n                 &middot;\n                 <div className='hover-card__familiar-followers'>\n@@ -101,6 +114,22 @@ export const HoverCardAccount = forwardRef<\n                 </div>\n               </>\n             )}\n+            {(isMutual || isFollower) && (\n+              <>\n+                &middot;\n+                {isMutual ? (\n+                  <FormattedMessage\n+                    id='account.mutual'\n+                    defaultMessage='You follow each other'\n+                  />\n+                ) : (\n+                  <FormattedMessage\n+                    id='account.follows_you'\n+                    defaultMessage='Follows you'\n+                  />\n+                )}\n+              </>\n+            )}\n           </div>\n \n           <FollowButton accountId={accountId} />\n---\napp/javascript/styles/mastodon/components.scss\n@@ -10766,7 +10766,7 @@ noscript {\n     display: flex;\n     align-items: center;\n     flex-wrap: wrap;\n-    gap: 10px;\n+    gap: 2px 10px;\n   }\n \n   &__numbers {\n---\n\n\n---\n\nChoice C:\napp/views/layouts/application.html.haml\n@@ -28,7 +28,7 @@\n     = theme_style_tags current_theme\n     = vite_client_tag\n     = vite_react_refresh_tag\n-    = vite_polyfill_tag crossorigin: 'anonymous'\n+    = vite_polyfills_tag\n     -# Needed for the wicg-inert polyfill. It needs to be on it's own <style> tag, with this `id`\n     = vite_stylesheet_tag 'styles/entrypoints/inert.scss', media: 'all', id: 'inert-style'\n     = vite_typescript_tag 'common.ts', crossorigin: 'anonymous'\n---\napp/views/layouts/embedded.html.haml\n@@ -13,7 +13,7 @@\n \n     = vite_client_tag\n     = vite_react_refresh_tag\n-    = vite_polyfill_tag crossorigin: 'anonymous'\n+    = vite_polyfills_tag\n     = theme_style_tags 'mastodon-light'\n     = vite_preload_file_tag \"mastodon/locales/#{I18n.locale}.json\"\n     = render_initial_state\n---\napp/views/layouts/error.html.haml\n@@ -7,7 +7,7 @@\n     %meta{ content: 'width=device-width,initial-scale=1', name: 'viewport' }/\n     = vite_client_tag\n     = vite_react_refresh_tag\n-    = vite_polyfill_tag crossorigin: 'anonymous'\n+    = vite_polyfills_tag\n     = theme_style_tags Setting.default_settings['theme']\n     = vite_typescript_tag 'error.ts', crossorigin: 'anonymous'\n   %body.error\n---\nlib/vite_ruby/sri_extensions.rb\n@@ -120,10 +120,12 @@ def vite_preload_file_tag(name,\n     # Ignore this error, it is not critical if the file is not preloaded\n   end\n \n-  def vite_polyfill_tag(**)\n-    entry = vite_manifest.path_and_integrity_for('polyfill', type: :virtual)\n+  def vite_polyfills_tag(crossorigin: 'anonymous', **)\n+    return if ViteRuby.instance.dev_server_running?\n \n-    javascript_include_tag(type: 'module', src: entry[:path], integrity: entry[:integrity], **)\n+    entry = vite_manifest.path_and_integrity_for('polyfills', type: :virtual)\n+\n+    javascript_include_tag(entry[:path], type: 'module', integrity: entry[:integrity], crossorigin: crossorigin, **)\n   end\n end\n \n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -12473,10 +12473,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.5\":\n-  version: 2.8.5\n-  resolution: \"pg-connection-string@npm:2.8.5\"\n-  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n+\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.9.0\":\n+  version: 2.9.0\n+  resolution: \"pg-connection-string@npm:2.9.0\"\n+  checksum: 10c0/7145d00688200685a9d9931a7fc8d61c75f348608626aef88080ece956ceb4ff1cbdee29c3284e41b7a3345bab0e4f50f9edc256e270bfa3a563af4ea78bb490\n   languageName: node\n   linkType: hard\n \n@@ -12494,23 +12494,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.9.6\":\n-  version: 3.9.6\n-  resolution: \"pg-pool@npm:3.9.6\"\n+\"pg-pool@npm:^3.10.0\":\n+  version: 3.10.0\n+  resolution: \"pg-pool@npm:3.10.0\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/458d50a4e7260977f076472d40d0796fa8b513af7e3ce1bf65557e10724e9c13653661c883f6650dff92d0a1a5ff4e7a001a8262b786c1ad4cfbd35c3354353e\n+  checksum: 10c0/b36162dc98c0ad88cd26f3d65f3e3932c3f870abe7a88905f16fc98282e8131692903e482720ebc9698cb08851c9b19242ff16a50af7f9434c8bb0b5d33a9a9a\n   languageName: node\n   linkType: hard\n \n-\"pg-protocol@npm:*, pg-protocol@npm:^1.9.5\":\n-  version: 1.9.5\n-  resolution: \"pg-protocol@npm:1.9.5\"\n-  checksum: 10c0/5cb3444cf973adadd22ee9ea26bb1674f0d980ef8f9c66d426bbe67fc9cb5f0ca4a204bf7e432b3ab2ab59ac8227f4b18ab3b2e64eaed537e037e916991c7319\n+\"pg-protocol@npm:*, pg-protocol@npm:^1.10.0\":\n+  version: 1.10.0\n+  resolution: \"pg-protocol@npm:1.10.0\"\n+  checksum: 10c0/7d0d64fe9df50262d907fd476454e1e36f41f5f66044c3ba6aa773fb8add1d350a9c162306e5c33e99bdfbdcc1140dd4ca74f66eda41d0aaceb5853244dcdb65\n   languageName: node\n   linkType: hard\n \n-\"pg-types@npm:^2.1.0\":\n+\"pg-types@npm:2.2.0\":\n   version: 2.2.0\n   resolution: \"pg-types@npm:2.2.0\"\n   dependencies:\n@@ -12539,15 +12539,15 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.15.6\n-  resolution: \"pg@npm:8.15.6\"\n+  version: 8.16.0\n+  resolution: \"pg@npm:8.16.0\"\n   dependencies:\n     pg-cloudflare: \"npm:^1.2.5\"\n-    pg-connection-string: \"npm:^2.8.5\"\n-    pg-pool: \"npm:^3.9.6\"\n-    pg-protocol: \"npm:^1.9.5\"\n-    pg-types: \"npm:^2.1.0\"\n-    pgpass: \"npm:1.x\"\n+    pg-connection-string: \"npm:^2.9.0\"\n+    pg-pool: \"npm:^3.10.0\"\n+    pg-protocol: \"npm:^1.10.0\"\n+    pg-types: \"npm:2.2.0\"\n+    pgpass: \"npm:1.0.5\"\n   peerDependencies:\n     pg-native: \">=3.0.1\"\n   dependenciesMeta:\n@@ -12556,11 +12556,11 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/d4dc81020ebd137b6cf6228e43c643067acb8240079a07f7b9a7e97be0f33ad4d8c6f2a3f5b512ad87180e3d48e651fbd72885aa807ab58a715da8f3efea0fab\n+  checksum: 10c0/24542229c7e5cbf69d654de32e8cdc8302c73f1338e56728543cb16364fb319d5689e03fa704b69a208105c7065c867cfccb9dbccccea2020bb5c64ead785713\n   languageName: node\n   linkType: hard\n \n-\"pgpass@npm:1.x\":\n+\"pgpass@npm:1.0.5\":\n   version: 1.0.5\n   resolution: \"pgpass@npm:1.0.5\"\n   dependencies:\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [aws-sdk-core](https://redirect.github.com/aws/aws-sdk-ruby) ([source](https://redirect.github.com/aws/aws-sdk-ruby/tree/HEAD/gems/aws-sdk-core), [changelog](https://redirect.github.com/aws/aws-sdk-ruby/tree/version-3/gems/aws-sdk-core/CHANGELOG.md)) | `'< 3.216.0'` -> `'< 3.224.1'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/aws-sdk-core/3.224.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/aws-sdk-core/3.224.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/aws-sdk-core/3.215.1/3.224.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/aws-sdk-core/3.215.1/3.224.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>aws/aws-sdk-ruby (aws-sdk-core)</summary>\n\n### [`v3.224.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32240-2025-05-12)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n-   Feature - Support `ENV['AWS_DISABLE_HOST_PREFIX_INJECTION']` and `disable_host_prefix_injection` shared config to disable host prefix injection for all services.\n\n### [`v3.223.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32230-2025-05-01)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n### [`v3.222.3`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32223-2025-04-28)\n\n-   Issue - Do not dynamically create operation methods from the API. ([#&#8203;3234](https://redirect.github.com/aws/aws-sdk-ruby/issues/3234))\n\n### [`v3.222.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32222-2025-04-16)\n\n-   Issue - Additional metrics collection for credentials in the User-Agent plugin.\n\n### [`v3.222.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32221-2025-03-28)\n\n-   Issue - Allow explicit modeled headers to override prefixed headers for `rest` protocols.\n\n### [`v3.222.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32220-2025-03-27)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - This release adds AwsAdditionalDetails in the CreateTokenWithIAM API response.\n\n### [`v3.221.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32210-2025-03-24)\n\n-   Feature - Add `logger` as an explicit dependency for Ruby 3.5.\n-   Issue - Enable ALPN over TLS for H2 Connection by default.\n-   Issue - Fix HTTP-2 connections to properly use config values configured on the client.\n\n### [`v3.220.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32202-2025-03-20)\n\n-   Issue - Enable ALPN over TLS for H2 by default.\n\n### [`v3.220.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32201-2025-03-06)\n\n-   Issue - Convert stubs at request time.\n\n### [`v3.220.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32200-2025-03-04)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n### [`v3.219.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32190-2025-02-18)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.218.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32181-2025-02-07)\n\n-   Issue - Add handling of block in ExtendedSession delegation ([#&#8203;3178](https://redirect.github.com/aws/aws-sdk-ruby/issues/3178)).\n\n### [`v3.218.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32180-2025-02-06)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.217.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32171-2025-01-30)\n\n-   Issue - Add `transfer-encoding` and `connection` to list of unsigned sigv4 headers.\n\n### [`v3.217.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32170-2025-01-24)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Fixed typos in the descriptions.\n\n### [`v3.216.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32161-2025-01-22)\n\n-   Issue - Use epoch seconds instead of milliseconds in cbor encode/decode.\n\n-   Issue - Add handling of block in response delegation ([#&#8203;3169](https://redirect.github.com/aws/aws-sdk-ruby/issues/3169)).\n\n### [`v3.216.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32160-2025-01-15)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n-   Feature - Always calculate request checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:request_checksum_calculation`, in the shared config file as `request_checksum_calculation`, and in the ENV as `ENV['AWS_REQUEST_CHECKSUM_CALCULATION']`.\n\n-   Feature - Always validate response checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:response_checksum_validation`, in the shared config file as `response_checksum_validation`, and in the ENV as `ENV['AWS_RESPONSE_CHECKSUM_VALIDATION']`.\n\n-   Feature - Support CRC64NVME checksums through the `aws-crt` gem.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC43LjEiLCJ1cGRhdGVkSW5WZXIiOiI0MC43LjEiLCJ0YXJnZXRCcmFuY2giOiJtYWluIiwibGFiZWxzIjpbImRlcGVuZGVuY2llcyIsInJ1YnkiXX0=-->\n\n\n---\n\nChoice A:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.224.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1103.0)\n+    aws-sdk-core (3.224.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.224.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -7274,10 +7274,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"decimal.js@npm:^10.4.2, decimal.js@npm:^10.4.3\":\n-  version: 10.4.3\n-  resolution: \"decimal.js@npm:10.4.3\"\n-  checksum: 10c0/6d60206689ff0911f0ce968d40f163304a6c1bc739927758e6efc7921cfa630130388966f16bf6ef6b838cb33679fbe8e7a78a2f3c478afce841fd55ac8fb8ee\n+\"decimal.js@npm:^10.4.2, decimal.js@npm:^10.4.3, decimal.js@npm:^10.5.0\":\n+  version: 10.5.0\n+  resolution: \"decimal.js@npm:10.5.0\"\n+  checksum: 10c0/785c35279df32762143914668df35948920b6c1c259b933e0519a69b7003fc0a5ed2a766b1e1dda02574450c566b21738a45f15e274b47c2ac02072c0d1f3ac3\n   languageName: node\n   linkType: hard\n \n@@ -8996,7 +8996,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"form-data@npm:^4.0.0, form-data@npm:^4.0.1\":\n+\"form-data@npm:^4.0.0\":\n   version: 4.0.1\n   resolution: \"form-data@npm:4.0.1\"\n   dependencies:\n@@ -11373,13 +11373,12 @@ __metadata:\n   linkType: hard\n \n \"jsdom@npm:^26.0.0\":\n-  version: 26.0.0\n-  resolution: \"jsdom@npm:26.0.0\"\n+  version: 26.1.0\n+  resolution: \"jsdom@npm:26.1.0\"\n   dependencies:\n     cssstyle: \"npm:^4.2.1\"\n     data-urls: \"npm:^5.0.0\"\n-    decimal.js: \"npm:^10.4.3\"\n-    form-data: \"npm:^4.0.1\"\n+    decimal.js: \"npm:^10.5.0\"\n     html-encoding-sniffer: \"npm:^4.0.0\"\n     http-proxy-agent: \"npm:^7.0.2\"\n     https-proxy-agent: \"npm:^7.0.6\"\n@@ -11389,20 +11388,20 @@ __metadata:\n     rrweb-cssom: \"npm:^0.8.0\"\n     saxes: \"npm:^6.0.0\"\n     symbol-tree: \"npm:^3.2.4\"\n-    tough-cookie: \"npm:^5.0.0\"\n+    tough-cookie: \"npm:^5.1.1\"\n     w3c-xmlserializer: \"npm:^5.0.0\"\n     webidl-conversions: \"npm:^7.0.0\"\n     whatwg-encoding: \"npm:^3.1.1\"\n     whatwg-mimetype: \"npm:^4.0.0\"\n-    whatwg-url: \"npm:^14.1.0\"\n+    whatwg-url: \"npm:^14.1.1\"\n     ws: \"npm:^8.18.0\"\n     xml-name-validator: \"npm:^5.0.0\"\n   peerDependencies:\n     canvas: ^3.0.0\n   peerDependenciesMeta:\n     canvas:\n       optional: true\n-  checksum: 10c0/e48725ba4027edcfc9bca5799eaec72c6561ecffe3675a8ff87fe9c3541ca4ff9f82b4eff5b3d9c527302da0d859b2f60e9364347a5d42b77f5c76c436c569dc\n+  checksum: 10c0/5b14a5bc32ce077a06fb42d1ab95b1191afa5cbbce8859e3b96831c5143becbbcbf0511d4d4934e922d2901443ced2cdc3b734c1cf30b5f73b3e067ce457d0f4\n   languageName: node\n   linkType: hard\n \n@@ -17446,12 +17445,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"tough-cookie@npm:^5.0.0\":\n-  version: 5.0.0\n-  resolution: \"tough-cookie@npm:5.0.0\"\n+\"tough-cookie@npm:^5.1.1\":\n+  version: 5.1.2\n+  resolution: \"tough-cookie@npm:5.1.2\"\n   dependencies:\n     tldts: \"npm:^6.1.32\"\n-  checksum: 10c0/4a69c885bf6f45c5a64e60262af99e8c0d58a33bd3d0ce5da62121eeb9c00996d0128a72df8fc4614cbde59cc8b70aa3e21e4c3c98c2bbde137d7aba7fa00124\n+  checksum: 10c0/5f95023a47de0f30a902bba951664b359725597d8adeabc66a0b93a931c3af801e1e697dae4b8c21a012056c0ea88bd2bf4dfe66b2adcf8e2f42cd9796fe0626\n   languageName: node\n   linkType: hard\n \n@@ -17480,12 +17479,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"tr46@npm:^5.0.0\":\n-  version: 5.0.0\n-  resolution: \"tr46@npm:5.0.0\"\n+\"tr46@npm:^5.1.0\":\n+  version: 5.1.0\n+  resolution: \"tr46@npm:5.1.0\"\n   dependencies:\n     punycode: \"npm:^2.3.1\"\n-  checksum: 10c0/1521b6e7bbc8adc825c4561480f9fe48eb2276c81335eed9fa610aa4c44a48a3221f78b10e5f18b875769eb3413e30efbf209ed556a17a42aa8d690df44b7bee\n+  checksum: 10c0/d761f7144e0cb296187674ef245c74f761e334d7cf25ca73ef60e4c72c097c75051031c093fa1a2fee04b904977b316716a7915854bcae8fb1a371746513cbe8\n   languageName: node\n   linkType: hard\n \n@@ -18520,13 +18519,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"whatwg-url@npm:^14.0.0, whatwg-url@npm:^14.1.0\":\n-  version: 14.1.0\n-  resolution: \"whatwg-url@npm:14.1.0\"\n+\"whatwg-url@npm:^14.0.0, whatwg-url@npm:^14.1.1\":\n+  version: 14.2.0\n+  resolution: \"whatwg-url@npm:14.2.0\"\n   dependencies:\n-    tr46: \"npm:^5.0.0\"\n+    tr46: \"npm:^5.1.0\"\n     webidl-conversions: \"npm:^7.0.0\"\n-  checksum: 10c0/f00104f1c67ce086ba8ffedab529cbbd9aefd8c0a6555320026de7aeff31f91c38680f95818b140a7c9cc657cde3781e567835dda552ddb1e2b8faaba0ac3cb6\n+  checksum: 10c0/f746fc2f4c906607d09537de1227b13f9494c171141e5427ed7d2c0dd0b6a48b43d8e71abaae57d368d0c06b673fd8ec63550b32ad5ed64990c7b0266c2b4272\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\ndocs/DEVELOPMENT.md\n@@ -37,14 +37,17 @@ complete the following steps:\n To set up **macOS** for native development, complete the following steps:\n \n - Install [Homebrew] and run:\n-  `brew install postgresql@14 redis imagemagick libidn nvm`\n+  `brew install postgresql@14 redis libidn nvm vips`\n   to install the required project dependencies\n - Use a Ruby version manager to activate the ruby in `.ruby-version` and run\n   `nvm use` to activate the node version from `.nvmrc`\n - Start the database services by running `brew services start postgresql` and\n   `brew services start redis`\n - Run `RAILS_ENV=development bin/setup`, which will install the required ruby gems and node\n   packages and prepare the database for local development\n+\n+  (Note: If you are on Apple Silicon and get an error related to `libidn`, you should be able to fix this by running `gem install idn-ruby -- --with-idn-dir=$(brew --prefix libidn)`, then re-running the command above.)\n+\n - Finally, run the `bin/dev` script which will launch services via `overmind`\n   (if installed) or `foreman`\n \n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -13,7 +13,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.225.2', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -93,21 +93,23 @@ GEM\n     annotaterb (4.15.0)\n     ast (2.4.3)\n     attr_required (1.0.2)\n-    aws-eventstream (1.3.2)\n-    aws-partitions (1.1103.0)\n-    aws-sdk-core (3.215.1)\n+    aws-eventstream (1.4.0)\n+    aws-partitions (1.1112.0)\n+    aws-sdk-core (3.225.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n     aws-sdk-s3 (1.177.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sdk-kms (~> 1)\n       aws-sigv4 (~> 1.5)\n-    aws-sigv4 (1.11.0)\n+    aws-sigv4 (1.12.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n     azure-blob (0.5.8)\n       rexml\n@@ -946,7 +948,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.225.2)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nOne string (`notification.mention`) has a specific translation when used from the service worker.\n\nThis changes implements this specific case using the new Vite plugin.\n\nI checked that the generated `sw.js` file conteins `\"notification.mention\":\"{name} menciis vin\"`, which is the specific translation (`notification.mentioned_you`) for the `GA ` language.\n\nThe extract script has been changed to also extract translatable strings from the plugin, so they get picked up.\n\n---\n\nChoice A:\nGemfile.lock\n@@ -633,7 +633,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (3.1.15)\n+    rack (3.1.16)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (3.0.0)\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/actions/notifications.js\n@@ -21,7 +21,6 @@ export const NOTIFICATIONS_SET_BROWSER_PERMISSION = 'NOTIFICATIONS_SET_BROWSER_P\n \n defineMessages({\n   mention: { id: 'notification.mention', defaultMessage: '{name} mentioned you' },\n-  mentioned_you: { id: 'notification.mentioned_you', defaultMessage: '{name} mentioned you' },\n   group: { id: 'notifications.group', defaultMessage: '{count} notifications' },\n });\n \n---\nconfig/vite/plugin-sw-locales.ts\n@@ -8,8 +8,21 @@\n import fs from 'node:fs';\n import path from 'node:path';\n \n+import { defineMessages } from 'react-intl';\n+\n import type { Plugin, ResolvedConfig } from 'vite';\n \n+const translations = defineMessages({\n+  mentioned_you: {\n+    id: 'notification.mentioned_you',\n+    defaultMessage: '{name} mentioned you',\n+  },\n+});\n+\n+const CUSTOM_TRANSLATIONS = {\n+  'notification.mention': translations.mentioned_you.id,\n+};\n+\n const KEEP_KEYS = [\n   'notification.favourite',\n   'notification.follow',\n@@ -67,7 +80,14 @@ export function MastodonServiceWorkerLocales(): Plugin {\n             const filteredLocale: Record<string, string> = {};\n \n             Object.entries(full).forEach(([key, value]) => {\n-              if (KEEP_KEYS.includes(key)) filteredLocale[key] = value;\n+              if (KEEP_KEYS.includes(key)) {\n+                filteredLocale[key] = value;\n+              }\n+            });\n+\n+            Object.entries(CUSTOM_TRANSLATIONS).forEach(([key, value]) => {\n+              const translation = full[value];\n+              if (translation) filteredLocale[key] = translation;\n             });\n \n             filteredLocales[locale] = filteredLocale;\n---\npackage.json\n@@ -18,7 +18,7 @@\n     \"fix\": \"yarn fix:js && yarn fix:css\",\n     \"format\": \"prettier --write --log-level warn .\",\n     \"format:check\": \"prettier --check --ignore-unknown .\",\n-    \"i18n:extract\": \"formatjs extract 'app/javascript/**/*.{js,jsx,ts,tsx}' --ignore '**/*.d.ts' --out-file app/javascript/mastodon/locales/en.json --format config/formatjs-formatter.js\",\n+    \"i18n:extract\": \"formatjs extract 'app/javascript/**/*.{js,jsx,ts,tsx}' config/vite/plugin-sw-locales.js --ignore '**/*.d.ts' --out-file app/javascript/mastodon/locales/en.json --format config/formatjs-formatter.js\",\n     \"lint:js\": \"cd $INIT_CWD && eslint --cache --report-unused-disable-directives\",\n     \"lint:css\": \"stylelint \\\"**/*.{css,scss}\\\"\",\n     \"lint\": \"yarn lint:js && yarn lint:css\",\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -5487,8 +5487,8 @@ __metadata:\n   linkType: hard\n \n \"babel-plugin-formatjs@npm:^10.5.37\":\n-  version: 10.5.37\n-  resolution: \"babel-plugin-formatjs@npm:10.5.37\"\n+  version: 10.5.38\n+  resolution: \"babel-plugin-formatjs@npm:10.5.38\"\n   dependencies:\n     \"@babel/core\": \"npm:^7.26.10\"\n     \"@babel/helper-plugin-utils\": \"npm:^7.26.5\"\n@@ -5501,7 +5501,7 @@ __metadata:\n     \"@types/babel__helper-plugin-utils\": \"npm:^7.10.3\"\n     \"@types/babel__traverse\": \"npm:^7.20.6\"\n     tslib: \"npm:^2.8.0\"\n-  checksum: 10c0/e206ff1a8ad3cbcb3db2d2735d8821701df9d54c8aeb5e8b2861c945af91d4662b9cd37b1ff9d7e17954cdd31aec81788a3d044a1cd9f3e7e8e4f93177097b83\n+  checksum: 10c0/5aeb9839ee5be198b82c9ab6c85160e7edcc07f6184efe296560d229d1cc680d9c1e507bde47da74234d612a3e49c919b3e11c855b7fd4e6d256ec23f8b8b1e0\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nconfig/initializers/devise.rb\n@@ -158,13 +158,15 @@ def session_cookie\n   # given strategies, for example, `config.params_authenticatable = [:database]` will\n   # enable it only for database (email + password) authentication.\n   # config.params_authenticatable = true\n+  config.params_authenticatable = true\n \n   # Tell if authentication through HTTP Auth is enabled. False by default.\n   # It can be set to an array that will enable http authentication only for the\n   # given strategies, for example, `config.http_authenticatable = [:database]` will\n   # enable it only for database authentication. The supported strategies are:\n   # :database      = Support basic authentication with authentication key + password\n-  config.http_authenticatable = [:pam, :database]\n+  # config.http_authenticatable = [:pam, :database]\n+  config.http_authenticatable = false\n \n   # If 401 status code should be returned for AJAX requests. True by default.\n   # config.http_authenticatable_on_xhr = true\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [sidekiq-scheduler](https://sidekiq-scheduler.github.io/sidekiq-scheduler/) ([source](https://redirect.github.com/moove-it/sidekiq-scheduler)) | `'~> 5.0'` -> `'~> 6.0'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/sidekiq-scheduler/6.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/sidekiq-scheduler/6.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/sidekiq-scheduler/5.0.6/6.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/sidekiq-scheduler/5.0.6/6.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>moove-it/sidekiq-scheduler (sidekiq-scheduler)</summary>\n\n### [`v6.0.0`](https://redirect.github.com/moove-it/sidekiq-scheduler/blob/HEAD/CHANGELOG.md#600)\n\n[Compare Source](https://redirect.github.com/moove-it/sidekiq-scheduler/compare/v5.0.6...v6.0.0)\n\n-   Check the changelog for beta1 and beta2 of this version.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC43LjEiLCJ1cGRhdGVkSW5WZXIiOiI0MC43LjEiLCJ0YXJnZXRCcmFuY2giOiJtYWluIiwibGFiZWxzIjpbImRlcGVuZGVuY2llcyIsInJ1YnkiXX0=-->\n\n\n---\n\nChoice A:\nGemfile\n@@ -74,7 +74,7 @@ gem 'premailer-rails'\n gem 'public_suffix', '~> 6.0'\n gem 'pundit', '~> 2.3'\n gem 'rack-attack', '~> 6.6'\n-gem 'rack-cors', '~> 2.0', require: 'rack/cors'\n+gem 'rack-cors', '~> 3.0', require: 'rack/cors'\n gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -85,7 +85,7 @@ gem 'sanitize', '~> 7.0'\n gem 'scenic', '~> 1.7'\n gem 'sidekiq', '~> 6.5'\n gem 'sidekiq-bulk', '~> 0.2.0'\n-gem 'sidekiq-scheduler', '~> 5.0'\n+gem 'sidekiq-scheduler', '~> 6.0'\n gem 'sidekiq-unique-jobs', '~> 7.1'\n gem 'simple_form', '~> 5.2'\n gem 'simple-navigation', '~> 4.4'\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.223.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1096.0)\n+    aws-sdk-core (3.223.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.223.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -912,6 +912,8 @@ export const AccountHeader: React.FC<{\n             <div className='account__header__badges'>{badges}</div>\n           )}\n \n+          {signedIn && <FamiliarFollowers accountId={accountId} />}\n+\n           {!(suspended || hidden) && (\n             <div className='account__header__extra'>\n               <div\n@@ -1023,7 +1025,6 @@ export const AccountHeader: React.FC<{\n                   />\n                 </NavLink>\n               </div>\n-              {signedIn && <FamiliarFollowers accountId={accountId} />}\n             </div>\n           )}\n         </div>\n---\napp/javascript/mastodon/features/account_timeline/components/familiar_followers.tsx\n@@ -12,12 +12,16 @@ import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n \n const AccountLink: React.FC<{ account?: Account }> = ({ account }) => {\n-  // eslint-disable-next-line @typescript-eslint/prefer-nullish-coalescing\n-  const name = account?.display_name || `@${account?.acct}`;\n+  if (!account) {\n+    return null;\n+  }\n+\n   return (\n-    <Link to={`/@${account?.acct}`} data-hover-card-account={account?.id}>\n-      {name}\n-    </Link>\n+    <Link\n+      to={`/@${account.acct}`}\n+      data-hover-card-account={account.id}\n+      dangerouslySetInnerHTML={{ __html: account.display_name_html }}\n+    />\n   );\n };\n \n@@ -50,7 +54,7 @@ const FamiliarFollowersReadout: React.FC<{ familiarFollowers: Account[] }> = ({\n     return (\n       <FormattedMessage\n         id='account.familiar_followers_many'\n-        defaultMessage='Followed by {name1}, {name2}, and {othersCount, plural, one {# other} other {# others}}'\n+        defaultMessage='Followed by {name1}, {name2}, and {othersCount, plural, one {one other you know} other {# others you know}}'\n         values={messageData}\n       />\n     );\n@@ -80,7 +84,7 @@ export const FamiliarFollowers: React.FC<{ accountId: string }> = ({\n   return (\n     <div className='account__header__familiar-followers'>\n       <AvatarGroup compact>\n-        {familiarFollowers.map((account) => (\n+        {familiarFollowers.slice(0, 3).map((account) => (\n           <Avatar withLink key={account.id} account={account} size={28} />\n         ))}\n       </AvatarGroup>\n---\napp/javascript/mastodon/locales/en.json\n@@ -28,7 +28,7 @@\n   \"account.edit_profile\": \"Edit profile\",\n   \"account.enable_notifications\": \"Notify me when @{name} posts\",\n   \"account.endorse\": \"Feature on profile\",\n-  \"account.familiar_followers_many\": \"Followed by {name1}, {name2}, and {othersCount, plural, one {# other} other {# others}}\",\n+  \"account.familiar_followers_many\": \"Followed by {name1}, {name2}, and {othersCount, plural, one {one other you know} other {# others you know}}\",\n   \"account.familiar_followers_one\": \"Followed by {name1}\",\n   \"account.familiar_followers_two\": \"Followed by {name1} and {name2}\",\n   \"account.featured\": \"Featured\",\n---\napp/javascript/styles/mastodon/components.scss\n@@ -2091,6 +2091,7 @@ body > [data-popper-placement] {\n   display: block;\n   position: relative;\n   border-radius: var(--avatar-border-radius);\n+  background: var(--surface-background-color);\n \n   img {\n     width: 100%;\n@@ -8151,16 +8152,13 @@ noscript {\n     display: flex;\n     align-items: center;\n     gap: 10px;\n-    margin-block-end: 16px;\n+    margin-block: 16px;\n     color: $darker-text-color;\n \n     a:any-link {\n-      color: inherit;\n-      text-decoration: underline;\n-    }\n-\n-    a:hover {\n+      font-weight: 500;\n       text-decoration: none;\n+      color: $primary-text-color;\n     }\n   }\n }\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFollow-up to #34664\r\n\r\nThis preserves Redis namespace usage for Rails' cache, but drops Redis namespace usage otherwise.\r\n\r\nThe biggest change is the switch from `mastodon_test#{TEST_ENV_NUMBER}` namespaces to Redis databases in test environments. This serves the same purpose but means Redis needs to be set up to support at least as many databases as test workers. It also does not provide quite the same amount of differentiation between test, development and production environments, should you use multiple on the same setup.\n\n---\n\nChoice A:\napp/lib/http_signature_draft.rb\n@@ -6,14 +6,13 @@\n class HttpSignatureDraft\n   REQUEST_TARGET = '(request-target)'\n \n-  def initialize(keypair, key_id, full_path: true)\n+  def initialize(keypair, key_id)\n     @keypair = keypair\n     @key_id = key_id\n-    @full_path = full_path\n   end\n \n   def request_target(verb, url)\n-    if url.query.nil? || !@full_path\n+    if url.query.nil?\n       \"#{verb} #{url.path}\"\n     else\n       \"#{verb} #{url.path}?#{url.query}\"\n---\napp/lib/request.rb\n@@ -75,7 +75,6 @@ def initialize(verb, url, **options)\n     @url         = Addressable::URI.parse(url).normalize\n     @http_client = options.delete(:http_client)\n     @allow_local = options.delete(:allow_local)\n-    @full_path   = !options.delete(:omit_query_string)\n     @options     = {\n       follow: {\n         max_hops: 3,\n@@ -102,7 +101,7 @@ def on_behalf_of(actor, sign_with: nil)\n \n     key_id = ActivityPub::TagManager.instance.key_uri_for(actor)\n     keypair = sign_with.present? ? OpenSSL::PKey::RSA.new(sign_with) : actor.keypair\n-    @signing = HttpSignatureDraft.new(keypair, key_id, full_path: @full_path)\n+    @signing = HttpSignatureDraft.new(keypair, key_id)\n \n     self\n   end\n---\napp/services/activitypub/fetch_replies_service.rb\n@@ -57,20 +57,7 @@ def fetch_collection(collection_or_uri)\n     return unless @allow_synchronous_requests\n     return if non_matching_uri_hosts?(@reference_uri, collection_or_uri)\n \n-    # NOTE: For backward compatibility reasons, Mastodon signs outgoing\n-    # queries incorrectly by default.\n-    #\n-    # While this is relevant for all URLs with query strings, this is\n-    # the only code path where this happens in practice.\n-    #\n-    # Therefore, retry with correct signatures if this fails.\n-    begin\n-      fetch_resource_without_id_validation(collection_or_uri, nil, raise_on_error: :temporary)\n-    rescue Mastodon::UnexpectedResponseError => e\n-      raise unless e.response && e.response.code == 401 && Addressable::URI.parse(collection_or_uri).query.present?\n-\n-      fetch_resource_without_id_validation(collection_or_uri, nil, raise_on_error: :temporary, request_options: { omit_query_string: false })\n-    end\n+    fetch_resource_without_id_validation(collection_or_uri, nil, raise_on_error: :temporary)\n   end\n \n   def filter_replies(items)\n---\n\n\n---\n\nChoice B:\nconfig/initializers/chewy.rb\n@@ -5,8 +5,7 @@\n port            = ENV.fetch('ES_PORT') { 9200 }\n user            = ENV.fetch('ES_USER', nil).presence\n password        = ENV.fetch('ES_PASS', nil).presence\n-fallback_prefix = ENV.fetch('REDIS_NAMESPACE', nil).presence\n-prefix          = ENV.fetch('ES_PREFIX') { fallback_prefix }\n+prefix          = ENV.fetch('ES_PREFIX', nil)\n ca_file         = ENV.fetch('ES_CA_FILE', nil).presence\n \n transport_options = { ssl: { ca_file: ca_file } } if ca_file.present?\n---\nlib/mastodon/redis_configuration.rb\n@@ -9,18 +9,17 @@ class Mastodon::RedisConfiguration\n \n   def base\n     @base ||= setup_config(prefix: nil, defaults: DEFAULTS)\n-              .merge(namespace: base_namespace)\n+              .merge(namespace: nil)\n   end\n \n   def sidekiq\n     @sidekiq ||= setup_config(prefix: 'SIDEKIQ_')\n-                 .merge(namespace: sidekiq_namespace)\n   end\n \n   def cache\n     @cache ||= setup_config(prefix: 'CACHE_')\n                .merge({\n-                 namespace: cache_namespace,\n+                 namespace: 'cache',\n                  expires_in: 10.minutes,\n                  connect_timeout: 5,\n                  pool: {\n@@ -36,24 +35,6 @@ def driver\n     ENV['REDIS_DRIVER'] == 'ruby' ? :ruby : :hiredis\n   end\n \n-  def namespace\n-    @namespace ||= ENV.fetch('REDIS_NAMESPACE', nil)\n-  end\n-\n-  def base_namespace\n-    return \"mastodon_test#{ENV.fetch('TEST_ENV_NUMBER', nil)}\" if Rails.env.test?\n-\n-    namespace\n-  end\n-\n-  def sidekiq_namespace\n-    namespace\n-  end\n-\n-  def cache_namespace\n-    namespace ? \"#{namespace}_cache\" : 'cache'\n-  end\n-\n   def setup_config(prefix: nil, defaults: {})\n     prefix = \"#{prefix}REDIS_\"\n \n@@ -62,7 +43,7 @@ def setup_config(prefix: nil, defaults: {})\n     password = ENV.fetch(\"#{prefix}PASSWORD\", nil)\n     host     = ENV.fetch(\"#{prefix}HOST\", defaults[:host])\n     port     = ENV.fetch(\"#{prefix}PORT\", defaults[:port])\n-    db       = ENV.fetch(\"#{prefix}DB\", defaults[:db])\n+    db       = Rails.env.test? ? ENV.fetch('TEST_ENV_NUMBER', defaults[:db]).to_i + 1 : ENV.fetch(\"#{prefix}DB\", defaults[:db])\n \n     return { url:, driver: } if url\n \n---\nspec/lib/mastodon/redis_configuration_spec.rb\n@@ -26,20 +26,6 @@\n     end\n   end\n \n-  shared_examples 'setting a namespace' do\n-    context 'when setting the `REDIS_NAMESPACE` variable' do\n-      around do |example|\n-        ClimateControl.modify REDIS_NAMESPACE: 'testns' do\n-          example.run\n-        end\n-      end\n-\n-      it 'uses the value for the namespace' do\n-        expect(subject[:namespace]).to eq 'testns'\n-      end\n-    end\n-  end\n-\n   shared_examples 'secondary configuration' do |prefix|\n     context \"when no `#{prefix}_REDIS_` environment variables are present\" do\n       it 'uses the url from the base config' do\n@@ -208,7 +194,6 @@\n     end\n \n     it_behaves_like 'setting a different driver'\n-    it_behaves_like 'setting a namespace'\n     it_behaves_like 'sentinel support'\n   end\n \n@@ -217,7 +202,6 @@\n \n     it_behaves_like 'secondary configuration', 'SIDEKIQ'\n     it_behaves_like 'setting a different driver'\n-    it_behaves_like 'setting a namespace'\n     it_behaves_like 'sentinel support', 'SIDEKIQ'\n   end\n \n@@ -238,22 +222,8 @@\n       })\n     end\n \n-    context 'when `REDIS_NAMESPACE` is not set' do\n-      it 'uses the `cache` namespace' do\n-        expect(subject[:namespace]).to eq 'cache'\n-      end\n-    end\n-\n-    context 'when setting the `REDIS_NAMESPACE` variable' do\n-      around do |example|\n-        ClimateControl.modify REDIS_NAMESPACE: 'testns' do\n-          example.run\n-        end\n-      end\n-\n-      it 'attaches the `_cache` postfix to the namespace' do\n-        expect(subject[:namespace]).to eq 'testns_cache'\n-      end\n+    it 'uses the `cache` namespace' do\n+      expect(subject[:namespace]).to eq 'cache'\n     end\n \n     it_behaves_like 'secondary configuration', 'CACHE'\n---\nspec/support/streaming_server_manager.rb\n@@ -17,7 +17,7 @@ def start(port: 4020)\n     @running_thread = Thread.new do\n       Open3.popen2e(\n         {\n-          'REDIS_NAMESPACE' => REDIS_CONFIGURATION.base[:namespace],\n+          'REDIS_DB' => (ENV.fetch('TEST_ENV_NUMBER', 0).to_i + 1).to_s,\n           'DB_NAME' => \"#{ENV.fetch('DB_NAME', 'mastodon')}_test#{ENV.fetch('TEST_ENV_NUMBER', '')}\",\n           'RAILS_ENV' => ENV.fetch('RAILS_ENV', 'test'),\n           'NODE_ENV' => ENV.fetch('STREAMING_NODE_ENV', 'development'),\n---\nstreaming/redis.js\n@@ -4,7 +4,6 @@ import { parseIntFromEnvValue } from './utils.js';\n \n /**\n  * @typedef RedisConfiguration\n- * @property {string|undefined} namespace\n  * @property {string|undefined} url\n  * @property {import('ioredis').RedisOptions} options\n  */\n@@ -64,8 +63,6 @@ function getSentinelConfiguration(env, commonOptions) {\n  * @returns {RedisConfiguration} configuration for the Redis connection\n  */\n export function configFromEnv(env) {\n-  const redisNamespace = env.REDIS_NAMESPACE;\n-\n   // These options apply for both REDIS_URL based connections and connections\n   // using the other REDIS_* environment variables:\n   const commonOptions = {\n@@ -82,16 +79,14 @@ export function configFromEnv(env) {\n   if (typeof env.REDIS_URL === 'string' && env.REDIS_URL.length > 0) {\n     return {\n       url: env.REDIS_URL,\n-      options: commonOptions,\n-      namespace: redisNamespace\n+      options: commonOptions\n     };\n   }\n \n   // If we have configuration for Redis Sentinel mode, prefer that:\n   if (hasSentinelConfiguration(env)) {\n     return {\n-      options: getSentinelConfiguration(env, commonOptions),\n-      namespace: redisNamespace\n+      options: getSentinelConfiguration(env, commonOptions)\n     };\n   }\n \n@@ -110,8 +105,7 @@ export function configFromEnv(env) {\n   };\n \n   return {\n-    options,\n-    namespace: redisNamespace\n+    options\n   };\n }\n \n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -779,7 +779,8 @@ GEM\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n       rubocop-rspec (~> 3.5)\n-    ruby-prof (1.7.1)\n+    ruby-prof (1.7.2)\n+      base64\n     ruby-progressbar (1.13.0)\n     ruby-saml (1.18.0)\n       nokogiri (>= 1.13.10)\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.4)\n+    rubocop (1.75.5)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34644\r\n\r\nAn alternative to this would be to actually pass a date of birth, but given the fact this is manual action from the admin, this seems unnecessary.\n\n---\n\nChoice A:\napp/javascript/mastodon/components/hover_card_account.tsx\n@@ -45,6 +45,19 @@ export const HoverCardAccount = forwardRef<\n \n   const { familiarFollowers } = useFetchFamiliarFollowers({ accountId });\n \n+  const relationship = useAppSelector((state) =>\n+    accountId ? state.relationships.get(accountId) : undefined,\n+  );\n+  const isMutual = relationship?.followed_by && relationship.following;\n+  const isFollower = relationship?.followed_by;\n+  const hasRelationshipLoaded = !!relationship;\n+\n+  const shouldDisplayFamiliarFollowers =\n+    familiarFollowers.length > 0 &&\n+    hasRelationshipLoaded &&\n+    !isMutual &&\n+    !isFollower;\n+\n   return (\n     <div\n       ref={ref}\n@@ -85,7 +98,7 @@ export const HoverCardAccount = forwardRef<\n               value={account.followers_count}\n               renderer={FollowersCounter}\n             />\n-            {familiarFollowers.length > 0 && (\n+            {shouldDisplayFamiliarFollowers && (\n               <>\n                 &middot;\n                 <div className='hover-card__familiar-followers'>\n@@ -101,6 +114,22 @@ export const HoverCardAccount = forwardRef<\n                 </div>\n               </>\n             )}\n+            {(isMutual || isFollower) && (\n+              <>\n+                &middot;\n+                {isMutual ? (\n+                  <FormattedMessage\n+                    id='account.mutual'\n+                    defaultMessage='You follow each other'\n+                  />\n+                ) : (\n+                  <FormattedMessage\n+                    id='account.follows_you'\n+                    defaultMessage='Follows you'\n+                  />\n+                )}\n+              </>\n+            )}\n           </div>\n \n           <FollowButton accountId={accountId} />\n---\napp/javascript/styles/mastodon/components.scss\n@@ -10766,7 +10766,7 @@ noscript {\n     display: flex;\n     align-items: center;\n     flex-wrap: wrap;\n-    gap: 10px;\n+    gap: 2px 10px;\n   }\n \n   &__numbers {\n---\n\n\n---\n\nChoice B:\napp/lib/status_filter.rb\n@@ -38,7 +38,7 @@ def muting_account?\n   end\n \n   def silenced_account?\n-    !account&.silenced? && status_account_silenced? && !account_following_status_account?\n+    status_account_silenced? && !account_following_status_account?\n   end\n \n   def status_account_silenced?\n---\n\n\n---\n\nChoice C:\napp/helpers/json_ld_helper.rb\n@@ -72,6 +72,18 @@ def non_matching_uri_hosts?(base_url, comparison_url)\n     !haystack.casecmp(needle).zero?\n   end\n \n+  def safe_prefetched_embed(account, object, context)\n+    return unless object.is_a?(Hash)\n+\n+    # NOTE: Replacing the object's context by that of the parent activity is\n+    # not sound, but it's consistent with the rest of the codebase\n+    object = object.merge({ '@context' => context })\n+\n+    return if value_or_id(first_of_value(object['attributedTo'])) != account.uri || non_matching_uri_hosts?(account.uri, object['id'])\n+\n+    object\n+  end\n+\n   def canonicalize(json)\n     graph = RDF::Graph.new << JSON::LD::API.toRdf(json, documentLoader: method(:load_jsonld_context))\n     graph.dump(:normalize)\n---\napp/lib/activitypub/activity/create.rb\n@@ -204,7 +204,9 @@ def attach_quote(status)\n \n     @quote.status = status\n     @quote.save\n-    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, request_id: @options[:request_id])\n+\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, prefetched_quoted_object: embedded_quote, request_id: @options[:request_id])\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n     ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, @quote.id, @quote_uri, { 'request_id' => @options[:request_id] })\n   end\n---\napp/lib/activitypub/parser/status_parser.rb\n@@ -120,6 +120,11 @@ def quote_uri\n     end.first\n   end\n \n+  # The inlined quote; out of the attributes we support, only `https://w3id.org/fep/044f#quote` explicitly supports inlined objects\n+  def quoted_object\n+    as_array(@object['quote']).first\n+  end\n+\n   def quote_approval_uri\n     as_array(@object['quoteAuthorization']).first\n   end\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -273,7 +273,6 @@ def update_emojis!\n   def update_quote!\n     return unless Mastodon::Feature.inbound_quotes_enabled?\n \n-    quote = nil\n     quote_uri = @status_parser.quote_uri\n \n     if quote_uri.present?\n@@ -294,21 +293,23 @@ def update_quote!\n         quote = Quote.create(status: @status, approval_uri: approval_uri)\n         @quote_changed = true\n       end\n-    end\n \n-    if quote.present?\n-      begin\n-        quote.save\n-        ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, request_id: @request_id)\n-      rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n-        ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n-      end\n+      quote.save\n+\n+      fetch_and_verify_quote!(quote, quote_uri)\n     elsif @status.quote.present?\n       @status.quote.destroy!\n       @quote_changed = true\n     end\n   end\n \n+  def fetch_and_verify_quote!(quote, quote_uri)\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @activity_json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, prefetched_quoted_object: embedded_quote, request_id: @request_id)\n+  rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n+    ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n+  end\n+\n   def update_counts!\n     likes = @status_parser.favourites_count\n     shares =  @status_parser.reblogs_count\n---\napp/services/activitypub/verify_quote_service.rb\n@@ -4,15 +4,15 @@ class ActivityPub::VerifyQuoteService < BaseService\n   include JsonLdHelper\n \n   # Optionally fetch quoted post, and verify the quote is authorized\n-  def call(quote, fetchable_quoted_uri: nil, prefetched_body: nil, request_id: nil)\n+  def call(quote, fetchable_quoted_uri: nil, prefetched_quoted_object: nil, prefetched_approval: nil, request_id: nil)\n     @request_id = request_id\n     @quote = quote\n     @fetching_error = nil\n \n-    fetch_quoted_post_if_needed!(fetchable_quoted_uri)\n+    fetch_quoted_post_if_needed!(fetchable_quoted_uri, prefetched_body: prefetched_quoted_object)\n     return if fast_track_approval! || quote.approval_uri.blank?\n \n-    @json = fetch_approval_object(quote.approval_uri, prefetched_body:)\n+    @json = fetch_approval_object(quote.approval_uri, prefetched_body: prefetched_approval)\n     return quote.reject! if @json.nil?\n \n     return if non_matching_uri_hosts?(quote.approval_uri, value_or_id(@json['attributedTo']))\n@@ -68,11 +68,11 @@ def matching_quote_uri?\n     ActivityPub::TagManager.instance.uri_for(@quote.status) == value_or_id(@json['interactingObject'])\n   end\n \n-  def fetch_quoted_post_if_needed!(uri)\n+  def fetch_quoted_post_if_needed!(uri, prefetched_body: nil)\n     return if uri.nil? || @quote.quoted_status.present?\n \n     status = ActivityPub::TagManager.instance.uri_to_resource(uri, Status)\n-    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, request_id: @request_id)\n+    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, prefetched_body:, request_id: @request_id)\n \n     @quote.update(quoted_status: status) if status.present?\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS => e\n---\nspec/services/activitypub/verify_quote_service_spec.rb\n@@ -89,6 +89,37 @@\n       end\n     end\n \n+    context 'with a valid activity for a post that cannot be fetched but is passed as fetched_quoted_object' do\n+      let(:quoted_status) { nil }\n+\n+      let(:approval_interaction_target) { 'https://b.example.com/unknown-quoted' }\n+      let(:prefetched_object) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          type: 'Note',\n+          id: 'https://b.example.com/unknown-quoted',\n+          to: 'https://www.w3.org/ns/activitystreams#Public',\n+          attributedTo: ActivityPub::TagManager.instance.uri_for(quoted_account),\n+          content: 'previously unknown post',\n+        }.with_indifferent_access\n+      end\n+\n+      before do\n+        stub_request(:get, 'https://b.example.com/unknown-quoted')\n+          .to_return(status: 404)\n+      end\n+\n+      it 'updates the status' do\n+        expect { subject.call(quote, fetchable_quoted_uri: 'https://b.example.com/unknown-quoted', prefetched_quoted_object: prefetched_object) }\n+          .to change(quote, :state).to('accepted')\n+\n+        expect(a_request(:get, approval_uri))\n+          .to have_been_made.once\n+\n+        expect(quote.reload.quoted_status.content).to eq 'previously unknown post'\n+      end\n+    end\n+\n     context 'with a valid activity for a post that cannot be fetched but is inlined' do\n       let(:quoted_status) { nil }\n \n@@ -148,7 +179,7 @@\n \n     context 'with a valid activity for already-fetched posts, with a pre-fetched approval' do\n       it 'updates the status without fetching the activity' do\n-        expect { subject.call(quote, prefetched_body: Oj.dump(json)) }\n+        expect { subject.call(quote, prefetched_approval: Oj.dump(json)) }\n           .to change(quote, :state).to('accepted')\n \n         expect(a_request(:get, approval_uri))\n---\n\n\n---\n\nChoice D:\napp/models/user.rb\n@@ -112,7 +112,7 @@ class User < ApplicationRecord\n   validates_with RegistrationFormTimeValidator, on: :create\n   validates :website, absence: true, on: :create\n   validates :confirm_password, absence: true, on: :create\n-  validates :date_of_birth, presence: true, date_of_birth: true, on: :create, if: -> { Setting.min_age.present? }\n+  validates :date_of_birth, presence: true, date_of_birth: true, on: :create, if: -> { Setting.min_age.present? && !bypass_registration_checks? }\n   validate :validate_role_elevation\n \n   scope :account_not_suspended, -> { joins(:account).merge(Account.without_suspended) }\n@@ -144,7 +144,7 @@ class User < ApplicationRecord\n   delegate :can?, to: :role\n \n   attr_reader :invite_code, :date_of_birth\n-  attr_writer :external, :bypass_invite_request_check, :current_account\n+  attr_writer :external, :bypass_registration_checks, :current_account\n \n   def self.those_who_can(*any_of_privileges)\n     matching_role_ids = UserRole.that_can(*any_of_privileges).map(&:id)\n@@ -501,8 +501,8 @@ def external?\n     !!@external\n   end\n \n-  def bypass_invite_request_check?\n-    @bypass_invite_request_check\n+  def bypass_registration_checks?\n+    @bypass_registration_checks\n   end\n \n   def sanitize_role\n@@ -549,7 +549,7 @@ def validate_role_elevation\n   end\n \n   def invite_text_required?\n-    Setting.require_invite_text && !open_registrations? && !invited? && !external? && !bypass_invite_request_check?\n+    Setting.require_invite_text && !open_registrations? && !invited? && !external? && !bypass_registration_checks?\n   end\n \n   def trigger_webhooks\n---\nlib/mastodon/cli/accounts.rb\n@@ -79,7 +79,14 @@ def create(username)\n \n       account  = Account.new(username: username)\n       password = SecureRandom.hex\n-      user     = User.new(email: options[:email], password: password, agreement: true, role_id: role_id, confirmed_at: options[:confirmed] ? Time.now.utc : nil, bypass_invite_request_check: true)\n+      user = User.new(\n+        email: options[:email],\n+        password: password,\n+        agreement: true,\n+        role_id: role_id,\n+        confirmed_at: options[:confirmed] ? Time.now.utc : nil,\n+        bypass_registration_checks: true\n+      )\n \n       if options[:reattach]\n         account = Account.find_local(username) || Account.new(username: username)\n---\nlib/tasks/mastodon.rake\n@@ -552,7 +552,7 @@ namespace :mastodon do\n           password = SecureRandom.hex(16)\n \n           owner_role = UserRole.find_by(name: 'Owner')\n-          user = User.new(email: email, password: password, confirmed_at: Time.now.utc, account_attributes: { username: username }, bypass_invite_request_check: true, role: owner_role)\n+          user = User.new(email: email, password: password, confirmed_at: Time.now.utc, account_attributes: { username: username }, bypass_registration_checks: true, role: owner_role)\n           user.save(validate: false)\n           user.approve!\n \n---\nspec/lib/mastodon/cli/accounts_spec.rb\n@@ -70,6 +70,25 @@ def account_from_options\n         end\n       end\n \n+      context 'with min_age setting' do\n+        let(:options) { { email: 'tootctl@example.com', confirmed: true } }\n+\n+        before do\n+          Setting.min_age = 42\n+        end\n+\n+        it_behaves_like 'a new user with given email address and username'\n+\n+        it 'creates a new user with confirmed status' do\n+          expect { subject }\n+            .to output_results('New password')\n+\n+          user = User.find_by(email: options[:email])\n+\n+          expect(user.confirmed?).to be(true)\n+        end\n+      end\n+\n       context 'with --confirmed option' do\n         let(:options) { { email: 'tootctl@example.com', confirmed: true } }\n \n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [sass](https://redirect.github.com/sass/dart-sass) | [`1.87.0` -> `1.88.0`](https://renovatebot.com/diffs/npm/sass/1.87.0/1.88.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/sass/1.88.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/sass/1.88.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/sass/1.87.0/1.88.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/sass/1.87.0/1.88.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>sass/dart-sass (sass)</summary>\n\n### [`v1.88.0`](https://redirect.github.com/sass/dart-sass/blob/HEAD/CHANGELOG.md#1880)\n\n[Compare Source](https://redirect.github.com/sass/dart-sass/compare/1.87.0...1.88.0)\n\n-   Allow custom properties with empty values (such as `--var:;`).\n\n-   Fix a bug when calculating source spans for interpolations.\n\n##### Dart and JS APIs\n\n-   **Potentially breaking bug fix:** Throw an error when passing a function or\n    mixin object from one compilation to another.\n\n##### Dart API\n\n-   Deprecate passing a relative URL to `compileString()` and related functions.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC43LjEiLCJ1cGRhdGVkSW5WZXIiOiI0MC43LjEiLCJ0YXJnZXRCcmFuY2giOiJtYWluIiwibGFiZWxzIjpbImRlcGVuZGVuY2llcyIsImphdmFzY3JpcHQiXX0=-->\n\n\n---\n\nChoice A:\n.github/workflows/test-ruby.yml\n@@ -345,7 +345,7 @@ jobs:\n         uses: actions/upload-artifact@v4\n         if: failure()\n         with:\n-          name: e2e-screenshots\n+          name: e2e-screenshots-${{ matrix.ruby-version }}\n           path: tmp/capybara/\n \n   test-search:\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -7829,14 +7829,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"es-module-lexer@npm:^1.5.3\":\n-  version: 1.6.0\n-  resolution: \"es-module-lexer@npm:1.6.0\"\n-  checksum: 10c0/667309454411c0b95c476025929881e71400d74a746ffa1ff4cb450bd87f8e33e8eef7854d68e401895039ac0bac64e7809acbebb6253e055dd49ea9e3ea9212\n-  languageName: node\n-  linkType: hard\n-\n-\"es-module-lexer@npm:^1.7.0\":\n+\"es-module-lexer@npm:^1.5.3, es-module-lexer@npm:^1.7.0\":\n   version: 1.7.0\n   resolution: \"es-module-lexer@npm:1.7.0\"\n   checksum: 10c0/4c935affcbfeba7fb4533e1da10fa8568043df1e3574b869385980de9e2d475ddc36769891936dbb07036edb3c3786a8b78ccf44964cd130dedc1f2c984b6c7b\n@@ -14945,8 +14938,8 @@ __metadata:\n   linkType: hard\n \n \"sass@npm:^1.62.1\":\n-  version: 1.87.0\n-  resolution: \"sass@npm:1.87.0\"\n+  version: 1.88.0\n+  resolution: \"sass@npm:1.88.0\"\n   dependencies:\n     \"@parcel/watcher\": \"npm:^2.4.1\"\n     chokidar: \"npm:^4.0.0\"\n@@ -14957,7 +14950,7 @@ __metadata:\n       optional: true\n   bin:\n     sass: sass.js\n-  checksum: 10c0/bd245faf14e4783dc547765350cf05817edaac0d6d6f6e4da8ab751f3eb3cc3873afd563c0ce416a24aa6c9c4e9023b05096447fc006660a01f76adffb54fbc6\n+  checksum: 10c0/dcb16dc29116bfa5a90485d24fd8020d2b0d95155bd2e31285901588729343b59fefe44365c5f146b2ba5a9ebadef90b23a7220b902507bdbd91ca2ba0a0b688\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\napp/models/concerns/user/omniauthable.rb\n@@ -99,7 +99,7 @@ def user_params_from_auth(email, auth)\n         external: true,\n         account_attributes: {\n           username: ensure_unique_username(ensure_valid_username(auth.uid)),\n-          display_name: auth.info.full_name || auth.info.name || [auth.info.first_name, auth.info.last_name].join(' '),\n+          display_name: display_name_from_auth(auth),\n         },\n       }\n     end\n@@ -121,5 +121,10 @@ def ensure_valid_username(starting_username)\n       temp_username = starting_username.gsub(/[^a-z0-9_]+/i, '')\n       temp_username.truncate(30, omission: '')\n     end\n+\n+    def display_name_from_auth(auth)\n+      display_name = auth.info.full_name || auth.info.name || [auth.info.first_name, auth.info.last_name].join(' ')\n+      display_name.truncate(Account::DISPLAY_NAME_LENGTH_LIMIT, omission: '')\n+    end\n   end\n end\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -170,7 +170,7 @@ GEM\n     crass (1.0.6)\n     css_parser (1.21.1)\n       addressable\n-    csv (3.3.3)\n+    csv (3.3.4)\n     database_cleaner-active_record (2.2.0)\n       activerecord (>= 5.a)\n       database_cleaner-core (~> 2.0.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis avoids an issue in the vscode eslint plugin causing the files to not be resolved properly (randomly): https://github.com/microsoft/vscode-eslint/issues/1994\n\nIf you specify the absolute path to the `tsconfig.json`, then everything works\n\n---\n\nChoice A:\neslint.config.mjs\n@@ -1,5 +1,7 @@\n // @ts-check\n \n+import path from 'node:path';\n+\n import js from '@eslint/js';\n import { globalIgnores } from 'eslint/config';\n import formatjs from 'eslint-plugin-formatjs';\n@@ -204,7 +206,9 @@ export default tseslint.config([\n       'import/ignore': ['node_modules', '\\\\.(css|scss|json)$'],\n \n       'import/resolver': {\n-        typescript: {},\n+        typescript: {\n+          project: path.resolve(import.meta.dirname, './tsconfig.json'),\n+        },\n       },\n     },\n \n---\nstreaming/eslint.config.mjs\n@@ -1,5 +1,7 @@\n // @ts-check\n \n+import path from 'node:path';\n+\n import globals from 'globals';\n import tseslint from 'typescript-eslint';\n \n@@ -20,7 +22,9 @@ export default tseslint.config([\n     settings: {\n       'import/ignore': ['node_modules', '\\\\.(json)$'],\n       'import/resolver': {\n-        typescript: {},\n+        typescript: {\n+          project: path.resolve(import.meta.dirname, './tsconfig.json'),\n+        },\n       },\n     },\n \n---\n\n\n---\n\nChoice B:\napp/controllers/api/v1/lists_controller.rb\n@@ -7,10 +7,6 @@ class Api::V1::ListsController < Api::BaseController\n   before_action :require_user!\n   before_action :set_list, except: [:index, :create]\n \n-  rescue_from ArgumentError do |e|\n-    render json: { error: e.to_s }, status: 422\n-  end\n-\n   def index\n     @lists = List.where(account: current_account).all\n     render json: @lists, each_serializer: REST::ListSerializer\n---\napp/models/list.rb\n@@ -18,7 +18,7 @@ class List < ApplicationRecord\n \n   PER_ACCOUNT_LIMIT = 50\n \n-  enum :replies_policy, { list: 0, followed: 1, none: 2 }, prefix: :show\n+  enum :replies_policy, { list: 0, followed: 1, none: 2 }, prefix: :show, validate: true\n \n   belongs_to :account\n \n---\nspec/requests/api/v1/lists_spec.rb\n@@ -132,9 +132,12 @@\n       it 'returns http unprocessable entity' do\n         subject\n \n-        expect(response).to have_http_status(422)\n+        expect(response)\n+          .to have_http_status(422)\n         expect(response.content_type)\n           .to start_with('application/json')\n+        expect(response.parsed_body)\n+          .to include(error: /Replies policy is not included/)\n       end\n     end\n   end\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -66,7 +66,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n+\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n   version: 7.26.10\n   resolution: \"@babel/core@npm:7.26.10\"\n   dependencies:\n@@ -211,10 +211,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.24.0, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5\":\n-  version: 7.26.5\n-  resolution: \"@babel/helper-plugin-utils@npm:7.26.5\"\n-  checksum: 10c0/cdaba71d4b891aa6a8dfbe5bac2f94effb13e5fa4c2c487667fdbaa04eae059b78b28d85a885071f45f7205aeb56d16759e1bed9c118b94b16e4720ef1ab0f65\n+\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5, @babel/helper-plugin-utils@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helper-plugin-utils@npm:7.27.1\"\n+  checksum: 10c0/94cf22c81a0c11a09b197b41ab488d416ff62254ce13c57e62912c85700dc2e99e555225787a4099ff6bae7a1812d622c80fbaeda824b79baa10a6c5ac4cf69b\n   languageName: node\n   linkType: hard\n \n@@ -869,25 +869,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-self@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-self@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea362ff94b535c753f560eb1f5e063dc72bbbca17ed58837a949a7b289d5eacc7b0a28296d1932c94429b168d6040cdee5484a59b9e3c021f169e0ee137e6a27\n+  checksum: 10c0/00a4f917b70a608f9aca2fb39aabe04a60aa33165a7e0105fd44b3a8531630eb85bf5572e9f242f51e6ad2fa38c2e7e780902176c863556c58b5ba6f6e164031\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-source@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-source@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea8e3263c0dc51fbc97c156cc647150a757cc56de10781287353d0ce9b2dcd6b6d93d573c0142d7daf5d6fb554c74fa1971ae60764924ea711161d8458739b63\n+  checksum: 10c0/5e67b56c39c4d03e59e03ba80692b24c5a921472079b63af711b1d250fc37c1733a17069b63537f750f3e937ec44a42b1ee6a46cd23b1a0df5163b17f741f7f2\n   languageName: node\n   linkType: hard\n \n@@ -4135,17 +4135,17 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.2.1\n-  resolution: \"@vitejs/plugin-react@npm:4.2.1\"\n+  version: 4.4.1\n+  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n   dependencies:\n-    \"@babel/core\": \"npm:^7.23.5\"\n-    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.23.3\"\n-    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.23.3\"\n+    \"@babel/core\": \"npm:^7.26.10\"\n+    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n+    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n-    react-refresh: \"npm:^0.14.0\"\n+    react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n-    vite: ^4.2.0 || ^5.0.0\n-  checksum: 10c0/de1eec44d703f32e5b58e776328ca20793657fe991835d15b290230b19a2a08be5d31501d424279ae13ecfed28044c117b69d746891c8d9b92c69e8a8907e989\n+    vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n+  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n   languageName: node\n   linkType: hard\n \n@@ -10069,10 +10069,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-refresh@npm:^0.14.0\":\n-  version: 0.14.0\n-  resolution: \"react-refresh@npm:0.14.0\"\n-  checksum: 10c0/b8ae07ad153357d77830928a7f1fc2df837aabefee907fa273ba04c7643f3b860e986f1d4b7ada9b721c8d79b8c24b5b911a314a1a2398b105f1b13d19ea2b8d\n+\"react-refresh@npm:^0.17.0\":\n+  version: 0.17.0\n+  resolution: \"react-refresh@npm:0.17.0\"\n+  checksum: 10c0/002cba940384c9930008c0bce26cac97a9d5682bc623112c2268ba0c155127d9c178a9a5cc2212d560088d60dfd503edd808669a25f9b377f316a32361d0b23c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -773,7 +773,7 @@ GEM\n       rack (>= 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n       rubocop-ast (>= 1.38.0, < 2.0)\n-    rubocop-rspec (3.5.0)\n+    rubocop-rspec (3.6.0)\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n     rubocop-rspec_rails (2.31.0)\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nAnd use it to preload the locales file\n\n---\n\nChoice A:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.224.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1103.0)\n+    aws-sdk-core (3.224.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.224.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice B:\nconfig/environments/production.rb\n@@ -150,13 +150,6 @@\n     'Referrer-Policy' => 'same-origin',\n   }\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = if ENV['SECRET_KEY_BASE_DUMMY']\n-                          SecureRandom.hex(64)\n-                        else\n-                          ENV.fetch('OTP_SECRET')\n-                        end\n-\n   # Enable DNS rebinding protection and other `Host` header attacks.\n   # config.hosts = [\n   #   \"example.com\",     # Allow requests from example.com\n---\nconfig/environments/test.rb\n@@ -48,9 +48,6 @@\n   # Print deprecation notices to the stderr.\n   config.active_support.deprecation = :stderr\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = '100c7faeef00caa29242f6b04156742bf76065771fd4117990c4282b8748ff3d99f8fdae97c982ab5bd2e6756a159121377cce4421f4a8ecd2d67bd7749a3fb4'\n-\n   # Generate random VAPID keys\n   vapid_key = Webpush.generate_key\n   config.x.vapid_private_key = vapid_key.private_key\n---\ndb/post_migrate/20240307180905_migrate_devise_two_factor_secrets.rb\n@@ -79,8 +79,18 @@ def legacy_otp_secret\n   class MigrationUser < ApplicationRecord\n     self.table_name = :users\n \n+    LEGACY_OTP_SECRET = begin\n+      if Rails.env.test?\n+        '100c7faeef00caa29242f6b04156742bf76065771fd4117990c4282b8748ff3d99f8fdae97c982ab5bd2e6756a159121377cce4421f4a8ecd2d67bd7749a3fb4'\n+      elsif ENV['SECRET_KEY_BASE_DUMMY']\n+        SecureRandom.hex(64)\n+      else\n+        ENV.fetch('OTP_SECRET')\n+      end\n+    end\n+\n     devise :two_factor_authenticatable,\n-           otp_secret_encryption_key: Rails.configuration.x.otp_secret\n+           otp_secret_encryption_key: LEGACY_OTP_SECRET\n \n     include LegacyOtpSecret\n   end\n---\n\n\n---\n\nChoice C:\napp/views/layouts/application.html.haml\n@@ -31,7 +31,7 @@\n     -# Needed for the wicg-inert polyfill. It needs to be on it's own <style> tag, with this `id`\n     = vite_stylesheet_tag 'styles/inert.scss', media: 'all', id: 'inert-style'\n \n-    -# = vite_preload_tag \"mastodon/locales/#{I18n.locale}.json\", :crossorigin => 'anonymous'\n+    = vite_preload_file_tag \"mastodon/locales/#{I18n.locale}.json\"\n     = csrf_meta_tags unless skip_csrf_meta_tags?\n     %meta{ name: 'style-nonce', content: request.content_security_policy_nonce }\n \n---\napp/views/layouts/embedded.html.haml\n@@ -14,7 +14,7 @@\n     = vite_client_tag\n     = vite_react_refresh_tag\n     = theme_style_tags 'mastodon-light'\n-    -# = vite_preload_tag \"mastodon/locales/#{I18n.locale}.json\", :crossorigin => 'anonymous'\n+    = vite_preload_file_tag \"mastodon/locales/#{I18n.locale}.json\"\n     = render_initial_state\n     = vite_typescript_tag 'embed.tsx', integrity: true, crossorigin: 'anonymous'\n   %body.embed\n---\nlib/vite_ruby/sri_extensions.rb\n@@ -35,6 +35,16 @@ def resolve_entries_with_integrity(*names, **options)\n       stylesheets: dev_server_running? ? [] : (entries + imports).flat_map { |entry| entry['css'] }.compact.uniq,\n     }\n   end\n+\n+  # We need to override this method to not include the manifest, as in our case it is too large and will cause a JSON max nesting error rather than raising the expected exception\n+  def missing_entry_error(name, **)\n+    raise ViteRuby::MissingEntrypointError.new(\n+      file_name: resolve_entry_name(name, **),\n+      last_build: builder.last_build_metadata,\n+      manifest: '',\n+      config: config\n+    )\n+  end\n end\n \n ViteRuby::Manifest.prepend ViteRuby::ManifestIntegrityExtension\n@@ -95,6 +105,20 @@ def vite_stylesheet_tag(*names, **options)\n       end\n     end\n   end\n+\n+  def vite_preload_file_tag(name,\n+                            asset_type: :javascript,\n+                            crossorigin: 'anonymous', **options)\n+    ''.html_safe.tap do |tags|\n+      entries = vite_manifest.resolve_entries_with_integrity(name, type: asset_type)\n+\n+      entries.fetch(:scripts).each do |script|\n+        tags << vite_preload_tag(script[:file], integrity: script[:integrity], crossorigin: crossorigin, **options)\n+      end\n+    end\n+  rescue ViteRuby::MissingEntrypointError\n+    # Ignore this error, it is not critical if the file is not preloaded\n+  end\n end\n \n ViteRails::TagHelpers.prepend ViteRails::TagHelpers::IntegrityExtension\n---\n\n\n---\n\nChoice D:\nconfig/environments/development.rb\n@@ -37,10 +37,8 @@\n \n   config.action_controller.forgery_protection_origin_check = ENV['DISABLE_FORGERY_REQUEST_PROTECTION'].nil?\n \n-  ActiveSupport::Logger.new($stdout).tap do |logger|\n-    logger.formatter = config.log_formatter\n-    config.logger = ActiveSupport::TaggedLogging.new(logger)\n-  end\n+  # Override default file logging in favor of STDOUT logging in dev environment\n+  config.logger = ActiveSupport::TaggedLogging.logger($stdout, formatter: config.log_formatter)\n \n   # Generate random VAPID keys\n   Webpush.generate_key.tap do |vapid_key|\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFor some reason, `Faraday.ignore_env_proxy` is not working as intended.\r\nThis PR is workaround.\r\n\r\nFix: #34339\n\n---\n\nChoice A:\nGemfile.lock\n@@ -592,7 +592,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n     orm_adapter (0.5.0)\n     ostruct (0.6.1)\n-    ox (2.14.22)\n+    ox (2.14.23)\n       bigdecimal (>= 3.0)\n     parallel (1.27.0)\n     parser (3.3.8.0)\n---\n\n\n---\n\nChoice B:\nconfig/initializers/chewy.rb\n@@ -9,7 +9,11 @@\n prefix          = ENV.fetch('ES_PREFIX') { fallback_prefix }\n ca_file         = ENV.fetch('ES_CA_FILE', nil).presence\n \n-transport_options = { ssl: { ca_file: ca_file } } if ca_file.present?\n+# While Faraday ignore http_proxy env var when Faraday.ignore_env_proxy eqals true, elasticsearch-transport will use proxy. This is a workaround to avoid this.\n+transport_options = {\n+  proxy: {},\n+}\n+transport_options[:ssl] = { ca_file: ca_file } if ca_file.present?\n \n Chewy.settings = {\n   host: \"#{host}:#{port}\",\n---\n\n\n---\n\nChoice C:\nconfig/initializers/cookie_rotator.rb\n@@ -0,0 +1,23 @@\n+# frozen_string_literal: true\n+\n+# TODO: remove this file some time after 4.3.0\n+\n+Rails.application.config.after_initialize do\n+  Rails.application.config.action_dispatch.cookies_rotations.tap do |cookies|\n+    authenticated_encrypted_cookie_salt = Rails.application.config.action_dispatch.authenticated_encrypted_cookie_salt\n+    signed_cookie_salt = Rails.application.config.action_dispatch.signed_cookie_salt\n+\n+    secret_key_base = Rails.application.secret_key_base\n+\n+    key_generator = ActiveSupport::KeyGenerator.new(\n+      secret_key_base, iterations: 1000, hash_digest_class: OpenSSL::Digest::SHA1\n+    )\n+    key_len = ActiveSupport::MessageEncryptor.key_len\n+\n+    old_encrypted_secret = key_generator.generate_key(authenticated_encrypted_cookie_salt, key_len)\n+    old_signed_secret = key_generator.generate_key(signed_cookie_salt)\n+\n+    cookies.rotate :encrypted, old_encrypted_secret\n+    cookies.rotate :signed, old_signed_secret\n+  end\n+end\n---\n\n\n---\n\nChoice D:\nlib/chewy/index_extensions.rb\n@@ -12,6 +12,13 @@ def index_preset(base_options = {})\n         base_options.merge(number_of_replicas: 1, number_of_shards: (base_options[:number_of_shards] || 1) * 2)\n       end\n     end\n+\n+    def update_specification\n+      client.indices.close index: index_name\n+      client.indices.put_settings index: index_name, body: { settings: { analysis: settings_hash[:settings][:analysis] } }\n+      client.indices.put_mapping index: index_name, body: root.mappings_hash\n+      client.indices.open index: index_name\n+    end\n   end\n end\n \n---\nlib/mastodon/cli/search.rb\n@@ -56,7 +56,7 @@ def deploy\n       if options[:only_mapping]\n         indices.select { |index| index.specification.changed? }.each do |index|\n           progress.title = \"Updating mapping for #{index} \"\n-          index.update_mapping\n+          index.update_specification\n           index.specification.lock!\n         end\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [@babel/core](https://babel.dev/docs/en/next/babel-core) ([source](https://redirect.github.com/babel/babel/tree/HEAD/packages/babel-core)) | [`7.26.10` -> `7.27.1`](https://renovatebot.com/diffs/npm/@babel%2fcore/7.26.10/7.27.1) | [![age](https://developer.mend.io/api/mc/badges/age/npm/@babel%2fcore/7.27.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/@babel%2fcore/7.27.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/@babel%2fcore/7.26.10/7.27.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/@babel%2fcore/7.26.10/7.27.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>babel/babel (@&#8203;babel/core)</summary>\n\n### [`v7.27.1`](https://redirect.github.com/babel/babel/blob/HEAD/CHANGELOG.md#v7271-2025-04-30)\n\n[Compare Source](https://redirect.github.com/babel/babel/compare/v7.26.10...v7.27.1)\n\n##### :eyeglasses: Spec Compliance\n\n-   `babel-parser`\n    -   [#&#8203;17254](https://redirect.github.com/babel/babel/pull/17254) Allow `using of` as lexical declaration within for ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n    -   [#&#8203;17230](https://redirect.github.com/babel/babel/pull/17230) Disallow get/set in TSPropertySignature ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n-   `babel-parser`, `babel-types`\n    -   [#&#8203;17193](https://redirect.github.com/babel/babel/pull/17193) Stricter TSImportType options parsing ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n\n##### :bug: Bug Fix\n\n-   `babel-plugin-proposal-destructuring-private`, `babel-plugin-proposal-do-expressions`, `babel-traverse`\n    -   [#&#8203;17137](https://redirect.github.com/babel/babel/pull/17137) fix: do expressions should allow early exit ([@&#8203;kermanx](https://redirect.github.com/kermanx))\n-   `babel-helper-wrap-function`, `babel-plugin-transform-async-to-generator`\n    -   [#&#8203;17251](https://redirect.github.com/babel/babel/pull/17251) Fix: propagate argument evaluation errors through async promise chain ([@&#8203;magic-akari](https://redirect.github.com/magic-akari))\n-   `babel-helper-remap-async-to-generator`, `babel-plugin-transform-async-to-generator`\n    -   [#&#8203;17231](https://redirect.github.com/babel/babel/pull/17231) fix apply()/call() annotated as pure ([@&#8203;Lacsw](https://redirect.github.com/Lacsw))\n-   `babel-helper-fixtures`, `babel-parser`\n    -   [#&#8203;17233](https://redirect.github.com/babel/babel/pull/17233) Create ChainExpression within TSInstantiationExpression ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n-   `babel-generator`, `babel-parser`\n    -   [#&#8203;17226](https://redirect.github.com/babel/babel/pull/17226) Fill optional AST properties when both estree and typescript parser plugin are enabled (Part 2) ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n-   `babel-parser`\n    -   [#&#8203;17224](https://redirect.github.com/babel/babel/pull/17224) Fill optional AST properties when both estree and typescript parser plugin are enabled (Part 1) ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n    -   [#&#8203;17080](https://redirect.github.com/babel/babel/pull/17080) Fix start of TSParameterProperty ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n-   `babel-compat-data`, `babel-preset-env`\n    -   [#&#8203;17228](https://redirect.github.com/babel/babel/pull/17228) Update firefox bugfix compat data ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n-   `babel-traverse`\n    -   [#&#8203;17156](https://redirect.github.com/babel/babel/pull/17156) fix: Objects and arrays with multiple references should not be evaluated ([@&#8203;liuxingbaoyu](https://redirect.github.com/liuxingbaoyu))\n-   `babel-generator`\n    -   [#&#8203;17216](https://redirect.github.com/babel/babel/pull/17216) Fix: support const type parameter in generator ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n\n##### :nail_care: Polish\n\n-   `babel-plugin-bugfix-v8-spread-parameters-in-optional-chaining`, `babel-plugin-proposal-decorators`, `babel-plugin-transform-arrow-functions`, `babel-plugin-transform-class-properties`, `babel-plugin-transform-destructuring`, `babel-plugin-transform-object-rest-spread`, `babel-plugin-transform-optional-chaining`, `babel-plugin-transform-parameters`, `babel-traverse`\n    -   [#&#8203;17221](https://redirect.github.com/babel/babel/pull/17221) Reduce generated names size for the 10th-11th ([@&#8203;nicolo-ribaudo](https://redirect.github.com/nicolo-ribaudo))\n\n##### :house: Internal\n\n-   `babel-runtime-corejs2`, `babel-runtime-corejs3`, `babel-runtime`\n    -   [#&#8203;17263](https://redirect.github.com/babel/babel/pull/17263) Remove unused `regenerator-runtime` dep in `@babel/runtime` ([@&#8203;nicolo-ribaudo](https://redirect.github.com/nicolo-ribaudo))\n-   `babel-compat-data`, `babel-preset-env`\n    -   [#&#8203;17256](https://redirect.github.com/babel/babel/pull/17256) Tune plugin compat data ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n-   `babel-compat-data`, `babel-standalone`\n    -   [#&#8203;17236](https://redirect.github.com/babel/babel/pull/17236) migrate babel-compat-data build script to mjs ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n-   Other\n    -   [#&#8203;17232](https://redirect.github.com/babel/babel/pull/17232) Bump typescript-eslint to 8.29.1 ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n    -   [#&#8203;17219](https://redirect.github.com/babel/babel/pull/17219) test: add basic typescript-eslint integration tests ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n    -   [#&#8203;17205](https://redirect.github.com/babel/babel/pull/17205) Inline regenerator in the relevant packages ([@&#8203;nicolo-ribaudo](https://redirect.github.com/nicolo-ribaudo))\n-   `babel-register`\n    -   [#&#8203;16844](https://redirect.github.com/babel/babel/pull/16844) Migrate `@babel/register` to cts ([@&#8203;liuxingbaoyu](https://redirect.github.com/liuxingbaoyu))\n-   `babel-cli`, `babel-compat-data`, `babel-core`, `babel-generator`, `babel-helper-compilation-targets`, `babel-helper-fixtures`, `babel-helper-module-imports`, `babel-helper-module-transforms`, `babel-helper-plugin-test-runner`, `babel-helper-transform-fixture-test-runner`, `babel-helpers`, `babel-node`, `babel-parser`, `babel-plugin-transform-modules-amd`, `babel-plugin-transform-modules-commonjs`, `babel-plugin-transform-modules-systemjs`, `babel-plugin-transform-modules-umd`, `babel-plugin-transform-react-display-name`, `babel-plugin-transform-regenerator`, `babel-plugin-transform-runtime`, `babel-plugin-transform-typeof-symbol`, `babel-plugin-transform-typescript`, `babel-preset-env`, `babel-register`, `babel-standalone`, `babel-types`\n    -   [#&#8203;17207](https://redirect.github.com/babel/babel/pull/17207) Enforce node protocol import ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n-   `babel-plugin-transform-regenerator`\n    -   [#&#8203;17205](https://redirect.github.com/babel/babel/pull/17205) Inline regenerator in the relevant packages ([@&#8203;nicolo-ribaudo](https://redirect.github.com/nicolo-ribaudo))\n    -   [#&#8203;17205](https://redirect.github.com/babel/babel/pull/17205) Inline regenerator in the relevant packages ([@&#8203;nicolo-ribaudo](https://redirect.github.com/nicolo-ribaudo))\n-   `babel-helpers`, `babel-plugin-transform-async-generator-functions`, `babel-plugin-transform-regenerator`, `babel-preset-env`, `babel-runtime-corejs3`\n    -   [#&#8203;17205](https://redirect.github.com/babel/babel/pull/17205) Inline regenerator in the relevant packages ([@&#8203;nicolo-ribaudo](https://redirect.github.com/nicolo-ribaudo))\n-   `babel-helpers`, `babel-plugin-transform-regenerator`\n    -   [#&#8203;17205](https://redirect.github.com/babel/babel/pull/17205) Inline regenerator in the relevant packages ([@&#8203;nicolo-ribaudo](https://redirect.github.com/nicolo-ribaudo))\n    -   [#&#8203;17205](https://redirect.github.com/babel/babel/pull/17205) Inline regenerator in the relevant packages ([@&#8203;nicolo-ribaudo](https://redirect.github.com/nicolo-ribaudo))\n-   `babel-helpers`\n    -   [#&#8203;17205](https://redirect.github.com/babel/babel/pull/17205) Inline regenerator in the relevant packages ([@&#8203;nicolo-ribaudo](https://redirect.github.com/nicolo-ribaudo))\n\n##### :microscope: Output optimization\n\n-   `babel-helpers`, `babel-plugin-transform-modules-commonjs`, `babel-runtime-corejs3`\n    -   [#&#8203;16538](https://redirect.github.com/babel/babel/pull/16538) Reduce `interopRequireWildcard` size ([@&#8203;liuxingbaoyu](https://redirect.github.com/liuxingbaoyu))\n-   `babel-helpers`, `babel-plugin-transform-async-generator-functions`, `babel-plugin-transform-regenerator`, `babel-preset-env`, `babel-runtime-corejs3`\n    -   [#&#8203;17213](https://redirect.github.com/babel/babel/pull/17213) Reduce `regeneratorRuntime` size ([@&#8203;liuxingbaoyu](https://redirect.github.com/liuxingbaoyu))\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiI0MC43LjEiLCJ1cGRhdGVkSW5WZXIiOiI0MC43LjEiLCJ0YXJnZXRCcmFuY2giOiJtYWluIiwibGFiZWxzIjpbImRlcGVuZGVuY2llcyIsImphdmFzY3JpcHQiXX0=-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -48,7 +48,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/code-frame@npm:^7.0.0, @babel/code-frame@npm:^7.10.4, @babel/code-frame@npm:^7.26.2, @babel/code-frame@npm:^7.27.1\":\n+\"@babel/code-frame@npm:^7.0.0, @babel/code-frame@npm:^7.10.4, @babel/code-frame@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/code-frame@npm:7.27.1\"\n   dependencies:\n@@ -67,29 +67,29 @@ __metadata:\n   linkType: hard\n \n \"@babel/core@npm:^7.12.3, @babel/core@npm:^7.21.3, @babel/core@npm:^7.22.1, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n-  version: 7.26.10\n-  resolution: \"@babel/core@npm:7.26.10\"\n+  version: 7.27.1\n+  resolution: \"@babel/core@npm:7.27.1\"\n   dependencies:\n     \"@ampproject/remapping\": \"npm:^2.2.0\"\n-    \"@babel/code-frame\": \"npm:^7.26.2\"\n-    \"@babel/generator\": \"npm:^7.26.10\"\n-    \"@babel/helper-compilation-targets\": \"npm:^7.26.5\"\n-    \"@babel/helper-module-transforms\": \"npm:^7.26.0\"\n-    \"@babel/helpers\": \"npm:^7.26.10\"\n-    \"@babel/parser\": \"npm:^7.26.10\"\n-    \"@babel/template\": \"npm:^7.26.9\"\n-    \"@babel/traverse\": \"npm:^7.26.10\"\n-    \"@babel/types\": \"npm:^7.26.10\"\n+    \"@babel/code-frame\": \"npm:^7.27.1\"\n+    \"@babel/generator\": \"npm:^7.27.1\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/helper-module-transforms\": \"npm:^7.27.1\"\n+    \"@babel/helpers\": \"npm:^7.27.1\"\n+    \"@babel/parser\": \"npm:^7.27.1\"\n+    \"@babel/template\": \"npm:^7.27.1\"\n+    \"@babel/traverse\": \"npm:^7.27.1\"\n+    \"@babel/types\": \"npm:^7.27.1\"\n     convert-source-map: \"npm:^2.0.0\"\n     debug: \"npm:^4.1.0\"\n     gensync: \"npm:^1.0.0-beta.2\"\n     json5: \"npm:^2.2.3\"\n     semver: \"npm:^6.3.1\"\n-  checksum: 10c0/e046e0e988ab53841b512ee9d263ca409f6c46e2a999fe53024688b92db394346fa3aeae5ea0866331f62133982eee05a675d22922a4603c3f603aa09a581d62\n+  checksum: 10c0/0fc31f87f5401ac5d375528cb009f4ea5527fc8c5bb5b64b5b22c033b60fd0ad723388933a5f3f5db14e1edd13c958e9dd7e5c68f9b68c767aeb496199c8a4bb\n   languageName: node\n   linkType: hard\n \n-\"@babel/generator@npm:^7.26.10, @babel/generator@npm:^7.27.1\":\n+\"@babel/generator@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/generator@npm:7.27.1\"\n   dependencies:\n@@ -121,7 +121,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.26.5, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n+\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n   version: 7.27.2\n   resolution: \"@babel/helper-compilation-targets@npm:7.27.2\"\n   dependencies:\n@@ -199,7 +199,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-module-transforms@npm:^7.26.0, @babel/helper-module-transforms@npm:^7.27.1\":\n+\"@babel/helper-module-transforms@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/helper-module-transforms@npm:7.27.1\"\n   dependencies:\n@@ -296,17 +296,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helpers@npm:^7.26.10\":\n-  version: 7.26.10\n-  resolution: \"@babel/helpers@npm:7.26.10\"\n+\"@babel/helpers@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helpers@npm:7.27.1\"\n   dependencies:\n-    \"@babel/template\": \"npm:^7.26.9\"\n-    \"@babel/types\": \"npm:^7.26.10\"\n-  checksum: 10c0/f99e1836bcffce96db43158518bb4a24cf266820021f6461092a776cba2dc01d9fc8b1b90979d7643c5c2ab7facc438149064463a52dd528b21c6ab32509784f\n+    \"@babel/template\": \"npm:^7.27.1\"\n+    \"@babel/types\": \"npm:^7.27.1\"\n+  checksum: 10c0/e078257b9342dae2c041ac050276c5a28701434ad09478e6dc6976abd99f721a5a92e4bebddcbca6b1c3a7e8acace56a946340c701aad5e7507d2c87446459ba\n   languageName: node\n   linkType: hard\n \n-\"@babel/parser@npm:^7.1.0, @babel/parser@npm:^7.20.7, @babel/parser@npm:^7.26.10, @babel/parser@npm:^7.27.1\":\n+\"@babel/parser@npm:^7.1.0, @babel/parser@npm:^7.20.7, @babel/parser@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/parser@npm:7.27.1\"\n   dependencies:\n@@ -1292,7 +1292,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/template@npm:^7.26.9, @babel/template@npm:^7.27.1\":\n+\"@babel/template@npm:^7.27.1\":\n   version: 7.27.1\n   resolution: \"@babel/template@npm:7.27.1\"\n   dependencies:\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -1,18 +1,24 @@\n import { FormattedMessage } from 'react-intl';\n \n import classNames from 'classnames';\n+import { Link } from 'react-router-dom';\n \n import type { Map as ImmutableMap } from 'immutable';\n \n+import ArticleIcon from '@/material-icons/400-24px/article.svg?react';\n+import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react';\n import { Icon } from 'mastodon/components/icon';\n import StatusContainer from 'mastodon/containers/status_container';\n+import type { Status } from 'mastodon/models/status';\n import { useAppSelector } from 'mastodon/store';\n \n import QuoteIcon from '../../images/quote.svg?react';\n \n+const MAX_QUOTE_POSTS_NESTING_LEVEL = 1;\n+\n const QuoteWrapper: React.FC<{\n   isError?: boolean;\n-  children: React.ReactNode;\n+  children: React.ReactElement;\n }> = ({ isError, children }) => {\n   return (\n     <div\n@@ -26,16 +32,52 @@ const QuoteWrapper: React.FC<{\n   );\n };\n \n+const QuoteLink: React.FC<{\n+  status: Status;\n+}> = ({ status }) => {\n+  const accountId = status.get('account') as string;\n+  const account = useAppSelector((state) =>\n+    accountId ? state.accounts.get(accountId) : undefined,\n+  );\n+\n+  const quoteAuthorName = account?.display_name_html;\n+\n+  if (!quoteAuthorName) {\n+    return null;\n+  }\n+\n+  const quoteAuthorElement = (\n+    <span dangerouslySetInnerHTML={{ __html: quoteAuthorName }} />\n+  );\n+  const quoteUrl = `/@${account.get('acct')}/${status.get('id') as string}`;\n+\n+  return (\n+    <Link to={quoteUrl} className='status__quote-author-button'>\n+      <FormattedMessage\n+        id='status.quote_post_author'\n+        defaultMessage='Post by {name}'\n+        values={{ name: quoteAuthorElement }}\n+      />\n+      <Icon id='chevron_right' icon={ChevronRightIcon} />\n+      <Icon id='article' icon={ArticleIcon} />\n+    </Link>\n+  );\n+};\n+\n type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n \n-export const QuotedStatus: React.FC<{ quote: QuoteMap }> = ({ quote }) => {\n+export const QuotedStatus: React.FC<{\n+  quote: QuoteMap;\n+  variant?: 'full' | 'link';\n+  nestingLevel?: number;\n+}> = ({ quote, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n   const state = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n \n-  let quoteError: React.ReactNode | null = null;\n+  let quoteError: React.ReactNode = null;\n \n   if (state === 'deleted') {\n     quoteError = (\n@@ -78,14 +120,28 @@ export const QuotedStatus: React.FC<{ quote: QuoteMap }> = ({ quote }) => {\n     return <QuoteWrapper isError>{quoteError}</QuoteWrapper>;\n   }\n \n+  if (variant === 'link' && status) {\n+    return <QuoteLink status={status} />;\n+  }\n+\n+  const childQuote = status?.get('quote') as QuoteMap | undefined;\n+  const canRenderChildQuote =\n+    childQuote && nestingLevel <= MAX_QUOTE_POSTS_NESTING_LEVEL;\n+\n   return (\n     <QuoteWrapper>\n-      <StatusContainer\n-        // @ts-expect-error Status isn't typed yet\n-        isQuotedPost\n-        id={quotedStatusId}\n-        avatarSize={40}\n-      />\n+      {/* @ts-expect-error Status is not yet typed */}\n+      <StatusContainer isQuotedPost id={quotedStatusId} avatarSize={40}>\n+        {canRenderChildQuote && (\n+          <QuotedStatus\n+            quote={childQuote}\n+            variant={\n+              nestingLevel === MAX_QUOTE_POSTS_NESTING_LEVEL ? 'link' : 'full'\n+            }\n+            nestingLevel={nestingLevel + 1}\n+          />\n+        )}\n+      </StatusContainer>\n     </QuoteWrapper>\n   );\n };\n---\napp/javascript/mastodon/locales/en.json\n@@ -868,6 +868,7 @@\n   \"status.quote_error.rejected\": \"This post cannot be displayed as the original author does not allow it to be quoted.\",\n   \"status.quote_error.removed\": \"This post was removed by its author.\",\n   \"status.quote_error.unauthorized\": \"This post cannot be displayed as you are not authorized to view it.\",\n+  \"status.quote_post_author\": \"Post by {name}\",\n   \"status.read_more\": \"Read more\",\n   \"status.reblog\": \"Boost\",\n   \"status.reblog_private\": \"Boost with original visibility\",\n---\napp/javascript/material-icons/400-24px/article-fill.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm80-160h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/article.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M280-280h280v-80H280v80Zm0-160h400v-80H280v80Zm0-160h400v-80H280v80Zm-80 480q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h560q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560H200v560Zm0-560v560-560Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/README.md\n@@ -1 +1,12 @@\n-Files in this directory are Material Symbols icons fetched using the `icons:download` task.\n+Files in this directory are Material Symbols icons fetched using the `icons:download` rake task (see `/lib/tasks/icons.rake`).\n+\n+To add another icon, follow these steps:\n+\n+- Determine the name of the Material Symbols icon you want to download.\n+  You can find a searchable overview of all icons on [https://fonts.google.com/icons].\n+  Click on the icon you want to use and find the icon name towards the bottom of the slide-out panel (it'll be something like `icon_name`)\n+- Import the icon in your React component using the following format:\n+  `import IconName from '@/material-icons/400-24px/icon_name.svg?react';`\n+- Run `RAILS_ENV=development rails icons:download` to download any newly imported icons.\n+\n+The import should now work and the icon should appear when passed to the `<Icon icon={IconName} /> component\n---\napp/javascript/styles/mastodon/components.scss\n@@ -1880,11 +1880,15 @@ body > [data-popper-placement] {\n .status__quote {\n   position: relative;\n   margin-block-start: 16px;\n-  margin-inline-start: 56px;\n+  margin-inline-start: 36px;\n   border-radius: 8px;\n   color: var(--nested-card-text);\n   background: var(--nested-card-background);\n   border: var(--nested-card-border);\n+\n+  @media screen and (min-width: $mobile-breakpoint) {\n+    margin-inline-start: 56px;\n+  }\n }\n \n .status__quote--error {\n@@ -1895,10 +1899,42 @@ body > [data-popper-placement] {\n   font-size: 15px;\n }\n \n+.status__quote-author-button {\n+  position: relative;\n+  overflow: hidden;\n+  display: inline-flex;\n+  width: auto;\n+  margin-block-start: 10px;\n+  padding: 5px 12px;\n+  align-items: center;\n+  gap: 6px;\n+  font-family: inherit;\n+  font-size: 14px;\n+  font-weight: 700;\n+  line-height: normal;\n+  letter-spacing: 0;\n+  text-decoration: none;\n+  color: $highlight-text-color;\n+  background: var(--nested-card-background);\n+  border: var(--nested-card-border);\n+  border-radius: 4px;\n+\n+  &:active,\n+  &:focus,\n+  &:hover {\n+    border-color: lighten($highlight-text-color, 4%);\n+    color: lighten($highlight-text-color, 4%);\n+  }\n+\n+  &:focus-visible {\n+    outline: $ui-button-icon-focus-outline;\n+  }\n+}\n+\n .status__quote-icon {\n   position: absolute;\n   inset-block-start: 18px;\n-  inset-inline-start: -50px;\n+  inset-inline-start: -40px;\n   display: block;\n   width: 26px;\n   height: 26px;\n@@ -1910,6 +1946,10 @@ body > [data-popper-placement] {\n     inset-block-start: 50%;\n     transform: translateY(-50%);\n   }\n+\n+  @media screen and (min-width: $mobile-breakpoint) {\n+    inset-inline-start: -50px;\n+  }\n }\n \n .detailed-status__link {\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -7829,14 +7829,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"es-module-lexer@npm:^1.5.3\":\n-  version: 1.6.0\n-  resolution: \"es-module-lexer@npm:1.6.0\"\n-  checksum: 10c0/667309454411c0b95c476025929881e71400d74a746ffa1ff4cb450bd87f8e33e8eef7854d68e401895039ac0bac64e7809acbebb6253e055dd49ea9e3ea9212\n-  languageName: node\n-  linkType: hard\n-\n-\"es-module-lexer@npm:^1.7.0\":\n+\"es-module-lexer@npm:^1.5.3, es-module-lexer@npm:^1.7.0\":\n   version: 1.7.0\n   resolution: \"es-module-lexer@npm:1.7.0\"\n   checksum: 10c0/4c935affcbfeba7fb4533e1da10fa8568043df1e3574b869385980de9e2d475ddc36769891936dbb07036edb3c3786a8b78ccf44964cd130dedc1f2c984b6c7b\n@@ -14945,8 +14938,8 @@ __metadata:\n   linkType: hard\n \n \"sass@npm:^1.62.1\":\n-  version: 1.87.0\n-  resolution: \"sass@npm:1.87.0\"\n+  version: 1.88.0\n+  resolution: \"sass@npm:1.88.0\"\n   dependencies:\n     \"@parcel/watcher\": \"npm:^2.4.1\"\n     chokidar: \"npm:^4.0.0\"\n@@ -14957,7 +14950,7 @@ __metadata:\n       optional: true\n   bin:\n     sass: sass.js\n-  checksum: 10c0/bd245faf14e4783dc547765350cf05817edaac0d6d6f6e4da8ab751f3eb3cc3873afd563c0ce416a24aa6c9c4e9023b05096447fc006660a01f76adffb54fbc6\n+  checksum: 10c0/dcb16dc29116bfa5a90485d24fd8020d2b0d95155bd2e31285901588729343b59fefe44365c5f146b2ba5a9ebadef90b23a7220b902507bdbd91ca2ba0a0b688\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -79,7 +79,7 @@ gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n gem 'redis-namespace', '~> 1.10'\n-gem 'rqrcode', '~> 2.2'\n+gem 'rqrcode', '~> 3.0'\n gem 'ruby-progressbar', '~> 1.13'\n gem 'sanitize', '~> 7.0'\n gem 'scenic', '~> 1.7'\n---\nGemfile.lock\n@@ -711,10 +711,10 @@ GEM\n     rotp (6.3.0)\n     rouge (4.5.1)\n     rpam2 (4.0.2)\n-    rqrcode (2.2.0)\n+    rqrcode (3.0.0)\n       chunky_png (~> 1.0)\n-      rqrcode_core (~> 1.0)\n-    rqrcode_core (1.2.0)\n+      rqrcode_core (~> 2.0)\n+    rqrcode_core (2.0.0)\n     rspec (3.13.0)\n       rspec-core (~> 3.13.0)\n       rspec-expectations (~> 3.13.0)\n@@ -1043,7 +1043,7 @@ DEPENDENCIES\n   redcarpet (~> 3.6)\n   redis (~> 4.5)\n   redis-namespace (~> 1.10)\n-  rqrcode (~> 2.2)\n+  rqrcode (~> 3.0)\n   rspec-github (~> 3.0)\n   rspec-rails (~> 7.0)\n   rspec-sidekiq (~> 5.0)\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nTruncate display name for new accounts created during OIDC login. \r\n\r\nfix: #34638\n\n---\n\nChoice A:\napp/helpers/context_helper.rb\n@@ -25,6 +25,7 @@ module ContextHelper\n     voters_count: { 'toot' => 'http://joinmastodon.org/ns#', 'votersCount' => 'toot:votersCount' },\n     suspended: { 'toot' => 'http://joinmastodon.org/ns#', 'suspended' => 'toot:suspended' },\n     attribution_domains: { 'toot' => 'http://joinmastodon.org/ns#', 'attributionDomains' => { '@id' => 'toot:attributionDomains', '@type' => '@id' } },\n+    quote_requests: { 'QuoteRequest' => 'https://w3id.org/fep/044f#QuoteRequest' },\n   }.freeze\n \n   def full_context\n---\napp/lib/activitypub/activity.rb\n@@ -57,6 +57,8 @@ def klass\n         ActivityPub::Activity::Remove\n       when 'Move'\n         ActivityPub::Activity::Move\n+      when 'QuoteRequest'\n+        ActivityPub::Activity::QuoteRequest\n       end\n     end\n   end\n---\napp/lib/activitypub/activity/quote_request.rb\n@@ -0,0 +1,30 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::Activity::QuoteRequest < ActivityPub::Activity\n+  include Payloadable\n+\n+  def perform\n+    return unless Mastodon::Feature.inbound_quotes_enabled?\n+    return if non_matching_uri_hosts?(@account.uri, @json['id'])\n+\n+    quoted_status = status_from_uri(object_uri)\n+    return if quoted_status.nil? || !quoted_status.account.local? || !quoted_status.distributable?\n+\n+    # For now, we don't support being quoted by external servers\n+    reject_quote_request!(quoted_status)\n+  end\n+\n+  private\n+\n+  def reject_quote_request!(quoted_status)\n+    quote = Quote.new(\n+      quoted_status: quoted_status,\n+      quoted_account: quoted_status.account,\n+      status: Status.new(account: @account, uri: @json['instrument']),\n+      account: @account,\n+      activity_uri: @json['id']\n+    )\n+    json = Oj.dump(serialize_payload(quote, ActivityPub::RejectQuoteRequestSerializer))\n+    ActivityPub::DeliveryWorker.perform_async(json, quoted_status.account_id, @account.inbox_url)\n+  end\n+end\n---\napp/serializers/activitypub/quote_request_serializer.rb\n@@ -0,0 +1,28 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::QuoteRequestSerializer < ActivityPub::Serializer\n+  context_extensions :quote_requests\n+\n+  attributes :id, :type, :actor, :instrument\n+  attribute :virtual_object, key: :object\n+\n+  def id\n+    object.activity_uri || [ActivityPub::TagManager.instance.uri_for(object.target_account), '#quote_requests/', object.id].join\n+  end\n+\n+  def type\n+    'QuoteRequest'\n+  end\n+\n+  def actor\n+    ActivityPub::TagManager.instance.uri_for(object.account)\n+  end\n+\n+  def virtual_object\n+    ActivityPub::TagManager.instance.uri_for(object.quoted_status)\n+  end\n+\n+  def instrument\n+    ActivityPub::TagManager.instance.uri_for(object.status)\n+  end\n+end\n---\napp/serializers/activitypub/reject_quote_request_serializer.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::RejectQuoteRequestSerializer < ActivityPub::Serializer\n+  attributes :id, :type, :actor\n+\n+  has_one :object, serializer: ActivityPub::QuoteRequestSerializer\n+\n+  def id\n+    [ActivityPub::TagManager.instance.uri_for(object.quoted_account), '#rejects/quote_requests/', object.id].join\n+  end\n+\n+  def type\n+    'Reject'\n+  end\n+\n+  def actor\n+    ActivityPub::TagManager.instance.uri_for(object.quoted_account)\n+  end\n+end\n---\nspec/lib/activitypub/activity/quote_request_spec.rb\n@@ -0,0 +1,51 @@\n+# frozen_string_literal: true\n+\n+require 'rails_helper'\n+\n+RSpec.describe ActivityPub::Activity::QuoteRequest, feature: :inbound_quotes do\n+  let(:sender)    { Fabricate(:account, domain: 'example.com') }\n+  let(:recipient) { Fabricate(:account) }\n+  let(:quoted_post) { Fabricate(:status, account: recipient) }\n+  let(:request_uri) { 'https://example.com/missing-ui' }\n+  let(:quoted_uri) { ActivityPub::TagManager.instance.uri_for(quoted_post) }\n+\n+  let(:json) do\n+    {\n+      '@context': [\n+        'https://www.w3.org/ns/activitystreams',\n+        {\n+          QuoteRequest: 'https://w3id.org/fep/044f#QuoteRequest',\n+        },\n+      ],\n+      id: request_uri,\n+      type: 'QuoteRequest',\n+      actor: ActivityPub::TagManager.instance.uri_for(sender),\n+      object: quoted_uri,\n+      instrument: 'https://example.com/unknown-status',\n+    }.with_indifferent_access\n+  end\n+\n+  describe '#perform' do\n+    subject { described_class.new(json, sender) }\n+\n+    context 'when trying to quote an unknown status' do\n+      let(:quoted_uri) { 'https://example.com/statuses/1234' }\n+\n+      it 'does not send anything' do\n+        expect { subject.perform }\n+          .to_not enqueue_sidekiq_job(ActivityPub::DeliveryWorker)\n+      end\n+    end\n+\n+    context 'when trying to quote an unquotable local status' do\n+      it 'sends a Reject activity' do\n+        expect { subject.perform }\n+          .to enqueue_sidekiq_job(ActivityPub::DeliveryWorker)\n+          .with(satisfying do |body|\n+            outgoing_json = Oj.load(body)\n+            outgoing_json['type'] == 'Reject' && %w(type id actor object instrument).all? { |key| json[key] == outgoing_json['object'][key] }\n+          end, recipient.id, sender.inbox_url)\n+      end\n+    end\n+  end\n+end\n---\n\n\n---\n\nChoice B:\napp/lib/admin/system_check/elasticsearch_check.rb\n@@ -38,6 +38,11 @@ def message\n         :elasticsearch_index_mismatch,\n         mismatched_indexes.join(' ')\n       )\n+    elsif !specifications_match?\n+      Admin::SystemCheck::Message.new(\n+        :elasticsearch_analysis_mismatch,\n+        mismatched_specifications_indexes.join(' ')\n+      )\n     elsif cluster_health['status'] == 'red'\n       Admin::SystemCheck::Message.new(:elasticsearch_health_red)\n     elsif cluster_health['number_of_nodes'] < 2 && es_preset != 'single_node_cluster'\n@@ -111,10 +116,20 @@ def mismatched_indexes\n     end\n   end\n \n+  def mismatched_specifications_indexes\n+    @mismatched_specifications_indexes ||= INDEXES.filter_map do |klass|\n+      klass.base_name if klass.specification.changed?\n+    end\n+  end\n+\n   def indexes_match?\n     mismatched_indexes.empty?\n   end\n \n+  def specifications_match?\n+    mismatched_specifications_indexes.empty?\n+  end\n+\n   def es_preset\n     ENV.fetch('ES_PRESET', 'single_node_cluster')\n   end\n---\nconfig/locales/en.yml\n@@ -903,6 +903,8 @@ en:\n     system_checks:\n       database_schema_check:\n         message_html: There are pending database migrations. Please run them to ensure the application behaves as expected\n+      elasticsearch_analysis_index_mismatch:\n+        message_html: Elasticsearch index analyzer settings are outdated. Please run <code>tootctl search deploy --only-mapping --only=%{value}</code>\n       elasticsearch_health_red:\n         message_html: Elasticsearch cluster is unhealthy (red status), search features are unavailable\n       elasticsearch_health_yellow:\n---\n\n\n---\n\nChoice C:\napp/models/concerns/user/omniauthable.rb\n@@ -99,7 +99,7 @@ def user_params_from_auth(email, auth)\n         external: true,\n         account_attributes: {\n           username: ensure_unique_username(ensure_valid_username(auth.uid)),\n-          display_name: auth.info.full_name || auth.info.name || [auth.info.first_name, auth.info.last_name].join(' '),\n+          display_name: display_name_from_auth(auth),\n         },\n       }\n     end\n@@ -121,5 +121,10 @@ def ensure_valid_username(starting_username)\n       temp_username = starting_username.gsub(/[^a-z0-9_]+/i, '')\n       temp_username.truncate(30, omission: '')\n     end\n+\n+    def display_name_from_auth(auth)\n+      display_name = auth.info.full_name || auth.info.name || [auth.info.first_name, auth.info.last_name].join(' ')\n+      display_name.truncate(Account::DISPLAY_NAME_LENGTH_LIMIT, omission: '')\n+    end\n   end\n end\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -9177,14 +9177,14 @@ __metadata:\n   linkType: hard\n \n \"pino-http@npm:^10.0.0\":\n-  version: 10.4.0\n-  resolution: \"pino-http@npm:10.4.0\"\n+  version: 10.5.0\n+  resolution: \"pino-http@npm:10.5.0\"\n   dependencies:\n     get-caller-file: \"npm:^2.0.5\"\n     pino: \"npm:^9.0.0\"\n     pino-std-serializers: \"npm:^7.0.0\"\n-    process-warning: \"npm:^4.0.0\"\n-  checksum: 10c0/64144e2c94e939070f56ad82dfb012b6a98d21582e0660cf821e7cee64d4e06f7724aa40bc5bf9cd1254d58ab7cbd972dec287b7989eba647d384f6edd8d95fd\n+    process-warning: \"npm:^5.0.0\"\n+  checksum: 10c0/17597d653a4088f7faed4d58500a5ef51d4d05247307696760006313c33c1d23177af98fb902e15b8e2cd92d81306c884673f841ba5b9bf0c064802f3c0bd775\n   languageName: node\n   linkType: hard\n \n@@ -9748,13 +9748,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"process-warning@npm:^4.0.0\":\n-  version: 4.0.0\n-  resolution: \"process-warning@npm:4.0.0\"\n-  checksum: 10c0/5312a72b69d37a1b82ad03f3dfa0090dab3804a8fd995d06c28e3c002852bd82f5584217d9f4a3f197892bb2afc22d57e2c662c7e906b5abb48c0380c7b0880d\n-  languageName: node\n-  linkType: hard\n-\n \"process-warning@npm:^5.0.0\":\n   version: 5.0.0\n   resolution: \"process-warning@npm:5.0.0\"\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nSee https://github.com/mastodon/mastodon/pull/34150#discussion_r2002651365\r\n\r\nThis sounds a bit silly because in English it's always the same, and the age requirement should be high enough for this to never matter for almost all languages, but \u201cYou're at least X\u201d technically requires plural forms in most languages.\r\n\r\nThe fact that the variable has to be called `count` also makes it particularly awkward, but I'm not sure what can be done about that.\n\n---\n\nChoice A:\nyarn.lock\n@@ -5448,13 +5448,13 @@ __metadata:\n   linkType: hard\n \n \"axios@npm:^1.4.0\":\n-  version: 1.8.4\n-  resolution: \"axios@npm:1.8.4\"\n+  version: 1.9.0\n+  resolution: \"axios@npm:1.9.0\"\n   dependencies:\n     follow-redirects: \"npm:^1.15.6\"\n     form-data: \"npm:^4.0.0\"\n     proxy-from-env: \"npm:^1.1.0\"\n-  checksum: 10c0/450993c2ba975ffccaf0d480b68839a3b2435a5469a71fa2fb0b8a55cdb2c2ae47e609360b9c1e2b2534b73dfd69e2733a1cf9f8215bee0bcd729b72f801b0ce\n+  checksum: 10c0/9371a56886c2e43e4ff5647b5c2c3c046ed0a3d13482ef1d0135b994a628c41fbad459796f101c655e62f0c161d03883454474d2e435b2e021b1924d9f24994c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\napp/views/auth/registrations/new.html.haml\n@@ -56,7 +56,7 @@\n     .fields-group\n       = f.input :date_of_birth,\n                 as: :date_of_birth,\n-                hint: t('simple_form.hints.user.date_of_birth', age: Setting.min_age.to_i),\n+                hint: t('simple_form.hints.user.date_of_birth', count: Setting.min_age.to_i),\n                 required: true,\n                 wrapper: :with_block_label\n \n---\nconfig/locales/simple_form.en.yml\n@@ -148,7 +148,9 @@ en:\n         min_age: Should not be below the minimum age required by the laws of your jurisdiction.\n       user:\n         chosen_languages: When checked, only posts in selected languages will be displayed in public timelines\n-        date_of_birth: We have to make sure you're at least %{age} to use Mastodon. We won't store this.\n+        date_of_birth:\n+          one: We have to make sure you're at least %{count} to use Mastodon. We won't store this.\n+          other: We have to make sure you're at least %{count} to use Mastodon. We won't store this.\n         role: The role controls which permissions the user has.\n       user_role:\n         color: Color to be used for the role throughout the UI, as RGB in hex format\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.15)\n+    rack (2.2.16)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n---\n\n\n---\n\nChoice D:\napp/lib/entity_cache.rb\n@@ -26,7 +26,9 @@ def emoji(shortcodes, domain)\n       uncached_ids << shortcode unless cached.key?(to_key(:emoji, shortcode, domain))\n     end\n \n-    unless uncached_ids.empty?\n+    if uncached_ids.empty?\n+      uncached = {}\n+    else\n       uncached = CustomEmoji.enabled.where(shortcode: shortcodes, domain: domain).index_by(&:shortcode)\n       uncached.each_value { |item| Rails.cache.write(to_key(:emoji, item.shortcode, domain), item, expires_in: MAX_EXPIRATION) }\n     end\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [mime-types](https://redirect.github.com/mime-types/ruby-mime-types) ([changelog](https://redirect.github.com/mime-types/ruby-mime-types/blob/main/CHANGELOG.md)) | `'~> 3.6.0'` -> `'~> 3.7.0'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/mime-types/3.7.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/mime-types/3.7.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/mime-types/3.6.2/3.7.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/mime-types/3.6.2/3.7.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>mime-types/ruby-mime-types (mime-types)</summary>\n\n### [`v3.7.0`](https://redirect.github.com/mime-types/ruby-mime-types/blob/HEAD/CHANGELOG.md#370--2025-05-07)\n\n[Compare Source](https://redirect.github.com/mime-types/ruby-mime-types/compare/v3.6.2...v3.7.0)\n\n-   Deprecated `MIME::Type#priority_compare`. In a future release, this will be\n    will be renamed to `MIME::Type#<=>`. This method is used in tight loops, so\n    there is no warning message for either `MIME::Type#priority_compare` or\n    `MIME::Type#<=>`.\n\n-   Improved the performance of sorting by eliminating the complex comparison flow\n    from `MIME::Type#priority_compare`. The old version shows under 600 i/s, and\n    the new version shows over 900 i/s. In sorting the full set of MIME data,\n    there are three differences between the old and new versions; after\n    comparison, these differences are considered acceptable.\n\n-   Simplified the default compare implementation (`MIME::Type#<=>`) to use the\n    new `MIME::Type#priority_compare` operation and simplify the fallback to\n    `String` comparison. This *may* result in exceptions where there had been\n    none, as explicit support for several special values (which should have caused\n    errors in any case) have been removed.\n\n-   When sorting the result of `MIME::Types#type_for`, provided a priority boost\n    if one of the target extensions is the type's preferred extension. This means\n    that for the case in \\[[#&#8203;148](https://redirect.github.com/mime-types/ruby-mime-types/issues/148)]\\[issue-148], when getting the type for `foo.webm`,\n    the type `video/webm` will be returned before the type `audio/webm`, because\n    `.webm` is the preferred extension for `video/webm` but not `audio/webm`\n    (which has a preferred extension of `.weba`). Added tests to ensure MIME types\n    are retrieved in a stable order (which is alphabetical).\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNjQuMCIsInVwZGF0ZWRJblZlciI6IjM5LjI2NC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -18945,8 +18945,8 @@ __metadata:\n   linkType: hard\n \n \"ws@npm:^8.11.0, ws@npm:^8.12.1, ws@npm:^8.18.0\":\n-  version: 8.18.1\n-  resolution: \"ws@npm:8.18.1\"\n+  version: 8.18.2\n+  resolution: \"ws@npm:8.18.2\"\n   peerDependencies:\n     bufferutil: ^4.0.1\n     utf-8-validate: \">=5.0.2\"\n@@ -18955,7 +18955,7 @@ __metadata:\n       optional: true\n     utf-8-validate:\n       optional: true\n-  checksum: 10c0/e498965d6938c63058c4310ffb6967f07d4fa06789d3364829028af380d299fe05762961742971c764973dce3d1f6a2633fe8b2d9410c9b52e534b4b882a99fa\n+  checksum: 10c0/4b50f67931b8c6943c893f59c524f0e4905bbd183016cfb0f2b8653aa7f28dad4e456b9d99d285bbb67cca4fedd9ce90dfdfaa82b898a11414ebd66ee99141e4\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -64,7 +64,7 @@ gem 'kaminari', '~> 1.2'\n gem 'link_header', '~> 0.0'\n gem 'linzer', '~> 0.6.1'\n gem 'mario-redis-lock', '~> 1.2', require: 'redis_lock'\n-gem 'mime-types', '~> 3.6.0', require: 'mime/types/columnar'\n+gem 'mime-types', '~> 3.7.0', require: 'mime/types/columnar'\n gem 'mutex_m'\n gem 'nokogiri', '~> 1.15'\n gem 'oj', '~> 3.14'\n---\nGemfile.lock\n@@ -423,10 +423,10 @@ GEM\n       redis (>= 3.0.5)\n     matrix (0.4.2)\n     memory_profiler (1.1.0)\n-    mime-types (3.6.2)\n+    mime-types (3.7.0)\n       logger\n-      mime-types-data (~> 3.2015)\n-    mime-types-data (3.2025.0408)\n+      mime-types-data (~> 3.2025, >= 3.2025.0507)\n+    mime-types-data (3.2025.0507)\n     mini_mime (1.1.5)\n     mini_portile2 (2.8.8)\n     minitest (5.25.5)\n@@ -996,7 +996,7 @@ DEPENDENCIES\n   mail (~> 2.8)\n   mario-redis-lock (~> 1.2)\n   memory_profiler\n-  mime-types (~> 3.6.0)\n+  mime-types (~> 3.7.0)\n   mutex_m\n   net-http (~> 0.6.0)\n   net-ldap (~> 0.18)\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -6678,9 +6678,9 @@ __metadata:\n   linkType: hard\n \n \"core-js@npm:^3.30.2\":\n-  version: 3.41.0\n-  resolution: \"core-js@npm:3.41.0\"\n-  checksum: 10c0/a29ed0b7fe81acf49d04ce5c17a1947166b1c15197327a5d12f95bbe84b46d60c3c13de701d808f41da06fa316285f3f55ce5903abc8d5642afc1eac4457afc8\n+  version: 3.42.0\n+  resolution: \"core-js@npm:3.42.0\"\n+  checksum: 10c0/2913d3d5452d54ad92f058d66046782d608c05e037bcc523aab79c04454fe640998f94e6011292969d66dfa472f398b085ce843dcb362056532a5799c627184e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/components/counters.tsx\n@@ -43,3 +43,17 @@ export const FollowersCounter = (\n     }}\n   />\n );\n+\n+export const FollowersYouKnowCounter = (\n+  displayNumber: React.ReactNode,\n+  pluralReady: number,\n+) => (\n+  <FormattedMessage\n+    id='account.followers_you_know_counter'\n+    defaultMessage='{counter} you know'\n+    values={{\n+      count: pluralReady,\n+      counter: <strong>{displayNumber}</strong>,\n+    }}\n+  />\n+);\n---\napp/javascript/mastodon/components/hover_card_account.tsx\n@@ -9,11 +9,16 @@ import { fetchAccount } from 'mastodon/actions/accounts';\n import { AccountBio } from 'mastodon/components/account_bio';\n import { AccountFields } from 'mastodon/components/account_fields';\n import { Avatar } from 'mastodon/components/avatar';\n-import { FollowersCounter } from 'mastodon/components/counters';\n+import { AvatarGroup } from 'mastodon/components/avatar_group';\n+import {\n+  FollowersCounter,\n+  FollowersYouKnowCounter,\n+} from 'mastodon/components/counters';\n import { DisplayName } from 'mastodon/components/display_name';\n import { FollowButton } from 'mastodon/components/follow_button';\n import { LoadingIndicator } from 'mastodon/components/loading_indicator';\n import { ShortNumber } from 'mastodon/components/short_number';\n+import { useFetchFamiliarFollowers } from 'mastodon/features/account_timeline/hooks/familiar_followers';\n import { domain } from 'mastodon/initial_state';\n import { useAppSelector, useAppDispatch } from 'mastodon/store';\n \n@@ -38,6 +43,8 @@ export const HoverCardAccount = forwardRef<\n     }\n   }, [dispatch, accountId, account]);\n \n+  const { familiarFollowers } = useFetchFamiliarFollowers({ accountId });\n+\n   return (\n     <div\n       ref={ref}\n@@ -73,11 +80,27 @@ export const HoverCardAccount = forwardRef<\n             )}\n           </div>\n \n-          <div className='hover-card__number'>\n+          <div className='hover-card__numbers'>\n             <ShortNumber\n               value={account.followers_count}\n               renderer={FollowersCounter}\n             />\n+            {familiarFollowers.length > 0 && (\n+              <>\n+                &middot;\n+                <div className='hover-card__familiar-followers'>\n+                  <ShortNumber\n+                    value={familiarFollowers.length}\n+                    renderer={FollowersYouKnowCounter}\n+                  />\n+                  <AvatarGroup compact>\n+                    {familiarFollowers.slice(0, 3).map((account) => (\n+                      <Avatar key={account.id} account={account} size={22} />\n+                    ))}\n+                  </AvatarGroup>\n+                </div>\n+              </>\n+            )}\n           </div>\n \n           <FollowButton accountId={accountId} />\n---\napp/javascript/mastodon/features/account_timeline/components/familiar_followers.tsx\n@@ -1,15 +1,12 @@\n-import { useEffect } from 'react';\n-\n import { FormattedMessage } from 'react-intl';\n \n import { Link } from 'react-router-dom';\n \n-import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n import { Avatar } from '@/mastodon/components/avatar';\n import { AvatarGroup } from '@/mastodon/components/avatar_group';\n import type { Account } from '@/mastodon/models/account';\n-import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n-import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n+\n+import { useFetchFamiliarFollowers } from '../hooks/familiar_followers';\n \n const AccountLink: React.FC<{ account?: Account }> = ({ account }) => {\n   if (!account) {\n@@ -64,20 +61,11 @@ const FamiliarFollowersReadout: React.FC<{ familiarFollowers: Account[] }> = ({\n export const FamiliarFollowers: React.FC<{ accountId: string }> = ({\n   accountId,\n }) => {\n-  const dispatch = useAppDispatch();\n-  const familiarFollowers = useAppSelector((state) =>\n-    getAccountFamiliarFollowers(state, accountId),\n-  );\n-\n-  const hasNoData = familiarFollowers === null;\n-\n-  useEffect(() => {\n-    if (hasNoData) {\n-      void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n-    }\n-  }, [dispatch, accountId, hasNoData]);\n+  const { familiarFollowers, isLoading } = useFetchFamiliarFollowers({\n+    accountId,\n+  });\n \n-  if (hasNoData || familiarFollowers.length === 0) {\n+  if (isLoading || familiarFollowers.length === 0) {\n     return null;\n   }\n \n---\napp/javascript/mastodon/features/account_timeline/hooks/familiar_followers.ts\n@@ -0,0 +1,30 @@\n+import { useEffect } from 'react';\n+\n+import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n+import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n+import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n+import { me } from 'mastodon/initial_state';\n+\n+export const useFetchFamiliarFollowers = ({\n+  accountId,\n+}: {\n+  accountId?: string;\n+}) => {\n+  const dispatch = useAppDispatch();\n+  const familiarFollowers = useAppSelector((state) =>\n+    accountId ? getAccountFamiliarFollowers(state, accountId) : null,\n+  );\n+\n+  const hasNoData = familiarFollowers === null;\n+\n+  useEffect(() => {\n+    if (hasNoData && accountId && accountId !== me) {\n+      void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n+    }\n+  }, [dispatch, accountId, hasNoData]);\n+\n+  return {\n+    familiarFollowers: hasNoData ? [] : familiarFollowers,\n+    isLoading: hasNoData,\n+  };\n+};\n---\napp/javascript/mastodon/locales/en.json\n@@ -42,6 +42,7 @@\n   \"account.followers\": \"Followers\",\n   \"account.followers.empty\": \"No one follows this user yet.\",\n   \"account.followers_counter\": \"{count, plural, one {{counter} follower} other {{counter} followers}}\",\n+  \"account.followers_you_know_counter\": \"{counter} you know\",\n   \"account.following\": \"Following\",\n   \"account.following_counter\": \"{count, plural, one {{counter} following} other {{counter} following}}\",\n   \"account.follows.empty\": \"This user doesn't follow anyone yet.\",\n---\napp/javascript/styles/mastodon/components.scss\n@@ -10705,7 +10705,15 @@ noscript {\n     color: inherit;\n   }\n \n-  &__number {\n+  &__numbers,\n+  &__familiar-followers {\n+    display: flex;\n+    align-items: center;\n+    flex-wrap: wrap;\n+    gap: 10px;\n+  }\n+\n+  &__numbers {\n     font-size: 15px;\n     line-height: 22px;\n     color: $secondary-text-color;\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nNew Crowdin translations, automated with GitHub Actions\n\nSee `.github/workflows/crowdin-download.yml`\n\nThis PR will be updated every day with new translations.\n\nDue to a limitation in GitHub Actions, checks are not running on this PR without manual action.\nIf you want to run the checks, then close and re-open it.\n\n---\n\nChoice A:\nGemfile.lock\n@@ -806,7 +806,7 @@ GEM\n       activerecord (>= 4.0.0)\n       railties (>= 4.0.0)\n     securerandom (0.4.1)\n-    selenium-webdriver (4.32.0)\n+    selenium-webdriver (4.33.0)\n       base64 (~> 0.2)\n       logger (~> 1.4)\n       rexml (~> 3.2, >= 3.2.5)\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/locales/cy.json\n@@ -29,6 +29,7 @@\n   \"account.enable_notifications\": \"Rhowch wybod i fi pan fydd @{name} yn postio\",\n   \"account.endorse\": \"Dangos ar fy mhroffil\",\n   \"account.featured\": \"Nodwedd\",\n+  \"account.featured.accounts\": \"Proffilau\",\n   \"account.featured.hashtags\": \"Hashnodau\",\n   \"account.featured.posts\": \"Postiadau\",\n   \"account.featured_tags.last_status_at\": \"Y postiad olaf ar {date}\",\n@@ -405,8 +406,10 @@\n   \"hashtag.counter_by_accounts\": \"{count, plural, one {{counter} cyfranogwr} other {{counter} cyfranogwr}}\",\n   \"hashtag.counter_by_uses\": \"{count, plural, one {postiad {counter}} other {postiad {counter}}}\",\n   \"hashtag.counter_by_uses_today\": \"{count, plural, one {{counter} postiad} other {{counter} postiad}} heddiw\",\n+  \"hashtag.feature\": \"Nodwedd ar y proffil\",\n   \"hashtag.follow\": \"Dilyn hashnod\",\n   \"hashtag.mute\": \"Tewi #{hashtag}\",\n+  \"hashtag.unfeature\": \"Peidio a'i gynnwys ar y proffil\",\n   \"hashtag.unfollow\": \"Dad-ddilyn hashnod\",\n   \"hashtags.and_other\": \"\u2026a {count, plural, other {# arall}}\",\n   \"hints.profiles.followers_may_be_missing\": \"Mae'n bosibl bod dilynwyr y proffil hwn ar goll.\",\n---\napp/javascript/mastodon/locales/ko.json\n@@ -58,7 +58,7 @@\n   \"account.mute_short\": \"\ubba4\ud2b8\",\n   \"account.muted\": \"\ubba4\ud2b8\ub428\",\n   \"account.muting\": \"\ubba4\ud2b8\ud568\",\n-  \"account.mutual\": \"\uc11c\ub85c \ud314\ub85c\uc6b0\",\n+  \"account.mutual\": \"\ub9de\ud314\ub85c\uc6b0 \uc911\uc785\ub2c8\ub2e4\",\n   \"account.no_bio\": \"\uc81c\uacf5\ub41c \uc124\uba85\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.\",\n   \"account.open_original_page\": \"\uc6d0\ubcf8 \ud398\uc774\uc9c0 \uc5f4\uae30\",\n   \"account.posts\": \"\uac8c\uc2dc\ubb3c\",\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/status.jsx\n@@ -403,14 +403,7 @@ class Status extends ImmutablePureComponent {\n     const connectReply = nextInReplyToId && nextInReplyToId === status.get('id');\n     const matchedFilters = status.get('matched_filters');\n \n-    if (featured) {\n-      prepend = (\n-        <div className='status__prepend'>\n-          <div className='status__prepend__icon'><Icon id='thumb-tack' icon={PushPinIcon} /></div>\n-          <FormattedMessage id='status.pinned' defaultMessage='Pinned post' />\n-        </div>\n-      );\n-    } else if (status.get('reblog', null) !== null && typeof status.get('reblog') === 'object') {\n+    if (status.get('reblog', null) !== null && typeof status.get('reblog') === 'object') {\n       const display_name_html = { __html: status.getIn(['account', 'display_name_html']) };\n \n       prepend = (\n---\napp/javascript/mastodon/locales/en.json\n@@ -168,7 +168,7 @@\n   \"column.lists\": \"Lists\",\n   \"column.mutes\": \"Muted users\",\n   \"column.notifications\": \"Notifications\",\n-  \"column.pins\": \"Pinned posts\",\n+  \"column.pins\": \"Featured posts\",\n   \"column.public\": \"Federated timeline\",\n   \"column_back_button.label\": \"Back\",\n   \"column_header.hide_settings\": \"Hide settings\",\n@@ -477,7 +477,7 @@\n   \"keyboard_shortcuts.my_profile\": \"Open your profile\",\n   \"keyboard_shortcuts.notifications\": \"Open notifications column\",\n   \"keyboard_shortcuts.open_media\": \"Open media\",\n-  \"keyboard_shortcuts.pinned\": \"Open pinned posts list\",\n+  \"keyboard_shortcuts.pinned\": \"Open featured posts list\",\n   \"keyboard_shortcuts.profile\": \"Open author's profile\",\n   \"keyboard_shortcuts.reply\": \"Reply to post\",\n   \"keyboard_shortcuts.requests\": \"Open follow requests list\",\n@@ -561,7 +561,7 @@\n   \"navigation_bar.mutes\": \"Muted users\",\n   \"navigation_bar.opened_in_classic_interface\": \"Posts, accounts, and other specific pages are opened by default in the classic web interface.\",\n   \"navigation_bar.personal\": \"Personal\",\n-  \"navigation_bar.pins\": \"Pinned posts\",\n+  \"navigation_bar.pins\": \"Featured posts\",\n   \"navigation_bar.preferences\": \"Preferences\",\n   \"navigation_bar.public_timeline\": \"Federated timeline\",\n   \"navigation_bar.search\": \"Search\",\n@@ -857,8 +857,7 @@\n   \"status.mute\": \"Mute @{name}\",\n   \"status.mute_conversation\": \"Mute conversation\",\n   \"status.open\": \"Expand this post\",\n-  \"status.pin\": \"Pin on profile\",\n-  \"status.pinned\": \"Pinned post\",\n+  \"status.pin\": \"Feature on profile\",\n   \"status.read_more\": \"Read more\",\n   \"status.reblog\": \"Boost\",\n   \"status.reblog_private\": \"Boost with original visibility\",\n@@ -883,7 +882,7 @@\n   \"status.translated_from_with\": \"Translated from {lang} using {provider}\",\n   \"status.uncached_media_warning\": \"Preview not available\",\n   \"status.unmute_conversation\": \"Unmute conversation\",\n-  \"status.unpin\": \"Unpin from profile\",\n+  \"status.unpin\": \"Don't feature on profile\",\n   \"subscribed_languages.lead\": \"Only posts in selected languages will appear on your home and list timelines after the change. Select none to receive posts in all languages.\",\n   \"subscribed_languages.save\": \"Save changes\",\n   \"subscribed_languages.target\": \"Change subscribed languages for {target}\",\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/components/avatar_group.tsx\n@@ -7,10 +7,16 @@ import classNames from 'classnames';\n \n export const AvatarGroup: React.FC<{\n   compact?: boolean;\n+  avatarHeight?: number;\n   children: React.ReactNode;\n-}> = ({ children, compact = false }) => (\n+}> = ({ children, compact = false, avatarHeight }) => (\n   <div\n     className={classNames('avatar-group', { 'avatar-group--compact': compact })}\n+    style={\n+      avatarHeight\n+        ? ({ '--avatar-height': `${avatarHeight}px` } as React.CSSProperties)\n+        : undefined\n+    }\n   >\n     {children}\n   </div>\n---\napp/javascript/mastodon/components/more_from_author.jsx\n@@ -1,17 +0,0 @@\n-import PropTypes from 'prop-types';\n-\n-import { FormattedMessage } from 'react-intl';\n-\n-import { IconLogo } from 'mastodon/components/logo';\n-import { AuthorLink } from 'mastodon/features/explore/components/author_link';\n-\n-export const MoreFromAuthor = ({ accountId }) => (\n-  <div className='more-from-author'>\n-    <IconLogo />\n-    <FormattedMessage id='link_preview.more_from_author' defaultMessage='More from {name}' values={{ name: <AuthorLink accountId={accountId} /> }} />\n-  </div>\n-);\n-\n-MoreFromAuthor.propTypes = {\n-  accountId: PropTypes.string.isRequired,\n-};\n---\napp/javascript/mastodon/components/more_from_author.tsx\n@@ -0,0 +1,21 @@\n+import { FormattedMessage } from 'react-intl';\n+\n+import { IconLogo } from 'mastodon/components/logo';\n+import { AuthorLink } from 'mastodon/features/explore/components/author_link';\n+\n+export const MoreFromAuthor: React.FC<{ accountId: string }> = ({\n+  accountId,\n+}) => (\n+  <FormattedMessage\n+    id='link_preview.more_from_author'\n+    defaultMessage='More from {name}'\n+    values={{ name: <AuthorLink accountId={accountId} /> }}\n+  >\n+    {(chunks) => (\n+      <div className='more-from-author'>\n+        <IconLogo />\n+        {chunks}\n+      </div>\n+    )}\n+  </FormattedMessage>\n+);\n---\napp/javascript/mastodon/features/notifications_v2/components/notification_group_with_status.tsx\n@@ -18,12 +18,14 @@ import { useAppSelector, useAppDispatch } from 'mastodon/store';\n import { DisplayedName } from './displayed_name';\n import { EmbeddedStatus } from './embedded_status';\n \n+const AVATAR_SIZE = 28;\n+\n export const AvatarById: React.FC<{ accountId: string }> = ({ accountId }) => {\n   const account = useAppSelector((state) => state.accounts.get(accountId));\n \n   if (!account) return null;\n \n-  return <Avatar withLink account={account} size={28} />;\n+  return <Avatar withLink account={account} size={AVATAR_SIZE} />;\n };\n \n export type LabelRenderer = (\n@@ -108,7 +110,7 @@ export const NotificationGroupWithStatus: React.FC<{\n         <div className='notification-group__main'>\n           <div className='notification-group__main__header'>\n             <div className='notification-group__main__header__wrapper'>\n-              <AvatarGroup>\n+              <AvatarGroup avatarHeight={AVATAR_SIZE}>\n                 {accountIds\n                   .slice(0, NOTIFICATIONS_GROUP_MAX_AVATARS)\n                   .map((id) => (\n@@ -123,7 +125,14 @@ export const NotificationGroupWithStatus: React.FC<{\n \n             <div className='notification-group__main__header__label'>\n               {label}\n-              {timestamp && <RelativeTimestamp timestamp={timestamp} />}\n+              {timestamp && (\n+                <>\n+                  <span className='notification-group__main__header__label-separator'>\n+                    &middot;\n+                  </span>\n+                  <RelativeTimestamp timestamp={timestamp} />\n+                </>\n+              )}\n             </div>\n           </div>\n \n---\napp/javascript/styles/mastodon/components.scss\n@@ -2249,14 +2249,18 @@ a .account__avatar {\n \n .avatar-group {\n   display: flex;\n-  gap: 8px;\n-  flex-wrap: wrap;\n+\n+  --avatar-height: 28px;\n+\n+  &:not(.avatar-group--compact) {\n+    gap: 8px;\n+    flex-wrap: wrap;\n+    height: var(--avatar-height);\n+    overflow-y: clip;\n+  }\n }\n \n .avatar-group--compact {\n-  gap: 0;\n-  flex-wrap: nowrap;\n-\n   & > :not(:first-child) {\n     margin-inline-start: -12px;\n   }\n@@ -10408,7 +10412,8 @@ noscript {\n   padding: 15px;\n   display: flex;\n   align-items: center;\n-  gap: 8px;\n+  flex-wrap: wrap;\n+  gap: 4px 8px;\n \n   .logo {\n     width: 16px;\n@@ -10502,12 +10507,6 @@ noscript {\n     overflow: hidden;\n     container-type: inline-size;\n \n-    @container (width < 350px) {\n-      &__header time {\n-        display: none;\n-      }\n-    }\n-\n     &__header {\n       display: flex;\n       flex-direction: column;\n@@ -10520,7 +10519,8 @@ noscript {\n \n       &__label {\n         display: flex;\n-        gap: 8px;\n+        flex-wrap: wrap;\n+        gap: 2px 8px;\n         font-size: 15px;\n         line-height: 22px;\n         color: $darker-text-color;\n@@ -10538,6 +10538,13 @@ noscript {\n         time {\n           color: $dark-text-color;\n         }\n+\n+        @container (width < 350px) {\n+          time,\n+          &-separator {\n+            display: none;\n+          }\n+        }\n       }\n     }\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rack](https://redirect.github.com/rack/rack) ([changelog](https://redirect.github.com/rack/rack/blob/main/CHANGELOG.md)) | `2.2.13` -> `2.2.14` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rack/2.2.14?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rack/2.2.14?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rack/2.2.13/2.2.14?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rack/2.2.13/2.2.14?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>rack/rack (rack)</summary>\n\n### [`v2.2.14`](https://redirect.github.com/rack/rack/blob/HEAD/CHANGELOG.md#2214---2025-05-06)\n\n[Compare Source](https://redirect.github.com/rack/rack/compare/v2.2.13...v2.2.14)\n\n##### Security\n\n-   [CVE-2025-46727](https://redirect.github.com/rack/rack/security/advisories/GHSA-gjh7-p2fx-99vx) Unbounded parameter parsing in `Rack::QueryParser` can lead to memory exhaustion.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNjQuMCIsInVwZGF0ZWRJblZlciI6IjM5LjI2NC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nconfig/initializers/chewy.rb\n@@ -5,8 +5,7 @@\n port            = ENV.fetch('ES_PORT') { 9200 }\n user            = ENV.fetch('ES_USER', nil).presence\n password        = ENV.fetch('ES_PASS', nil).presence\n-fallback_prefix = ENV.fetch('REDIS_NAMESPACE', nil).presence\n-prefix          = ENV.fetch('ES_PREFIX') { fallback_prefix }\n+prefix          = ENV.fetch('ES_PREFIX', nil)\n ca_file         = ENV.fetch('ES_CA_FILE', nil).presence\n \n transport_options = { ssl: { ca_file: ca_file } } if ca_file.present?\n---\nlib/mastodon/redis_configuration.rb\n@@ -9,18 +9,17 @@ class Mastodon::RedisConfiguration\n \n   def base\n     @base ||= setup_config(prefix: nil, defaults: DEFAULTS)\n-              .merge(namespace: base_namespace)\n+              .merge(namespace: nil)\n   end\n \n   def sidekiq\n     @sidekiq ||= setup_config(prefix: 'SIDEKIQ_')\n-                 .merge(namespace: sidekiq_namespace)\n   end\n \n   def cache\n     @cache ||= setup_config(prefix: 'CACHE_')\n                .merge({\n-                 namespace: cache_namespace,\n+                 namespace: 'cache',\n                  expires_in: 10.minutes,\n                  connect_timeout: 5,\n                  pool: {\n@@ -36,24 +35,6 @@ def driver\n     ENV['REDIS_DRIVER'] == 'ruby' ? :ruby : :hiredis\n   end\n \n-  def namespace\n-    @namespace ||= ENV.fetch('REDIS_NAMESPACE', nil)\n-  end\n-\n-  def base_namespace\n-    return \"mastodon_test#{ENV.fetch('TEST_ENV_NUMBER', nil)}\" if Rails.env.test?\n-\n-    namespace\n-  end\n-\n-  def sidekiq_namespace\n-    namespace\n-  end\n-\n-  def cache_namespace\n-    namespace ? \"#{namespace}_cache\" : 'cache'\n-  end\n-\n   def setup_config(prefix: nil, defaults: {})\n     prefix = \"#{prefix}REDIS_\"\n \n@@ -62,7 +43,7 @@ def setup_config(prefix: nil, defaults: {})\n     password = ENV.fetch(\"#{prefix}PASSWORD\", nil)\n     host     = ENV.fetch(\"#{prefix}HOST\", defaults[:host])\n     port     = ENV.fetch(\"#{prefix}PORT\", defaults[:port])\n-    db       = ENV.fetch(\"#{prefix}DB\", defaults[:db])\n+    db       = Rails.env.test? ? ENV.fetch('TEST_ENV_NUMBER', defaults[:db]).to_i + 1 : ENV.fetch(\"#{prefix}DB\", defaults[:db])\n \n     return { url:, driver: } if url\n \n---\nspec/lib/mastodon/redis_configuration_spec.rb\n@@ -26,20 +26,6 @@\n     end\n   end\n \n-  shared_examples 'setting a namespace' do\n-    context 'when setting the `REDIS_NAMESPACE` variable' do\n-      around do |example|\n-        ClimateControl.modify REDIS_NAMESPACE: 'testns' do\n-          example.run\n-        end\n-      end\n-\n-      it 'uses the value for the namespace' do\n-        expect(subject[:namespace]).to eq 'testns'\n-      end\n-    end\n-  end\n-\n   shared_examples 'secondary configuration' do |prefix|\n     context \"when no `#{prefix}_REDIS_` environment variables are present\" do\n       it 'uses the url from the base config' do\n@@ -208,7 +194,6 @@\n     end\n \n     it_behaves_like 'setting a different driver'\n-    it_behaves_like 'setting a namespace'\n     it_behaves_like 'sentinel support'\n   end\n \n@@ -217,7 +202,6 @@\n \n     it_behaves_like 'secondary configuration', 'SIDEKIQ'\n     it_behaves_like 'setting a different driver'\n-    it_behaves_like 'setting a namespace'\n     it_behaves_like 'sentinel support', 'SIDEKIQ'\n   end\n \n@@ -238,22 +222,8 @@\n       })\n     end\n \n-    context 'when `REDIS_NAMESPACE` is not set' do\n-      it 'uses the `cache` namespace' do\n-        expect(subject[:namespace]).to eq 'cache'\n-      end\n-    end\n-\n-    context 'when setting the `REDIS_NAMESPACE` variable' do\n-      around do |example|\n-        ClimateControl.modify REDIS_NAMESPACE: 'testns' do\n-          example.run\n-        end\n-      end\n-\n-      it 'attaches the `_cache` postfix to the namespace' do\n-        expect(subject[:namespace]).to eq 'testns_cache'\n-      end\n+    it 'uses the `cache` namespace' do\n+      expect(subject[:namespace]).to eq 'cache'\n     end\n \n     it_behaves_like 'secondary configuration', 'CACHE'\n---\nspec/support/streaming_server_manager.rb\n@@ -17,7 +17,7 @@ def start(port: 4020)\n     @running_thread = Thread.new do\n       Open3.popen2e(\n         {\n-          'REDIS_NAMESPACE' => REDIS_CONFIGURATION.base[:namespace],\n+          'REDIS_DB' => (ENV.fetch('TEST_ENV_NUMBER', 0).to_i + 1).to_s,\n           'DB_NAME' => \"#{ENV.fetch('DB_NAME', 'mastodon')}_test#{ENV.fetch('TEST_ENV_NUMBER', '')}\",\n           'RAILS_ENV' => ENV.fetch('RAILS_ENV', 'test'),\n           'NODE_ENV' => ENV.fetch('STREAMING_NODE_ENV', 'development'),\n---\nstreaming/redis.js\n@@ -4,7 +4,6 @@ import { parseIntFromEnvValue } from './utils.js';\n \n /**\n  * @typedef RedisConfiguration\n- * @property {string|undefined} namespace\n  * @property {string|undefined} url\n  * @property {import('ioredis').RedisOptions} options\n  */\n@@ -64,8 +63,6 @@ function getSentinelConfiguration(env, commonOptions) {\n  * @returns {RedisConfiguration} configuration for the Redis connection\n  */\n export function configFromEnv(env) {\n-  const redisNamespace = env.REDIS_NAMESPACE;\n-\n   // These options apply for both REDIS_URL based connections and connections\n   // using the other REDIS_* environment variables:\n   const commonOptions = {\n@@ -82,16 +79,14 @@ export function configFromEnv(env) {\n   if (typeof env.REDIS_URL === 'string' && env.REDIS_URL.length > 0) {\n     return {\n       url: env.REDIS_URL,\n-      options: commonOptions,\n-      namespace: redisNamespace\n+      options: commonOptions\n     };\n   }\n \n   // If we have configuration for Redis Sentinel mode, prefer that:\n   if (hasSentinelConfiguration(env)) {\n     return {\n-      options: getSentinelConfiguration(env, commonOptions),\n-      namespace: redisNamespace\n+      options: getSentinelConfiguration(env, commonOptions)\n     };\n   }\n \n@@ -110,8 +105,7 @@ export function configFromEnv(env) {\n   };\n \n   return {\n-    options,\n-    namespace: redisNamespace\n+    options\n   };\n }\n \n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -627,7 +627,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.13)\n+    rack (2.2.14)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -1,3 +1,5 @@\n+import { useMemo } from 'react';\n+\n import { FormattedMessage } from 'react-intl';\n \n import classNames from 'classnames';\n@@ -10,9 +12,11 @@ import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react'\n import { Icon } from 'mastodon/components/icon';\n import StatusContainer from 'mastodon/containers/status_container';\n import type { Status } from 'mastodon/models/status';\n+import type { RootState } from 'mastodon/store';\n import { useAppSelector } from 'mastodon/store';\n \n import QuoteIcon from '../../images/quote.svg?react';\n+import { makeGetStatus } from '../selectors';\n \n const MAX_QUOTE_POSTS_NESTING_LEVEL = 1;\n \n@@ -65,6 +69,10 @@ const QuoteLink: React.FC<{\n };\n \n type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n+type GetStatusSelector = (\n+  state: RootState,\n+  props: { id?: string | null; contextType?: string },\n+) => Status | null;\n \n export const QuotedStatus: React.FC<{\n   quote: QuoteMap;\n@@ -73,34 +81,50 @@ export const QuotedStatus: React.FC<{\n   nestingLevel?: number;\n }> = ({ quote, contextType, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n-  const state = quote.get('state');\n+  const quoteState = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n   let quoteError: React.ReactNode = null;\n \n-  if (state === 'deleted') {\n+  // In order to find out whether the quoted post should be completely hidden\n+  // due to a matching filter, we run it through the selector used by `status_container`.\n+  // If this returns null even though `status` exists, it's because it's filtered.\n+  const getStatus = useMemo(() => makeGetStatus(), []) as GetStatusSelector;\n+  const statusWithExtraData = useAppSelector((state) =>\n+    getStatus(state, { id: quotedStatusId, contextType }),\n+  );\n+  const isFilteredAndHidden = status && statusWithExtraData === null;\n+\n+  if (isFilteredAndHidden) {\n+    quoteError = (\n+      <FormattedMessage\n+        id='status.quote_error.filtered'\n+        defaultMessage='Hidden due to one of your filters'\n+      />\n+    );\n+  } else if (quoteState === 'deleted') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.removed'\n         defaultMessage='This post was removed by its author.'\n       />\n     );\n-  } else if (state === 'unauthorized') {\n+  } else if (quoteState === 'unauthorized') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.unauthorized'\n         defaultMessage='This post cannot be displayed as you are not authorized to view it.'\n       />\n     );\n-  } else if (state === 'pending') {\n+  } else if (quoteState === 'pending') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.pending_approval'\n         defaultMessage='This post is pending approval from the original author.'\n       />\n     );\n-  } else if (state === 'rejected' || state === 'revoked') {\n+  } else if (quoteState === 'rejected' || quoteState === 'revoked') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.rejected'\n---\napp/javascript/mastodon/locales/en.json\n@@ -864,6 +864,7 @@\n   \"status.mute_conversation\": \"Mute conversation\",\n   \"status.open\": \"Expand this post\",\n   \"status.pin\": \"Feature on profile\",\n+  \"status.quote_error.filtered\": \"Hidden due to one of your filters\",\n   \"status.quote_error.not_found\": \"This post cannot be displayed.\",\n   \"status.quote_error.pending_approval\": \"This post is pending approval from the original author.\",\n   \"status.quote_error.rejected\": \"This post cannot be displayed as the original author does not allow it to be quoted.\",\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -171,7 +171,7 @@ GEM\n     css_parser (1.21.1)\n       addressable\n     csv (3.3.4)\n-    database_cleaner-active_record (2.2.0)\n+    database_cleaner-active_record (2.2.1)\n       activerecord (>= 5.a)\n       database_cleaner-core (~> 2.0.0)\n     database_cleaner-core (2.0.1)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [@babel/preset-env](https://babel.dev/docs/en/next/babel-preset-env) ([source](https://redirect.github.com/babel/babel/tree/HEAD/packages/babel-preset-env)) | [`7.27.1` -> `7.27.2`](https://renovatebot.com/diffs/npm/@babel%2fpreset-env/7.27.1/7.27.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/@babel%2fpreset-env/7.27.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/@babel%2fpreset-env/7.27.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/@babel%2fpreset-env/7.27.1/7.27.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/@babel%2fpreset-env/7.27.1/7.27.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>babel/babel (@&#8203;babel/preset-env)</summary>\n\n### [`v7.27.2`](https://redirect.github.com/babel/babel/blob/HEAD/CHANGELOG.md#v7272-2025-05-06)\n\n[Compare Source](https://redirect.github.com/babel/babel/compare/v7.27.1...v7.27.2)\n\n##### :bug: Bug Fix\n\n-   `babel-parser`\n    -   [#&#8203;17289](https://redirect.github.com/babel/babel/pull/17289) fix: `@babel/parser/bin/index.js` contains `node:` protocol require ([@&#8203;liuxingbaoyu](https://redirect.github.com/liuxingbaoyu))\n    -   [#&#8203;17291](https://redirect.github.com/babel/babel/pull/17291) fix: Private class method not found when TS and estree ([@&#8203;liuxingbaoyu](https://redirect.github.com/liuxingbaoyu))\n-   `babel-plugin-transform-object-rest-spread`\n    -   [#&#8203;17281](https://redirect.github.com/babel/babel/pull/17281) Fix: improve object rest handling in array pattern ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n-   `babel-plugin-transform-modules-commonjs`, `babel-template`\n    -   [#&#8203;17284](https://redirect.github.com/babel/babel/pull/17284) fix(babel-template): Properly handle empty string replacements ([@&#8203;magic-akari](https://redirect.github.com/magic-akari))\n\n##### :running_woman: Performance\n\n-   `babel-cli`\n    -   [#&#8203;17285](https://redirect.github.com/babel/babel/pull/17285) Enable Node compile cache for `@babel/cli` ([@&#8203;JLHwung](https://redirect.github.com/JLHwung))\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNjQuMCIsInVwZGF0ZWRJblZlciI6IjM5LjI2NC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nlib/chewy/index_extensions.rb\n@@ -12,6 +12,13 @@ def index_preset(base_options = {})\n         base_options.merge(number_of_replicas: 1, number_of_shards: (base_options[:number_of_shards] || 1) * 2)\n       end\n     end\n+\n+    def update_specification\n+      client.indices.close index: index_name\n+      client.indices.put_settings index: index_name, body: { settings: { analysis: settings_hash[:settings][:analysis] } }\n+      client.indices.put_mapping index: index_name, body: root.mappings_hash\n+      client.indices.open index: index_name\n+    end\n   end\n end\n \n---\nlib/mastodon/cli/search.rb\n@@ -56,7 +56,7 @@ def deploy\n       if options[:only_mapping]\n         indices.select { |index| index.specification.changed? }.each do |index|\n           progress.title = \"Updating mapping for #{index} \"\n-          index.update_mapping\n+          index.update_specification\n           index.specification.lock!\n         end\n \n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -110,7 +110,7 @@ group :opentelemetry do\n   gem 'opentelemetry-instrumentation-active_model_serializers', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-concurrent_ruby', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-excon', '~> 0.23.0', require: false\n-  gem 'opentelemetry-instrumentation-faraday', '~> 0.26.0', require: false\n+  gem 'opentelemetry-instrumentation-faraday', '~> 0.27.0', require: false\n   gem 'opentelemetry-instrumentation-http', '~> 0.24.0', require: false\n   gem 'opentelemetry-instrumentation-http_client', '~> 0.23.0', require: false\n   gem 'opentelemetry-instrumentation-net_http', '~> 0.23.0', require: false\n---\nGemfile.lock\n@@ -544,7 +544,7 @@ GEM\n     opentelemetry-instrumentation-excon (0.23.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-faraday (0.26.0)\n+    opentelemetry-instrumentation-faraday (0.27.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n     opentelemetry-instrumentation-http (0.24.0)\n@@ -1026,7 +1026,7 @@ DEPENDENCIES\n   opentelemetry-instrumentation-active_model_serializers (~> 0.22.0)\n   opentelemetry-instrumentation-concurrent_ruby (~> 0.22.0)\n   opentelemetry-instrumentation-excon (~> 0.23.0)\n-  opentelemetry-instrumentation-faraday (~> 0.26.0)\n+  opentelemetry-instrumentation-faraday (~> 0.27.0)\n   opentelemetry-instrumentation-http (~> 0.24.0)\n   opentelemetry-instrumentation-http_client (~> 0.23.0)\n   opentelemetry-instrumentation-net_http (~> 0.23.0)\n---\n\n\n---\n\nChoice C:\napp/models/concerns/status/safe_reblog_insert.rb\n@@ -16,7 +16,7 @@ module Status::SafeReblogInsert\n     # The code is kept similar to ActiveRecord::Persistence code and calls it\n     # directly when we are not handling a reblog.\n     #\n-    # https://github.com/rails/rails/blob/v7.2.1.1/activerecord/lib/active_record/persistence.rb#L238-L263\n+    # https://github.com/rails/rails/blob/v8.0.2/activerecord/lib/active_record/persistence.rb#L238-L261\n     def _insert_record(connection, values, returning)\n       return super unless values.is_a?(Hash) && values['reblog_of_id']&.value.present?\n \n@@ -36,15 +36,13 @@ def _insert_record(connection, values, returning)\n       # Instead, we use a custom builder when a reblog is happening:\n       im = _compile_reblog_insert(values)\n \n-      with_connection do |_c|\n-        connection.insert(\n-          im, \"#{self} Create\", primary_key || false, primary_key_value,\n-          returning: returning\n-        ).tap do |result|\n-          # Since we are using SELECT instead of VALUES, a non-error `nil` return is possible.\n-          # For our purposes, it's equivalent to a foreign key constraint violation\n-          raise ActiveRecord::InvalidForeignKey, \"(reblog_of_id)=(#{values['reblog_of_id'].value}) is not present in table \\\"statuses\\\"\" if result.nil?\n-        end\n+      connection.insert(\n+        im, \"#{self} Create\", primary_key || false, primary_key_value,\n+        returning: returning\n+      ).tap do |result|\n+        # Since we are using SELECT instead of VALUES, a non-error `nil` return is possible.\n+        # For our purposes, it's equivalent to a foreign key constraint violation\n+        raise ActiveRecord::InvalidForeignKey, \"(reblog_of_id)=(#{values['reblog_of_id'].value}) is not present in table \\\"statuses\\\"\" if result.nil?\n       end\n     end\n \n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -66,10 +66,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/compat-data@npm:^7.22.6, @babel/compat-data@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/compat-data@npm:7.27.1\"\n-  checksum: 10c0/03e3a01b6772858dc5064f332ad4dc16fbbc0353f2180fd663a2651e8305058e35b6db57114e345d925def9b73cd7a322e95a45913428b8db705a098fd3dd289\n+\"@babel/compat-data@npm:^7.22.6, @babel/compat-data@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/compat-data@npm:7.27.2\"\n+  checksum: 10c0/077c9e01af3b90decee384a6a44dcf353898e980cee22ec7941f9074655dbbe97ec317345536cdc7ef7391521e1497930c522a3816af473076dd524be7fccd32\n   languageName: node\n   linkType: hard\n \n@@ -128,16 +128,16 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/helper-compilation-targets@npm:7.27.1\"\n+\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/helper-compilation-targets@npm:7.27.2\"\n   dependencies:\n-    \"@babel/compat-data\": \"npm:^7.27.1\"\n+    \"@babel/compat-data\": \"npm:^7.27.2\"\n     \"@babel/helper-validator-option\": \"npm:^7.27.1\"\n     browserslist: \"npm:^4.24.0\"\n     lru-cache: \"npm:^5.1.1\"\n     semver: \"npm:^6.3.1\"\n-  checksum: 10c0/1cfd3760a1bf1e367ea4a91214c041be7076197ba7a4f3c0710cab00fb5734eb010a2946efe6ecfb1ca9dc63e6c69644a1afa399db4082f374b9311e129f6f0b\n+  checksum: 10c0/f338fa00dcfea931804a7c55d1a1c81b6f0a09787e528ec580d5c21b3ecb3913f6cb0f361368973ce953b824d910d3ac3e8a8ee15192710d3563826447193ad1\n   languageName: node\n   linkType: hard\n \n@@ -934,16 +934,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-object-rest-spread@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/plugin-transform-object-rest-spread@npm:7.27.1\"\n+\"@babel/plugin-transform-object-rest-spread@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/plugin-transform-object-rest-spread@npm:7.27.2\"\n   dependencies:\n-    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.2\"\n     \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n+    \"@babel/plugin-transform-destructuring\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-parameters\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ac73caea178b51a64cc1c5e5ce1a67bacf89c1af664ef219aa1403d54258804113d6f267820c211768460e056f3aeb642c98ee14842c4fb548974c82f7dbe7dd\n+  checksum: 10c0/5e255b262dd65c8700078d9f6ed87bd45f951a905dda6b3414be28d7b2781b18e6b812e9d71421e61360c9cf51e1e619c1d48348593bb7399496f61f5f221446\n   languageName: node\n   linkType: hard\n \n@@ -1270,11 +1271,11 @@ __metadata:\n   linkType: hard\n \n \"@babel/preset-env@npm:^7.11.0, @babel/preset-env@npm:^7.12.1, @babel/preset-env@npm:^7.22.4\":\n-  version: 7.27.1\n-  resolution: \"@babel/preset-env@npm:7.27.1\"\n+  version: 7.27.2\n+  resolution: \"@babel/preset-env@npm:7.27.2\"\n   dependencies:\n-    \"@babel/compat-data\": \"npm:^7.27.1\"\n-    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/compat-data\": \"npm:^7.27.2\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.2\"\n     \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n     \"@babel/helper-validator-option\": \"npm:^7.27.1\"\n     \"@babel/plugin-bugfix-firefox-class-in-computed-class-key\": \"npm:^7.27.1\"\n@@ -1316,7 +1317,7 @@ __metadata:\n     \"@babel/plugin-transform-new-target\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-nullish-coalescing-operator\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-numeric-separator\": \"npm:^7.27.1\"\n-    \"@babel/plugin-transform-object-rest-spread\": \"npm:^7.27.1\"\n+    \"@babel/plugin-transform-object-rest-spread\": \"npm:^7.27.2\"\n     \"@babel/plugin-transform-object-super\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-optional-catch-binding\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-optional-chaining\": \"npm:^7.27.1\"\n@@ -1344,7 +1345,7 @@ __metadata:\n     semver: \"npm:^6.3.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/893b269f5e7e2084ee7fb60d3a1f154470c89169475170a8a595f1910cade9c9978b42df5405a46a699529dfdb1c6b0135cc4c0aa8f9e685ae230b1cb0172ad9\n+  checksum: 10c0/fd7ec310832a9ff26ed8d56bc0832cdbdb3a188e022050b74790796650649fb8373568af05b320b58b3ff922507979bad50ff95a4d504ab0081134480103504e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFollow-up to #34618\n\n---\n\nChoice A:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.15)\n+    rack (2.2.16)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -85,7 +85,7 @@ gem 'sanitize', '~> 7.0'\n gem 'scenic', '~> 1.7'\n gem 'sidekiq', '~> 6.5'\n gem 'sidekiq-bulk', '~> 0.2.0'\n-gem 'sidekiq-scheduler', '~> 5.0'\n+gem 'sidekiq-scheduler', '~> 6.0'\n gem 'sidekiq-unique-jobs', '~> 7.1'\n gem 'simple_form', '~> 5.2'\n gem 'simple-navigation', '~> 4.4'\n---\n\n\n---\n\nChoice C:\napp/lib/activitypub/parser/status_parser.rb\n@@ -95,11 +95,11 @@ def language\n   end\n \n   def favourites_count\n-    @object.dig('likes', 'totalItems') if @object.is_a?(Hash)\n+    @object['likes']['totalItems'] if @object.is_a?(Hash) && @object['likes'].is_a?(Hash)\n   end\n \n   def reblogs_count\n-    @object.dig('shares', 'totalItems') if @object.is_a?(Hash)\n+    @object['shares']['totalItems'] if @object.is_a?(Hash) && @object['shares'].is_a?(Hash)\n   end\n \n   def quote_policy\n---\nspec/lib/activitypub/parser/status_parser_spec.rb\n@@ -49,6 +49,24 @@\n     )\n   end\n \n+  context 'when the likes collection is not inlined' do\n+    let(:object_json) do\n+      {\n+        id: [ActivityPub::TagManager.instance.uri_for(sender), 'post1'].join('/'),\n+        type: 'Note',\n+        to: 'https://www.w3.org/ns/activitystreams#Public',\n+        content: 'bleh',\n+        published: 1.hour.ago.utc.iso8601,\n+        updated: 1.hour.ago.utc.iso8601,\n+        likes: 'https://example.com/collections/likes',\n+      }\n+    end\n+\n+    it 'does not raise an error' do\n+      expect { subject.favourites_count }.to_not raise_error\n+    end\n+  end\n+\n   describe '#quote_policy' do\n     subject do\n       described_class\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -110,7 +110,7 @@ group :opentelemetry do\n   gem 'opentelemetry-instrumentation-active_model_serializers', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-concurrent_ruby', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-excon', '~> 0.23.0', require: false\n-  gem 'opentelemetry-instrumentation-faraday', '~> 0.26.0', require: false\n+  gem 'opentelemetry-instrumentation-faraday', '~> 0.27.0', require: false\n   gem 'opentelemetry-instrumentation-http', '~> 0.24.0', require: false\n   gem 'opentelemetry-instrumentation-http_client', '~> 0.23.0', require: false\n   gem 'opentelemetry-instrumentation-net_http', '~> 0.23.0', require: false\n---\nGemfile.lock\n@@ -544,7 +544,7 @@ GEM\n     opentelemetry-instrumentation-excon (0.23.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-faraday (0.26.0)\n+    opentelemetry-instrumentation-faraday (0.27.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n     opentelemetry-instrumentation-http (0.24.0)\n@@ -1026,7 +1026,7 @@ DEPENDENCIES\n   opentelemetry-instrumentation-active_model_serializers (~> 0.22.0)\n   opentelemetry-instrumentation-concurrent_ruby (~> 0.22.0)\n   opentelemetry-instrumentation-excon (~> 0.23.0)\n-  opentelemetry-instrumentation-faraday (~> 0.26.0)\n+  opentelemetry-instrumentation-faraday (~> 0.27.0)\n   opentelemetry-instrumentation-http (~> 0.24.0)\n   opentelemetry-instrumentation-http_client (~> 0.23.0)\n   opentelemetry-instrumentation-net_http (~> 0.23.0)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nAlso fix tests to be more robust\n\n---\n\nChoice A:\napp/lib/activitypub/parser/status_parser.rb\n@@ -95,11 +95,11 @@ def language\n   end\n \n   def favourites_count\n-    @object.dig('likes', 'totalItems')\n+    @object.dig('likes', 'totalItems') if @object.is_a?(Hash)\n   end\n \n   def reblogs_count\n-    @object.dig('shares', 'totalItems')\n+    @object.dig('shares', 'totalItems') if @object.is_a?(Hash)\n   end\n \n   def quote_policy\n---\nspec/lib/activitypub/activity/create_spec.rb\n@@ -20,7 +20,7 @@\n       type: 'Create',\n       actor: ActivityPub::TagManager.instance.uri_for(sender),\n       object: object_json,\n-    }.with_indifferent_access\n+    }.deep_stringify_keys\n   end\n \n   before do\n@@ -102,7 +102,7 @@ def activity_for_object(json)\n         type: 'Create',\n         actor: ActivityPub::TagManager.instance.uri_for(sender),\n         object: json,\n-      }.with_indifferent_access\n+      }.deep_stringify_keys\n     end\n \n     before do\n@@ -1076,7 +1076,7 @@ def activity_for_object(json)\n           type: 'Create',\n           actor: ActivityPub::TagManager.instance.uri_for(sender),\n           object: Addressable::URI.new(scheme: 'bear', query_values: { t: token, u: object_json[:id] }).to_s,\n-        }.with_indifferent_access\n+        }.deep_stringify_keys\n       end\n \n       let(:object_json) do\n---\nspec/lib/activitypub/parser/status_parser_spec.rb\n@@ -16,7 +16,7 @@\n       type: 'Create',\n       actor: ActivityPub::TagManager.instance.uri_for(sender),\n       object: object_json,\n-    }.with_indifferent_access\n+    }.deep_stringify_keys\n   end\n \n   let(:object_json) do\n---\n\n\n---\n\nChoice B:\nDockerfile\n@@ -13,7 +13,7 @@ ARG BASE_REGISTRY=\"docker.io\"\n \n # Ruby image to use for base image, change with [--build-arg RUBY_VERSION=\"3.4.x\"]\n # renovate: datasource=docker depName=docker.io/ruby\n-ARG RUBY_VERSION=\"3.4.2\"\n+ARG RUBY_VERSION=\"3.4.3\"\n # # Node.js version to use in base image, change with [--build-arg NODE_MAJOR_VERSION=\"20\"]\n # renovate: datasource=node-version depName=node\n ARG NODE_MAJOR_VERSION=\"22\"\n---\n\n\n---\n\nChoice C:\n.github/ISSUE_TEMPLATE/1.web_bug_report.yml\n@@ -48,24 +48,24 @@ body:\n     attributes:\n       label: Mastodon version\n       description: |\n-        This is displayed at the bottom of the About page, eg. `v4.4.0-alpha.1`\n-      placeholder: v4.3.0\n+        This is displayed at the bottom of the About page, eg. `v4.4.0-beta.1`\n+      placeholder: v4.4.0-beta.1\n     validations:\n       required: true\n   - type: input\n     attributes:\n       label: Browser name and version\n       description: |\n         What browser are you using when getting this bug? Please specify the version as well.\n-      placeholder: Firefox 131.0.0\n+      placeholder: Firefox 139.0.0\n     validations:\n       required: true\n   - type: input\n     attributes:\n       label: Operating system\n       description: |\n         What OS are you running? Please specify the version as well.\n-      placeholder: macOS 15.0.1\n+      placeholder: macOS 15.5\n     validations:\n       required: true\n   - type: textarea\n---\n.github/ISSUE_TEMPLATE/2.server_bug_report.yml\n@@ -49,8 +49,8 @@ body:\n     attributes:\n       label: Mastodon version\n       description: |\n-        This is displayed at the bottom of the About page, eg. `v4.4.0-alpha.1`\n-      placeholder: v4.3.0\n+        This is displayed at the bottom of the About page, eg. `v4.4.0-beta.1`\n+      placeholder: v4.4.0-beta.1\n     validations:\n       required: false\n   - type: textarea\n@@ -60,7 +60,7 @@ body:\n         Any additional technical details you may have, like logs or error traces\n       value: |\n         If this is happening on your own Mastodon server, please fill out those:\n-        - Ruby version: (from `ruby --version`, eg. v3.4.1)\n-        - Node.js version: (from `node --version`, eg. v20.18.0)\n+        - Ruby version: (from `ruby --version`, eg. v3.4.4)\n+        - Node.js version: (from `node --version`, eg. v22.16.0)\n     validations:\n       required: false\n---\n.github/ISSUE_TEMPLATE/3.troubleshooting.yml\n@@ -50,7 +50,7 @@ body:\n       label: Mastodon version\n       description: |\n         This is displayed at the bottom of the About page, eg. `v4.4.0-alpha.1`\n-      placeholder: v4.3.0\n+      placeholder: v4.4.0-beta.1\n     validations:\n       required: false\n   - type: textarea\n@@ -60,9 +60,9 @@ body:\n         Details about your environment, like how Mastodon is deployed, if containers are used, version numbers, etc.\n       value: |\n         Please at least include those informations:\n-        - Operating system: (eg. Ubuntu 22.04)\n-        - Ruby version: (from `ruby --version`, eg. v3.4.1)\n-        - Node.js version: (from `node --version`, eg. v20.18.0)\n+        - Operating system: (eg. Ubuntu 24.04.2)\n+        - Ruby version: (from `ruby --version`, eg. v3.4.4)\n+        - Node.js version: (from `node --version`, eg. v22.16.0)\n     validations:\n       required: false\n   - type: textarea\n---\n\n\n---\n\nChoice D:\napp/models/user.rb\n@@ -73,7 +73,6 @@ class User < ApplicationRecord\n   ACTIVE_DURATION = ENV.fetch('USER_ACTIVE_DAYS', 7).to_i.days.freeze\n \n   devise :two_factor_authenticatable,\n-         otp_secret_encryption_key: Rails.configuration.x.otp_secret,\n          otp_secret_length: 32\n \n   devise :two_factor_backupable,\n---\nconfig/environments/development.rb\n@@ -84,9 +84,6 @@\n   # Otherwise, use letter_opener, which launches a browser window to view sent mail.\n   config.action_mailer.delivery_method = ENV['HEROKU'] || ENV['VAGRANT'] || ENV['REMOTE_DEV'] ? :letter_opener_web : :letter_opener\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = ENV.fetch('OTP_SECRET', '1fc2b87989afa6351912abeebe31ffc5c476ead9bf8b3d74cbc4a302c7b69a45b40b1bbef3506ddad73e942e15ed5ca4b402bf9a66423626051104f4b5f05109')\n-\n   # Raise error when a before_action's only/except options reference missing actions.\n   config.action_controller.raise_on_missing_callback_actions = true\n \n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nContinues: https://github.com/mastodon/mastodon/pull/32620\r\n\r\nIn #32620 i said\r\n\r\n> When combined with https://github.com/mastodon/mastodon/pull/32615 , this means that expanding a status to its detailed view will update the boost and favorite count for a status and all its replies.\r\n>\r\n> [...]\r\n> \r\n> If this looks acceptable, i will update https://github.com/mastodon/mastodon/pull/32615 to also fetch the root post in order to update its stats\r\n\r\nbut I never did that, so this PR does.\r\n\r\nThe motivation is the same - when someone expands a post, they are interested in seeing that post, so they should see the updated view of that post. Without this PR, the external interaction stats will only update for child posts or if a thread root post is edited, which is pretty odd. So in most cases showing the external stats won't actually work, since we would only receive them on the initial status creation.\r\n\r\nThe reason this PR is not just one line is that it seemed wasteful to fetch the status twice, once to update the status, and once to get its replies collection. This is somewhat necessary to do in all the child statuses since 1) we don't store the replies URI in the db, 2) don't have a good way of passing the prefetched body from the `FetchReplyWorker` to the `FetchAllRepliesService`, and 3) we can't just do a recursive job where we fetch the note body, process it, and then dispatch subsidiary jobs for its replies collection because we want to have the fetch limits at the top level.\r\n\r\nbut for the topmost status we have both in the same place, so we might as well use it. This required minor changes to accept both URIs and prefetched body. I tried to reuse the same methods so that we didn't have *totally* divergent functionality for the root status, but i can split it out and revert changes to the other methods if that would be preferable.\r\n\r\nThe reason for the `deep_symbolize_keys` -> `symbolize_keys` switch is the same as [here](https://github.com/mastodon/mastodon/pull/34597#discussion_r2072483486)\n\n---\n\nChoice A:\napp/javascript/mastodon/locales/en-GB.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Moderated servers\",\n   \"about.contact\": \"Contact:\",\n+  \"about.default_locale\": \"Default\",\n   \"about.disclaimer\": \"Mastodon is free, open-source software, and a trademark of Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Reason not available\",\n   \"about.domain_blocks.preamble\": \"Mastodon generally allows you to view content from and interact with users from any other server in the Fediverse. These are the exceptions that have been made on this particular server.\",\n   \"about.domain_blocks.silenced.explanation\": \"You will generally not see profiles and content from this server, unless you explicitly look it up or opt into it by following.\",\n   \"about.domain_blocks.silenced.title\": \"Limited\",\n   \"about.domain_blocks.suspended.explanation\": \"No data from this server will be processed, stored or exchanged, making any interaction or communication with users from this server impossible.\",\n   \"about.domain_blocks.suspended.title\": \"Suspended\",\n+  \"about.language_label\": \"Language\",\n   \"about.not_available\": \"This information has not been made available on this server.\",\n   \"about.powered_by\": \"Decentralised social media powered by {mastodon}\",\n   \"about.rules\": \"Server rules\",\n@@ -19,10 +21,12 @@\n   \"account.block_domain\": \"Block domain {domain}\",\n   \"account.block_short\": \"Block\",\n   \"account.blocked\": \"Blocked\",\n+  \"account.blocking\": \"Blocking\",\n   \"account.cancel_follow_request\": \"Cancel follow\",\n   \"account.copy\": \"Copy link to profile\",\n   \"account.direct\": \"Privately mention @{name}\",\n   \"account.disable_notifications\": \"Stop notifying me when @{name} posts\",\n+  \"account.domain_blocking\": \"Blocking domain\",\n   \"account.edit_profile\": \"Edit profile\",\n   \"account.enable_notifications\": \"Notify me when @{name} posts\",\n   \"account.endorse\": \"Feature on profile\",\n---\napp/javascript/mastodon/locales/pt-PT.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Servidores moderados\",\n   \"about.contact\": \"Contacto:\",\n+  \"about.default_locale\": \"Padr\u00e3o\",\n   \"about.disclaimer\": \"O Mastodon \u00e9 um software livre, de c\u00f3digo aberto e uma marca registada de Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Motivo n\u00e3o dispon\u00edvel\",\n   \"about.domain_blocks.preamble\": \"O Mastodon geralmente permite ver e interagir com o conte\u00fado de utilizadores de qualquer outra inst\u00e2ncia no fediverso. Estas s\u00e3o as exce\u00e7\u00f5es desta inst\u00e2ncia em espec\u00edfico.\",\n   \"about.domain_blocks.silenced.explanation\": \"Normalmente n\u00e3o ver\u00e1s perfis e conte\u00fados deste servidor, a n\u00e3o ser que os procures explicitamente ou optes por segui-los.\",\n   \"about.domain_blocks.silenced.title\": \"Limitados\",\n   \"about.domain_blocks.suspended.explanation\": \"Nenhum dado deste servidor ser\u00e1 processado, armazenado ou trocado, tornando imposs\u00edvel qualquer intera\u00e7\u00e3o ou comunica\u00e7\u00e3o com os utilizadores a partir deste servidor.\",\n   \"about.domain_blocks.suspended.title\": \"Suspensos\",\n+  \"about.language_label\": \"Idioma\",\n   \"about.not_available\": \"Esta informa\u00e7\u00e3o n\u00e3o foi disponibilizada neste servidor.\",\n   \"about.powered_by\": \"Rede social descentralizada baseada no {mastodon}\",\n   \"about.rules\": \"Regras do servidor\",\n@@ -308,6 +310,8 @@\n   \"emoji_button.search_results\": \"Resultados da pesquisa\",\n   \"emoji_button.symbols\": \"S\u00edmbolos\",\n   \"emoji_button.travel\": \"Viagens e lugares\",\n+  \"empty_column.account_featured.me\": \"Ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n+  \"empty_column.account_featured.other\": \"{acct} ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n   \"empty_column.account_featured_other.unknown\": \"Esta conta ainda n\u00e3o colocou nada em destaque.\",\n   \"empty_column.account_hides_collections\": \"Este utilizador escolheu n\u00e3o disponibilizar esta informa\u00e7\u00e3o\",\n   \"empty_column.account_suspended\": \"Conta suspensa\",\n@@ -341,6 +345,11 @@\n   \"explore.trending_links\": \"Not\u00edcias\",\n   \"explore.trending_statuses\": \"Publica\u00e7\u00f5es\",\n   \"explore.trending_tags\": \"#Etiquetas\",\n+  \"featured_carousel.header\": \"{count, plural, one {Publica\u00e7\u00e3o Afixada} other {Publica\u00e7\u00f5es Afixadas}}\",\n+  \"featured_carousel.next\": \"Seguinte\",\n+  \"featured_carousel.post\": \"Publica\u00e7\u00e3o\",\n+  \"featured_carousel.previous\": \"Anterior\",\n+  \"featured_carousel.slide\": \"{index} de {total}\",\n   \"filter_modal.added.context_mismatch_explanation\": \"Esta categoria de filtro n\u00e3o se aplica ao contexto em que acedeste a esta publica\u00e7\u00e3o. Se pretenderes que esta publica\u00e7\u00e3o seja filtrada tamb\u00e9m neste contexto, ter\u00e1s que editar o filtro.\",\n   \"filter_modal.added.context_mismatch_title\": \"O contexto n\u00e3o coincide!\",\n   \"filter_modal.added.expired_explanation\": \"Esta categoria de filtro expirou, tens de alterar a data de validade para que ele seja aplicado.\",\n---\n\n\n---\n\nChoice B:\napp/workers/activitypub/fetch_all_replies_worker.rb\n@@ -22,7 +22,7 @@ def perform(root_status_id, options = {})\n     @root_status.touch(:fetched_replies_at)\n     Rails.logger.debug { \"FetchAllRepliesWorker - #{@root_status.uri}: Fetching all replies for status: #{@root_status}\" }\n \n-    uris_to_fetch, n_pages = get_replies(@root_status.uri, MAX_PAGES, options)\n+    uris_to_fetch, n_pages = get_root_replies(@root_status.uri, options)\n     return if uris_to_fetch.nil?\n \n     fetched_uris = uris_to_fetch.clone.to_set\n@@ -49,20 +49,39 @@ def perform(root_status_id, options = {})\n \n   private\n \n-  def get_replies(status_uri, max_pages, options = {})\n-    replies_collection_or_uri = get_replies_uri(status_uri)\n+  # @param status [String, Hash]\n+  #   status URI, or the prefetched body of the Note object\n+  def get_replies(status, max_pages, options = {})\n+    replies_collection_or_uri = get_replies_uri(status)\n     return if replies_collection_or_uri.nil?\n \n-    ActivityPub::FetchAllRepliesService.new.call(status_uri, replies_collection_or_uri, max_pages: max_pages, **options.deep_symbolize_keys)\n+    ActivityPub::FetchAllRepliesService.new.call(value_or_id(status), replies_collection_or_uri, max_pages: max_pages, **options.deep_symbolize_keys)\n   end\n \n-  def get_replies_uri(parent_status_uri)\n-    fetch_resource(parent_status_uri, true)&.fetch('replies', nil)\n+  # Get the URI of the replies collection of a status\n+  #\n+  # @param parent_status [String, Hash]\n+  #   status URI, or the prefetched body of the Note object\n+  def get_replies_uri(parent_status)\n+    resource = parent_status.is_a?(Hash) ? parent_status : fetch_resource(parent_status, true)\n+    resource&.fetch('replies', nil)\n   rescue => e\n-    Rails.logger.info { \"FetchAllRepliesWorker - #{@root_status.uri}: Caught exception while resolving replies URI #{parent_status_uri}: #{e} - #{e.message}\" }\n+    Rails.logger.info { \"FetchAllRepliesWorker - #{@root_status.uri}: Caught exception while resolving replies URI #{parent_status}: #{e} - #{e.message}\" }\n     # Raise if we can't get the collection for top-level status to trigger retry\n-    raise e if parent_status_uri == @root_status.uri\n+    raise e if value_or_id(parent_status) == @root_status.uri\n \n     nil\n   end\n+\n+  # Get the root status, updating the status without fetching it twice\n+  #\n+  # @param root_status_uri [String]\n+  def get_root_replies(root_status_uri, options = {})\n+    root_status_body = fetch_resource(root_status_uri, true)\n+    raise RuntimeError(\"FetchAllRepliesWorker - #{@root_status.uri}: Root status could not be fetched\") if root_status_body.nil?\n+\n+    FetchReplyWorker.perform_async(root_status_uri, { **options, prefetched_body: root_status_body })\n+\n+    get_replies(root_status_body, MAX_PAGES, options)\n+  end\n end\n---\napp/workers/fetch_reply_worker.rb\n@@ -7,6 +7,6 @@ class FetchReplyWorker\n   sidekiq_options queue: 'pull', retry: 3\n \n   def perform(child_url, options = {})\n-    FetchRemoteStatusService.new.call(child_url, **options.deep_symbolize_keys)\n+    FetchRemoteStatusService.new.call(child_url, **options.symbolize_keys)\n   end\n end\n---\nspec/workers/activitypub/fetch_all_replies_worker_spec.rb\n@@ -125,6 +125,7 @@\n   before do\n     stub_const('Status::FetchRepliesConcern::FETCH_REPLIES_ENABLED', true)\n     allow(FetchReplyWorker).to receive(:push_bulk)\n+    allow(FetchReplyWorker).to receive(:perform_async)\n     all_items.each do |item|\n       next if [top_note_uri, reply_note_uri].include? item\n \n@@ -146,6 +147,12 @@\n       got_uris = subject.perform(status.id)\n       expect(got_uris).to match_array(top_items + top_items_paged)\n     end\n+\n+    it 'fetches the top status only once' do\n+      _ = subject.perform(status.id, { request_id: 0 })\n+      expect(FetchReplyWorker).to have_received(:perform_async).with(top_note_uri, { prefetched_body: top_object.deep_stringify_keys, request_id: 0 })\n+      expect(a_request(:get, top_note_uri)).to have_been_made.once\n+    end\n   end\n \n   describe 'perform' do\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -66,7 +66,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n+\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n   version: 7.26.10\n   resolution: \"@babel/core@npm:7.26.10\"\n   dependencies:\n@@ -211,10 +211,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.24.0, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5\":\n-  version: 7.26.5\n-  resolution: \"@babel/helper-plugin-utils@npm:7.26.5\"\n-  checksum: 10c0/cdaba71d4b891aa6a8dfbe5bac2f94effb13e5fa4c2c487667fdbaa04eae059b78b28d85a885071f45f7205aeb56d16759e1bed9c118b94b16e4720ef1ab0f65\n+\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5, @babel/helper-plugin-utils@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helper-plugin-utils@npm:7.27.1\"\n+  checksum: 10c0/94cf22c81a0c11a09b197b41ab488d416ff62254ce13c57e62912c85700dc2e99e555225787a4099ff6bae7a1812d622c80fbaeda824b79baa10a6c5ac4cf69b\n   languageName: node\n   linkType: hard\n \n@@ -869,25 +869,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-self@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-self@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea362ff94b535c753f560eb1f5e063dc72bbbca17ed58837a949a7b289d5eacc7b0a28296d1932c94429b168d6040cdee5484a59b9e3c021f169e0ee137e6a27\n+  checksum: 10c0/00a4f917b70a608f9aca2fb39aabe04a60aa33165a7e0105fd44b3a8531630eb85bf5572e9f242f51e6ad2fa38c2e7e780902176c863556c58b5ba6f6e164031\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-source@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-source@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea8e3263c0dc51fbc97c156cc647150a757cc56de10781287353d0ce9b2dcd6b6d93d573c0142d7daf5d6fb554c74fa1971ae60764924ea711161d8458739b63\n+  checksum: 10c0/5e67b56c39c4d03e59e03ba80692b24c5a921472079b63af711b1d250fc37c1733a17069b63537f750f3e937ec44a42b1ee6a46cd23b1a0df5163b17f741f7f2\n   languageName: node\n   linkType: hard\n \n@@ -4135,17 +4135,17 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.2.1\n-  resolution: \"@vitejs/plugin-react@npm:4.2.1\"\n+  version: 4.4.1\n+  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n   dependencies:\n-    \"@babel/core\": \"npm:^7.23.5\"\n-    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.23.3\"\n-    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.23.3\"\n+    \"@babel/core\": \"npm:^7.26.10\"\n+    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n+    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n-    react-refresh: \"npm:^0.14.0\"\n+    react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n-    vite: ^4.2.0 || ^5.0.0\n-  checksum: 10c0/de1eec44d703f32e5b58e776328ca20793657fe991835d15b290230b19a2a08be5d31501d424279ae13ecfed28044c117b69d746891c8d9b92c69e8a8907e989\n+    vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n+  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n   languageName: node\n   linkType: hard\n \n@@ -10069,10 +10069,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-refresh@npm:^0.14.0\":\n-  version: 0.14.0\n-  resolution: \"react-refresh@npm:0.14.0\"\n-  checksum: 10c0/b8ae07ad153357d77830928a7f1fc2df837aabefee907fa273ba04c7643f3b860e986f1d4b7ada9b721c8d79b8c24b5b911a314a1a2398b105f1b13d19ea2b8d\n+\"react-refresh@npm:^0.17.0\":\n+  version: 0.17.0\n+  resolution: \"react-refresh@npm:0.17.0\"\n+  checksum: 10c0/002cba940384c9930008c0bce26cac97a9d5682bc623112c2268ba0c155127d9c178a9a5cc2212d560088d60dfd503edd808669a25f9b377f316a32361d0b23c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\napp/models/web/push_subscription.rb\n@@ -12,13 +12,13 @@\n #  standard        :boolean          default(FALSE), not null\n #  created_at      :datetime         not null\n #  updated_at      :datetime         not null\n-#  access_token_id :bigint(8)\n-#  user_id         :bigint(8)\n+#  access_token_id :bigint(8)        not null\n+#  user_id         :bigint(8)        not null\n #\n \n class Web::PushSubscription < ApplicationRecord\n-  belongs_to :user, optional: true\n-  belongs_to :access_token, class_name: 'Doorkeeper::AccessToken', optional: true\n+  belongs_to :user\n+  belongs_to :access_token, class_name: 'Doorkeeper::AccessToken'\n \n   has_one :session_activation, foreign_key: 'web_push_subscription_id', inverse_of: :web_push_subscription, dependent: nil\n \n@@ -28,32 +28,16 @@ class Web::PushSubscription < ApplicationRecord\n \n   validates_with WebPushKeyValidator\n \n-  delegate :locale, to: :associated_user\n+  delegate :locale, to: :user\n \n   generates_token_for :unsubscribe, expires_in: Web::PushNotificationWorker::TTL\n \n   def pushable?(notification)\n     policy_allows_notification?(notification) && alert_enabled_for_notification_type?(notification)\n   end\n \n-  def associated_user\n-    return @associated_user if defined?(@associated_user)\n-\n-    @associated_user = if user_id.nil?\n-                         session_activation.user\n-                       else\n-                         user\n-                       end\n-  end\n-\n   def associated_access_token\n-    return @associated_access_token if defined?(@associated_access_token)\n-\n-    @associated_access_token = if access_token_id.nil?\n-                                 find_or_create_access_token.token\n-                               else\n-                                 access_token.token\n-                               end\n+    access_token.token\n   end\n \n   class << self\n@@ -65,16 +49,6 @@ def unsubscribe_for(application_id, resource_owner)\n \n   private\n \n-  def find_or_create_access_token\n-    Doorkeeper::AccessToken.find_or_create_for(\n-      application: Doorkeeper::Application.find_by(superapp: true),\n-      resource_owner: user_id || session_activation.user_id,\n-      scopes: Doorkeeper::OAuth::Scopes.from_string('read write follow push'),\n-      expires_in: Doorkeeper.configuration.access_token_expires_in,\n-      use_refresh_token: Doorkeeper.configuration.refresh_token_enabled?\n-    )\n-  end\n-\n   def alert_enabled_for_notification_type?(notification)\n     truthy?(data&.dig('alerts', notification.type.to_s))\n   end\n---\napp/serializers/web/notification_serializer.rb\n@@ -13,7 +13,7 @@ def access_token\n   end\n \n   def preferred_locale\n-    current_push_subscription.associated_user&.locale || I18n.default_locale\n+    current_push_subscription.user&.locale || I18n.default_locale\n   end\n \n   def notification_id\n---\ndb/migrate/20250422083912_add_not_null_to_web_push_subscription_user.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddNotNullToWebPushSubscriptionUser < ActiveRecord::Migration[8.0]\n+  def change\n+    add_check_constraint :web_push_subscriptions, 'user_id IS NOT NULL', name: 'web_push_subscriptions_user_id_null', validate: false\n+  end\n+end\n---\ndb/migrate/20250422084214_validate_add_not_null_to_web_push_subscription_user.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ValidateAddNotNullToWebPushSubscriptionUser < ActiveRecord::Migration[8.0]\n+  def up\n+    connection.execute(<<~SQL.squish)\n+      DELETE FROM web_push_subscriptions\n+      WHERE user_id IS NULL\n+    SQL\n+\n+    validate_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_user_id_null'\n+    change_column_null :web_push_subscriptions, :user_id, false\n+    remove_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_user_id_null'\n+  end\n+\n+  def down\n+    add_check_constraint :web_push_subscriptions, 'user_id IS NOT NULL', name: 'web_push_subscriptions_user_id_null', validate: false\n+    change_column_null :web_push_subscriptions, :user_id, true\n+  end\n+end\n---\ndb/migrate/20250422085027_add_not_null_to_web_push_subscription_access_token.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddNotNullToWebPushSubscriptionAccessToken < ActiveRecord::Migration[8.0]\n+  def change\n+    add_check_constraint :web_push_subscriptions, 'access_token_id IS NOT NULL', name: 'web_push_subscriptions_access_token_id_null', validate: false\n+  end\n+end\n---\ndb/migrate/20250422085303_validate_add_not_null_to_web_push_subscription_access_token.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ValidateAddNotNullToWebPushSubscriptionAccessToken < ActiveRecord::Migration[8.0]\n+  def up\n+    connection.execute(<<~SQL.squish)\n+      DELETE FROM web_push_subscriptions\n+      WHERE access_token_id IS NULL\n+    SQL\n+\n+    validate_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_access_token_id_null'\n+    change_column_null :web_push_subscriptions, :access_token_id, false\n+    remove_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_access_token_id_null'\n+  end\n+\n+  def down\n+    add_check_constraint :web_push_subscriptions, 'access_token_id IS NOT NULL', name: 'web_push_subscriptions_access_token_id_null', validate: false\n+    change_column_null :web_push_subscriptions, :access_token_id, true\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_11_095859) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_22_085303) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -1237,8 +1237,8 @@\n     t.json \"data\"\n     t.datetime \"created_at\", precision: nil, null: false\n     t.datetime \"updated_at\", precision: nil, null: false\n-    t.bigint \"access_token_id\"\n-    t.bigint \"user_id\"\n+    t.bigint \"access_token_id\", null: false\n+    t.bigint \"user_id\", null: false\n     t.boolean \"standard\", default: false, null: false\n     t.index [\"access_token_id\"], name: \"index_web_push_subscriptions_on_access_token_id\", where: \"(access_token_id IS NOT NULL)\"\n     t.index [\"user_id\"], name: \"index_web_push_subscriptions_on_user_id\"\n---\nspec/fabricators/web_push_subscription_fabricator.rb\n@@ -8,4 +8,6 @@\n     Base64.urlsafe_encode64(ecdh_key)\n   end\n   key_auth { Base64.urlsafe_encode64(Random.new.bytes(16)) }\n+  user { Fabricate(:user) }\n+  access_token { |attrs| Fabricate.build(:accessible_access_token, resource_owner_id: attrs[:user].id) }\n end\n---\nspec/requests/api/v1/push/subscriptions_spec.rb\n@@ -207,7 +207,8 @@ def create_subscription_with_token\n     Fabricate(\n       :web_push_subscription,\n       endpoint: create_payload[:subscription][:endpoint],\n-      access_token_id: token.id\n+      access_token: token,\n+      user: user\n     )\n   end\n end\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nI noticed this was outputting a warning in the console when running the JS tests\n\n---\n\nChoice A:\nGemfile.lock\n@@ -160,7 +160,7 @@ GEM\n     cocoon (1.2.15)\n     color_diff (0.1)\n     concurrent-ruby (1.3.5)\n-    connection_pool (2.5.1)\n+    connection_pool (2.5.2)\n     cose (1.3.1)\n       cbor (~> 0.5.9)\n       openssl-signature_algorithm (~> 1.0)\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -592,7 +592,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n     orm_adapter (0.5.0)\n     ostruct (0.6.1)\n-    ox (2.14.22)\n+    ox (2.14.23)\n       bigdecimal (>= 3.0)\n     parallel (1.27.0)\n     parser (3.3.8.0)\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/admin/ReportReasonSelector.jsx\n@@ -105,7 +105,7 @@ class ReportReasonSelector extends PureComponent {\n   };\n \n   componentDidMount() {\n-    api(false).get('/api/v1/instance').then(res => {\n+    api(false).get('/api/v2/instance').then(res => {\n       this.setState({\n         rules: res.data.rules,\n       });\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -74,7 +74,7 @@ gem 'premailer-rails'\n gem 'public_suffix', '~> 6.0'\n gem 'pundit', '~> 2.3'\n gem 'rack-attack', '~> 6.6'\n-gem 'rack-cors', '~> 2.0', require: 'rack/cors'\n+gem 'rack-cors', '~> 3.0', require: 'rack/cors'\n gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\n#31994 was supposed to try the \u201ccorrect\u201d (still draft) signature first, then try the bogus one. However, it tried the \u201ccorrect\u201d one twice, providing no value.\r\n\r\nSince this change has been live for several months (it's been backported to 4.1 and up on September 2024), it's probably fine to remove that behavior instead of simply fixing it.\n\n---\n\nChoice A:\nyarn.lock\n@@ -10845,8 +10845,8 @@ __metadata:\n   linkType: hard\n \n \"sass@npm:^1.62.1\":\n-  version: 1.89.0\n-  resolution: \"sass@npm:1.89.0\"\n+  version: 1.89.1\n+  resolution: \"sass@npm:1.89.1\"\n   dependencies:\n     \"@parcel/watcher\": \"npm:^2.4.1\"\n     chokidar: \"npm:^4.0.0\"\n@@ -10857,7 +10857,7 @@ __metadata:\n       optional: true\n   bin:\n     sass: sass.js\n-  checksum: 10c0/8e31b48c5e0abd9d437edb201919a82863f605ace1c1536ccdc6b3133937a70fe29b92ad536af632ecae2f140733931e4ec971e1bfbf8b835c54d392b28331df\n+  checksum: 10c0/4406c441f71f5e0ec056345e6091cef51fd1786dac6e5b3eb1e87df464c40b3278219cc51df98309c36794503787ab0fe88fd45f2b0464f22000b68e755883ee\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\napp/lib/http_signature_draft.rb\n@@ -6,14 +6,13 @@\n class HttpSignatureDraft\n   REQUEST_TARGET = '(request-target)'\n \n-  def initialize(keypair, key_id, full_path: true)\n+  def initialize(keypair, key_id)\n     @keypair = keypair\n     @key_id = key_id\n-    @full_path = full_path\n   end\n \n   def request_target(verb, url)\n-    if url.query.nil? || !@full_path\n+    if url.query.nil?\n       \"#{verb} #{url.path}\"\n     else\n       \"#{verb} #{url.path}?#{url.query}\"\n---\napp/lib/request.rb\n@@ -75,7 +75,6 @@ def initialize(verb, url, **options)\n     @url         = Addressable::URI.parse(url).normalize\n     @http_client = options.delete(:http_client)\n     @allow_local = options.delete(:allow_local)\n-    @full_path   = !options.delete(:omit_query_string)\n     @options     = {\n       follow: {\n         max_hops: 3,\n@@ -102,7 +101,7 @@ def on_behalf_of(actor, sign_with: nil)\n \n     key_id = ActivityPub::TagManager.instance.key_uri_for(actor)\n     keypair = sign_with.present? ? OpenSSL::PKey::RSA.new(sign_with) : actor.keypair\n-    @signing = HttpSignatureDraft.new(keypair, key_id, full_path: @full_path)\n+    @signing = HttpSignatureDraft.new(keypair, key_id)\n \n     self\n   end\n---\napp/services/activitypub/fetch_replies_service.rb\n@@ -57,20 +57,7 @@ def fetch_collection(collection_or_uri)\n     return unless @allow_synchronous_requests\n     return if non_matching_uri_hosts?(@reference_uri, collection_or_uri)\n \n-    # NOTE: For backward compatibility reasons, Mastodon signs outgoing\n-    # queries incorrectly by default.\n-    #\n-    # While this is relevant for all URLs with query strings, this is\n-    # the only code path where this happens in practice.\n-    #\n-    # Therefore, retry with correct signatures if this fails.\n-    begin\n-      fetch_resource_without_id_validation(collection_or_uri, nil, raise_on_error: :temporary)\n-    rescue Mastodon::UnexpectedResponseError => e\n-      raise unless e.response && e.response.code == 401 && Addressable::URI.parse(collection_or_uri).query.present?\n-\n-      fetch_resource_without_id_validation(collection_or_uri, nil, raise_on_error: :temporary, request_options: { omit_query_string: false })\n-    end\n+    fetch_resource_without_id_validation(collection_or_uri, nil, raise_on_error: :temporary)\n   end\n \n   def filter_replies(items)\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/video/components/hotkey_indicator.tsx\n@@ -24,7 +24,9 @@ export const HotkeyIndicator: React.FC<{\n     enter: [{ opacity: 1 }],\n     leave: [{ opacity: 0 }],\n     onRest: (_result, _ctrl, item) => {\n-      onDismiss(item);\n+      if (item) {\n+        onDismiss(item);\n+      }\n     },\n   });\n \n---\npackage.json\n@@ -44,7 +44,7 @@\n     \"@github/webauthn-json\": \"^2.1.1\",\n     \"@optimize-lodash/rollup-plugin\": \"^5.0.2\",\n     \"@rails/ujs\": \"7.1.501\",\n-    \"@react-spring/web\": \"^9.7.5\",\n+    \"@react-spring/web\": \"^10.0.0\",\n     \"@reduxjs/toolkit\": \"^2.0.1\",\n     \"@use-gesture/react\": \"^10.3.1\",\n     \"@vitejs/plugin-react\": \"^4.2.1\",\n---\nyarn.lock\n@@ -2451,7 +2451,7 @@ __metadata:\n     \"@github/webauthn-json\": \"npm:^2.1.1\"\n     \"@optimize-lodash/rollup-plugin\": \"npm:^5.0.2\"\n     \"@rails/ujs\": \"npm:7.1.501\"\n-    \"@react-spring/web\": \"npm:^9.7.5\"\n+    \"@react-spring/web\": \"npm:^10.0.0\"\n     \"@reduxjs/toolkit\": \"npm:^2.0.1\"\n     \"@testing-library/dom\": \"npm:^10.2.0\"\n     \"@testing-library/react\": \"npm:^16.0.0\"\n@@ -2877,69 +2877,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/animated@npm:9.7.5\"\n+\"@react-spring/animated@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/animated@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/f8c2473c60f39a878c7dd0fdfcfcdbc720521e1506aa3f63c9de64780694a0a73d5ccc535a5ccec3520ddb70a71cf43b038b32c18e99531522da5388c510ecd7\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/a8c40aff22def6dbe964b1f79fa4a7774c44bf5eb47c2ef969c8ecb2a426b4c972b147bf18635d6972dbec3fb95e70dd84f22b43c904c32dfc7a57ad144a0879\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/core@npm:9.7.5\"\n+\"@react-spring/core@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/core@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~9.7.5\"\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/animated\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/5bfd83dfe248cd91889f215f015d908c7714ef445740fd5afa054b27ebc7d5a456abf6c309e2459d9b5b436e78d6fda16b62b9601f96352e9130552c02270830\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/39036a153dbd973443e23d90cb8e7be83201b1f0e4105f8427ddb4c9e9e50e590e1b46282829e0bb6f3deebfab004e30dcb4eec0e34c5ebb234d5060c06ecae5\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/rafz@npm:9.7.5\"\n-  checksum: 10c0/8bdad180feaa9a0e870a513043a5e98a4e9b7292a9f887575b7e6fadab2677825bc894b7ff16c38511b35bfe6cc1072df5851c5fee64448d67551559578ca759\n+\"@react-spring/rafz@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/rafz@npm:10.0.0\"\n+  checksum: 10c0/8d92bc553172fa883ec2121b9cc62bfb43ff5d6c4e76363c8ce100fb6c3dd67c3dd629931786f9d1d63ac95a5d6996e4a08693cd56dda685bdbaf39b60e97f66\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/shared@npm:9.7.5\"\n+\"@react-spring/shared@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/shared@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/rafz\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/0207eacccdedd918a2fc55e78356ce937f445ce27ad9abd5d3accba8f9701a39349b55115641dc2b39bb9d3a155b058c185b411d292dc8cc5686bfa56f73b94f\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/833c3f42d35d22ac47a2f756ac47d85a81bc1decc5e7915f46013823344374378f883135754de94d5b43d8fff3c55fc4a359044c9a44f9095bd1ef1f11a20d4d\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/types@npm:9.7.5\"\n-  checksum: 10c0/85c05121853cacb64f7cf63a4855e9044635e1231f70371cd7b8c78bc10be6f4dd7c68f592f92a2607e8bb68051540989b4677a2ccb525dba937f5cd95dc8bc1\n+\"@react-spring/types@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/types@npm:10.0.0\"\n+  checksum: 10c0/ce1b959eaa8964f4004481d1e7c6eca0a8d636eb9f35ca654bdf77a78a860c0ff9eaa6bdc0cab84fc8a16be5c5fbb22b114249a2721bfc16191666670c0f44b3\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/web@npm:^9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/web@npm:9.7.5\"\n+\"@react-spring/web@npm:^10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/web@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~9.7.5\"\n-    \"@react-spring/core\": \"npm:~9.7.5\"\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/animated\": \"npm:~10.0.0\"\n+    \"@react-spring/core\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/bcd1e052e1b16341a12a19bf4515f153ca09d1fa86ff7752a5d02d7c4db58e8baf80e6283e64411f1e388c65340dce2254b013083426806b5dbae38bd151e53e\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/2218c87d9bfafab78b3079d94ea89ab9b95cb174910be5682fd8f5fc73e326ca956e9b844e5b255d1e3402138ad26981fae2fc1091d682a78359044a63b6421e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nCONTRIBUTING.md\n@@ -23,6 +23,11 @@ Bug reports and feature suggestions must use descriptive and concise titles and\n be submitted to [GitHub Issues]. Please use the search function to make sure\n there are not duplicate bug reports or feature requests.\n \n+## Security Issues\n+\n+If you believe you have identified a security issue in Mastodon or our own apps,\n+check [SECURITY].\n+\n ## Translations\n \n Translations are community contributed via [Crowdin]. They are periodically\n@@ -83,3 +88,4 @@ and API docs. Improvements are made via PRs to the [documentation repository].\n [GitHub Issues]: https://github.com/mastodon/mastodon/issues\n [keepachangelog]: https://keepachangelog.com/en/1.0.0/\n [Mastodon documentation]: https://docs.joinmastodon.org\n+[SECURITY]: SECURITY.md\n---\nREADME.md\n@@ -77,12 +77,12 @@ accepted into Mastodon, you can request to be paid through our [OpenCollective].\n \n ## License\n \n-Copyright (c) 2016-2024 Eugen Rochko (+ [`mastodon authors`](AUTHORS.md))\n+Copyright (c) 2016-2025 Eugen Rochko (+ [`mastodon authors`](AUTHORS.md))\n \n Licensed under GNU Affero General Public License as stated in the [LICENSE](LICENSE):\n \n ```\n-Copyright (c) 2016-2024 Eugen Rochko & other Mastodon contributors\n+Copyright (c) 2016-2025 Eugen Rochko & other Mastodon contributors\n \n This program is free software: you can redistribute it and/or modify it under\n the terms of the GNU Affero General Public License as published by the Free\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [babel-plugin-formatjs](https://redirect.github.com/formatjs/formatjs) | [`10.5.37` -> `10.5.38`](https://renovatebot.com/diffs/npm/babel-plugin-formatjs/10.5.37/10.5.38) | [![age](https://developer.mend.io/api/mc/badges/age/npm/babel-plugin-formatjs/10.5.38?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/babel-plugin-formatjs/10.5.38?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/babel-plugin-formatjs/10.5.37/10.5.38?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/babel-plugin-formatjs/10.5.37/10.5.38?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>formatjs/formatjs (babel-plugin-formatjs)</summary>\n\n### [`v10.5.38`](https://redirect.github.com/formatjs/formatjs/releases/tag/babel-plugin-formatjs%4010.5.38)\n\n[Compare Source](https://redirect.github.com/formatjs/formatjs/compare/babel-plugin-formatjs@10.5.37...babel-plugin-formatjs@10.5.38)\n\n**Note:** Version bump only for package babel-plugin-formatjs\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNjQuMCIsInVwZGF0ZWRJblZlciI6IjM5LjI2NC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\napp/javascript/images/logo-symbol-icon.svg\n@@ -1,2 +1,2 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"79\" height=\"79\" viewBox=\"0 0 79 75\"><symbol id=\"logo-symbol-icon\"><path d=\"M74.7135 16.6043C73.6199 8.54587 66.5351 2.19527 58.1366 0.964691C56.7196 0.756754 51.351 0 38.9148 0H38.822C26.3824 0 23.7135 0.756754 22.2966 0.964691C14.1319 2.16118 6.67571 7.86752 4.86669 16.0214C3.99657 20.0369 3.90371 24.4888 4.06535 28.5726C4.29578 34.4289 4.34049 40.275 4.877 46.1075C5.24791 49.9817 5.89495 53.8251 6.81328 57.6088C8.53288 64.5968 15.4938 70.4122 22.3138 72.7848C29.6155 75.259 37.468 75.6697 44.9919 73.971C45.8196 73.7801 46.6381 73.5586 47.4475 73.3063C49.2737 72.7302 51.4164 72.086 52.9915 70.9542C53.0131 70.9384 53.0308 70.9178 53.0433 70.8942C53.0558 70.8706 53.0628 70.8445 53.0637 70.8179V65.1661C53.0634 65.1412 53.0574 65.1167 53.0462 65.0944C53.035 65.0721 53.0189 65.0525 52.9992 65.0371C52.9794 65.0218 52.9564 65.011 52.9318 65.0056C52.9073 65.0002 52.8819 65.0003 52.8574 65.0059C48.0369 66.1472 43.0971 66.7193 38.141 66.7103C29.6118 66.7103 27.3178 62.6981 26.6609 61.0278C26.1329 59.5842 25.7976 58.0784 25.6636 56.5486C25.6622 56.5229 25.667 56.4973 25.6775 56.4738C25.688 56.4502 25.7039 56.4295 25.724 56.4132C25.7441 56.397 25.7678 56.3856 25.7931 56.3801C25.8185 56.3746 25.8448 56.3751 25.8699 56.3816C30.6101 57.5151 35.4693 58.0873 40.3455 58.086C41.5183 58.086 42.6876 58.086 43.8604 58.0553C48.7647 57.919 53.9339 57.6701 58.7591 56.7361C58.8794 56.7123 58.9998 56.6918 59.103 56.6611C66.7139 55.2124 73.9569 50.665 74.6929 39.1501C74.7204 38.6967 74.7892 34.4016 74.7892 33.9312C74.7926 32.3325 75.3085 22.5901 74.7135 16.6043ZM62.9996 45.3371H54.9966V25.9069C54.9966 21.8163 53.277 19.7302 49.7793 19.7302C45.9343 19.7302 44.0083 22.1981 44.0083 27.0727V37.7082H36.0534V27.0727C36.0534 22.1981 34.124 19.7302 30.279 19.7302C26.8019 19.7302 25.0651 21.8163 25.0617 25.9069V45.3371H17.0656V25.3172C17.0656 21.2266 18.1191 17.9769 20.2262 15.568C22.3998 13.1648 25.2509 11.9308 28.7898 11.9308C32.8859 11.9308 35.9812 13.492 38.0447 16.6111L40.036 19.9245L42.0308 16.6111C44.0943 13.492 47.1896 11.9308 51.2788 11.9308C54.8143 11.9308 57.6654 13.1648 59.8459 15.568C61.9529 17.9746 63.0065 21.2243 63.0065 25.3172L62.9996 45.3371Z\" fill=\"currentColor\"/></symbol><use xlink:href=\"#logo-symbol-icon\"/></svg>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"79\" height=\"79\" viewBox=\"0 0 79 75\"><symbol id=\"logo-symbol-icon\"><path d=\"M63 45.3v-20c0-4.1-1-7.3-3.2-9.7-2.1-2.4-5-3.7-8.5-3.7-4.1 0-7.2 1.6-9.3 4.7l-2 3.3-2-3.3c-2-3.1-5.1-4.7-9.2-4.7-3.5 0-6.4 1.3-8.6 3.7-2.1 2.4-3.1 5.6-3.1 9.7v20h8V25.9c0-4.1 1.7-6.2 5.2-6.2 3.8 0 5.8 2.5 5.8 7.4V37.7H44V27.1c0-4.9 1.9-7.4 5.8-7.4 3.5 0 5.2 2.1 5.2 6.2V45.3h8ZM74.7 16.6c.6 6 .1 15.7.1 17.3 0 .5-.1 4.8-.1 5.3-.7 11.5-8 16-15.6 17.5-.1 0-.2 0-.3 0-4.9 1-10 1.2-14.9 1.4-1.2 0-2.4 0-3.6 0-4.8 0-9.7-.6-14.4-1.7-.1 0-.1 0-.1 0s-.1 0-.1 0 0 .1 0 .1 0 0 0 0c.1 1.6.4 3.1 1 4.5.6 1.7 2.9 5.7 11.4 5.7 5 0 9.9-.6 14.8-1.7 0 0 0 0 0 0 .1 0 .1 0 .1 0 0 .1 0 .1 0 .1.1 0 .1 0 .1.1v5.6s0 .1-.1.1c0 0 0 0 0 .1-1.6 1.1-3.7 1.7-5.6 2.3-.8.3-1.6.5-2.4.7-7.5 1.7-15.4 1.3-22.7-1.2-6.8-2.4-13.8-8.2-15.5-15.2-.9-3.8-1.6-7.6-1.9-11.5-.6-5.8-.6-11.7-.8-17.5C3.9 24.5 4 20 4.9 16 6.7 7.9 14.1 2.2 22.3 1c1.4-.2 4.1-1 16.5-1h.1C51.4 0 56.7.8 58.1 1c8.4 1.2 15.5 7.5 16.6 15.6Z\" fill=\"currentColor\"/></symbol><use xlink:href=\"#logo-symbol-icon\"/></svg>\n \n---\napp/serializers/oembed_serializer.rb\n@@ -75,7 +75,7 @@ def html\n     <<~HTML.squish\n       <blockquote class=\"mastodon-embed\" data-embed-url=\"#{embed_short_account_status_url(object.account, object)}\" style=\"#{INLINE_STYLES[:blockquote]}\">\n         <a href=\"#{short_account_status_url(object.account, object)}\" target=\"_blank\" style=\"#{INLINE_STYLES[:status_link]}\">\n-          <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"32\" height=\"32\" viewBox=\"0 0 79 75\"><path d=\"M74.7135 16.6043C73.6199 8.54587 66.5351 2.19527 58.1366 0.964691C56.7196 0.756754 51.351 0 38.9148 0H38.822C26.3824 0 23.7135 0.756754 22.2966 0.964691C14.1319 2.16118 6.67571 7.86752 4.86669 16.0214C3.99657 20.0369 3.90371 24.4888 4.06535 28.5726C4.29578 34.4289 4.34049 40.275 4.877 46.1075C5.24791 49.9817 5.89495 53.8251 6.81328 57.6088C8.53288 64.5968 15.4938 70.4122 22.3138 72.7848C29.6155 75.259 37.468 75.6697 44.9919 73.971C45.8196 73.7801 46.6381 73.5586 47.4475 73.3063C49.2737 72.7302 51.4164 72.086 52.9915 70.9542C53.0131 70.9384 53.0308 70.9178 53.0433 70.8942C53.0558 70.8706 53.0628 70.8445 53.0637 70.8179V65.1661C53.0634 65.1412 53.0574 65.1167 53.0462 65.0944C53.035 65.0721 53.0189 65.0525 52.9992 65.0371C52.9794 65.0218 52.9564 65.011 52.9318 65.0056C52.9073 65.0002 52.8819 65.0003 52.8574 65.0059C48.0369 66.1472 43.0971 66.7193 38.141 66.7103C29.6118 66.7103 27.3178 62.6981 26.6609 61.0278C26.1329 59.5842 25.7976 58.0784 25.6636 56.5486C25.6622 56.5229 25.667 56.4973 25.6775 56.4738C25.688 56.4502 25.7039 56.4295 25.724 56.4132C25.7441 56.397 25.7678 56.3856 25.7931 56.3801C25.8185 56.3746 25.8448 56.3751 25.8699 56.3816C30.6101 57.5151 35.4693 58.0873 40.3455 58.086C41.5183 58.086 42.6876 58.086 43.8604 58.0553C48.7647 57.919 53.9339 57.6701 58.7591 56.7361C58.8794 56.7123 58.9998 56.6918 59.103 56.6611C66.7139 55.2124 73.9569 50.665 74.6929 39.1501C74.7204 38.6967 74.7892 34.4016 74.7892 33.9312C74.7926 32.3325 75.3085 22.5901 74.7135 16.6043ZM62.9996 45.3371H54.9966V25.9069C54.9966 21.8163 53.277 19.7302 49.7793 19.7302C45.9343 19.7302 44.0083 22.1981 44.0083 27.0727V37.7082H36.0534V27.0727C36.0534 22.1981 34.124 19.7302 30.279 19.7302C26.8019 19.7302 25.0651 21.8163 25.0617 25.9069V45.3371H17.0656V25.3172C17.0656 21.2266 18.1191 17.9769 20.2262 15.568C22.3998 13.1648 25.2509 11.9308 28.7898 11.9308C32.8859 11.9308 35.9812 13.492 38.0447 16.6111L40.036 19.9245L42.0308 16.6111C44.0943 13.492 47.1896 11.9308 51.2788 11.9308C54.8143 11.9308 57.6654 13.1648 59.8459 15.568C61.9529 17.9746 63.0065 21.2243 63.0065 25.3172L62.9996 45.3371Z\" fill=\"currentColor\"/></svg>\n+          <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"32\" height=\"32\" viewBox=\"0 0 79 75\"><path d=\"M63 45.3v-20c0-4.1-1-7.3-3.2-9.7-2.1-2.4-5-3.7-8.5-3.7-4.1 0-7.2 1.6-9.3 4.7l-2 3.3-2-3.3c-2-3.1-5.1-4.7-9.2-4.7-3.5 0-6.4 1.3-8.6 3.7-2.1 2.4-3.1 5.6-3.1 9.7v20h8V25.9c0-4.1 1.7-6.2 5.2-6.2 3.8 0 5.8 2.5 5.8 7.4V37.7H44V27.1c0-4.9 1.9-7.4 5.8-7.4 3.5 0 5.2 2.1 5.2 6.2V45.3h8ZM74.7 16.6c.6 6 .1 15.7.1 17.3 0 .5-.1 4.8-.1 5.3-.7 11.5-8 16-15.6 17.5-.1 0-.2 0-.3 0-4.9 1-10 1.2-14.9 1.4-1.2 0-2.4 0-3.6 0-4.8 0-9.7-.6-14.4-1.7-.1 0-.1 0-.1 0s-.1 0-.1 0 0 .1 0 .1 0 0 0 0c.1 1.6.4 3.1 1 4.5.6 1.7 2.9 5.7 11.4 5.7 5 0 9.9-.6 14.8-1.7 0 0 0 0 0 0 .1 0 .1 0 .1 0 0 .1 0 .1 0 .1.1 0 .1 0 .1.1v5.6s0 .1-.1.1c0 0 0 0 0 .1-1.6 1.1-3.7 1.7-5.6 2.3-.8.3-1.6.5-2.4.7-7.5 1.7-15.4 1.3-22.7-1.2-6.8-2.4-13.8-8.2-15.5-15.2-.9-3.8-1.6-7.6-1.9-11.5-.6-5.8-.6-11.7-.8-17.5C3.9 24.5 4 20 4.9 16 6.7 7.9 14.1 2.2 22.3 1c1.4-.2 4.1-1 16.5-1h.1C51.4 0 56.7.8 58.1 1c8.4 1.2 15.5 7.5 16.6 15.6Z\" fill=\"currentColor\"/></svg>\n           <div style=\"#{INLINE_STYLES[:div_account]}\">Post by @#{object.account.pretty_acct}@#{provider_name}</div>\n           <div style=\"#{INLINE_STYLES[:div_view]}\">View on Mastodon</div>\n         </a>\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -5487,8 +5487,8 @@ __metadata:\n   linkType: hard\n \n \"babel-plugin-formatjs@npm:^10.5.37\":\n-  version: 10.5.37\n-  resolution: \"babel-plugin-formatjs@npm:10.5.37\"\n+  version: 10.5.38\n+  resolution: \"babel-plugin-formatjs@npm:10.5.38\"\n   dependencies:\n     \"@babel/core\": \"npm:^7.26.10\"\n     \"@babel/helper-plugin-utils\": \"npm:^7.26.5\"\n@@ -5501,7 +5501,7 @@ __metadata:\n     \"@types/babel__helper-plugin-utils\": \"npm:^7.10.3\"\n     \"@types/babel__traverse\": \"npm:^7.20.6\"\n     tslib: \"npm:^2.8.0\"\n-  checksum: 10c0/e206ff1a8ad3cbcb3db2d2735d8821701df9d54c8aeb5e8b2861c945af91d4662b9cd37b1ff9d7e17954cdd31aec81788a3d044a1cd9f3e7e8e4f93177097b83\n+  checksum: 10c0/5aeb9839ee5be198b82c9ab6c85160e7edcc07f6184efe296560d229d1cc680d9c1e507bde47da74234d612a3e49c919b3e11c855b7fd4e6d256ec23f8b8b1e0\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\n.rubocop_todo.yml\n@@ -70,13 +70,6 @@ Style/OptionalBooleanParameter:\n     - 'app/workers/domain_block_worker.rb'\n     - 'app/workers/unfollow_follow_worker.rb'\n \n-# This cop supports unsafe autocorrection (--autocorrect-all).\n-# Configuration parameters: EnforcedStyle.\n-# SupportedStyles: short, verbose\n-Style/PreferredHashMethods:\n-  Exclude:\n-    - 'config/initializers/paperclip.rb'\n-\n # This cop supports safe autocorrection (--autocorrect).\n Style/RedundantConstantBase:\n   Exclude:\n---\nconfig/initializers/paperclip.rb\n@@ -42,7 +42,7 @@\n   s3_protocol = ENV.fetch('S3_PROTOCOL') { 'https' }\n   s3_hostname = ENV.fetch('S3_HOSTNAME') { \"s3-#{s3_region}.amazonaws.com\" }\n \n-  Paperclip::Attachment.default_options[:path] = ENV.fetch('S3_KEY_PREFIX') + \"/#{PATH}\" if ENV.has_key?('S3_KEY_PREFIX')\n+  Paperclip::Attachment.default_options[:path] = ENV.fetch('S3_KEY_PREFIX') + \"/#{PATH}\" if ENV.key?('S3_KEY_PREFIX')\n \n   Paperclip::Attachment.default_options.merge!(\n     storage: :s3,\n@@ -74,7 +74,7 @@\n \n   Paperclip::Attachment.default_options[:s3_permissions] = ->(*) {} if ENV['S3_PERMISSION'] == ''\n \n-  if ENV.has_key?('S3_ENDPOINT')\n+  if ENV.key?('S3_ENDPOINT')\n     Paperclip::Attachment.default_options[:s3_options].merge!(\n       endpoint: ENV['S3_ENDPOINT'],\n       force_path_style: ENV['S3_OVERRIDE_PATH_STYLE'] != 'true'\n@@ -83,14 +83,14 @@\n     Paperclip::Attachment.default_options[:url] = ':s3_path_url'\n   end\n \n-  if ENV.has_key?('S3_ALIAS_HOST') || ENV.has_key?('S3_CLOUDFRONT_HOST')\n+  if ENV.key?('S3_ALIAS_HOST') || ENV.key?('S3_CLOUDFRONT_HOST')\n     Paperclip::Attachment.default_options.merge!(\n       url: ':s3_alias_url',\n       s3_host_alias: ENV['S3_ALIAS_HOST'] || ENV['S3_CLOUDFRONT_HOST']\n     )\n   end\n \n-  Paperclip::Attachment.default_options[:s3_headers]['X-Amz-Storage-Class'] = ENV['S3_STORAGE_CLASS'] if ENV.has_key?('S3_STORAGE_CLASS')\n+  Paperclip::Attachment.default_options[:s3_headers]['X-Amz-Storage-Class'] = ENV['S3_STORAGE_CLASS'] if ENV.key?('S3_STORAGE_CLASS')\n \n   # Some S3-compatible providers might not actually be compatible with some APIs\n   # used by kt-paperclip, see https://github.com/mastodon/mastodon/issues/16822\n@@ -153,7 +153,7 @@ def copy_to_local_file(style, local_dest_path)\n       container: ENV['AZURE_CONTAINER_NAME'],\n     }\n   )\n-  if ENV.has_key?('AZURE_ALIAS_HOST')\n+  if ENV.key?('AZURE_ALIAS_HOST')\n     Paperclip::Attachment.default_options.merge!(\n       url: ':azure_alias_url',\n       azure_host_alias: ENV['AZURE_ALIAS_HOST']\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -495,6 +495,8 @@ GEM\n       opentelemetry-common (~> 0.20)\n       opentelemetry-sdk (~> 1.2)\n       opentelemetry-semantic_conventions\n+    opentelemetry-helpers-sql (0.1.1)\n+      opentelemetry-api (~> 1.0)\n     opentelemetry-helpers-sql-obfuscation (0.3.0)\n       opentelemetry-common (~> 0.21)\n     opentelemetry-instrumentation-action_mailer (0.4.0)\n@@ -548,8 +550,9 @@ GEM\n     opentelemetry-instrumentation-net_http (0.23.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-pg (0.30.0)\n+    opentelemetry-instrumentation-pg (0.30.1)\n       opentelemetry-api (~> 1.0)\n+      opentelemetry-helpers-sql\n       opentelemetry-helpers-sql-obfuscation\n       opentelemetry-instrumentation-base (~> 0.23.0)\n     opentelemetry-instrumentation-rack (0.26.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rubocop](https://rubocop.org/) ([source](https://redirect.github.com/rubocop/rubocop), [changelog](https://redirect.github.com/rubocop/rubocop/releases/tag/v1.75.5)) | `1.75.4` -> `1.75.5` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rubocop/1.75.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rubocop/1.75.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rubocop/1.75.4/1.75.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rubocop/1.75.4/1.75.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>rubocop/rubocop (rubocop)</summary>\n\n### [`v1.75.5`](https://redirect.github.com/rubocop/rubocop/blob/HEAD/CHANGELOG.md#1755-2025-05-05)\n\n[Compare Source](https://redirect.github.com/rubocop/rubocop/compare/v1.75.4...v1.75.5)\n\n##### Bug fixes\n\n-   [#&#8203;14148](https://redirect.github.com/rubocop/rubocop/pull/14148): Fix an infinite loop error for `Layout/SpaceAfterSemicolon` with `Layout/SpaceBeforeSemicolon` when a sequence of semicolons appears. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14145](https://redirect.github.com/rubocop/rubocop/pull/14145): Fix `Lint/ArrayLiteralInRegexp` cop error on empty interpolation. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14072](https://redirect.github.com/rubocop/rubocop/issues/14072): Fix autocorrect issue in `Layout/HashAlignment`. (\\[[@&#8203;jonas054](https://redirect.github.com/jonas054)]\\[])\n-   [#&#8203;14131](https://redirect.github.com/rubocop/rubocop/issues/14131): Fix false positives for `Style/ArgumentsForwarding` when using anonymous block argument forwarding to a method with a block. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14140](https://redirect.github.com/rubocop/rubocop/pull/14140): Fix `Layout/LeadingCommentSpace` to allow splitting long inline RBS comment signatures across multiple lines. (\\[[@&#8203;Morriar](https://redirect.github.com/Morriar)]\\[])\n-   [#&#8203;14147](https://redirect.github.com/rubocop/rubocop/pull/14147): Fix `Lint/LiteralAsCondition` cop error on `if` without body. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14151](https://redirect.github.com/rubocop/rubocop/pull/14151): Fix `Lint/Void` cop error on nested empty `begin`. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;13547](https://redirect.github.com/rubocop/rubocop/pull/13547): Fix `Style/IdenticalConditionalBranches` cop failure in case of `if` node with implicit `then`. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14146](https://redirect.github.com/rubocop/rubocop/pull/14146): Fix `Style/MethodCallWithArgsParentheses` cop error on complex numbers when `EnforcedStyle` is set to `omit_parentheses`. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14137](https://redirect.github.com/rubocop/rubocop/issues/14137): Fix `Style/TrailingCommaInArguments` cop error if `EnforcedStyleForMultiline` is set to `comma`. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n\n##### Changes\n\n-   [#&#8203;14144](https://redirect.github.com/rubocop/rubocop/pull/14144): `Layout/SpaceInsideArrayLiteralBrackets` make aware of array pattern matching. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14142](https://redirect.github.com/rubocop/rubocop/issues/14142): `Layout/SpaceInsideHashLiteralBraces` make aware of hash pattern matching. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNjQuMCIsInVwZGF0ZWRJblZlciI6IjM5LjI2NC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -1,3 +1,5 @@\n+import { useMemo } from 'react';\n+\n import { FormattedMessage } from 'react-intl';\n \n import classNames from 'classnames';\n@@ -10,9 +12,11 @@ import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react'\n import { Icon } from 'mastodon/components/icon';\n import StatusContainer from 'mastodon/containers/status_container';\n import type { Status } from 'mastodon/models/status';\n+import type { RootState } from 'mastodon/store';\n import { useAppSelector } from 'mastodon/store';\n \n import QuoteIcon from '../../images/quote.svg?react';\n+import { makeGetStatus } from '../selectors';\n \n const MAX_QUOTE_POSTS_NESTING_LEVEL = 1;\n \n@@ -65,6 +69,10 @@ const QuoteLink: React.FC<{\n };\n \n type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n+type GetStatusSelector = (\n+  state: RootState,\n+  props: { id?: string | null; contextType?: string },\n+) => Status | null;\n \n export const QuotedStatus: React.FC<{\n   quote: QuoteMap;\n@@ -73,34 +81,50 @@ export const QuotedStatus: React.FC<{\n   nestingLevel?: number;\n }> = ({ quote, contextType, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n-  const state = quote.get('state');\n+  const quoteState = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n   let quoteError: React.ReactNode = null;\n \n-  if (state === 'deleted') {\n+  // In order to find out whether the quoted post should be completely hidden\n+  // due to a matching filter, we run it through the selector used by `status_container`.\n+  // If this returns null even though `status` exists, it's because it's filtered.\n+  const getStatus = useMemo(() => makeGetStatus(), []) as GetStatusSelector;\n+  const statusWithExtraData = useAppSelector((state) =>\n+    getStatus(state, { id: quotedStatusId, contextType }),\n+  );\n+  const isFilteredAndHidden = status && statusWithExtraData === null;\n+\n+  if (isFilteredAndHidden) {\n+    quoteError = (\n+      <FormattedMessage\n+        id='status.quote_error.filtered'\n+        defaultMessage='Hidden due to one of your filters'\n+      />\n+    );\n+  } else if (quoteState === 'deleted') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.removed'\n         defaultMessage='This post was removed by its author.'\n       />\n     );\n-  } else if (state === 'unauthorized') {\n+  } else if (quoteState === 'unauthorized') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.unauthorized'\n         defaultMessage='This post cannot be displayed as you are not authorized to view it.'\n       />\n     );\n-  } else if (state === 'pending') {\n+  } else if (quoteState === 'pending') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.pending_approval'\n         defaultMessage='This post is pending approval from the original author.'\n       />\n     );\n-  } else if (state === 'rejected' || state === 'revoked') {\n+  } else if (quoteState === 'rejected' || quoteState === 'revoked') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.rejected'\n---\napp/javascript/mastodon/locales/en.json\n@@ -864,6 +864,7 @@\n   \"status.mute_conversation\": \"Mute conversation\",\n   \"status.open\": \"Expand this post\",\n   \"status.pin\": \"Feature on profile\",\n+  \"status.quote_error.filtered\": \"Hidden due to one of your filters\",\n   \"status.quote_error.not_found\": \"This post cannot be displayed.\",\n   \"status.quote_error.pending_approval\": \"This post is pending approval from the original author.\",\n   \"status.quote_error.rejected\": \"This post cannot be displayed as the original author does not allow it to be quoted.\",\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.4)\n+    rubocop (1.75.5)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\nChoice C:\n.rubocop_todo.yml\n@@ -41,7 +41,6 @@ Style/FetchEnvVar:\n     - 'config/initializers/cache_buster.rb'\n     - 'config/initializers/devise.rb'\n     - 'config/initializers/paperclip.rb'\n-    - 'config/initializers/vapid.rb'\n     - 'lib/tasks/repo.rake'\n \n # This cop supports safe autocorrection (--autocorrect).\n---\napp/lib/web_push_request.rb\n@@ -79,8 +79,8 @@ def payload_subject\n \n   def vapid_key\n     @vapid_key ||= Webpush::VapidKey.from_keys(\n-      Rails.configuration.x.vapid_public_key,\n-      Rails.configuration.x.vapid_private_key\n+      Rails.configuration.x.vapid.public_key,\n+      Rails.configuration.x.vapid.private_key\n     )\n   end\n \n---\napp/serializers/rest/application_serializer.rb\n@@ -18,6 +18,6 @@ def website\n   end\n \n   def vapid_key\n-    Rails.configuration.x.vapid_public_key\n+    Rails.configuration.x.vapid.public_key\n   end\n end\n---\napp/serializers/rest/instance_serializer.rb\n@@ -65,7 +65,7 @@ def configuration\n       },\n \n       vapid: {\n-        public_key: Rails.configuration.x.vapid_public_key,\n+        public_key: Rails.configuration.x.vapid.public_key,\n       },\n \n       accounts: {\n---\napp/serializers/rest/web_push_subscription_serializer.rb\n@@ -10,7 +10,7 @@ def alerts\n   end\n \n   def server_key\n-    Rails.configuration.x.vapid_public_key\n+    Rails.configuration.x.vapid.public_key\n   end\n \n   def policy\n---\napp/views/shared/_web_app.html.haml\n@@ -3,7 +3,7 @@\n   - if user_signed_in?\n     %meta{ name: 'initialPath', content: request.path }\n \n-  %meta{ name: 'applicationServerKey', content: Rails.configuration.x.vapid_public_key }\n+  %meta{ name: 'applicationServerKey', content: Rails.configuration.x.vapid.public_key }\n \n   = render_initial_state\n   = vite_typescript_tag 'application.ts', crossorigin: 'anonymous'\n---\nconfig/application.rb\n@@ -106,6 +106,7 @@ class Application < Rails::Application\n     config.x.captcha = config_for(:captcha)\n     config.x.mastodon = config_for(:mastodon)\n     config.x.translation = config_for(:translation)\n+    config.x.vapid = config_for(:vapid)\n \n     if ENV.fetch('QUERY_LOG_TAGS_ENABLED', 'false') == 'true'\n       config.active_record.query_log_tags_enabled = ENV.fetch('QUERY_LOG_TAGS_ENABLED', 'false') == 'true'\n---\nconfig/environments/development.rb\n@@ -40,10 +40,10 @@\n   # Override default file logging in favor of STDOUT logging in dev environment\n   config.logger = ActiveSupport::TaggedLogging.logger($stdout, formatter: config.log_formatter)\n \n-  # Generate random VAPID keys\n+  # Generate random VAPID keys when needed\n   Webpush.generate_key.tap do |vapid_key|\n-    config.x.vapid_private_key = vapid_key.private_key\n-    config.x.vapid_public_key = vapid_key.public_key\n+    config.x.vapid.private_key ||= vapid_key.private_key\n+    config.x.vapid.public_key ||= vapid_key.public_key\n   end\n \n   # Don't care if the mailer can't send.\n---\nconfig/environments/test.rb\n@@ -48,10 +48,11 @@\n   # Print deprecation notices to the stderr.\n   config.active_support.deprecation = :stderr\n \n-  # Generate random VAPID keys\n-  vapid_key = Webpush.generate_key\n-  config.x.vapid_private_key = vapid_key.private_key\n-  config.x.vapid_public_key = vapid_key.public_key\n+  # Generate random VAPID keys when needed\n+  Webpush.generate_key.tap do |vapid_key|\n+    config.x.vapid.private_key ||= vapid_key.private_key\n+    config.x.vapid.public_key ||= vapid_key.public_key\n+  end\n \n   # Raise exceptions when a reorder occurs in in_batches\n   config.active_record.error_on_ignored_order = true\n---\nconfig/initializers/vapid.rb\n@@ -1,16 +0,0 @@\n-# frozen_string_literal: true\n-\n-Rails.application.configure do\n-  # You can generate the keys using the following command (first is the private key, second is the public one)\n-  # You should only generate this once per instance. If you later decide to change it, all push subscription will\n-  # be invalidated, requiring the users to access the website again to resubscribe.\n-  #\n-  # Generate with `bundle exec rails mastodon:webpush:generate_vapid_key` task (`docker-compose run --rm web bundle exec rails mastodon:webpush:generate_vapid_key` if you use docker compose)\n-  #\n-  # For more information visit https://rossta.net/blog/using-the-web-push-api-with-vapid.html\n-\n-  if Rails.env.production?\n-    config.x.vapid_private_key = ENV['VAPID_PRIVATE_KEY']\n-    config.x.vapid_public_key = ENV['VAPID_PUBLIC_KEY']\n-  end\n-end\n---\nconfig/vapid.yml\n@@ -0,0 +1,17 @@\n+# You can generate the private and public keys using the following task. You\n+# should only generate this once per instance. If you later decide to change it,\n+# all push subscriptions will be invalidated, requiring users to access the\n+# website again to resubscribe.\n+#\n+# Generate on the CLI:\n+# `bundle exec rails mastodon:webpush:generate_vapid_key`\n+#\n+# Generate via Docker Compose:\n+# `docker-compose run --rm web bundle exec rails mastodon:webpush:generate_vapid_key`\n+#\n+# For more information visit\n+# https://rossta.net/blog/using-the-web-push-api-with-vapid.html\n+#\n+shared:\n+  private_key: <%= ENV.fetch('VAPID_PRIVATE_KEY', nil) %>\n+  public_key: <%= ENV.fetch('VAPID_PUBLIC_KEY', nil) %>\n---\nspec/requests/api/v1/apps/credentials_spec.rb\n@@ -29,7 +29,7 @@\n             redirect_uris: token.application.redirect_uris,\n             # Deprecated properties as of 4.3:\n             redirect_uri: token.application.redirect_uri.split.first,\n-            vapid_key: Rails.configuration.x.vapid_public_key\n+            vapid_key: Rails.configuration.x.vapid.public_key\n           )\n         )\n       end\n@@ -69,7 +69,7 @@\n             redirect_uris: token.application.redirect_uris,\n             # Deprecated properties as of 4.3:\n             redirect_uri: token.application.redirect_uri.split.first,\n-            vapid_key: Rails.configuration.x.vapid_public_key\n+            vapid_key: Rails.configuration.x.vapid.public_key\n           )\n         )\n       end\n---\nspec/requests/api/v1/apps_spec.rb\n@@ -49,7 +49,7 @@\n             redirect_uris: redirect_uris,\n             # Deprecated properties as of 4.3:\n             redirect_uri: redirect_uri,\n-            vapid_key: Rails.configuration.x.vapid_public_key\n+            vapid_key: Rails.configuration.x.vapid.public_key\n           )\n         )\n       end\n---\nspec/serializers/rest/instance_serializer_spec.rb\n@@ -15,7 +15,7 @@\n   describe 'configuration' do\n     it 'returns the VAPID public key' do\n       expect(serialization['configuration']['vapid']).to eq({\n-        'public_key' => Rails.configuration.x.vapid_public_key,\n+        'public_key' => Rails.configuration.x.vapid.public_key,\n       })\n     end\n \n---\nspec/workers/web/push_notification_worker_spec.rb\n@@ -38,13 +38,13 @@\n \n   describe 'perform' do\n     around do |example|\n-      original_private = Rails.configuration.x.vapid_private_key\n-      original_public = Rails.configuration.x.vapid_public_key\n-      Rails.configuration.x.vapid_private_key = vapid_private_key\n-      Rails.configuration.x.vapid_public_key = vapid_public_key\n+      original_private = Rails.configuration.x.vapid.private_key\n+      original_public = Rails.configuration.x.vapid.public_key\n+      Rails.configuration.x.vapid.private_key = vapid_private_key\n+      Rails.configuration.x.vapid.public_key = vapid_public_key\n       example.run\n-      Rails.configuration.x.vapid_private_key = original_private\n-      Rails.configuration.x.vapid_public_key = original_public\n+      Rails.configuration.x.vapid.private_key = original_private\n+      Rails.configuration.x.vapid.public_key = original_public\n     end\n \n     before do\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -620,7 +620,7 @@ GEM\n     psych (5.2.3)\n       date\n       stringio\n-    public_suffix (6.0.1)\n+    public_suffix (6.0.2)\n     puma (6.6.0)\n       nio4r (~> 2.0)\n     pundit (2.5.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [selenium-webdriver](https://selenium.dev) ([source](https://redirect.github.com/SeleniumHQ/selenium/tree/HEAD/rb), [changelog](https://redirect.github.com/SeleniumHQ/selenium/blob/trunk/rb/CHANGES)) | `4.31.0` -> `4.32.0` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/selenium-webdriver/4.32.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/selenium-webdriver/4.32.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/selenium-webdriver/4.31.0/4.32.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/selenium-webdriver/4.31.0/4.32.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>SeleniumHQ/selenium (selenium-webdriver)</summary>\n\n### [`v4.32.0`](https://redirect.github.com/SeleniumHQ/selenium/blob/HEAD/rb/CHANGES#4320-2025-05-02)\n\n[Compare Source](https://redirect.github.com/SeleniumHQ/selenium/compare/1ef9f187874f0943976808267310b2b75f342a80...d17c8aa95092dc25ae64f12e7abdc844cf3503f0)\n\n\\=========================\n\n-   Add CDP for Chrome 136 and remove 133\n-   log at info level with names and values when Guards#add_condition used\n-   Add PrintOptions Implementation for Ruby WebDriver ([#&#8203;15158](https://redirect.github.com/SeleniumHQ/selenium/issues/15158))\n-   \\[ruby] fix lint for print_options.rb ([#&#8203;15608](https://redirect.github.com/SeleniumHQ/selenium/issues/15608))\n-   add enable_downloads to attr_accessor for all options classes\n-   make logging of test guards debug level not info\n-   Set remote active protocol in Firefox to BiDi only\n-   handle issue with selenium manager exit status being nil ([#&#8203;15676](https://redirect.github.com/SeleniumHQ/selenium/issues/15676))\n-   Add websocket-port parameter to firefox service ([#&#8203;15458](https://redirect.github.com/SeleniumHQ/selenium/issues/15458))\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNjQuMCIsInVwZGF0ZWRJblZlciI6IjM5LjI2NC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nCONTRIBUTING.md\n@@ -23,6 +23,11 @@ Bug reports and feature suggestions must use descriptive and concise titles and\n be submitted to [GitHub Issues]. Please use the search function to make sure\n there are not duplicate bug reports or feature requests.\n \n+## Security Issues\n+\n+If you believe you have identified a security issue in Mastodon or our own apps,\n+check [SECURITY].\n+\n ## Translations\n \n Translations are community contributed via [Crowdin]. They are periodically\n@@ -83,3 +88,4 @@ and API docs. Improvements are made via PRs to the [documentation repository].\n [GitHub Issues]: https://github.com/mastodon/mastodon/issues\n [keepachangelog]: https://keepachangelog.com/en/1.0.0/\n [Mastodon documentation]: https://docs.joinmastodon.org\n+[SECURITY]: SECURITY.md\n---\nREADME.md\n@@ -77,12 +77,12 @@ accepted into Mastodon, you can request to be paid through our [OpenCollective].\n \n ## License\n \n-Copyright (c) 2016-2024 Eugen Rochko (+ [`mastodon authors`](AUTHORS.md))\n+Copyright (c) 2016-2025 Eugen Rochko (+ [`mastodon authors`](AUTHORS.md))\n \n Licensed under GNU Affero General Public License as stated in the [LICENSE](LICENSE):\n \n ```\n-Copyright (c) 2016-2024 Eugen Rochko & other Mastodon contributors\n+Copyright (c) 2016-2025 Eugen Rochko & other Mastodon contributors\n \n This program is free software: you can redistribute it and/or modify it under\n the terms of the GNU Affero General Public License as published by the Free\n---\n\n\n---\n\nChoice B:\napp/views/layouts/application.html.haml\n@@ -31,7 +31,7 @@\n     -# Needed for the wicg-inert polyfill. It needs to be on it's own <style> tag, with this `id`\n     = vite_stylesheet_tag 'styles/inert.scss', media: 'all', id: 'inert-style'\n \n-    -# = vite_preload_tag \"mastodon/locales/#{I18n.locale}.json\", :crossorigin => 'anonymous'\n+    = vite_preload_file_tag \"mastodon/locales/#{I18n.locale}.json\"\n     = csrf_meta_tags unless skip_csrf_meta_tags?\n     %meta{ name: 'style-nonce', content: request.content_security_policy_nonce }\n \n---\napp/views/layouts/embedded.html.haml\n@@ -14,7 +14,7 @@\n     = vite_client_tag\n     = vite_react_refresh_tag\n     = theme_style_tags 'mastodon-light'\n-    -# = vite_preload_tag \"mastodon/locales/#{I18n.locale}.json\", :crossorigin => 'anonymous'\n+    = vite_preload_file_tag \"mastodon/locales/#{I18n.locale}.json\"\n     = render_initial_state\n     = vite_typescript_tag 'embed.tsx', integrity: true, crossorigin: 'anonymous'\n   %body.embed\n---\nlib/vite_ruby/sri_extensions.rb\n@@ -35,6 +35,16 @@ def resolve_entries_with_integrity(*names, **options)\n       stylesheets: dev_server_running? ? [] : (entries + imports).flat_map { |entry| entry['css'] }.compact.uniq,\n     }\n   end\n+\n+  # We need to override this method to not include the manifest, as in our case it is too large and will cause a JSON max nesting error rather than raising the expected exception\n+  def missing_entry_error(name, **)\n+    raise ViteRuby::MissingEntrypointError.new(\n+      file_name: resolve_entry_name(name, **),\n+      last_build: builder.last_build_metadata,\n+      manifest: '',\n+      config: config\n+    )\n+  end\n end\n \n ViteRuby::Manifest.prepend ViteRuby::ManifestIntegrityExtension\n@@ -95,6 +105,20 @@ def vite_stylesheet_tag(*names, **options)\n       end\n     end\n   end\n+\n+  def vite_preload_file_tag(name,\n+                            asset_type: :javascript,\n+                            crossorigin: 'anonymous', **options)\n+    ''.html_safe.tap do |tags|\n+      entries = vite_manifest.resolve_entries_with_integrity(name, type: asset_type)\n+\n+      entries.fetch(:scripts).each do |script|\n+        tags << vite_preload_tag(script[:file], integrity: script[:integrity], crossorigin: crossorigin, **options)\n+      end\n+    end\n+  rescue ViteRuby::MissingEntrypointError\n+    # Ignore this error, it is not critical if the file is not preloaded\n+  end\n end\n \n ViteRails::TagHelpers.prepend ViteRails::TagHelpers::IntegrityExtension\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -800,7 +800,7 @@ GEM\n       activerecord (>= 4.0.0)\n       railties (>= 4.0.0)\n     securerandom (0.4.1)\n-    selenium-webdriver (4.31.0)\n+    selenium-webdriver (4.32.0)\n       base64 (~> 0.2)\n       logger (~> 1.4)\n       rexml (~> 3.2, >= 3.2.5)\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -827,9 +827,9 @@ GEM\n       rufus-scheduler (~> 3.2)\n       sidekiq (>= 6, < 8)\n       tilt (>= 1.4.0, < 3)\n-    sidekiq-unique-jobs (8.0.10)\n+    sidekiq-unique-jobs (8.0.11)\n       concurrent-ruby (~> 1.0, >= 1.0.5)\n-      sidekiq (>= 7.0.0, < 8.0.0)\n+      sidekiq (>= 7.0.0, < 9.0.0)\n       thor (>= 1.0, < 3.0)\n     simple-navigation (4.4.0)\n       activesupport (>= 2.3.2)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [ws](https://redirect.github.com/websockets/ws) | [`8.18.1` -> `8.18.2`](https://renovatebot.com/diffs/npm/ws/8.18.1/8.18.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/ws/8.18.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/ws/8.18.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/ws/8.18.1/8.18.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/ws/8.18.1/8.18.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>websockets/ws (ws)</summary>\n\n### [`v8.18.2`](https://redirect.github.com/websockets/ws/releases/tag/8.18.2)\n\n[Compare Source](https://redirect.github.com/websockets/ws/compare/8.18.1...8.18.2)\n\n### Bug fixes\n\nFixed an issue that, during message decompression when the maximum size was\nexceeded, led to the emission of an inaccurate error and closure of the\nconnection with an improper close code ([#&#8203;2285](https://redirect.github.com/websockets/ws/issues/2285)).\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNjQuMCIsInVwZGF0ZWRJblZlciI6IjM5LjI2NC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -779,7 +779,8 @@ GEM\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n       rubocop-rspec (~> 3.5)\n-    ruby-prof (1.7.1)\n+    ruby-prof (1.7.2)\n+      base64\n     ruby-progressbar (1.13.0)\n     ruby-saml (1.18.0)\n       nokogiri (>= 1.13.10)\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -18945,8 +18945,8 @@ __metadata:\n   linkType: hard\n \n \"ws@npm:^8.11.0, ws@npm:^8.12.1, ws@npm:^8.18.0\":\n-  version: 8.18.1\n-  resolution: \"ws@npm:8.18.1\"\n+  version: 8.18.2\n+  resolution: \"ws@npm:8.18.2\"\n   peerDependencies:\n     bufferutil: ^4.0.1\n     utf-8-validate: \">=5.0.2\"\n@@ -18955,7 +18955,7 @@ __metadata:\n       optional: true\n     utf-8-validate:\n       optional: true\n-  checksum: 10c0/e498965d6938c63058c4310ffb6967f07d4fa06789d3364829028af380d299fe05762961742971c764973dce3d1f6a2633fe8b2d9410c9b52e534b4b882a99fa\n+  checksum: 10c0/4b50f67931b8c6943c893f59c524f0e4905bbd183016cfb0f2b8653aa7f28dad4e456b9d99d285bbb67cca4fedd9ce90dfdfaa82b898a11414ebd66ee99141e4\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\n.env.production.sample\n@@ -43,7 +43,6 @@ ES_PASS=password\n # Make sure to use `bundle exec rails secret` to generate secrets\n # -------\n SECRET_KEY_BASE=\n-OTP_SECRET=\n \n # Encryption secrets\n # ------------------\n---\napp.json\n@@ -17,10 +17,6 @@\n       \"description\": \"The secret key base\",\n       \"generator\": \"secret\"\n     },\n-    \"OTP_SECRET\": {\n-      \"description\": \"One-time password secret\",\n-      \"generator\": \"secret\"\n-    },\n     \"SINGLE_USER_MODE\": {\n       \"description\": \"Should the instance run in single user mode? (Disable registrations, redirect to front page)\",\n       \"value\": \"false\",\n---\nlib/tasks/mastodon.rake\n@@ -32,7 +32,7 @@ namespace :mastodon do\n       prompt.say('Single user mode disables registrations and redirects the landing page to your public profile.')\n       env['SINGLE_USER_MODE'] = prompt.yes?('Do you want to enable single user mode?', default: false)\n \n-      %w(SECRET_KEY_BASE OTP_SECRET).each do |key|\n+      %w(SECRET_KEY_BASE).each do |key|\n         env[key] = SecureRandom.hex(64)\n       end\n \n---\nscalingo.json\n@@ -12,10 +12,6 @@\n       \"description\": \"The secret key base\",\n       \"generator\": \"secret\"\n     },\n-    \"OTP_SECRET\": {\n-      \"description\": \"One-time password secret\",\n-      \"generator\": \"secret\"\n-    },\n     \"SINGLE_USER_MODE\": {\n       \"description\": \"Should the instance run in single user mode? (Disable registrations, redirect to front page)\",\n       \"value\": \"false\",\n---\n\n\n---\n\nChoice D:\ndb/migrate/20250425134308_quote_ids_to_timestamp_ids.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class QuoteIdsToTimestampIds < ActiveRecord::Migration[8.0]\n+  def up\n+    # Set up the media_attachments.id column to use our timestamp-based IDs.\n+    safety_assured do\n+      execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT timestamp_id('quotes')\")\n+    end\n+\n+    # Make sure we have a sequence to use.\n+    Mastodon::Snowflake.ensure_id_sequences_exist\n+  end\n+\n+  def down\n+    execute('LOCK quotes')\n+    execute(\"SELECT setval('quotes_id_seq', (SELECT MAX(id) FROM quotes))\")\n+    execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT nextval('quotes_id_seq')\")\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_22_085303) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_25_134654) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -871,7 +871,7 @@\n     t.string \"url\"\n   end\n \n-  create_table \"quotes\", force: :cascade do |t|\n+  create_table \"quotes\", id: :bigint, default: -> { \"timestamp_id('quotes'::text)\" }, force: :cascade do |t|\n     t.bigint \"account_id\", null: false\n     t.bigint \"status_id\", null: false\n     t.bigint \"quoted_status_id\"\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nNew Crowdin translations, automated with GitHub Actions\n\nSee `.github/workflows/crowdin-download.yml`\n\nThis PR will be updated every day with new translations.\n\nDue to a limitation in GitHub Actions, checks are not running on this PR without manual action.\nIf you want to run the checks, then close and re-open it.\n\n---\n\nChoice A:\napp/javascript/mastodon/locales/lt.json\n@@ -19,14 +19,17 @@\n   \"account.block_domain\": \"Blokuoti server\u012f {domain}\",\n   \"account.block_short\": \"Blokuoti\",\n   \"account.blocked\": \"U\u017eblokuota\",\n+  \"account.blocking\": \"Blokavimas\",\n   \"account.cancel_follow_request\": \"At\u0161aukti sekim\u0105\",\n   \"account.copy\": \"Kopijuoti nuorod\u0105 \u012f profil\u012f\",\n   \"account.direct\": \"Priva\u010diai pamin\u0117ti @{name}\",\n   \"account.disable_notifications\": \"Nustoti man prane\u0161ti, kai @{name} paskelbia\",\n+  \"account.domain_blocking\": \"Blokuoti domen\u0105\",\n   \"account.edit_profile\": \"Redaguoti profil\u012f\",\n   \"account.enable_notifications\": \"Prane\u0161ti man, kai @{name} paskelbia\",\n   \"account.endorse\": \"Rodyti profilyje\",\n   \"account.featured\": \"Rodomi\",\n+  \"account.featured.accounts\": \"Profiliai\",\n   \"account.featured.hashtags\": \"Saita\u017eod\u017eiai\",\n   \"account.featured.posts\": \"\u012era\u0161ai\",\n   \"account.featured_tags.last_status_at\": \"Paskutinis \u012fra\u0161as {date}\",\n@@ -39,6 +42,7 @@\n   \"account.following\": \"Sekama\",\n   \"account.following_counter\": \"{count, plural, one {{counter} sekimas} few {{counter} sekimai} many {{counter} sekimo} other {{counter} sekim\u0173}}\",\n   \"account.follows.empty\": \"\u0160is naudotojas dar nieko neseka.\",\n+  \"account.follows_you\": \"Seka tave\",\n   \"account.go_to_profile\": \"Eiti \u012f profil\u012f\",\n   \"account.hide_reblogs\": \"Sl\u0117pti pasidalinimus i\u0161 @{name}\",\n   \"account.in_memoriam\": \"Atminimui.\",\n@@ -53,6 +57,8 @@\n   \"account.mute_notifications_short\": \"Nutildyti prane\u0161imus\",\n   \"account.mute_short\": \"Nutildyti\",\n   \"account.muted\": \"Nutildytas\",\n+  \"account.muting\": \"U\u017etildymas\",\n+  \"account.mutual\": \"J\u016bs sekate vienas kit\u0105\",\n   \"account.no_bio\": \"N\u0117ra pateikto apra\u0161ymo.\",\n   \"account.open_original_page\": \"Atidaryti original\u0173 puslap\u012f\",\n   \"account.posts\": \"\u012era\u0161ai\",\n@@ -61,6 +67,7 @@\n   \"account.report\": \"Prane\u0161ti apie @{name}\",\n   \"account.requested\": \"Laukiama patvirtinimo. Spustel\u0117k, kad at\u0161auktum sekimo pra\u0161ym\u0105\",\n   \"account.requested_follow\": \"{name} papra\u0161\u0117 tave sekti\",\n+  \"account.requests_to_follow_you\": \"Pra\u0161ymai sekti jus\",\n   \"account.share\": \"Bendrinti @{name} profil\u012f\",\n   \"account.show_reblogs\": \"Rodyti pasidalinimus i\u0161 @{name}\",\n   \"account.statuses_counter\": \"{count, plural, one {{counter} \u012fra\u0161as} few {{counter} \u012fra\u0161ai} many {{counter} \u012fra\u0161o} other {{counter} \u012fra\u0161\u0173}}\",\n@@ -255,6 +262,7 @@\n   \"disabled_account_banner.text\": \"Tavo paskyra {disabledAccount} \u0161iuo metu i\u0161jungta.\",\n   \"dismissable_banner.community_timeline\": \"Tai \u2013 naujausi vie\u0161i \u012fra\u0161ai i\u0161 \u017emoni\u0173, kuri\u0173 paskyros talpinamos {domain}.\",\n   \"dismissable_banner.dismiss\": \"Atmesti\",\n+  \"dismissable_banner.explore_links\": \"\u0160iomis naujien\u0173 istorijomis \u0161iandien \\\"Fediverse\\\" dalijamasi da\u017eniausiai. Naujesn\u0117s istorijos, kurias paskelb\u0117 daugiau skirting\u0173 \u017emoni\u0173, u\u017eima auk\u0161tesn\u0119 viet\u0105.\",\n   \"domain_block_modal.block\": \"Blokuoti server\u012f\",\n   \"domain_block_modal.block_account_instead\": \"Blokuoti @{name} vietoj to\",\n   \"domain_block_modal.they_can_interact_with_old_posts\": \"\u017dmon\u0117s i\u0161 \u0161io serverio gali bendrauti su tavo senomis \u012fra\u0161omis.\",\n---\napp/javascript/mastodon/locales/sk.json\n@@ -26,6 +26,8 @@\n   \"account.edit_profile\": \"Upravi\u0165 profil\",\n   \"account.enable_notifications\": \"Zapn\u00fa\u0165 upozornenia na pr\u00edspevky od @{name}\",\n   \"account.endorse\": \"Zobrazi\u0165 na vlastnom profile\",\n+  \"account.featured.accounts\": \"Profily\",\n+  \"account.featured.hashtags\": \"Hashtagy\",\n   \"account.featured.posts\": \"Pr\u00edspevky\",\n   \"account.featured_tags.last_status_at\": \"Posledn\u00fd pr\u00edspevok d\u0148a {date}\",\n   \"account.featured_tags.last_status_never\": \"\u017diadne pr\u00edspevky\",\n@@ -37,6 +39,7 @@\n   \"account.following\": \"Sledovan\u00fd \u00fa\u010det\",\n   \"account.following_counter\": \"{count, plural, one {{counter} sledovan\u00fdch} other {{counter} sledovan\u00fdch}}\",\n   \"account.follows.empty\": \"Tento \u00fa\u010det e\u0161te nikoho nesleduje.\",\n+  \"account.follows_you\": \"Nasleduje \u0165a\",\n   \"account.go_to_profile\": \"Prejs\u0165 na profil\",\n   \"account.hide_reblogs\": \"Skry\u0165 zdie\u013eania od @{name}\",\n   \"account.in_memoriam\": \"In memoriam.\",\n@@ -208,6 +211,7 @@\n   \"confirmations.redraft.confirm\": \"Vymaza\u0165 a prep\u00edsa\u0165\",\n   \"confirmations.redraft.message\": \"Ur\u010dite chcete tento pr\u00edspevok vymaza\u0165 a prep\u00edsa\u0165? Pr\u00eddete o jeho zdie\u013eania a ohviezdi\u010dkovania a odpovede na p\u00f4vodn\u00fd pr\u00edspevok bud\u00fa odl\u00fa\u010den\u00e9.\",\n   \"confirmations.redraft.title\": \"Vymaza\u0165 a prep\u00edsa\u0165 pr\u00edspevok?\",\n+  \"confirmations.remove_from_followers.confirm\": \"Odstr\u00e1ni\u0165 nasledovate\u013ea\",\n   \"confirmations.reply.confirm\": \"Odpoveda\u0165\",\n   \"confirmations.reply.message\": \"Odpovedan\u00edm akur\u00e1t teraz prep\u00ed\u0161e\u0161 spr\u00e1vu, ktor\u00fa m\u00e1\u0161 pr\u00e1ve rozp\u00edsan\u00fa. Si si ist\u00fd/\u00e1, \u017ee chce\u0161 pokra\u010dova\u0165?\",\n   \"confirmations.reply.title\": \"Prep\u00edsa\u0165 pr\u00edspevok?\",\n---\nconfig/locales/nan.yml\n@@ -36,6 +36,25 @@ nan:\n       approved_msg: \u6210\u529f\u5be9\u6838 %{username} \u00ea\u8a3b\u518a\u7533\u8acbah\n       are_you_sure: L\u00ed k\u00e1m\u78ba\u5b9a\uff1f\n       avatar: \u6a19\u982d\n+      by_domain: \u57df\u540d\n+      change_email:\n+        changed_msg: Email\u6539\u6210\u529fah\uff01\n+        current_email: \u73fe\u5728\u00ea email\n+        label: \u6539email\n+        new_email: \u65b0\u00ea email\n+        submit: \u6539email\n+        title: \u66ff %{username} \u6539email\n+      change_role:\n+        changed_msg: \u89d2\u8272\u6539\u6210\u529fah\uff01\n+        edit_roles: \u7ba1\u7406\u7528\u8005\u00ea\u89d2\u8272\n+        label: \u6539\u89d2\u8272\n+        no_role: \u7121\u89d2\u8272\n+        title: \u66ff %{username} \u6539\u89d2\u8272\n+      confirm: \u78ba\u8a8d\n+      confirmed: \u78ba\u8a8dah\n+      confirming: Teh\u78ba\u8a8d\n+      custom: \u81ea\u8a02\n+      delete: Th\u00e2i\u8cc7\u6599\n       deleted: Th\u00e2i\u6389ah\n       demote: \u964d\u7d1a\n       destroyed_msg: Teh-beh th\u00e2i\u6389 %{username} \u00ea\u8cc7\u6599\n@@ -49,15 +68,61 @@ nan:\n       email: \u96fb\u5b50phue\u7bb1\n       email_status: \u96fb\u5b50phue \u00ea\u72c0\u614b\n       enable: \u53d6\u6d88\u51b7\u51cd\n+      enable_sign_in_token_auth: \u555f\u7528\u96fb\u5b50phue \u00ea token\u8a8d\u8b49\n+      enabled: \u555f\u7528ah\n+      enabled_msg: \u6210\u529fk\u0101 %{username} \u00ea\u53e3\u5ea7\u9000\u51b0\n+      followers: \u8ddftu\u00e8 l\u00ed \u00ea\n+      follows: L\u00ed\u8ddftu\u00e8 \u00ea\n+      header: \u5c01\u9762\u00ea\u5716\n+      inbox_url: \u6536\u4ef6kheh-\u00e1 \u00ea URL\n+      invite_request_text: \u52a0\u5165\u00ea\u7406\u7531\n+      invited_by: \u9080\u8acb\u00ea l\u00e2ng\n+      ip: IP\n+      joined: \u52a0\u5165\u00ea\u6642\n       location:\n         all: Kui \u00ea\n         local: \u672c\u5730\n         remote: \u5225\u00ea\u7ad9\n         title: \u4f4d\u7f6e\n+      login_status: \u767b\u5165\u00ea\u72c0\u614b\n+      media_attachments: \u5a92\u9ad4\u00ea\u9644\u4ef6\n+      memorialize: \u8b8a\u505a\u6545\u4eba\u00ea\u53e3\u5ea7\n+      memorialized: \u8b8a\u505a\u6545\u4eba\u00ea\u53e3\u5ea7ah\n+      memorialized_msg: \u6210\u529fk\u0101 %{username} \u8b8a\u505a\u6545\u4eba\u00ea\u53e3\u5ea7ah\n+      moderation:\n+        active: \u6d3b\u00ea\n+        all: \u5168\u90e8\n+        disabled: \u505c\u6b62\u4f7f\u7528ah\n+        pending: Teh\u5be9\u6838\n+        silenced: \u53d7\u9650\u5236\n+        suspended: \u6b0a\u9650\u4e2d\u6b62ah\n+        title: \u7ba1\u7406\n+      moderation_notes: \u7ba1\u7406\u00ea\u8a3b\u91cb\n+      most_recent_activity: \u6700\u8fd1\u00ea\u6d3b\u52d5\u6642\u9593\n+      most_recent_ip: \u6700\u8fd1\u00ea IP\n+      no_account_selected: \u56e0\u70ba\u7121\u63c0\u4efb\u4f55\u53e3\u5ea7\uff0c\u6240\u4ee5l\u00f3ng\u7121\u6539\u8b8a\n+      no_limits_imposed: \u7121\u53d7\u8457\u9650\u5236\n+      no_role_assigned: \u7121\u5206\u8457\u89d2\u8272\n+      not_subscribed: \u7121\u8a02\n+      pending: Teh\u7b49\u5be9\u6838\n+      perform_full_suspension: \u4e2d\u6b62\u6b0a\u9650\n+      previous_strikes: Khah\u65e9\u00ea\u8655\u4efd\n       remove_avatar: Th\u00e2i\u6389\u6a19\u982d\n       removed_avatar_msg: \u6210\u529fth\u00e2i\u6389 %{username} \u00ea \u6a19\u982d\u5f71\u50cf\n+      username: \u7528\u8005\u00ea\u540d\n+      view_domain: \u770b\u57df\u540d\u00ea\u6458\u8981\n+      warn: \u8b66\u544a\n+      web: \u7db2\u9801\n+      whitelisted: \u5141\u51c6\u4f47\u806f\u90a6\u50b3\u8cc7\u6599\n     action_logs:\n       action_types:\n+        approve_appeal: \u6279\u51c6\u6295\u8a34\n+        approve_user: \u6279\u51c6\u7528\u8005\n+        assigned_to_self_report: \u5206\u914d\u6aa2\u8209\n+        change_email_user: \u66ff\u7528\u8005\u6539email\n+        change_role_user: \u6539\u7528\u8005\u00ea\u89d2\u8272\n+        confirm_user: \u78ba\u8a8d\u7528\u8005\n+        create_account_warning: \u5efa\u7acb\u8b66\u544a\n         remove_avatar_user: Th\u00e2i\u6389\u6a19\u982d\n       actions:\n         remove_avatar_user_html: \"%{name} th\u00e2i\u6389 %{target} \u00ea\u6a19\u982d\"\n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -13,7 +13,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.225.2', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -93,21 +93,23 @@ GEM\n     annotaterb (4.15.0)\n     ast (2.4.3)\n     attr_required (1.0.2)\n-    aws-eventstream (1.3.2)\n-    aws-partitions (1.1103.0)\n-    aws-sdk-core (3.215.1)\n+    aws-eventstream (1.4.0)\n+    aws-partitions (1.1112.0)\n+    aws-sdk-core (3.225.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n     aws-sdk-s3 (1.177.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sdk-kms (~> 1)\n       aws-sigv4 (~> 1.5)\n-    aws-sigv4 (1.11.0)\n+    aws-sigv4 (1.12.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n     azure-blob (0.5.8)\n       rexml\n@@ -946,7 +948,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.225.2)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice C:\napp/models/web/push_subscription.rb\n@@ -12,13 +12,13 @@\n #  standard        :boolean          default(FALSE), not null\n #  created_at      :datetime         not null\n #  updated_at      :datetime         not null\n-#  access_token_id :bigint(8)\n-#  user_id         :bigint(8)\n+#  access_token_id :bigint(8)        not null\n+#  user_id         :bigint(8)        not null\n #\n \n class Web::PushSubscription < ApplicationRecord\n-  belongs_to :user, optional: true\n-  belongs_to :access_token, class_name: 'Doorkeeper::AccessToken', optional: true\n+  belongs_to :user\n+  belongs_to :access_token, class_name: 'Doorkeeper::AccessToken'\n \n   has_one :session_activation, foreign_key: 'web_push_subscription_id', inverse_of: :web_push_subscription, dependent: nil\n \n@@ -28,32 +28,16 @@ class Web::PushSubscription < ApplicationRecord\n \n   validates_with WebPushKeyValidator\n \n-  delegate :locale, to: :associated_user\n+  delegate :locale, to: :user\n \n   generates_token_for :unsubscribe, expires_in: Web::PushNotificationWorker::TTL\n \n   def pushable?(notification)\n     policy_allows_notification?(notification) && alert_enabled_for_notification_type?(notification)\n   end\n \n-  def associated_user\n-    return @associated_user if defined?(@associated_user)\n-\n-    @associated_user = if user_id.nil?\n-                         session_activation.user\n-                       else\n-                         user\n-                       end\n-  end\n-\n   def associated_access_token\n-    return @associated_access_token if defined?(@associated_access_token)\n-\n-    @associated_access_token = if access_token_id.nil?\n-                                 find_or_create_access_token.token\n-                               else\n-                                 access_token.token\n-                               end\n+    access_token.token\n   end\n \n   class << self\n@@ -65,16 +49,6 @@ def unsubscribe_for(application_id, resource_owner)\n \n   private\n \n-  def find_or_create_access_token\n-    Doorkeeper::AccessToken.find_or_create_for(\n-      application: Doorkeeper::Application.find_by(superapp: true),\n-      resource_owner: user_id || session_activation.user_id,\n-      scopes: Doorkeeper::OAuth::Scopes.from_string('read write follow push'),\n-      expires_in: Doorkeeper.configuration.access_token_expires_in,\n-      use_refresh_token: Doorkeeper.configuration.refresh_token_enabled?\n-    )\n-  end\n-\n   def alert_enabled_for_notification_type?(notification)\n     truthy?(data&.dig('alerts', notification.type.to_s))\n   end\n---\napp/serializers/web/notification_serializer.rb\n@@ -13,7 +13,7 @@ def access_token\n   end\n \n   def preferred_locale\n-    current_push_subscription.associated_user&.locale || I18n.default_locale\n+    current_push_subscription.user&.locale || I18n.default_locale\n   end\n \n   def notification_id\n---\ndb/migrate/20250422083912_add_not_null_to_web_push_subscription_user.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddNotNullToWebPushSubscriptionUser < ActiveRecord::Migration[8.0]\n+  def change\n+    add_check_constraint :web_push_subscriptions, 'user_id IS NOT NULL', name: 'web_push_subscriptions_user_id_null', validate: false\n+  end\n+end\n---\ndb/migrate/20250422084214_validate_add_not_null_to_web_push_subscription_user.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ValidateAddNotNullToWebPushSubscriptionUser < ActiveRecord::Migration[8.0]\n+  def up\n+    connection.execute(<<~SQL.squish)\n+      DELETE FROM web_push_subscriptions\n+      WHERE user_id IS NULL\n+    SQL\n+\n+    validate_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_user_id_null'\n+    change_column_null :web_push_subscriptions, :user_id, false\n+    remove_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_user_id_null'\n+  end\n+\n+  def down\n+    add_check_constraint :web_push_subscriptions, 'user_id IS NOT NULL', name: 'web_push_subscriptions_user_id_null', validate: false\n+    change_column_null :web_push_subscriptions, :user_id, true\n+  end\n+end\n---\ndb/migrate/20250422085027_add_not_null_to_web_push_subscription_access_token.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddNotNullToWebPushSubscriptionAccessToken < ActiveRecord::Migration[8.0]\n+  def change\n+    add_check_constraint :web_push_subscriptions, 'access_token_id IS NOT NULL', name: 'web_push_subscriptions_access_token_id_null', validate: false\n+  end\n+end\n---\ndb/migrate/20250422085303_validate_add_not_null_to_web_push_subscription_access_token.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ValidateAddNotNullToWebPushSubscriptionAccessToken < ActiveRecord::Migration[8.0]\n+  def up\n+    connection.execute(<<~SQL.squish)\n+      DELETE FROM web_push_subscriptions\n+      WHERE access_token_id IS NULL\n+    SQL\n+\n+    validate_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_access_token_id_null'\n+    change_column_null :web_push_subscriptions, :access_token_id, false\n+    remove_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_access_token_id_null'\n+  end\n+\n+  def down\n+    add_check_constraint :web_push_subscriptions, 'access_token_id IS NOT NULL', name: 'web_push_subscriptions_access_token_id_null', validate: false\n+    change_column_null :web_push_subscriptions, :access_token_id, true\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_11_095859) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_22_085303) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -1237,8 +1237,8 @@\n     t.json \"data\"\n     t.datetime \"created_at\", precision: nil, null: false\n     t.datetime \"updated_at\", precision: nil, null: false\n-    t.bigint \"access_token_id\"\n-    t.bigint \"user_id\"\n+    t.bigint \"access_token_id\", null: false\n+    t.bigint \"user_id\", null: false\n     t.boolean \"standard\", default: false, null: false\n     t.index [\"access_token_id\"], name: \"index_web_push_subscriptions_on_access_token_id\", where: \"(access_token_id IS NOT NULL)\"\n     t.index [\"user_id\"], name: \"index_web_push_subscriptions_on_user_id\"\n---\nspec/fabricators/web_push_subscription_fabricator.rb\n@@ -8,4 +8,6 @@\n     Base64.urlsafe_encode64(ecdh_key)\n   end\n   key_auth { Base64.urlsafe_encode64(Random.new.bytes(16)) }\n+  user { Fabricate(:user) }\n+  access_token { |attrs| Fabricate.build(:accessible_access_token, resource_owner_id: attrs[:user].id) }\n end\n---\nspec/requests/api/v1/push/subscriptions_spec.rb\n@@ -207,7 +207,8 @@ def create_subscription_with_token\n     Fabricate(\n       :web_push_subscription,\n       endpoint: create_payload[:subscription][:endpoint],\n-      access_token_id: token.id\n+      access_token: token,\n+      user: user\n     )\n   end\n end\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/selectors/contexts.ts\n@@ -41,7 +41,7 @@ export const getDescendantsIds = createAppSelector(\n       }\n \n       if (replies) {\n-        replies.reverse().forEach((replyId) => {\n+        replies.toReversed().forEach((replyId) => {\n           if (\n             !visitIds.includes(replyId) &&\n             !descendantsIds.includes(replyId) &&\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nRelated to: https://github.com/mastodon/mastodon/pull/32620\r\n\r\nI had noticed this too, that even though i was running glitch and had this code in our instance that i wasn't getting the external counts.\r\n\r\nProblem stems from my prior misunderstanding of how strings and symbols work in ruby (sorry). The activitypub object has strings for keys, not symbols.\r\n\r\ndistressingly, the tests still seem to pass without changing them? don't know what to make of that.\r\n\r\ntested this on local development instance. prior impl had `null` in the untrusted counts columns, this version fills them and also displays them correctly.\r\n\r\nedit: marking as draft until the tests finish\r\nedit2: tests pass so good 2 go\n\n---\n\nChoice A:\napp/controllers/concerns/localized.rb\n@@ -16,7 +16,7 @@ def set_locale(&block)\n   def requested_locale\n     requested_locale_name   = available_locale_or_nil(params[:lang])\n     requested_locale_name ||= available_locale_or_nil(current_user.locale) if respond_to?(:user_signed_in?) && user_signed_in?\n-    requested_locale_name ||= http_accept_language if ENV['DEFAULT_LOCALE'].blank?\n+    requested_locale_name ||= http_accept_language unless ENV['FORCE_DEFAULT_LOCALE'] == 'true'\n     requested_locale_name\n   end\n \n---\n\n\n---\n\nChoice B:\napp/lib/activitypub/parser/status_parser.rb\n@@ -95,11 +95,11 @@ def language\n   end\n \n   def favourites_count\n-    @object.dig(:likes, :totalItems)\n+    @object.dig('likes', 'totalItems')\n   end\n \n   def reblogs_count\n-    @object.dig(:shares, :totalItems)\n+    @object.dig('shares', 'totalItems')\n   end\n \n   def quote_policy\n---\n\n\n---\n\nChoice C:\nspec/lib/activitypub/activity/remove_spec.rb\n@@ -4,29 +4,60 @@\n \n RSpec.describe ActivityPub::Activity::Remove do\n   let(:sender) { Fabricate(:account, featured_collection_url: 'https://example.com/featured') }\n-  let(:status) { Fabricate(:status, account: sender) }\n-\n-  let(:json) do\n-    {\n-      '@context': 'https://www.w3.org/ns/activitystreams',\n-      id: 'foo',\n-      type: 'Add',\n-      actor: ActivityPub::TagManager.instance.uri_for(sender),\n-      object: ActivityPub::TagManager.instance.uri_for(status),\n-      target: sender.featured_collection_url,\n-    }.with_indifferent_access\n-  end\n \n   describe '#perform' do\n     subject { described_class.new(json, sender) }\n \n-    before do\n-      StatusPin.create!(account: sender, status: status)\n-      subject.perform\n+    context 'when removing a pinned status' do\n+      let(:status) { Fabricate(:status, account: sender) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: ActivityPub::TagManager.instance.uri_for(status),\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        StatusPin.create!(account: sender, status: status)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.pinned?(status) }.to(false)\n+      end\n     end\n \n-    it 'removes a pin' do\n-      expect(sender.pinned?(status)).to be false\n+    context 'when removing a featured tag' do\n+      let(:tag) { Fabricate(:tag) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: {\n+            type: 'Hashtag',\n+            name: \"##{tag.display_name}\",\n+            href: \"https://example.com/tags/#{tag.name}\",\n+          },\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        sender.featured_tags.find_or_create_by!(name: tag.name)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.featured_tags.exists?(tag: tag) }.to(false)\n+      end\n     end\n   end\n end\n---\n\n\n---\n\nChoice D:\napp/lib/activitypub/activity/create.rb\n@@ -233,7 +233,7 @@ def process_quote\n \n     approval_uri = @status_parser.quote_approval_uri\n     approval_uri = nil if unsupported_uri_scheme?(approval_uri)\n-    @quote = Quote.new(account: @account, approval_uri: approval_uri)\n+    @quote = Quote.new(account: @account, approval_uri: approval_uri, legacy: @status_parser.legacy_quote?)\n   end\n \n   def process_hashtag(tag)\n---\napp/lib/activitypub/parser/status_parser.rb\n@@ -123,6 +123,10 @@ def quote_uri\n     end.first\n   end\n \n+  def legacy_quote?\n+    !@object.key?('quote')\n+  end\n+\n   # The inlined quote; out of the attributes we support, only `https://w3id.org/fep/044f#quote` explicitly supports inlined objects\n   def quoted_object\n     as_array(@object['quote']).first\n---\napp/models/quote.rb\n@@ -7,6 +7,7 @@\n #  id                :bigint(8)        not null, primary key\n #  activity_uri      :string\n #  approval_uri      :string\n+#  legacy            :boolean          default(FALSE), not null\n #  state             :integer          default(\"pending\"), not null\n #  created_at        :datetime         not null\n #  updated_at        :datetime         not null\n@@ -46,6 +47,10 @@ def reject!\n     end\n   end\n \n+  def acceptable?\n+    accepted? || !legacy?\n+  end\n+\n   def schedule_refresh_if_stale!\n     return unless quoted_status_id.present? && approval_uri.present? && updated_at <= BACKGROUND_REFRESH_INTERVAL.ago\n \n---\napp/serializers/rest/status_serializer.rb\n@@ -33,6 +33,10 @@ class REST::StatusSerializer < ActiveModel::Serializer\n   has_one :preview_card, key: :card, serializer: REST::PreviewCardSerializer\n   has_one :preloadable_poll, key: :poll, serializer: REST::PollSerializer\n \n+  def quote\n+    object.quote if object.quote&.acceptable?\n+  end\n+\n   def id\n     object.id.to_s\n   end\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -283,14 +283,14 @@ def update_quote!\n         # If the quoted post has changed, discard the old object and create a new one\n         if @status.quote.quoted_status.present? && ActivityPub::TagManager.instance.uri_for(@status.quote.quoted_status) != quote_uri\n           @status.quote.destroy\n-          quote = Quote.create(status: @status, approval_uri: approval_uri)\n+          quote = Quote.create(status: @status, approval_uri: approval_uri, legacy: @status_parser.legacy_quote?)\n           @quote_changed = true\n         else\n           quote = @status.quote\n-          quote.update(approval_uri: approval_uri, state: :pending) if quote.approval_uri != @status_parser.quote_approval_uri\n+          quote.update(approval_uri: approval_uri, state: :pending, legacy: @status_parser.legacy_quote?) if quote.approval_uri != @status_parser.quote_approval_uri\n         end\n       else\n-        quote = Quote.create(status: @status, approval_uri: approval_uri)\n+        quote = Quote.create(status: @status, approval_uri: approval_uri, legacy: @status_parser.legacy_quote?)\n         @quote_changed = true\n       end\n \n---\ndb/migrate/20250605110215_add_legacy_to_quotes.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddLegacyToQuotes < ActiveRecord::Migration[8.0]\n+  def change\n+    add_column :quotes, :legacy, :boolean, null: false, default: false\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_05_20_204643) do\n+ActiveRecord::Schema[8.0].define(version: 2025_06_05_110215) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -906,6 +906,7 @@\n     t.string \"activity_uri\"\n     t.datetime \"created_at\", null: false\n     t.datetime \"updated_at\", null: false\n+    t.boolean \"legacy\", default: false, null: false\n     t.index [\"account_id\", \"quoted_account_id\"], name: \"index_quotes_on_account_id_and_quoted_account_id\"\n     t.index [\"activity_uri\"], name: \"index_quotes_on_activity_uri\", unique: true, where: \"(activity_uri IS NOT NULL)\"\n     t.index [\"approval_uri\"], name: \"index_quotes_on_approval_uri\", where: \"(approval_uri IS NOT NULL)\"\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [aws-sdk-core](https://redirect.github.com/aws/aws-sdk-ruby) ([source](https://redirect.github.com/aws/aws-sdk-ruby/tree/HEAD/gems/aws-sdk-core), [changelog](https://redirect.github.com/aws/aws-sdk-ruby/tree/version-3/gems/aws-sdk-core/CHANGELOG.md)) | `'< 3.216.0'` -> `'< 3.223.1'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/aws-sdk-core/3.223.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/aws-sdk-core/3.223.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/aws-sdk-core/3.215.1/3.223.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/aws-sdk-core/3.215.1/3.223.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>aws/aws-sdk-ruby (aws-sdk-core)</summary>\n\n### [`v3.223.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32230-2025-05-01)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n### [`v3.222.3`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32223-2025-04-28)\n\n-   Issue - Do not dynamically create operation methods from the API. ([#&#8203;3234](https://redirect.github.com/aws/aws-sdk-ruby/issues/3234))\n\n### [`v3.222.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32222-2025-04-16)\n\n-   Issue - Additional metrics collection for credentials in the User-Agent plugin.\n\n### [`v3.222.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32221-2025-03-28)\n\n-   Issue - Allow explicit modeled headers to override prefixed headers for `rest` protocols.\n\n### [`v3.222.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32220-2025-03-27)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - This release adds AwsAdditionalDetails in the CreateTokenWithIAM API response.\n\n### [`v3.221.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32210-2025-03-24)\n\n-   Feature - Add `logger` as an explicit dependency for Ruby 3.5.\n-   Issue - Enable ALPN over TLS for H2 Connection by default.\n-   Issue - Fix HTTP-2 connections to properly use config values configured on the client.\n\n### [`v3.220.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32202-2025-03-20)\n\n-   Issue - Enable ALPN over TLS for H2 by default.\n\n### [`v3.220.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32201-2025-03-06)\n\n-   Issue - Convert stubs at request time.\n\n### [`v3.220.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32200-2025-03-04)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n### [`v3.219.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32190-2025-02-18)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.218.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32181-2025-02-07)\n\n-   Issue - Add handling of block in ExtendedSession delegation ([#&#8203;3178](https://redirect.github.com/aws/aws-sdk-ruby/issues/3178)).\n\n### [`v3.218.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32180-2025-02-06)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.217.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32171-2025-01-30)\n\n-   Issue - Add `transfer-encoding` and `connection` to list of unsigned sigv4 headers.\n\n### [`v3.217.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32170-2025-01-24)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Fixed typos in the descriptions.\n\n### [`v3.216.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32161-2025-01-22)\n\n-   Issue - Use epoch seconds instead of milliseconds in cbor encode/decode.\n\n-   Issue - Add handling of block in response delegation ([#&#8203;3169](https://redirect.github.com/aws/aws-sdk-ruby/issues/3169)).\n\n### [`v3.216.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32160-2025-01-15)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n-   Feature - Always calculate request checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:request_checksum_calculation`, in the shared config file as `request_checksum_calculation`, and in the ENV as `ENV['AWS_REQUEST_CHECKSUM_CALCULATION']`.\n\n-   Feature - Always validate response checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:response_checksum_validation`, in the shared config file as `response_checksum_validation`, and in the ENV as `ENV['AWS_RESPONSE_CHECKSUM_VALIDATION']`.\n\n-   Feature - Support CRC64NVME checksums through the `aws-crt` gem.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNjQuMCIsInVwZGF0ZWRJblZlciI6IjM5LjI2NC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nDockerfile\n@@ -13,7 +13,7 @@ ARG BASE_REGISTRY=\"docker.io\"\n \n # Ruby image to use for base image, change with [--build-arg RUBY_VERSION=\"3.4.x\"]\n # renovate: datasource=docker depName=docker.io/ruby\n-ARG RUBY_VERSION=\"3.4.3\"\n+ARG RUBY_VERSION=\"3.4.4\"\n # # Node.js version to use in base image, change with [--build-arg NODE_MAJOR_VERSION=\"20\"]\n # renovate: datasource=node-version depName=node\n ARG NODE_MAJOR_VERSION=\"22\"\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -628,7 +628,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.223.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1096.0)\n+    aws-sdk-core (3.223.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.223.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice D:\napp/views/auth/registrations/new.html.haml\n@@ -56,7 +56,7 @@\n     .fields-group\n       = f.input :date_of_birth,\n                 as: :date_of_birth,\n-                hint: t('simple_form.hints.user.date_of_birth', age: Setting.min_age.to_i),\n+                hint: t('simple_form.hints.user.date_of_birth', count: Setting.min_age.to_i),\n                 required: true,\n                 wrapper: :with_block_label\n \n---\nconfig/locales/simple_form.en.yml\n@@ -148,7 +148,9 @@ en:\n         min_age: Should not be below the minimum age required by the laws of your jurisdiction.\n       user:\n         chosen_languages: When checked, only posts in selected languages will be displayed in public timelines\n-        date_of_birth: We have to make sure you're at least %{age} to use Mastodon. We won't store this.\n+        date_of_birth:\n+          one: We have to make sure you're at least %{count} to use Mastodon. We won't store this.\n+          other: We have to make sure you're at least %{count} to use Mastodon. We won't store this.\n         role: The role controls which permissions the user has.\n       user_role:\n         color: Color to be used for the role throughout the UI, as RGB in hex format\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [public_suffix](https://simonecarletti.com/code/publicsuffix-ruby) ([source](https://redirect.github.com/weppos/publicsuffix-ruby), [changelog](https://redirect.github.com/weppos/publicsuffix-ruby/blob/master/CHANGELOG.md)) | `6.0.1` -> `6.0.2` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/public_suffix/6.0.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/public_suffix/6.0.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/public_suffix/6.0.1/6.0.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/public_suffix/6.0.1/6.0.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>weppos/publicsuffix-ruby (public_suffix)</summary>\n\n### [`v6.0.2`](https://redirect.github.com/weppos/publicsuffix-ruby/blob/HEAD/CHANGELOG.md#602)\n\n[Compare Source](https://redirect.github.com/weppos/publicsuffix-ruby/compare/v6.0.1...v6.0.2)\n\n##### Changed\n\n-   Updated definitions.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNjQuMCIsInVwZGF0ZWRJblZlciI6IjM5LjI2NC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\napp/controllers/api/base_controller.rb\n@@ -72,6 +72,13 @@ def require_user!\n     end\n   end\n \n+  # Redefine `require_functional!` to properly output JSON instead of HTML redirects\n+  def require_functional!\n+    return if current_user.functional?\n+\n+    require_user!\n+  end\n+\n   def render_empty\n     render json: {}, status: 200\n   end\n---\napp/controllers/application_controller.rb\n@@ -72,10 +72,24 @@ def store_referrer\n   def require_functional!\n     return if current_user.functional?\n \n-    if current_user.confirmed?\n-      redirect_to edit_user_registration_path\n-    else\n-      redirect_to auth_setup_path\n+    respond_to do |format|\n+      format.any do\n+        if current_user.confirmed?\n+          redirect_to edit_user_registration_path\n+        else\n+          redirect_to auth_setup_path\n+        end\n+      end\n+\n+      format.json do\n+        if !current_user.confirmed?\n+          render json: { error: 'Your login is missing a confirmed e-mail address' }, status: 403\n+        elsif !current_user.approved?\n+          render json: { error: 'Your login is currently pending approval' }, status: 403\n+        elsif !current_user.functional?\n+          render json: { error: 'Your login is currently disabled' }, status: 403\n+        end\n+      end\n     end\n   end\n \n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -620,7 +620,7 @@ GEM\n     psych (5.2.3)\n       date\n       stringio\n-    public_suffix (6.0.1)\n+    public_suffix (6.0.2)\n     puma (6.6.0)\n       nio4r (~> 2.0)\n     pundit (2.5.0)\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -800,7 +800,7 @@ GEM\n       activerecord (>= 4.0.0)\n       railties (>= 4.0.0)\n     securerandom (0.4.1)\n-    selenium-webdriver (4.31.0)\n+    selenium-webdriver (4.32.0)\n       base64 (~> 0.2)\n       logger (~> 1.4)\n       rexml (~> 3.2, >= 3.2.5)\n---\n\n\n---\n\nChoice D:\n.github/workflows/test-ruby.yml\n@@ -143,7 +143,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick libpam-dev\n+          additional-system-dependencies: ffmpeg libpam-dev\n \n       - name: Load database schema\n         run: |\n@@ -173,8 +173,8 @@ jobs:\n         env:\n           CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}\n \n-  test-libvips:\n-    name: Libvips tests\n+  test-imagemagick:\n+    name: ImageMagick tests\n     runs-on: ubuntu-latest\n \n     needs:\n@@ -220,7 +220,7 @@ jobs:\n       CAS_ENABLED: true\n       BUNDLE_WITH: 'pam_authentication test'\n       GITHUB_RSPEC: ${{ matrix.ruby-version == '.ruby-version' && github.event.pull_request && 'true' }}\n-      MASTODON_USE_LIBVIPS: true\n+      MASTODON_USE_LIBVIPS: false\n \n     strategy:\n       fail-fast: false\n@@ -245,7 +245,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg libpam-dev\n+          additional-system-dependencies: ffmpeg imagemagick libpam-dev\n \n       - name: Load database schema\n         run: './bin/rails db:create db:schema:load db:seed'\n@@ -324,7 +324,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick\n+          additional-system-dependencies: ffmpeg\n \n       - name: Set up Javascript environment\n         uses: ./.github/actions/setup-javascript\n@@ -443,7 +443,7 @@ jobs:\n         uses: ./.github/actions/setup-ruby\n         with:\n           ruby-version: ${{ matrix.ruby-version}}\n-          additional-system-dependencies: ffmpeg imagemagick\n+          additional-system-dependencies: ffmpeg\n \n       - name: Set up Javascript environment\n         uses: ./.github/actions/setup-javascript\n---\nconfig/application.rb\n@@ -95,7 +95,7 @@ class Application < Rails::Application\n       require 'mastodon/redis_configuration'\n       ::REDIS_CONFIGURATION = Mastodon::RedisConfiguration.new\n \n-      config.x.use_vips = ENV['MASTODON_USE_LIBVIPS'] == 'true'\n+      config.x.use_vips = ENV['MASTODON_USE_LIBVIPS'] != 'false'\n \n       if config.x.use_vips\n         require_relative '../lib/paperclip/vips_lazy_thumbnail'\n---\nconfig/initializers/deprecations.rb\n@@ -16,3 +16,9 @@\n \n   abort message\n end\n+\n+if ENV['MASTODON_USE_LIBVIPS'] == 'false'\n+  warn <<~MESSAGE\n+    WARNING: Mastodon support for ImageMagick is deprecated and will be removed in future versions. Please consider using libvips instead.\n+  MESSAGE\n+end\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThe main thing justifying the major version bump here is increasing the lowest supported Rails version to 7.2. Other changes are mostly cosmetic, with a small features/enhancements.\r\n\r\nNotably, I think we may be able to use `served_by` to slightly clean up the capybara config on system specs, but for now just doing the version bump. Will confirm and do that in future PR if actually helpful.\n\n---\n\nChoice A:\nGemfile\n@@ -212,7 +212,7 @@ group :development, :test do\n   gem 'test-prof', require: false\n \n   # RSpec runner for rails\n-  gem 'rspec-rails', '~> 7.0'\n+  gem 'rspec-rails', '~> 8.0'\n end\n \n group :production do\n---\nGemfile.lock\n@@ -435,7 +435,7 @@ GEM\n     mutex_m (0.3.0)\n     net-http (0.6.0)\n       uri\n-    net-imap (0.5.6)\n+    net-imap (0.5.8)\n       date\n       net-protocol\n     net-ldap (0.19.0)\n@@ -721,18 +721,18 @@ GEM\n       rspec-mocks (~> 3.13.0)\n     rspec-core (3.13.3)\n       rspec-support (~> 3.13.0)\n-    rspec-expectations (3.13.3)\n+    rspec-expectations (3.13.4)\n       diff-lcs (>= 1.2.0, < 2.0)\n       rspec-support (~> 3.13.0)\n     rspec-github (3.0.0)\n       rspec-core (~> 3.0)\n-    rspec-mocks (3.13.2)\n+    rspec-mocks (3.13.3)\n       diff-lcs (>= 1.2.0, < 2.0)\n       rspec-support (~> 3.13.0)\n-    rspec-rails (7.1.1)\n-      actionpack (>= 7.0)\n-      activesupport (>= 7.0)\n-      railties (>= 7.0)\n+    rspec-rails (8.0.0)\n+      actionpack (>= 7.2)\n+      activesupport (>= 7.2)\n+      railties (>= 7.2)\n       rspec-core (~> 3.13)\n       rspec-expectations (~> 3.13)\n       rspec-mocks (~> 3.13)\n@@ -742,7 +742,7 @@ GEM\n       rspec-expectations (~> 3.0)\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n-    rspec-support (3.13.2)\n+    rspec-support (3.13.3)\n     rubocop (1.75.4)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n@@ -842,7 +842,7 @@ GEM\n       base64\n     stoplight (4.1.1)\n       redlock (~> 1.0)\n-    stringio (3.1.6)\n+    stringio (3.1.7)\n     strong_migrations (2.3.0)\n       activerecord (>= 7)\n     swd (2.0.3)\n@@ -1045,7 +1045,7 @@ DEPENDENCIES\n   redis-namespace (~> 1.10)\n   rqrcode (~> 3.0)\n   rspec-github (~> 3.0)\n-  rspec-rails (~> 7.0)\n+  rspec-rails (~> 8.0)\n   rspec-sidekiq (~> 5.0)\n   rubocop\n   rubocop-capybara\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -6678,9 +6678,9 @@ __metadata:\n   linkType: hard\n \n \"core-js@npm:^3.30.2\":\n-  version: 3.41.0\n-  resolution: \"core-js@npm:3.41.0\"\n-  checksum: 10c0/a29ed0b7fe81acf49d04ce5c17a1947166b1c15197327a5d12f95bbe84b46d60c3c13de701d808f41da06fa316285f3f55ce5903abc8d5642afc1eac4457afc8\n+  version: 3.42.0\n+  resolution: \"core-js@npm:3.42.0\"\n+  checksum: 10c0/2913d3d5452d54ad92f058d66046782d608c05e037bcc523aab79c04454fe640998f94e6011292969d66dfa472f398b085ce843dcb362056532a5799c627184e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -4886,15 +4886,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"bundle-name@npm:^4.1.0\":\n-  version: 4.1.0\n-  resolution: \"bundle-name@npm:4.1.0\"\n-  dependencies:\n-    run-applescript: \"npm:^7.0.0\"\n-  checksum: 10c0/8e575981e79c2bcf14d8b1c027a3775c095d362d1382312f444a7c861b0e21513c0bd8db5bd2b16e50ba0709fa622d4eab6b53192d222120305e68359daece29\n-  languageName: node\n-  linkType: hard\n-\n \"bytes@npm:3.1.2\":\n   version: 3.1.2\n   resolution: \"bytes@npm:3.1.2\"\n@@ -5543,23 +5534,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"default-browser-id@npm:^5.0.0\":\n-  version: 5.0.0\n-  resolution: \"default-browser-id@npm:5.0.0\"\n-  checksum: 10c0/957fb886502594c8e645e812dfe93dba30ed82e8460d20ce39c53c5b0f3e2afb6ceaec2249083b90bdfbb4cb0f34e1f73fde3d68cac00becdbcfd894156b5ead\n-  languageName: node\n-  linkType: hard\n-\n-\"default-browser@npm:^5.2.1\":\n-  version: 5.2.1\n-  resolution: \"default-browser@npm:5.2.1\"\n-  dependencies:\n-    bundle-name: \"npm:^4.1.0\"\n-    default-browser-id: \"npm:^5.0.0\"\n-  checksum: 10c0/73f17dc3c58026c55bb5538749597db31f9561c0193cd98604144b704a981c95a466f8ecc3c2db63d8bfd04fb0d426904834cfc91ae510c6aeb97e13c5167c4d\n-  languageName: node\n-  linkType: hard\n-\n \"define-data-property@npm:^1.0.1, define-data-property@npm:^1.1.4\":\n   version: 1.1.4\n   resolution: \"define-data-property@npm:1.1.4\"\n@@ -5571,10 +5545,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"define-lazy-prop@npm:^3.0.0\":\n-  version: 3.0.0\n-  resolution: \"define-lazy-prop@npm:3.0.0\"\n-  checksum: 10c0/5ab0b2bf3fa58b3a443140bbd4cd3db1f91b985cc8a246d330b9ac3fc0b6a325a6d82bddc0b055123d745b3f9931afeea74a5ec545439a1630b9c8512b0eeb49\n+\"define-lazy-prop@npm:^2.0.0\":\n+  version: 2.0.0\n+  resolution: \"define-lazy-prop@npm:2.0.0\"\n+  checksum: 10c0/db6c63864a9d3b7dc9def55d52764968a5af296de87c1b2cc71d8be8142e445208071953649e0386a8cc37cfcf9a2067a47207f1eb9ff250c2a269658fdae422\n   languageName: node\n   linkType: hard\n \n@@ -7531,12 +7505,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-docker@npm:^3.0.0\":\n-  version: 3.0.0\n-  resolution: \"is-docker@npm:3.0.0\"\n+\"is-docker@npm:^2.0.0, is-docker@npm:^2.1.1\":\n+  version: 2.2.1\n+  resolution: \"is-docker@npm:2.2.1\"\n   bin:\n     is-docker: cli.js\n-  checksum: 10c0/d2c4f8e6d3e34df75a5defd44991b6068afad4835bb783b902fa12d13ebdb8f41b2a199dcb0b5ed2cb78bfee9e4c0bbdb69c2d9646f4106464674d3e697a5856\n+  checksum: 10c0/e828365958d155f90c409cdbe958f64051d99e8aedc2c8c4cd7c89dcf35329daed42f7b99346f7828df013e27deb8f721cf9408ba878c76eb9e8290235fbcdcc\n   languageName: node\n   linkType: hard\n \n@@ -7597,17 +7571,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-inside-container@npm:^1.0.0\":\n-  version: 1.0.0\n-  resolution: \"is-inside-container@npm:1.0.0\"\n-  dependencies:\n-    is-docker: \"npm:^3.0.0\"\n-  bin:\n-    is-inside-container: cli.js\n-  checksum: 10c0/a8efb0e84f6197e6ff5c64c52890fa9acb49b7b74fed4da7c95383965da6f0fa592b4dbd5e38a79f87fc108196937acdbcd758fcefc9b140e479b39ce1fcd1cd\n-  languageName: node\n-  linkType: hard\n-\n \"is-lambda@npm:^1.0.1\":\n   version: 1.0.1\n   resolution: \"is-lambda@npm:1.0.1\"\n@@ -7772,12 +7735,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-wsl@npm:^3.1.0\":\n-  version: 3.1.0\n-  resolution: \"is-wsl@npm:3.1.0\"\n+\"is-wsl@npm:^2.2.0\":\n+  version: 2.2.0\n+  resolution: \"is-wsl@npm:2.2.0\"\n   dependencies:\n-    is-inside-container: \"npm:^1.0.0\"\n-  checksum: 10c0/d3317c11995690a32c362100225e22ba793678fe8732660c6de511ae71a0ff05b06980cf21f98a6bf40d7be0e9e9506f859abe00a1118287d63e53d0a3d06947\n+    is-docker: \"npm:^2.0.0\"\n+  checksum: 10c0/a6fa2d370d21be487c0165c7a440d567274fbba1a817f2f0bfa41cc5e3af25041d84267baa22df66696956038a43973e72fca117918c91431920bdef490fa25e\n   languageName: node\n   linkType: hard\n \n@@ -8877,15 +8840,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"open@npm:^10.1.2\":\n-  version: 10.1.2\n-  resolution: \"open@npm:10.1.2\"\n+\"open@npm:^8.0.0\":\n+  version: 8.4.2\n+  resolution: \"open@npm:8.4.2\"\n   dependencies:\n-    default-browser: \"npm:^5.2.1\"\n-    define-lazy-prop: \"npm:^3.0.0\"\n-    is-inside-container: \"npm:^1.0.0\"\n-    is-wsl: \"npm:^3.1.0\"\n-  checksum: 10c0/1bee796f06e549ce764f693272100323fbc04da8fa3c5b0402d6c2d11b3d76fa0aac0be7535e710015ff035326638e3b9a563f3b0e7ac3266473ed5663caae6d\n+    define-lazy-prop: \"npm:^2.0.0\"\n+    is-docker: \"npm:^2.1.1\"\n+    is-wsl: \"npm:^2.2.0\"\n+  checksum: 10c0/bb6b3a58401dacdb0aad14360626faf3fb7fba4b77816b373495988b724fb48941cad80c1b65d62bb31a17609b2cd91c41a181602caea597ca80dfbcc27e84c9\n   languageName: node\n   linkType: hard\n \n@@ -10685,10 +10647,10 @@ __metadata:\n   linkType: hard\n \n \"rollup-plugin-visualizer@npm:^6.0.0\":\n-  version: 6.0.0\n-  resolution: \"rollup-plugin-visualizer@npm:6.0.0\"\n+  version: 6.0.1\n+  resolution: \"rollup-plugin-visualizer@npm:6.0.1\"\n   dependencies:\n-    open: \"npm:^10.1.2\"\n+    open: \"npm:^8.0.0\"\n     picomatch: \"npm:^4.0.2\"\n     source-map: \"npm:^0.7.4\"\n     yargs: \"npm:^17.5.1\"\n@@ -10702,7 +10664,7 @@ __metadata:\n       optional: true\n   bin:\n     rollup-plugin-visualizer: dist/bin/cli.js\n-  checksum: 10c0/803b7a93692824c31c4eb6595367717591123dbdc6be3402403bba633bb81ccfdbd16827e852af9da03fd7e8211a974717492e4032d14897c37c130f0cb86222\n+  checksum: 10c0/c938224b2027b3f490569c439d400b8fc80a0ad07b58720771b23623efe1efc7eb61f3de4506fb4520ce95ef4ea3c93153c31130559e017606c046c052690d1c\n   languageName: node\n   linkType: hard\n \n@@ -10802,13 +10764,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"run-applescript@npm:^7.0.0\":\n-  version: 7.0.0\n-  resolution: \"run-applescript@npm:7.0.0\"\n-  checksum: 10c0/bd821bbf154b8e6c8ecffeaf0c33cebbb78eb2987476c3f6b420d67ab4c5301faa905dec99ded76ebb3a7042b4e440189ae6d85bbbd3fc6e8d493347ecda8bfe\n-  languageName: node\n-  linkType: hard\n-\n \"run-parallel@npm:^1.1.9\":\n   version: 1.2.0\n   resolution: \"run-parallel@npm:1.2.0\"\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -806,7 +806,7 @@ GEM\n       activerecord (>= 4.0.0)\n       railties (>= 4.0.0)\n     securerandom (0.4.1)\n-    selenium-webdriver (4.32.0)\n+    selenium-webdriver (4.33.0)\n       base64 (~> 0.2)\n       logger (~> 1.4)\n       rexml (~> 3.2, >= 3.2.5)\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis adds support for importing embedded self-quotes, skipping the requirement to fetch a separate approval stamp and making private self-quotes easier to handle.\n\n---\n\nChoice A:\nyarn.lock\n@@ -66,7 +66,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n+\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n   version: 7.26.10\n   resolution: \"@babel/core@npm:7.26.10\"\n   dependencies:\n@@ -211,10 +211,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.24.0, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5\":\n-  version: 7.26.5\n-  resolution: \"@babel/helper-plugin-utils@npm:7.26.5\"\n-  checksum: 10c0/cdaba71d4b891aa6a8dfbe5bac2f94effb13e5fa4c2c487667fdbaa04eae059b78b28d85a885071f45f7205aeb56d16759e1bed9c118b94b16e4720ef1ab0f65\n+\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5, @babel/helper-plugin-utils@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helper-plugin-utils@npm:7.27.1\"\n+  checksum: 10c0/94cf22c81a0c11a09b197b41ab488d416ff62254ce13c57e62912c85700dc2e99e555225787a4099ff6bae7a1812d622c80fbaeda824b79baa10a6c5ac4cf69b\n   languageName: node\n   linkType: hard\n \n@@ -869,25 +869,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-self@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-self@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea362ff94b535c753f560eb1f5e063dc72bbbca17ed58837a949a7b289d5eacc7b0a28296d1932c94429b168d6040cdee5484a59b9e3c021f169e0ee137e6a27\n+  checksum: 10c0/00a4f917b70a608f9aca2fb39aabe04a60aa33165a7e0105fd44b3a8531630eb85bf5572e9f242f51e6ad2fa38c2e7e780902176c863556c58b5ba6f6e164031\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-source@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-source@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea8e3263c0dc51fbc97c156cc647150a757cc56de10781287353d0ce9b2dcd6b6d93d573c0142d7daf5d6fb554c74fa1971ae60764924ea711161d8458739b63\n+  checksum: 10c0/5e67b56c39c4d03e59e03ba80692b24c5a921472079b63af711b1d250fc37c1733a17069b63537f750f3e937ec44a42b1ee6a46cd23b1a0df5163b17f741f7f2\n   languageName: node\n   linkType: hard\n \n@@ -4135,17 +4135,17 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.2.1\n-  resolution: \"@vitejs/plugin-react@npm:4.2.1\"\n+  version: 4.4.1\n+  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n   dependencies:\n-    \"@babel/core\": \"npm:^7.23.5\"\n-    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.23.3\"\n-    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.23.3\"\n+    \"@babel/core\": \"npm:^7.26.10\"\n+    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n+    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n-    react-refresh: \"npm:^0.14.0\"\n+    react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n-    vite: ^4.2.0 || ^5.0.0\n-  checksum: 10c0/de1eec44d703f32e5b58e776328ca20793657fe991835d15b290230b19a2a08be5d31501d424279ae13ecfed28044c117b69d746891c8d9b92c69e8a8907e989\n+    vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n+  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n   languageName: node\n   linkType: hard\n \n@@ -10069,10 +10069,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-refresh@npm:^0.14.0\":\n-  version: 0.14.0\n-  resolution: \"react-refresh@npm:0.14.0\"\n-  checksum: 10c0/b8ae07ad153357d77830928a7f1fc2df837aabefee907fa273ba04c7643f3b860e986f1d4b7ada9b721c8d79b8c24b5b911a314a1a2398b105f1b13d19ea2b8d\n+\"react-refresh@npm:^0.17.0\":\n+  version: 0.17.0\n+  resolution: \"react-refresh@npm:0.17.0\"\n+  checksum: 10c0/002cba940384c9930008c0bce26cac97a9d5682bc623112c2268ba0c155127d9c178a9a5cc2212d560088d60dfd503edd808669a25f9b377f316a32361d0b23c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\napp/helpers/json_ld_helper.rb\n@@ -72,6 +72,18 @@ def non_matching_uri_hosts?(base_url, comparison_url)\n     !haystack.casecmp(needle).zero?\n   end\n \n+  def safe_prefetched_embed(account, object, context)\n+    return unless object.is_a?(Hash)\n+\n+    # NOTE: Replacing the object's context by that of the parent activity is\n+    # not sound, but it's consistent with the rest of the codebase\n+    object = object.merge({ '@context' => context })\n+\n+    return if value_or_id(first_of_value(object['attributedTo'])) != account.uri || non_matching_uri_hosts?(account.uri, object['id'])\n+\n+    object\n+  end\n+\n   def canonicalize(json)\n     graph = RDF::Graph.new << JSON::LD::API.toRdf(json, documentLoader: method(:load_jsonld_context))\n     graph.dump(:normalize)\n---\napp/lib/activitypub/activity/create.rb\n@@ -204,7 +204,9 @@ def attach_quote(status)\n \n     @quote.status = status\n     @quote.save\n-    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, request_id: @options[:request_id])\n+\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, prefetched_quoted_object: embedded_quote, request_id: @options[:request_id])\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n     ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, @quote.id, @quote_uri, { 'request_id' => @options[:request_id] })\n   end\n---\napp/lib/activitypub/parser/status_parser.rb\n@@ -120,6 +120,11 @@ def quote_uri\n     end.first\n   end\n \n+  # The inlined quote; out of the attributes we support, only `https://w3id.org/fep/044f#quote` explicitly supports inlined objects\n+  def quoted_object\n+    as_array(@object['quote']).first\n+  end\n+\n   def quote_approval_uri\n     as_array(@object['quoteAuthorization']).first\n   end\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -273,7 +273,6 @@ def update_emojis!\n   def update_quote!\n     return unless Mastodon::Feature.inbound_quotes_enabled?\n \n-    quote = nil\n     quote_uri = @status_parser.quote_uri\n \n     if quote_uri.present?\n@@ -294,21 +293,23 @@ def update_quote!\n         quote = Quote.create(status: @status, approval_uri: approval_uri)\n         @quote_changed = true\n       end\n-    end\n \n-    if quote.present?\n-      begin\n-        quote.save\n-        ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, request_id: @request_id)\n-      rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n-        ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n-      end\n+      quote.save\n+\n+      fetch_and_verify_quote!(quote, quote_uri)\n     elsif @status.quote.present?\n       @status.quote.destroy!\n       @quote_changed = true\n     end\n   end\n \n+  def fetch_and_verify_quote!(quote, quote_uri)\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @activity_json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, prefetched_quoted_object: embedded_quote, request_id: @request_id)\n+  rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n+    ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n+  end\n+\n   def update_counts!\n     likes = @status_parser.favourites_count\n     shares =  @status_parser.reblogs_count\n---\napp/services/activitypub/verify_quote_service.rb\n@@ -4,15 +4,15 @@ class ActivityPub::VerifyQuoteService < BaseService\n   include JsonLdHelper\n \n   # Optionally fetch quoted post, and verify the quote is authorized\n-  def call(quote, fetchable_quoted_uri: nil, prefetched_body: nil, request_id: nil)\n+  def call(quote, fetchable_quoted_uri: nil, prefetched_quoted_object: nil, prefetched_approval: nil, request_id: nil)\n     @request_id = request_id\n     @quote = quote\n     @fetching_error = nil\n \n-    fetch_quoted_post_if_needed!(fetchable_quoted_uri)\n+    fetch_quoted_post_if_needed!(fetchable_quoted_uri, prefetched_body: prefetched_quoted_object)\n     return if fast_track_approval! || quote.approval_uri.blank?\n \n-    @json = fetch_approval_object(quote.approval_uri, prefetched_body:)\n+    @json = fetch_approval_object(quote.approval_uri, prefetched_body: prefetched_approval)\n     return quote.reject! if @json.nil?\n \n     return if non_matching_uri_hosts?(quote.approval_uri, value_or_id(@json['attributedTo']))\n@@ -68,11 +68,11 @@ def matching_quote_uri?\n     ActivityPub::TagManager.instance.uri_for(@quote.status) == value_or_id(@json['interactingObject'])\n   end\n \n-  def fetch_quoted_post_if_needed!(uri)\n+  def fetch_quoted_post_if_needed!(uri, prefetched_body: nil)\n     return if uri.nil? || @quote.quoted_status.present?\n \n     status = ActivityPub::TagManager.instance.uri_to_resource(uri, Status)\n-    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, request_id: @request_id)\n+    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, prefetched_body:, request_id: @request_id)\n \n     @quote.update(quoted_status: status) if status.present?\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS => e\n---\nspec/services/activitypub/verify_quote_service_spec.rb\n@@ -89,6 +89,37 @@\n       end\n     end\n \n+    context 'with a valid activity for a post that cannot be fetched but is passed as fetched_quoted_object' do\n+      let(:quoted_status) { nil }\n+\n+      let(:approval_interaction_target) { 'https://b.example.com/unknown-quoted' }\n+      let(:prefetched_object) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          type: 'Note',\n+          id: 'https://b.example.com/unknown-quoted',\n+          to: 'https://www.w3.org/ns/activitystreams#Public',\n+          attributedTo: ActivityPub::TagManager.instance.uri_for(quoted_account),\n+          content: 'previously unknown post',\n+        }.with_indifferent_access\n+      end\n+\n+      before do\n+        stub_request(:get, 'https://b.example.com/unknown-quoted')\n+          .to_return(status: 404)\n+      end\n+\n+      it 'updates the status' do\n+        expect { subject.call(quote, fetchable_quoted_uri: 'https://b.example.com/unknown-quoted', prefetched_quoted_object: prefetched_object) }\n+          .to change(quote, :state).to('accepted')\n+\n+        expect(a_request(:get, approval_uri))\n+          .to have_been_made.once\n+\n+        expect(quote.reload.quoted_status.content).to eq 'previously unknown post'\n+      end\n+    end\n+\n     context 'with a valid activity for a post that cannot be fetched but is inlined' do\n       let(:quoted_status) { nil }\n \n@@ -148,7 +179,7 @@\n \n     context 'with a valid activity for already-fetched posts, with a pre-fetched approval' do\n       it 'updates the status without fetching the activity' do\n-        expect { subject.call(quote, prefetched_body: Oj.dump(json)) }\n+        expect { subject.call(quote, prefetched_approval: Oj.dump(json)) }\n           .to change(quote, :state).to('accepted')\n \n         expect(a_request(:get, approval_uri))\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n-  version: 2.8.1\n-  resolution: \"pg-connection-string@npm:2.8.1\"\n-  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n+  version: 2.8.5\n+  resolution: \"pg-connection-string@npm:2.8.5\"\n+  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\napp/models/web/push_subscription.rb\n@@ -12,13 +12,13 @@\n #  standard        :boolean          default(FALSE), not null\n #  created_at      :datetime         not null\n #  updated_at      :datetime         not null\n-#  access_token_id :bigint(8)\n-#  user_id         :bigint(8)\n+#  access_token_id :bigint(8)        not null\n+#  user_id         :bigint(8)        not null\n #\n \n class Web::PushSubscription < ApplicationRecord\n-  belongs_to :user, optional: true\n-  belongs_to :access_token, class_name: 'Doorkeeper::AccessToken', optional: true\n+  belongs_to :user\n+  belongs_to :access_token, class_name: 'Doorkeeper::AccessToken'\n \n   has_one :session_activation, foreign_key: 'web_push_subscription_id', inverse_of: :web_push_subscription, dependent: nil\n \n@@ -28,32 +28,16 @@ class Web::PushSubscription < ApplicationRecord\n \n   validates_with WebPushKeyValidator\n \n-  delegate :locale, to: :associated_user\n+  delegate :locale, to: :user\n \n   generates_token_for :unsubscribe, expires_in: Web::PushNotificationWorker::TTL\n \n   def pushable?(notification)\n     policy_allows_notification?(notification) && alert_enabled_for_notification_type?(notification)\n   end\n \n-  def associated_user\n-    return @associated_user if defined?(@associated_user)\n-\n-    @associated_user = if user_id.nil?\n-                         session_activation.user\n-                       else\n-                         user\n-                       end\n-  end\n-\n   def associated_access_token\n-    return @associated_access_token if defined?(@associated_access_token)\n-\n-    @associated_access_token = if access_token_id.nil?\n-                                 find_or_create_access_token.token\n-                               else\n-                                 access_token.token\n-                               end\n+    access_token.token\n   end\n \n   class << self\n@@ -65,16 +49,6 @@ def unsubscribe_for(application_id, resource_owner)\n \n   private\n \n-  def find_or_create_access_token\n-    Doorkeeper::AccessToken.find_or_create_for(\n-      application: Doorkeeper::Application.find_by(superapp: true),\n-      resource_owner: user_id || session_activation.user_id,\n-      scopes: Doorkeeper::OAuth::Scopes.from_string('read write follow push'),\n-      expires_in: Doorkeeper.configuration.access_token_expires_in,\n-      use_refresh_token: Doorkeeper.configuration.refresh_token_enabled?\n-    )\n-  end\n-\n   def alert_enabled_for_notification_type?(notification)\n     truthy?(data&.dig('alerts', notification.type.to_s))\n   end\n---\napp/serializers/web/notification_serializer.rb\n@@ -13,7 +13,7 @@ def access_token\n   end\n \n   def preferred_locale\n-    current_push_subscription.associated_user&.locale || I18n.default_locale\n+    current_push_subscription.user&.locale || I18n.default_locale\n   end\n \n   def notification_id\n---\ndb/migrate/20250422083912_add_not_null_to_web_push_subscription_user.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddNotNullToWebPushSubscriptionUser < ActiveRecord::Migration[8.0]\n+  def change\n+    add_check_constraint :web_push_subscriptions, 'user_id IS NOT NULL', name: 'web_push_subscriptions_user_id_null', validate: false\n+  end\n+end\n---\ndb/migrate/20250422084214_validate_add_not_null_to_web_push_subscription_user.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ValidateAddNotNullToWebPushSubscriptionUser < ActiveRecord::Migration[8.0]\n+  def up\n+    connection.execute(<<~SQL.squish)\n+      DELETE FROM web_push_subscriptions\n+      WHERE user_id IS NULL\n+    SQL\n+\n+    validate_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_user_id_null'\n+    change_column_null :web_push_subscriptions, :user_id, false\n+    remove_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_user_id_null'\n+  end\n+\n+  def down\n+    add_check_constraint :web_push_subscriptions, 'user_id IS NOT NULL', name: 'web_push_subscriptions_user_id_null', validate: false\n+    change_column_null :web_push_subscriptions, :user_id, true\n+  end\n+end\n---\ndb/migrate/20250422085027_add_not_null_to_web_push_subscription_access_token.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddNotNullToWebPushSubscriptionAccessToken < ActiveRecord::Migration[8.0]\n+  def change\n+    add_check_constraint :web_push_subscriptions, 'access_token_id IS NOT NULL', name: 'web_push_subscriptions_access_token_id_null', validate: false\n+  end\n+end\n---\ndb/migrate/20250422085303_validate_add_not_null_to_web_push_subscription_access_token.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ValidateAddNotNullToWebPushSubscriptionAccessToken < ActiveRecord::Migration[8.0]\n+  def up\n+    connection.execute(<<~SQL.squish)\n+      DELETE FROM web_push_subscriptions\n+      WHERE access_token_id IS NULL\n+    SQL\n+\n+    validate_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_access_token_id_null'\n+    change_column_null :web_push_subscriptions, :access_token_id, false\n+    remove_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_access_token_id_null'\n+  end\n+\n+  def down\n+    add_check_constraint :web_push_subscriptions, 'access_token_id IS NOT NULL', name: 'web_push_subscriptions_access_token_id_null', validate: false\n+    change_column_null :web_push_subscriptions, :access_token_id, true\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_11_095859) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_22_085303) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -1237,8 +1237,8 @@\n     t.json \"data\"\n     t.datetime \"created_at\", precision: nil, null: false\n     t.datetime \"updated_at\", precision: nil, null: false\n-    t.bigint \"access_token_id\"\n-    t.bigint \"user_id\"\n+    t.bigint \"access_token_id\", null: false\n+    t.bigint \"user_id\", null: false\n     t.boolean \"standard\", default: false, null: false\n     t.index [\"access_token_id\"], name: \"index_web_push_subscriptions_on_access_token_id\", where: \"(access_token_id IS NOT NULL)\"\n     t.index [\"user_id\"], name: \"index_web_push_subscriptions_on_user_id\"\n---\nspec/fabricators/web_push_subscription_fabricator.rb\n@@ -8,4 +8,6 @@\n     Base64.urlsafe_encode64(ecdh_key)\n   end\n   key_auth { Base64.urlsafe_encode64(Random.new.bytes(16)) }\n+  user { Fabricate(:user) }\n+  access_token { |attrs| Fabricate.build(:accessible_access_token, resource_owner_id: attrs[:user].id) }\n end\n---\nspec/requests/api/v1/push/subscriptions_spec.rb\n@@ -207,7 +207,8 @@ def create_subscription_with_token\n     Fabricate(\n       :web_push_subscription,\n       endpoint: create_payload[:subscription][:endpoint],\n-      access_token_id: token.id\n+      access_token: token,\n+      user: user\n     )\n   end\n end\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nWill need to be backported, and will need to be updated to `abort` when actually dropping support for `REDIS_NAMESPACE` before 4.4.0 release.\n\n---\n\nChoice A:\nconfig/initializers/deprecations.rb\n@@ -0,0 +1,16 @@\n+# frozen_string_literal: true\n+\n+if ENV['REDIS_NAMESPACE']\n+  es_configured = ENV['ES_ENABLED'] == 'true' || ENV.fetch('ES_HOST', 'localhost') != 'localhost' || ENV.fetch('ES_PORT', '9200') != '9200' || ENV.fetch('ES_PASS', 'password') != 'password'\n+\n+  warn <<~MESSAGE\n+    WARNING: the REDIS_NAMESPACE environment variable is deprecated and will be removed in Mastodon 4.4.0.\n+\n+    Please see documentation at https://github.com/mastodon/redis_namespace_migration\n+  MESSAGE\n+\n+  warn <<~MESSAGE if es_configured && !ENV['ES_PREFIX']\n+\n+    In addition, as REDIS_NAMESPACE is being used as a prefix for Elasticsearch, please do not forget to set ES_PREFIX to \"#{ENV.fetch('REDIS_NAMESPACE')}\".\n+  MESSAGE\n+end\n---\n\n\n---\n\nChoice B:\napp/javascript/styles/mastodon/components.scss\n@@ -10399,6 +10399,10 @@ noscript {\n       bdi {\n         color: $darker-text-color;\n       }\n+\n+      .account__avatar {\n+        flex: 0 0 auto;\n+      }\n     }\n \n     &__content {\n---\n\n\n---\n\nChoice C:\nconfig/environments/production.rb\n@@ -52,17 +52,14 @@\n     },\n   }\n \n-  # Log to STDOUT by default\n-  config.logger = ActiveSupport::Logger.new($stdout)\n-                                       .tap  { |logger| logger.formatter = ::Logger::Formatter.new }\n-                                       .then { |logger| ActiveSupport::TaggedLogging.new(logger) }\n+  # Use default logging formatter so that PID and timestamp are not suppressed.\n+  config.log_formatter = Logger::Formatter.new\n \n-  # Prepend all log lines with the following tags.\n+  # Log to STDOUT with the current request id as a default log tag.\n   config.log_tags = [:request_id]\n+  config.logger = ActiveSupport::TaggedLogging.logger($stdout, formatter: config.log_formatter)\n \n-  # \"info\" includes generic and useful information about system operation, but avoids logging too much\n-  # information to avoid inadvertent exposure of personally identifiable information (PII). If you\n-  # want to log everything, set the level to \"debug\".\n+  # Change to \"debug\" to log everything (including potentially personally-identifiable information!)\n   config.log_level = ENV.fetch('RAILS_LOG_LEVEL', 'info')\n \n   # Use a different cache store in production.\n@@ -90,9 +87,6 @@\n   # Don't log any deprecations.\n   config.active_support.report_deprecations = false\n \n-  # Use default logging formatter so that PID and timestamp are not suppressed.\n-  config.log_formatter = ::Logger::Formatter.new\n-\n   # Better log formatting\n   config.lograge.enabled = true\n \n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -469,7 +469,7 @@ GEM\n     omniauth-rails_csrf_protection (1.0.2)\n       actionpack (>= 4.2)\n       omniauth (~> 2.0)\n-    omniauth-saml (2.2.3)\n+    omniauth-saml (2.2.4)\n       omniauth (~> 2.1)\n       ruby-saml (~> 1.18)\n     omniauth_openid_connect (0.8.0)\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [core-js](https://redirect.github.com/zloirock/core-js) ([source](https://redirect.github.com/zloirock/core-js/tree/HEAD/packages/core-js)) | [`3.41.0` -> `3.42.0`](https://renovatebot.com/diffs/npm/core-js/3.41.0/3.42.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/core-js/3.42.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/core-js/3.42.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/core-js/3.41.0/3.42.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/core-js/3.41.0/3.42.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>zloirock/core-js (core-js)</summary>\n\n### [`v3.42.0`](https://redirect.github.com/zloirock/core-js/blob/HEAD/CHANGELOG.md#3420---20250430)\n\n[Compare Source](https://redirect.github.com/zloirock/core-js/compare/v3.41.0...v3.42.0)\n\n-   Changes [v3.41.0...v3.42.0](https://redirect.github.com/zloirock/core-js/compare/v3.41.0...v3.42.0) (142 commits)\n-   [`Map` upsert proposal](https://redirect.github.com/tc39/proposal-upsert):\n    -   Moved to stage 2.7, [April 2025 TC39 meeting](https://x.com/robpalmer2/status/1911882240109261148)\n    -   Validation order of `WeakMap.prototype.getOrInsertComputed` updated following [tc39/proposal-upsert#79](https://redirect.github.com/tc39/proposal-upsert/pull/79)\n    -   Built-ins:\n        -   `Map.prototype.getOrInsert`\n        -   `Map.prototype.getOrInsertComputed`\n        -   `WeakMap.prototype.getOrInsert`\n        -   `WeakMap.prototype.getOrInsertComputed`\n-   Don't call well-known `Symbol` methods for `RegExp` on primitive values following [tc39/ecma262#3009](https://redirect.github.com/tc39/ecma262/pull/3009):\n    -   For avoid performance regression, temporarily, only in own `core-js` implementations\n    -   Built-ins:\n        -   `String.prototype.matchAll`\n        -   `String.prototype.match`\n        -   `String.prototype.replaceAll`\n        -   `String.prototype.replace`\n        -   `String.prototype.search`\n        -   `String.prototype.split`\n-   Added workaround for the [`Uint8Array.prototype.setFromBase64`](https://redirect.github.com/tc39/proposal-arraybuffer-base64) [bug](https://bugs.webkit.org/show_bug.cgi?id=290829) in some of Linux builds of WebKit\n-   Implemented early-error iterator closing following [tc39/ecma262#3467](https://redirect.github.com/tc39/ecma262/pull/3467), including fix of [a WebKit bug](https://bugs.webkit.org/show_bug.cgi?id=291195), in the following methods:\n    -   `Iterator.prototype.drop`\n    -   `Iterator.prototype.every`\n    -   `Iterator.prototype.filter`\n    -   `Iterator.prototype.find`\n    -   `Iterator.prototype.flatMap`\n    -   `Iterator.prototype.forEach`\n    -   `Iterator.prototype.map`\n    -   `Iterator.prototype.reduce`\n    -   `Iterator.prototype.some`\n    -   `Iterator.prototype.take`\n-   Fixed missing forced replacement of [`AsyncIterator` helpers](https://redirect.github.com/tc39/proposal-async-iterator-helpers)\n-   Added closing of sync iterator when async wrapper yields a rejection following [tc39/ecma262#2600](https://redirect.github.com/tc39/ecma262/pull/2600). Affected methods:\n    -   [`Array.fromAsync`](https://redirect.github.com/tc39/proposal-array-from-async) (due to the lack of async feature detection capability - temporarily, only in own `core-js` implementation)\n    -   [`AsyncIterator.from`](https://redirect.github.com/tc39/proposal-async-iterator-helpers)\n    -   [`Iterator.prototype.toAsync`](https://redirect.github.com/tc39/proposal-async-iterator-helpers)\n-   Added detection for throwing on `undefined` initial parameter in `Iterator.prototype.reduce` (see [WebKit bug](https://bugs.webkit.org/show_bug.cgi?id=291651))\n-   `core-js-compat` and `core-js-builder` API:\n    -   Added `'intersect'` support for `targets.esmodules` (Babel 7 behavior)\n    -   Fixed handling of `targets.esmodules: true` (Babel 7 behavior)\n-   Compat data improvements:\n    -   [Explicit Resource Management](https://redirect.github.com/tc39/proposal-explicit-resource-management) features disabled (again) in V8 ~ Chromium 135 and re-added in 136\n    -   [`RegExp.escape`](https://redirect.github.com/tc39/proposal-regex-escaping) marked as [shipped from V8 ~ Chromium 136](https://issues.chromium.org/issues/353856236#comment17)\n    -   [`Error.isError`](https://redirect.github.com/tc39/proposal-is-error) marked as [shipped from FF138](https://bugzilla.mozilla.org/show_bug.cgi?id=1952249)\n    -   [Explicit Resource Management](https://redirect.github.com/tc39/proposal-explicit-resource-management) features re-enabled in [Deno 2.2.10](https://redirect.github.com/denoland/deno/releases/tag/v2.2.10)\n    -   [`Iterator` helpers proposal](https://redirect.github.com/tc39/proposal-iterator-helpers) features marked as supported from Deno 1.38.1 since it seems they were disabled in 1.38.0\n    -   `Iterator.prototype.{ drop, reduce, take }` methods marked as fixed in Bun 1.2.11\n    -   Added [NodeJS 24.0](https://redirect.github.com/nodejs/node/pull/57609) compat data mapping\n    -   Updated Electron 36 and added Electron 37 compat data mapping\n    -   Added Opera Android [88](https://forums.opera.com/topic/83800/opera-for-android-88) and [89](https://forums.opera.com/topic/84437/opera-for-android-89) compat data mapping\n    -   Added Oculus Quest Browser 37 compat data mapping\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNTcuMyIsInVwZGF0ZWRJblZlciI6IjM5LjI1Ny4zIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\npackage.json\n@@ -99,7 +99,7 @@\n     \"redux-immutable\": \"^4.0.0\",\n     \"regenerator-runtime\": \"^0.14.0\",\n     \"requestidlecallback\": \"^0.3.0\",\n-    \"rollup-plugin-visualizer\": \"^5.14.0\",\n+    \"rollup-plugin-visualizer\": \"^6.0.0\",\n     \"sass\": \"^1.62.1\",\n     \"stacktrace-js\": \"^2.0.2\",\n     \"stringz\": \"^2.1.0\",\n---\nyarn.lock\n@@ -2554,7 +2554,7 @@ __metadata:\n     redux-immutable: \"npm:^4.0.0\"\n     regenerator-runtime: \"npm:^0.14.0\"\n     requestidlecallback: \"npm:^0.3.0\"\n-    rollup-plugin-visualizer: \"npm:^5.14.0\"\n+    rollup-plugin-visualizer: \"npm:^6.0.0\"\n     sass: \"npm:^1.62.1\"\n     stacktrace-js: \"npm:^2.0.2\"\n     stringz: \"npm:^2.1.0\"\n@@ -4887,6 +4887,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"bundle-name@npm:^4.1.0\":\n+  version: 4.1.0\n+  resolution: \"bundle-name@npm:4.1.0\"\n+  dependencies:\n+    run-applescript: \"npm:^7.0.0\"\n+  checksum: 10c0/8e575981e79c2bcf14d8b1c027a3775c095d362d1382312f444a7c861b0e21513c0bd8db5bd2b16e50ba0709fa622d4eab6b53192d222120305e68359daece29\n+  languageName: node\n+  linkType: hard\n+\n \"bytes@npm:3.1.2\":\n   version: 3.1.2\n   resolution: \"bytes@npm:3.1.2\"\n@@ -5535,6 +5544,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"default-browser-id@npm:^5.0.0\":\n+  version: 5.0.0\n+  resolution: \"default-browser-id@npm:5.0.0\"\n+  checksum: 10c0/957fb886502594c8e645e812dfe93dba30ed82e8460d20ce39c53c5b0f3e2afb6ceaec2249083b90bdfbb4cb0f34e1f73fde3d68cac00becdbcfd894156b5ead\n+  languageName: node\n+  linkType: hard\n+\n+\"default-browser@npm:^5.2.1\":\n+  version: 5.2.1\n+  resolution: \"default-browser@npm:5.2.1\"\n+  dependencies:\n+    bundle-name: \"npm:^4.1.0\"\n+    default-browser-id: \"npm:^5.0.0\"\n+  checksum: 10c0/73f17dc3c58026c55bb5538749597db31f9561c0193cd98604144b704a981c95a466f8ecc3c2db63d8bfd04fb0d426904834cfc91ae510c6aeb97e13c5167c4d\n+  languageName: node\n+  linkType: hard\n+\n \"define-data-property@npm:^1.0.1, define-data-property@npm:^1.1.4\":\n   version: 1.1.4\n   resolution: \"define-data-property@npm:1.1.4\"\n@@ -5546,10 +5572,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"define-lazy-prop@npm:^2.0.0\":\n-  version: 2.0.0\n-  resolution: \"define-lazy-prop@npm:2.0.0\"\n-  checksum: 10c0/db6c63864a9d3b7dc9def55d52764968a5af296de87c1b2cc71d8be8142e445208071953649e0386a8cc37cfcf9a2067a47207f1eb9ff250c2a269658fdae422\n+\"define-lazy-prop@npm:^3.0.0\":\n+  version: 3.0.0\n+  resolution: \"define-lazy-prop@npm:3.0.0\"\n+  checksum: 10c0/5ab0b2bf3fa58b3a443140bbd4cd3db1f91b985cc8a246d330b9ac3fc0b6a325a6d82bddc0b055123d745b3f9931afeea74a5ec545439a1630b9c8512b0eeb49\n   languageName: node\n   linkType: hard\n \n@@ -7506,12 +7532,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-docker@npm:^2.0.0, is-docker@npm:^2.1.1\":\n-  version: 2.2.1\n-  resolution: \"is-docker@npm:2.2.1\"\n+\"is-docker@npm:^3.0.0\":\n+  version: 3.0.0\n+  resolution: \"is-docker@npm:3.0.0\"\n   bin:\n     is-docker: cli.js\n-  checksum: 10c0/e828365958d155f90c409cdbe958f64051d99e8aedc2c8c4cd7c89dcf35329daed42f7b99346f7828df013e27deb8f721cf9408ba878c76eb9e8290235fbcdcc\n+  checksum: 10c0/d2c4f8e6d3e34df75a5defd44991b6068afad4835bb783b902fa12d13ebdb8f41b2a199dcb0b5ed2cb78bfee9e4c0bbdb69c2d9646f4106464674d3e697a5856\n   languageName: node\n   linkType: hard\n \n@@ -7572,6 +7598,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"is-inside-container@npm:^1.0.0\":\n+  version: 1.0.0\n+  resolution: \"is-inside-container@npm:1.0.0\"\n+  dependencies:\n+    is-docker: \"npm:^3.0.0\"\n+  bin:\n+    is-inside-container: cli.js\n+  checksum: 10c0/a8efb0e84f6197e6ff5c64c52890fa9acb49b7b74fed4da7c95383965da6f0fa592b4dbd5e38a79f87fc108196937acdbcd758fcefc9b140e479b39ce1fcd1cd\n+  languageName: node\n+  linkType: hard\n+\n \"is-lambda@npm:^1.0.1\":\n   version: 1.0.1\n   resolution: \"is-lambda@npm:1.0.1\"\n@@ -7736,12 +7773,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-wsl@npm:^2.2.0\":\n-  version: 2.2.0\n-  resolution: \"is-wsl@npm:2.2.0\"\n+\"is-wsl@npm:^3.1.0\":\n+  version: 3.1.0\n+  resolution: \"is-wsl@npm:3.1.0\"\n   dependencies:\n-    is-docker: \"npm:^2.0.0\"\n-  checksum: 10c0/a6fa2d370d21be487c0165c7a440d567274fbba1a817f2f0bfa41cc5e3af25041d84267baa22df66696956038a43973e72fca117918c91431920bdef490fa25e\n+    is-inside-container: \"npm:^1.0.0\"\n+  checksum: 10c0/d3317c11995690a32c362100225e22ba793678fe8732660c6de511ae71a0ff05b06980cf21f98a6bf40d7be0e9e9506f859abe00a1118287d63e53d0a3d06947\n   languageName: node\n   linkType: hard\n \n@@ -8841,14 +8878,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"open@npm:^8.4.0\":\n-  version: 8.4.2\n-  resolution: \"open@npm:8.4.2\"\n+\"open@npm:^10.1.2\":\n+  version: 10.1.2\n+  resolution: \"open@npm:10.1.2\"\n   dependencies:\n-    define-lazy-prop: \"npm:^2.0.0\"\n-    is-docker: \"npm:^2.1.1\"\n-    is-wsl: \"npm:^2.2.0\"\n-  checksum: 10c0/bb6b3a58401dacdb0aad14360626faf3fb7fba4b77816b373495988b724fb48941cad80c1b65d62bb31a17609b2cd91c41a181602caea597ca80dfbcc27e84c9\n+    default-browser: \"npm:^5.2.1\"\n+    define-lazy-prop: \"npm:^3.0.0\"\n+    is-inside-container: \"npm:^1.0.0\"\n+    is-wsl: \"npm:^3.1.0\"\n+  checksum: 10c0/1bee796f06e549ce764f693272100323fbc04da8fa3c5b0402d6c2d11b3d76fa0aac0be7535e710015ff035326638e3b9a563f3b0e7ac3266473ed5663caae6d\n   languageName: node\n   linkType: hard\n \n@@ -10647,11 +10685,11 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"rollup-plugin-visualizer@npm:^5.14.0\":\n-  version: 5.14.0\n-  resolution: \"rollup-plugin-visualizer@npm:5.14.0\"\n+\"rollup-plugin-visualizer@npm:^6.0.0\":\n+  version: 6.0.0\n+  resolution: \"rollup-plugin-visualizer@npm:6.0.0\"\n   dependencies:\n-    open: \"npm:^8.4.0\"\n+    open: \"npm:^10.1.2\"\n     picomatch: \"npm:^4.0.2\"\n     source-map: \"npm:^0.7.4\"\n     yargs: \"npm:^17.5.1\"\n@@ -10665,7 +10703,7 @@ __metadata:\n       optional: true\n   bin:\n     rollup-plugin-visualizer: dist/bin/cli.js\n-  checksum: 10c0/ec6ca9ed125bce9994ba49a340bda730661d8e8dc5c5dc014dc757185182e1eda49c6708f990cb059095e71a3741a5248f1e6ba0ced7056020692888e06b1ddf\n+  checksum: 10c0/803b7a93692824c31c4eb6595367717591123dbdc6be3402403bba633bb81ccfdbd16827e852af9da03fd7e8211a974717492e4032d14897c37c130f0cb86222\n   languageName: node\n   linkType: hard\n \n@@ -10765,6 +10803,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"run-applescript@npm:^7.0.0\":\n+  version: 7.0.0\n+  resolution: \"run-applescript@npm:7.0.0\"\n+  checksum: 10c0/bd821bbf154b8e6c8ecffeaf0c33cebbb78eb2987476c3f6b420d67ab4c5301faa905dec99ded76ebb3a7042b4e440189ae6d85bbbd3fc6e8d493347ecda8bfe\n+  languageName: node\n+  linkType: hard\n+\n \"run-parallel@npm:^1.1.9\":\n   version: 1.2.0\n   resolution: \"run-parallel@npm:1.2.0\"\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -6678,9 +6678,9 @@ __metadata:\n   linkType: hard\n \n \"core-js@npm:^3.30.2\":\n-  version: 3.41.0\n-  resolution: \"core-js@npm:3.41.0\"\n-  checksum: 10c0/a29ed0b7fe81acf49d04ce5c17a1947166b1c15197327a5d12f95bbe84b46d60c3c13de701d808f41da06fa316285f3f55ce5903abc8d5642afc1eac4457afc8\n+  version: 3.42.0\n+  resolution: \"core-js@npm:3.42.0\"\n+  checksum: 10c0/2913d3d5452d54ad92f058d66046782d608c05e037bcc523aab79c04454fe640998f94e6011292969d66dfa472f398b085ce843dcb362056532a5799c627184e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -1023,7 +1023,7 @@ export const AccountHeader: React.FC<{\n                   />\n                 </NavLink>\n               </div>\n-              <FamiliarFollowers accountId={accountId} />\n+              {signedIn && <FamiliarFollowers accountId={accountId} />}\n             </div>\n           )}\n         </div>\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.222.3', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1088.0)\n+    aws-sdk-core (3.222.2)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -931,7 +933,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.222.3)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nAdditionally, add `configuration.limited_federation` to indicate whether the server has switched to limited federation.\r\n\r\nAlso sets `usage.users.active_month` to `0` in limited federation mode.\r\n\r\n---\r\n\r\nFixes MAS-389\n\n---\n\nChoice A:\n.rubocop_todo.yml\n@@ -27,10 +27,6 @@ Metrics/CyclomaticComplexity:\n Metrics/PerceivedComplexity:\n   Max: 27\n \n-Rails/OutputSafety:\n-  Exclude:\n-    - 'config/initializers/simple_form.rb'\n-\n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: AllowedVars.\n Style/FetchEnvVar:\n---\nconfig/initializers/simple_form.rb\n@@ -5,7 +5,7 @@\n module AppendComponent\n   def append(_wrapper_options = nil)\n     @append ||= begin\n-      options[:append].to_s.html_safe if options[:append].present?\n+      options[:append].to_s.html_safe if options[:append].present? # rubocop:disable Rails/OutputSafety\n     end\n   end\n end\n@@ -24,7 +24,7 @@ def recommended(_wrapper_options = nil)\n module WarningHintComponent\n   def warning_hint(_wrapper_options = nil)\n     @warning_hint ||= begin\n-      options[:warning_hint].to_s.html_safe if options[:warning_hint].present?\n+      options[:warning_hint].to_s.html_safe if options[:warning_hint].present? # rubocop:disable Rails/OutputSafety\n     end\n   end\n end\n---\n\n\n---\n\nChoice B:\napp/controllers/api/base_controller.rb\n@@ -50,6 +50,10 @@ def current_user\n     nil\n   end\n \n+  def require_client_credentials!\n+    render json: { error: 'This method requires an client credentials authentication' }, status: 403 if doorkeeper_token.resource_owner_id.present?\n+  end\n+\n   def require_authenticated_user!\n     render json: { error: 'This method requires an authenticated user' }, status: 401 unless current_user\n   end\n---\napp/controllers/api/v1/accounts_controller.rb\n@@ -10,6 +10,7 @@ class Api::V1::AccountsController < Api::BaseController\n   before_action -> { doorkeeper_authorize! :write, :'write:accounts' }, only: [:create]\n \n   before_action :require_user!, except: [:index, :show, :create]\n+  before_action :require_client_credentials!, only: [:create]\n   before_action :set_account, except: [:index, :create]\n   before_action :set_accounts, only: [:index]\n   before_action :check_account_approval, except: [:index, :create]\n---\nspec/fabricators/client_credentials_token_fabricator.rb\n@@ -0,0 +1,5 @@\n+# frozen_string_literal: true\n+\n+Fabricator :client_credentials_token, from: :accessible_access_token do\n+  resource_owner_id { nil }\n+end\n---\nspec/requests/api/v1/accounts_spec.rb\n@@ -78,10 +78,27 @@\n     end\n \n     let(:client_app) { Fabricate(:application) }\n-    let(:token) { Doorkeeper::AccessToken.find_or_create_for(application: client_app, resource_owner: nil, scopes: 'read write', use_refresh_token: false) }\n+    let(:token) { Fabricate(:client_credentials_token, application: client_app, scopes: 'read write') }\n     let(:agreement) { nil }\n     let(:date_of_birth) { nil }\n \n+    context 'when not using client credentials token' do\n+      let(:token) { Fabricate(:accessible_access_token, application: client_app, scopes: 'read write', resource_owner_id: user.id) }\n+\n+      it 'returns http forbidden error' do\n+        subject\n+\n+        expect(response).to have_http_status(403)\n+        expect(response.content_type)\n+          .to start_with('application/json')\n+\n+        expect(response.parsed_body)\n+          .to include(\n+            error: 'This method requires an client credentials authentication'\n+          )\n+      end\n+    end\n+\n     context 'when age verification is enabled' do\n       before do\n         Setting.min_age = 16\n---\n\n\n---\n\nChoice C:\napp/controllers/api/v2/instances_controller.rb\n@@ -1,7 +1,7 @@\n # frozen_string_literal: true\n \n class Api::V2::InstancesController < Api::BaseController\n-  skip_before_action :require_authenticated_user!, unless: :limited_federation_mode?\n+  skip_before_action :require_authenticated_user!\n   skip_around_action :set_locale\n \n   vary_by ''\n---\napp/serializers/rest/instance_serializer.rb\n@@ -49,7 +49,7 @@ def icon\n   def usage\n     {\n       users: {\n-        active_month: object.active_user_count(4),\n+        active_month: limited_federation? ? 0 : object.active_user_count(4),\n       },\n     }\n   end\n@@ -99,6 +99,8 @@ def configuration\n       translation: {\n         enabled: TranslationService.configured?,\n       },\n+\n+      limited_federation: limited_federation?,\n     }\n   end\n \n@@ -127,6 +129,10 @@ def registrations_message\n     markdown.render(Setting.closed_registrations_message) if Setting.closed_registrations_message.present?\n   end\n \n+  def limited_federation?\n+    Rails.configuration.x.limited_federation_mode\n+  end\n+\n   def markdown\n     @markdown ||= Redcarpet::Markdown.new(Redcarpet::Render::HTML, no_images: true)\n   end\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/selectors/contexts.ts\n@@ -41,7 +41,7 @@ export const getDescendantsIds = createAppSelector(\n       }\n \n       if (replies) {\n-        replies.reverse().forEach((replyId) => {\n+        replies.toReversed().forEach((replyId) => {\n           if (\n             !visitIds.includes(replyId) &&\n             !descendantsIds.includes(replyId) &&\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nWe do not use these attributes in outgoing messages yet, but we need to know about them when compacting JSON-LD to our contexts.\r\n\r\nThis is in essence a bugfix for #34479, and will need to be backported to stable branches to keep forwarding LD-Signed activities making use of these attributes.\n\n---\n\nChoice A:\neslint.config.mjs\n@@ -1,5 +1,7 @@\n // @ts-check\n \n+import path from 'node:path';\n+\n import js from '@eslint/js';\n import { globalIgnores } from 'eslint/config';\n import formatjs from 'eslint-plugin-formatjs';\n@@ -204,7 +206,9 @@ export default tseslint.config([\n       'import/ignore': ['node_modules', '\\\\.(css|scss|json)$'],\n \n       'import/resolver': {\n-        typescript: {},\n+        typescript: {\n+          project: path.resolve(import.meta.dirname, './tsconfig.json'),\n+        },\n       },\n     },\n \n---\nstreaming/eslint.config.mjs\n@@ -1,5 +1,7 @@\n // @ts-check\n \n+import path from 'node:path';\n+\n import globals from 'globals';\n import tseslint from 'typescript-eslint';\n \n@@ -20,7 +22,9 @@ export default tseslint.config([\n     settings: {\n       'import/ignore': ['node_modules', '\\\\.(json)$'],\n       'import/resolver': {\n-        typescript: {},\n+        typescript: {\n+          project: path.resolve(import.meta.dirname, './tsconfig.json'),\n+        },\n       },\n     },\n \n---\n\n\n---\n\nChoice B:\napp/lib/status_filter.rb\n@@ -38,7 +38,7 @@ def muting_account?\n   end\n \n   def silenced_account?\n-    !account&.silenced? && status_account_silenced? && !account_following_status_account?\n+    status_account_silenced? && !account_following_status_account?\n   end\n \n   def status_account_silenced?\n---\n\n\n---\n\nChoice C:\nlib/mastodon/cli/search.rb\n@@ -20,6 +20,7 @@ class Search < Base\n     option :import, type: :boolean, default: true, desc: 'Import data from the database to the index'\n     option :clean, type: :boolean, default: true, desc: 'Remove outdated documents from the index'\n     option :reset_chewy, type: :boolean, default: false, desc: \"Reset Chewy's internal index\"\n+    option :only_mapping, type: :boolean, default: false, desc: 'Update the index specification without re-index'\n     desc 'deploy', 'Create or upgrade Elasticsearch indices and populate them'\n     long_desc <<~LONG_DESC\n       If Elasticsearch is empty, this command will create the necessary indices\n@@ -52,6 +53,20 @@ def deploy\n \n       Chewy::Stash::Specification.reset! if options[:reset_chewy]\n \n+      if options[:only_mapping]\n+        indices.select { |index| index.specification.changed? }.each do |index|\n+          progress.title = \"Updating mapping for #{index} \"\n+          index.update_mapping\n+          index.specification.lock!\n+        end\n+\n+        progress.title = 'Done! '\n+        progress.finish\n+\n+        say('Updated index mappings', :green, true)\n+        return\n+      end\n+\n       # First, ensure all indices are created and have the correct\n       # structure, so that live data can already be written\n       indices.select { |index| index.specification.changed? }.each do |index|\n---\n\n\n---\n\nChoice D:\napp/helpers/context_helper.rb\n@@ -26,6 +26,13 @@ module ContextHelper\n     suspended: { 'toot' => 'http://joinmastodon.org/ns#', 'suspended' => 'toot:suspended' },\n     attribution_domains: { 'toot' => 'http://joinmastodon.org/ns#', 'attributionDomains' => { '@id' => 'toot:attributionDomains', '@type' => '@id' } },\n     quote_requests: { 'QuoteRequest' => 'https://w3id.org/fep/044f#QuoteRequest' },\n+    interaction_policies: {\n+      'gts' => 'https://gotosocial.org/ns#',\n+      'interactionPolicy' => { '@id' => 'gts:interactionPolicy', '@type' => '@id' },\n+      'canQuote' => { '@id' => 'gts:canQuote', '@type' => '@id' },\n+      'automaticApproval' => { '@id' => 'gts:automaticApproval', '@type' => '@id' },\n+      'manualApproval' => { '@id' => 'gts:manualApproval', '@type' => '@id' },\n+    },\n   }.freeze\n \n   def full_context\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFix regression introduced in #34506\r\n\r\nI'm a bit disappointed that this kind of stuff is not caught by Typescript.\n\n---\n\nChoice A:\nGemfile.lock\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.2)\n-    rubocop (1.75.3)\n+    rubocop (1.75.4)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\nChoice B:\napp/models/user.rb\n@@ -73,7 +73,6 @@ class User < ApplicationRecord\n   ACTIVE_DURATION = ENV.fetch('USER_ACTIVE_DAYS', 7).to_i.days.freeze\n \n   devise :two_factor_authenticatable,\n-         otp_secret_encryption_key: Rails.configuration.x.otp_secret,\n          otp_secret_length: 32\n \n   devise :two_factor_backupable,\n---\nconfig/environments/development.rb\n@@ -84,9 +84,6 @@\n   # Otherwise, use letter_opener, which launches a browser window to view sent mail.\n   config.action_mailer.delivery_method = ENV['HEROKU'] || ENV['VAGRANT'] || ENV['REMOTE_DEV'] ? :letter_opener_web : :letter_opener\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = ENV.fetch('OTP_SECRET', '1fc2b87989afa6351912abeebe31ffc5c476ead9bf8b3d74cbc4a302c7b69a45b40b1bbef3506ddad73e942e15ed5ca4b402bf9a66423626051104f4b5f05109')\n-\n   # Raise error when a before_action's only/except options reference missing actions.\n   config.action_controller.raise_on_missing_callback_actions = true\n \n---\n\n\n---\n\nChoice C:\napp/helpers/context_helper.rb\n@@ -26,6 +26,13 @@ module ContextHelper\n     suspended: { 'toot' => 'http://joinmastodon.org/ns#', 'suspended' => 'toot:suspended' },\n     attribution_domains: { 'toot' => 'http://joinmastodon.org/ns#', 'attributionDomains' => { '@id' => 'toot:attributionDomains', '@type' => '@id' } },\n     quote_requests: { 'QuoteRequest' => 'https://w3id.org/fep/044f#QuoteRequest' },\n+    interaction_policies: {\n+      'gts' => 'https://gotosocial.org/ns#',\n+      'interactionPolicy' => { '@id' => 'gts:interactionPolicy', '@type' => '@id' },\n+      'canQuote' => { '@id' => 'gts:canQuote', '@type' => '@id' },\n+      'automaticApproval' => { '@id' => 'gts:automaticApproval', '@type' => '@id' },\n+      'manualApproval' => { '@id' => 'gts:manualApproval', '@type' => '@id' },\n+    },\n   }.freeze\n \n   def full_context\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/selectors/contexts.ts\n@@ -41,7 +41,7 @@ export const getDescendantsIds = createAppSelector(\n       }\n \n       if (replies) {\n-        replies.reverse().forEach((replyId) => {\n+        replies.toReversed().forEach((replyId) => {\n           if (\n             !visitIds.includes(replyId) &&\n             !descendantsIds.includes(replyId) &&\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [aws-sdk-core](https://redirect.github.com/aws/aws-sdk-ruby) ([source](https://redirect.github.com/aws/aws-sdk-ruby/tree/HEAD/gems/aws-sdk-core), [changelog](https://redirect.github.com/aws/aws-sdk-ruby/tree/version-3/gems/aws-sdk-core/CHANGELOG.md)) | `'< 3.216.0'` -> `'< 3.222.4'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/aws-sdk-core/3.222.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/aws-sdk-core/3.222.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/aws-sdk-core/3.215.1/3.222.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/aws-sdk-core/3.215.1/3.222.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>aws/aws-sdk-ruby (aws-sdk-core)</summary>\n\n### [`v3.222.3`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32223-2025-04-28)\n\n-   Issue - Do not dynamically create operation methods from the API. ([#&#8203;3234](https://redirect.github.com/aws/aws-sdk-ruby/issues/3234))\n\n### [`v3.222.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32222-2025-04-16)\n\n-   Issue - Additional metrics collection for credentials in the User-Agent plugin.\n\n### [`v3.222.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32221-2025-03-28)\n\n-   Issue - Allow explicit modeled headers to override prefixed headers for `rest` protocols.\n\n### [`v3.222.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32220-2025-03-27)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - This release adds AwsAdditionalDetails in the CreateTokenWithIAM API response.\n\n### [`v3.221.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32210-2025-03-24)\n\n-   Feature - Add `logger` as an explicit dependency for Ruby 3.5.\n-   Issue - Enable ALPN over TLS for H2 Connection by default.\n-   Issue - Fix HTTP-2 connections to properly use config values configured on the client.\n\n### [`v3.220.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32202-2025-03-20)\n\n-   Issue - Enable ALPN over TLS for H2 by default.\n\n### [`v3.220.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32201-2025-03-06)\n\n-   Issue - Convert stubs at request time.\n\n### [`v3.220.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32200-2025-03-04)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n### [`v3.219.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32190-2025-02-18)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.218.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32181-2025-02-07)\n\n-   Issue - Add handling of block in ExtendedSession delegation ([#&#8203;3178](https://redirect.github.com/aws/aws-sdk-ruby/issues/3178)).\n\n### [`v3.218.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32180-2025-02-06)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.217.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32171-2025-01-30)\n\n-   Issue - Add `transfer-encoding` and `connection` to list of unsigned sigv4 headers.\n\n### [`v3.217.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32170-2025-01-24)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Fixed typos in the descriptions.\n\n### [`v3.216.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32161-2025-01-22)\n\n-   Issue - Use epoch seconds instead of milliseconds in cbor encode/decode.\n\n-   Issue - Add handling of block in response delegation ([#&#8203;3169](https://redirect.github.com/aws/aws-sdk-ruby/issues/3169)).\n\n### [`v3.216.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32160-2025-01-15)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n-   Feature - Always calculate request checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:request_checksum_calculation`, in the shared config file as `request_checksum_calculation`, and in the ENV as `ENV['AWS_REQUEST_CHECKSUM_CALCULATION']`.\n\n-   Feature - Always validate response checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:response_checksum_validation`, in the shared config file as `response_checksum_validation`, and in the ENV as `ENV['AWS_RESPONSE_CHECKSUM_VALIDATION']`.\n\n-   Feature - Support CRC64NVME checksums through the `aws-crt` gem.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNTcuMyIsInVwZGF0ZWRJblZlciI6IjM5LjI1Ny4zIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\napp/javascript/mastodon/locales/en-GB.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Moderated servers\",\n   \"about.contact\": \"Contact:\",\n+  \"about.default_locale\": \"Default\",\n   \"about.disclaimer\": \"Mastodon is free, open-source software, and a trademark of Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Reason not available\",\n   \"about.domain_blocks.preamble\": \"Mastodon generally allows you to view content from and interact with users from any other server in the Fediverse. These are the exceptions that have been made on this particular server.\",\n   \"about.domain_blocks.silenced.explanation\": \"You will generally not see profiles and content from this server, unless you explicitly look it up or opt into it by following.\",\n   \"about.domain_blocks.silenced.title\": \"Limited\",\n   \"about.domain_blocks.suspended.explanation\": \"No data from this server will be processed, stored or exchanged, making any interaction or communication with users from this server impossible.\",\n   \"about.domain_blocks.suspended.title\": \"Suspended\",\n+  \"about.language_label\": \"Language\",\n   \"about.not_available\": \"This information has not been made available on this server.\",\n   \"about.powered_by\": \"Decentralised social media powered by {mastodon}\",\n   \"about.rules\": \"Server rules\",\n@@ -19,10 +21,12 @@\n   \"account.block_domain\": \"Block domain {domain}\",\n   \"account.block_short\": \"Block\",\n   \"account.blocked\": \"Blocked\",\n+  \"account.blocking\": \"Blocking\",\n   \"account.cancel_follow_request\": \"Cancel follow\",\n   \"account.copy\": \"Copy link to profile\",\n   \"account.direct\": \"Privately mention @{name}\",\n   \"account.disable_notifications\": \"Stop notifying me when @{name} posts\",\n+  \"account.domain_blocking\": \"Blocking domain\",\n   \"account.edit_profile\": \"Edit profile\",\n   \"account.enable_notifications\": \"Notify me when @{name} posts\",\n   \"account.endorse\": \"Feature on profile\",\n---\napp/javascript/mastodon/locales/pt-PT.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Servidores moderados\",\n   \"about.contact\": \"Contacto:\",\n+  \"about.default_locale\": \"Padr\u00e3o\",\n   \"about.disclaimer\": \"O Mastodon \u00e9 um software livre, de c\u00f3digo aberto e uma marca registada de Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Motivo n\u00e3o dispon\u00edvel\",\n   \"about.domain_blocks.preamble\": \"O Mastodon geralmente permite ver e interagir com o conte\u00fado de utilizadores de qualquer outra inst\u00e2ncia no fediverso. Estas s\u00e3o as exce\u00e7\u00f5es desta inst\u00e2ncia em espec\u00edfico.\",\n   \"about.domain_blocks.silenced.explanation\": \"Normalmente n\u00e3o ver\u00e1s perfis e conte\u00fados deste servidor, a n\u00e3o ser que os procures explicitamente ou optes por segui-los.\",\n   \"about.domain_blocks.silenced.title\": \"Limitados\",\n   \"about.domain_blocks.suspended.explanation\": \"Nenhum dado deste servidor ser\u00e1 processado, armazenado ou trocado, tornando imposs\u00edvel qualquer intera\u00e7\u00e3o ou comunica\u00e7\u00e3o com os utilizadores a partir deste servidor.\",\n   \"about.domain_blocks.suspended.title\": \"Suspensos\",\n+  \"about.language_label\": \"Idioma\",\n   \"about.not_available\": \"Esta informa\u00e7\u00e3o n\u00e3o foi disponibilizada neste servidor.\",\n   \"about.powered_by\": \"Rede social descentralizada baseada no {mastodon}\",\n   \"about.rules\": \"Regras do servidor\",\n@@ -308,6 +310,8 @@\n   \"emoji_button.search_results\": \"Resultados da pesquisa\",\n   \"emoji_button.symbols\": \"S\u00edmbolos\",\n   \"emoji_button.travel\": \"Viagens e lugares\",\n+  \"empty_column.account_featured.me\": \"Ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n+  \"empty_column.account_featured.other\": \"{acct} ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n   \"empty_column.account_featured_other.unknown\": \"Esta conta ainda n\u00e3o colocou nada em destaque.\",\n   \"empty_column.account_hides_collections\": \"Este utilizador escolheu n\u00e3o disponibilizar esta informa\u00e7\u00e3o\",\n   \"empty_column.account_suspended\": \"Conta suspensa\",\n@@ -341,6 +345,11 @@\n   \"explore.trending_links\": \"Not\u00edcias\",\n   \"explore.trending_statuses\": \"Publica\u00e7\u00f5es\",\n   \"explore.trending_tags\": \"#Etiquetas\",\n+  \"featured_carousel.header\": \"{count, plural, one {Publica\u00e7\u00e3o Afixada} other {Publica\u00e7\u00f5es Afixadas}}\",\n+  \"featured_carousel.next\": \"Seguinte\",\n+  \"featured_carousel.post\": \"Publica\u00e7\u00e3o\",\n+  \"featured_carousel.previous\": \"Anterior\",\n+  \"featured_carousel.slide\": \"{index} de {total}\",\n   \"filter_modal.added.context_mismatch_explanation\": \"Esta categoria de filtro n\u00e3o se aplica ao contexto em que acedeste a esta publica\u00e7\u00e3o. Se pretenderes que esta publica\u00e7\u00e3o seja filtrada tamb\u00e9m neste contexto, ter\u00e1s que editar o filtro.\",\n   \"filter_modal.added.context_mismatch_title\": \"O contexto n\u00e3o coincide!\",\n   \"filter_modal.added.expired_explanation\": \"Esta categoria de filtro expirou, tens de alterar a data de validade para que ele seja aplicado.\",\n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.222.4', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1093.0)\n+    aws-sdk-core (3.222.3)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.222.4)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -13279,14 +13279,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-cloudflare@npm:^1.2.0\":\n-  version: 1.2.0\n-  resolution: \"pg-cloudflare@npm:1.2.0\"\n-  checksum: 10c0/d6f2d032aeab291b17d627b051aae85420aea86a3371895a77b55fec93e3dac05880fbf09e5de33486ad3a2e6d7d56a025a8aa66f0d5883984f9834e4cd6f6a4\n+\"pg-cloudflare@npm:^1.2.5\":\n+  version: 1.2.5\n+  resolution: \"pg-cloudflare@npm:1.2.5\"\n+  checksum: 10c0/48b9105ef027c7b3f57ef88ceaec3634cd82120059bd68273cce06989a1ec547e0b0fbb5d1afdd0711824f409c8b410f9bdec2f6c8034728992d3658c0b36f86\n   languageName: node\n   linkType: hard\n \n-\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n+\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.5\":\n   version: 2.8.5\n   resolution: \"pg-connection-string@npm:2.8.5\"\n   checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n@@ -13307,19 +13307,19 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.9.1\":\n-  version: 3.9.1\n-  resolution: \"pg-pool@npm:3.9.1\"\n+\"pg-pool@npm:^3.9.5\":\n+  version: 3.9.5\n+  resolution: \"pg-pool@npm:3.9.5\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/2bbc0892ab7325486b7d5ad8ade59ec925476666ac3959cb4850814c5334bb2f1344258707f8d0445093b59dd6e94401508cebcee490d4827821549147a2ebd9\n+  checksum: 10c0/ebb36b6a1fd753213263a2e0e73d06ffe9fc93907deceae484c7fe4b464f6e9c41a578eb096b4b6012beec94a5d6e0e47728dfc4425e06d283744aa7432365a4\n   languageName: node\n   linkType: hard\n \n-\"pg-protocol@npm:*, pg-protocol@npm:^1.9.0\":\n-  version: 1.9.0\n-  resolution: \"pg-protocol@npm:1.9.0\"\n-  checksum: 10c0/c37e61d7fafa97f22eabf12de69863f42fdabb3671df9cc2623bd0ffd6bdedc212e7e8460ad2c721c8a08d8477b4f128a923bf2381905d68a23a532ec7517c77\n+\"pg-protocol@npm:*, pg-protocol@npm:^1.9.5\":\n+  version: 1.9.5\n+  resolution: \"pg-protocol@npm:1.9.5\"\n+  checksum: 10c0/5cb3444cf973adadd22ee9ea26bb1674f0d980ef8f9c66d426bbe67fc9cb5f0ca4a204bf7e432b3ab2ab59ac8227f4b18ab3b2e64eaed537e037e916991c7319\n   languageName: node\n   linkType: hard\n \n@@ -13352,13 +13352,13 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.15.1\n-  resolution: \"pg@npm:8.15.1\"\n+  version: 8.15.5\n+  resolution: \"pg@npm:8.15.5\"\n   dependencies:\n-    pg-cloudflare: \"npm:^1.2.0\"\n-    pg-connection-string: \"npm:^2.8.1\"\n-    pg-pool: \"npm:^3.9.1\"\n-    pg-protocol: \"npm:^1.9.0\"\n+    pg-cloudflare: \"npm:^1.2.5\"\n+    pg-connection-string: \"npm:^2.8.5\"\n+    pg-pool: \"npm:^3.9.5\"\n+    pg-protocol: \"npm:^1.9.5\"\n     pg-types: \"npm:^2.1.0\"\n     pgpass: \"npm:1.x\"\n   peerDependencies:\n@@ -13369,7 +13369,7 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/c6e5fd9cd6af7fc3208e48f860fd9ec9f7bc20192e449b0b36b096a9d5889de50706c705f6996e51a765bd4b7331179d7ffb43528a141bb996ee6f2c8f994c9a\n+  checksum: 10c0/4c118cd9bec37c8880b4489b9acbd10cf1eaa86a0a9024de2dac83f4ce5adedecc4cab54b66fa3bcb204aab7297c08d03617ae15499538939692b48651cc52d1\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -495,6 +495,8 @@ GEM\n       opentelemetry-common (~> 0.20)\n       opentelemetry-sdk (~> 1.2)\n       opentelemetry-semantic_conventions\n+    opentelemetry-helpers-sql (0.1.1)\n+      opentelemetry-api (~> 1.0)\n     opentelemetry-helpers-sql-obfuscation (0.3.0)\n       opentelemetry-common (~> 0.21)\n     opentelemetry-instrumentation-action_mailer (0.4.0)\n@@ -548,8 +550,9 @@ GEM\n     opentelemetry-instrumentation-net_http (0.23.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-pg (0.30.0)\n+    opentelemetry-instrumentation-pg (0.30.1)\n       opentelemetry-api (~> 1.0)\n+      opentelemetry-helpers-sql\n       opentelemetry-helpers-sql-obfuscation\n       opentelemetry-instrumentation-base (~> 0.23.0)\n     opentelemetry-instrumentation-rack (0.26.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rubocop](https://rubocop.org/) ([source](https://redirect.github.com/rubocop/rubocop), [changelog](https://redirect.github.com/rubocop/rubocop/releases/tag/v1.75.4)) | `1.75.3` -> `1.75.4` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rubocop/1.75.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rubocop/1.75.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rubocop/1.75.3/1.75.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rubocop/1.75.3/1.75.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>rubocop/rubocop (rubocop)</summary>\n\n### [`v1.75.4`](https://redirect.github.com/rubocop/rubocop/blob/HEAD/CHANGELOG.md#1754-2025-04-28)\n\n[Compare Source](https://redirect.github.com/rubocop/rubocop/compare/v1.75.3...v1.75.4)\n\n##### Bug fixes\n\n-   [#&#8203;14123](https://redirect.github.com/rubocop/rubocop/issues/14123): Fix an infinite loop error for `Lint/BooleanSymbol` when using the rocket hash syntax with a boolean symbol key. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14134](https://redirect.github.com/rubocop/rubocop/pull/14134): Fix an error for `Style/ComparableBetween` when comparing the value with itself. (\\[[@&#8203;earlopain](https://redirect.github.com/earlopain)]\\[])\n-   [#&#8203;14111](https://redirect.github.com/rubocop/rubocop/issues/14111): Fix an error for `Style/SafeNavigation` when the RHS of `&&` is a complex `||` expression composed of `&&` conditions. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14129](https://redirect.github.com/rubocop/rubocop/issues/14129): Fix false positives for `Style/ArgumentsForwarding` when using default positional arg, keyword arg, and block arg in Ruby 3.1. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14110](https://redirect.github.com/rubocop/rubocop/pull/14110): Fix false positives for `Style/RedundantParentheses` when parens around basic conditional as the second argument of a parenthesized method call. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14120](https://redirect.github.com/rubocop/rubocop/issues/14120): Fix false positives for `Style/RedundantParentheses` when parens around unparenthesized method call as the second argument of a parenthesized method call. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14133](https://redirect.github.com/rubocop/rubocop/pull/14133): Fix `Lint/LiteralAsCondition` autocorrect when a literal is the condition of an elsif followed by an else. (\\[[@&#8203;zopolis4](https://redirect.github.com/zopolis4)]\\[])\n-   [#&#8203;14116](https://redirect.github.com/rubocop/rubocop/issues/14116): Make `Style/TrailingCommaInArguments` cop aware of trailing commas in `[]` method call. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14114](https://redirect.github.com/rubocop/rubocop/pull/14114): Fix `Style/ClassAndModuleChildren` cop error on tab-intended compactable modules. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n\n##### Changes\n\n-   [#&#8203;13611](https://redirect.github.com/rubocop/rubocop/issues/13611): Enable `Lint/CircularArgumentReference` on Ruby 3.4. (\\[[@&#8203;earlopain](https://redirect.github.com/earlopain)]\\[])\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNTcuMyIsInVwZGF0ZWRJblZlciI6IjM5LjI1Ny4zIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\napp/javascript/mastodon/components/admin/ReportReasonSelector.jsx\n@@ -105,7 +105,7 @@ class ReportReasonSelector extends PureComponent {\n   };\n \n   componentDidMount() {\n-    api(false).get('/api/v1/instance').then(res => {\n+    api(false).get('/api/v2/instance').then(res => {\n       this.setState({\n         rules: res.data.rules,\n       });\n---\n\n\n---\n\nChoice B:\ndocker-compose.yml\n@@ -115,7 +115,7 @@ services:\n     volumes:\n       - ./public/system:/mastodon/public/system\n     healthcheck:\n-      test: ['CMD-SHELL', \"ps aux | grep '[s]idekiq\\ 6' || false\"]\n+      test: ['CMD-SHELL', \"ps aux | grep '[s]idekiq\\ 7' || false\"]\n \n   ## Uncomment to enable federation with tor instances along with adding the following ENV variables\n   ## http_hidden_proxy=http://privoxy:8118\n---\n\n\n---\n\nChoice C:\npackage.json\n@@ -64,7 +64,6 @@\n     \"emoji-mart\": \"npm:emoji-mart-lazyload@latest\",\n     \"escape-html\": \"^1.0.3\",\n     \"fuzzysort\": \"^3.0.0\",\n-    \"glob\": \"^10.2.6\",\n     \"history\": \"^4.10.1\",\n     \"hoist-non-react-statics\": \"^3.3.2\",\n     \"http-link-header\": \"^1.1.1\",\n---\nyarn.lock\n@@ -2514,7 +2514,6 @@ __metadata:\n     eslint-plugin-react: \"npm:^7.37.4\"\n     eslint-plugin-react-hooks: \"npm:^5.2.0\"\n     fuzzysort: \"npm:^3.0.0\"\n-    glob: \"npm:^10.2.6\"\n     globals: \"npm:^16.0.0\"\n     history: \"npm:^4.10.1\"\n     hoist-non-react-statics: \"npm:^3.3.2\"\n@@ -6919,7 +6918,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"glob@npm:^10.2.2, glob@npm:^10.2.6, glob@npm:^10.3.10\":\n+\"glob@npm:^10.2.2, glob@npm:^10.3.10\":\n   version: 10.4.5\n   resolution: \"glob@npm:10.4.5\"\n   dependencies:\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.2)\n-    rubocop (1.75.3)\n+    rubocop (1.75.4)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [connection_pool](https://redirect.github.com/mperham/connection_pool) ([changelog](https://redirect.github.com/mperham/connection_pool/blob/main/Changes.md)) | `2.5.2` -> `2.5.3` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/connection_pool/2.5.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/connection_pool/2.5.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/connection_pool/2.5.2/2.5.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/connection_pool/2.5.2/2.5.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>mperham/connection_pool (connection_pool)</summary>\n\n### [`v2.5.3`](https://redirect.github.com/mperham/connection_pool/blob/HEAD/Changes.md#253)\n\n[Compare Source](https://redirect.github.com/mperham/connection_pool/compare/v2.5.2...v2.5.3)\n\n-   Fix TruffleRuby/JRuby crash \\[[#&#8203;201](https://redirect.github.com/mperham/connection_pool/issues/201)]\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNTcuMyIsInVwZGF0ZWRJblZlciI6IjM5LjI1Ny4zIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nconfig/initializers/chewy.rb\n@@ -9,7 +9,11 @@\n prefix          = ENV.fetch('ES_PREFIX') { fallback_prefix }\n ca_file         = ENV.fetch('ES_CA_FILE', nil).presence\n \n-transport_options = { ssl: { ca_file: ca_file } } if ca_file.present?\n+# While Faraday ignore http_proxy env var when Faraday.ignore_env_proxy eqals true, elasticsearch-transport will use proxy. This is a workaround to avoid this.\n+transport_options = {\n+  proxy: {},\n+}\n+transport_options[:ssl] = { ca_file: ca_file } if ca_file.present?\n \n Chewy.settings = {\n   host: \"#{host}:#{port}\",\n---\n\n\n---\n\nChoice B:\n.ruby-version\n@@ -1 +1 @@\n-3.4.2\n+3.4.3\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/actions/notifications.js\n@@ -21,7 +21,6 @@ export const NOTIFICATIONS_SET_BROWSER_PERMISSION = 'NOTIFICATIONS_SET_BROWSER_P\n \n defineMessages({\n   mention: { id: 'notification.mention', defaultMessage: '{name} mentioned you' },\n-  mentioned_you: { id: 'notification.mentioned_you', defaultMessage: '{name} mentioned you' },\n   group: { id: 'notifications.group', defaultMessage: '{count} notifications' },\n });\n \n---\nconfig/vite/plugin-sw-locales.ts\n@@ -8,8 +8,21 @@\n import fs from 'node:fs';\n import path from 'node:path';\n \n+import { defineMessages } from 'react-intl';\n+\n import type { Plugin, ResolvedConfig } from 'vite';\n \n+const translations = defineMessages({\n+  mentioned_you: {\n+    id: 'notification.mentioned_you',\n+    defaultMessage: '{name} mentioned you',\n+  },\n+});\n+\n+const CUSTOM_TRANSLATIONS = {\n+  'notification.mention': translations.mentioned_you.id,\n+};\n+\n const KEEP_KEYS = [\n   'notification.favourite',\n   'notification.follow',\n@@ -67,7 +80,14 @@ export function MastodonServiceWorkerLocales(): Plugin {\n             const filteredLocale: Record<string, string> = {};\n \n             Object.entries(full).forEach(([key, value]) => {\n-              if (KEEP_KEYS.includes(key)) filteredLocale[key] = value;\n+              if (KEEP_KEYS.includes(key)) {\n+                filteredLocale[key] = value;\n+              }\n+            });\n+\n+            Object.entries(CUSTOM_TRANSLATIONS).forEach(([key, value]) => {\n+              const translation = full[value];\n+              if (translation) filteredLocale[key] = translation;\n             });\n \n             filteredLocales[locale] = filteredLocale;\n---\npackage.json\n@@ -18,7 +18,7 @@\n     \"fix\": \"yarn fix:js && yarn fix:css\",\n     \"format\": \"prettier --write --log-level warn .\",\n     \"format:check\": \"prettier --check --ignore-unknown .\",\n-    \"i18n:extract\": \"formatjs extract 'app/javascript/**/*.{js,jsx,ts,tsx}' --ignore '**/*.d.ts' --out-file app/javascript/mastodon/locales/en.json --format config/formatjs-formatter.js\",\n+    \"i18n:extract\": \"formatjs extract 'app/javascript/**/*.{js,jsx,ts,tsx}' config/vite/plugin-sw-locales.js --ignore '**/*.d.ts' --out-file app/javascript/mastodon/locales/en.json --format config/formatjs-formatter.js\",\n     \"lint:js\": \"cd $INIT_CWD && eslint --cache --report-unused-disable-directives\",\n     \"lint:css\": \"stylelint \\\"**/*.{css,scss}\\\"\",\n     \"lint\": \"yarn lint:js && yarn lint:css\",\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -160,7 +160,7 @@ GEM\n     cocoon (1.2.15)\n     color_diff (0.1)\n     concurrent-ruby (1.3.5)\n-    connection_pool (2.5.2)\n+    connection_pool (2.5.3)\n     cose (1.3.1)\n       cbor (~> 0.5.9)\n       openssl-signature_algorithm (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThe `Chewy::Index#update_mapping` method does not actually update index settings, only field mappings. To update index settings, the index must be closed, updated, then reopened.\n\n---\n\nChoice A:\nlib/chewy/index_extensions.rb\n@@ -12,6 +12,13 @@ def index_preset(base_options = {})\n         base_options.merge(number_of_replicas: 1, number_of_shards: (base_options[:number_of_shards] || 1) * 2)\n       end\n     end\n+\n+    def update_specification\n+      client.indices.close index: index_name\n+      client.indices.put_settings index: index_name, body: { settings: { analysis: settings_hash[:settings][:analysis] } }\n+      client.indices.put_mapping index: index_name, body: root.mappings_hash\n+      client.indices.open index: index_name\n+    end\n   end\n end\n \n---\nlib/mastodon/cli/search.rb\n@@ -56,7 +56,7 @@ def deploy\n       if options[:only_mapping]\n         indices.select { |index| index.specification.changed? }.each do |index|\n           progress.title = \"Updating mapping for #{index} \"\n-          index.update_mapping\n+          index.update_specification\n           index.specification.lock!\n         end\n \n---\n\n\n---\n\nChoice B:\n.rubocop_todo.yml\n@@ -33,7 +33,6 @@ Style/FetchEnvVar:\n   Exclude:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/paperclip.rb'\n-    - 'lib/tasks/repo.rake'\n \n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: MinBodyLength, AllowConsecutiveConditionals.\n---\nlib/tasks/repo.rake\n@@ -57,7 +57,7 @@ namespace :repo do\n                 response = nil\n \n                 loop do\n-                  response = HTTP.headers('Authorization' => \"token #{ENV['GITHUB_API_TOKEN']}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n+                  response = HTTP.headers('Authorization' => \"token #{ENV.fetch('GITHUB_API_TOKEN')}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n \n                   if response.code == 403\n                     sleep_for = (response.headers['X-RateLimit-Reset'].to_i - Time.now.to_i).abs\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/actions/accounts.js\n@@ -2,6 +2,7 @@ import { browserHistory } from 'mastodon/components/router';\n import { debounceWithDispatchAndArguments } from 'mastodon/utils/debounce';\n \n import api, { getLinks } from '../api';\n+import { me } from '../initial_state';\n \n import {\n   followAccountSuccess, unfollowAccountSuccess,\n@@ -12,6 +13,7 @@ import {\n   blockAccountSuccess, unblockAccountSuccess,\n   pinAccountSuccess, unpinAccountSuccess,\n   fetchRelationshipsSuccess,\n+  fetchEndorsedAccounts,\n } from './accounts_typed';\n import { importFetchedAccount, importFetchedAccounts } from './importer';\n \n@@ -634,6 +636,7 @@ export function pinAccount(id) {\n \n     api().post(`/api/v1/accounts/${id}/pin`).then(response => {\n       dispatch(pinAccountSuccess({ relationship: response.data }));\n+      dispatch(fetchEndorsedAccounts({ accountId: me }));\n     }).catch(error => {\n       dispatch(pinAccountFail(error));\n     });\n@@ -646,6 +649,7 @@ export function unpinAccount(id) {\n \n     api().post(`/api/v1/accounts/${id}/unpin`).then(response => {\n       dispatch(unpinAccountSuccess({ relationship: response.data }));\n+      dispatch(fetchEndorsedAccounts({ accountId: me }));\n     }).catch(error => {\n       dispatch(unpinAccountFail(error));\n     });\n---\napp/javascript/mastodon/components/account.tsx\n@@ -12,6 +12,8 @@ import {\n   muteAccount,\n   unmuteAccount,\n   followAccountSuccess,\n+  unpinAccount,\n+  pinAccount,\n } from 'mastodon/actions/accounts';\n import { showAlertForError } from 'mastodon/actions/alerts';\n import { openModal } from 'mastodon/actions/modal';\n@@ -62,14 +64,23 @@ const messages = defineMessages({\n   },\n });\n \n-export const Account: React.FC<{\n+interface AccountProps {\n   size?: number;\n   id: string;\n   hidden?: boolean;\n   minimal?: boolean;\n   defaultAction?: 'block' | 'mute';\n   withBio?: boolean;\n-}> = ({ id, size = 46, hidden, minimal, defaultAction, withBio }) => {\n+}\n+\n+export const Account: React.FC<AccountProps> = ({\n+  id,\n+  size = 46,\n+  hidden,\n+  minimal,\n+  defaultAction,\n+  withBio,\n+}) => {\n   const intl = useIntl();\n   const { signedIn } = useIdentity();\n   const account = useAppSelector((state) => state.accounts.get(id));\n@@ -119,8 +130,6 @@ export const Account: React.FC<{\n         },\n       ];\n     } else if (defaultAction !== 'block') {\n-      arr = [];\n-\n       if (isRemote && accountUrl) {\n         arr.push({\n           text: intl.formatMessage(messages.openOriginalPage),\n@@ -173,6 +182,25 @@ export const Account: React.FC<{\n           text: intl.formatMessage(messages.addToLists),\n           action: handleAddToLists,\n         });\n+\n+        if (id !== me && (relationship?.following || relationship?.requested)) {\n+          const handleEndorseToggle = () => {\n+            if (relationship.endorsed) {\n+              dispatch(unpinAccount(id));\n+            } else {\n+              dispatch(pinAccount(id));\n+            }\n+          };\n+          arr.push({\n+            text: intl.formatMessage(\n+              // Defined in features/account_timeline/components/account_header.tsx\n+              relationship.endorsed\n+                ? { id: 'account.unendorse' }\n+                : { id: 'account.endorse' },\n+            ),\n+            action: handleEndorseToggle,\n+          });\n+        }\n       }\n     }\n \n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -1,3 +1,5 @@\n+import { useMemo } from 'react';\n+\n import { FormattedMessage } from 'react-intl';\n \n import classNames from 'classnames';\n@@ -10,9 +12,11 @@ import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react'\n import { Icon } from 'mastodon/components/icon';\n import StatusContainer from 'mastodon/containers/status_container';\n import type { Status } from 'mastodon/models/status';\n+import type { RootState } from 'mastodon/store';\n import { useAppSelector } from 'mastodon/store';\n \n import QuoteIcon from '../../images/quote.svg?react';\n+import { makeGetStatus } from '../selectors';\n \n const MAX_QUOTE_POSTS_NESTING_LEVEL = 1;\n \n@@ -65,6 +69,10 @@ const QuoteLink: React.FC<{\n };\n \n type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n+type GetStatusSelector = (\n+  state: RootState,\n+  props: { id?: string | null; contextType?: string },\n+) => Status | null;\n \n export const QuotedStatus: React.FC<{\n   quote: QuoteMap;\n@@ -73,34 +81,50 @@ export const QuotedStatus: React.FC<{\n   nestingLevel?: number;\n }> = ({ quote, contextType, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n-  const state = quote.get('state');\n+  const quoteState = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n   let quoteError: React.ReactNode = null;\n \n-  if (state === 'deleted') {\n+  // In order to find out whether the quoted post should be completely hidden\n+  // due to a matching filter, we run it through the selector used by `status_container`.\n+  // If this returns null even though `status` exists, it's because it's filtered.\n+  const getStatus = useMemo(() => makeGetStatus(), []) as GetStatusSelector;\n+  const statusWithExtraData = useAppSelector((state) =>\n+    getStatus(state, { id: quotedStatusId, contextType }),\n+  );\n+  const isFilteredAndHidden = status && statusWithExtraData === null;\n+\n+  if (isFilteredAndHidden) {\n+    quoteError = (\n+      <FormattedMessage\n+        id='status.quote_error.filtered'\n+        defaultMessage='Hidden due to one of your filters'\n+      />\n+    );\n+  } else if (quoteState === 'deleted') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.removed'\n         defaultMessage='This post was removed by its author.'\n       />\n     );\n-  } else if (state === 'unauthorized') {\n+  } else if (quoteState === 'unauthorized') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.unauthorized'\n         defaultMessage='This post cannot be displayed as you are not authorized to view it.'\n       />\n     );\n-  } else if (state === 'pending') {\n+  } else if (quoteState === 'pending') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.pending_approval'\n         defaultMessage='This post is pending approval from the original author.'\n       />\n     );\n-  } else if (state === 'rejected' || state === 'revoked') {\n+  } else if (quoteState === 'rejected' || quoteState === 'revoked') {\n     quoteError = (\n       <FormattedMessage\n         id='status.quote_error.rejected'\n---\napp/javascript/mastodon/locales/en.json\n@@ -864,6 +864,7 @@\n   \"status.mute_conversation\": \"Mute conversation\",\n   \"status.open\": \"Expand this post\",\n   \"status.pin\": \"Feature on profile\",\n+  \"status.quote_error.filtered\": \"Hidden due to one of your filters\",\n   \"status.quote_error.not_found\": \"This post cannot be displayed.\",\n   \"status.quote_error.pending_approval\": \"This post is pending approval from the original author.\",\n   \"status.quote_error.rejected\": \"This post cannot be displayed as the original author does not allow it to be quoted.\",\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rqrcode](https://redirect.github.com/whomwah/rqrcode) ([changelog](https://redirect.github.com/whomwah/rqrcode/blob/main/CHANGELOG.md)) | `3.0.0` -> `3.1.0` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rqrcode/3.1.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rqrcode/3.1.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rqrcode/3.0.0/3.1.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rqrcode/3.0.0/3.1.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>whomwah/rqrcode (rqrcode)</summary>\n\n### [`v3.1.0`](https://redirect.github.com/whomwah/rqrcode/blob/HEAD/CHANGELOG.md#310---2025-04-28)\n\n[Compare Source](https://redirect.github.com/whomwah/rqrcode/compare/v3.0.0...v3.1.0)\n\n-   Added support for `offset_x` and `offset_y` options in the `as_svg` method for independent x and y padding around QR codes \\[[#&#8203;153](https://redirect.github.com/whomwah/rqrcode/issues/153)]\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNTcuMyIsInVwZGF0ZWRJblZlciI6IjM5LjI1Ny4zIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n-  version: 2.8.1\n-  resolution: \"pg-connection-string@npm:2.8.1\"\n-  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n+  version: 2.8.5\n+  resolution: \"pg-connection-string@npm:2.8.5\"\n+  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -711,7 +711,7 @@ GEM\n     rotp (6.3.0)\n     rouge (4.5.1)\n     rpam2 (4.0.2)\n-    rqrcode (3.0.0)\n+    rqrcode (3.1.0)\n       chunky_png (~> 1.0)\n       rqrcode_core (~> 2.0)\n     rqrcode_core (2.0.0)\n---\n\n\n---\n\nChoice C:\napp/models/home_feed.rb\n@@ -9,4 +9,12 @@ def initialize(account)\n   def regenerating?\n     redis.exists?(\"account:#{@account.id}:regeneration\")\n   end\n+\n+  def regeneration_in_progress!\n+    redis.set(\"account:#{@account.id}:regeneration\", true, nx: true, ex: 1.day.seconds)\n+  end\n+\n+  def regeneration_finished!\n+    redis.del(\"account:#{@account.id}:regeneration\")\n+  end\n end\n---\napp/models/user.rb\n@@ -531,7 +531,11 @@ def notify_staff_about_pending_account!\n   end\n \n   def regenerate_feed!\n-    RegenerationWorker.perform_async(account_id) if redis.set(\"account:#{account_id}:regeneration\", true, nx: true, ex: 1.day.seconds)\n+    home_feed = HomeFeed.new(account)\n+    unless home_feed.regenerating?\n+      home_feed.regeneration_in_progress!\n+      RegenerationWorker.perform_async(account_id)\n+    end\n   end\n \n   def needs_feed_update?\n---\napp/services/follow_service.rb\n@@ -46,7 +46,7 @@ def call(source_account, target_account, options = {})\n   private\n \n   def mark_home_feed_as_partial!\n-    redis.set(\"account:#{@source_account.id}:regeneration\", true, nx: true, ex: 1.day.seconds)\n+    HomeFeed.new(@source_account).regeneration_in_progress!\n   end\n \n   def following_not_possible?\n---\napp/services/precompute_feed_service.rb\n@@ -12,7 +12,7 @@ def call(account, skip_filled_timelines: false)\n       FeedManager.instance.populate_list(list) unless skip_timeline?(:list, list.id)\n     end\n   ensure\n-    redis.del(\"account:#{account.id}:regeneration\")\n+    HomeFeed.new(account).regeneration_finished!\n   end\n \n   private\n---\napp/workers/merge_worker.rb\n@@ -31,7 +31,7 @@ def merge_into_home!(into_account_id)\n       FeedManager.instance.merge_into_home(@from_account, @into_account)\n     end\n   ensure\n-    redis.del(\"account:#{into_account_id}:regeneration\")\n+    HomeFeed.new(@into_account).regeneration_finished!\n   end\n \n   def merge_into_list!(into_list_id)\n---\nspec/models/home_feed_spec.rb\n@@ -42,4 +42,42 @@\n       end\n     end\n   end\n+\n+  describe '#regenerating?' do\n+    context 'when feed is being generated' do\n+      before do\n+        redis.set(\"account:#{account.id}:regeneration\", true)\n+      end\n+\n+      it 'returns `true`' do\n+        expect(subject.regenerating?).to be true\n+      end\n+    end\n+\n+    context 'when feed is not being generated' do\n+      it 'returns `false`' do\n+        expect(subject.regenerating?).to be false\n+      end\n+    end\n+  end\n+\n+  describe '#regeneration_in_progress!' do\n+    it 'sets the corresponding key in redis' do\n+      expect(redis.exists?(\"account:#{account.id}:regeneration\")).to be false\n+\n+      subject.regeneration_in_progress!\n+\n+      expect(redis.exists?(\"account:#{account.id}:regeneration\")).to be true\n+    end\n+  end\n+\n+  describe '#regeneration_finished!' do\n+    it 'removes the corresponding key from redis' do\n+      redis.set(\"account:#{account.id}:regeneration\", true)\n+\n+      subject.regeneration_finished!\n+\n+      expect(redis.exists?(\"account:#{account.id}:regeneration\")).to be false\n+    end\n+  end\n end\n---\n\n\n---\n\nChoice D:\napp/javascript/styles/mastodon/components.scss\n@@ -11044,7 +11044,7 @@ noscript {\n   overflow: hidden;\n   flex-shrink: 0;\n   border-bottom: 1px solid var(--background-border-color);\n-  touch-action: pan-x;\n+  touch-action: pan-y;\n \n   &__slides {\n     display: flex;\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34557\n\n---\n\nChoice A:\nspec/support/capybara.rb\n@@ -30,6 +30,10 @@ def common_chrome_options\n \n Capybara.javascript_driver = :headless_chrome\n \n+# Some of the flaky tests seem to be caused by github runners being too slow for the\n+# default timeout of 2 seconds\n+Capybara.default_max_wait_time = 8\n+\n RSpec.configure do |config|\n   config.before(:each, type: :system) do\n     driven_by :rack_test\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/components/dropdown_menu.tsx\n@@ -320,6 +320,7 @@ interface DropdownProps<Item = MenuItem> {\n   scrollable?: boolean;\n   scrollKey?: string;\n   status?: ImmutableMap<string, unknown>;\n+  forceDropdown?: boolean;\n   renderItem?: RenderItemFn<Item>;\n   renderHeader?: RenderHeaderFn<Item>;\n   onOpen?: () => void;\n@@ -339,6 +340,7 @@ export const Dropdown = <Item = MenuItem,>({\n   disabled,\n   scrollable,\n   status,\n+  forceDropdown = false,\n   renderItem,\n   renderHeader,\n   onOpen,\n@@ -406,7 +408,7 @@ export const Dropdown = <Item = MenuItem,>({\n           dispatch(fetchRelationships([status.getIn(['account', 'id'])]));\n         }\n \n-        if (isUserTouching()) {\n+        if (isUserTouching() && !forceDropdown) {\n           dispatch(\n             openModal({\n               modalType: 'ACTIONS',\n@@ -437,6 +439,7 @@ export const Dropdown = <Item = MenuItem,>({\n       open,\n       status,\n       items,\n+      forceDropdown,\n       handleClose,\n     ],\n   );\n---\napp/javascript/mastodon/components/edited_timestamp/index.tsx\n@@ -116,6 +116,7 @@ export const EditedTimestamp: React.FC<{\n       renderHeader={renderHeader}\n       onOpen={handleOpen}\n       onItemClick={handleItemClick}\n+      forceDropdown\n     >\n       <button className='dropdown-menu__text-button'>\n         <FormattedMessage\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/account_featured/components/featured_tag.tsx\n@@ -42,6 +42,7 @@ export const FeaturedTag: React.FC<FeaturedTagProps> = ({ tag, account }) => {\n               date: intl.formatDate(tag.get('last_status_at') ?? '', {\n                 month: 'short',\n                 day: '2-digit',\n+                year: 'numeric',\n               }),\n             })\n           : intl.formatMessage(messages.empty)\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -66,7 +66,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.23.5, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n+\"@babel/core@npm:^7.21.3, @babel/core@npm:^7.24.4, @babel/core@npm:^7.26.10\":\n   version: 7.26.10\n   resolution: \"@babel/core@npm:7.26.10\"\n   dependencies:\n@@ -211,10 +211,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.24.0, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5\":\n-  version: 7.26.5\n-  resolution: \"@babel/helper-plugin-utils@npm:7.26.5\"\n-  checksum: 10c0/cdaba71d4b891aa6a8dfbe5bac2f94effb13e5fa4c2c487667fdbaa04eae059b78b28d85a885071f45f7205aeb56d16759e1bed9c118b94b16e4720ef1ab0f65\n+\"@babel/helper-plugin-utils@npm:^7.0.0, @babel/helper-plugin-utils@npm:^7.18.6, @babel/helper-plugin-utils@npm:^7.22.5, @babel/helper-plugin-utils@npm:^7.25.9, @babel/helper-plugin-utils@npm:^7.26.5, @babel/helper-plugin-utils@npm:^7.27.1\":\n+  version: 7.27.1\n+  resolution: \"@babel/helper-plugin-utils@npm:7.27.1\"\n+  checksum: 10c0/94cf22c81a0c11a09b197b41ab488d416ff62254ce13c57e62912c85700dc2e99e555225787a4099ff6bae7a1812d622c80fbaeda824b79baa10a6c5ac4cf69b\n   languageName: node\n   linkType: hard\n \n@@ -869,25 +869,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-self@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-self@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-self@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea362ff94b535c753f560eb1f5e063dc72bbbca17ed58837a949a7b289d5eacc7b0a28296d1932c94429b168d6040cdee5484a59b9e3c021f169e0ee137e6a27\n+  checksum: 10c0/00a4f917b70a608f9aca2fb39aabe04a60aa33165a7e0105fd44b3a8531630eb85bf5572e9f242f51e6ad2fa38c2e7e780902176c863556c58b5ba6f6e164031\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-react-jsx-source@npm:^7.23.3\":\n-  version: 7.24.1\n-  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.24.1\"\n+\"@babel/plugin-transform-react-jsx-source@npm:^7.25.9\":\n+  version: 7.27.1\n+  resolution: \"@babel/plugin-transform-react-jsx-source@npm:7.27.1\"\n   dependencies:\n-    \"@babel/helper-plugin-utils\": \"npm:^7.24.0\"\n+    \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ea8e3263c0dc51fbc97c156cc647150a757cc56de10781287353d0ce9b2dcd6b6d93d573c0142d7daf5d6fb554c74fa1971ae60764924ea711161d8458739b63\n+  checksum: 10c0/5e67b56c39c4d03e59e03ba80692b24c5a921472079b63af711b1d250fc37c1733a17069b63537f750f3e937ec44a42b1ee6a46cd23b1a0df5163b17f741f7f2\n   languageName: node\n   linkType: hard\n \n@@ -4135,17 +4135,17 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.2.1\n-  resolution: \"@vitejs/plugin-react@npm:4.2.1\"\n+  version: 4.4.1\n+  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n   dependencies:\n-    \"@babel/core\": \"npm:^7.23.5\"\n-    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.23.3\"\n-    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.23.3\"\n+    \"@babel/core\": \"npm:^7.26.10\"\n+    \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n+    \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n-    react-refresh: \"npm:^0.14.0\"\n+    react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n-    vite: ^4.2.0 || ^5.0.0\n-  checksum: 10c0/de1eec44d703f32e5b58e776328ca20793657fe991835d15b290230b19a2a08be5d31501d424279ae13ecfed28044c117b69d746891c8d9b92c69e8a8907e989\n+    vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n+  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n   languageName: node\n   linkType: hard\n \n@@ -10069,10 +10069,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-refresh@npm:^0.14.0\":\n-  version: 0.14.0\n-  resolution: \"react-refresh@npm:0.14.0\"\n-  checksum: 10c0/b8ae07ad153357d77830928a7f1fc2df837aabefee907fa273ba04c7643f3b860e986f1d4b7ada9b721c8d79b8c24b5b911a314a1a2398b105f1b13d19ea2b8d\n+\"react-refresh@npm:^0.17.0\":\n+  version: 0.17.0\n+  resolution: \"react-refresh@npm:0.17.0\"\n+  checksum: 10c0/002cba940384c9930008c0bce26cac97a9d5682bc623112c2268ba0c155127d9c178a9a5cc2212d560088d60dfd503edd808669a25f9b377f316a32361d0b23c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nHey, \r\n\r\nThis resolves the #18078 issue. \r\n\r\nI took a little liberty to change the behavior of `<LoadingIndicator />` on the directory feature. As current implementation manipulates the visibility of the `<AccountCard />` list, which resets the scroll position to the top whenever new elements are loaded. \r\n\r\nProposed change swaps the `<LoadMore>` component with `<LoadingIndicator/>` each time new data is loaded. It utilizes the existing scss rule `.load-more .loading-indicator` which places the loader exactly at the previous position of the button. \r\n\r\nI'm aware that this changes the design slightly, but it seems to be the simplest solution to the problem. But if that's not possible, I'm open to any guidance how to resolve that issue differently. \n\n---\n\nChoice A:\napp/javascript/mastodon/locales/en-GB.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Moderated servers\",\n   \"about.contact\": \"Contact:\",\n+  \"about.default_locale\": \"Default\",\n   \"about.disclaimer\": \"Mastodon is free, open-source software, and a trademark of Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Reason not available\",\n   \"about.domain_blocks.preamble\": \"Mastodon generally allows you to view content from and interact with users from any other server in the Fediverse. These are the exceptions that have been made on this particular server.\",\n   \"about.domain_blocks.silenced.explanation\": \"You will generally not see profiles and content from this server, unless you explicitly look it up or opt into it by following.\",\n   \"about.domain_blocks.silenced.title\": \"Limited\",\n   \"about.domain_blocks.suspended.explanation\": \"No data from this server will be processed, stored or exchanged, making any interaction or communication with users from this server impossible.\",\n   \"about.domain_blocks.suspended.title\": \"Suspended\",\n+  \"about.language_label\": \"Language\",\n   \"about.not_available\": \"This information has not been made available on this server.\",\n   \"about.powered_by\": \"Decentralised social media powered by {mastodon}\",\n   \"about.rules\": \"Server rules\",\n@@ -19,10 +21,12 @@\n   \"account.block_domain\": \"Block domain {domain}\",\n   \"account.block_short\": \"Block\",\n   \"account.blocked\": \"Blocked\",\n+  \"account.blocking\": \"Blocking\",\n   \"account.cancel_follow_request\": \"Cancel follow\",\n   \"account.copy\": \"Copy link to profile\",\n   \"account.direct\": \"Privately mention @{name}\",\n   \"account.disable_notifications\": \"Stop notifying me when @{name} posts\",\n+  \"account.domain_blocking\": \"Blocking domain\",\n   \"account.edit_profile\": \"Edit profile\",\n   \"account.enable_notifications\": \"Notify me when @{name} posts\",\n   \"account.endorse\": \"Feature on profile\",\n---\napp/javascript/mastodon/locales/pt-PT.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Servidores moderados\",\n   \"about.contact\": \"Contacto:\",\n+  \"about.default_locale\": \"Padr\u00e3o\",\n   \"about.disclaimer\": \"O Mastodon \u00e9 um software livre, de c\u00f3digo aberto e uma marca registada de Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Motivo n\u00e3o dispon\u00edvel\",\n   \"about.domain_blocks.preamble\": \"O Mastodon geralmente permite ver e interagir com o conte\u00fado de utilizadores de qualquer outra inst\u00e2ncia no fediverso. Estas s\u00e3o as exce\u00e7\u00f5es desta inst\u00e2ncia em espec\u00edfico.\",\n   \"about.domain_blocks.silenced.explanation\": \"Normalmente n\u00e3o ver\u00e1s perfis e conte\u00fados deste servidor, a n\u00e3o ser que os procures explicitamente ou optes por segui-los.\",\n   \"about.domain_blocks.silenced.title\": \"Limitados\",\n   \"about.domain_blocks.suspended.explanation\": \"Nenhum dado deste servidor ser\u00e1 processado, armazenado ou trocado, tornando imposs\u00edvel qualquer intera\u00e7\u00e3o ou comunica\u00e7\u00e3o com os utilizadores a partir deste servidor.\",\n   \"about.domain_blocks.suspended.title\": \"Suspensos\",\n+  \"about.language_label\": \"Idioma\",\n   \"about.not_available\": \"Esta informa\u00e7\u00e3o n\u00e3o foi disponibilizada neste servidor.\",\n   \"about.powered_by\": \"Rede social descentralizada baseada no {mastodon}\",\n   \"about.rules\": \"Regras do servidor\",\n@@ -308,6 +310,8 @@\n   \"emoji_button.search_results\": \"Resultados da pesquisa\",\n   \"emoji_button.symbols\": \"S\u00edmbolos\",\n   \"emoji_button.travel\": \"Viagens e lugares\",\n+  \"empty_column.account_featured.me\": \"Ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n+  \"empty_column.account_featured.other\": \"{acct} ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n   \"empty_column.account_featured_other.unknown\": \"Esta conta ainda n\u00e3o colocou nada em destaque.\",\n   \"empty_column.account_hides_collections\": \"Este utilizador escolheu n\u00e3o disponibilizar esta informa\u00e7\u00e3o\",\n   \"empty_column.account_suspended\": \"Conta suspensa\",\n@@ -341,6 +345,11 @@\n   \"explore.trending_links\": \"Not\u00edcias\",\n   \"explore.trending_statuses\": \"Publica\u00e7\u00f5es\",\n   \"explore.trending_tags\": \"#Etiquetas\",\n+  \"featured_carousel.header\": \"{count, plural, one {Publica\u00e7\u00e3o Afixada} other {Publica\u00e7\u00f5es Afixadas}}\",\n+  \"featured_carousel.next\": \"Seguinte\",\n+  \"featured_carousel.post\": \"Publica\u00e7\u00e3o\",\n+  \"featured_carousel.previous\": \"Anterior\",\n+  \"featured_carousel.slide\": \"{index} de {total}\",\n   \"filter_modal.added.context_mismatch_explanation\": \"Esta categoria de filtro n\u00e3o se aplica ao contexto em que acedeste a esta publica\u00e7\u00e3o. Se pretenderes que esta publica\u00e7\u00e3o seja filtrada tamb\u00e9m neste contexto, ter\u00e1s que editar o filtro.\",\n   \"filter_modal.added.context_mismatch_title\": \"O contexto n\u00e3o coincide!\",\n   \"filter_modal.added.expired_explanation\": \"Esta categoria de filtro expirou, tens de alterar a data de validade para que ele seja aplicado.\",\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -2986,6 +2986,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"@rolldown/pluginutils@npm:1.0.0-beta.9\":\n+  version: 1.0.0-beta.9\n+  resolution: \"@rolldown/pluginutils@npm:1.0.0-beta.9\"\n+  checksum: 10c0/21aebb7ebd093282efd96f63ddd465f76746b1d70282366d6ccc7fff6eb4da5c2f8f4bfaaaeb4283c2432600e5609e39e9897864575e593efc11d376ca1a6fa1\n+  languageName: node\n+  linkType: hard\n+\n \"@rollup/plugin-babel@npm:^5.2.0\":\n   version: 5.3.1\n   resolution: \"@rollup/plugin-babel@npm:5.3.1\"\n@@ -4180,17 +4187,18 @@ __metadata:\n   linkType: hard\n \n \"@vitejs/plugin-react@npm:^4.2.1\":\n-  version: 4.4.1\n-  resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n+  version: 4.5.0\n+  resolution: \"@vitejs/plugin-react@npm:4.5.0\"\n   dependencies:\n     \"@babel/core\": \"npm:^7.26.10\"\n     \"@babel/plugin-transform-react-jsx-self\": \"npm:^7.25.9\"\n     \"@babel/plugin-transform-react-jsx-source\": \"npm:^7.25.9\"\n+    \"@rolldown/pluginutils\": \"npm:1.0.0-beta.9\"\n     \"@types/babel__core\": \"npm:^7.20.5\"\n     react-refresh: \"npm:^0.17.0\"\n   peerDependencies:\n     vite: ^4.2.0 || ^5.0.0 || ^6.0.0\n-  checksum: 10c0/0eda45f2026cdfff4b172b1b2148824e5ac41ce65f1f1ce108f3ce4de2f0024caf79c811c1305a782168a269b0b1bc58d4cf8eaf164e4ef19954f05428ba7077\n+  checksum: 10c0/c9f75cde098b9aac62cb512103d7f898a0a173cb78dc9fcf79ca4b3f21a1458cd1955a4383c8c9e3841ce23c5e7f02ed1455e445c9574879b143d40734121fd8\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/load_more.tsx\n@@ -1,24 +1,32 @@\n import { FormattedMessage } from 'react-intl';\n \n+import { LoadingIndicator } from './loading_indicator';\n+\n interface Props {\n   onClick: (event: React.MouseEvent) => void;\n   disabled?: boolean;\n   visible?: boolean;\n+  loading?: boolean;\n }\n export const LoadMore: React.FC<Props> = ({\n   onClick,\n   disabled,\n   visible = true,\n+  loading = false,\n }) => {\n   return (\n     <button\n       type='button'\n       className='load-more'\n-      disabled={disabled || !visible}\n+      disabled={disabled || loading || !visible}\n       style={{ visibility: visible ? 'visible' : 'hidden' }}\n       onClick={onClick}\n     >\n-      <FormattedMessage id='status.load_more' defaultMessage='Load more' />\n+      {loading ? (\n+        <LoadingIndicator />\n+      ) : (\n+        <FormattedMessage id='status.load_more' defaultMessage='Load more' />\n+      )}\n     </button>\n   );\n };\n---\napp/javascript/mastodon/features/directory/index.tsx\n@@ -130,6 +130,7 @@ export const Directory: React.FC<{\n   }, [dispatch, order, local]);\n \n   const pinned = !!columnId;\n+  const initialLoad = isLoading && accountIds.size === 0;\n \n   const scrollableArea = (\n     <div className='scrollable'>\n@@ -170,7 +171,7 @@ export const Directory: React.FC<{\n       </div>\n \n       <div className='directory__list'>\n-        {isLoading ? (\n+        {initialLoad ? (\n           <LoadingIndicator />\n         ) : (\n           accountIds.map((accountId) => (\n@@ -179,7 +180,11 @@ export const Directory: React.FC<{\n         )}\n       </div>\n \n-      <LoadMore onClick={handleLoadMore} visible={!isLoading} />\n+      <LoadMore\n+        onClick={handleLoadMore}\n+        visible={!initialLoad}\n+        loading={isLoading}\n+      />\n     </div>\n   );\n \n---\n\n\n---\n\nChoice D:\napp/controllers/api/base_controller.rb\n@@ -72,6 +72,13 @@ def require_user!\n     end\n   end\n \n+  # Redefine `require_functional!` to properly output JSON instead of HTML redirects\n+  def require_functional!\n+    return if current_user.functional?\n+\n+    require_user!\n+  end\n+\n   def render_empty\n     render json: {}, status: 200\n   end\n---\napp/controllers/application_controller.rb\n@@ -72,10 +72,24 @@ def store_referrer\n   def require_functional!\n     return if current_user.functional?\n \n-    if current_user.confirmed?\n-      redirect_to edit_user_registration_path\n-    else\n-      redirect_to auth_setup_path\n+    respond_to do |format|\n+      format.any do\n+        if current_user.confirmed?\n+          redirect_to edit_user_registration_path\n+        else\n+          redirect_to auth_setup_path\n+        end\n+      end\n+\n+      format.json do\n+        if !current_user.confirmed?\n+          render json: { error: 'Your login is missing a confirmed e-mail address' }, status: 403\n+        elsif !current_user.approved?\n+          render json: { error: 'Your login is currently pending approval' }, status: 403\n+        elsif !current_user.functional?\n+          render json: { error: 'Your login is currently disabled' }, status: 403\n+        end\n+      end\n     end\n   end\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [shoulda-matchers](https://matchers.shoulda.io) ([source](https://redirect.github.com/thoughtbot/shoulda-matchers), [changelog](https://redirect.github.com/thoughtbot/shoulda-matchers/blob/main/CHANGELOG.md)) | `6.4.0` -> `6.5.0` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/shoulda-matchers/6.5.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/shoulda-matchers/6.5.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/shoulda-matchers/6.4.0/6.5.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/shoulda-matchers/6.4.0/6.5.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>thoughtbot/shoulda-matchers (shoulda-matchers)</summary>\n\n### [`v6.5.0`](https://redirect.github.com/thoughtbot/shoulda-matchers/blob/HEAD/CHANGELOG.md#650---2025-04-25)\n\n[Compare Source](https://redirect.github.com/thoughtbot/shoulda-matchers/compare/v6.4.0...v6.5.0)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNTcuMyIsInVwZGF0ZWRJblZlciI6IjM5LjI1Ny4zIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nconfig/initializers/devise.rb\n@@ -158,13 +158,15 @@ def session_cookie\n   # given strategies, for example, `config.params_authenticatable = [:database]` will\n   # enable it only for database (email + password) authentication.\n   # config.params_authenticatable = true\n+  config.params_authenticatable = true\n \n   # Tell if authentication through HTTP Auth is enabled. False by default.\n   # It can be set to an array that will enable http authentication only for the\n   # given strategies, for example, `config.http_authenticatable = [:database]` will\n   # enable it only for database authentication. The supported strategies are:\n   # :database      = Support basic authentication with authentication key + password\n-  config.http_authenticatable = [:pam, :database]\n+  # config.http_authenticatable = [:pam, :database]\n+  config.http_authenticatable = false\n \n   # If 401 status code should be returned for AJAX requests. True by default.\n   # config.http_authenticatable_on_xhr = true\n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -13,7 +13,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.225.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -93,21 +93,23 @@ GEM\n     annotaterb (4.14.0)\n     ast (2.4.3)\n     attr_required (1.0.2)\n-    aws-eventstream (1.3.2)\n-    aws-partitions (1.1103.0)\n-    aws-sdk-core (3.215.1)\n+    aws-eventstream (1.4.0)\n+    aws-partitions (1.1110.0)\n+    aws-sdk-core (3.225.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n     aws-sdk-s3 (1.177.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sdk-kms (~> 1)\n       aws-sigv4 (~> 1.5)\n-    aws-sigv4 (1.11.0)\n+    aws-sigv4 (1.12.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n     azure-blob (0.5.8)\n       rexml\n@@ -946,7 +948,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.225.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -68,15 +68,15 @@ type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n \n export const QuotedStatus: React.FC<{\n   quote: QuoteMap;\n+  contextType?: string;\n   variant?: 'full' | 'link';\n   nestingLevel?: number;\n-}> = ({ quote, nestingLevel = 1, variant = 'full' }) => {\n+}> = ({ quote, contextType, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n   const state = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n-\n   let quoteError: React.ReactNode = null;\n \n   if (state === 'deleted') {\n@@ -131,10 +131,16 @@ export const QuotedStatus: React.FC<{\n   return (\n     <QuoteWrapper>\n       {/* @ts-expect-error Status is not yet typed */}\n-      <StatusContainer isQuotedPost id={quotedStatusId} avatarSize={40}>\n+      <StatusContainer\n+        isQuotedPost\n+        id={quotedStatusId}\n+        contextType={contextType}\n+        avatarSize={40}\n+      >\n         {canRenderChildQuote && (\n           <QuotedStatus\n             quote={childQuote}\n+            contextType={contextType}\n             variant={\n               nestingLevel === MAX_QUOTE_POSTS_NESTING_LEVEL ? 'link' : 'full'\n             }\n@@ -148,6 +154,7 @@ export const QuotedStatus: React.FC<{\n \n interface StatusQuoteManagerProps {\n   id: string;\n+  contextType?: string;\n   [key: string]: unknown;\n }\n \n@@ -168,7 +175,7 @@ export const StatusQuoteManager = (props: StatusQuoteManagerProps) => {\n   if (quote) {\n     return (\n       <StatusContainer {...props}>\n-        <QuotedStatus quote={quote} />\n+        <QuotedStatus quote={quote} contextType={props.contextType} />\n       </StatusContainer>\n     );\n   }\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -807,7 +807,7 @@ GEM\n       rubyzip (>= 1.2.2, < 3.0)\n       websocket (~> 1.0)\n     semantic_range (3.1.0)\n-    shoulda-matchers (6.4.0)\n+    shoulda-matchers (6.5.0)\n       activesupport (>= 5.2.0)\n     sidekiq (6.5.12)\n       connection_pool (>= 2.2.5, < 3)\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [pg](https://redirect.github.com/brianc/node-postgres) ([source](https://redirect.github.com/brianc/node-postgres/tree/HEAD/packages/pg)) | [`8.15.5` -> `8.15.6`](https://renovatebot.com/diffs/npm/pg/8.15.5/8.15.6) | [![age](https://developer.mend.io/api/mc/badges/age/npm/pg/8.15.6?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/pg/8.15.6?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/pg/8.15.5/8.15.6?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/pg/8.15.5/8.15.6?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>brianc/node-postgres (pg)</summary>\n\n### [`v8.15.6`](https://redirect.github.com/brianc/node-postgres/compare/pg@8.15.5...pg@8.15.6)\n\n[Compare Source](https://redirect.github.com/brianc/node-postgres/compare/pg@8.15.5...pg@8.15.6)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNTcuMyIsInVwZGF0ZWRJblZlciI6IjM5LjI1Ny4zIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\napp/javascript/mastodon/actions/search.ts\n@@ -121,10 +121,15 @@ export const clickSearchResult = createAppAsyncThunk(\n \n export const forgetSearchResult = createAppAsyncThunk(\n   'search/forgetResult',\n-  (q: string, { dispatch, getState }) => {\n+  (\n+    { q, type }: { q: string; type?: RecentSearchType },\n+    { dispatch, getState },\n+  ) => {\n     const previous = getState().search.recent;\n     const me = getState().meta.get('me') as string;\n-    const current = previous.filter((result) => result.q !== q);\n+    const current = previous.filter(\n+      (result) => result.q !== q || result.type !== type,\n+    );\n \n     searchHistory.set(me, current);\n     dispatch(updateSearchHistory(current));\n---\napp/javascript/mastodon/features/compose/components/search.tsx\n@@ -221,7 +221,7 @@ export const Search: React.FC<{\n     },\n     forget: (e) => {\n       e.stopPropagation();\n-      void dispatch(forgetSearchResult(search.q));\n+      void dispatch(forgetSearchResult(search));\n     },\n   }));\n \n@@ -497,8 +497,10 @@ export const Search: React.FC<{\n             <div className='search__popout__menu'>\n               {recentOptions.length > 0 ? (\n                 recentOptions.map(({ label, key, action, forget }, i) => (\n-                  <button\n+                  <div\n                     key={key}\n+                    tabIndex={0}\n+                    role='button'\n                     onMouseDown={action}\n                     className={classNames(\n                       'search__popout__menu__item search__popout__menu__item--flex',\n@@ -509,7 +511,7 @@ export const Search: React.FC<{\n                     <button className='icon-button' onMouseDown={forget}>\n                       <Icon id='times' icon={CloseIcon} />\n                     </button>\n-                  </button>\n+                  </div>\n                 ))\n               ) : (\n                 <div className='search__popout__menu__message'>\n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -110,7 +110,7 @@ group :opentelemetry do\n   gem 'opentelemetry-instrumentation-active_model_serializers', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-concurrent_ruby', '~> 0.22.0', require: false\n   gem 'opentelemetry-instrumentation-excon', '~> 0.23.0', require: false\n-  gem 'opentelemetry-instrumentation-faraday', '~> 0.26.0', require: false\n+  gem 'opentelemetry-instrumentation-faraday', '~> 0.27.0', require: false\n   gem 'opentelemetry-instrumentation-http', '~> 0.24.0', require: false\n   gem 'opentelemetry-instrumentation-http_client', '~> 0.23.0', require: false\n   gem 'opentelemetry-instrumentation-net_http', '~> 0.23.0', require: false\n---\nGemfile.lock\n@@ -544,7 +544,7 @@ GEM\n     opentelemetry-instrumentation-excon (0.23.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-faraday (0.26.0)\n+    opentelemetry-instrumentation-faraday (0.27.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n     opentelemetry-instrumentation-http (0.24.0)\n@@ -1026,7 +1026,7 @@ DEPENDENCIES\n   opentelemetry-instrumentation-active_model_serializers (~> 0.22.0)\n   opentelemetry-instrumentation-concurrent_ruby (~> 0.22.0)\n   opentelemetry-instrumentation-excon (~> 0.23.0)\n-  opentelemetry-instrumentation-faraday (~> 0.26.0)\n+  opentelemetry-instrumentation-faraday (~> 0.27.0)\n   opentelemetry-instrumentation-http (~> 0.24.0)\n   opentelemetry-instrumentation-http_client (~> 0.23.0)\n   opentelemetry-instrumentation-net_http (~> 0.23.0)\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/hover_card_account.tsx\n@@ -45,6 +45,19 @@ export const HoverCardAccount = forwardRef<\n \n   const { familiarFollowers } = useFetchFamiliarFollowers({ accountId });\n \n+  const relationship = useAppSelector((state) =>\n+    accountId ? state.relationships.get(accountId) : undefined,\n+  );\n+  const isMutual = relationship?.followed_by && relationship.following;\n+  const isFollower = relationship?.followed_by;\n+  const hasRelationshipLoaded = !!relationship;\n+\n+  const shouldDisplayFamiliarFollowers =\n+    familiarFollowers.length > 0 &&\n+    hasRelationshipLoaded &&\n+    !isMutual &&\n+    !isFollower;\n+\n   return (\n     <div\n       ref={ref}\n@@ -85,7 +98,7 @@ export const HoverCardAccount = forwardRef<\n               value={account.followers_count}\n               renderer={FollowersCounter}\n             />\n-            {familiarFollowers.length > 0 && (\n+            {shouldDisplayFamiliarFollowers && (\n               <>\n                 &middot;\n                 <div className='hover-card__familiar-followers'>\n@@ -101,6 +114,22 @@ export const HoverCardAccount = forwardRef<\n                 </div>\n               </>\n             )}\n+            {(isMutual || isFollower) && (\n+              <>\n+                &middot;\n+                {isMutual ? (\n+                  <FormattedMessage\n+                    id='account.mutual'\n+                    defaultMessage='You follow each other'\n+                  />\n+                ) : (\n+                  <FormattedMessage\n+                    id='account.follows_you'\n+                    defaultMessage='Follows you'\n+                  />\n+                )}\n+              </>\n+            )}\n           </div>\n \n           <FollowButton accountId={accountId} />\n---\napp/javascript/styles/mastodon/components.scss\n@@ -10766,7 +10766,7 @@ noscript {\n     display: flex;\n     align-items: center;\n     flex-wrap: wrap;\n-    gap: 10px;\n+    gap: 2px 10px;\n   }\n \n   &__numbers {\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -13307,12 +13307,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.9.5\":\n-  version: 3.9.5\n-  resolution: \"pg-pool@npm:3.9.5\"\n+\"pg-pool@npm:^3.9.6\":\n+  version: 3.9.6\n+  resolution: \"pg-pool@npm:3.9.6\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/ebb36b6a1fd753213263a2e0e73d06ffe9fc93907deceae484c7fe4b464f6e9c41a578eb096b4b6012beec94a5d6e0e47728dfc4425e06d283744aa7432365a4\n+  checksum: 10c0/458d50a4e7260977f076472d40d0796fa8b513af7e3ce1bf65557e10724e9c13653661c883f6650dff92d0a1a5ff4e7a001a8262b786c1ad4cfbd35c3354353e\n   languageName: node\n   linkType: hard\n \n@@ -13352,12 +13352,12 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.15.5\n-  resolution: \"pg@npm:8.15.5\"\n+  version: 8.15.6\n+  resolution: \"pg@npm:8.15.6\"\n   dependencies:\n     pg-cloudflare: \"npm:^1.2.5\"\n     pg-connection-string: \"npm:^2.8.5\"\n-    pg-pool: \"npm:^3.9.5\"\n+    pg-pool: \"npm:^3.9.6\"\n     pg-protocol: \"npm:^1.9.5\"\n     pg-types: \"npm:^2.1.0\"\n     pgpass: \"npm:1.x\"\n@@ -13369,7 +13369,7 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/4c118cd9bec37c8880b4489b9acbd10cf1eaa86a0a9024de2dac83f4ce5adedecc4cab54b66fa3bcb204aab7297c08d03617ae15499538939692b48651cc52d1\n+  checksum: 10c0/d4dc81020ebd137b6cf6228e43c643067acb8240079a07f7b9a7e97be0f33ad4d8c6f2a3f5b512ad87180e3d48e651fbd72885aa807ab58a715da8f3efea0fab\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis is a minimal implementation for ease of testing only, as this only covers self-quotes, does not provide a `QuoteAuthorization` object, and does not represent the quote over ActivityPub.\r\n\r\nQuote authoring in Mastodon is scheduled for after Mastodon 4.4.\n\n---\n\nChoice A:\napp/javascript/mastodon/components/load_more.tsx\n@@ -1,24 +1,32 @@\n import { FormattedMessage } from 'react-intl';\n \n+import { LoadingIndicator } from './loading_indicator';\n+\n interface Props {\n   onClick: (event: React.MouseEvent) => void;\n   disabled?: boolean;\n   visible?: boolean;\n+  loading?: boolean;\n }\n export const LoadMore: React.FC<Props> = ({\n   onClick,\n   disabled,\n   visible = true,\n+  loading = false,\n }) => {\n   return (\n     <button\n       type='button'\n       className='load-more'\n-      disabled={disabled || !visible}\n+      disabled={disabled || loading || !visible}\n       style={{ visibility: visible ? 'visible' : 'hidden' }}\n       onClick={onClick}\n     >\n-      <FormattedMessage id='status.load_more' defaultMessage='Load more' />\n+      {loading ? (\n+        <LoadingIndicator />\n+      ) : (\n+        <FormattedMessage id='status.load_more' defaultMessage='Load more' />\n+      )}\n     </button>\n   );\n };\n---\napp/javascript/mastodon/features/directory/index.tsx\n@@ -130,6 +130,7 @@ export const Directory: React.FC<{\n   }, [dispatch, order, local]);\n \n   const pinned = !!columnId;\n+  const initialLoad = isLoading && accountIds.size === 0;\n \n   const scrollableArea = (\n     <div className='scrollable'>\n@@ -170,7 +171,7 @@ export const Directory: React.FC<{\n       </div>\n \n       <div className='directory__list'>\n-        {isLoading ? (\n+        {initialLoad ? (\n           <LoadingIndicator />\n         ) : (\n           accountIds.map((accountId) => (\n@@ -179,7 +180,11 @@ export const Directory: React.FC<{\n         )}\n       </div>\n \n-      <LoadMore onClick={handleLoadMore} visible={!isLoading} />\n+      <LoadMore\n+        onClick={handleLoadMore}\n+        visible={!initialLoad}\n+        loading={isLoading}\n+      />\n     </div>\n   );\n \n---\n\n\n---\n\nChoice B:\napp/services/post_status_service.rb\n@@ -18,6 +18,7 @@ def initialize(message, accounts)\n   # @param [Hash] options\n   # @option [String] :text Message\n   # @option [Status] :thread Optional status to reply to\n+  # @option [Status] :quoted_status Optional status to quote\n   # @option [Boolean] :sensitive\n   # @option [String] :visibility\n   # @option [String] :spoiler_text\n@@ -35,6 +36,7 @@ def call(account, options = {})\n     @options     = options\n     @text        = @options[:text] || ''\n     @in_reply_to = @options[:thread]\n+    @quoted_status = @options[:quoted_status]\n \n     @antispam = Antispam.new\n \n@@ -78,6 +80,7 @@ def process_status!\n     @status = @account.statuses.new(status_attributes)\n     process_mentions_service.call(@status, save_records: false)\n     safeguard_mentions!(@status)\n+    attach_quote!(@status)\n     @antispam.local_preflight_check!(@status)\n \n     # The following transaction block is needed to wrap the UPDATEs to\n@@ -87,6 +90,21 @@ def process_status!\n     end\n   end\n \n+  def attach_quote!(status)\n+    return if @quoted_status.nil?\n+\n+    # NOTE: for now this is only for convenience in testing, as we don't support the request flow nor serialize quotes in ActivityPub\n+    # we only support incoming quotes so far\n+\n+    status.quote = Quote.new(quoted_status: @quoted_status)\n+    status.quote.accept! if @status.account == @quoted_status.account || @quoted_status.active_mentions.exists?(mentions: { account_id: status.account_id })\n+\n+    # TODO: the following has yet to be implemented:\n+    # - handle approval of local users (requires the interactionPolicy PR)\n+    # - produce a QuoteAuthorization for quotes of local users\n+    # - send a QuoteRequest for quotes of remote users\n+  end\n+\n   def safeguard_mentions!(status)\n     return if @options[:allowed_mentions].nil?\n \n@@ -223,6 +241,7 @@ def scheduled_options\n     @options.dup.tap do |options_hash|\n       options_hash[:in_reply_to_id]  = options_hash.delete(:thread)&.id\n       options_hash[:application_id]  = options_hash.delete(:application)&.id\n+      options_hash[:quoted_status_id] = options_hash.delete(:quoted_status)&.id\n       options_hash[:scheduled_at]    = nil\n       options_hash[:idempotency]     = nil\n       options_hash[:with_rate_limit] = false\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.223.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1096.0)\n+    aws-sdk-core (3.223.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.223.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -4860,17 +4860,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"browserslist@npm:^4.24.0, browserslist@npm:^4.24.4, browserslist@npm:^4.24.5\":\n-  version: 4.24.5\n-  resolution: \"browserslist@npm:4.24.5\"\n+\"browserslist@npm:^4.24.0, browserslist@npm:^4.24.4, browserslist@npm:^4.25.0\":\n+  version: 4.25.0\n+  resolution: \"browserslist@npm:4.25.0\"\n   dependencies:\n-    caniuse-lite: \"npm:^1.0.30001716\"\n-    electron-to-chromium: \"npm:^1.5.149\"\n+    caniuse-lite: \"npm:^1.0.30001718\"\n+    electron-to-chromium: \"npm:^1.5.160\"\n     node-releases: \"npm:^2.0.19\"\n     update-browserslist-db: \"npm:^1.1.3\"\n   bin:\n     browserslist: cli.js\n-  checksum: 10c0/f4c1ce1a7d8fdfab5e5b88bb6e93d09e8a883c393f86801537a252da0362dbdcde4dbd97b318246c5d84c6607b2f6b47af732c1b000d6a8a881ee024bad29204\n+  checksum: 10c0/cc16c55b4468b18684a0e1ca303592b38635b1155d6724f172407192737a2f405b8030d87a05813729592793445b3d15e737b0055f901cdecccb29b1e580a1c5\n   languageName: node\n   linkType: hard\n \n@@ -4991,10 +4991,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"caniuse-lite@npm:^1.0.30001702, caniuse-lite@npm:^1.0.30001716\":\n-  version: 1.0.30001718\n-  resolution: \"caniuse-lite@npm:1.0.30001718\"\n-  checksum: 10c0/67f9ad09bc16443e28d14f265d6e468480cd8dc1900d0d8b982222de80c699c4f2306599c3da8a3fa7139f110d4b30d49dbac78f215470f479abb6ffe141d5d3\n+\"caniuse-lite@npm:^1.0.30001702, caniuse-lite@npm:^1.0.30001718\":\n+  version: 1.0.30001721\n+  resolution: \"caniuse-lite@npm:1.0.30001721\"\n+  checksum: 10c0/fa3a8926899824b385279f1f886fe34c5efb1321c9ece1b9df25c8d567a2706db8450cc5b4d969e769e641593e08ea644909324aba93636a43e4949a75f81c4c\n   languageName: node\n   linkType: hard\n \n@@ -5735,10 +5735,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"electron-to-chromium@npm:^1.5.149\":\n-  version: 1.5.159\n-  resolution: \"electron-to-chromium@npm:1.5.159\"\n-  checksum: 10c0/dc5b60a235ad04b1637b3b2af4914ac900c42813b02262a91a41d950223316f7b12de715697cf9c2d9f572f716f9422bf259ee65d86599cd2cc66e92c499ebd1\n+\"electron-to-chromium@npm:^1.5.160\":\n+  version: 1.5.165\n+  resolution: \"electron-to-chromium@npm:1.5.165\"\n+  checksum: 10c0/20b91e67e7a8829a358c4a488e9b59b0e5f8d4cb075a70b9757bb21acf0fc751ca58ca7d9c6018bec74ac4bd42f7859e4ef37421c252a2275f642e12a32271d6\n   languageName: node\n   linkType: hard\n \n@@ -9321,9 +9321,9 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"postcss-custom-properties@npm:^14.0.5\":\n-  version: 14.0.5\n-  resolution: \"postcss-custom-properties@npm:14.0.5\"\n+\"postcss-custom-properties@npm:^14.0.6\":\n+  version: 14.0.6\n+  resolution: \"postcss-custom-properties@npm:14.0.6\"\n   dependencies:\n     \"@csstools/cascade-layer-name-parser\": \"npm:^2.0.5\"\n     \"@csstools/css-parser-algorithms\": \"npm:^3.0.5\"\n@@ -9332,7 +9332,7 @@ __metadata:\n     postcss-value-parser: \"npm:^4.2.0\"\n   peerDependencies:\n     postcss: ^8.4\n-  checksum: 10c0/ddee0545075dc0888cd54a9bb5791a98719a5d4f31d1de33823841efb540fa79f65e48b7c4aaba753d3214102e419536c5bc46c72e6e1579e5352da4e042ef3b\n+  checksum: 10c0/0eeef77bc713551f5cb8fa5982d24da4e854075f3af020f1c94366c47a23a4cc225ebfecc978bdb17f00ee0bdee9d2c784e0d01adc64a447321e408abbe2c83b\n   languageName: node\n   linkType: hard\n \n@@ -9513,8 +9513,8 @@ __metadata:\n   linkType: hard\n \n \"postcss-preset-env@npm:^10.1.5\":\n-  version: 10.2.0\n-  resolution: \"postcss-preset-env@npm:10.2.0\"\n+  version: 10.2.1\n+  resolution: \"postcss-preset-env@npm:10.2.1\"\n   dependencies:\n     \"@csstools/postcss-cascade-layers\": \"npm:^5.0.1\"\n     \"@csstools/postcss-color-function\": \"npm:^4.0.10\"\n@@ -9550,7 +9550,7 @@ __metadata:\n     \"@csstools/postcss-trigonometric-functions\": \"npm:^4.0.9\"\n     \"@csstools/postcss-unset-value\": \"npm:^4.0.0\"\n     autoprefixer: \"npm:^10.4.21\"\n-    browserslist: \"npm:^4.24.5\"\n+    browserslist: \"npm:^4.25.0\"\n     css-blank-pseudo: \"npm:^7.0.1\"\n     css-has-pseudo: \"npm:^7.0.2\"\n     css-prefers-color-scheme: \"npm:^10.0.0\"\n@@ -9561,7 +9561,7 @@ __metadata:\n     postcss-color-hex-alpha: \"npm:^10.0.0\"\n     postcss-color-rebeccapurple: \"npm:^10.0.0\"\n     postcss-custom-media: \"npm:^11.0.6\"\n-    postcss-custom-properties: \"npm:^14.0.5\"\n+    postcss-custom-properties: \"npm:^14.0.6\"\n     postcss-custom-selectors: \"npm:^8.0.5\"\n     postcss-dir-pseudo-class: \"npm:^9.0.1\"\n     postcss-double-position-gradients: \"npm:^6.0.2\"\n@@ -9582,7 +9582,7 @@ __metadata:\n     postcss-selector-not: \"npm:^8.0.1\"\n   peerDependencies:\n     postcss: ^8.4\n-  checksum: 10c0/33406dcdd1d63fd3810f12cd97bf0d6a09a51917943ee7d75e2ccaf1d8cbce363abcb90ee68f14509d287d00de4afd6664dbdecaa4f4b95509e3578e27f54a24\n+  checksum: 10c0/1a78eb86bca8f7c2bf7686ee9ed354b21d1316a7d12ae9aec2ce4b4810f6d32e23d0787d7450e55145f14f76b715df758bb54af0ea6a151858b045bd429f596e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nWe are most likely going to use those IDs for quote approvals in the future. Just like for posts, they should not be easily enumerable.\n\n---\n\nChoice A:\nspec/system/account_notes_spec.rb\n@@ -11,13 +11,13 @@\n   let(:finished_onboarding) { true }\n \n   let!(:other_account) { Fabricate(:account) }\n+  let(:note_text) { 'This is a personal note' }\n \n   before { as_a_logged_in_user }\n \n   it 'can be written and viewed' do\n     visit_profile(other_account)\n \n-    note_text = 'This is a personal note'\n     fill_in frontend_translations('account_note.placeholder'), with: note_text\n \n     # This is a bit awkward since there is no button to save the change\n---\nspec/system/new_statuses_spec.rb\n@@ -9,12 +9,12 @@\n   let(:password)            { 'password' }\n   let(:confirmed_at)        { Time.zone.now }\n   let(:finished_onboarding) { true }\n+  let(:status_text) { 'This is a new status!' }\n \n   before { as_a_logged_in_user }\n \n   it 'can be posted' do\n     visit_homepage\n-    status_text = 'This is a new status!'\n \n     within('.compose-form') do\n       fill_in frontend_translations('compose_form.placeholder'), with: status_text\n---\n\n\n---\n\nChoice B:\ndb/migrate/20250425134308_quote_ids_to_timestamp_ids.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class QuoteIdsToTimestampIds < ActiveRecord::Migration[8.0]\n+  def up\n+    # Set up the media_attachments.id column to use our timestamp-based IDs.\n+    safety_assured do\n+      execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT timestamp_id('quotes')\")\n+    end\n+\n+    # Make sure we have a sequence to use.\n+    Mastodon::Snowflake.ensure_id_sequences_exist\n+  end\n+\n+  def down\n+    execute('LOCK quotes')\n+    execute(\"SELECT setval('quotes_id_seq', (SELECT MAX(id) FROM quotes))\")\n+    execute(\"ALTER TABLE quotes ALTER COLUMN id SET DEFAULT nextval('quotes_id_seq')\")\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_22_085303) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_25_134654) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -871,7 +871,7 @@\n     t.string \"url\"\n   end\n \n-  create_table \"quotes\", force: :cascade do |t|\n+  create_table \"quotes\", id: :bigint, default: -> { \"timestamp_id('quotes'::text)\" }, force: :cascade do |t|\n     t.bigint \"account_id\", null: false\n     t.bigint \"status_id\", null: false\n     t.bigint \"quoted_status_id\"\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -912,7 +912,9 @@ export const AccountHeader: React.FC<{\n             <div className='account__header__badges'>{badges}</div>\n           )}\n \n-          {signedIn && <FamiliarFollowers accountId={accountId} />}\n+          {account.id !== me && signedIn && (\n+            <FamiliarFollowers accountId={accountId} />\n+          )}\n \n           {!(suspended || hidden) && (\n             <div className='account__header__extra'>\n---\napp/javascript/styles/mastodon/components.scss\n@@ -2179,7 +2179,7 @@ a .account__avatar {\n   flex-wrap: nowrap;\n \n   & > :not(:first-child) {\n-    margin-inline-start: -8px;\n+    margin-inline-start: -12px;\n   }\n \n   & > :first-child {\n---\n\n\n---\n\nChoice D:\npackage.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/mastodon\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.0\",\n+  \"packageManager\": \"yarn@4.9.1\",\n   \"engines\": {\n     \"node\": \">=18\"\n   },\n---\nstreaming/package.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/streaming\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.0\",\n+  \"packageManager\": \"yarn@4.9.1\",\n   \"engines\": {\n     \"node\": \">=18\"\n   },\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes MAS-385\n\n---\n\nChoice A:\napp/controllers/api/base_controller.rb\n@@ -72,6 +72,13 @@ def require_user!\n     end\n   end\n \n+  # Redefine `require_functional!` to properly output JSON instead of HTML redirects\n+  def require_functional!\n+    return if current_user.functional?\n+\n+    require_user!\n+  end\n+\n   def render_empty\n     render json: {}, status: 200\n   end\n---\napp/controllers/application_controller.rb\n@@ -72,10 +72,24 @@ def store_referrer\n   def require_functional!\n     return if current_user.functional?\n \n-    if current_user.confirmed?\n-      redirect_to edit_user_registration_path\n-    else\n-      redirect_to auth_setup_path\n+    respond_to do |format|\n+      format.any do\n+        if current_user.confirmed?\n+          redirect_to edit_user_registration_path\n+        else\n+          redirect_to auth_setup_path\n+        end\n+      end\n+\n+      format.json do\n+        if !current_user.confirmed?\n+          render json: { error: 'Your login is missing a confirmed e-mail address' }, status: 403\n+        elsif !current_user.approved?\n+          render json: { error: 'Your login is currently pending approval' }, status: 403\n+        elsif !current_user.functional?\n+          render json: { error: 'Your login is currently disabled' }, status: 403\n+        end\n+      end\n     end\n   end\n \n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -446,7 +446,7 @@ GEM\n     net-smtp (0.5.1)\n       net-protocol\n     nio4r (2.7.4)\n-    nokogiri (1.18.7)\n+    nokogiri (1.18.8)\n       mini_portile2 (~> 2.8.2)\n       racc (~> 1.4)\n     oj (3.16.10)\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -1023,7 +1023,7 @@ export const AccountHeader: React.FC<{\n                   />\n                 </NavLink>\n               </div>\n-              <FamiliarFollowers accountId={accountId} />\n+              {signedIn && <FamiliarFollowers accountId={accountId} />}\n             </div>\n           )}\n         </div>\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -94,7 +94,7 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1080.0)\n+    aws-partitions (1.1087.0)\n     aws-sdk-core (3.215.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n@@ -120,7 +120,7 @@ GEM\n       rack (>= 0.9.0)\n       rouge (>= 1.0.0)\n     bigdecimal (3.1.9)\n-    bindata (2.5.0)\n+    bindata (2.5.1)\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n@@ -227,7 +227,7 @@ GEM\n     fabrication (2.31.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n-    faraday (2.12.2)\n+    faraday (2.13.0)\n       faraday-net_http (>= 2.0, < 3.5)\n       json\n       logger\n@@ -239,7 +239,7 @@ GEM\n       net-http (>= 0.5.0)\n     fast_blank (1.0.1)\n     fastimage (2.4.0)\n-    ffi (1.17.1)\n+    ffi (1.17.2)\n     ffi-compiler (1.3.2)\n       ffi (>= 1.15.5)\n       rake\n@@ -426,7 +426,7 @@ GEM\n     mime-types (3.6.2)\n       logger\n       mime-types-data (~> 3.2015)\n-    mime-types-data (3.2025.0402)\n+    mime-types-data (3.2025.0408)\n     mini_mime (1.1.5)\n     mini_portile2 (2.8.8)\n     minitest (5.25.5)\n@@ -585,8 +585,8 @@ GEM\n     ostruct (0.6.1)\n     ox (2.14.22)\n       bigdecimal (>= 3.0)\n-    parallel (1.26.3)\n-    parser (3.3.7.4)\n+    parallel (1.27.0)\n+    parser (3.3.8.0)\n       ast (~> 2.4.1)\n       racc\n     parslet (2.0.0)\n@@ -751,7 +751,7 @@ GEM\n       rubocop-ast (>= 1.44.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.0)\n+    rubocop-ast (1.44.1)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n@@ -1085,4 +1085,4 @@ RUBY VERSION\n    ruby 3.4.1p0\n \n BUNDLED WITH\n-   2.6.7\n+   2.6.8\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nOn error or redirect (such as is currently the case with `LIMITED_FEDERATION_MODE=true`), the sign-up screen would erroneously try to proceed to `/start`.\r\n\r\nThis PR changes it to have stricter verification of the API result, and also requests `application/json` explicitly.\r\n\r\nThe issue of API endpoints redirecting to HTML pages in `LIMITED_FEDERATION_MODE=true` should be addressed in a separate PR.\n\n---\n\nChoice A:\nspec/support/capybara.rb\n@@ -30,9 +30,10 @@ def common_chrome_options\n \n Capybara.javascript_driver = :headless_chrome\n \n-# Some of the flaky tests seem to be caused by github runners being too slow for the\n-# default timeout of 2 seconds\n-Capybara.default_max_wait_time = 8\n+if ENV['CI'].present?\n+  # Reduce some intermittent failures from slow CI runner environment\n+  Capybara.default_max_wait_time = 60\n+end\n \n RSpec.configure do |config|\n   config.before(:each, type: :system) do\n---\n\n\n---\n\nChoice B:\npackage.json\n@@ -99,7 +99,7 @@\n     \"redux-immutable\": \"^4.0.0\",\n     \"regenerator-runtime\": \"^0.14.0\",\n     \"requestidlecallback\": \"^0.3.0\",\n-    \"rollup-plugin-visualizer\": \"^5.14.0\",\n+    \"rollup-plugin-visualizer\": \"^6.0.0\",\n     \"sass\": \"^1.62.1\",\n     \"stacktrace-js\": \"^2.0.2\",\n     \"stringz\": \"^2.1.0\",\n---\nyarn.lock\n@@ -2554,7 +2554,7 @@ __metadata:\n     redux-immutable: \"npm:^4.0.0\"\n     regenerator-runtime: \"npm:^0.14.0\"\n     requestidlecallback: \"npm:^0.3.0\"\n-    rollup-plugin-visualizer: \"npm:^5.14.0\"\n+    rollup-plugin-visualizer: \"npm:^6.0.0\"\n     sass: \"npm:^1.62.1\"\n     stacktrace-js: \"npm:^2.0.2\"\n     stringz: \"npm:^2.1.0\"\n@@ -4887,6 +4887,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"bundle-name@npm:^4.1.0\":\n+  version: 4.1.0\n+  resolution: \"bundle-name@npm:4.1.0\"\n+  dependencies:\n+    run-applescript: \"npm:^7.0.0\"\n+  checksum: 10c0/8e575981e79c2bcf14d8b1c027a3775c095d362d1382312f444a7c861b0e21513c0bd8db5bd2b16e50ba0709fa622d4eab6b53192d222120305e68359daece29\n+  languageName: node\n+  linkType: hard\n+\n \"bytes@npm:3.1.2\":\n   version: 3.1.2\n   resolution: \"bytes@npm:3.1.2\"\n@@ -5535,6 +5544,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"default-browser-id@npm:^5.0.0\":\n+  version: 5.0.0\n+  resolution: \"default-browser-id@npm:5.0.0\"\n+  checksum: 10c0/957fb886502594c8e645e812dfe93dba30ed82e8460d20ce39c53c5b0f3e2afb6ceaec2249083b90bdfbb4cb0f34e1f73fde3d68cac00becdbcfd894156b5ead\n+  languageName: node\n+  linkType: hard\n+\n+\"default-browser@npm:^5.2.1\":\n+  version: 5.2.1\n+  resolution: \"default-browser@npm:5.2.1\"\n+  dependencies:\n+    bundle-name: \"npm:^4.1.0\"\n+    default-browser-id: \"npm:^5.0.0\"\n+  checksum: 10c0/73f17dc3c58026c55bb5538749597db31f9561c0193cd98604144b704a981c95a466f8ecc3c2db63d8bfd04fb0d426904834cfc91ae510c6aeb97e13c5167c4d\n+  languageName: node\n+  linkType: hard\n+\n \"define-data-property@npm:^1.0.1, define-data-property@npm:^1.1.4\":\n   version: 1.1.4\n   resolution: \"define-data-property@npm:1.1.4\"\n@@ -5546,10 +5572,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"define-lazy-prop@npm:^2.0.0\":\n-  version: 2.0.0\n-  resolution: \"define-lazy-prop@npm:2.0.0\"\n-  checksum: 10c0/db6c63864a9d3b7dc9def55d52764968a5af296de87c1b2cc71d8be8142e445208071953649e0386a8cc37cfcf9a2067a47207f1eb9ff250c2a269658fdae422\n+\"define-lazy-prop@npm:^3.0.0\":\n+  version: 3.0.0\n+  resolution: \"define-lazy-prop@npm:3.0.0\"\n+  checksum: 10c0/5ab0b2bf3fa58b3a443140bbd4cd3db1f91b985cc8a246d330b9ac3fc0b6a325a6d82bddc0b055123d745b3f9931afeea74a5ec545439a1630b9c8512b0eeb49\n   languageName: node\n   linkType: hard\n \n@@ -7506,12 +7532,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-docker@npm:^2.0.0, is-docker@npm:^2.1.1\":\n-  version: 2.2.1\n-  resolution: \"is-docker@npm:2.2.1\"\n+\"is-docker@npm:^3.0.0\":\n+  version: 3.0.0\n+  resolution: \"is-docker@npm:3.0.0\"\n   bin:\n     is-docker: cli.js\n-  checksum: 10c0/e828365958d155f90c409cdbe958f64051d99e8aedc2c8c4cd7c89dcf35329daed42f7b99346f7828df013e27deb8f721cf9408ba878c76eb9e8290235fbcdcc\n+  checksum: 10c0/d2c4f8e6d3e34df75a5defd44991b6068afad4835bb783b902fa12d13ebdb8f41b2a199dcb0b5ed2cb78bfee9e4c0bbdb69c2d9646f4106464674d3e697a5856\n   languageName: node\n   linkType: hard\n \n@@ -7572,6 +7598,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"is-inside-container@npm:^1.0.0\":\n+  version: 1.0.0\n+  resolution: \"is-inside-container@npm:1.0.0\"\n+  dependencies:\n+    is-docker: \"npm:^3.0.0\"\n+  bin:\n+    is-inside-container: cli.js\n+  checksum: 10c0/a8efb0e84f6197e6ff5c64c52890fa9acb49b7b74fed4da7c95383965da6f0fa592b4dbd5e38a79f87fc108196937acdbcd758fcefc9b140e479b39ce1fcd1cd\n+  languageName: node\n+  linkType: hard\n+\n \"is-lambda@npm:^1.0.1\":\n   version: 1.0.1\n   resolution: \"is-lambda@npm:1.0.1\"\n@@ -7736,12 +7773,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-wsl@npm:^2.2.0\":\n-  version: 2.2.0\n-  resolution: \"is-wsl@npm:2.2.0\"\n+\"is-wsl@npm:^3.1.0\":\n+  version: 3.1.0\n+  resolution: \"is-wsl@npm:3.1.0\"\n   dependencies:\n-    is-docker: \"npm:^2.0.0\"\n-  checksum: 10c0/a6fa2d370d21be487c0165c7a440d567274fbba1a817f2f0bfa41cc5e3af25041d84267baa22df66696956038a43973e72fca117918c91431920bdef490fa25e\n+    is-inside-container: \"npm:^1.0.0\"\n+  checksum: 10c0/d3317c11995690a32c362100225e22ba793678fe8732660c6de511ae71a0ff05b06980cf21f98a6bf40d7be0e9e9506f859abe00a1118287d63e53d0a3d06947\n   languageName: node\n   linkType: hard\n \n@@ -8841,14 +8878,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"open@npm:^8.4.0\":\n-  version: 8.4.2\n-  resolution: \"open@npm:8.4.2\"\n+\"open@npm:^10.1.2\":\n+  version: 10.1.2\n+  resolution: \"open@npm:10.1.2\"\n   dependencies:\n-    define-lazy-prop: \"npm:^2.0.0\"\n-    is-docker: \"npm:^2.1.1\"\n-    is-wsl: \"npm:^2.2.0\"\n-  checksum: 10c0/bb6b3a58401dacdb0aad14360626faf3fb7fba4b77816b373495988b724fb48941cad80c1b65d62bb31a17609b2cd91c41a181602caea597ca80dfbcc27e84c9\n+    default-browser: \"npm:^5.2.1\"\n+    define-lazy-prop: \"npm:^3.0.0\"\n+    is-inside-container: \"npm:^1.0.0\"\n+    is-wsl: \"npm:^3.1.0\"\n+  checksum: 10c0/1bee796f06e549ce764f693272100323fbc04da8fa3c5b0402d6c2d11b3d76fa0aac0be7535e710015ff035326638e3b9a563f3b0e7ac3266473ed5663caae6d\n   languageName: node\n   linkType: hard\n \n@@ -10647,11 +10685,11 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"rollup-plugin-visualizer@npm:^5.14.0\":\n-  version: 5.14.0\n-  resolution: \"rollup-plugin-visualizer@npm:5.14.0\"\n+\"rollup-plugin-visualizer@npm:^6.0.0\":\n+  version: 6.0.0\n+  resolution: \"rollup-plugin-visualizer@npm:6.0.0\"\n   dependencies:\n-    open: \"npm:^8.4.0\"\n+    open: \"npm:^10.1.2\"\n     picomatch: \"npm:^4.0.2\"\n     source-map: \"npm:^0.7.4\"\n     yargs: \"npm:^17.5.1\"\n@@ -10665,7 +10703,7 @@ __metadata:\n       optional: true\n   bin:\n     rollup-plugin-visualizer: dist/bin/cli.js\n-  checksum: 10c0/ec6ca9ed125bce9994ba49a340bda730661d8e8dc5c5dc014dc757185182e1eda49c6708f990cb059095e71a3741a5248f1e6ba0ced7056020692888e06b1ddf\n+  checksum: 10c0/803b7a93692824c31c4eb6595367717591123dbdc6be3402403bba633bb81ccfdbd16827e852af9da03fd7e8211a974717492e4032d14897c37c130f0cb86222\n   languageName: node\n   linkType: hard\n \n@@ -10765,6 +10803,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"run-applescript@npm:^7.0.0\":\n+  version: 7.0.0\n+  resolution: \"run-applescript@npm:7.0.0\"\n+  checksum: 10c0/bd821bbf154b8e6c8ecffeaf0c33cebbb78eb2987476c3f6b420d67ab4c5301faa905dec99ded76ebb3a7042b4e440189ae6d85bbbd3fc6e8d493347ecda8bfe\n+  languageName: node\n+  linkType: hard\n+\n \"run-parallel@npm:^1.1.9\":\n   version: 1.2.0\n   resolution: \"run-parallel@npm:1.2.0\"\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -13120,8 +13120,8 @@ __metadata:\n   linkType: hard\n \n \"ws@npm:^8.12.1, ws@npm:^8.18.0\":\n-  version: 8.18.1\n-  resolution: \"ws@npm:8.18.1\"\n+  version: 8.18.2\n+  resolution: \"ws@npm:8.18.2\"\n   peerDependencies:\n     bufferutil: ^4.0.1\n     utf-8-validate: \">=5.0.2\"\n@@ -13130,7 +13130,7 @@ __metadata:\n       optional: true\n     utf-8-validate:\n       optional: true\n-  checksum: 10c0/e498965d6938c63058c4310ffb6967f07d4fa06789d3364829028af380d299fe05762961742971c764973dce3d1f6a2633fe8b2d9410c9b52e534b4b882a99fa\n+  checksum: 10c0/4b50f67931b8c6943c893f59c524f0e4905bbd183016cfb0f2b8653aa7f28dad4e456b9d99d285bbb67cca4fedd9ce90dfdfaa82b898a11414ebd66ee99141e4\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\napp/javascript/entrypoints/sign_up.ts\n@@ -4,9 +4,12 @@ import axios from 'axios';\n import ready from '../mastodon/ready';\n \n async function checkConfirmation() {\n-  const response = await axios.get('/api/v1/emails/check_confirmation');\n+  const response = await axios.get('/api/v1/emails/check_confirmation', {\n+    headers: { Accept: 'application/json' },\n+    withCredentials: true,\n+  });\n \n-  if (response.data) {\n+  if (response.status === 200 && response.data === true) {\n     window.location.href = '/start';\n   }\n }\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [axios](https://axios-http.com) ([source](https://redirect.github.com/axios/axios)) | [`1.8.4` -> `1.9.0`](https://renovatebot.com/diffs/npm/axios/1.8.4/1.9.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/axios/1.9.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/axios/1.9.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/axios/1.8.4/1.9.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/axios/1.8.4/1.9.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>axios/axios (axios)</summary>\n\n### [`v1.9.0`](https://redirect.github.com/axios/axios/blob/HEAD/CHANGELOG.md#190-2025-04-24)\n\n[Compare Source](https://redirect.github.com/axios/axios/compare/v1.8.4...v1.9.0)\n\n##### Bug Fixes\n\n-   **core:** fix the Axios constructor implementation to treat the config argument as optional; ([#&#8203;6881](https://redirect.github.com/axios/axios/issues/6881)) ([6c5d4cd](https://redirect.github.com/axios/axios/commit/6c5d4cd69286868059c5e52d45085cb9a894a983))\n-   **fetch:** fixed ERR_NETWORK mapping for Safari browsers; ([#&#8203;6767](https://redirect.github.com/axios/axios/issues/6767)) ([dfe8411](https://redirect.github.com/axios/axios/commit/dfe8411c9a082c3d068bdd1f8d6e73054f387f45))\n-   **headers:** allow iterable objects to be a data source for the set method; ([#&#8203;6873](https://redirect.github.com/axios/axios/issues/6873)) ([1b1f9cc](https://redirect.github.com/axios/axios/commit/1b1f9ccdc15f1ea745160ec9a5223de9db4673bc))\n-   **headers:** fix `getSetCookie` by using 'get' method for caseless access; ([#&#8203;6874](https://redirect.github.com/axios/axios/issues/6874)) ([d4f7df4](https://redirect.github.com/axios/axios/commit/d4f7df4b304af8b373488fdf8e830793ff843eb9))\n-   **headers:** fixed support for setting multiple header values from an iterated source; ([#&#8203;6885](https://redirect.github.com/axios/axios/issues/6885)) ([f7a3b5e](https://redirect.github.com/axios/axios/commit/f7a3b5e0f7e5e127b97defa92a132fbf1b55cf15))\n-   **http:** send minimal end multipart boundary ([#&#8203;6661](https://redirect.github.com/axios/axios/issues/6661)) ([987d2e2](https://redirect.github.com/axios/axios/commit/987d2e2dd3b362757550f36eab875e60640b6ddc))\n-   **types:** fix autocomplete for adapter config ([#&#8203;6855](https://redirect.github.com/axios/axios/issues/6855)) ([e61a893](https://redirect.github.com/axios/axios/commit/e61a8934d8f94dd429a2f309b48c67307c700df0))\n\n##### Features\n\n-   **AxiosHeaders:** add getSetCookie method to retrieve set-cookie headers values ([#&#8203;5707](https://redirect.github.com/axios/axios/issues/5707)) ([80ea756](https://redirect.github.com/axios/axios/commit/80ea756e72bcf53110fa792f5d7ab76e8b11c996))\n\n##### Contributors to this release\n\n-   <img src=\"https://avatars.githubusercontent.com/u/12586868?v&#x3D;4&amp;s&#x3D;18\" alt=\"avatar\" width=\"18\"/> [Dmitriy Mozgovoy](https://redirect.github.com/DigitalBrainJS \"+200/-34 (#&#8203;6890 #&#8203;6889 #&#8203;6888 #&#8203;6885 #&#8203;6881 #&#8203;6767 #&#8203;6874 #&#8203;6873 )\")\n-   <img src=\"https://avatars.githubusercontent.com/u/4814473?v&#x3D;4&amp;s&#x3D;18\" alt=\"avatar\" width=\"18\"/> [Jay](https://redirect.github.com/jasonsaayman \"+26/-1 ()\")\n-   <img src=\"https://avatars.githubusercontent.com/u/22686401?v&#x3D;4&amp;s&#x3D;18\" alt=\"avatar\" width=\"18\"/> [Willian Agostini](https://redirect.github.com/WillianAgostini \"+21/-0 (#&#8203;5707 )\")\n-   <img src=\"https://avatars.githubusercontent.com/u/2500247?v&#x3D;4&amp;s&#x3D;18\" alt=\"avatar\" width=\"18\"/> [George Cheng](https://redirect.github.com/Gerhut \"+3/-3 (#&#8203;5096 )\")\n-   <img src=\"https://avatars.githubusercontent.com/u/30260221?v&#x3D;4&amp;s&#x3D;18\" alt=\"avatar\" width=\"18\"/> [FatahChan](https://redirect.github.com/FatahChan \"+2/-2 (#&#8203;6855 )\")\n-   <img src=\"https://avatars.githubusercontent.com/u/49002?v&#x3D;4&amp;s&#x3D;18\" alt=\"avatar\" width=\"18\"/> [Ionu\u021b G. Stan](https://redirect.github.com/igstan \"+1/-1 (#&#8203;6661 )\")\n\n#### [1.8.4](https://redirect.github.com/axios/axios/compare/v1.8.3...v1.8.4) (2025-03-19)\n\n##### Bug Fixes\n\n-   **buildFullPath:** handle `allowAbsoluteUrls: false` without `baseURL` ([#&#8203;6833](https://redirect.github.com/axios/axios/issues/6833)) ([f10c2e0](https://redirect.github.com/axios/axios/commit/f10c2e0de7fde0051f848609a29c2906d0caa1d9))\n\n##### Contributors to this release\n\n-   <img src=\"https://avatars.githubusercontent.com/u/8029107?v&#x3D;4&amp;s&#x3D;18\" alt=\"avatar\" width=\"18\"/> [Marc Hassan](https://redirect.github.com/mhassan1 \"+5/-1 (#&#8203;6833 )\")\n\n#### [1.8.3](https://redirect.github.com/axios/axios/compare/v1.8.2...v1.8.3) (2025-03-10)\n\n##### Bug Fixes\n\n-   add missing type for allowAbsoluteUrls ([#&#8203;6818](https://redirect.github.com/axios/axios/issues/6818)) ([10fa70e](https://redirect.github.com/axios/axios/commit/10fa70ef14fe39558b15a179f0e82f5f5e5d11b2))\n-   **xhr/fetch:** pass `allowAbsoluteUrls` to `buildFullPath` in `xhr` and `fetch` adapters ([#&#8203;6814](https://redirect.github.com/axios/axios/issues/6814)) ([ec159e5](https://redirect.github.com/axios/axios/commit/ec159e507bdf08c04ba1a10fe7710094e9e50ec9))\n\n##### Contributors to this release\n\n-   <img src=\"https://avatars.githubusercontent.com/u/3238291?v&#x3D;4&amp;s&#x3D;18\" alt=\"avatar\" width=\"18\"/> [Ashcon Partovi](https://redirect.github.com/Electroid \"+6/-0 (#&#8203;6811 )\")\n-   <img src=\"https://avatars.githubusercontent.com/u/28559054?v&#x3D;4&amp;s&#x3D;18\" alt=\"avatar\" width=\"18\"/> [StefanBRas](https://redirect.github.com/StefanBRas \"+4/-0 (#&#8203;6818 )\")\n-   <img src=\"https://avatars.githubusercontent.com/u/8029107?v&#x3D;4&amp;s&#x3D;18\" alt=\"avatar\" width=\"18\"/> [Marc Hassan](https://redirect.github.com/mhassan1 \"+2/-2 (#&#8203;6814 )\")\n\n#### [1.8.2](https://redirect.github.com/axios/axios/compare/v1.8.1...v1.8.2) (2025-03-07)\n\n##### Bug Fixes\n\n-   **http-adapter:** add allowAbsoluteUrls to path building ([#&#8203;6810](https://redirect.github.com/axios/axios/issues/6810)) ([fb8eec2](https://redirect.github.com/axios/axios/commit/fb8eec214ce7744b5ca787f2c3b8339b2f54b00f))\n\n##### Contributors to this release\n\n-   <img src=\"https://avatars.githubusercontent.com/u/14166260?v&#x3D;4&amp;s&#x3D;18\" alt=\"avatar\" width=\"18\"/> [Fasoro-Joseph Alexander](https://redirect.github.com/lexcorp16 \"+1/-1 (#&#8203;6810 )\")\n\n#### [1.8.1](https://redirect.github.com/axios/axios/compare/v1.8.0...v1.8.1) (2025-02-26)\n\n##### Bug Fixes\n\n-   **utils:** move `generateString` to platform utils to avoid importing crypto module into client builds; ([#&#8203;6789](https://redirect.github.com/axios/axios/issues/6789)) ([36a5a62](https://redirect.github.com/axios/axios/commit/36a5a620bec0b181451927f13ac85b9888b86cec))\n\n##### Contributors to this release\n\n-   <img src=\"https://avatars.githubusercontent.com/u/12586868?v&#x3D;4&amp;s&#x3D;18\" alt=\"avatar\" width=\"18\"/> [Dmitriy Mozgovoy](https://redirect.github.com/DigitalBrainJS \"+51/-47 (#&#8203;6789 )\")\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNTcuMyIsInVwZGF0ZWRJblZlciI6IjM5LjI1Ny4zIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nconfig/environments/production.rb\n@@ -52,17 +52,14 @@\n     },\n   }\n \n-  # Log to STDOUT by default\n-  config.logger = ActiveSupport::Logger.new($stdout)\n-                                       .tap  { |logger| logger.formatter = ::Logger::Formatter.new }\n-                                       .then { |logger| ActiveSupport::TaggedLogging.new(logger) }\n+  # Use default logging formatter so that PID and timestamp are not suppressed.\n+  config.log_formatter = Logger::Formatter.new\n \n-  # Prepend all log lines with the following tags.\n+  # Log to STDOUT with the current request id as a default log tag.\n   config.log_tags = [:request_id]\n+  config.logger = ActiveSupport::TaggedLogging.logger($stdout, formatter: config.log_formatter)\n \n-  # \"info\" includes generic and useful information about system operation, but avoids logging too much\n-  # information to avoid inadvertent exposure of personally identifiable information (PII). If you\n-  # want to log everything, set the level to \"debug\".\n+  # Change to \"debug\" to log everything (including potentially personally-identifiable information!)\n   config.log_level = ENV.fetch('RAILS_LOG_LEVEL', 'info')\n \n   # Use a different cache store in production.\n@@ -90,9 +87,6 @@\n   # Don't log any deprecations.\n   config.active_support.report_deprecations = false\n \n-  # Use default logging formatter so that PID and timestamp are not suppressed.\n-  config.log_formatter = ::Logger::Formatter.new\n-\n   # Better log formatting\n   config.lograge.enabled = true\n \n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n-  version: 2.8.1\n-  resolution: \"pg-connection-string@npm:2.8.1\"\n-  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n+  version: 2.8.5\n+  resolution: \"pg-connection-string@npm:2.8.5\"\n+  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -5448,13 +5448,13 @@ __metadata:\n   linkType: hard\n \n \"axios@npm:^1.4.0\":\n-  version: 1.8.4\n-  resolution: \"axios@npm:1.8.4\"\n+  version: 1.9.0\n+  resolution: \"axios@npm:1.9.0\"\n   dependencies:\n     follow-redirects: \"npm:^1.15.6\"\n     form-data: \"npm:^4.0.0\"\n     proxy-from-env: \"npm:^1.1.0\"\n-  checksum: 10c0/450993c2ba975ffccaf0d480b68839a3b2435a5469a71fa2fb0b8a55cdb2c2ae47e609360b9c1e2b2534b73dfd69e2733a1cf9f8215bee0bcd729b72f801b0ce\n+  checksum: 10c0/9371a56886c2e43e4ff5647b5c2c3c046ed0a3d13482ef1d0135b994a628c41fbad459796f101c655e62f0c161d03883454474d2e435b2e021b1924d9f24994c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -827,9 +827,9 @@ GEM\n       rufus-scheduler (~> 3.2)\n       sidekiq (>= 6, < 8)\n       tilt (>= 1.4.0, < 3)\n-    sidekiq-unique-jobs (8.0.10)\n+    sidekiq-unique-jobs (8.0.11)\n       concurrent-ruby (~> 1.0, >= 1.0.5)\n-      sidekiq (>= 7.0.0, < 8.0.0)\n+      sidekiq (>= 7.0.0, < 9.0.0)\n       thor (>= 1.0, < 3.0)\n     simple-navigation (4.4.0)\n       activesupport (>= 2.3.2)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [react-router](https://redirect.github.com/remix-run/react-router) ([source](https://redirect.github.com/remix-run/react-router/tree/HEAD/packages/react-router)) | [`^5.3.4` -> `^7.0.0`](https://renovatebot.com/diffs/npm/react-router/5.3.4/7.5.2) | [![age](https://developer.mend.io/api/mc/badges/age/npm/react-router/7.5.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/react-router/7.5.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/react-router/5.3.4/7.5.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/react-router/5.3.4/7.5.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n### GitHub Vulnerability Alerts\n\n#### [GHSA-f46r-rw29-r322](https://redirect.github.com/remix-run/react-router/security/advisories/GHSA-f46r-rw29-r322)\n\n## Summary\nAfter some research, it turns out that it is possible to force an application to switch to SPA mode by adding a header to the request. If the application uses SSR and is forced to switch to SPA, this causes an error that completely corrupts the page. If a cache system is in place, this allows the response containing the error to be cached, resulting in a cache poisoning that strongly impacts the availability of the application.\n\n## Details\nThe vulnerable header is `X-React-Router-SPA-Mode`; adding it to a request sent to a page/endpoint using a loader throws an error. Here is [the vulnerable code](https://redirect.github.com/remix-run/react-router/blob/e6c53a0130559b4a9bd47f9cf76ea5b08a69868a/packages/react-router/lib/server-runtime/server.ts#L407) :\n\n<img width=\"672\" alt=\"Capture d\u2019e\u0301cran 2025-04-07 a\u0300 08 28 20\" src=\"https://github.com/user-attachments/assets/0a0e9c41-70fd-4dba-9061-892dd6797291\" />\n\nTo use the header, React-router must be used in Framework mode, and for the attack to be possible the target page must use a loader.\n\n## Steps to reproduce \nVersions used for our PoC: \n- \"@&#8203;react-router/node\": \"^7.5.0\",\n- \"@&#8203;react-router/serve\": \"^7.5.0\",\n- \"react\": \"^19.0.0\"\n- \"react-dom\": \"^19.0.0\"\n- \"react-router\": \"^7.5.0\"\n\n1. Install React-Router with its default configuration in Framework mode (https://reactrouter.com/start/framework/installation)\n2. Add a simple page using a loader (example: `routes/ssr`)\n\n![image](https://redirect.github.com/user-attachments/assets/d7d04e86-c549-4f4a-9200-2d1b6ac96aad)\n\n3. Send a request to the endpoint using the loader (`/ssr` in our case) adding the following header:\n```\nX-React-Router-SPA-Mode: yes\n```\n\nNotice the difference between a request with and without the header;\n\n**Normal request**\n![Capture d\u2019e\u0301cran 2025-04-07 a\u0300 08 36 27](https://redirect.github.com/user-attachments/assets/da372b70-7c68-41c1-aac1-e5be94f22526)\n\n**With the header**\n![Capture d\u2019e\u0301cran 2025-04-07 a\u0300 08 37 01](https://redirect.github.com/user-attachments/assets/98101720-cb5b-44e9-bff5-463c0b4dab2a)\n![image](https://redirect.github.com/user-attachments/assets/c16a101e-688c-4757-9e05-61308ed8a2de)\n\n## Impact\nIf a system cache is in place, it is possible to poison the response by completely altering its content (*by an error message*), strongly impacting its availability, making the latter impractical via a cache-poisoning attack.\n\n## Credits\n- Rachid Allam (zhero;)\n- Yasser Allam (inzo_)\n\n---\n\n### Release Notes\n\n<details>\n<summary>remix-run/react-router (react-router)</summary>\n\n### [`v7.5.2`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#752)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.5.1...react-router@7.5.2)\n\n##### Patch Changes\n\n-   Update Single Fetch to also handle the 204 redirects used in `?_data` requests in Remix v2 ([#&#8203;13364](https://redirect.github.com/remix-run/react-router/pull/13364))\n\n    -   This allows applications to return a redirect on `.data` requests from outside the scope of React Router (i.e., an `express`/`hono` middleware)\n    -   \u26a0\ufe0f Please note that doing so relies on implementation details that are subject to change without a SemVer major release\n    -   This is primarily done to ease upgrading to Single Fetch for existing Remix v2 applications, but the recommended way to handle this is redirecting from a route middleware\n\n-   Adjust approach for Prerendering/SPA Mode via headers ([#&#8203;13453](https://redirect.github.com/remix-run/react-router/pull/13453))\n\n### [`v7.5.1`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#751)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.5.0...react-router@7.5.1)\n\n##### Patch Changes\n\n-   Fix single fetch bug where no revalidation request would be made when navigating upwards to a reused parent route ([#&#8203;13253](https://redirect.github.com/remix-run/react-router/pull/13253))\n\n-   When using the object-based `route.lazy` API, the `HydrateFallback` and `hydrateFallbackElement` properties are now skipped when lazy loading routes after hydration. ([#&#8203;13376](https://redirect.github.com/remix-run/react-router/pull/13376))\n\n    If you move the code for these properties into a separate file, you can use this optimization to avoid downloading unused hydration code. For example:\n\n    ```ts\n    createBrowserRouter([\n      {\n        path: \"/show/:showId\",\n        lazy: {\n          loader: async () => (await import(\"./show.loader.js\")).loader,\n          Component: async () => (await import(\"./show.component.js\")).Component,\n          HydrateFallback: async () =>\n            (await import(\"./show.hydrate-fallback.js\")).HydrateFallback,\n        },\n      },\n    ]);\n    ```\n\n-   Properly revalidate prerendered paths when param values change ([#&#8203;13380](https://redirect.github.com/remix-run/react-router/pull/13380))\n\n-   UNSTABLE: Add a new `unstable_runClientMiddleware` argument to `dataStrategy` to enable middleware execution in custom `dataStrategy` implementations ([#&#8203;13395](https://redirect.github.com/remix-run/react-router/pull/13395))\n\n-   UNSTABLE: Add better error messaging when `getLoadContext` is not updated to return a `Map`\" ([#&#8203;13242](https://redirect.github.com/remix-run/react-router/pull/13242))\n\n-   Do not automatically add `null` to `staticHandler.query()` `context.loaderData` if routes do not have loaders ([#&#8203;13223](https://redirect.github.com/remix-run/react-router/pull/13223))\n\n    -   This was a Remix v2 implementation detail inadvertently left in for React Router v7\n    -   Now that we allow returning `undefined` from loaders, our prior check of `loaderData[routeId] !== undefined` was no longer sufficient and was changed to a `routeId in loaderData` check - these `null` values can cause issues for this new check\n    -   \u26a0\ufe0f This could be a \"breaking bug fix\" for you if you are doing manual SSR with `createStaticHandler()`/`<StaticRouterProvider>`, and using `context.loaderData` to control `<RouterProvider>` hydration behavior on the client\n\n-   Fix prerendering when a loader returns a redirect ([#&#8203;13365](https://redirect.github.com/remix-run/react-router/pull/13365))\n\n-   UNSTABLE: Update context type for `LoaderFunctionArgs`/`ActionFunctionArgs` when middleware is enabled ([#&#8203;13381](https://redirect.github.com/remix-run/react-router/pull/13381))\n\n-   Add support for the new `unstable_shouldCallHandler`/`unstable_shouldRevalidateArgs` APIs in `dataStrategy` ([#&#8203;13253](https://redirect.github.com/remix-run/react-router/pull/13253))\n\n### [`v7.5.0`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#750)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.4.1...react-router@7.5.0)\n\n##### Minor Changes\n\n-   Add granular object-based API for `route.lazy` to support lazy loading of individual route properties, for example: ([#&#8203;13294](https://redirect.github.com/remix-run/react-router/pull/13294))\n\n    ```ts\n    createBrowserRouter([\n      {\n        path: \"/show/:showId\",\n        lazy: {\n          loader: async () => (await import(\"./show.loader.js\")).loader,\n          action: async () => (await import(\"./show.action.js\")).action,\n          Component: async () => (await import(\"./show.component.js\")).Component,\n        },\n      },\n    ]);\n    ```\n\n    **Breaking change for `route.unstable_lazyMiddleware` consumers**\n\n    The `route.unstable_lazyMiddleware` property is no longer supported. If you want to lazily load middleware, you must use the new object-based `route.lazy` API with `route.lazy.unstable_middleware`, for example:\n\n    ```ts\n    createBrowserRouter([\n      {\n        path: \"/show/:showId\",\n        lazy: {\n          unstable_middleware: async () =>\n            (await import(\"./show.middleware.js\")).middleware,\n          // etc.\n        },\n      },\n    ]);\n    ```\n\n##### Patch Changes\n\n-   Introduce `unstable_subResourceIntegrity` future flag that enables generation of an importmap with integrity for the scripts that will be loaded by the browser. ([#&#8203;13163](https://redirect.github.com/remix-run/react-router/pull/13163))\n\n### [`v7.4.1`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#741)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.4.0...react-router@7.4.1)\n\n##### Patch Changes\n\n-   Fix types on `unstable_MiddlewareFunction` to avoid type errors when a middleware doesn't return a value ([#&#8203;13311](https://redirect.github.com/remix-run/react-router/pull/13311))\n-   Dedupe calls to `route.lazy` functions ([#&#8203;13260](https://redirect.github.com/remix-run/react-router/pull/13260))\n-   Add support for `route.unstable_lazyMiddleware` function to allow lazy loading of middleware logic. ([#&#8203;13210](https://redirect.github.com/remix-run/react-router/pull/13210))\n\n    **Breaking change for `unstable_middleware` consumers**\n\n    The `route.unstable_middleware` property is no longer supported in the return value from `route.lazy`. If you want to lazily load middleware, you must use `route.unstable_lazyMiddleware`.\n\n### [`v7.4.0`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#740)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.3.0...react-router@7.4.0)\n\n##### Patch Changes\n\n-   Fix root loader data on initial load redirects in SPA mode ([#&#8203;13222](https://redirect.github.com/remix-run/react-router/pull/13222))\n-   Load ancestor pathless/index routes in lazy route discovery for upwards non-eager-discoery routing ([#&#8203;13203](https://redirect.github.com/remix-run/react-router/pull/13203))\n-   Fix `shouldRevalidate` behavior for `clientLoader`-only routes in `ssr:true` apps ([#&#8203;13221](https://redirect.github.com/remix-run/react-router/pull/13221))\n-   UNSTABLE: Fix `RequestHandler` `loadContext` parameter type when middleware is enabled ([#&#8203;13204](https://redirect.github.com/remix-run/react-router/pull/13204))\n-   UNSTABLE: Update `Route.unstable_MiddlewareFunction` to have a return value of `Response | undefined` instead of `Response | void` becaue you should not return anything if you aren't returning the `Response` ([#&#8203;13199](https://redirect.github.com/remix-run/react-router/pull/13199))\n-   UNSTABLE(BREAKING): If a middleware throws an error, ensure we only bubble the error itself via `next()` and are no longer leaking the `MiddlewareError` implementation detail ([#&#8203;13180](https://redirect.github.com/remix-run/react-router/pull/13180))\n\n### [`v7.3.0`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#730)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.2.0...react-router@7.3.0)\n\n##### Minor Changes\n\n-   Add `fetcherKey` as a parameter to `patchRoutesOnNavigation` ([#&#8203;13061](https://redirect.github.com/remix-run/react-router/pull/13061))\n\n    -   In framework mode, Lazy Route Discovery will now detect manifest version mismatches after a new deploy\n    -   On navigations to undiscovered routes, this mismatch will trigger a document reload of the destination path\n    -   On `fetcher` calls to undiscovered routes, this mismatch will trigger a document reload of the current path\n\n##### Patch Changes\n\n-   Skip resource route flow in dev server in SPA mode ([#&#8203;13113](https://redirect.github.com/remix-run/react-router/pull/13113))\n\n-   Support middleware on routes (unstable) ([#&#8203;12941](https://redirect.github.com/remix-run/react-router/pull/12941))\n\n    Middleware is implemented behind a `future.unstable_middleware` flag. To enable, you must enable the flag and the types in your `react-router-config.ts` file:\n\n    ```ts\n    import type { Config } from \"@&#8203;react-router/dev/config\";\n    import type { Future } from \"react-router\";\n\n    declare module \"react-router\" {\n      interface Future {\n        unstable_middleware: true; // \ud83d\udc48 Enable middleware types\n      }\n    }\n\n    export default {\n      future: {\n        unstable_middleware: true, // \ud83d\udc48 Enable middleware\n      },\n    } satisfies Config;\n    ```\n\n    \u26a0\ufe0f Middleware is unstable and should not be adopted in production. There is at least one known de-optimization in route module loading for `clientMiddleware` that we will be addressing this before a stable release.\n\n    \u26a0\ufe0f Enabling middleware contains a breaking change to the `context` parameter passed to your `loader`/`action` functions - see below for more information.\n\n    Once enabled, routes can define an array of middleware functions that will run sequentially before route handlers run. These functions accept the same parameters as `loader`/`action` plus an additional `next` parameter to run the remaining data pipeline. This allows middlewares to perform logic before and after handlers execute.\n\n    ```tsx\n    // Framework mode\n    export const unstable_middleware = [serverLogger, serverAuth]; // server\n    export const unstable_clientMiddleware = [clientLogger]; // client\n\n    // Library mode\n    const routes = [\n      {\n        path: \"/\",\n        // Middlewares are client-side for library mode SPA's\n        unstable_middleware: [clientLogger, clientAuth],\n        loader: rootLoader,\n        Component: Root,\n      },\n    ];\n    ```\n\n    Here's a simple example of a client-side logging middleware that can be placed on the root route:\n\n    ```tsx\n    const clientLogger: Route.unstable_ClientMiddlewareFunction = async (\n      { request },\n      next\n    ) => {\n      let start = performance.now();\n\n      // Run the remaining middlewares and all route loaders\n      await next();\n\n      let duration = performance.now() - start;\n      console.log(`Navigated to ${request.url} (${duration}ms)`);\n    };\n    ```\n\n    Note that in the above example, the `next`/`middleware` functions don't return anything. This is by design as on the client there is no \"response\" to send over the network like there would be for middlewares running on the server. The data is all handled behind the scenes by the stateful `router`.\n\n    For a server-side middleware, the `next` function will return the HTTP `Response` that React Router will be sending across the wire, thus giving you a chance to make changes as needed. You may throw a new response to short circuit and respond immediately, or you may return a new or altered response to override the default returned by `next()`.\n\n    ```tsx\n    const serverLogger: Route.unstable_MiddlewareFunction = async (\n      { request, params, context },\n      next\n    ) => {\n      let start = performance.now();\n\n      // \ud83d\udc47 Grab the response here\n      let res = await next();\n\n      let duration = performance.now() - start;\n      console.log(`Navigated to ${request.url} (${duration}ms)`);\n\n      // \ud83d\udc47 And return it here (optional if you don't modify the response)\n      return res;\n    };\n    ```\n\n    You can throw a `redirect` from a middleware to short circuit any remaining processing:\n\n    ```tsx\n    import { sessionContext } from \"../context\";\n    const serverAuth: Route.unstable_MiddlewareFunction = (\n      { request, params, context },\n      next\n    ) => {\n      let session = context.get(sessionContext);\n      let user = session.get(\"user\");\n      if (!user) {\n        session.set(\"returnTo\", request.url);\n        throw redirect(\"/login\", 302);\n      }\n    };\n    ```\n\n    *Note that in cases like this where you don't need to do any post-processing you don't need to call the `next` function or return a `Response`.*\n\n    Here's another example of using a server middleware to detect 404s and check the CMS for a redirect:\n\n    ```tsx\n    const redirects: Route.unstable_MiddlewareFunction = async ({\n      request,\n      next,\n    }) => {\n      // attempt to handle the request\n      let res = await next();\n\n      // if it's a 404, check the CMS for a redirect, do it last\n      // because it's expensive\n      if (res.status === 404) {\n        let cmsRedirect = await checkCMSRedirects(request.url);\n        if (cmsRedirect) {\n          throw redirect(cmsRedirect, 302);\n        }\n      }\n\n      return res;\n    };\n    ```\n\n    **`context` parameter**\n\n    When middleware is enabled, your application will use a different type of `context` parameter in your loaders and actions to provide better type safety. Instead of `AppLoadContext`, `context` will now be an instance of `ContextProvider` that you can use with type-safe contexts (similar to `React.createContext`):\n\n    ```ts\n    import { unstable_createContext } from \"react-router\";\n    import { Route } from \"./+types/root\";\n    import type { Session } from \"./sessions.server\";\n    import { getSession } from \"./sessions.server\";\n\n    let sessionContext = unstable_createContext<Session>();\n\n    const sessionMiddleware: Route.unstable_MiddlewareFunction = ({\n      context,\n      request,\n    }) => {\n      let session = await getSession(request);\n      context.set(sessionContext, session);\n      //                          ^ must be of type Session\n    };\n\n    // ... then in some downstream middleware\n    const loggerMiddleware: Route.unstable_MiddlewareFunction = ({\n      context,\n      request,\n    }) => {\n      let session = context.get(sessionContext);\n      //  ^ typeof Session\n      console.log(session.get(\"userId\"), request.method, request.url);\n    };\n\n    // ... or some downstream loader\n    export function loader({ context }: Route.LoaderArgs) {\n      let session = context.get(sessionContext);\n      let profile = await getProfile(session.get(\"userId\"));\n      return { profile };\n    }\n    ```\n\n    If you are using a custom server with a `getLoadContext` function, the return value for initial context values passed from the server adapter layer is no longer an object and should now return an `unstable_InitialContext` (`Map<RouterContext, unknown>`):\n\n    ```ts\n    let adapterContext = unstable_createContext<MyAdapterContext>();\n\n    function getLoadContext(req, res): unstable_InitialContext {\n      let map = new Map();\n      map.set(adapterContext, getAdapterContext(req));\n      return map;\n    }\n    ```\n\n-   Fix types for loaderData and actionData that contained `Record`s ([#&#8203;13139](https://redirect.github.com/remix-run/react-router/pull/13139))\n\n    UNSTABLE(BREAKING):\n\n    `unstable_SerializesTo` added a way to register custom serialization types in Single Fetch for other library and framework authors like Apollo.\n    It was implemented with branded type whose branded property that was made optional so that casting arbitrary values was easy:\n\n    ```ts\n    // without the brand being marked as optional\n    let x1 = 42 as unknown as unstable_SerializesTo<number>;\n    //          ^^^^^^^^^^\n\n    // with the brand being marked as optional\n    let x2 = 42 as unstable_SerializesTo<number>;\n    ```\n\n    However, this broke type inference in `loaderData` and `actionData` for any `Record` types as those would now (incorrectly) match `unstable_SerializesTo`.\n    This affected all users, not just those that depended on `unstable_SerializesTo`.\n    To fix this, the branded property of `unstable_SerializesTo` is marked as required instead of optional.\n\n    For library and framework authors using `unstable_SerializesTo`, you may need to add `as unknown` casts before casting to `unstable_SerializesTo`.\n\n-   \\[REMOVE] Remove middleware depth logic and always call middlware for all matches ([#&#8203;13172](https://redirect.github.com/remix-run/react-router/pull/13172))\n\n-   Fix single fetch `_root.data` requests when a `basename` is used ([#&#8203;12898](https://redirect.github.com/remix-run/react-router/pull/12898))\n\n-   Add `context` support to client side data routers (unstable) ([#&#8203;12941](https://redirect.github.com/remix-run/react-router/pull/12941))\n\n    Your application `loader` and `action` functions on the client will now receive a `context` parameter. This is an instance of `unstable_RouterContextProvider` that you use with type-safe contexts (similar to `React.createContext`) and is most useful with the corresponding `middleware`/`clientMiddleware` API's:\n\n    ```ts\n    import { unstable_createContext } from \"react-router\";\n\n    type User = {\n      /*...*/\n    };\n\n    let userContext = unstable_createContext<User>();\n\n    function sessionMiddleware({ context }) {\n      let user = await getUser();\n      context.set(userContext, user);\n    }\n\n    // ... then in some downstream loader\n    function loader({ context }) {\n      let user = context.get(userContext);\n      let profile = await getProfile(user.id);\n      return { profile };\n    }\n    ```\n\n    Similar to server-side requests, a fresh `context` will be created per navigation (or `fetcher` call). If you have initial data you'd like to populate in the context for every request, you can provide an `unstable_getContext` function at the root of your app:\n\n    -   Library mode - `createBrowserRouter(routes, { unstable_getContext })`\n    -   Framework mode - `<HydratedRouter unstable_getContext>`\n\n    This function should return an value of type `unstable_InitialContext` which is a `Map<unstable_RouterContext, unknown>` of context's and initial values:\n\n    ```ts\n    const loggerContext = unstable_createContext<(...args: unknown[]) => void>();\n\n    function logger(...args: unknown[]) {\n      console.log(new Date.toISOString(), ...args);\n    }\n\n    function unstable_getContext() {\n      let map = new Map();\n      map.set(loggerContext, logger);\n      return map;\n    }\n    ```\n\n### [`v7.2.0`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#720)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.1.5...react-router@7.2.0)\n\n##### Minor Changes\n\n-   New type-safe `href` utility that guarantees links point to actual paths in your app ([#&#8203;13012](https://redirect.github.com/remix-run/react-router/pull/13012))\n\n    ```tsx\n    import { href } from \"react-router\";\n\n    export default function Component() {\n      const link = href(\"/blog/:slug\", { slug: \"my-first-post\" });\n      return (\n        <main>\n          <Link to={href(\"/products/:id\", { id: \"asdf\" })} />\n          <NavLink to={href(\"/:lang?/about\", { lang: \"en\" })} />\n        </main>\n      );\n    }\n    ```\n\n##### Patch Changes\n\n-   Fix typegen for repeated params ([#&#8203;13012](https://redirect.github.com/remix-run/react-router/pull/13012))\n\n    In React Router, path parameters are keyed by their name.\n    So for a path pattern like `/a/:id/b/:id?/c/:id`, the last `:id` will set the value for `id` in `useParams` and the `params` prop.\n    For example, `/a/1/b/2/c/3` will result in the value `{ id: 3 }` at runtime.\n\n    Previously, generated types for params incorrectly modeled repeated params with an array.\n    So `/a/1/b/2/c/3` generated a type like `{ id: [1,2,3] }`.\n\n    To be consistent with runtime behavior, the generated types now correctly model the \"last one wins\" semantics of path parameters.\n    So `/a/1/b/2/c/3` now generates a type like `{ id: 3 }`.\n\n-   Don't apply Single Fetch revalidation de-optimization when in SPA mode since there is no server HTTP request ([#&#8203;12948](https://redirect.github.com/remix-run/react-router/pull/12948))\n\n-   Properly handle revalidations to across a prerender/SPA boundary ([#&#8203;13021](https://redirect.github.com/remix-run/react-router/pull/13021))\n\n    -   In \"hybrid\" applications where some routes are pre-rendered and some are served from a SPA fallback, we need to avoid making `.data` requests if the path wasn't pre-rendered because the request will 404\n    -   We don't know all the pre-rendered paths client-side, however:\n        -   All `loader` data in `ssr:false` mode is static because it's generated at build time\n        -   A route must use a `clientLoader` to do anything dynamic\n        -   Therefore, if a route only has a `loader` and not a `clientLoader`, we disable revalidation by default because there is no new data to retrieve\n        -   We short circuit and skip single fetch `.data` request logic if there are no server loaders with `shouldLoad=true` in our single fetch `dataStrategy`\n        -   This ensures that the route doesn't cause a `.data` request that would 404 after a submission\n\n-   Error at build time in `ssr:false` + `prerender` apps for the edge case scenario of: ([#&#8203;13021](https://redirect.github.com/remix-run/react-router/pull/13021))\n\n    -   A parent route has only a `loader` (does not have a `clientLoader`)\n    -   The parent route is pre-rendered\n    -   The parent route has children routes which are not prerendered\n    -   This means that when the child paths are loaded via the SPA fallback, the parent won't have any `loaderData` because there is no server on which to run the `loader`\n    -   This can be resolved by either adding a parent `clientLoader` or pre-rendering the child paths\n    -   If you add a `clientLoader`, calling the `serverLoader()` on non-prerendered paths will throw a 404\n\n-   Add unstable support for splitting route modules in framework mode via `future.unstable_splitRouteModules` ([#&#8203;11871](https://redirect.github.com/remix-run/react-router/pull/11871))\n\n-   Add `unstable_SerializesTo` brand type for library authors to register types serializable by React Router's streaming format (`turbo-stream`) ([`ab5b05b02`](https://redirect.github.com/remix-run/react-router/commit/ab5b05b02f99f062edb3c536c392197c88eb6c77))\n\n-   Align dev server behavior with static file server behavior when `ssr:false` is set ([#&#8203;12948](https://redirect.github.com/remix-run/react-router/pull/12948))\n\n    -   When no `prerender` config exists, only SSR down to the root `HydrateFallback` (SPA Mode)\n    -   When a `prerender` config exists but the current path is not prerendered, only SSR down to the root `HydrateFallback` (SPA Fallback)\n    -   Return a 404 on `.data` requests to non-pre-rendered paths\n\n-   Improve prefetch performance of CSS side effects in framework mode ([#&#8203;12889](https://redirect.github.com/remix-run/react-router/pull/12889))\n\n-   Disable Lazy Route Discovery for all `ssr:false` apps and not just \"SPA Mode\" because there is no runtime server to serve the search-param-configured `__manifest` requests ([#&#8203;12894](https://redirect.github.com/remix-run/react-router/pull/12894))\n\n    -   We previously only disabled this for \"SPA Mode\" which is `ssr:false` and no `prerender` config but we realized it should apply to all `ssr:false` apps, including those prerendering multiple pages\n    -   In those `prerender` scenarios we would prerender the `/__manifest` file assuming the static file server would serve it but that makes some unneccesary assumptions about the static file server behaviors\n\n-   Properly handle interrupted manifest requests in lazy route discovery ([#&#8203;12915](https://redirect.github.com/remix-run/react-router/pull/12915))\n\n### [`v7.1.5`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#715)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.1.4...react-router@7.1.5)\n\n##### Patch Changes\n\n-   Fix regression introduced in `7.1.4` via [#&#8203;12800](https://redirect.github.com/remix-run/react-router/pull/12800) that caused issues navigating to hash routes inside splat routes for applications using Lazy Route Discovery (`patchRoutesOnNavigation`) ([#&#8203;12927](https://redirect.github.com/remix-run/react-router/pull/12927))\n\n### [`v7.1.4`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#714)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.1.3...react-router@7.1.4)\n\n##### Patch Changes\n\n-   Internal reorg to clean up some duplicated route module types ([#&#8203;12799](https://redirect.github.com/remix-run/react-router/pull/12799))\n-   Properly handle status codes that cannot have a body in single fetch responses (204, etc.) ([#&#8203;12760](https://redirect.github.com/remix-run/react-router/pull/12760))\n-   Stop erroring on resource routes that return raw strings/objects and instead serialize them as `text/plain` or `application/json` responses ([#&#8203;12848](https://redirect.github.com/remix-run/react-router/pull/12848))\n    -   This only applies when accessed as a resource route without the `.data` extension\n    -   When accessed from a Single Fetch `.data` request, they will still be encoded via `turbo-stream`\n-   Optimize Lazy Route Discovery path discovery to favor a single `querySelectorAll` call at the `body` level instead of many calls at the sub-tree level ([#&#8203;12731](https://redirect.github.com/remix-run/react-router/pull/12731))\n-   Properly bubble headers as `errorHeaders` when throwing a `data()` result ([#&#8203;12846](https://redirect.github.com/remix-run/react-router/pull/12846))\n    -   Avoid duplication of `Set-Cookie` headers could be duplicated if also returned from `headers`\n-   Optimize route matching by skipping redundant `matchRoutes` calls when possible ([#&#8203;12800](https://redirect.github.com/remix-run/react-router/pull/12800))\n\n### [`v7.1.3`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#713)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.1.2...react-router@7.1.3)\n\n*No changes*\n\n### [`v7.1.2`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#712)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.1.1...react-router@7.1.2)\n\n##### Patch Changes\n\n-   Fix issue with fetcher data cleanup in the data layer on fetcher unmount ([#&#8203;12681](https://redirect.github.com/remix-run/react-router/pull/12681))\n-   Do not rely on `symbol` for filtering out `redirect` responses from loader data ([#&#8203;12694](https://redirect.github.com/remix-run/react-router/pull/12694))\n\n    Previously, some projects were getting type checking errors like:\n\n    ```ts\n    error TS4058: Return type of exported function has or is using name 'redirectSymbol' from external module \"node_modules/...\" but cannot be named.\n    ```\n\n    Now that `symbol`s are not used for the `redirect` response type, these errors should no longer be present.\n\n### [`v7.1.1`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#711)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.1.0...react-router@7.1.1)\n\n*No changes*\n\n### [`v7.1.0`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#710)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.0.2...react-router@7.1.0)\n\n##### Patch Changes\n\n-   Throw unwrapped single fetch redirect to align with pre-single fetch behavior ([#&#8203;12506](https://redirect.github.com/remix-run/react-router/pull/12506))\n-   Ignore redirects when inferring loader data types ([#&#8203;12527](https://redirect.github.com/remix-run/react-router/pull/12527))\n-   Remove `<Link prefetch>` warning which suffers from false positives in a lazy route discovery world ([#&#8203;12485](https://redirect.github.com/remix-run/react-router/pull/12485))\n\n### [`v7.0.2`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#702)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.0.1...react-router@7.0.2)\n\n##### Patch Changes\n\n-   temporarily only use one build in export map so packages can have a peer dependency on react router ([#&#8203;12437](https://redirect.github.com/remix-run/react-router/pull/12437))\n-   Generate wide `matches` and `params` types for current route and child routes ([#&#8203;12397](https://redirect.github.com/remix-run/react-router/pull/12397))\n\n    At runtime, `matches` includes child route matches and `params` include child route path parameters.\n    But previously, we only generated types for parent routes in `matches`; for `params`, we only considered the parent routes and the current route.\n    To align our generated types more closely to the runtime behavior, we now generate more permissive, wider types when accessing child route information.\n\n### [`v7.0.1`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#701)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@7.0.0...react-router@7.0.1)\n\n*No changes*\n\n### [`v7.0.0`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#700)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.30.0...react-router@7.0.0)\n\n##### Major Changes\n\n-   Remove the original `defer` implementation in favor of using raw promises via single fetch and `turbo-stream`. This removes these exports from React Router: ([#&#8203;11744](https://redirect.github.com/remix-run/react-router/pull/11744))\n\n    -   `defer`\n    -   `AbortedDeferredError`\n    -   `type TypedDeferredData`\n    -   `UNSAFE_DeferredData`\n    -   `UNSAFE_DEFERRED_SYMBOL`,\n\n-   -   Collapse `@remix-run/router` into `react-router` ([#&#8203;11505](https://redirect.github.com/remix-run/react-router/pull/11505))\n    -   Collapse `react-router-dom` into `react-router`\n    -   Collapse `@remix-run/server-runtime` into `react-router`\n    -   Collapse `@remix-run/testing` into `react-router`\n\n-   Remove single fetch future flag. ([#&#8203;11522](https://redirect.github.com/remix-run/react-router/pull/11522))\n\n-   Drop support for Node 16, React Router SSR now requires Node 18 or higher ([#&#8203;11391](https://redirect.github.com/remix-run/react-router/pull/11391))\n\n-   Remove `future.v7_startTransition` flag ([#&#8203;11696](https://redirect.github.com/remix-run/react-router/pull/11696))\n\n-   -   Expose the underlying router promises from the following APIs for compsition in React 19 APIs: ([#&#8203;11521](https://redirect.github.com/remix-run/react-router/pull/11521))\n        -   `useNavigate()`\n        -   `useSubmit`\n        -   `useFetcher().load`\n        -   `useFetcher().submit`\n        -   `useRevalidator.revalidate`\n\n-   Remove `future.v7_normalizeFormMethod` future flag ([#&#8203;11697](https://redirect.github.com/remix-run/react-router/pull/11697))\n\n-   For Remix consumers migrating to React Router, the `crypto` global from the [Web Crypto API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API) is now required when using cookie and session APIs. This means that the following APIs are provided from `react-router` rather than platform-specific packages: ([#&#8203;11837](https://redirect.github.com/remix-run/react-router/pull/11837))\n\n    -   `createCookie`\n    -   `createCookieSessionStorage`\n    -   `createMemorySessionStorage`\n    -   `createSessionStorage`\n\n    For consumers running older versions of Node, the `installGlobals` function from `@remix-run/node` has been updated to define `globalThis.crypto`, using [Node's `require('node:crypto').webcrypto` implementation.](https://nodejs.org/api/webcrypto.html)\n\n    Since platform-specific packages no longer need to implement this API, the following low-level APIs have been removed:\n\n    -   `createCookieFactory`\n    -   `createSessionStorageFactory`\n    -   `createCookieSessionStorageFactory`\n    -   `createMemorySessionStorageFactory`\n\n-   Imports/Exports cleanup ([#&#8203;11840](https://redirect.github.com/remix-run/react-router/pull/11840))\n\n    -   Removed the following exports that were previously public API from `@remix-run/router`\n        -   types\n            -   `AgnosticDataIndexRouteObject`\n            -   `AgnosticDataNonIndexRouteObject`\n            -   `AgnosticDataRouteMatch`\n            -   `AgnosticDataRouteObject`\n            -   `AgnosticIndexRouteObject`\n            -   `AgnosticNonIndexRouteObject`\n            -   `AgnosticRouteMatch`\n            -   `AgnosticRouteObject`\n            -   `TrackedPromise`\n            -   `unstable_AgnosticPatchRoutesOnMissFunction`\n            -   `Action` -> exported as `NavigationType` via `react-router`\n            -   `Router` exported as `DataRouter` to differentiate from RR's `<Router>`\n        -   API\n            -   `getToPathname` (`@private`)\n            -   `joinPaths` (`@private`)\n            -   `normalizePathname` (`@private`)\n            -   `resolveTo` (`@private`)\n            -   `stripBasename` (`@private`)\n            -   `createBrowserHistory` -> in favor of `createBrowserRouter`\n            -   `createHashHistory` -> in favor of `createHashRouter`\n            -   `createMemoryHistory` -> in favor of `createMemoryRouter`\n            -   `createRouter`\n            -   `createStaticHandler` -> in favor of wrapper `createStaticHandler` in RR Dom\n            -   `getStaticContextFromError`\n    -   Removed the following exports that were previously public API from `react-router`\n        -   `Hash`\n        -   `Pathname`\n        -   `Search`\n\n-   update minimum node version to 18 ([#&#8203;11690](https://redirect.github.com/remix-run/react-router/pull/11690))\n\n-   Remove `future.v7_prependBasename` from the ionternalized `@remix-run/router` package ([#&#8203;11726](https://redirect.github.com/remix-run/react-router/pull/11726))\n\n-   Migrate Remix type generics to React Router ([#&#8203;12180](https://redirect.github.com/remix-run/react-router/pull/12180))\n\n    -   These generics are provided for Remix v2 migration purposes\n    -   These generics and the APIs they exist on should be considered informally deprecated in favor of the new `Route.*` types\n    -   Anyone migrating from React Router v6 should probably not leverage these new generics and should migrate straight to the `Route.*` types\n    -   For React Router v6 users, these generics are new and should not impact your app, with one exception\n        -   `useFetcher` previously had an optional generic (used primarily by Remix v2) that expected the data type\n        -   This has been updated in v7 to expect the type of the function that generates the data (i.e., `typeof loader`/`typeof action`)\n        -   Therefore, you should update your usages:\n            -   \u274c `useFetcher<LoaderData>()`\n            -   \u2705 `useFetcher<typeof loader>()`\n\n-   Remove `future.v7_throwAbortReason` from internalized `@remix-run/router` package ([#&#8203;11728](https://redirect.github.com/remix-run/react-router/pull/11728))\n\n-   Add `exports` field to all packages ([#&#8203;11675](https://redirect.github.com/remix-run/react-router/pull/11675))\n\n-   node package no longer re-exports from react-router ([#&#8203;11702](https://redirect.github.com/remix-run/react-router/pull/11702))\n\n-   renamed RemixContext to FrameworkContext ([#&#8203;11705](https://redirect.github.com/remix-run/react-router/pull/11705))\n\n-   updates the minimum React version to 18 ([#&#8203;11689](https://redirect.github.com/remix-run/react-router/pull/11689))\n\n-   PrefetchPageDescriptor replaced by PageLinkDescriptor ([#&#8203;11960](https://redirect.github.com/remix-run/react-router/pull/11960))\n\n-   -   Consolidate types previously duplicated across `@remix-run/router`, `@remix-run/server-runtime`, and `@remix-run/react` now that they all live in `react-router` ([#&#8203;12177](https://redirect.github.com/remix-run/react-router/pull/12177))\n        -   Examples: `LoaderFunction`, `LoaderFunctionArgs`, `ActionFunction`, `ActionFunctionArgs`, `DataFunctionArgs`, `RouteManifest`, `LinksFunction`, `Route`, `EntryRoute`\n        -   The `RouteManifest` type used by the \"remix\" code is now slightly stricter because it is using the former `@remix-run/router` `RouteManifest`\n            -   `Record<string, Route> -> Record<string, Route | undefined>`\n        -   Removed `AppData` type in favor of inlining `unknown` in the few locations it was used\n        -   Removed `ServerRuntimeMeta*` types in favor of the `Meta*` types they were duplicated from\n\n-   -   Remove the `future.v7_partialHydration` flag ([#&#8203;11725](https://redirect.github.com/remix-run/react-router/pull/11725))\n        -   This also removes the `<RouterProvider fallbackElement>` prop\n            -   To migrate, move the `fallbackElement` to a `hydrateFallbackElement`/`HydrateFallback` on your root route\n        -   Also worth nothing there is a related breaking changer with this future flag:\n            -   Without `future.v7_partialHydration` (when using `fallbackElement`), `state.navigation` was populated during the initial load\n            -   With `future.v7_partialHydration`, `state.navigation` remains in an `\"idle\"` state during the initial load\n\n-   Remove `v7_relativeSplatPath` future flag ([#&#8203;11695](https://redirect.github.com/remix-run/react-router/pull/11695))\n\n-   Drop support for Node 18, update minimum Node vestion to 20 ([#&#8203;12171](https://redirect.github.com/remix-run/react-router/pull/12171))\n\n    -   Remove `installGlobals()` as this should no longer be necessary\n\n-   Remove remaining future flags ([#&#8203;11820](https://redirect.github.com/remix-run/react-router/pull/11820))\n\n    -   React Router `v7_skipActionErrorRevalidation`\n    -   Remix `v3_fetcherPersist`, `v3_relativeSplatPath`, `v3_throwAbortReason`\n\n-   rename createRemixStub to createRoutesStub ([#&#8203;11692](https://redirect.github.com/remix-run/react-router/pull/11692))\n\n-   Remove `@remix-run/router` deprecated `detectErrorBoundary` option in favor of `mapRouteProperties` ([#&#8203;11751](https://redirect.github.com/remix-run/react-router/pull/11751))\n\n-   Add `react-router/dom` subpath export to properly enable `react-dom` as an optional `peerDependency` ([#&#8203;11851](https://redirect.github.com/remix-run/react-router/pull/11851))\n\n    -   This ensures that we don't blindly `import ReactDOM from \"react-dom\"` in `<RouterProvider>` in order to access `ReactDOM.flushSync()`, since that would break `createMemoryRouter` use cases in non-DOM environments\n    -   DOM environments should import from `react-router/dom` to get the proper component that makes `ReactDOM.flushSync()` available:\n        -   If you are using the Vite plugin, use this in your `entry.client.tsx`:\n            -   `import { HydratedRouter } from 'react-router/dom'`\n        -   If you are not using the Vite plugin and are manually calling `createBrowserRouter`/`createHashRouter`:\n            -   `import { RouterProvider } from \"react-router/dom\"`\n\n-   Remove `future.v7_fetcherPersist` flag ([#&#8203;11731](https://redirect.github.com/remix-run/react-router/pull/11731))\n\n-   Update `cookie` dependency to `^1.0.1` - please see the [release notes](https://redirect.github.com/jshttp/cookie/releases) for any breaking changes ([#&#8203;12172](https://redirect.github.com/remix-run/react-router/pull/12172))\n\n##### Minor Changes\n\n-   -   Add support for `prerender` config in the React Router vite plugin, to support existing SSG use-cases ([#&#8203;11539](https://redirect.github.com/remix-run/react-router/pull/11539))\n        -   You can use the `prerender` config to pre-render your `.html` and `.data` files at build time and then serve them statically at runtime (either from a running server or a CDN)\n        -   `prerender` can either be an array of string paths, or a function (sync or async) that returns an array of strings so that you can dynamically generate the paths by talking to your CMS, etc.\n\n    ```ts\n    // react-router.config.ts\n    import type { Config } from \"@&#8203;react-router/dev/config\";\n\n    export default {\n      async prerender() {\n        let slugs = await fakeGetSlugsFromCms();\n        // Prerender these paths into `.html` files at build time, and `.data`\n        // files if they have loaders\n        return [\"/\", \"/about\", ...slugs.map((slug) => `/product/${slug}`)];\n      },\n    } satisfies Config;\n\n    async function fakeGetSlugsFromCms() {\n      await new Promise((r) => setTimeout(r, 1000));\n      return [\"shirt\", \"hat\"];\n    }\n    ```\n\n-   Params, loader data, and action data as props for route component exports ([#&#8203;11961](https://redirect.github.com/remix-run/react-router/pull/11961))\n\n    ```tsx\n    export default function Component({ params, loaderData, actionData }) {}\n\n    export function HydrateFallback({ params }) {}\n    export function ErrorBoundary({ params, loaderData, actionData }) {}\n    ```\n\n-   Remove duplicate `RouterProvider` impliementations ([#&#8203;11679](https://redirect.github.com/remix-run/react-router/pull/11679))\n\n-   ### Typesafety improvements ([#&#8203;12019](https://redirect.github.com/remix-run/react-router/pull/12019))\n\n    React Router now generates types for each of your route modules.\n    You can access those types by importing them from `./+types.<route filename without extension>`.\n    For example:\n\n    ```ts\n    // app/routes/product.tsx\n    import type * as Route from \"./+types.product\";\n\n    export function loader({ params }: Route.LoaderArgs) {}\n\n    export default function Component({ loaderData }: Route.ComponentProps) {}\n    ```\n\n    This initial implementation targets type inference for:\n\n    -   `Params` : Path parameters from your routing config in `routes.ts` including file-based routing\n    -   `LoaderData` : Loader data from `loader` and/or `clientLoader` within your route module\n    -   `ActionData` : Action data from `action` and/or `clientAction` within your route module\n\n    In the future, we plan to add types for the rest of the route module exports: `meta`, `links`, `headers`, `shouldRevalidate`, etc.\n    We also plan to generate types for typesafe `Link`s:\n\n    ```tsx\n    <Link to=\"/products/:id\" params={{ id: 1 }} />\n    //        ^^^^^^^^^^^^^          ^^^^^^^^^\n    // typesafe `to` and `params` based on the available routes in your app\n    ```\n\n    Check out our docs for more:\n\n    -   [*Explanations > Type Safety*](https://reactrouter.com/dev/guides/explanation/type-safety)\n    -   [*How-To > Setting up type safety*](https://reactrouter.com/dev/guides/how-to/setting-up-type-safety)\n\n-   Stabilize `unstable_dataStrategy` ([#&#8203;11969](https://redirect.github.com/remix-run/react-router/pull/11969))\n\n-   Stabilize `unstable_patchRoutesOnNavigation` ([#&#8203;11970](https://redirect.github.com/remix-run/react-router/pull/11970))\n\n##### Patch Changes\n\n-   No changes ([`506329c4e`](https://redirect.github.com/remix-run/react-router/commit/506329c4e2e7aba9837cbfa44df6103b49423745))\n\n-   chore: re-enable development warnings through a `development` exports condition. ([#&#8203;12269](https://redirect.github.com/remix-run/react-router/pull/12269))\n\n-   Remove unstable upload handler. ([#&#8203;12015](https://redirect.github.com/remix-run/react-router/pull/12015))\n\n-   Remove unneeded dependency on [@&#8203;web3-storage/multipart-parser](https://redirect.github.com/web3-storage/multipart-parser) ([#&#8203;12274](https://redirect.github.com/remix-run/react-router/pull/12274))\n\n-   Fix redirects returned from loaders/actions using `data()` ([#&#8203;12021](https://redirect.github.com/remix-run/react-router/pull/12021))\n\n-   fix(react-router): (v7) fix static prerender of non-ascii characters ([#&#8203;12161](https://redirect.github.com/remix-run/react-router/pull/12161))\n\n-   Replace `substr` with `substring` ([#&#8203;12080](https://redirect.github.com/remix-run/react-router/pull/12080))\n\n-   Remove the deprecated `json` utility ([#&#8203;12146](https://redirect.github.com/remix-run/react-router/pull/12146))\n\n    -   You can use [`Response.json`](https://developer.mozilla.org/en-US/docs/Web/API/Response/json_static) if you still need to construct JSON responses in your app\n\n-   Remove unneeded dependency on source-map ([#&#8203;12275](https://redirect.github.com/remix-run/react-router/pull/12275))\n\n### [`v6.30.0`](https://redirect.github.com/remix-run/react-router/releases/tag/react-router%406.30.0): v6.30.0\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.29.0...react-router@6.30.0)\n\nSee the changelog for release notes: https://github.com/remix-run/react-router/blob/main/CHANGELOG.md#v6300\n\n### [`v6.29.0`](https://redirect.github.com/remix-run/react-router/releases/tag/react-router%406.29.0): v6.29.0\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.28.2...react-router@6.29.0)\n\nSee the changelog for release notes: https://github.com/remix-run/react-router/blob/main/CHANGELOG.md#v6290\n\n### [`v6.28.2`](https://redirect.github.com/remix-run/react-router/releases/tag/react-router%406.28.2): v6.28.2\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.28.1...react-router@6.28.2)\n\nSee the changelog for release notes: https://github.com/remix-run/react-router/blob/main/CHANGELOG.md#v6282\n\n### [`v6.28.1`](https://redirect.github.com/remix-run/react-router/releases/tag/react-router%406.28.1): v6.28.1\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.28.0...react-router@6.28.1)\n\nSee the changelog for release notes: https://github.com/remix-run/react-router/blob/main/CHANGELOG.md#v6281\n\n### [`v6.28.0`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#6280)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.27.0...react-router@6.28.0)\n\n##### Minor Changes\n\n-   -   Log deprecation warnings for v7 flags ([#&#8203;11750](https://redirect.github.com/remix-run/react-router/pull/11750))\n    -   Add deprecation warnings to `json`/`defer` in favor of returning raw objects\n        -   These methods will be removed in React Router v7\n\n##### Patch Changes\n\n-   Update JSDoc URLs for new website structure (add /v6/ segment) ([#&#8203;12141](https://redirect.github.com/remix-run/react-router/pull/12141))\n-   Updated dependencies:\n    -   `@remix-run/router@1.21.0`\n\n### [`v6.27.0`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#6270)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.26.2...react-router@6.27.0)\n\n##### Minor Changes\n\n-   Stabilize `unstable_patchRoutesOnNavigation` ([#&#8203;11973](https://redirect.github.com/remix-run/react-router/pull/11973))\n    -   Add new `PatchRoutesOnNavigationFunctionArgs` type for convenience ([#&#8203;11967](https://redirect.github.com/remix-run/react-router/pull/11967))\n-   Stabilize `unstable_dataStrategy` ([#&#8203;11974](https://redirect.github.com/remix-run/react-router/pull/11974))\n-   Stabilize the `unstable_flushSync` option for navigations and fetchers ([#&#8203;11989](https://redirect.github.com/remix-run/react-router/pull/11989))\n-   Stabilize the `unstable_viewTransition` option for navigations and the corresponding `unstable_useViewTransitionState` hook ([#&#8203;11989](https://redirect.github.com/remix-run/react-router/pull/11989))\n\n##### Patch Changes\n\n-   Fix bug when submitting to the current contextual route (parent route with an index child) when an `?index` param already exists from a prior submission ([#&#8203;12003](https://redirect.github.com/remix-run/react-router/pull/12003))\n\n-   Fix `useFormAction` bug - when removing `?index` param it would not keep other non-Remix `index` params ([#&#8203;12003](https://redirect.github.com/remix-run/react-router/pull/12003))\n\n-   Fix types for `RouteObject` within `PatchRoutesOnNavigationFunction`'s `patch` method so it doesn't expect agnostic route objects passed to `patch` ([#&#8203;11967](https://redirect.github.com/remix-run/react-router/pull/11967))\n\n-   Updated dependencies:\n    -   `@remix-run/router@1.20.0`\n\n### [`v6.26.2`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#6262)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.26.1...react-router@6.26.2)\n\n##### Patch Changes\n\n-   Updated dependencies:\n    -   `@remix-run/router@1.19.2`\n\n### [`v6.26.1`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#6261)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.26.0...react-router@6.26.1)\n\n##### Patch Changes\n\n-   Rename `unstable_patchRoutesOnMiss` to `unstable_patchRoutesOnNavigation` to match new behavior ([#&#8203;11888](https://redirect.github.com/remix-run/react-router/pull/11888))\n-   Updated dependencies:\n    -   `@remix-run/router@1.19.1`\n\n### [`v6.26.0`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#6260)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.25.1...react-router@6.26.0)\n\n##### Minor Changes\n\n-   Add a new `replace(url, init?)` alternative to `redirect(url, init?)` that performs a `history.replaceState` instead of a `history.pushState` on client-side navigation redirects ([#&#8203;11811](https://redirect.github.com/remix-run/react-router/pull/11811))\n\n##### Patch Changes\n\n-   Fix initial hydration behavior when using `future.v7_partialHydration` along with `unstable_patchRoutesOnMiss` ([#&#8203;11838](https://redirect.github.com/remix-run/react-router/pull/11838))\n    -   During initial hydration, `router.state.matches` will now include any partial matches so that we can render ancestor `HydrateFallback` components\n-   Updated dependencies:\n    -   `@remix-run/router@1.19.0`\n\n### [`v6.25.1`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#6251)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.25.0...react-router@6.25.1)\n\nNo significant changes to this package were made in this release. [See the repo `CHANGELOG.md`](https://redirect.github.com/remix-run/react-router/blob/main/CHANGELOG.md) for an overview of all changes in v6.25.1.\n\n### [`v6.25.0`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#6250)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.24.1...react-router@6.25.0)\n\n##### Minor Changes\n\n-   Stabilize `future.unstable_skipActionErrorRevalidation` as `future.v7_skipActionErrorRevalidation` ([#&#8203;11769](https://redirect.github.com/remix-run/react-router/pull/11769))\n    -   When this flag is enabled, actions will not automatically trigger a revalidation if they return/throw a `Response` with a `4xx`/`5xx` status code\n    -   You may still opt-into revalidation via `shouldRevalidate`\n    -   This also changes `shouldRevalidate`'s `unstable_actionStatus` parameter to `actionStatus`\n\n##### Patch Changes\n\n-   Fix regression and properly decode paths inside `useMatch` so matches/params reflect decoded params ([#&#8203;11789](https://redirect.github.com/remix-run/react-router/pull/11789))\n-   Updated dependencies:\n    -   `@remix-run/router@1.18.0`\n\n### [`v6.24.1`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#6241)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.24.0...react-router@6.24.1)\n\n##### Patch Changes\n\n-   When using `future.v7_relativeSplatPath`, properly resolve relative paths in splat routes that are children of pathless routes ([#&#8203;11633](https://redirect.github.com/remix-run/react-router/pull/11633))\n-   Updated dependencies:\n    -   `@remix-run/router@1.17.1`\n\n### [`v6.24.0`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#6240)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.23.1...react-router@6.24.0)\n\n##### Minor Changes\n\n-   Add support for Lazy Route Discovery (a.k.a. Fog of War) ([#&#8203;11626](https://redirect.github.com/remix-run/react-router/pull/11626))\n    -   RFC: <https://redirect.github.com/remix-run/react-router/discussions/11113>\n    -   `unstable_patchRoutesOnMiss` docs: <https://reactrouter.com/v6/routers/create-browser-router>\n\n##### Patch Changes\n\n-   Updated dependencies:\n    -   `@remix-run/router@1.17.0`\n\n### [`v6.23.1`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#6231)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.23.0...react-router@6.23.1)\n\n##### Patch Changes\n\n-   allow undefined to be resolved with `<Await>` ([#&#8203;11513](https://redirect.github.com/remix-run/react-router/pull/11513))\n-   Updated dependencies:\n    -   `@remix-run/router@1.16.1`\n\n### [`v6.23.0`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#6230)\n\n[Compare Source](https://redirect.github.com/remix-run/react-router/compare/react-router@6.22.3...react-router@6.23.0)\n\n##### Minor Changes\n\n-   Add a new `unstable_dataStrategy` configuration option ([#&#8203;11098](https://redirect.github.com/remix-run/react-router/pull/11098))\n    -   This option allows Data Router applications to take control over the approach for executing route loaders and actions\n    -   The default implementation is today's behavior, to fetch all loaders in parallel, but this option allows users to implement more advanced data flows including Remix single-fetch, middleware/context APIs, automatic loader caching, and more\n\n##### Patch Changes\n\n-   Updated dependencies:\n    -   `@remix-run/router@1.16.0`\n\n### [`v6.22.3`](https://redirect.github.com/remix-run/react-router/blob/HEAD/packages/react-router/CHANGELOG.md#6223)\n\n[Compare Source](https://redir\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - \"\" (UTC), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNTcuMyIsInVwZGF0ZWRJblZlciI6IjM5LjI1Ny4zIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -1023,7 +1023,7 @@ export const AccountHeader: React.FC<{\n                   />\n                 </NavLink>\n               </div>\n-              <FamiliarFollowers accountId={accountId} />\n+              {signedIn && <FamiliarFollowers accountId={accountId} />}\n             </div>\n           )}\n         </div>\n---\n\n\n---\n\nChoice B:\npackage.json\n@@ -107,7 +107,7 @@\n     \"react-overlays\": \"^5.2.1\",\n     \"react-redux\": \"^9.0.4\",\n     \"react-redux-loading-bar\": \"^5.0.8\",\n-    \"react-router\": \"^5.3.4\",\n+    \"react-router\": \"^7.0.0\",\n     \"react-router-dom\": \"^5.3.4\",\n     \"react-router-scroll-4\": \"^1.0.0-beta.1\",\n     \"react-select\": \"^5.7.3\",\n---\nyarn.lock\n@@ -2936,7 +2936,7 @@ __metadata:\n     react-overlays: \"npm:^5.2.1\"\n     react-redux: \"npm:^9.0.4\"\n     react-redux-loading-bar: \"npm:^5.0.8\"\n-    react-router: \"npm:^5.3.4\"\n+    react-router: \"npm:^7.0.0\"\n     react-router-dom: \"npm:^5.3.4\"\n     react-router-scroll-4: \"npm:^1.0.0-beta.1\"\n     react-select: \"npm:^5.7.3\"\n@@ -6662,6 +6662,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"cookie@npm:^1.0.1\":\n+  version: 1.0.2\n+  resolution: \"cookie@npm:1.0.2\"\n+  checksum: 10c0/fd25fe79e8fbcfcaf6aa61cd081c55d144eeeba755206c058682257cb38c4bd6795c6620de3f064c740695bb65b7949ebb1db7a95e4636efb8357a335ad3f54b\n+  languageName: node\n+  linkType: hard\n+\n \"copy-descriptor@npm:^0.1.0\":\n   version: 0.1.1\n   resolution: \"copy-descriptor@npm:0.1.1\"\n@@ -14929,7 +14936,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-router@npm:5.3.4, react-router@npm:^5.3.4\":\n+\"react-router@npm:5.3.4\":\n   version: 5.3.4\n   resolution: \"react-router@npm:5.3.4\"\n   dependencies:\n@@ -14948,6 +14955,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"react-router@npm:^7.0.0\":\n+  version: 7.5.2\n+  resolution: \"react-router@npm:7.5.2\"\n+  dependencies:\n+    cookie: \"npm:^1.0.1\"\n+    set-cookie-parser: \"npm:^2.6.0\"\n+    turbo-stream: \"npm:2.4.0\"\n+  peerDependencies:\n+    react: \">=18\"\n+    react-dom: \">=18\"\n+  peerDependenciesMeta:\n+    react-dom:\n+      optional: true\n+  checksum: 10c0/5972ecb783e0ac0512c500b84bd4ff475665ba49c67b69e13b79dc24c7ee0496d523858058bb43c70147367688e0cc0d6d6d0f51cabfdebfbc5556d559bff457\n+  languageName: node\n+  linkType: hard\n+\n \"react-select@npm:^5.7.3\":\n   version: 5.10.1\n   resolution: \"react-select@npm:5.10.1\"\n@@ -15944,6 +15968,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"set-cookie-parser@npm:^2.6.0\":\n+  version: 2.7.1\n+  resolution: \"set-cookie-parser@npm:2.7.1\"\n+  checksum: 10c0/060c198c4c92547ac15988256f445eae523f57f2ceefeccf52d30d75dedf6bff22b9c26f756bd44e8e560d44ff4ab2130b178bd2e52ef5571bf7be3bd7632d9a\n+  languageName: node\n+  linkType: hard\n+\n \"set-function-length@npm:^1.2.2\":\n   version: 1.2.2\n   resolution: \"set-function-length@npm:1.2.2\"\n@@ -17530,6 +17561,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"turbo-stream@npm:2.4.0\":\n+  version: 2.4.0\n+  resolution: \"turbo-stream@npm:2.4.0\"\n+  checksum: 10c0/e68b2569f1f16e6e9633d090c6024b2ae9f0e97bfeacb572451ca3732e120ebbb546f3bc4afc717c46cb57b5aea6104e04ef497f9912eef6a7641e809518e98a\n+  languageName: node\n+  linkType: hard\n+\n \"twemoji-parser@npm:^11.0.2\":\n   version: 11.0.2\n   resolution: \"twemoji-parser@npm:11.0.2\"\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/actions/search.ts\n@@ -121,10 +121,15 @@ export const clickSearchResult = createAppAsyncThunk(\n \n export const forgetSearchResult = createAppAsyncThunk(\n   'search/forgetResult',\n-  (q: string, { dispatch, getState }) => {\n+  (\n+    { q, type }: { q: string; type?: RecentSearchType },\n+    { dispatch, getState },\n+  ) => {\n     const previous = getState().search.recent;\n     const me = getState().meta.get('me') as string;\n-    const current = previous.filter((result) => result.q !== q);\n+    const current = previous.filter(\n+      (result) => result.q !== q || result.type !== type,\n+    );\n \n     searchHistory.set(me, current);\n     dispatch(updateSearchHistory(current));\n---\napp/javascript/mastodon/features/compose/components/search.tsx\n@@ -221,7 +221,7 @@ export const Search: React.FC<{\n     },\n     forget: (e) => {\n       e.stopPropagation();\n-      void dispatch(forgetSearchResult(search.q));\n+      void dispatch(forgetSearchResult(search));\n     },\n   }));\n \n@@ -497,8 +497,10 @@ export const Search: React.FC<{\n             <div className='search__popout__menu'>\n               {recentOptions.length > 0 ? (\n                 recentOptions.map(({ label, key, action, forget }, i) => (\n-                  <button\n+                  <div\n                     key={key}\n+                    tabIndex={0}\n+                    role='button'\n                     onMouseDown={action}\n                     className={classNames(\n                       'search__popout__menu__item search__popout__menu__item--flex',\n@@ -509,7 +511,7 @@ export const Search: React.FC<{\n                     <button className='icon-button' onMouseDown={forget}>\n                       <Icon id='times' icon={CloseIcon} />\n                     </button>\n-                  </button>\n+                  </div>\n                 ))\n               ) : (\n                 <div className='search__popout__menu__message'>\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -52,6 +52,7 @@ gem 'faraday-httpclient'\n gem 'fast_blank', '~> 1.0'\n gem 'fastimage'\n gem 'hiredis', '~> 0.6'\n+gem 'hiredis-client'\n gem 'htmlentities', '~> 4.3'\n gem 'http', '~> 5.2.0'\n gem 'http_accept_language', '~> 2.1'\n@@ -82,10 +83,10 @@ gem 'rqrcode', '~> 3.0'\n gem 'ruby-progressbar', '~> 1.13'\n gem 'sanitize', '~> 7.0'\n gem 'scenic', '~> 1.7'\n-gem 'sidekiq', '~> 6.5'\n+gem 'sidekiq', '< 8'\n gem 'sidekiq-bulk', '~> 0.2.0'\n gem 'sidekiq-scheduler', '~> 5.0'\n-gem 'sidekiq-unique-jobs', '~> 7.1'\n+gem 'sidekiq-unique-jobs', '> 8'\n gem 'simple_form', '~> 5.2'\n gem 'simple-navigation', '~> 4.4'\n gem 'stoplight', '~> 4.1'\n---\nGemfile.lock\n@@ -129,9 +129,6 @@ GEM\n     brakeman (7.0.2)\n       racc\n     browser (6.2.0)\n-    brpoplpush-redis_script (0.1.3)\n-      concurrent-ruby (~> 1.0, >= 1.0.5)\n-      redis (>= 1.0, < 6)\n     builder (3.3.0)\n     bundler-audit (0.9.2)\n       bundler (>= 1.2.0, < 3)\n@@ -294,6 +291,8 @@ GEM\n     highline (3.1.2)\n       reline\n     hiredis (0.6.3)\n+    hiredis-client (0.24.0)\n+      redis-client (= 0.24.0)\n     hkdf (0.3.0)\n     htmlentities (4.3.4)\n     http (5.2.0)\n@@ -696,6 +695,8 @@ GEM\n       psych (>= 4.0.0)\n     redcarpet (3.6.1)\n     redis (4.8.1)\n+    redis-client (0.24.0)\n+      connection_pool\n     redlock (1.3.2)\n       redis (>= 3.0.0, < 6.0)\n     regexp_parser (2.10.0)\n@@ -808,22 +809,22 @@ GEM\n       websocket (~> 1.0)\n     shoulda-matchers (6.5.0)\n       activesupport (>= 5.2.0)\n-    sidekiq (6.5.12)\n-      connection_pool (>= 2.2.5, < 3)\n-      rack (~> 2.0)\n-      redis (>= 4.5.0, < 5)\n+    sidekiq (7.3.9)\n+      base64\n+      connection_pool (>= 2.3.0)\n+      logger\n+      rack (>= 2.2.4)\n+      redis-client (>= 0.22.2)\n     sidekiq-bulk (0.2.0)\n       sidekiq\n     sidekiq-scheduler (5.0.6)\n       rufus-scheduler (~> 3.2)\n       sidekiq (>= 6, < 8)\n       tilt (>= 1.4.0, < 3)\n-    sidekiq-unique-jobs (7.1.33)\n-      brpoplpush-redis_script (> 0.1.1, <= 2.0.0)\n+    sidekiq-unique-jobs (8.0.10)\n       concurrent-ruby (~> 1.0, >= 1.0.5)\n-      redis (< 5.0)\n-      sidekiq (>= 5.0, < 7.0)\n-      thor (>= 0.20, < 3.0)\n+      sidekiq (>= 7.0.0, < 8.0.0)\n+      thor (>= 1.0, < 3.0)\n     simple-navigation (4.4.0)\n       activesupport (>= 2.3.2)\n     simple_form (5.3.1)\n@@ -976,6 +977,7 @@ DEPENDENCIES\n   haml_lint\n   hcaptcha (~> 7.1)\n   hiredis (~> 0.6)\n+  hiredis-client\n   htmlentities (~> 4.3)\n   http (~> 5.2.0)\n   http_accept_language (~> 2.1)\n@@ -1064,10 +1066,10 @@ DEPENDENCIES\n   scenic (~> 1.7)\n   selenium-webdriver\n   shoulda-matchers\n-  sidekiq (~> 6.5)\n+  sidekiq (< 8)\n   sidekiq-bulk (~> 0.2.0)\n   sidekiq-scheduler (~> 5.0)\n-  sidekiq-unique-jobs (~> 7.1)\n+  sidekiq-unique-jobs (> 8)\n   simple-navigation (~> 4.4)\n   simple_form (~> 5.2)\n   simplecov (~> 0.22)\n---\napp/lib/redis_connection.rb\n@@ -15,7 +15,7 @@ def pool\n \n     def pool_size\n       if Sidekiq.server?\n-        Sidekiq[:concurrency]\n+        Sidekiq.default_configuration[:concurrency]\n       else\n         ENV['MAX_THREADS'] || 5\n       end\n---\napp/workers/scheduler/self_destruct_scheduler.rb\n@@ -20,7 +20,7 @@ def perform\n   private\n \n   def sidekiq_overwhelmed?\n-    redis_mem_info = Sidekiq.redis_info\n+    redis_mem_info = Sidekiq.default_configuration.redis_info\n \n     Sidekiq::Stats.new.enqueued > MAX_ENQUEUED || redis_mem_info['used_memory'].to_f > redis_mem_info['total_system_memory'].to_f * MAX_REDIS_MEM_USAGE\n   end\n---\nconfig/database.yml\n@@ -1,6 +1,6 @@\n default: &default\n   adapter: postgresql\n-  pool: <%= ENV[\"DB_POOL\"] || (if Sidekiq.server? then Sidekiq[:concurrency] else ENV['MAX_THREADS'] end) || 5 %>\n+  pool: <%= ENV[\"DB_POOL\"] || (if Sidekiq.server? then Sidekiq.default_configuration[:concurrency] else ENV['MAX_THREADS'] end) || 5 %>\n   timeout: 5000\n   connect_timeout: 15\n   encoding: unicode\n---\nconfig/initializers/sidekiq.rb\n@@ -89,6 +89,8 @@\n     end\n   end\n \n+  config.logger.level = Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+\n   SidekiqUniqueJobs::Server.configure(config)\n end\n \n@@ -98,9 +100,9 @@\n   config.client_middleware do |chain|\n     chain.add SidekiqUniqueJobs::Middleware::Client\n   end\n-end\n \n-Sidekiq.logger.level = ::Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+  config.logger.level = Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+end\n \n SidekiqUniqueJobs.configure do |config|\n   config.enabled         = !Rails.env.test?\n---\nlib/mastodon/redis_configuration.rb\n@@ -9,7 +9,6 @@ class Mastodon::RedisConfiguration\n \n   def base\n     @base ||= setup_config(prefix: nil, defaults: DEFAULTS)\n-              .merge(namespace: nil)\n   end\n \n   def sidekiq\n@@ -23,7 +22,7 @@ def cache\n                  expires_in: 10.minutes,\n                  connect_timeout: 5,\n                  pool: {\n-                   size: Sidekiq.server? ? Sidekiq[:concurrency] : Integer(ENV['MAX_THREADS'] || 5),\n+                   size: Sidekiq.server? ? Sidekiq.default_configuration[:concurrency] : Integer(ENV['MAX_THREADS'] || 5),\n                    timeout: 5,\n                  },\n                })\n---\nspec/lib/mastodon/redis_configuration_spec.rb\n@@ -156,7 +156,6 @@\n         expect(subject).to eq({\n           url: 'redis://localhost:6379/0',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n@@ -172,7 +171,6 @@\n         expect(subject).to eq({\n           url: 'redis::/user@example.com/2',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n@@ -188,7 +186,6 @@\n         expect(subject).to eq({\n           url: 'redis://:testpass@redis.example.com:3333/3',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n---\nspec/rails_helper.rb\n@@ -53,7 +53,7 @@\n   allow_localhost: true,\n   allow: Chewy.settings[:host]\n )\n-Sidekiq.logger = nil\n+Sidekiq.default_configuration.logger = nil\n \n DatabaseCleaner.strategy = [:deletion]\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rqrcode](https://redirect.github.com/whomwah/rqrcode) ([changelog](https://redirect.github.com/whomwah/rqrcode/blob/main/CHANGELOG.md)) | `'~> 2.2'` -> `'~> 3.0'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rqrcode/3.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rqrcode/3.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rqrcode/2.2.0/3.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rqrcode/2.2.0/3.0.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>whomwah/rqrcode (rqrcode)</summary>\n\n### [`v3.0.0`](https://redirect.github.com/whomwah/rqrcode/blob/HEAD/CHANGELOG.md#300---2025-04-24)\n\n-   Drop support for Ruby <3.0 in order to keep up with dev dependencies.\n-   **Breaking Change**: The `rqrcode_core` gem has been updated to version 2.0.0, which includes breaking changes. Please refer to the [rqrcode_core changelog](https://redirect.github.com/whomwah/rqrcode_core/blob/main/CHANGELOG.md)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNTcuMyIsInVwZGF0ZWRJblZlciI6IjM5LjI1Ny4zIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -9187,23 +9187,23 @@ __metadata:\n   linkType: hard\n \n \"pino@npm:^9.0.0\":\n-  version: 9.6.0\n-  resolution: \"pino@npm:9.6.0\"\n+  version: 9.7.0\n+  resolution: \"pino@npm:9.7.0\"\n   dependencies:\n     atomic-sleep: \"npm:^1.0.0\"\n     fast-redact: \"npm:^3.1.1\"\n     on-exit-leak-free: \"npm:^2.1.0\"\n     pino-abstract-transport: \"npm:^2.0.0\"\n     pino-std-serializers: \"npm:^7.0.0\"\n-    process-warning: \"npm:^4.0.0\"\n+    process-warning: \"npm:^5.0.0\"\n     quick-format-unescaped: \"npm:^4.0.3\"\n     real-require: \"npm:^0.2.0\"\n     safe-stable-stringify: \"npm:^2.3.1\"\n     sonic-boom: \"npm:^4.0.1\"\n     thread-stream: \"npm:^3.0.0\"\n   bin:\n     pino: bin.js\n-  checksum: 10c0/bcd1e9d9b301bea13b95689ca9ad7105ae9451928fb6c0b67b3e58c5fe37cea1d40665f3d6641e3da00be0bbc17b89031e67abbc8ea6aac6164f399309fd78e7\n+  checksum: 10c0/c7f8a83a9a9d728b4eff6d0f4b9367f031c91bcaa5806fbf0eedcc8e77faba593d59baf11a8fba0dd1c778bb17ca7ed01418ac1df4ec129faeedd4f3ecaff66f\n   languageName: node\n   linkType: hard\n \n@@ -9759,6 +9759,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"process-warning@npm:^5.0.0\":\n+  version: 5.0.0\n+  resolution: \"process-warning@npm:5.0.0\"\n+  checksum: 10c0/941f48863d368ec161e0b5890ba0c6af94170078f3d6b5e915c19b36fb59edb0dc2f8e834d25e0d375a8bf368a49d490f080508842168832b93489d17843ec29\n+  languageName: node\n+  linkType: hard\n+\n \"prom-client@npm:^15.0.0\":\n   version: 15.1.3\n   resolution: \"prom-client@npm:15.1.3\"\n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -79,7 +79,7 @@ gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n gem 'redis-namespace', '~> 1.10'\n-gem 'rqrcode', '~> 2.2'\n+gem 'rqrcode', '~> 3.0'\n gem 'ruby-progressbar', '~> 1.13'\n gem 'sanitize', '~> 7.0'\n gem 'scenic', '~> 1.7'\n---\nGemfile.lock\n@@ -711,10 +711,10 @@ GEM\n     rotp (6.3.0)\n     rouge (4.5.1)\n     rpam2 (4.0.2)\n-    rqrcode (2.2.0)\n+    rqrcode (3.0.0)\n       chunky_png (~> 1.0)\n-      rqrcode_core (~> 1.0)\n-    rqrcode_core (1.2.0)\n+      rqrcode_core (~> 2.0)\n+    rqrcode_core (2.0.0)\n     rspec (3.13.0)\n       rspec-core (~> 3.13.0)\n       rspec-expectations (~> 3.13.0)\n@@ -1043,7 +1043,7 @@ DEPENDENCIES\n   redcarpet (~> 3.6)\n   redis (~> 4.5)\n   redis-namespace (~> 1.10)\n-  rqrcode (~> 2.2)\n+  rqrcode (~> 3.0)\n   rspec-github (~> 3.0)\n   rspec-rails (~> 7.0)\n   rspec-sidekiq (~> 5.0)\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.222.3', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1088.0)\n+    aws-sdk-core (3.222.2)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -931,7 +933,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.222.3)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice D:\napp/lib/admin/system_check/elasticsearch_check.rb\n@@ -38,6 +38,11 @@ def message\n         :elasticsearch_index_mismatch,\n         mismatched_indexes.join(' ')\n       )\n+    elsif !specifications_match?\n+      Admin::SystemCheck::Message.new(\n+        :elasticsearch_analysis_mismatch,\n+        mismatched_specifications_indexes.join(' ')\n+      )\n     elsif cluster_health['status'] == 'red'\n       Admin::SystemCheck::Message.new(:elasticsearch_health_red)\n     elsif cluster_health['number_of_nodes'] < 2 && es_preset != 'single_node_cluster'\n@@ -111,10 +116,20 @@ def mismatched_indexes\n     end\n   end\n \n+  def mismatched_specifications_indexes\n+    @mismatched_specifications_indexes ||= INDEXES.filter_map do |klass|\n+      klass.base_name if klass.specification.changed?\n+    end\n+  end\n+\n   def indexes_match?\n     mismatched_indexes.empty?\n   end\n \n+  def specifications_match?\n+    mismatched_specifications_indexes.empty?\n+  end\n+\n   def es_preset\n     ENV.fetch('ES_PRESET', 'single_node_cluster')\n   end\n---\nconfig/locales/en.yml\n@@ -903,6 +903,8 @@ en:\n     system_checks:\n       database_schema_check:\n         message_html: There are pending database migrations. Please run them to ensure the application behaves as expected\n+      elasticsearch_analysis_index_mismatch:\n+        message_html: Elasticsearch index analyzer settings are outdated. Please run <code>tootctl search deploy --only-mapping --only=%{value}</code>\n       elasticsearch_health_red:\n         message_html: Elasticsearch cluster is unhealthy (red status), search features are unavailable\n       elasticsearch_health_yellow:\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes #34537 \r\n\r\nLet me know if you'd like me to optimise any of the other SVGs.\n\n---\n\nChoice A:\napp/models/user.rb\n@@ -112,7 +112,7 @@ class User < ApplicationRecord\n   validates_with RegistrationFormTimeValidator, on: :create\n   validates :website, absence: true, on: :create\n   validates :confirm_password, absence: true, on: :create\n-  validates :date_of_birth, presence: true, date_of_birth: true, on: :create, if: -> { Setting.min_age.present? }\n+  validates :date_of_birth, presence: true, date_of_birth: true, on: :create, if: -> { Setting.min_age.present? && !bypass_registration_checks? }\n   validate :validate_role_elevation\n \n   scope :account_not_suspended, -> { joins(:account).merge(Account.without_suspended) }\n@@ -144,7 +144,7 @@ class User < ApplicationRecord\n   delegate :can?, to: :role\n \n   attr_reader :invite_code, :date_of_birth\n-  attr_writer :external, :bypass_invite_request_check, :current_account\n+  attr_writer :external, :bypass_registration_checks, :current_account\n \n   def self.those_who_can(*any_of_privileges)\n     matching_role_ids = UserRole.that_can(*any_of_privileges).map(&:id)\n@@ -501,8 +501,8 @@ def external?\n     !!@external\n   end\n \n-  def bypass_invite_request_check?\n-    @bypass_invite_request_check\n+  def bypass_registration_checks?\n+    @bypass_registration_checks\n   end\n \n   def sanitize_role\n@@ -549,7 +549,7 @@ def validate_role_elevation\n   end\n \n   def invite_text_required?\n-    Setting.require_invite_text && !open_registrations? && !invited? && !external? && !bypass_invite_request_check?\n+    Setting.require_invite_text && !open_registrations? && !invited? && !external? && !bypass_registration_checks?\n   end\n \n   def trigger_webhooks\n---\nlib/mastodon/cli/accounts.rb\n@@ -79,7 +79,14 @@ def create(username)\n \n       account  = Account.new(username: username)\n       password = SecureRandom.hex\n-      user     = User.new(email: options[:email], password: password, agreement: true, role_id: role_id, confirmed_at: options[:confirmed] ? Time.now.utc : nil, bypass_invite_request_check: true)\n+      user = User.new(\n+        email: options[:email],\n+        password: password,\n+        agreement: true,\n+        role_id: role_id,\n+        confirmed_at: options[:confirmed] ? Time.now.utc : nil,\n+        bypass_registration_checks: true\n+      )\n \n       if options[:reattach]\n         account = Account.find_local(username) || Account.new(username: username)\n---\nlib/tasks/mastodon.rake\n@@ -552,7 +552,7 @@ namespace :mastodon do\n           password = SecureRandom.hex(16)\n \n           owner_role = UserRole.find_by(name: 'Owner')\n-          user = User.new(email: email, password: password, confirmed_at: Time.now.utc, account_attributes: { username: username }, bypass_invite_request_check: true, role: owner_role)\n+          user = User.new(email: email, password: password, confirmed_at: Time.now.utc, account_attributes: { username: username }, bypass_registration_checks: true, role: owner_role)\n           user.save(validate: false)\n           user.approve!\n \n---\nspec/lib/mastodon/cli/accounts_spec.rb\n@@ -70,6 +70,25 @@ def account_from_options\n         end\n       end\n \n+      context 'with min_age setting' do\n+        let(:options) { { email: 'tootctl@example.com', confirmed: true } }\n+\n+        before do\n+          Setting.min_age = 42\n+        end\n+\n+        it_behaves_like 'a new user with given email address and username'\n+\n+        it 'creates a new user with confirmed status' do\n+          expect { subject }\n+            .to output_results('New password')\n+\n+          user = User.find_by(email: options[:email])\n+\n+          expect(user.confirmed?).to be(true)\n+        end\n+      end\n+\n       context 'with --confirmed option' do\n         let(:options) { { email: 'tootctl@example.com', confirmed: true } }\n \n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -592,7 +592,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n     orm_adapter (0.5.0)\n     ostruct (0.6.1)\n-    ox (2.14.22)\n+    ox (2.14.23)\n       bigdecimal (>= 3.0)\n     parallel (1.27.0)\n     parser (3.3.8.0)\n---\n\n\n---\n\nChoice C:\napp/javascript/images/logo-symbol-icon.svg\n@@ -1,2 +1,2 @@\n-<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"79\" height=\"79\" viewBox=\"0 0 79 75\"><symbol id=\"logo-symbol-icon\"><path d=\"M74.7135 16.6043C73.6199 8.54587 66.5351 2.19527 58.1366 0.964691C56.7196 0.756754 51.351 0 38.9148 0H38.822C26.3824 0 23.7135 0.756754 22.2966 0.964691C14.1319 2.16118 6.67571 7.86752 4.86669 16.0214C3.99657 20.0369 3.90371 24.4888 4.06535 28.5726C4.29578 34.4289 4.34049 40.275 4.877 46.1075C5.24791 49.9817 5.89495 53.8251 6.81328 57.6088C8.53288 64.5968 15.4938 70.4122 22.3138 72.7848C29.6155 75.259 37.468 75.6697 44.9919 73.971C45.8196 73.7801 46.6381 73.5586 47.4475 73.3063C49.2737 72.7302 51.4164 72.086 52.9915 70.9542C53.0131 70.9384 53.0308 70.9178 53.0433 70.8942C53.0558 70.8706 53.0628 70.8445 53.0637 70.8179V65.1661C53.0634 65.1412 53.0574 65.1167 53.0462 65.0944C53.035 65.0721 53.0189 65.0525 52.9992 65.0371C52.9794 65.0218 52.9564 65.011 52.9318 65.0056C52.9073 65.0002 52.8819 65.0003 52.8574 65.0059C48.0369 66.1472 43.0971 66.7193 38.141 66.7103C29.6118 66.7103 27.3178 62.6981 26.6609 61.0278C26.1329 59.5842 25.7976 58.0784 25.6636 56.5486C25.6622 56.5229 25.667 56.4973 25.6775 56.4738C25.688 56.4502 25.7039 56.4295 25.724 56.4132C25.7441 56.397 25.7678 56.3856 25.7931 56.3801C25.8185 56.3746 25.8448 56.3751 25.8699 56.3816C30.6101 57.5151 35.4693 58.0873 40.3455 58.086C41.5183 58.086 42.6876 58.086 43.8604 58.0553C48.7647 57.919 53.9339 57.6701 58.7591 56.7361C58.8794 56.7123 58.9998 56.6918 59.103 56.6611C66.7139 55.2124 73.9569 50.665 74.6929 39.1501C74.7204 38.6967 74.7892 34.4016 74.7892 33.9312C74.7926 32.3325 75.3085 22.5901 74.7135 16.6043ZM62.9996 45.3371H54.9966V25.9069C54.9966 21.8163 53.277 19.7302 49.7793 19.7302C45.9343 19.7302 44.0083 22.1981 44.0083 27.0727V37.7082H36.0534V27.0727C36.0534 22.1981 34.124 19.7302 30.279 19.7302C26.8019 19.7302 25.0651 21.8163 25.0617 25.9069V45.3371H17.0656V25.3172C17.0656 21.2266 18.1191 17.9769 20.2262 15.568C22.3998 13.1648 25.2509 11.9308 28.7898 11.9308C32.8859 11.9308 35.9812 13.492 38.0447 16.6111L40.036 19.9245L42.0308 16.6111C44.0943 13.492 47.1896 11.9308 51.2788 11.9308C54.8143 11.9308 57.6654 13.1648 59.8459 15.568C61.9529 17.9746 63.0065 21.2243 63.0065 25.3172L62.9996 45.3371Z\" fill=\"currentColor\"/></symbol><use xlink:href=\"#logo-symbol-icon\"/></svg>\n+<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"79\" height=\"79\" viewBox=\"0 0 79 75\"><symbol id=\"logo-symbol-icon\"><path d=\"M63 45.3v-20c0-4.1-1-7.3-3.2-9.7-2.1-2.4-5-3.7-8.5-3.7-4.1 0-7.2 1.6-9.3 4.7l-2 3.3-2-3.3c-2-3.1-5.1-4.7-9.2-4.7-3.5 0-6.4 1.3-8.6 3.7-2.1 2.4-3.1 5.6-3.1 9.7v20h8V25.9c0-4.1 1.7-6.2 5.2-6.2 3.8 0 5.8 2.5 5.8 7.4V37.7H44V27.1c0-4.9 1.9-7.4 5.8-7.4 3.5 0 5.2 2.1 5.2 6.2V45.3h8ZM74.7 16.6c.6 6 .1 15.7.1 17.3 0 .5-.1 4.8-.1 5.3-.7 11.5-8 16-15.6 17.5-.1 0-.2 0-.3 0-4.9 1-10 1.2-14.9 1.4-1.2 0-2.4 0-3.6 0-4.8 0-9.7-.6-14.4-1.7-.1 0-.1 0-.1 0s-.1 0-.1 0 0 .1 0 .1 0 0 0 0c.1 1.6.4 3.1 1 4.5.6 1.7 2.9 5.7 11.4 5.7 5 0 9.9-.6 14.8-1.7 0 0 0 0 0 0 .1 0 .1 0 .1 0 0 .1 0 .1 0 .1.1 0 .1 0 .1.1v5.6s0 .1-.1.1c0 0 0 0 0 .1-1.6 1.1-3.7 1.7-5.6 2.3-.8.3-1.6.5-2.4.7-7.5 1.7-15.4 1.3-22.7-1.2-6.8-2.4-13.8-8.2-15.5-15.2-.9-3.8-1.6-7.6-1.9-11.5-.6-5.8-.6-11.7-.8-17.5C3.9 24.5 4 20 4.9 16 6.7 7.9 14.1 2.2 22.3 1c1.4-.2 4.1-1 16.5-1h.1C51.4 0 56.7.8 58.1 1c8.4 1.2 15.5 7.5 16.6 15.6Z\" fill=\"currentColor\"/></symbol><use xlink:href=\"#logo-symbol-icon\"/></svg>\n \n---\napp/serializers/oembed_serializer.rb\n@@ -75,7 +75,7 @@ def html\n     <<~HTML.squish\n       <blockquote class=\"mastodon-embed\" data-embed-url=\"#{embed_short_account_status_url(object.account, object)}\" style=\"#{INLINE_STYLES[:blockquote]}\">\n         <a href=\"#{short_account_status_url(object.account, object)}\" target=\"_blank\" style=\"#{INLINE_STYLES[:status_link]}\">\n-          <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"32\" height=\"32\" viewBox=\"0 0 79 75\"><path d=\"M74.7135 16.6043C73.6199 8.54587 66.5351 2.19527 58.1366 0.964691C56.7196 0.756754 51.351 0 38.9148 0H38.822C26.3824 0 23.7135 0.756754 22.2966 0.964691C14.1319 2.16118 6.67571 7.86752 4.86669 16.0214C3.99657 20.0369 3.90371 24.4888 4.06535 28.5726C4.29578 34.4289 4.34049 40.275 4.877 46.1075C5.24791 49.9817 5.89495 53.8251 6.81328 57.6088C8.53288 64.5968 15.4938 70.4122 22.3138 72.7848C29.6155 75.259 37.468 75.6697 44.9919 73.971C45.8196 73.7801 46.6381 73.5586 47.4475 73.3063C49.2737 72.7302 51.4164 72.086 52.9915 70.9542C53.0131 70.9384 53.0308 70.9178 53.0433 70.8942C53.0558 70.8706 53.0628 70.8445 53.0637 70.8179V65.1661C53.0634 65.1412 53.0574 65.1167 53.0462 65.0944C53.035 65.0721 53.0189 65.0525 52.9992 65.0371C52.9794 65.0218 52.9564 65.011 52.9318 65.0056C52.9073 65.0002 52.8819 65.0003 52.8574 65.0059C48.0369 66.1472 43.0971 66.7193 38.141 66.7103C29.6118 66.7103 27.3178 62.6981 26.6609 61.0278C26.1329 59.5842 25.7976 58.0784 25.6636 56.5486C25.6622 56.5229 25.667 56.4973 25.6775 56.4738C25.688 56.4502 25.7039 56.4295 25.724 56.4132C25.7441 56.397 25.7678 56.3856 25.7931 56.3801C25.8185 56.3746 25.8448 56.3751 25.8699 56.3816C30.6101 57.5151 35.4693 58.0873 40.3455 58.086C41.5183 58.086 42.6876 58.086 43.8604 58.0553C48.7647 57.919 53.9339 57.6701 58.7591 56.7361C58.8794 56.7123 58.9998 56.6918 59.103 56.6611C66.7139 55.2124 73.9569 50.665 74.6929 39.1501C74.7204 38.6967 74.7892 34.4016 74.7892 33.9312C74.7926 32.3325 75.3085 22.5901 74.7135 16.6043ZM62.9996 45.3371H54.9966V25.9069C54.9966 21.8163 53.277 19.7302 49.7793 19.7302C45.9343 19.7302 44.0083 22.1981 44.0083 27.0727V37.7082H36.0534V27.0727C36.0534 22.1981 34.124 19.7302 30.279 19.7302C26.8019 19.7302 25.0651 21.8163 25.0617 25.9069V45.3371H17.0656V25.3172C17.0656 21.2266 18.1191 17.9769 20.2262 15.568C22.3998 13.1648 25.2509 11.9308 28.7898 11.9308C32.8859 11.9308 35.9812 13.492 38.0447 16.6111L40.036 19.9245L42.0308 16.6111C44.0943 13.492 47.1896 11.9308 51.2788 11.9308C54.8143 11.9308 57.6654 13.1648 59.8459 15.568C61.9529 17.9746 63.0065 21.2243 63.0065 25.3172L62.9996 45.3371Z\" fill=\"currentColor\"/></svg>\n+          <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"32\" height=\"32\" viewBox=\"0 0 79 75\"><path d=\"M63 45.3v-20c0-4.1-1-7.3-3.2-9.7-2.1-2.4-5-3.7-8.5-3.7-4.1 0-7.2 1.6-9.3 4.7l-2 3.3-2-3.3c-2-3.1-5.1-4.7-9.2-4.7-3.5 0-6.4 1.3-8.6 3.7-2.1 2.4-3.1 5.6-3.1 9.7v20h8V25.9c0-4.1 1.7-6.2 5.2-6.2 3.8 0 5.8 2.5 5.8 7.4V37.7H44V27.1c0-4.9 1.9-7.4 5.8-7.4 3.5 0 5.2 2.1 5.2 6.2V45.3h8ZM74.7 16.6c.6 6 .1 15.7.1 17.3 0 .5-.1 4.8-.1 5.3-.7 11.5-8 16-15.6 17.5-.1 0-.2 0-.3 0-4.9 1-10 1.2-14.9 1.4-1.2 0-2.4 0-3.6 0-4.8 0-9.7-.6-14.4-1.7-.1 0-.1 0-.1 0s-.1 0-.1 0 0 .1 0 .1 0 0 0 0c.1 1.6.4 3.1 1 4.5.6 1.7 2.9 5.7 11.4 5.7 5 0 9.9-.6 14.8-1.7 0 0 0 0 0 0 .1 0 .1 0 .1 0 0 .1 0 .1 0 .1.1 0 .1 0 .1.1v5.6s0 .1-.1.1c0 0 0 0 0 .1-1.6 1.1-3.7 1.7-5.6 2.3-.8.3-1.6.5-2.4.7-7.5 1.7-15.4 1.3-22.7-1.2-6.8-2.4-13.8-8.2-15.5-15.2-.9-3.8-1.6-7.6-1.9-11.5-.6-5.8-.6-11.7-.8-17.5C3.9 24.5 4 20 4.9 16 6.7 7.9 14.1 2.2 22.3 1c1.4-.2 4.1-1 16.5-1h.1C51.4 0 56.7.8 58.1 1c8.4 1.2 15.5 7.5 16.6 15.6Z\" fill=\"currentColor\"/></svg>\n           <div style=\"#{INLINE_STYLES[:div_account]}\">Post by @#{object.account.pretty_acct}@#{provider_name}</div>\n           <div style=\"#{INLINE_STYLES[:div_view]}\">View on Mastodon</div>\n         </a>\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/account/components/account_note.jsx\n@@ -8,6 +8,8 @@ import ImmutablePureComponent from 'react-immutable-pure-component';\n \n import Textarea from 'react-textarea-autosize';\n \n+import { LoadingIndicator } from '@/mastodon/components/loading_indicator';\n+\n const messages = defineMessages({\n   placeholder: { id: 'account_note.placeholder', defaultMessage: 'Click to add a note' },\n });\n@@ -153,17 +155,23 @@ class AccountNote extends ImmutablePureComponent {\n           <FormattedMessage id='account.account_note_header' defaultMessage='Personal note' /> <InlineAlert show={saved} />\n         </label>\n \n-        <Textarea\n-          id={`account-note-${accountId}`}\n-          className='account__header__account-note__content'\n-          disabled={this.props.value === null || value === null}\n-          placeholder={intl.formatMessage(messages.placeholder)}\n-          value={value || ''}\n-          onChange={this.handleChange}\n-          onKeyDown={this.handleKeyDown}\n-          onBlur={this.handleBlur}\n-          ref={this.setTextareaRef}\n-        />\n+        {this.props.value === undefined ? (\n+          <div className='account__header__account-note__loading-indicator-wrapper'>\n+            <LoadingIndicator />\n+          </div>\n+        ) : (\n+          <Textarea\n+            id={`account-note-${accountId}`}\n+            className='account__header__account-note__content'\n+            disabled={value === null}\n+            placeholder={intl.formatMessage(messages.placeholder)}\n+            value={value || ''}\n+            onChange={this.handleChange}\n+            onKeyDown={this.handleKeyDown}\n+            onBlur={this.handleBlur}\n+            ref={this.setTextareaRef}\n+          />\n+        )}\n       </div>\n     );\n   }\n---\napp/javascript/styles/mastodon/components.scss\n@@ -8194,6 +8194,20 @@ noscript {\n     font-weight: 400;\n     margin-bottom: 10px;\n \n+    &__loading-indicator-wrapper {\n+      position: relative;\n+      height: 37px;\n+\n+      .loading-indicator {\n+        left: 10px;\n+      }\n+\n+      .circular-progress {\n+        width: 14px;\n+        height: 14px;\n+      }\n+    }\n+\n     label {\n       display: block;\n       font-size: 12px;\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nAdd `FORCE_DEFAULT_LOCALE` to enforce the previous behavior\r\n\r\n---\r\n\r\nFixes MAS-411\n\n---\n\nChoice A:\nGemfile\n@@ -201,7 +201,7 @@ group :development, :test do\n   gem 'faker', '~> 3.2'\n \n   # Generate factory objects\n-  gem 'fabrication', '~> 2.30'\n+  gem 'fabrication'\n \n   # Profiling tools\n   gem 'memory_profiler', require: false\n---\nGemfile.lock\n@@ -223,7 +223,7 @@ GEM\n       tzinfo\n     excon (1.2.5)\n       logger\n-    fabrication (2.31.0)\n+    fabrication (3.0.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n     faraday (2.13.1)\n@@ -972,7 +972,7 @@ DEPENDENCIES\n   doorkeeper (~> 5.6)\n   dotenv\n   email_spec\n-  fabrication (~> 2.30)\n+  fabrication\n   faker (~> 3.2)\n   faraday-httpclient\n   fast_blank (~> 1.0)\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -627,7 +627,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.13)\n+    rack (2.2.14)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/account_featured/components/featured_tag.tsx\n@@ -42,6 +42,7 @@ export const FeaturedTag: React.FC<FeaturedTagProps> = ({ tag, account }) => {\n               date: intl.formatDate(tag.get('last_status_at') ?? '', {\n                 month: 'short',\n                 day: '2-digit',\n+                year: 'numeric',\n               }),\n             })\n           : intl.formatMessage(messages.empty)\n---\n\n\n---\n\nChoice D:\napp/controllers/concerns/localized.rb\n@@ -16,7 +16,7 @@ def set_locale(&block)\n   def requested_locale\n     requested_locale_name   = available_locale_or_nil(params[:lang])\n     requested_locale_name ||= available_locale_or_nil(current_user.locale) if respond_to?(:user_signed_in?) && user_signed_in?\n-    requested_locale_name ||= http_accept_language if ENV['DEFAULT_LOCALE'].blank?\n+    requested_locale_name ||= http_accept_language unless ENV['FORCE_DEFAULT_LOCALE'] == 'true'\n     requested_locale_name\n   end\n \n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nNew Crowdin translations, automated with GitHub Actions\n\nSee `.github/workflows/crowdin-download.yml`\n\nThis PR will be updated every day with new translations.\n\nDue to a limitation in GitHub Actions, checks are not running on this PR without manual action.\nIf you want to run the checks, then close and re-open it.\n\n---\n\nChoice A:\napp/models/concerns/attachmentable.rb\n@@ -75,9 +75,16 @@ def appropriate_extension(attachment)\n   end\n \n   def calculated_content_type(attachment)\n-    Paperclip.run('file', '-b --mime :file', file: attachment.queued_for_write[:original].path).split(/[:;\\s]+/).first.chomp\n-  rescue Terrapin::CommandLineError\n-    ''\n+    begin\n+      Timeout.timeout(10) do\n+        Paperclip.run('file', '-b --mime :file', file: attachment.queued_for_write[:original].path).split(/[:;\\s]+/).first.chomp\n+      end\n+    rescue Timeout::Error\n+      Rails.logger.error \"file command timed out for #{attachment.queued_for_write[:original].path}\"\n+      ''\n+    rescue Terrapin::CommandLineError\n+      ''\n+    end\n   end\n \n   def obfuscate_file_name(attachment)\n---\n\n\n---\n\nChoice B:\napp/lib/admin/system_check/elasticsearch_check.rb\n@@ -38,6 +38,11 @@ def message\n         :elasticsearch_index_mismatch,\n         mismatched_indexes.join(' ')\n       )\n+    elsif !specifications_match?\n+      Admin::SystemCheck::Message.new(\n+        :elasticsearch_analysis_mismatch,\n+        mismatched_specifications_indexes.join(' ')\n+      )\n     elsif cluster_health['status'] == 'red'\n       Admin::SystemCheck::Message.new(:elasticsearch_health_red)\n     elsif cluster_health['number_of_nodes'] < 2 && es_preset != 'single_node_cluster'\n@@ -111,10 +116,20 @@ def mismatched_indexes\n     end\n   end\n \n+  def mismatched_specifications_indexes\n+    @mismatched_specifications_indexes ||= INDEXES.filter_map do |klass|\n+      klass.base_name if klass.specification.changed?\n+    end\n+  end\n+\n   def indexes_match?\n     mismatched_indexes.empty?\n   end\n \n+  def specifications_match?\n+    mismatched_specifications_indexes.empty?\n+  end\n+\n   def es_preset\n     ENV.fetch('ES_PRESET', 'single_node_cluster')\n   end\n---\nconfig/locales/en.yml\n@@ -903,6 +903,8 @@ en:\n     system_checks:\n       database_schema_check:\n         message_html: There are pending database migrations. Please run them to ensure the application behaves as expected\n+      elasticsearch_analysis_index_mismatch:\n+        message_html: Elasticsearch index analyzer settings are outdated. Please run <code>tootctl search deploy --only-mapping --only=%{value}</code>\n       elasticsearch_health_red:\n         message_html: Elasticsearch cluster is unhealthy (red status), search features are unavailable\n       elasticsearch_health_yellow:\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/locales/id.json\n@@ -19,13 +19,16 @@\n   \"account.block_domain\": \"Blokir domain {domain}\",\n   \"account.block_short\": \"Blokir\",\n   \"account.blocked\": \"Terblokir\",\n+  \"account.blocking\": \"Memblokir\",\n   \"account.cancel_follow_request\": \"Batalkan permintaan ikut\",\n   \"account.copy\": \"Salin tautan ke profil\",\n   \"account.direct\": \"Sebut secara pribadi @{name}\",\n   \"account.disable_notifications\": \"Berhenti memberitahu saya ketika @{name} memposting\",\n+  \"account.domain_blocking\": \"Memblokir domain\",\n   \"account.edit_profile\": \"Ubah profil\",\n   \"account.enable_notifications\": \"Beritahu saya saat @{name} memposting\",\n   \"account.endorse\": \"Tampilkan di profil\",\n+  \"account.featured\": \"\",\n   \"account.featured_tags.last_status_at\": \"Kiriman terakhir pada {date}\",\n   \"account.featured_tags.last_status_never\": \"Tidak ada kiriman\",\n   \"account.follow\": \"Ikuti\",\n@@ -36,6 +39,7 @@\n   \"account.following\": \"Mengikuti\",\n   \"account.following_counter\": \"{count, plural, other {{counter} following}}\",\n   \"account.follows.empty\": \"Pengguna ini belum mengikuti siapa pun.\",\n+  \"account.follows_you\": \"Mengikuti Anda\",\n   \"account.go_to_profile\": \"Buka profil\",\n   \"account.hide_reblogs\": \"Sembunyikan boosts dari @{name}\",\n   \"account.in_memoriam\": \"Mengenang.\",\n---\napp/javascript/mastodon/locales/ko.json\n@@ -19,10 +19,12 @@\n   \"account.block_domain\": \"{domain} \ub3c4\uba54\uc778 \ucc28\ub2e8\",\n   \"account.block_short\": \"\ucc28\ub2e8\",\n   \"account.blocked\": \"\ucc28\ub2e8\ud568\",\n+  \"account.blocking\": \"\ucc28\ub2e8\ud568\",\n   \"account.cancel_follow_request\": \"\ud314\ub85c\uc6b0 \ucde8\uc18c\",\n   \"account.copy\": \"\ud504\ub85c\ud544 \ub9c1\ud06c \ubcf5\uc0ac\",\n   \"account.direct\": \"@{name} \ub2d8\uc5d0\uac8c \uac1c\uc778\uc801\uc73c\ub85c \uba58\uc158\",\n   \"account.disable_notifications\": \"@{name} \uc758 \uac8c\uc2dc\ubb3c \uc54c\ub9bc \ub044\uae30\",\n+  \"account.domain_blocking\": \"\ub3c4\uba54\uc778 \ucc28\ub2e8\ud568\",\n   \"account.edit_profile\": \"\ud504\ub85c\ud544 \ud3b8\uc9d1\",\n   \"account.enable_notifications\": \"@{name} \uc758 \uac8c\uc2dc\ubb3c \uc54c\ub9bc \ucf1c\uae30\",\n   \"account.endorse\": \"\ud504\ub85c\ud544\uc5d0 \ucd94\ucc9c\ud558\uae30\",\n@@ -39,6 +41,7 @@\n   \"account.following\": \"\ud314\ub85c\uc789\",\n   \"account.following_counter\": \"{count, plural, other {\ud314\ub85c\uc789 {counter}\uba85}}\",\n   \"account.follows.empty\": \"\uc774 \uc0ac\uc6a9\uc790\ub294 \uc544\uc9c1 \uc544\ubb34\ub3c4 \ud314\ub85c\uc6b0\ud558\uace0 \uc788\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.\",\n+  \"account.follows_you\": \"\ub098\ub97c \ud314\ub85c\uc6b0\",\n   \"account.go_to_profile\": \"\ud504\ub85c\ud544\ub85c \uc774\ub3d9\",\n   \"account.hide_reblogs\": \"@{name}\uc758 \ubd80\uc2a4\ud2b8\ub97c \uc228\uae30\uae30\",\n   \"account.in_memoriam\": \"\uace0\uc778\uc758 \uacc4\uc815\uc785\ub2c8\ub2e4.\",\n@@ -53,13 +56,17 @@\n   \"account.mute_notifications_short\": \"\uc54c\ub9bc \ubba4\ud2b8\",\n   \"account.mute_short\": \"\ubba4\ud2b8\",\n   \"account.muted\": \"\ubba4\ud2b8\ub428\",\n+  \"account.muting\": \"\ubba4\ud2b8\ud568\",\n+  \"account.mutual\": \"\uc11c\ub85c \ud314\ub85c\uc6b0\",\n   \"account.no_bio\": \"\uc81c\uacf5\ub41c \uc124\uba85\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.\",\n   \"account.open_original_page\": \"\uc6d0\ubcf8 \ud398\uc774\uc9c0 \uc5f4\uae30\",\n   \"account.posts\": \"\uac8c\uc2dc\ubb3c\",\n   \"account.posts_with_replies\": \"\uac8c\uc2dc\ubb3c\uacfc \ub2f5\uc7a5\",\n+  \"account.remove_from_followers\": \"\ud314\ub85c\uc6cc\uc5d0\uc11c {name} \uc81c\uac70\",\n   \"account.report\": \"@{name} \uc2e0\uace0\",\n   \"account.requested\": \"\uc2b9\uc778 \ub300\uae30 \uc911. \ud074\ub9ad\ud574\uc11c \ucde8\uc18c\ud558\uae30\",\n   \"account.requested_follow\": \"{name} \ub2d8\uc774 \ud314\ub85c\uc6b0 \uc694\uccad\uc744 \ubcf4\ub0c8\uc2b5\ub2c8\ub2e4\",\n+  \"account.requests_to_follow_you\": \"\ud314\ub85c\uc6b0 \uc694\uccad\",\n   \"account.share\": \"@{name}\uc758 \ud504\ub85c\ud544 \uacf5\uc720\",\n   \"account.show_reblogs\": \"@{name}\uc758 \ubd80\uc2a4\ud2b8 \ubcf4\uae30\",\n   \"account.statuses_counter\": \"{count, plural, other {\uac8c\uc2dc\ubb3c {counter}\uac1c}}\",\n@@ -227,6 +234,9 @@\n   \"confirmations.redraft.confirm\": \"\uc0ad\uc81c\ud558\uace0 \ub2e4\uc2dc \uc4f0\uae30\",\n   \"confirmations.redraft.message\": \"\uc815\ub9d0\ub85c \uc774 \uac8c\uc2dc\ubb3c\uc744 \uc0ad\uc81c\ud558\uace0 \ub2e4\uc2dc \uc4f0\uc2dc\uaca0\uc2b5\ub2c8\uae4c? \ud574\ub2f9 \uac8c\uc2dc\ubb3c\uc5d0 \ub300\ud55c \ubd80\uc2a4\ud2b8\uc640 \uc88b\uc544\uc694\ub97c \uc783\uac8c \ub418\uace0 \uc6d0\ubcf8\uc5d0 \ub300\ud55c \ub2f5\uc7a5\uc740 \uc5f0\uacb0 \ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.\",\n   \"confirmations.redraft.title\": \"\uc0ad\uc81c\ud558\uace0 \ub2e4\uc2dc \uc791\uc131\ud560\uae4c\uc694?\",\n+  \"confirmations.remove_from_followers.confirm\": \"\ud314\ub85c\uc6cc \uc81c\uac70\",\n+  \"confirmations.remove_from_followers.message\": \"{name} \ub2d8\uc774 \ub098\ub97c \ud314\ub85c\uc6b0\ud558\uc9c0 \uc54a\uac8c \ub429\ub2c8\ub2e4. \uacc4\uc18d\ud560\uae4c\uc694?\",\n+  \"confirmations.remove_from_followers.title\": \"\ud314\ub85c\uc6cc\ub97c \uc81c\uac70\ud560\uae4c\uc694?\",\n   \"confirmations.reply.confirm\": \"\ub2f5\uae00\",\n   \"confirmations.reply.message\": \"\uc9c0\uae08 \ub2f5\uc7a5\ud558\uba74 \uc791\uc131 \uc911\uc778 \uba54\uc2dc\uc9c0\ub97c \ub36e\uc5b4\uc4f0\uac8c \ub429\ub2c8\ub2e4. \uc815\ub9d0 \uc9c4\ud589\ud569\ub2c8\uae4c?\",\n   \"confirmations.reply.title\": \"\uac8c\uc2dc\ubb3c\uc744 \ub36e\uc5b4\uc4f8\uae4c\uc694?\",\n@@ -294,6 +304,9 @@\n   \"emoji_button.search_results\": \"\uac80\uc0c9 \uacb0\uacfc\",\n   \"emoji_button.symbols\": \"\uae30\ud638\",\n   \"emoji_button.travel\": \"\uc5ec\ud589\uacfc \uc7a5\uc18c\",\n+  \"empty_column.account_featured.me\": \"\uc544\uc9c1 \uc544\ubb34 \uac83\ub3c4 \ucd94\ucc9c\ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4. \uac8c\uc2dc\ubb3c, \uc790\uc8fc \uc0ac\uc6a9\ud558\ub294 \ud574\uc2dc\ud0dc\uadf8, \uce5c\uad6c\uc758 \uacc4\uc815\uae4c\uc9c0 \ub0b4 \uacc4\uc815\uc5d0\uc11c \ucd94\ucc9c\ud560 \uc218 \uc788\ub2e4\ub294 \uac83\uc744 \uc54c\uace0 \uacc4\uc2e0\uac00\uc694?\",\n+  \"empty_column.account_featured.other\": \"{acct} \ub2d8\uc740 \uc544\uc9c1 \uc544\ubb34 \uac83\ub3c4 \ucd94\ucc9c\ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4. \uac8c\uc2dc\ubb3c, \uc790\uc8fc \uc0ac\uc6a9\ud558\ub294 \ud574\uc2dc\ud0dc\uadf8, \uce5c\uad6c\uc758 \uacc4\uc815\uae4c\uc9c0 \ub0b4 \uacc4\uc815\uc5d0\uc11c \ucd94\ucc9c\ud560 \uc218 \uc788\ub2e4\ub294 \uac83\uc744 \uc54c\uace0 \uacc4\uc2e0\uac00\uc694?\",\n+  \"empty_column.account_featured_other.unknown\": \"\uc774 \uacc4\uc815\uc740 \uc544\uc9c1 \uc544\ubb34 \uac83\ub3c4 \ucd94\ucc9c\ud558\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4.\",\n   \"empty_column.account_hides_collections\": \"\uc774 \uc0ac\uc6a9\uc790\ub294 \uc774 \uc815\ubcf4\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub3c4\ub85d \uc124\uc815\ud588\uc2b5\ub2c8\ub2e4\",\n   \"empty_column.account_suspended\": \"\uacc4\uc815 \uc815\uc9c0\ub428\",\n   \"empty_column.account_timeline\": \"\uc774\uacf3\uc5d0\ub294 \uac8c\uc2dc\ubb3c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4!\",\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/account_featured/components/featured_tag.tsx\n@@ -42,6 +42,7 @@ export const FeaturedTag: React.FC<FeaturedTagProps> = ({ tag, account }) => {\n               date: intl.formatDate(tag.get('last_status_at') ?? '', {\n                 month: 'short',\n                 day: '2-digit',\n+                year: 'numeric',\n               }),\n             })\n           : intl.formatMessage(messages.empty)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [pg-connection-string](https://redirect.github.com/brianc/node-postgres/tree/master/packages/pg-connection-string) ([source](https://redirect.github.com/brianc/node-postgres/tree/HEAD/packages/pg-connection-string)) | [`2.8.1` -> `2.8.5`](https://renovatebot.com/diffs/npm/pg-connection-string/2.8.1/2.8.5) | [![age](https://developer.mend.io/api/mc/badges/age/npm/pg-connection-string/2.8.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/pg-connection-string/2.8.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/pg-connection-string/2.8.1/2.8.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/pg-connection-string/2.8.1/2.8.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>brianc/node-postgres (pg-connection-string)</summary>\n\n### [`v2.8.5`](https://redirect.github.com/brianc/node-postgres/compare/pg-connection-string@2.8.2...pg-connection-string@2.8.5)\n\n[Compare Source](https://redirect.github.com/brianc/node-postgres/compare/pg-connection-string@2.8.2...pg-connection-string@2.8.5)\n\n### [`v2.8.2`](https://redirect.github.com/brianc/node-postgres/compare/pg-connection-string@2.8.1...v2.8.2)\n\n[Compare Source](https://redirect.github.com/brianc/node-postgres/compare/pg-connection-string@2.8.1...pg-connection-string@2.8.2)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNDguNCIsInVwZGF0ZWRJblZlciI6IjM5LjI0OC40IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n-  version: 2.8.1\n-  resolution: \"pg-connection-string@npm:2.8.1\"\n-  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n+  version: 2.8.5\n+  resolution: \"pg-connection-string@npm:2.8.5\"\n+  checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\napp/controllers/api/base_controller.rb\n@@ -72,6 +72,13 @@ def require_user!\n     end\n   end\n \n+  # Redefine `require_functional!` to properly output JSON instead of HTML redirects\n+  def require_functional!\n+    return if current_user.functional?\n+\n+    require_user!\n+  end\n+\n   def render_empty\n     render json: {}, status: 200\n   end\n---\napp/controllers/application_controller.rb\n@@ -72,10 +72,24 @@ def store_referrer\n   def require_functional!\n     return if current_user.functional?\n \n-    if current_user.confirmed?\n-      redirect_to edit_user_registration_path\n-    else\n-      redirect_to auth_setup_path\n+    respond_to do |format|\n+      format.any do\n+        if current_user.confirmed?\n+          redirect_to edit_user_registration_path\n+        else\n+          redirect_to auth_setup_path\n+        end\n+      end\n+\n+      format.json do\n+        if !current_user.confirmed?\n+          render json: { error: 'Your login is missing a confirmed e-mail address' }, status: 403\n+        elsif !current_user.approved?\n+          render json: { error: 'Your login is currently pending approval' }, status: 403\n+        elsif !current_user.functional?\n+          render json: { error: 'Your login is currently disabled' }, status: 403\n+        end\n+      end\n     end\n   end\n \n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -469,7 +469,7 @@ GEM\n     omniauth-rails_csrf_protection (1.0.2)\n       actionpack (>= 4.2)\n       omniauth (~> 2.0)\n-    omniauth-saml (2.2.3)\n+    omniauth-saml (2.2.4)\n       omniauth (~> 2.1)\n       ruby-saml (~> 1.18)\n     omniauth_openid_connect (0.8.0)\n---\n\n\n---\n\nChoice D:\napp/javascript/styles/mastodon/components.scss\n@@ -11053,6 +11053,8 @@ noscript {\n   &__slide {\n     flex: 0 0 auto;\n     flex-basis: 100%;\n+    width: 100%;\n+    overflow: hidden;\n   }\n \n   .status {\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [pg](https://redirect.github.com/brianc/node-postgres) ([source](https://redirect.github.com/brianc/node-postgres/tree/HEAD/packages/pg)) | [`8.15.1` -> `8.15.5`](https://renovatebot.com/diffs/npm/pg/8.15.1/8.15.5) | [![age](https://developer.mend.io/api/mc/badges/age/npm/pg/8.15.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/pg/8.15.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/pg/8.15.1/8.15.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/pg/8.15.1/8.15.5?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>brianc/node-postgres (pg)</summary>\n\n### [`v8.15.5`](https://redirect.github.com/brianc/node-postgres/compare/pg@8.15.2...56e286257724783681f8830b2faa7d407b6563e7)\n\n[Compare Source](https://redirect.github.com/brianc/node-postgres/compare/pg@8.15.2...pg@8.15.5)\n\n### [`v8.15.2`](https://redirect.github.com/brianc/node-postgres/compare/pg@8.15.1...88ff6955e098257358640d33c354c35836369200)\n\n[Compare Source](https://redirect.github.com/brianc/node-postgres/compare/pg@8.15.1...pg@8.15.2)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNDguNCIsInVwZGF0ZWRJblZlciI6IjM5LjI0OC40IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -13279,14 +13279,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-cloudflare@npm:^1.2.0\":\n-  version: 1.2.0\n-  resolution: \"pg-cloudflare@npm:1.2.0\"\n-  checksum: 10c0/d6f2d032aeab291b17d627b051aae85420aea86a3371895a77b55fec93e3dac05880fbf09e5de33486ad3a2e6d7d56a025a8aa66f0d5883984f9834e4cd6f6a4\n+\"pg-cloudflare@npm:^1.2.5\":\n+  version: 1.2.5\n+  resolution: \"pg-cloudflare@npm:1.2.5\"\n+  checksum: 10c0/48b9105ef027c7b3f57ef88ceaec3634cd82120059bd68273cce06989a1ec547e0b0fbb5d1afdd0711824f409c8b410f9bdec2f6c8034728992d3658c0b36f86\n   languageName: node\n   linkType: hard\n \n-\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n+\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.5\":\n   version: 2.8.5\n   resolution: \"pg-connection-string@npm:2.8.5\"\n   checksum: 10c0/5f65afc9dfc99ecf1583a1699c97511f3d505659c9c6a91db8cd0ffe862caa29060722712a034abd6da493356567261febf18b3a6ef223d0a219f0d50d959b97\n@@ -13307,19 +13307,19 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.9.1\":\n-  version: 3.9.1\n-  resolution: \"pg-pool@npm:3.9.1\"\n+\"pg-pool@npm:^3.9.5\":\n+  version: 3.9.5\n+  resolution: \"pg-pool@npm:3.9.5\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/2bbc0892ab7325486b7d5ad8ade59ec925476666ac3959cb4850814c5334bb2f1344258707f8d0445093b59dd6e94401508cebcee490d4827821549147a2ebd9\n+  checksum: 10c0/ebb36b6a1fd753213263a2e0e73d06ffe9fc93907deceae484c7fe4b464f6e9c41a578eb096b4b6012beec94a5d6e0e47728dfc4425e06d283744aa7432365a4\n   languageName: node\n   linkType: hard\n \n-\"pg-protocol@npm:*, pg-protocol@npm:^1.9.0\":\n-  version: 1.9.0\n-  resolution: \"pg-protocol@npm:1.9.0\"\n-  checksum: 10c0/c37e61d7fafa97f22eabf12de69863f42fdabb3671df9cc2623bd0ffd6bdedc212e7e8460ad2c721c8a08d8477b4f128a923bf2381905d68a23a532ec7517c77\n+\"pg-protocol@npm:*, pg-protocol@npm:^1.9.5\":\n+  version: 1.9.5\n+  resolution: \"pg-protocol@npm:1.9.5\"\n+  checksum: 10c0/5cb3444cf973adadd22ee9ea26bb1674f0d980ef8f9c66d426bbe67fc9cb5f0ca4a204bf7e432b3ab2ab59ac8227f4b18ab3b2e64eaed537e037e916991c7319\n   languageName: node\n   linkType: hard\n \n@@ -13352,13 +13352,13 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.15.1\n-  resolution: \"pg@npm:8.15.1\"\n+  version: 8.15.5\n+  resolution: \"pg@npm:8.15.5\"\n   dependencies:\n-    pg-cloudflare: \"npm:^1.2.0\"\n-    pg-connection-string: \"npm:^2.8.1\"\n-    pg-pool: \"npm:^3.9.1\"\n-    pg-protocol: \"npm:^1.9.0\"\n+    pg-cloudflare: \"npm:^1.2.5\"\n+    pg-connection-string: \"npm:^2.8.5\"\n+    pg-pool: \"npm:^3.9.5\"\n+    pg-protocol: \"npm:^1.9.5\"\n     pg-types: \"npm:^2.1.0\"\n     pgpass: \"npm:1.x\"\n   peerDependencies:\n@@ -13369,7 +13369,7 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/c6e5fd9cd6af7fc3208e48f860fd9ec9f7bc20192e449b0b36b096a9d5889de50706c705f6996e51a765bd4b7331179d7ffb43528a141bb996ee6f2c8f994c9a\n+  checksum: 10c0/4c118cd9bec37c8880b4489b9acbd10cf1eaa86a0a9024de2dac83f4ce5adedecc4cab54b66fa3bcb204aab7297c08d03617ae15499538939692b48651cc52d1\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\nlib/premailer_bundled_asset_strategy.rb\n@@ -15,7 +15,9 @@ def load(url)\n         headers\n       ).presence\n     else\n-      path = Rails.public_path.join(url.delete_prefix('/'))\n+      url = url.delete_prefix(Rails.configuration.action_controller.asset_host) if Rails.configuration.action_controller.asset_host.present?\n+      url = url.delete_prefix('/')\n+      path = Rails.public_path.join(url)\n       return unless path.exist?\n \n       path.read\n---\n\n\n---\n\nChoice C:\nspec/support/capybara.rb\n@@ -30,6 +30,10 @@ def common_chrome_options\n \n Capybara.javascript_driver = :headless_chrome\n \n+# Some of the flaky tests seem to be caused by github runners being too slow for the\n+# default timeout of 2 seconds\n+Capybara.default_max_wait_time = 8\n+\n RSpec.configure do |config|\n   config.before(:each, type: :system) do\n     driven_by :rack_test\n---\n\n\n---\n\nChoice D:\napp/presenters/status_relationships_presenter.rb\n@@ -7,14 +7,24 @@ class StatusRelationshipsPresenter\n               :bookmarks_map, :filters_map, :attributes_map\n \n   def initialize(statuses, current_account_id = nil, **options)\n+    @current_account_id = current_account_id\n+\n+    # Keeping a reference to @statuses is ok since `StatusRelationshipsPresenter`\n+    # basically never outlives the statuses collection it is passed\n+    @statuses = statuses\n+\n     if current_account_id.nil?\n-      @reblogs_map    = {}\n-      @favourites_map = {}\n-      @bookmarks_map  = {}\n-      @mutes_map      = {}\n-      @pins_map       = {}\n-      @filters_map    = {}\n+      @preloaded_account_relations = {}\n+      @filters_map     = {}\n+      @reblogs_map     = {}\n+      @favourites_map  = {}\n+      @bookmarks_map   = {}\n+      @mutes_map       = {}\n+      @pins_map        = {}\n+      @attributes_map  = {}\n     else\n+      @preloaded_account_relations = nil\n+\n       statuses            = statuses.compact\n       status_ids          = statuses.flat_map { |s| [s.id, s.reblog_of_id, s.proper.quote&.quoted_status_id] }.uniq.compact\n       conversation_ids    = statuses.flat_map { |s| [s.proper.conversation_id, s.proper.quote&.quoted_status&.conversation_id] }.uniq.compact\n@@ -30,6 +40,17 @@ def initialize(statuses, current_account_id = nil, **options)\n     end\n   end\n \n+  # This one is currently on-demand as it is only used for quote posts\n+  def preloaded_account_relations\n+    @preloaded_account_relations ||= begin\n+      accounts = @statuses.compact.flat_map { |s| [s.account, s.proper.account, s.proper.quote&.quoted_account] }.uniq.compact\n+\n+      account_ids = accounts.pluck(:id)\n+      account_domains = accounts.pluck(:domain).uniq\n+      Account.find(@current_account_id).relations_map(account_ids, account_domains)\n+    end\n+  end\n+\n   private\n \n   def build_filters_map(statuses, current_account_id)\n---\napp/serializers/rest/base_quote_serializer.rb\n@@ -20,6 +20,6 @@ def quoted_status\n   private\n \n   def status_filter\n-    @status_filter ||= StatusFilter.new(object.quoted_status, current_user&.account, instance_options[:relationships] || {})\n+    @status_filter ||= StatusFilter.new(object.quoted_status, current_user&.account, instance_options[:relationships]&.preloaded_account_relations || {})\n   end\n end\n---\nspec/requests/api/v1/timelines/home_spec.rb\n@@ -26,8 +26,13 @@\n       before do\n         user.account.follow!(bob)\n         user.account.follow!(ana)\n-        PostStatusService.new.call(bob, text: 'New toot from bob.')\n+        quoted = PostStatusService.new.call(bob, text: 'New toot from bob.')\n         PostStatusService.new.call(tim, text: 'New toot from tim.')\n+        reblogged = PostStatusService.new.call(tim, text: 'New toot from tim, which will end up boosted.')\n+        ReblogService.new.call(bob, reblogged)\n+        # TODO: use PostStatusService argument when available rather than manually creating quote\n+        quoting = PostStatusService.new.call(bob, text: 'Self-quote from bob.')\n+        Quote.create!(status: quoting, quoted_status: quoted, state: :accepted)\n         PostStatusService.new.call(ana, text: 'New toot from ana.')\n       end\n \n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [connection_pool](https://redirect.github.com/mperham/connection_pool) ([changelog](https://redirect.github.com/mperham/connection_pool/blob/main/Changes.md)) | `2.5.1` -> `2.5.2` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/connection_pool/2.5.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/connection_pool/2.5.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/connection_pool/2.5.1/2.5.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/connection_pool/2.5.1/2.5.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>mperham/connection_pool (connection_pool)</summary>\n\n### [`v2.5.2`](https://redirect.github.com/mperham/connection_pool/blob/HEAD/Changes.md#252)\n\n[Compare Source](https://redirect.github.com/mperham/connection_pool/compare/v2.5.1...v2.5.2)\n\n-   Rollback inadvertant change to `auto_reload_after_fork` default. \\[[#&#8203;200](https://redirect.github.com/mperham/connection_pool/issues/200)]\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNDguNCIsInVwZGF0ZWRJblZlciI6IjM5LjI0OC40IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nconfig/initializers/chewy.rb\n@@ -5,8 +5,7 @@\n port            = ENV.fetch('ES_PORT') { 9200 }\n user            = ENV.fetch('ES_USER', nil).presence\n password        = ENV.fetch('ES_PASS', nil).presence\n-fallback_prefix = ENV.fetch('REDIS_NAMESPACE', nil).presence\n-prefix          = ENV.fetch('ES_PREFIX') { fallback_prefix }\n+prefix          = ENV.fetch('ES_PREFIX', nil)\n ca_file         = ENV.fetch('ES_CA_FILE', nil).presence\n \n transport_options = { ssl: { ca_file: ca_file } } if ca_file.present?\n---\nlib/mastodon/redis_configuration.rb\n@@ -9,18 +9,17 @@ class Mastodon::RedisConfiguration\n \n   def base\n     @base ||= setup_config(prefix: nil, defaults: DEFAULTS)\n-              .merge(namespace: base_namespace)\n+              .merge(namespace: nil)\n   end\n \n   def sidekiq\n     @sidekiq ||= setup_config(prefix: 'SIDEKIQ_')\n-                 .merge(namespace: sidekiq_namespace)\n   end\n \n   def cache\n     @cache ||= setup_config(prefix: 'CACHE_')\n                .merge({\n-                 namespace: cache_namespace,\n+                 namespace: 'cache',\n                  expires_in: 10.minutes,\n                  connect_timeout: 5,\n                  pool: {\n@@ -36,24 +35,6 @@ def driver\n     ENV['REDIS_DRIVER'] == 'ruby' ? :ruby : :hiredis\n   end\n \n-  def namespace\n-    @namespace ||= ENV.fetch('REDIS_NAMESPACE', nil)\n-  end\n-\n-  def base_namespace\n-    return \"mastodon_test#{ENV.fetch('TEST_ENV_NUMBER', nil)}\" if Rails.env.test?\n-\n-    namespace\n-  end\n-\n-  def sidekiq_namespace\n-    namespace\n-  end\n-\n-  def cache_namespace\n-    namespace ? \"#{namespace}_cache\" : 'cache'\n-  end\n-\n   def setup_config(prefix: nil, defaults: {})\n     prefix = \"#{prefix}REDIS_\"\n \n@@ -62,7 +43,7 @@ def setup_config(prefix: nil, defaults: {})\n     password = ENV.fetch(\"#{prefix}PASSWORD\", nil)\n     host     = ENV.fetch(\"#{prefix}HOST\", defaults[:host])\n     port     = ENV.fetch(\"#{prefix}PORT\", defaults[:port])\n-    db       = ENV.fetch(\"#{prefix}DB\", defaults[:db])\n+    db       = Rails.env.test? ? ENV.fetch('TEST_ENV_NUMBER', defaults[:db]).to_i + 1 : ENV.fetch(\"#{prefix}DB\", defaults[:db])\n \n     return { url:, driver: } if url\n \n---\nspec/lib/mastodon/redis_configuration_spec.rb\n@@ -26,20 +26,6 @@\n     end\n   end\n \n-  shared_examples 'setting a namespace' do\n-    context 'when setting the `REDIS_NAMESPACE` variable' do\n-      around do |example|\n-        ClimateControl.modify REDIS_NAMESPACE: 'testns' do\n-          example.run\n-        end\n-      end\n-\n-      it 'uses the value for the namespace' do\n-        expect(subject[:namespace]).to eq 'testns'\n-      end\n-    end\n-  end\n-\n   shared_examples 'secondary configuration' do |prefix|\n     context \"when no `#{prefix}_REDIS_` environment variables are present\" do\n       it 'uses the url from the base config' do\n@@ -208,7 +194,6 @@\n     end\n \n     it_behaves_like 'setting a different driver'\n-    it_behaves_like 'setting a namespace'\n     it_behaves_like 'sentinel support'\n   end\n \n@@ -217,7 +202,6 @@\n \n     it_behaves_like 'secondary configuration', 'SIDEKIQ'\n     it_behaves_like 'setting a different driver'\n-    it_behaves_like 'setting a namespace'\n     it_behaves_like 'sentinel support', 'SIDEKIQ'\n   end\n \n@@ -238,22 +222,8 @@\n       })\n     end\n \n-    context 'when `REDIS_NAMESPACE` is not set' do\n-      it 'uses the `cache` namespace' do\n-        expect(subject[:namespace]).to eq 'cache'\n-      end\n-    end\n-\n-    context 'when setting the `REDIS_NAMESPACE` variable' do\n-      around do |example|\n-        ClimateControl.modify REDIS_NAMESPACE: 'testns' do\n-          example.run\n-        end\n-      end\n-\n-      it 'attaches the `_cache` postfix to the namespace' do\n-        expect(subject[:namespace]).to eq 'testns_cache'\n-      end\n+    it 'uses the `cache` namespace' do\n+      expect(subject[:namespace]).to eq 'cache'\n     end\n \n     it_behaves_like 'secondary configuration', 'CACHE'\n---\nspec/support/streaming_server_manager.rb\n@@ -17,7 +17,7 @@ def start(port: 4020)\n     @running_thread = Thread.new do\n       Open3.popen2e(\n         {\n-          'REDIS_NAMESPACE' => REDIS_CONFIGURATION.base[:namespace],\n+          'REDIS_DB' => (ENV.fetch('TEST_ENV_NUMBER', 0).to_i + 1).to_s,\n           'DB_NAME' => \"#{ENV.fetch('DB_NAME', 'mastodon')}_test#{ENV.fetch('TEST_ENV_NUMBER', '')}\",\n           'RAILS_ENV' => ENV.fetch('RAILS_ENV', 'test'),\n           'NODE_ENV' => ENV.fetch('STREAMING_NODE_ENV', 'development'),\n---\nstreaming/redis.js\n@@ -4,7 +4,6 @@ import { parseIntFromEnvValue } from './utils.js';\n \n /**\n  * @typedef RedisConfiguration\n- * @property {string|undefined} namespace\n  * @property {string|undefined} url\n  * @property {import('ioredis').RedisOptions} options\n  */\n@@ -64,8 +63,6 @@ function getSentinelConfiguration(env, commonOptions) {\n  * @returns {RedisConfiguration} configuration for the Redis connection\n  */\n export function configFromEnv(env) {\n-  const redisNamespace = env.REDIS_NAMESPACE;\n-\n   // These options apply for both REDIS_URL based connections and connections\n   // using the other REDIS_* environment variables:\n   const commonOptions = {\n@@ -82,16 +79,14 @@ export function configFromEnv(env) {\n   if (typeof env.REDIS_URL === 'string' && env.REDIS_URL.length > 0) {\n     return {\n       url: env.REDIS_URL,\n-      options: commonOptions,\n-      namespace: redisNamespace\n+      options: commonOptions\n     };\n   }\n \n   // If we have configuration for Redis Sentinel mode, prefer that:\n   if (hasSentinelConfiguration(env)) {\n     return {\n-      options: getSentinelConfiguration(env, commonOptions),\n-      namespace: redisNamespace\n+      options: getSentinelConfiguration(env, commonOptions)\n     };\n   }\n \n@@ -110,8 +105,7 @@ export function configFromEnv(env) {\n   };\n \n   return {\n-    options,\n-    namespace: redisNamespace\n+    options\n   };\n }\n \n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -160,7 +160,7 @@ GEM\n     cocoon (1.2.15)\n     color_diff (0.1)\n     concurrent-ruby (1.3.5)\n-    connection_pool (2.5.1)\n+    connection_pool (2.5.2)\n     cose (1.3.1)\n       cbor (~> 0.5.9)\n       openssl-signature_algorithm (~> 1.0)\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -64,7 +64,7 @@ gem 'kaminari', '~> 1.2'\n gem 'link_header', '~> 0.0'\n gem 'linzer', '~> 0.6.1'\n gem 'mario-redis-lock', '~> 1.2', require: 'redis_lock'\n-gem 'mime-types', '~> 3.6.0', require: 'mime/types/columnar'\n+gem 'mime-types', '~> 3.7.0', require: 'mime/types/columnar'\n gem 'mutex_m'\n gem 'nokogiri', '~> 1.15'\n gem 'oj', '~> 3.14'\n---\nGemfile.lock\n@@ -423,10 +423,10 @@ GEM\n       redis (>= 3.0.5)\n     matrix (0.4.2)\n     memory_profiler (1.1.0)\n-    mime-types (3.6.2)\n+    mime-types (3.7.0)\n       logger\n-      mime-types-data (~> 3.2015)\n-    mime-types-data (3.2025.0408)\n+      mime-types-data (~> 3.2025, >= 3.2025.0507)\n+    mime-types-data (3.2025.0507)\n     mini_mime (1.1.5)\n     mini_portile2 (2.8.8)\n     minitest (5.25.5)\n@@ -996,7 +996,7 @@ DEPENDENCIES\n   mail (~> 2.8)\n   mario-redis-lock (~> 1.2)\n   memory_profiler\n-  mime-types (~> 3.6.0)\n+  mime-types (~> 3.7.0)\n   mutex_m\n   net-http (~> 0.6.0)\n   net-ldap (~> 0.18)\n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -446,7 +446,7 @@ GEM\n     net-smtp (0.5.1)\n       net-protocol\n     nio4r (2.7.4)\n-    nokogiri (1.18.7)\n+    nokogiri (1.18.8)\n       mini_portile2 (~> 2.8.2)\n       racc (~> 1.4)\n     oj (3.16.10)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis changes the terms-of-service notification code to only mail users who signed in in the last year.\r\n\r\nOther users will instead have to go through an interstitial before getting back to the web interface.\r\n\r\n![image](https://github.com/user-attachments/assets/e20b3cdb-fad9-445b-b119-941d1827d73d)\r\n\r\n---\r\n\r\nFixes MAS-391\n\n---\n\nChoice A:\napp/models/media_attachment.rb\n@@ -122,6 +122,7 @@ class MediaAttachment < ApplicationRecord\n         output: {\n           'loglevel' => 'fatal',\n           'map_metadata' => '-1',\n+          'movflags' => 'faststart', # Move metadata to start of file so playback can begin before download finishes\n           'c:v' => 'copy',\n           'c:a' => 'copy',\n         }.freeze,\n---\n\n\n---\n\nChoice B:\napp/controllers/concerns/web_app_controller_concern.rb\n@@ -8,6 +8,7 @@ module WebAppControllerConcern\n \n     before_action :redirect_unauthenticated_to_permalinks!\n     before_action :set_referer_header\n+    before_action :redirect_to_tos_interstitial!\n \n     content_security_policy do |p|\n       policy = ContentSecurityPolicy.new\n@@ -45,6 +46,13 @@ def redirect_unauthenticated_to_permalinks!\n \n   protected\n \n+  def redirect_to_tos_interstitial!\n+    return unless current_user&.require_tos_interstitial?\n+\n+    @terms_of_service = TermsOfService.published.first\n+    render 'terms_of_service_interstitial/show', layout: 'auth'\n+  end\n+\n   def set_referer_header\n     response.set_header('Referrer-Policy', Setting.allow_referrer_origin ? 'strict-origin-when-cross-origin' : 'same-origin')\n   end\n---\napp/controllers/terms_of_service_controller.rb\n@@ -4,8 +4,19 @@ class TermsOfServiceController < ApplicationController\n   include WebAppControllerConcern\n \n   skip_before_action :require_functional!\n+  skip_before_action :redirect_to_tos_interstitial!\n+\n+  before_action :clear_redirect_interstitial!\n \n   def show\n     expires_in(15.seconds, public: true, stale_while_revalidate: 30.seconds, stale_if_error: 1.day) unless user_signed_in?\n   end\n+\n+  private\n+\n+  def clear_redirect_interstitial!\n+    return unless user_signed_in?\n+\n+    current_user.update(require_tos_interstitial: false)\n+  end\n end\n---\napp/models/terms_of_service.rb\n@@ -23,6 +23,8 @@ class TermsOfService < ApplicationRecord\n \n   validate :effective_date_cannot_be_in_the_past\n \n+  NOTIFICATION_ACTIVITY_CUTOFF = 1.year.freeze\n+\n   def published?\n     published_at.present?\n   end\n@@ -39,8 +41,20 @@ def notification_sent?\n     notification_sent_at.present?\n   end\n \n+  def base_user_scope\n+    User.confirmed.where(created_at: ..published_at).joins(:account)\n+  end\n+\n+  def email_notification_cutoff\n+    published_at - NOTIFICATION_ACTIVITY_CUTOFF\n+  end\n+\n+  def scope_for_interstitial\n+    base_user_scope.merge(Account.suspended).or(base_user_scope.where(current_sign_in_at: [nil, ...email_notification_cutoff]))\n+  end\n+\n   def scope_for_notification\n-    User.confirmed.joins(:account).merge(Account.without_suspended).where(created_at: (..published_at))\n+    base_user_scope.merge(Account.without_suspended).where(current_sign_in_at: email_notification_cutoff...)\n   end\n \n   private\n---\napp/models/user.rb\n@@ -25,6 +25,7 @@\n #  otp_backup_codes          :string           is an Array\n #  otp_required_for_login    :boolean          default(FALSE), not null\n #  otp_secret                :string\n+#  require_tos_interstitial  :boolean          default(FALSE), not null\n #  reset_password_sent_at    :datetime\n #  reset_password_token      :string\n #  settings                  :text\n---\napp/views/terms_of_service_interstitial/show.html.haml\n@@ -0,0 +1,15 @@\n+- content_for :header_tags do\n+  %meta{ name: 'robots', content: 'noindex, noarchive' }/\n+\n+- content_for :body_classes, 'app-body'\n+\n+.simple_form\n+  %h1.title= t('terms_of_service_interstitial.title', domain: site_hostname)\n+\n+  - effective_date = @terms_of_service.effective_date || Time.zone.today\n+  %p.lead= effective_date.past? ? t('terms_of_service_interstitial.past_preamble_html') : t('terms_of_service_interstitial.future_preamble_html', date: l(effective_date))\n+\n+  %p.lead= t('user_mailer.terms_of_service_changed.agreement', domain: site_hostname)\n+\n+  .stacked-actions\n+    = link_to t('terms_of_service_interstitial.review_link'), terms_of_service_path, class: 'button'\n---\napp/workers/admin/distribute_terms_of_service_notification_worker.rb\n@@ -6,6 +6,8 @@ class Admin::DistributeTermsOfServiceNotificationWorker\n   def perform(terms_of_service_id)\n     terms_of_service = TermsOfService.find(terms_of_service_id)\n \n+    terms_of_service.scope_for_interstitial.in_batches.update_all(require_tos_interstitial: true)\n+\n     terms_of_service.scope_for_notification.find_each do |user|\n       UserMailer.terms_of_service_changed(user, terms_of_service).deliver_later!\n     end\n---\nconfig/locales/en.yml\n@@ -1916,6 +1916,11 @@ en:\n     does_not_match_previous_name: does not match the previous name\n   terms_of_service:\n     title: Terms of Service\n+  terms_of_service_interstitial:\n+    future_preamble_html: We're making some changes to our terms of service, which will be effective on <strong>%{date}</strong>. We encourage you to review the updated terms.\n+    past_preamble_html: We have changed our terms of service since your last visit. We encourage you to review the updated terms.\n+    review_link: Review terms of service\n+    title: The terms of service of %{domain} are changing\n   themes:\n     contrast: Mastodon (High contrast)\n     default: Mastodon (Dark)\n---\ndb/migrate/20250428104538_add_require_tos_interstitial_to_users.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddRequireTosInterstitialToUsers < ActiveRecord::Migration[8.0]\n+  def change\n+    add_column :users, :require_tos_interstitial, :boolean, null: false, default: false\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_28_095029) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_28_104538) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -1222,6 +1222,7 @@\n     t.string \"time_zone\"\n     t.string \"otp_secret\"\n     t.datetime \"age_verified_at\"\n+    t.boolean \"require_tos_interstitial\", default: false, null: false\n     t.index [\"account_id\"], name: \"index_users_on_account_id\"\n     t.index [\"confirmation_token\"], name: \"index_users_on_confirmation_token\", unique: true\n     t.index [\"created_by_application_id\"], name: \"index_users_on_created_by_application_id\", where: \"(created_by_application_id IS NOT NULL)\"\n---\nspec/workers/admin/distribute_terms_of_service_notification_worker_spec.rb\n@@ -14,9 +14,10 @@\n \n     context 'with valid terms' do\n       let(:terms) { Fabricate(:terms_of_service) }\n-      let!(:user) { Fabricate :user, confirmed_at: 3.days.ago }\n+      let!(:user) { Fabricate(:user, confirmed_at: 3.days.ago) }\n+      let!(:old_user) { Fabricate(:user, confirmed_at: 2.years.ago, current_sign_in_at: 2.years.ago) }\n \n-      it 'sends the terms update via email', :inline_jobs do\n+      it 'sends the terms update via email and change the old user to require an interstitial', :inline_jobs do\n         emails = capture_emails { worker.perform(terms.id) }\n \n         expect(emails.size)\n@@ -26,6 +27,9 @@\n             to: [user.email],\n             subject: I18n.t('user_mailer.terms_of_service_changed.subject')\n           )\n+\n+        expect(user.reload.require_tos_interstitial?).to be false\n+        expect(old_user.reload.require_tos_interstitial?).to be true\n       end\n     end\n   end\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/video/components/hotkey_indicator.tsx\n@@ -24,7 +24,9 @@ export const HotkeyIndicator: React.FC<{\n     enter: [{ opacity: 1 }],\n     leave: [{ opacity: 0 }],\n     onRest: (_result, _ctrl, item) => {\n-      onDismiss(item);\n+      if (item) {\n+        onDismiss(item);\n+      }\n     },\n   });\n \n---\npackage.json\n@@ -44,7 +44,7 @@\n     \"@github/webauthn-json\": \"^2.1.1\",\n     \"@optimize-lodash/rollup-plugin\": \"^5.0.2\",\n     \"@rails/ujs\": \"7.1.501\",\n-    \"@react-spring/web\": \"^9.7.5\",\n+    \"@react-spring/web\": \"^10.0.0\",\n     \"@reduxjs/toolkit\": \"^2.0.1\",\n     \"@use-gesture/react\": \"^10.3.1\",\n     \"@vitejs/plugin-react\": \"^4.2.1\",\n---\nyarn.lock\n@@ -2451,7 +2451,7 @@ __metadata:\n     \"@github/webauthn-json\": \"npm:^2.1.1\"\n     \"@optimize-lodash/rollup-plugin\": \"npm:^5.0.2\"\n     \"@rails/ujs\": \"npm:7.1.501\"\n-    \"@react-spring/web\": \"npm:^9.7.5\"\n+    \"@react-spring/web\": \"npm:^10.0.0\"\n     \"@reduxjs/toolkit\": \"npm:^2.0.1\"\n     \"@testing-library/dom\": \"npm:^10.2.0\"\n     \"@testing-library/react\": \"npm:^16.0.0\"\n@@ -2877,69 +2877,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/animated@npm:9.7.5\"\n+\"@react-spring/animated@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/animated@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/f8c2473c60f39a878c7dd0fdfcfcdbc720521e1506aa3f63c9de64780694a0a73d5ccc535a5ccec3520ddb70a71cf43b038b32c18e99531522da5388c510ecd7\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/a8c40aff22def6dbe964b1f79fa4a7774c44bf5eb47c2ef969c8ecb2a426b4c972b147bf18635d6972dbec3fb95e70dd84f22b43c904c32dfc7a57ad144a0879\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/core@npm:9.7.5\"\n+\"@react-spring/core@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/core@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~9.7.5\"\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/animated\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/5bfd83dfe248cd91889f215f015d908c7714ef445740fd5afa054b27ebc7d5a456abf6c309e2459d9b5b436e78d6fda16b62b9601f96352e9130552c02270830\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/39036a153dbd973443e23d90cb8e7be83201b1f0e4105f8427ddb4c9e9e50e590e1b46282829e0bb6f3deebfab004e30dcb4eec0e34c5ebb234d5060c06ecae5\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/rafz@npm:9.7.5\"\n-  checksum: 10c0/8bdad180feaa9a0e870a513043a5e98a4e9b7292a9f887575b7e6fadab2677825bc894b7ff16c38511b35bfe6cc1072df5851c5fee64448d67551559578ca759\n+\"@react-spring/rafz@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/rafz@npm:10.0.0\"\n+  checksum: 10c0/8d92bc553172fa883ec2121b9cc62bfb43ff5d6c4e76363c8ce100fb6c3dd67c3dd629931786f9d1d63ac95a5d6996e4a08693cd56dda685bdbaf39b60e97f66\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/shared@npm:9.7.5\"\n+\"@react-spring/shared@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/shared@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/rafz\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/0207eacccdedd918a2fc55e78356ce937f445ce27ad9abd5d3accba8f9701a39349b55115641dc2b39bb9d3a155b058c185b411d292dc8cc5686bfa56f73b94f\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/833c3f42d35d22ac47a2f756ac47d85a81bc1decc5e7915f46013823344374378f883135754de94d5b43d8fff3c55fc4a359044c9a44f9095bd1ef1f11a20d4d\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/types@npm:9.7.5\"\n-  checksum: 10c0/85c05121853cacb64f7cf63a4855e9044635e1231f70371cd7b8c78bc10be6f4dd7c68f592f92a2607e8bb68051540989b4677a2ccb525dba937f5cd95dc8bc1\n+\"@react-spring/types@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/types@npm:10.0.0\"\n+  checksum: 10c0/ce1b959eaa8964f4004481d1e7c6eca0a8d636eb9f35ca654bdf77a78a860c0ff9eaa6bdc0cab84fc8a16be5c5fbb22b114249a2721bfc16191666670c0f44b3\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/web@npm:^9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/web@npm:9.7.5\"\n+\"@react-spring/web@npm:^10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/web@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~9.7.5\"\n-    \"@react-spring/core\": \"npm:~9.7.5\"\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/animated\": \"npm:~10.0.0\"\n+    \"@react-spring/core\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/bcd1e052e1b16341a12a19bf4515f153ca09d1fa86ff7752a5d02d7c4db58e8baf80e6283e64411f1e388c65340dce2254b013083426806b5dbae38bd151e53e\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/2218c87d9bfafab78b3079d94ea89ab9b95cb174910be5682fd8f5fc73e326ca956e9b844e5b255d1e3402138ad26981fae2fc1091d682a78359044a63b6421e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nconfig/environments/production.rb\n@@ -150,13 +150,6 @@\n     'Referrer-Policy' => 'same-origin',\n   }\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = if ENV['SECRET_KEY_BASE_DUMMY']\n-                          SecureRandom.hex(64)\n-                        else\n-                          ENV.fetch('OTP_SECRET')\n-                        end\n-\n   # Enable DNS rebinding protection and other `Host` header attacks.\n   # config.hosts = [\n   #   \"example.com\",     # Allow requests from example.com\n---\nconfig/environments/test.rb\n@@ -48,9 +48,6 @@\n   # Print deprecation notices to the stderr.\n   config.active_support.deprecation = :stderr\n \n-  # TODO: Remove once devise-two-factor data migration complete\n-  config.x.otp_secret = '100c7faeef00caa29242f6b04156742bf76065771fd4117990c4282b8748ff3d99f8fdae97c982ab5bd2e6756a159121377cce4421f4a8ecd2d67bd7749a3fb4'\n-\n   # Generate random VAPID keys\n   vapid_key = Webpush.generate_key\n   config.x.vapid_private_key = vapid_key.private_key\n---\ndb/post_migrate/20240307180905_migrate_devise_two_factor_secrets.rb\n@@ -79,8 +79,18 @@ def legacy_otp_secret\n   class MigrationUser < ApplicationRecord\n     self.table_name = :users\n \n+    LEGACY_OTP_SECRET = begin\n+      if Rails.env.test?\n+        '100c7faeef00caa29242f6b04156742bf76065771fd4117990c4282b8748ff3d99f8fdae97c982ab5bd2e6756a159121377cce4421f4a8ecd2d67bd7749a3fb4'\n+      elsif ENV['SECRET_KEY_BASE_DUMMY']\n+        SecureRandom.hex(64)\n+      else\n+        ENV.fetch('OTP_SECRET')\n+      end\n+    end\n+\n     devise :two_factor_authenticatable,\n-           otp_secret_encryption_key: Rails.configuration.x.otp_secret\n+           otp_secret_encryption_key: LEGACY_OTP_SECRET\n \n     include LegacyOtpSecret\n   end\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Update | Change |\n|---|---|---|\n| [node](https://nodejs.org) ([source](https://redirect.github.com/nodejs/node)) | minor | `22.14` -> `22.15` |\n\n---\n\n### Release Notes\n\n<details>\n<summary>nodejs/node (node)</summary>\n\n### [`v22.15.0`](https://redirect.github.com/nodejs/node/compare/v22.14.0...v22.15.0)\n\n[Compare Source](https://redirect.github.com/nodejs/node/compare/v22.14.0...v22.15.0)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNDguNCIsInVwZGF0ZWRJblZlciI6IjM5LjI0OC40IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\n.nvmrc\n@@ -1 +1 @@\n-22.14\n+22.15\n---\n\n\n---\n\nChoice B:\n.rubocop_todo.yml\n@@ -39,7 +39,6 @@ Style/FetchEnvVar:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/3_omniauth.rb'\n     - 'config/initializers/cache_buster.rb'\n-    - 'config/initializers/devise.rb'\n     - 'config/initializers/paperclip.rb'\n     - 'config/initializers/vapid.rb'\n     - 'lib/tasks/repo.rake'\n---\nconfig/initializers/devise.rb\n@@ -377,7 +377,7 @@ def session_cookie\n     config.usernamefield          = nil\n     config.emailfield             = 'email'\n     config.check_at_sign          = true\n-    config.pam_default_suffix     = ENV.fetch('PAM_EMAIL_DOMAIN') { ENV['LOCAL_DOMAIN'] }\n+    config.pam_default_suffix     = ENV.fetch('PAM_EMAIL_DOMAIN') { ENV.fetch('LOCAL_DOMAIN', nil) }\n     config.pam_default_service    = ENV.fetch('PAM_DEFAULT_SERVICE') { 'rpam' }\n     config.pam_controlled_service = ENV.fetch('PAM_CONTROLLED_SERVICE', nil).presence\n   end\n---\n\n\n---\n\nChoice C:\napp/lib/activitypub/activity/create.rb\n@@ -233,7 +233,7 @@ def process_quote\n \n     approval_uri = @status_parser.quote_approval_uri\n     approval_uri = nil if unsupported_uri_scheme?(approval_uri)\n-    @quote = Quote.new(account: @account, approval_uri: approval_uri)\n+    @quote = Quote.new(account: @account, approval_uri: approval_uri, legacy: @status_parser.legacy_quote?)\n   end\n \n   def process_hashtag(tag)\n---\napp/lib/activitypub/parser/status_parser.rb\n@@ -123,6 +123,10 @@ def quote_uri\n     end.first\n   end\n \n+  def legacy_quote?\n+    !@object.key?('quote')\n+  end\n+\n   # The inlined quote; out of the attributes we support, only `https://w3id.org/fep/044f#quote` explicitly supports inlined objects\n   def quoted_object\n     as_array(@object['quote']).first\n---\napp/models/quote.rb\n@@ -7,6 +7,7 @@\n #  id                :bigint(8)        not null, primary key\n #  activity_uri      :string\n #  approval_uri      :string\n+#  legacy            :boolean          default(FALSE), not null\n #  state             :integer          default(\"pending\"), not null\n #  created_at        :datetime         not null\n #  updated_at        :datetime         not null\n@@ -46,6 +47,10 @@ def reject!\n     end\n   end\n \n+  def acceptable?\n+    accepted? || !legacy?\n+  end\n+\n   def schedule_refresh_if_stale!\n     return unless quoted_status_id.present? && approval_uri.present? && updated_at <= BACKGROUND_REFRESH_INTERVAL.ago\n \n---\napp/serializers/rest/status_serializer.rb\n@@ -33,6 +33,10 @@ class REST::StatusSerializer < ActiveModel::Serializer\n   has_one :preview_card, key: :card, serializer: REST::PreviewCardSerializer\n   has_one :preloadable_poll, key: :poll, serializer: REST::PollSerializer\n \n+  def quote\n+    object.quote if object.quote&.acceptable?\n+  end\n+\n   def id\n     object.id.to_s\n   end\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -283,14 +283,14 @@ def update_quote!\n         # If the quoted post has changed, discard the old object and create a new one\n         if @status.quote.quoted_status.present? && ActivityPub::TagManager.instance.uri_for(@status.quote.quoted_status) != quote_uri\n           @status.quote.destroy\n-          quote = Quote.create(status: @status, approval_uri: approval_uri)\n+          quote = Quote.create(status: @status, approval_uri: approval_uri, legacy: @status_parser.legacy_quote?)\n           @quote_changed = true\n         else\n           quote = @status.quote\n-          quote.update(approval_uri: approval_uri, state: :pending) if quote.approval_uri != @status_parser.quote_approval_uri\n+          quote.update(approval_uri: approval_uri, state: :pending, legacy: @status_parser.legacy_quote?) if quote.approval_uri != @status_parser.quote_approval_uri\n         end\n       else\n-        quote = Quote.create(status: @status, approval_uri: approval_uri)\n+        quote = Quote.create(status: @status, approval_uri: approval_uri, legacy: @status_parser.legacy_quote?)\n         @quote_changed = true\n       end\n \n---\ndb/migrate/20250605110215_add_legacy_to_quotes.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddLegacyToQuotes < ActiveRecord::Migration[8.0]\n+  def change\n+    add_column :quotes, :legacy, :boolean, null: false, default: false\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_05_20_204643) do\n+ActiveRecord::Schema[8.0].define(version: 2025_06_05_110215) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -906,6 +906,7 @@\n     t.string \"activity_uri\"\n     t.datetime \"created_at\", null: false\n     t.datetime \"updated_at\", null: false\n+    t.boolean \"legacy\", default: false, null: false\n     t.index [\"account_id\", \"quoted_account_id\"], name: \"index_quotes_on_account_id_and_quoted_account_id\"\n     t.index [\"activity_uri\"], name: \"index_quotes_on_activity_uri\", unique: true, where: \"(activity_uri IS NOT NULL)\"\n     t.index [\"approval_uri\"], name: \"index_quotes_on_approval_uri\", where: \"(approval_uri IS NOT NULL)\"\n---\n\n\n---\n\nChoice D:\npackage.json\n@@ -99,7 +99,7 @@\n     \"redux-immutable\": \"^4.0.0\",\n     \"regenerator-runtime\": \"^0.14.0\",\n     \"requestidlecallback\": \"^0.3.0\",\n-    \"rollup-plugin-visualizer\": \"^5.14.0\",\n+    \"rollup-plugin-visualizer\": \"^6.0.0\",\n     \"sass\": \"^1.62.1\",\n     \"stacktrace-js\": \"^2.0.2\",\n     \"stringz\": \"^2.1.0\",\n---\nyarn.lock\n@@ -2554,7 +2554,7 @@ __metadata:\n     redux-immutable: \"npm:^4.0.0\"\n     regenerator-runtime: \"npm:^0.14.0\"\n     requestidlecallback: \"npm:^0.3.0\"\n-    rollup-plugin-visualizer: \"npm:^5.14.0\"\n+    rollup-plugin-visualizer: \"npm:^6.0.0\"\n     sass: \"npm:^1.62.1\"\n     stacktrace-js: \"npm:^2.0.2\"\n     stringz: \"npm:^2.1.0\"\n@@ -4887,6 +4887,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"bundle-name@npm:^4.1.0\":\n+  version: 4.1.0\n+  resolution: \"bundle-name@npm:4.1.0\"\n+  dependencies:\n+    run-applescript: \"npm:^7.0.0\"\n+  checksum: 10c0/8e575981e79c2bcf14d8b1c027a3775c095d362d1382312f444a7c861b0e21513c0bd8db5bd2b16e50ba0709fa622d4eab6b53192d222120305e68359daece29\n+  languageName: node\n+  linkType: hard\n+\n \"bytes@npm:3.1.2\":\n   version: 3.1.2\n   resolution: \"bytes@npm:3.1.2\"\n@@ -5535,6 +5544,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"default-browser-id@npm:^5.0.0\":\n+  version: 5.0.0\n+  resolution: \"default-browser-id@npm:5.0.0\"\n+  checksum: 10c0/957fb886502594c8e645e812dfe93dba30ed82e8460d20ce39c53c5b0f3e2afb6ceaec2249083b90bdfbb4cb0f34e1f73fde3d68cac00becdbcfd894156b5ead\n+  languageName: node\n+  linkType: hard\n+\n+\"default-browser@npm:^5.2.1\":\n+  version: 5.2.1\n+  resolution: \"default-browser@npm:5.2.1\"\n+  dependencies:\n+    bundle-name: \"npm:^4.1.0\"\n+    default-browser-id: \"npm:^5.0.0\"\n+  checksum: 10c0/73f17dc3c58026c55bb5538749597db31f9561c0193cd98604144b704a981c95a466f8ecc3c2db63d8bfd04fb0d426904834cfc91ae510c6aeb97e13c5167c4d\n+  languageName: node\n+  linkType: hard\n+\n \"define-data-property@npm:^1.0.1, define-data-property@npm:^1.1.4\":\n   version: 1.1.4\n   resolution: \"define-data-property@npm:1.1.4\"\n@@ -5546,10 +5572,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"define-lazy-prop@npm:^2.0.0\":\n-  version: 2.0.0\n-  resolution: \"define-lazy-prop@npm:2.0.0\"\n-  checksum: 10c0/db6c63864a9d3b7dc9def55d52764968a5af296de87c1b2cc71d8be8142e445208071953649e0386a8cc37cfcf9a2067a47207f1eb9ff250c2a269658fdae422\n+\"define-lazy-prop@npm:^3.0.0\":\n+  version: 3.0.0\n+  resolution: \"define-lazy-prop@npm:3.0.0\"\n+  checksum: 10c0/5ab0b2bf3fa58b3a443140bbd4cd3db1f91b985cc8a246d330b9ac3fc0b6a325a6d82bddc0b055123d745b3f9931afeea74a5ec545439a1630b9c8512b0eeb49\n   languageName: node\n   linkType: hard\n \n@@ -7506,12 +7532,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-docker@npm:^2.0.0, is-docker@npm:^2.1.1\":\n-  version: 2.2.1\n-  resolution: \"is-docker@npm:2.2.1\"\n+\"is-docker@npm:^3.0.0\":\n+  version: 3.0.0\n+  resolution: \"is-docker@npm:3.0.0\"\n   bin:\n     is-docker: cli.js\n-  checksum: 10c0/e828365958d155f90c409cdbe958f64051d99e8aedc2c8c4cd7c89dcf35329daed42f7b99346f7828df013e27deb8f721cf9408ba878c76eb9e8290235fbcdcc\n+  checksum: 10c0/d2c4f8e6d3e34df75a5defd44991b6068afad4835bb783b902fa12d13ebdb8f41b2a199dcb0b5ed2cb78bfee9e4c0bbdb69c2d9646f4106464674d3e697a5856\n   languageName: node\n   linkType: hard\n \n@@ -7572,6 +7598,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"is-inside-container@npm:^1.0.0\":\n+  version: 1.0.0\n+  resolution: \"is-inside-container@npm:1.0.0\"\n+  dependencies:\n+    is-docker: \"npm:^3.0.0\"\n+  bin:\n+    is-inside-container: cli.js\n+  checksum: 10c0/a8efb0e84f6197e6ff5c64c52890fa9acb49b7b74fed4da7c95383965da6f0fa592b4dbd5e38a79f87fc108196937acdbcd758fcefc9b140e479b39ce1fcd1cd\n+  languageName: node\n+  linkType: hard\n+\n \"is-lambda@npm:^1.0.1\":\n   version: 1.0.1\n   resolution: \"is-lambda@npm:1.0.1\"\n@@ -7736,12 +7773,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-wsl@npm:^2.2.0\":\n-  version: 2.2.0\n-  resolution: \"is-wsl@npm:2.2.0\"\n+\"is-wsl@npm:^3.1.0\":\n+  version: 3.1.0\n+  resolution: \"is-wsl@npm:3.1.0\"\n   dependencies:\n-    is-docker: \"npm:^2.0.0\"\n-  checksum: 10c0/a6fa2d370d21be487c0165c7a440d567274fbba1a817f2f0bfa41cc5e3af25041d84267baa22df66696956038a43973e72fca117918c91431920bdef490fa25e\n+    is-inside-container: \"npm:^1.0.0\"\n+  checksum: 10c0/d3317c11995690a32c362100225e22ba793678fe8732660c6de511ae71a0ff05b06980cf21f98a6bf40d7be0e9e9506f859abe00a1118287d63e53d0a3d06947\n   languageName: node\n   linkType: hard\n \n@@ -8841,14 +8878,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"open@npm:^8.4.0\":\n-  version: 8.4.2\n-  resolution: \"open@npm:8.4.2\"\n+\"open@npm:^10.1.2\":\n+  version: 10.1.2\n+  resolution: \"open@npm:10.1.2\"\n   dependencies:\n-    define-lazy-prop: \"npm:^2.0.0\"\n-    is-docker: \"npm:^2.1.1\"\n-    is-wsl: \"npm:^2.2.0\"\n-  checksum: 10c0/bb6b3a58401dacdb0aad14360626faf3fb7fba4b77816b373495988b724fb48941cad80c1b65d62bb31a17609b2cd91c41a181602caea597ca80dfbcc27e84c9\n+    default-browser: \"npm:^5.2.1\"\n+    define-lazy-prop: \"npm:^3.0.0\"\n+    is-inside-container: \"npm:^1.0.0\"\n+    is-wsl: \"npm:^3.1.0\"\n+  checksum: 10c0/1bee796f06e549ce764f693272100323fbc04da8fa3c5b0402d6c2d11b3d76fa0aac0be7535e710015ff035326638e3b9a563f3b0e7ac3266473ed5663caae6d\n   languageName: node\n   linkType: hard\n \n@@ -10647,11 +10685,11 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"rollup-plugin-visualizer@npm:^5.14.0\":\n-  version: 5.14.0\n-  resolution: \"rollup-plugin-visualizer@npm:5.14.0\"\n+\"rollup-plugin-visualizer@npm:^6.0.0\":\n+  version: 6.0.0\n+  resolution: \"rollup-plugin-visualizer@npm:6.0.0\"\n   dependencies:\n-    open: \"npm:^8.4.0\"\n+    open: \"npm:^10.1.2\"\n     picomatch: \"npm:^4.0.2\"\n     source-map: \"npm:^0.7.4\"\n     yargs: \"npm:^17.5.1\"\n@@ -10665,7 +10703,7 @@ __metadata:\n       optional: true\n   bin:\n     rollup-plugin-visualizer: dist/bin/cli.js\n-  checksum: 10c0/ec6ca9ed125bce9994ba49a340bda730661d8e8dc5c5dc014dc757185182e1eda49c6708f990cb059095e71a3741a5248f1e6ba0ced7056020692888e06b1ddf\n+  checksum: 10c0/803b7a93692824c31c4eb6595367717591123dbdc6be3402403bba633bb81ccfdbd16827e852af9da03fd7e8211a974717492e4032d14897c37c130f0cb86222\n   languageName: node\n   linkType: hard\n \n@@ -10765,6 +10803,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"run-applescript@npm:^7.0.0\":\n+  version: 7.0.0\n+  resolution: \"run-applescript@npm:7.0.0\"\n+  checksum: 10c0/bd821bbf154b8e6c8ecffeaf0c33cebbb78eb2987476c3f6b420d67ab4c5301faa905dec99ded76ebb3a7042b4e440189ae6d85bbbd3fc6e8d493347ecda8bfe\n+  languageName: node\n+  linkType: hard\n+\n \"run-parallel@npm:^1.1.9\":\n   version: 1.2.0\n   resolution: \"run-parallel@npm:1.2.0\"\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nNew Crowdin translations, automated with GitHub Actions\n\nSee `.github/workflows/crowdin-download.yml`\n\nThis PR will be updated every day with new translations.\n\nDue to a limitation in GitHub Actions, checks are not running on this PR without manual action.\nIf you want to run the checks, then close and re-open it.\n\n---\n\nChoice A:\napp/controllers/admin/rules_controller.rb\n@@ -50,6 +50,22 @@ def destroy\n       redirect_to admin_rules_path\n     end\n \n+    def move_up\n+      authorize @rule, :update?\n+\n+      @rule.move!(-1)\n+\n+      redirect_to admin_rules_path\n+    end\n+\n+    def move_down\n+      authorize @rule, :update?\n+\n+      @rule.move!(+1)\n+\n+      redirect_to admin_rules_path\n+    end\n+\n     private\n \n     def set_rule\n---\napp/javascript/material-icons/400-24px/arrow_downward-fill.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-800v487L216-537l-56 57 320 320 320-320-56-57-224 224v-487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/arrow_downward.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-800v487L216-537l-56 57 320 320 320-320-56-57-224 224v-487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/arrow_upward-fill.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-160v-487L216-423l-56-57 320-320 320 320-56 57-224-224v487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/material-icons/400-24px/arrow_upward.svg\n@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24\" viewBox=\"0 -960 960 960\" width=\"24\"><path d=\"M440-160v-487L216-423l-56-57 320-320 320 320-56 57-224-224v487h-80Z\"/></svg>\n\\ No newline at end of file\n---\napp/javascript/styles/mastodon/admin.scss\n@@ -1127,6 +1127,15 @@ a.name-tag,\n   }\n }\n \n+.rule-actions {\n+  display: flex;\n+  flex-direction: column;\n+\n+  a.table-action-link {\n+    padding-inline-start: 0;\n+  }\n+}\n+\n .dashboard__counters.admin-account-counters {\n   margin-top: 10px;\n }\n---\napp/models/rule.rb\n@@ -22,4 +22,18 @@ class Rule < ApplicationRecord\n   validates :text, presence: true, length: { maximum: TEXT_SIZE_LIMIT }\n \n   scope :ordered, -> { kept.order(priority: :asc, id: :asc) }\n+\n+  def move!(offset)\n+    rules = Rule.ordered.to_a\n+    position = rules.index(self)\n+\n+    rules.delete_at(position)\n+    rules.insert(position + offset, self)\n+\n+    transaction do\n+      rules.each.with_index do |rule, index|\n+        rule.update!(priority: index)\n+      end\n+    end\n+  end\n end\n---\napp/views/admin/rules/_rule.html.haml\n@@ -7,5 +7,7 @@\n     .announcements-list__item__meta\n       = rule.hint\n \n-    %div\n+    .rule-actions\n+      = table_link_to 'arrow_upward', t('admin.rules.move_up'), move_up_admin_rule_path(rule), method: :post if can?(:update, rule) && !rule_iteration.first?\n       = table_link_to 'delete', t('admin.rules.delete'), admin_rule_path(rule), method: :delete, data: { confirm: t('admin.accounts.are_you_sure') } if can?(:destroy, rule)\n+      = table_link_to 'arrow_downward', t('admin.rules.move_down'), move_down_admin_rule_path(rule), method: :post if can?(:update, rule) && !rule_iteration.last?\n---\nconfig/locales/en.yml\n@@ -790,6 +790,8 @@ en:\n       description_html: While most claim to have read and agree to the terms of service, usually people do not read through until after a problem arises. <strong>Make it easier to see your server's rules at a glance by providing them in a flat bullet point list.</strong> Try to keep individual rules short and simple, but try not to split them up into many separate items either.\n       edit: Edit rule\n       empty: No server rules have been defined yet.\n+      move_down: Move down\n+      move_up: Move up\n       title: Server rules\n     settings:\n       about:\n---\nconfig/routes/admin.rb\n@@ -93,7 +93,12 @@\n     end\n   end\n \n-  resources :rules, only: [:index, :new, :create, :edit, :update, :destroy]\n+  resources :rules, only: [:index, :new, :create, :edit, :update, :destroy] do\n+    member do\n+      post :move_up\n+      post :move_down\n+    end\n+  end\n \n   resources :webhooks do\n     member do\n---\nspec/models/rule_spec.rb\n@@ -16,4 +16,24 @@\n       end\n     end\n   end\n+\n+  describe '#move!' do\n+    let!(:first_rule) { Fabricate(:rule, text: 'foo') }\n+    let!(:second_rule) { Fabricate(:rule, text: 'bar') }\n+    let!(:third_rule) { Fabricate(:rule, text: 'baz') }\n+\n+    it 'moves the rules as expected' do\n+      expect { first_rule.move!(+1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(foo bar baz)).to(%w(bar foo baz))\n+\n+      expect { first_rule.move!(-1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(bar foo baz)).to(%w(foo bar baz))\n+\n+      expect { third_rule.move!(-1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(foo bar baz)).to(%w(foo baz bar))\n+\n+      expect { second_rule.move!(-1) }\n+        .to change { described_class.ordered.pluck(:text) }.from(%w(foo baz bar)).to(%w(foo bar baz))\n+    end\n+  end\n end\n---\nspec/system/admin/rules_spec.rb\n@@ -48,6 +48,29 @@ def submit_form\n       end\n     end\n \n+    describe 'Moving down an existing rule' do\n+      let!(:first_rule) { Fabricate(:rule, text: 'This is another rule') }\n+      let!(:second_rule) { Fabricate(:rule, text: 'This is a rule') }\n+\n+      it 'moves the rule down' do\n+        visit admin_rules_path\n+\n+        expect(page)\n+          .to have_content(I18n.t('admin.rules.title'))\n+\n+        expect(Rule.ordered.pluck(:text)).to eq ['This is another rule', 'This is a rule']\n+\n+        click_on(I18n.t('admin.rules.move_down'))\n+\n+        expect(page)\n+          .to have_content(I18n.t('admin.rules.title'))\n+          .and have_content(first_rule.text)\n+          .and have_content(second_rule.text)\n+\n+        expect(Rule.ordered.pluck(:text)).to eq ['This is a rule', 'This is another rule']\n+      end\n+    end\n+\n     describe 'Editing an existing rule' do\n       let!(:rule) { Fabricate :rule, text: 'Rule text' }\n \n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/components/featured_carousel.tsx\n@@ -1,5 +1,11 @@\n import type { ComponentPropsWithRef } from 'react';\n-import { useCallback, useEffect, useRef, useState } from 'react';\n+import {\n+  useCallback,\n+  useEffect,\n+  useLayoutEffect,\n+  useRef,\n+  useState,\n+} from 'react';\n \n import { defineMessages, FormattedMessage, useIntl } from 'react-intl';\n \n@@ -13,6 +19,7 @@ import { useDrag } from '@use-gesture/react';\n import { expandAccountFeaturedTimeline } from '@/mastodon/actions/timelines';\n import { IconButton } from '@/mastodon/components/icon_button';\n import StatusContainer from '@/mastodon/containers/status_container';\n+import { usePrevious } from '@/mastodon/hooks/usePrevious';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n import ChevronLeftIcon from '@/material-icons/400-24px/chevron_left.svg?react';\n import ChevronRightIcon from '@/material-icons/400-24px/chevron_right.svg?react';\n@@ -74,6 +81,7 @@ export const FeaturedCarousel: React.FC<{\n   const [currentSlideHeight, setCurrentSlideHeight] = useState(\n     wrapperRef.current?.scrollHeight ?? 0,\n   );\n+  const previousSlideHeight = usePrevious(currentSlideHeight);\n   const observerRef = useRef<ResizeObserver>(\n     new ResizeObserver(() => {\n       handleSlideChange(0);\n@@ -82,8 +90,10 @@ export const FeaturedCarousel: React.FC<{\n   const wrapperStyles = useSpring({\n     x: `-${slideIndex * 100}%`,\n     height: currentSlideHeight,\n+    // Don't animate from zero to the height of the initial slide\n+    immediate: !previousSlideHeight,\n   });\n-  useEffect(() => {\n+  useLayoutEffect(() => {\n     // Update slide height when the component mounts\n     if (currentSlideHeight === 0) {\n       handleSlideChange(0);\n---\napp/javascript/mastodon/hooks/usePrevious.ts\n@@ -0,0 +1,16 @@\n+import { useRef, useEffect } from 'react';\n+\n+/**\n+ * Returns the previous state of the passed in value.\n+ * On first render, undefined is returned.\n+ */\n+\n+export function usePrevious<T>(value: T): T | undefined {\n+  const ref = useRef<T>();\n+\n+  useEffect(() => {\n+    ref.current = value;\n+  }, [value]);\n+\n+  return ref.current;\n+}\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/locales/de.json\n@@ -56,8 +56,8 @@\n   \"account.mute_notifications_short\": \"Benachrichtigungen stummschalten\",\n   \"account.mute_short\": \"Stummschalten\",\n   \"account.muted\": \"Stummgeschaltet\",\n-  \"account.muting\": \"Wird stummgeschaltet\",\n-  \"account.mutual\": \"Ihr folgt euch\",\n+  \"account.muting\": \"Stummgeschaltet\",\n+  \"account.mutual\": \"Ihr folgt einander\",\n   \"account.no_bio\": \"Keine Beschreibung verf\u00fcgbar.\",\n   \"account.open_original_page\": \"Urspr\u00fcngliche Seite \u00f6ffnen\",\n   \"account.posts\": \"Beitr\u00e4ge\",\n---\n\n\n---\n\nChoice D:\napp/javascript/styles/mastodon/components.scss\n@@ -7068,18 +7068,19 @@ a.status-card {\n }\n \n .audio-player {\n-  overflow: hidden;\n   box-sizing: border-box;\n+  container: audio-player / inline-size;\n   position: relative;\n-  background: var(--player-background-color, var(--background-color));\n+  overflow: hidden;\n+  display: flex;\n+  flex-direction: column;\n+  width: 100%;\n+  aspect-ratio: 16 / 9;\n   color: var(--player-foreground-color);\n+  background: var(--player-background-color, var(--background-color));\n   border-radius: 8px;\n-  padding-bottom: 44px;\n-  width: 100%;\n   outline: 1px solid var(--media-outline-color);\n   outline-offset: -1px;\n-  aspect-ratio: 16 / 9;\n-  container: audio-player / inline-size;\n \n   &__controls {\n     display: grid;\n@@ -7128,9 +7129,17 @@ a.status-card {\n   }\n \n   &__visualizer {\n+    width: 100%;\n     max-width: 200px;\n   }\n \n+  .video-player__seek {\n+    position: absolute;\n+    inset: 0 0 auto;\n+    height: 24px;\n+    z-index: 1; /* Ensure this renders on top of audio player controls */\n+  }\n+\n   &.inactive {\n     .video-player__seek,\n     .audio-player__controls,\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis should allow the tests to complete. Stacktrace was:\r\n\r\n```\r\nstreaming/database.js:2\r\nimport pgConnectionString from 'pg-connection-string';\r\n       ^^^^^^^^^^^^^^^^^^\r\nSyntaxError: The requested module 'pg-connection-string' does not provide an export named 'default'\r\n    at ModuleJob._instantiate (node:internal/modules/esm/module_job:180:21)\r\n    at async ModuleJob.run (node:internal/modules/esm/module_job:263:5)\r\n    at async onImport.tracePromise.__proto__ (node:internal/modules/esm/loader:578:26)\r\n    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:116:5)\r\n\r\nNode.js v22.14.0\r\n```\r\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -4886,15 +4886,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"bundle-name@npm:^4.1.0\":\n-  version: 4.1.0\n-  resolution: \"bundle-name@npm:4.1.0\"\n-  dependencies:\n-    run-applescript: \"npm:^7.0.0\"\n-  checksum: 10c0/8e575981e79c2bcf14d8b1c027a3775c095d362d1382312f444a7c861b0e21513c0bd8db5bd2b16e50ba0709fa622d4eab6b53192d222120305e68359daece29\n-  languageName: node\n-  linkType: hard\n-\n \"bytes@npm:3.1.2\":\n   version: 3.1.2\n   resolution: \"bytes@npm:3.1.2\"\n@@ -5543,23 +5534,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"default-browser-id@npm:^5.0.0\":\n-  version: 5.0.0\n-  resolution: \"default-browser-id@npm:5.0.0\"\n-  checksum: 10c0/957fb886502594c8e645e812dfe93dba30ed82e8460d20ce39c53c5b0f3e2afb6ceaec2249083b90bdfbb4cb0f34e1f73fde3d68cac00becdbcfd894156b5ead\n-  languageName: node\n-  linkType: hard\n-\n-\"default-browser@npm:^5.2.1\":\n-  version: 5.2.1\n-  resolution: \"default-browser@npm:5.2.1\"\n-  dependencies:\n-    bundle-name: \"npm:^4.1.0\"\n-    default-browser-id: \"npm:^5.0.0\"\n-  checksum: 10c0/73f17dc3c58026c55bb5538749597db31f9561c0193cd98604144b704a981c95a466f8ecc3c2db63d8bfd04fb0d426904834cfc91ae510c6aeb97e13c5167c4d\n-  languageName: node\n-  linkType: hard\n-\n \"define-data-property@npm:^1.0.1, define-data-property@npm:^1.1.4\":\n   version: 1.1.4\n   resolution: \"define-data-property@npm:1.1.4\"\n@@ -5571,10 +5545,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"define-lazy-prop@npm:^3.0.0\":\n-  version: 3.0.0\n-  resolution: \"define-lazy-prop@npm:3.0.0\"\n-  checksum: 10c0/5ab0b2bf3fa58b3a443140bbd4cd3db1f91b985cc8a246d330b9ac3fc0b6a325a6d82bddc0b055123d745b3f9931afeea74a5ec545439a1630b9c8512b0eeb49\n+\"define-lazy-prop@npm:^2.0.0\":\n+  version: 2.0.0\n+  resolution: \"define-lazy-prop@npm:2.0.0\"\n+  checksum: 10c0/db6c63864a9d3b7dc9def55d52764968a5af296de87c1b2cc71d8be8142e445208071953649e0386a8cc37cfcf9a2067a47207f1eb9ff250c2a269658fdae422\n   languageName: node\n   linkType: hard\n \n@@ -7531,12 +7505,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-docker@npm:^3.0.0\":\n-  version: 3.0.0\n-  resolution: \"is-docker@npm:3.0.0\"\n+\"is-docker@npm:^2.0.0, is-docker@npm:^2.1.1\":\n+  version: 2.2.1\n+  resolution: \"is-docker@npm:2.2.1\"\n   bin:\n     is-docker: cli.js\n-  checksum: 10c0/d2c4f8e6d3e34df75a5defd44991b6068afad4835bb783b902fa12d13ebdb8f41b2a199dcb0b5ed2cb78bfee9e4c0bbdb69c2d9646f4106464674d3e697a5856\n+  checksum: 10c0/e828365958d155f90c409cdbe958f64051d99e8aedc2c8c4cd7c89dcf35329daed42f7b99346f7828df013e27deb8f721cf9408ba878c76eb9e8290235fbcdcc\n   languageName: node\n   linkType: hard\n \n@@ -7597,17 +7571,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-inside-container@npm:^1.0.0\":\n-  version: 1.0.0\n-  resolution: \"is-inside-container@npm:1.0.0\"\n-  dependencies:\n-    is-docker: \"npm:^3.0.0\"\n-  bin:\n-    is-inside-container: cli.js\n-  checksum: 10c0/a8efb0e84f6197e6ff5c64c52890fa9acb49b7b74fed4da7c95383965da6f0fa592b4dbd5e38a79f87fc108196937acdbcd758fcefc9b140e479b39ce1fcd1cd\n-  languageName: node\n-  linkType: hard\n-\n \"is-lambda@npm:^1.0.1\":\n   version: 1.0.1\n   resolution: \"is-lambda@npm:1.0.1\"\n@@ -7772,12 +7735,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-wsl@npm:^3.1.0\":\n-  version: 3.1.0\n-  resolution: \"is-wsl@npm:3.1.0\"\n+\"is-wsl@npm:^2.2.0\":\n+  version: 2.2.0\n+  resolution: \"is-wsl@npm:2.2.0\"\n   dependencies:\n-    is-inside-container: \"npm:^1.0.0\"\n-  checksum: 10c0/d3317c11995690a32c362100225e22ba793678fe8732660c6de511ae71a0ff05b06980cf21f98a6bf40d7be0e9e9506f859abe00a1118287d63e53d0a3d06947\n+    is-docker: \"npm:^2.0.0\"\n+  checksum: 10c0/a6fa2d370d21be487c0165c7a440d567274fbba1a817f2f0bfa41cc5e3af25041d84267baa22df66696956038a43973e72fca117918c91431920bdef490fa25e\n   languageName: node\n   linkType: hard\n \n@@ -8877,15 +8840,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"open@npm:^10.1.2\":\n-  version: 10.1.2\n-  resolution: \"open@npm:10.1.2\"\n+\"open@npm:^8.0.0\":\n+  version: 8.4.2\n+  resolution: \"open@npm:8.4.2\"\n   dependencies:\n-    default-browser: \"npm:^5.2.1\"\n-    define-lazy-prop: \"npm:^3.0.0\"\n-    is-inside-container: \"npm:^1.0.0\"\n-    is-wsl: \"npm:^3.1.0\"\n-  checksum: 10c0/1bee796f06e549ce764f693272100323fbc04da8fa3c5b0402d6c2d11b3d76fa0aac0be7535e710015ff035326638e3b9a563f3b0e7ac3266473ed5663caae6d\n+    define-lazy-prop: \"npm:^2.0.0\"\n+    is-docker: \"npm:^2.1.1\"\n+    is-wsl: \"npm:^2.2.0\"\n+  checksum: 10c0/bb6b3a58401dacdb0aad14360626faf3fb7fba4b77816b373495988b724fb48941cad80c1b65d62bb31a17609b2cd91c41a181602caea597ca80dfbcc27e84c9\n   languageName: node\n   linkType: hard\n \n@@ -10685,10 +10647,10 @@ __metadata:\n   linkType: hard\n \n \"rollup-plugin-visualizer@npm:^6.0.0\":\n-  version: 6.0.0\n-  resolution: \"rollup-plugin-visualizer@npm:6.0.0\"\n+  version: 6.0.1\n+  resolution: \"rollup-plugin-visualizer@npm:6.0.1\"\n   dependencies:\n-    open: \"npm:^10.1.2\"\n+    open: \"npm:^8.0.0\"\n     picomatch: \"npm:^4.0.2\"\n     source-map: \"npm:^0.7.4\"\n     yargs: \"npm:^17.5.1\"\n@@ -10702,7 +10664,7 @@ __metadata:\n       optional: true\n   bin:\n     rollup-plugin-visualizer: dist/bin/cli.js\n-  checksum: 10c0/803b7a93692824c31c4eb6595367717591123dbdc6be3402403bba633bb81ccfdbd16827e852af9da03fd7e8211a974717492e4032d14897c37c130f0cb86222\n+  checksum: 10c0/c938224b2027b3f490569c439d400b8fc80a0ad07b58720771b23623efe1efc7eb61f3de4506fb4520ce95ef4ea3c93153c31130559e017606c046c052690d1c\n   languageName: node\n   linkType: hard\n \n@@ -10802,13 +10764,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"run-applescript@npm:^7.0.0\":\n-  version: 7.0.0\n-  resolution: \"run-applescript@npm:7.0.0\"\n-  checksum: 10c0/bd821bbf154b8e6c8ecffeaf0c33cebbb78eb2987476c3f6b420d67ab4c5301faa905dec99ded76ebb3a7042b4e440189ae6d85bbbd3fc6e8d493347ecda8bfe\n-  languageName: node\n-  linkType: hard\n-\n \"run-parallel@npm:^1.1.9\":\n   version: 1.2.0\n   resolution: \"run-parallel@npm:1.2.0\"\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -13120,8 +13120,8 @@ __metadata:\n   linkType: hard\n \n \"ws@npm:^8.12.1, ws@npm:^8.18.0\":\n-  version: 8.18.1\n-  resolution: \"ws@npm:8.18.1\"\n+  version: 8.18.2\n+  resolution: \"ws@npm:8.18.2\"\n   peerDependencies:\n     bufferutil: ^4.0.1\n     utf-8-validate: \">=5.0.2\"\n@@ -13130,7 +13130,7 @@ __metadata:\n       optional: true\n     utf-8-validate:\n       optional: true\n-  checksum: 10c0/e498965d6938c63058c4310ffb6967f07d4fa06789d3364829028af380d299fe05762961742971c764973dce3d1f6a2633fe8b2d9410c9b52e534b4b882a99fa\n+  checksum: 10c0/4b50f67931b8c6943c893f59c524f0e4905bbd183016cfb0f2b8653aa7f28dad4e456b9d99d285bbb67cca4fedd9ce90dfdfaa82b898a11414ebd66ee99141e4\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\napp/models/custom_filter.rb\n@@ -33,7 +33,7 @@ class CustomFilter < ApplicationRecord\n   include Expireable\n   include Redisable\n \n-  enum :action, { warn: 0, hide: 1, blur: 2 }, suffix: :action\n+  enum :action, { warn: 0, hide: 1, blur: 2 }, suffix: :action, validate: true\n \n   belongs_to :account\n   has_many :keywords, class_name: 'CustomFilterKeyword', inverse_of: :custom_filter, dependent: :destroy\n---\nspec/requests/api/v2/filters_spec.rb\n@@ -115,6 +115,21 @@\n           .to start_with('application/json')\n       end\n     end\n+\n+    context 'when the given filter_action value is invalid' do\n+      let(:params) { { title: 'magic', filter_action: 'imaginary_value', keywords_attributes: [keyword: 'magic'] } }\n+\n+      it 'returns http unprocessable entity' do\n+        subject\n+\n+        expect(response)\n+          .to have_http_status(422)\n+        expect(response.content_type)\n+          .to start_with('application/json')\n+        expect(response.parsed_body)\n+          .to include(error: /Action is not included/)\n+      end\n+    end\n   end\n \n   describe 'GET /api/v2/filters/:id' do\n---\n\n\n---\n\nChoice D:\nstreaming/database.js\n@@ -1,5 +1,5 @@\n import pg from 'pg';\n-import pgConnectionString from 'pg-connection-string';\n+import { parse } from 'pg-connection-string';\n \n import { parseIntFromEnvValue } from './utils.js';\n \n@@ -16,15 +16,19 @@ export function configFromEnv(env, environment) {\n       password: env.DB_PASS || pg.defaults.password,\n       database: env.DB_NAME || 'mastodon_development',\n       host: env.DB_HOST || pg.defaults.host,\n-      port: parseIntFromEnvValue(env.DB_PORT, pg.defaults.port ?? 5432, 'DB_PORT')\n+      port: parseIntFromEnvValue(\n+        env.DB_PORT,\n+        pg.defaults.port ?? 5432,\n+        'DB_PORT',\n+      ),\n     },\n \n     production: {\n       user: env.DB_USER || 'mastodon',\n       password: env.DB_PASS || '',\n       database: env.DB_NAME || 'mastodon_production',\n       host: env.DB_HOST || 'localhost',\n-      port: parseIntFromEnvValue(env.DB_PORT, 5432, 'DB_PORT')\n+      port: parseIntFromEnvValue(env.DB_PORT, 5432, 'DB_PORT'),\n     },\n   };\n \n@@ -34,7 +38,7 @@ export function configFromEnv(env, environment) {\n   let baseConfig = {};\n \n   if (env.DATABASE_URL) {\n-    const parsedUrl = pgConnectionString.parse(env.DATABASE_URL);\n+    const parsedUrl = parse(env.DATABASE_URL);\n \n     // The result of dbUrlToConfig from pg-connection-string is not type\n     // compatible with pg.PoolConfig, since parts of the connection URL may be\n@@ -46,25 +50,34 @@ export function configFromEnv(env, environment) {\n     // https://github.com/brianc/node-postgres/issues/2280\n     //\n     // FIXME: clean up once brianc/node-postgres#3128 lands\n-    if (typeof parsedUrl.password === 'string') baseConfig.password = parsedUrl.password;\n+    if (typeof parsedUrl.password === 'string')\n+      baseConfig.password = parsedUrl.password;\n     if (typeof parsedUrl.host === 'string') baseConfig.host = parsedUrl.host;\n     if (typeof parsedUrl.user === 'string') baseConfig.user = parsedUrl.user;\n     if (typeof parsedUrl.port === 'string' && parsedUrl.port) {\n       const parsedPort = parseInt(parsedUrl.port, 10);\n       if (isNaN(parsedPort)) {\n-        throw new Error('Invalid port specified in DATABASE_URL environment variable');\n+        throw new Error(\n+          'Invalid port specified in DATABASE_URL environment variable',\n+        );\n       }\n       baseConfig.port = parsedPort;\n     }\n-    if (typeof parsedUrl.database === 'string') baseConfig.database = parsedUrl.database;\n-    if (typeof parsedUrl.options === 'string') baseConfig.options = parsedUrl.options;\n+    if (typeof parsedUrl.database === 'string')\n+      baseConfig.database = parsedUrl.database;\n+    if (typeof parsedUrl.options === 'string')\n+      baseConfig.options = parsedUrl.options;\n \n     // The pg-connection-string type definition isn't correct, as parsedUrl.ssl\n     // can absolutely be an Object, this is to work around these incorrect\n     // types, including the casting of parsedUrl.ssl to Record<string, any>\n     if (typeof parsedUrl.ssl === 'boolean') {\n       baseConfig.ssl = parsedUrl.ssl;\n-    } else if (typeof parsedUrl.ssl === 'object' && !Array.isArray(parsedUrl.ssl) && parsedUrl.ssl !== null) {\n+    } else if (\n+      typeof parsedUrl.ssl === 'object' &&\n+      !Array.isArray(parsedUrl.ssl) &&\n+      parsedUrl.ssl !== null\n+    ) {\n       /** @type {Record<string, any>} */\n       const sslOptions = parsedUrl.ssl;\n       baseConfig.ssl = {};\n@@ -83,17 +96,17 @@ export function configFromEnv(env, environment) {\n     baseConfig = pgConfigs[environment];\n \n     if (env.DB_SSLMODE) {\n-      switch(env.DB_SSLMODE) {\n-      case 'disable':\n-      case '':\n-        baseConfig.ssl = false;\n-        break;\n-      case 'no-verify':\n-        baseConfig.ssl = { rejectUnauthorized: false };\n-        break;\n-      default:\n-        baseConfig.ssl = {};\n-        break;\n+      switch (env.DB_SSLMODE) {\n+        case 'disable':\n+        case '':\n+          baseConfig.ssl = false;\n+          break;\n+        case 'no-verify':\n+          baseConfig.ssl = { rejectUnauthorized: false };\n+          break;\n+        default:\n+          baseConfig.ssl = {};\n+          break;\n       }\n     }\n   } else {\n@@ -134,16 +147,23 @@ export function getPool(config, environment, logger) {\n       return async (queryTextOrConfig, values, ...rest) => {\n         const start = process.hrtime();\n \n-        const result = await originalQuery.apply(pool, [queryTextOrConfig, values, ...rest]);\n+        const result = await originalQuery.apply(pool, [\n+          queryTextOrConfig,\n+          values,\n+          ...rest,\n+        ]);\n \n         const duration = process.hrtime(start);\n         const durationInMs = (duration[0] * 1000000000 + duration[1]) / 1000000;\n \n-        logger.debug({\n-          query: queryTextOrConfig,\n-          values,\n-          duration: durationInMs\n-        }, 'Executed database query');\n+        logger.debug(\n+          {\n+            query: queryTextOrConfig,\n+            values,\n+            duration: durationInMs,\n+          },\n+          'Executed database query',\n+        );\n \n         return result;\n       };\n---\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.7.0\":\n-  version: 2.7.0\n-  resolution: \"pg-connection-string@npm:2.7.0\"\n-  checksum: 10c0/50a1496a1c858f9495d78a2c7a66d93ef3602e718aff2953bb5738f3ea616d7f727f32fc20513c9bed127650cd14c1ddc7b458396f4000e689d4b64c65c5c51e\n+  version: 2.8.0\n+  resolution: \"pg-connection-string@npm:2.8.0\"\n+  checksum: 10c0/5600e3992ddacaa1022e4260a7bb8f24cc187cec1fc5d1526a274a4edc8db8b446f2a9c7f552c6f71f2dc7b3b391ceedebfef93de26b4943b6a26dfaecdd5bbc\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [pg-connection-string](https://redirect.github.com/brianc/node-postgres/tree/master/packages/pg-connection-string) ([source](https://redirect.github.com/brianc/node-postgres/tree/HEAD/packages/pg-connection-string)) | [`2.7.0` -> `2.8.1`](https://renovatebot.com/diffs/npm/pg-connection-string/2.7.0/2.8.1) | [![age](https://developer.mend.io/api/mc/badges/age/npm/pg-connection-string/2.8.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/pg-connection-string/2.8.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/pg-connection-string/2.7.0/2.8.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/pg-connection-string/2.7.0/2.8.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>brianc/node-postgres (pg-connection-string)</summary>\n\n### [`v2.8.1`](https://redirect.github.com/brianc/node-postgres/compare/pg-connection-string@2.8.0...pg-connection-string@2.8.1)\n\n[Compare Source](https://redirect.github.com/brianc/node-postgres/compare/pg-connection-string@2.8.0...pg-connection-string@2.8.1)\n\n### [`v2.8.0`](https://redirect.github.com/brianc/node-postgres/blob/HEAD/CHANGELOG.md#v280)\n\n[Compare Source](https://redirect.github.com/brianc/node-postgres/compare/pg-connection-string@2.7.0...pg-connection-string@2.8.0)\n\n-   Add support for parsing JSON\\[] and UUID\\[] result types\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNDguNCIsInVwZGF0ZWRJblZlciI6IjM5LjI0OC40IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -200,7 +200,7 @@ GEM\n     doorkeeper (5.8.2)\n       railties (>= 5)\n     dotenv (3.1.8)\n-    drb (2.2.1)\n+    drb (2.2.3)\n     dry-cli (1.2.0)\n     elasticsearch (7.17.11)\n       elasticsearch-api (= 7.17.11)\n@@ -602,8 +602,8 @@ GEM\n     pastel (0.8.0)\n       tty-color (~> 0.5)\n     pg (1.5.9)\n-    pghero (3.6.2)\n-      activerecord (>= 6.1)\n+    pghero (3.7.0)\n+      activerecord (>= 7.1)\n     pp (0.6.2)\n       prettyprint\n     premailer (1.27.0)\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.7.0\":\n-  version: 2.7.0\n-  resolution: \"pg-connection-string@npm:2.7.0\"\n-  checksum: 10c0/50a1496a1c858f9495d78a2c7a66d93ef3602e718aff2953bb5738f3ea616d7f727f32fc20513c9bed127650cd14c1ddc7b458396f4000e689d4b64c65c5c51e\n+  version: 2.8.1\n+  resolution: \"pg-connection-string@npm:2.8.1\"\n+  checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\napp/javascript/entrypoints/sign_up.ts\n@@ -4,9 +4,12 @@ import axios from 'axios';\n import ready from '../mastodon/ready';\n \n async function checkConfirmation() {\n-  const response = await axios.get('/api/v1/emails/check_confirmation');\n+  const response = await axios.get('/api/v1/emails/check_confirmation', {\n+    headers: { Accept: 'application/json' },\n+    withCredentials: true,\n+  });\n \n-  if (response.data) {\n+  if (response.status === 200 && response.data === true) {\n     window.location.href = '/start';\n   }\n }\n---\n\n\n---\n\nChoice D:\napp/javascript/styles/mastodon/components.scss\n@@ -7068,18 +7068,19 @@ a.status-card {\n }\n \n .audio-player {\n-  overflow: hidden;\n   box-sizing: border-box;\n+  container: audio-player / inline-size;\n   position: relative;\n-  background: var(--player-background-color, var(--background-color));\n+  overflow: hidden;\n+  display: flex;\n+  flex-direction: column;\n+  width: 100%;\n+  aspect-ratio: 16 / 9;\n   color: var(--player-foreground-color);\n+  background: var(--player-background-color, var(--background-color));\n   border-radius: 8px;\n-  padding-bottom: 44px;\n-  width: 100%;\n   outline: 1px solid var(--media-outline-color);\n   outline-offset: -1px;\n-  aspect-ratio: 16 / 9;\n-  container: audio-player / inline-size;\n \n   &__controls {\n     display: grid;\n@@ -7128,9 +7129,17 @@ a.status-card {\n   }\n \n   &__visualizer {\n+    width: 100%;\n     max-width: 200px;\n   }\n \n+  .video-player__seek {\n+    position: absolute;\n+    inset: 0 0 auto;\n+    height: 24px;\n+    z-index: 1; /* Ensure this renders on top of audio player controls */\n+  }\n+\n   &.inactive {\n     .video-player__seek,\n     .audio-player__controls,\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [pg](https://redirect.github.com/brianc/node-postgres) ([source](https://redirect.github.com/brianc/node-postgres/tree/HEAD/packages/pg)) | [`8.14.1` -> `8.15.1`](https://renovatebot.com/diffs/npm/pg/8.14.1/8.15.1) | [![age](https://developer.mend.io/api/mc/badges/age/npm/pg/8.15.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/pg/8.15.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/pg/8.14.1/8.15.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/pg/8.14.1/8.15.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>brianc/node-postgres (pg)</summary>\n\n### [`v8.15.1`](https://redirect.github.com/brianc/node-postgres/compare/pg@8.15.0...fb25f7bdb3deb0ca3602d1ac1693977dc1033f35)\n\n[Compare Source](https://redirect.github.com/brianc/node-postgres/compare/pg@8.15.0...pg@8.15.1)\n\n### [`v8.15.0`](https://redirect.github.com/brianc/node-postgres/blob/HEAD/CHANGELOG.md#pg8150)\n\n[Compare Source](https://redirect.github.com/brianc/node-postgres/compare/pg@8.14.1...pg@8.15.0)\n\n-   Add support for [esm](https://redirect.github.com/brianc/node-postgres/pull/3423) importing. CommonJS importing is still also supported.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNDguNCIsInVwZGF0ZWRJblZlciI6IjM5LjI0OC40IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -381,7 +381,7 @@ GEM\n       marcel (~> 1.0.1)\n       mime-types\n       terrapin (>= 0.6.0, < 2.0)\n-    language_server-protocol (3.17.0.4)\n+    language_server-protocol (3.17.0.5)\n     launchy (3.1.1)\n       addressable (~> 2.8)\n       childprocess (~> 5.0)\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.5)\n+    rubocop (1.75.6)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -13279,14 +13279,14 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-cloudflare@npm:^1.1.1\":\n-  version: 1.1.1\n-  resolution: \"pg-cloudflare@npm:1.1.1\"\n-  checksum: 10c0/a68b957f755be6af813d68ccaf4c906a000fd2ecb362cd281220052cc9e2f6c26da3b88792742387008c30b3bf0d2fa3a0eff04aeb8af4414023c99ae78e07bd\n+\"pg-cloudflare@npm:^1.2.0\":\n+  version: 1.2.0\n+  resolution: \"pg-cloudflare@npm:1.2.0\"\n+  checksum: 10c0/d6f2d032aeab291b17d627b051aae85420aea86a3371895a77b55fec93e3dac05880fbf09e5de33486ad3a2e6d7d56a025a8aa66f0d5883984f9834e4cd6f6a4\n   languageName: node\n   linkType: hard\n \n-\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.7.0\":\n+\"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.8.1\":\n   version: 2.8.1\n   resolution: \"pg-connection-string@npm:2.8.1\"\n   checksum: 10c0/87cb519d97a5bdc756f71a6b051eea4d4887e2e102bc694ecda935fe636a037666a0444729b08c7a26c2e9e4b052b2b366af58492ccc49704bacd6876f946ce8\n@@ -13307,19 +13307,19 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.8.0\":\n-  version: 3.8.0\n-  resolution: \"pg-pool@npm:3.8.0\"\n+\"pg-pool@npm:^3.9.1\":\n+  version: 3.9.1\n+  resolution: \"pg-pool@npm:3.9.1\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/c05287b0caafeab43807e6ad22d153c09c473dbeb5b2cea13b83102376e9a56f46b91fa9adf9d53885ce198280c6a95555390987c42b3858d1936d3e0cdc83aa\n+  checksum: 10c0/2bbc0892ab7325486b7d5ad8ade59ec925476666ac3959cb4850814c5334bb2f1344258707f8d0445093b59dd6e94401508cebcee490d4827821549147a2ebd9\n   languageName: node\n   linkType: hard\n \n-\"pg-protocol@npm:*, pg-protocol@npm:^1.8.0\":\n-  version: 1.8.0\n-  resolution: \"pg-protocol@npm:1.8.0\"\n-  checksum: 10c0/2be784955599d84b564795952cee52cc2b8eab0be43f74fc1061506353801e282c1d52c9e0691a9b72092c1f3fde370e9b181e80fef6bb82a9b8d1618bfa91e6\n+\"pg-protocol@npm:*, pg-protocol@npm:^1.9.0\":\n+  version: 1.9.0\n+  resolution: \"pg-protocol@npm:1.9.0\"\n+  checksum: 10c0/c37e61d7fafa97f22eabf12de69863f42fdabb3671df9cc2623bd0ffd6bdedc212e7e8460ad2c721c8a08d8477b4f128a923bf2381905d68a23a532ec7517c77\n   languageName: node\n   linkType: hard\n \n@@ -13352,13 +13352,13 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.14.1\n-  resolution: \"pg@npm:8.14.1\"\n+  version: 8.15.1\n+  resolution: \"pg@npm:8.15.1\"\n   dependencies:\n-    pg-cloudflare: \"npm:^1.1.1\"\n-    pg-connection-string: \"npm:^2.7.0\"\n-    pg-pool: \"npm:^3.8.0\"\n-    pg-protocol: \"npm:^1.8.0\"\n+    pg-cloudflare: \"npm:^1.2.0\"\n+    pg-connection-string: \"npm:^2.8.1\"\n+    pg-pool: \"npm:^3.9.1\"\n+    pg-protocol: \"npm:^1.9.0\"\n     pg-types: \"npm:^2.1.0\"\n     pgpass: \"npm:1.x\"\n   peerDependencies:\n@@ -13369,7 +13369,7 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/221741cfcea4ab32c8b57bd60703bc36cfb5622dcac56c19e45f504ef8669f2f2e0429af8850f58079cfc89055da35b5a5e12de19e0505e3f61a4b4349388dcb\n+  checksum: 10c0/c6e5fd9cd6af7fc3208e48f860fd9ec9f7bc20192e449b0b36b096a9d5889de50706c705f6996e51a765bd4b7331179d7ffb43528a141bb996ee6f2c8f994c9a\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -66,10 +66,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/compat-data@npm:^7.22.6, @babel/compat-data@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/compat-data@npm:7.27.1\"\n-  checksum: 10c0/03e3a01b6772858dc5064f332ad4dc16fbbc0353f2180fd663a2651e8305058e35b6db57114e345d925def9b73cd7a322e95a45913428b8db705a098fd3dd289\n+\"@babel/compat-data@npm:^7.22.6, @babel/compat-data@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/compat-data@npm:7.27.2\"\n+  checksum: 10c0/077c9e01af3b90decee384a6a44dcf353898e980cee22ec7941f9074655dbbe97ec317345536cdc7ef7391521e1497930c522a3816af473076dd524be7fccd32\n   languageName: node\n   linkType: hard\n \n@@ -128,16 +128,16 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/helper-compilation-targets@npm:7.27.1\"\n+\"@babel/helper-compilation-targets@npm:^7.22.6, @babel/helper-compilation-targets@npm:^7.27.1, @babel/helper-compilation-targets@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/helper-compilation-targets@npm:7.27.2\"\n   dependencies:\n-    \"@babel/compat-data\": \"npm:^7.27.1\"\n+    \"@babel/compat-data\": \"npm:^7.27.2\"\n     \"@babel/helper-validator-option\": \"npm:^7.27.1\"\n     browserslist: \"npm:^4.24.0\"\n     lru-cache: \"npm:^5.1.1\"\n     semver: \"npm:^6.3.1\"\n-  checksum: 10c0/1cfd3760a1bf1e367ea4a91214c041be7076197ba7a4f3c0710cab00fb5734eb010a2946efe6ecfb1ca9dc63e6c69644a1afa399db4082f374b9311e129f6f0b\n+  checksum: 10c0/f338fa00dcfea931804a7c55d1a1c81b6f0a09787e528ec580d5c21b3ecb3913f6cb0f361368973ce953b824d910d3ac3e8a8ee15192710d3563826447193ad1\n   languageName: node\n   linkType: hard\n \n@@ -934,16 +934,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/plugin-transform-object-rest-spread@npm:^7.27.1\":\n-  version: 7.27.1\n-  resolution: \"@babel/plugin-transform-object-rest-spread@npm:7.27.1\"\n+\"@babel/plugin-transform-object-rest-spread@npm:^7.27.2\":\n+  version: 7.27.2\n+  resolution: \"@babel/plugin-transform-object-rest-spread@npm:7.27.2\"\n   dependencies:\n-    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.2\"\n     \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n+    \"@babel/plugin-transform-destructuring\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-parameters\": \"npm:^7.27.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/ac73caea178b51a64cc1c5e5ce1a67bacf89c1af664ef219aa1403d54258804113d6f267820c211768460e056f3aeb642c98ee14842c4fb548974c82f7dbe7dd\n+  checksum: 10c0/5e255b262dd65c8700078d9f6ed87bd45f951a905dda6b3414be28d7b2781b18e6b812e9d71421e61360c9cf51e1e619c1d48348593bb7399496f61f5f221446\n   languageName: node\n   linkType: hard\n \n@@ -1270,11 +1271,11 @@ __metadata:\n   linkType: hard\n \n \"@babel/preset-env@npm:^7.11.0, @babel/preset-env@npm:^7.12.1, @babel/preset-env@npm:^7.22.4\":\n-  version: 7.27.1\n-  resolution: \"@babel/preset-env@npm:7.27.1\"\n+  version: 7.27.2\n+  resolution: \"@babel/preset-env@npm:7.27.2\"\n   dependencies:\n-    \"@babel/compat-data\": \"npm:^7.27.1\"\n-    \"@babel/helper-compilation-targets\": \"npm:^7.27.1\"\n+    \"@babel/compat-data\": \"npm:^7.27.2\"\n+    \"@babel/helper-compilation-targets\": \"npm:^7.27.2\"\n     \"@babel/helper-plugin-utils\": \"npm:^7.27.1\"\n     \"@babel/helper-validator-option\": \"npm:^7.27.1\"\n     \"@babel/plugin-bugfix-firefox-class-in-computed-class-key\": \"npm:^7.27.1\"\n@@ -1316,7 +1317,7 @@ __metadata:\n     \"@babel/plugin-transform-new-target\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-nullish-coalescing-operator\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-numeric-separator\": \"npm:^7.27.1\"\n-    \"@babel/plugin-transform-object-rest-spread\": \"npm:^7.27.1\"\n+    \"@babel/plugin-transform-object-rest-spread\": \"npm:^7.27.2\"\n     \"@babel/plugin-transform-object-super\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-optional-catch-binding\": \"npm:^7.27.1\"\n     \"@babel/plugin-transform-optional-chaining\": \"npm:^7.27.1\"\n@@ -1344,7 +1345,7 @@ __metadata:\n     semver: \"npm:^6.3.1\"\n   peerDependencies:\n     \"@babel/core\": ^7.0.0-0\n-  checksum: 10c0/893b269f5e7e2084ee7fb60d3a1f154470c89169475170a8a595f1910cade9c9978b42df5405a46a699529dfdb1c6b0135cc4c0aa8f9e685ae230b1cb0172ad9\n+  checksum: 10c0/fd7ec310832a9ff26ed8d56bc0832cdbdb3a188e022050b74790796650649fb8373568af05b320b58b3ff922507979bad50ff95a4d504ab0081134480103504e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nstreaming/database.js\n@@ -1,5 +1,5 @@\n import pg from 'pg';\n-import pgConnectionString from 'pg-connection-string';\n+import { parse } from 'pg-connection-string';\n \n import { parseIntFromEnvValue } from './utils.js';\n \n@@ -16,15 +16,19 @@ export function configFromEnv(env, environment) {\n       password: env.DB_PASS || pg.defaults.password,\n       database: env.DB_NAME || 'mastodon_development',\n       host: env.DB_HOST || pg.defaults.host,\n-      port: parseIntFromEnvValue(env.DB_PORT, pg.defaults.port ?? 5432, 'DB_PORT')\n+      port: parseIntFromEnvValue(\n+        env.DB_PORT,\n+        pg.defaults.port ?? 5432,\n+        'DB_PORT',\n+      ),\n     },\n \n     production: {\n       user: env.DB_USER || 'mastodon',\n       password: env.DB_PASS || '',\n       database: env.DB_NAME || 'mastodon_production',\n       host: env.DB_HOST || 'localhost',\n-      port: parseIntFromEnvValue(env.DB_PORT, 5432, 'DB_PORT')\n+      port: parseIntFromEnvValue(env.DB_PORT, 5432, 'DB_PORT'),\n     },\n   };\n \n@@ -34,7 +38,7 @@ export function configFromEnv(env, environment) {\n   let baseConfig = {};\n \n   if (env.DATABASE_URL) {\n-    const parsedUrl = pgConnectionString.parse(env.DATABASE_URL);\n+    const parsedUrl = parse(env.DATABASE_URL);\n \n     // The result of dbUrlToConfig from pg-connection-string is not type\n     // compatible with pg.PoolConfig, since parts of the connection URL may be\n@@ -46,25 +50,34 @@ export function configFromEnv(env, environment) {\n     // https://github.com/brianc/node-postgres/issues/2280\n     //\n     // FIXME: clean up once brianc/node-postgres#3128 lands\n-    if (typeof parsedUrl.password === 'string') baseConfig.password = parsedUrl.password;\n+    if (typeof parsedUrl.password === 'string')\n+      baseConfig.password = parsedUrl.password;\n     if (typeof parsedUrl.host === 'string') baseConfig.host = parsedUrl.host;\n     if (typeof parsedUrl.user === 'string') baseConfig.user = parsedUrl.user;\n     if (typeof parsedUrl.port === 'string' && parsedUrl.port) {\n       const parsedPort = parseInt(parsedUrl.port, 10);\n       if (isNaN(parsedPort)) {\n-        throw new Error('Invalid port specified in DATABASE_URL environment variable');\n+        throw new Error(\n+          'Invalid port specified in DATABASE_URL environment variable',\n+        );\n       }\n       baseConfig.port = parsedPort;\n     }\n-    if (typeof parsedUrl.database === 'string') baseConfig.database = parsedUrl.database;\n-    if (typeof parsedUrl.options === 'string') baseConfig.options = parsedUrl.options;\n+    if (typeof parsedUrl.database === 'string')\n+      baseConfig.database = parsedUrl.database;\n+    if (typeof parsedUrl.options === 'string')\n+      baseConfig.options = parsedUrl.options;\n \n     // The pg-connection-string type definition isn't correct, as parsedUrl.ssl\n     // can absolutely be an Object, this is to work around these incorrect\n     // types, including the casting of parsedUrl.ssl to Record<string, any>\n     if (typeof parsedUrl.ssl === 'boolean') {\n       baseConfig.ssl = parsedUrl.ssl;\n-    } else if (typeof parsedUrl.ssl === 'object' && !Array.isArray(parsedUrl.ssl) && parsedUrl.ssl !== null) {\n+    } else if (\n+      typeof parsedUrl.ssl === 'object' &&\n+      !Array.isArray(parsedUrl.ssl) &&\n+      parsedUrl.ssl !== null\n+    ) {\n       /** @type {Record<string, any>} */\n       const sslOptions = parsedUrl.ssl;\n       baseConfig.ssl = {};\n@@ -83,17 +96,17 @@ export function configFromEnv(env, environment) {\n     baseConfig = pgConfigs[environment];\n \n     if (env.DB_SSLMODE) {\n-      switch(env.DB_SSLMODE) {\n-      case 'disable':\n-      case '':\n-        baseConfig.ssl = false;\n-        break;\n-      case 'no-verify':\n-        baseConfig.ssl = { rejectUnauthorized: false };\n-        break;\n-      default:\n-        baseConfig.ssl = {};\n-        break;\n+      switch (env.DB_SSLMODE) {\n+        case 'disable':\n+        case '':\n+          baseConfig.ssl = false;\n+          break;\n+        case 'no-verify':\n+          baseConfig.ssl = { rejectUnauthorized: false };\n+          break;\n+        default:\n+          baseConfig.ssl = {};\n+          break;\n       }\n     }\n   } else {\n@@ -134,16 +147,23 @@ export function getPool(config, environment, logger) {\n       return async (queryTextOrConfig, values, ...rest) => {\n         const start = process.hrtime();\n \n-        const result = await originalQuery.apply(pool, [queryTextOrConfig, values, ...rest]);\n+        const result = await originalQuery.apply(pool, [\n+          queryTextOrConfig,\n+          values,\n+          ...rest,\n+        ]);\n \n         const duration = process.hrtime(start);\n         const durationInMs = (duration[0] * 1000000000 + duration[1]) / 1000000;\n \n-        logger.debug({\n-          query: queryTextOrConfig,\n-          values,\n-          duration: durationInMs\n-        }, 'Executed database query');\n+        logger.debug(\n+          {\n+            query: queryTextOrConfig,\n+            values,\n+            duration: durationInMs,\n+          },\n+          'Executed database query',\n+        );\n \n         return result;\n       };\n---\nyarn.lock\n@@ -13287,9 +13287,9 @@ __metadata:\n   linkType: hard\n \n \"pg-connection-string@npm:^2.6.0, pg-connection-string@npm:^2.7.0\":\n-  version: 2.7.0\n-  resolution: \"pg-connection-string@npm:2.7.0\"\n-  checksum: 10c0/50a1496a1c858f9495d78a2c7a66d93ef3602e718aff2953bb5738f3ea616d7f727f32fc20513c9bed127650cd14c1ddc7b458396f4000e689d4b64c65c5c51e\n+  version: 2.8.0\n+  resolution: \"pg-connection-string@npm:2.8.0\"\n+  checksum: 10c0/5600e3992ddacaa1022e4260a7bb8f24cc187cec1fc5d1526a274a4edc8db8b446f2a9c7f552c6f71f2dc7b3b391ceedebfef93de26b4943b6a26dfaecdd5bbc\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThe change in #34455 does not currently trigger the existing warning, so this PR aims to add an appropriate one.\r\n\r\nHowever, this is a draft because it seems running `tootctl search deploy` will only *add* to definitions, if we stop using an analyser, it seems its configuration will remain in Elasticsearch? This is a bit confusing\n\n---\n\nChoice A:\napp/helpers/formatting_helper.rb\n@@ -27,14 +27,7 @@ def extract_status_plain_text(status)\n   module_function :extract_status_plain_text\n \n   def status_content_format(status)\n-    MastodonOTELTracer.in_span('HtmlAwareFormatter rendering') do |span|\n-      span.add_attributes(\n-        'app.formatter.content.type' => 'status',\n-        'app.formatter.content.origin' => status.local? ? 'local' : 'remote'\n-      )\n-\n-      html_aware_format(status.text, status.local?, preloaded_accounts: [status.account] + (status.respond_to?(:active_mentions) ? status.active_mentions.map(&:account) : []))\n-    end\n+    html_aware_format(status.text, status.local?, preloaded_accounts: [status.account] + (status.respond_to?(:active_mentions) ? status.active_mentions.map(&:account) : []))\n   end\n \n   def rss_status_content_format(status)\n@@ -46,14 +39,7 @@ def rss_status_content_format(status)\n   end\n \n   def account_bio_format(account)\n-    MastodonOTELTracer.in_span('HtmlAwareFormatter rendering') do |span|\n-      span.add_attributes(\n-        'app.formatter.content.type' => 'account_bio',\n-        'app.formatter.content.origin' => account.local? ? 'local' : 'remote'\n-      )\n-\n-      html_aware_format(account.note, account.local?)\n-    end\n+    html_aware_format(account.note, account.local?)\n   end\n \n   def account_field_value_format(field, with_rel_me: true)\n---\napp/lib/text_formatter.rb\n@@ -33,24 +33,17 @@ def entities\n   def to_s\n     return ''.html_safe if text.blank?\n \n-    html = nil\n-    MastodonOTELTracer.in_span('TextFormatter#to_s extract_and_rewrite') do\n-      html = rewrite do |entity|\n-        if entity[:url]\n-          link_to_url(entity)\n-        elsif entity[:hashtag]\n-          link_to_hashtag(entity)\n-        elsif entity[:screen_name]\n-          link_to_mention(entity)\n-        end\n+    html = rewrite do |entity|\n+      if entity[:url]\n+        link_to_url(entity)\n+      elsif entity[:hashtag]\n+        link_to_hashtag(entity)\n+      elsif entity[:screen_name]\n+        link_to_mention(entity)\n       end\n     end\n \n-    if multiline?\n-      MastodonOTELTracer.in_span('TextFormatter#to_s simple_format') do\n-        html = simple_format(html, {}, sanitize: false).delete(\"\\n\")\n-      end\n-    end\n+    html = simple_format(html, {}, sanitize: false).delete(\"\\n\") if multiline?\n \n     html.html_safe # rubocop:disable Rails/OutputSafety\n   end\n@@ -106,54 +99,48 @@ def rewrite\n   end\n \n   def link_to_url(entity)\n-    MastodonOTELTracer.in_span('TextFormatter#link_to_url') do\n-      TextFormatter.shortened_link(entity[:url], rel_me: with_rel_me?)\n-    end\n+    TextFormatter.shortened_link(entity[:url], rel_me: with_rel_me?)\n   end\n \n   def link_to_hashtag(entity)\n-    MastodonOTELTracer.in_span('TextFormatter#link_to_hashtag') do\n-      hashtag = entity[:hashtag]\n-      url     = tag_url(hashtag)\n+    hashtag = entity[:hashtag]\n+    url     = tag_url(hashtag)\n \n-      <<~HTML.squish\n-        <a href=\"#{h(url)}\" class=\"mention hashtag\" rel=\"tag\">#<span>#{h(hashtag)}</span></a>\n-      HTML\n-    end\n+    <<~HTML.squish\n+      <a href=\"#{h(url)}\" class=\"mention hashtag\" rel=\"tag\">#<span>#{h(hashtag)}</span></a>\n+    HTML\n   end\n \n   def link_to_mention(entity)\n-    MastodonOTELTracer.in_span('TextFormatter#link_to_mention') do\n-      username, domain = entity[:screen_name].split('@')\n-      domain           = nil if local_domain?(domain)\n-      account          = nil\n-\n-      if preloaded_accounts?\n-        same_username_hits = 0\n-\n-        preloaded_accounts.each do |other_account|\n-          same_username = other_account.username.casecmp(username).zero?\n-          same_domain   = other_account.domain.nil? ? domain.nil? : other_account.domain.casecmp(domain)&.zero?\n-\n-          if same_username && !same_domain\n-            same_username_hits += 1\n-          elsif same_username && same_domain\n-            account = other_account\n-          end\n+    username, domain = entity[:screen_name].split('@')\n+    domain           = nil if local_domain?(domain)\n+    account          = nil\n+\n+    if preloaded_accounts?\n+      same_username_hits = 0\n+\n+      preloaded_accounts.each do |other_account|\n+        same_username = other_account.username.casecmp(username).zero?\n+        same_domain   = other_account.domain.nil? ? domain.nil? : other_account.domain.casecmp(domain)&.zero?\n+\n+        if same_username && !same_domain\n+          same_username_hits += 1\n+        elsif same_username && same_domain\n+          account = other_account\n         end\n-      else\n-        account = entity_cache.mention(username, domain)\n       end\n+    else\n+      account = entity_cache.mention(username, domain)\n+    end\n \n-      return \"@#{h(entity[:screen_name])}\" if account.nil?\n+    return \"@#{h(entity[:screen_name])}\" if account.nil?\n \n-      url = ActivityPub::TagManager.instance.url_for(account)\n-      display_username = same_username_hits&.positive? || with_domains? ? account.pretty_acct : account.username\n+    url = ActivityPub::TagManager.instance.url_for(account)\n+    display_username = same_username_hits&.positive? || with_domains? ? account.pretty_acct : account.username\n \n-      <<~HTML.squish\n-        <span class=\"h-card\" translate=\"no\"><a href=\"#{h(url)}\" class=\"u-url mention\">@<span>#{h(display_username)}</span></a></span>\n-      HTML\n-    end\n+    <<~HTML.squish\n+      <span class=\"h-card\" translate=\"no\"><a href=\"#{h(url)}\" class=\"u-url mention\">@<span>#{h(display_username)}</span></a></span>\n+    HTML\n   end\n \n   def entity_cache\n---\n\n\n---\n\nChoice B:\napp/lib/admin/system_check/elasticsearch_check.rb\n@@ -38,6 +38,11 @@ def message\n         :elasticsearch_index_mismatch,\n         mismatched_indexes.join(' ')\n       )\n+    elsif !specifications_match?\n+      Admin::SystemCheck::Message.new(\n+        :elasticsearch_analysis_mismatch,\n+        mismatched_specifications_indexes.join(' ')\n+      )\n     elsif cluster_health['status'] == 'red'\n       Admin::SystemCheck::Message.new(:elasticsearch_health_red)\n     elsif cluster_health['number_of_nodes'] < 2 && es_preset != 'single_node_cluster'\n@@ -111,10 +116,20 @@ def mismatched_indexes\n     end\n   end\n \n+  def mismatched_specifications_indexes\n+    @mismatched_specifications_indexes ||= INDEXES.filter_map do |klass|\n+      klass.base_name if klass.specification.changed?\n+    end\n+  end\n+\n   def indexes_match?\n     mismatched_indexes.empty?\n   end\n \n+  def specifications_match?\n+    mismatched_specifications_indexes.empty?\n+  end\n+\n   def es_preset\n     ENV.fetch('ES_PRESET', 'single_node_cluster')\n   end\n---\nconfig/locales/en.yml\n@@ -903,6 +903,8 @@ en:\n     system_checks:\n       database_schema_check:\n         message_html: There are pending database migrations. Please run them to ensure the application behaves as expected\n+      elasticsearch_analysis_index_mismatch:\n+        message_html: Elasticsearch index analyzer settings are outdated. Please run <code>tootctl search deploy --only-mapping --only=%{value}</code>\n       elasticsearch_health_red:\n         message_html: Elasticsearch cluster is unhealthy (red status), search features are unavailable\n       elasticsearch_health_yellow:\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -13307,12 +13307,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"pg-pool@npm:^3.9.5\":\n-  version: 3.9.5\n-  resolution: \"pg-pool@npm:3.9.5\"\n+\"pg-pool@npm:^3.9.6\":\n+  version: 3.9.6\n+  resolution: \"pg-pool@npm:3.9.6\"\n   peerDependencies:\n     pg: \">=8.0\"\n-  checksum: 10c0/ebb36b6a1fd753213263a2e0e73d06ffe9fc93907deceae484c7fe4b464f6e9c41a578eb096b4b6012beec94a5d6e0e47728dfc4425e06d283744aa7432365a4\n+  checksum: 10c0/458d50a4e7260977f076472d40d0796fa8b513af7e3ce1bf65557e10724e9c13653661c883f6650dff92d0a1a5ff4e7a001a8262b786c1ad4cfbd35c3354353e\n   languageName: node\n   linkType: hard\n \n@@ -13352,12 +13352,12 @@ __metadata:\n   linkType: hard\n \n \"pg@npm:^8.5.0\":\n-  version: 8.15.5\n-  resolution: \"pg@npm:8.15.5\"\n+  version: 8.15.6\n+  resolution: \"pg@npm:8.15.6\"\n   dependencies:\n     pg-cloudflare: \"npm:^1.2.5\"\n     pg-connection-string: \"npm:^2.8.5\"\n-    pg-pool: \"npm:^3.9.5\"\n+    pg-pool: \"npm:^3.9.6\"\n     pg-protocol: \"npm:^1.9.5\"\n     pg-types: \"npm:^2.1.0\"\n     pgpass: \"npm:1.x\"\n@@ -13369,7 +13369,7 @@ __metadata:\n   peerDependenciesMeta:\n     pg-native:\n       optional: true\n-  checksum: 10c0/4c118cd9bec37c8880b4489b9acbd10cf1eaa86a0a9024de2dac83f4ce5adedecc4cab54b66fa3bcb204aab7297c08d03617ae15499538939692b48651cc52d1\n+  checksum: 10c0/d4dc81020ebd137b6cf6228e43c643067acb8240079a07f7b9a7e97be0f33ad4d8c6f2a3f5b512ad87180e3d48e651fbd72885aa807ab58a715da8f3efea0fab\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -469,7 +469,7 @@ GEM\n     omniauth-rails_csrf_protection (1.0.2)\n       actionpack (>= 4.2)\n       omniauth (~> 2.0)\n-    omniauth-saml (2.2.3)\n+    omniauth-saml (2.2.4)\n       omniauth (~> 2.1)\n       ruby-saml (~> 1.18)\n     omniauth_openid_connect (0.8.0)\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nAs shown in the image, when the account name in the notification area is long, the icon gets squished.  \r\nThis PR correctly sets up a liquid layout to resolve this issue.\r\n\r\nbefore:\r\n![Screenshot_20250422_201612](https://github.com/user-attachments/assets/97280e14-6628-4b2f-a85b-286549ff7031)\r\n\r\nafter:\r\n![Screenshot_20250422_201549](https://github.com/user-attachments/assets/5de969fd-47da-47f3-b430-ea242cf68951)\r\n\n\n---\n\nChoice A:\n.rubocop/naming.yml\n@@ -1,3 +1,6 @@\n ---\n Naming/BlockForwarding:\n   EnforcedStyle: explicit\n+\n+Naming/PredicateMethod:\n+  Enabled: false\n---\n.rubocop_todo.yml\n@@ -1,6 +1,6 @@\n # This configuration was generated by\n # `rubocop --auto-gen-config --auto-gen-only-exclude --no-offense-counts --no-auto-gen-timestamp`\n-# using RuboCop version 1.75.8.\n+# using RuboCop version 1.76.0.\n # The point is for the user to remove these configuration records\n # one by one as the offenses are removed from the code base.\n # Note that changes in the inspected code, or installation of new\n---\nGemfile.lock\n@@ -751,18 +751,18 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.8)\n+    rubocop (1.76.0)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n       parallel (~> 1.10)\n       parser (>= 3.3.0.2)\n       rainbow (>= 2.2.2, < 4.0)\n       regexp_parser (>= 2.9.3, < 3.0)\n-      rubocop-ast (>= 1.44.0, < 2.0)\n+      rubocop-ast (>= 1.45.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.1)\n+    rubocop-ast (1.45.0)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n---\napp/controllers/auth/registrations_controller.rb\n@@ -138,7 +138,7 @@ def require_rules_acceptance!\n     set_locale { render :rules }\n   end\n \n-  def is_flashing_format? # rubocop:disable Naming/PredicateName\n+  def is_flashing_format? # rubocop:disable Naming/PredicatePrefix\n     if params[:action] == 'create'\n       false # Disable flash messages for sign-up\n     else\n---\napp/models/concerns/attachmentable.rb\n@@ -22,7 +22,7 @@ module Attachmentable\n   ).freeze\n \n   included do\n-    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicateName\n+    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicatePrefix\n       super\n \n       send(:\"before_#{name}_validate\", prepend: true) do\n---\napp/models/user_settings/glue.rb\n@@ -17,7 +17,7 @@ def type_for_attribute(key)\n     self.class.definition_for(key)&.type\n   end\n \n-  def has_attribute?(key) # rubocop:disable Naming/PredicateName\n+  def has_attribute?(key) # rubocop:disable Naming/PredicatePrefix\n     self.class.definition_for?(key)\n   end\n end\n---\nconfig/initializers/1_hosts.rb\n@@ -21,7 +21,7 @@\n \n   config.x.streaming_api_base_url = ENV.fetch('STREAMING_API_BASE_URL') do\n     if Rails.env.production?\n-      \"ws#{https ? 's' : ''}://#{web_host}\"\n+      \"ws#{'s' if https}://#{web_host}\"\n     else\n       \"ws://#{host.split(':').first}:4000\"\n     end\n---\nconfig/initializers/content_security_policy.rb\n@@ -32,7 +32,7 @@\n \n   if Rails.env.development?\n     vite_public_host = ENV.fetch('VITE_DEV_SERVER_PUBLIC', \"localhost:#{ViteRuby.config.port}\")\n-    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{ViteRuby.config.https ? 's' : ''}://#{vite_public_host}\" }\n+    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{'s' if ViteRuby.config.https}://#{vite_public_host}\" }\n \n     p.connect_src :self, :data, :blob, *media_hosts, Rails.configuration.x.streaming_api_base_url, *front_end_build_urls\n     p.script_src  :self, :unsafe_inline, :unsafe_eval, assets_host\n---\nlib/mastodon/migration_warning.rb\n@@ -23,7 +23,7 @@ def migration_duration_warning(explanation = nil)\n \n     def announce_countdown\n       WARNING_SECONDS.downto(1) do |i|\n-        say \"Continuing in #{i} second#{i == 1 ? '' : 's'}...\", true\n+        say \"Continuing in #{i} second#{'s' unless i == 1}...\", true\n         sleep 1\n       end\n     end\n---\nlib/mastodon/version.rb\n@@ -75,7 +75,7 @@ def source_commit\n     end\n \n     def user_agent\n-      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{Rails.configuration.x.use_https ? 's' : ''}://#{Rails.configuration.x.web_domain}/)\"\n+      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{'s' if Rails.configuration.x.use_https}://#{Rails.configuration.x.web_domain}/)\"\n     end\n \n     def version_configuration\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -807,7 +807,7 @@ GEM\n       rubyzip (>= 1.2.2, < 3.0)\n       websocket (~> 1.0)\n     semantic_range (3.1.0)\n-    shoulda-matchers (6.4.0)\n+    shoulda-matchers (6.5.0)\n       activesupport (>= 5.2.0)\n     sidekiq (6.5.12)\n       connection_pool (>= 2.2.5, < 3)\n---\n\n\n---\n\nChoice C:\napp/javascript/styles/mastodon/components.scss\n@@ -10399,6 +10399,10 @@ noscript {\n       bdi {\n         color: $darker-text-color;\n       }\n+\n+      .account__avatar {\n+        flex: 0 0 auto;\n+      }\n     }\n \n     &__content {\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -52,6 +52,7 @@ gem 'faraday-httpclient'\n gem 'fast_blank', '~> 1.0'\n gem 'fastimage'\n gem 'hiredis', '~> 0.6'\n+gem 'hiredis-client'\n gem 'htmlentities', '~> 4.3'\n gem 'http', '~> 5.2.0'\n gem 'http_accept_language', '~> 2.1'\n@@ -82,10 +83,10 @@ gem 'rqrcode', '~> 3.0'\n gem 'ruby-progressbar', '~> 1.13'\n gem 'sanitize', '~> 7.0'\n gem 'scenic', '~> 1.7'\n-gem 'sidekiq', '~> 6.5'\n+gem 'sidekiq', '< 8'\n gem 'sidekiq-bulk', '~> 0.2.0'\n gem 'sidekiq-scheduler', '~> 5.0'\n-gem 'sidekiq-unique-jobs', '~> 7.1'\n+gem 'sidekiq-unique-jobs', '> 8'\n gem 'simple_form', '~> 5.2'\n gem 'simple-navigation', '~> 4.4'\n gem 'stoplight', '~> 4.1'\n---\nGemfile.lock\n@@ -129,9 +129,6 @@ GEM\n     brakeman (7.0.2)\n       racc\n     browser (6.2.0)\n-    brpoplpush-redis_script (0.1.3)\n-      concurrent-ruby (~> 1.0, >= 1.0.5)\n-      redis (>= 1.0, < 6)\n     builder (3.3.0)\n     bundler-audit (0.9.2)\n       bundler (>= 1.2.0, < 3)\n@@ -294,6 +291,8 @@ GEM\n     highline (3.1.2)\n       reline\n     hiredis (0.6.3)\n+    hiredis-client (0.24.0)\n+      redis-client (= 0.24.0)\n     hkdf (0.3.0)\n     htmlentities (4.3.4)\n     http (5.2.0)\n@@ -696,6 +695,8 @@ GEM\n       psych (>= 4.0.0)\n     redcarpet (3.6.1)\n     redis (4.8.1)\n+    redis-client (0.24.0)\n+      connection_pool\n     redlock (1.3.2)\n       redis (>= 3.0.0, < 6.0)\n     regexp_parser (2.10.0)\n@@ -808,22 +809,22 @@ GEM\n       websocket (~> 1.0)\n     shoulda-matchers (6.5.0)\n       activesupport (>= 5.2.0)\n-    sidekiq (6.5.12)\n-      connection_pool (>= 2.2.5, < 3)\n-      rack (~> 2.0)\n-      redis (>= 4.5.0, < 5)\n+    sidekiq (7.3.9)\n+      base64\n+      connection_pool (>= 2.3.0)\n+      logger\n+      rack (>= 2.2.4)\n+      redis-client (>= 0.22.2)\n     sidekiq-bulk (0.2.0)\n       sidekiq\n     sidekiq-scheduler (5.0.6)\n       rufus-scheduler (~> 3.2)\n       sidekiq (>= 6, < 8)\n       tilt (>= 1.4.0, < 3)\n-    sidekiq-unique-jobs (7.1.33)\n-      brpoplpush-redis_script (> 0.1.1, <= 2.0.0)\n+    sidekiq-unique-jobs (8.0.10)\n       concurrent-ruby (~> 1.0, >= 1.0.5)\n-      redis (< 5.0)\n-      sidekiq (>= 5.0, < 7.0)\n-      thor (>= 0.20, < 3.0)\n+      sidekiq (>= 7.0.0, < 8.0.0)\n+      thor (>= 1.0, < 3.0)\n     simple-navigation (4.4.0)\n       activesupport (>= 2.3.2)\n     simple_form (5.3.1)\n@@ -976,6 +977,7 @@ DEPENDENCIES\n   haml_lint\n   hcaptcha (~> 7.1)\n   hiredis (~> 0.6)\n+  hiredis-client\n   htmlentities (~> 4.3)\n   http (~> 5.2.0)\n   http_accept_language (~> 2.1)\n@@ -1064,10 +1066,10 @@ DEPENDENCIES\n   scenic (~> 1.7)\n   selenium-webdriver\n   shoulda-matchers\n-  sidekiq (~> 6.5)\n+  sidekiq (< 8)\n   sidekiq-bulk (~> 0.2.0)\n   sidekiq-scheduler (~> 5.0)\n-  sidekiq-unique-jobs (~> 7.1)\n+  sidekiq-unique-jobs (> 8)\n   simple-navigation (~> 4.4)\n   simple_form (~> 5.2)\n   simplecov (~> 0.22)\n---\napp/lib/redis_connection.rb\n@@ -15,7 +15,7 @@ def pool\n \n     def pool_size\n       if Sidekiq.server?\n-        Sidekiq[:concurrency]\n+        Sidekiq.default_configuration[:concurrency]\n       else\n         ENV['MAX_THREADS'] || 5\n       end\n---\napp/workers/scheduler/self_destruct_scheduler.rb\n@@ -20,7 +20,7 @@ def perform\n   private\n \n   def sidekiq_overwhelmed?\n-    redis_mem_info = Sidekiq.redis_info\n+    redis_mem_info = Sidekiq.default_configuration.redis_info\n \n     Sidekiq::Stats.new.enqueued > MAX_ENQUEUED || redis_mem_info['used_memory'].to_f > redis_mem_info['total_system_memory'].to_f * MAX_REDIS_MEM_USAGE\n   end\n---\nconfig/database.yml\n@@ -1,6 +1,6 @@\n default: &default\n   adapter: postgresql\n-  pool: <%= ENV[\"DB_POOL\"] || (if Sidekiq.server? then Sidekiq[:concurrency] else ENV['MAX_THREADS'] end) || 5 %>\n+  pool: <%= ENV[\"DB_POOL\"] || (if Sidekiq.server? then Sidekiq.default_configuration[:concurrency] else ENV['MAX_THREADS'] end) || 5 %>\n   timeout: 5000\n   connect_timeout: 15\n   encoding: unicode\n---\nconfig/initializers/sidekiq.rb\n@@ -89,6 +89,8 @@\n     end\n   end\n \n+  config.logger.level = Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+\n   SidekiqUniqueJobs::Server.configure(config)\n end\n \n@@ -98,9 +100,9 @@\n   config.client_middleware do |chain|\n     chain.add SidekiqUniqueJobs::Middleware::Client\n   end\n-end\n \n-Sidekiq.logger.level = ::Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+  config.logger.level = Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+end\n \n SidekiqUniqueJobs.configure do |config|\n   config.enabled         = !Rails.env.test?\n---\nlib/mastodon/redis_configuration.rb\n@@ -9,7 +9,6 @@ class Mastodon::RedisConfiguration\n \n   def base\n     @base ||= setup_config(prefix: nil, defaults: DEFAULTS)\n-              .merge(namespace: nil)\n   end\n \n   def sidekiq\n@@ -23,7 +22,7 @@ def cache\n                  expires_in: 10.minutes,\n                  connect_timeout: 5,\n                  pool: {\n-                   size: Sidekiq.server? ? Sidekiq[:concurrency] : Integer(ENV['MAX_THREADS'] || 5),\n+                   size: Sidekiq.server? ? Sidekiq.default_configuration[:concurrency] : Integer(ENV['MAX_THREADS'] || 5),\n                    timeout: 5,\n                  },\n                })\n---\nspec/lib/mastodon/redis_configuration_spec.rb\n@@ -156,7 +156,6 @@\n         expect(subject).to eq({\n           url: 'redis://localhost:6379/0',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n@@ -172,7 +171,6 @@\n         expect(subject).to eq({\n           url: 'redis::/user@example.com/2',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n@@ -188,7 +186,6 @@\n         expect(subject).to eq({\n           url: 'redis://:testpass@redis.example.com:3333/3',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n---\nspec/rails_helper.rb\n@@ -53,7 +53,7 @@\n   allow_localhost: true,\n   allow: Chewy.settings[:host]\n )\n-Sidekiq.logger = nil\n+Sidekiq.default_configuration.logger = nil\n \n DatabaseCleaner.strategy = [:deletion]\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rubocop](https://rubocop.org/) ([source](https://redirect.github.com/rubocop/rubocop), [changelog](https://redirect.github.com/rubocop/rubocop/releases/tag/v1.75.3)) | `1.75.2` -> `1.75.3` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rubocop/1.75.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rubocop/1.75.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rubocop/1.75.2/1.75.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rubocop/1.75.2/1.75.3?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n| [rubocop-rspec](https://redirect.github.com/rubocop/rubocop-rspec) ([changelog](https://redirect.github.com/rubocop/rubocop-rspec/blob/master/CHANGELOG.md)) | `3.5.0` -> `3.6.0` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rubocop-rspec/3.6.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rubocop-rspec/3.6.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rubocop-rspec/3.5.0/3.6.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rubocop-rspec/3.5.0/3.6.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>rubocop/rubocop (rubocop)</summary>\n\n### [`v1.75.3`](https://redirect.github.com/rubocop/rubocop/blob/HEAD/CHANGELOG.md#1753-2025-04-22)\n\n[Compare Source](https://redirect.github.com/rubocop/rubocop/compare/v1.75.2...v1.75.3)\n\n##### Bug fixes\n\n-   [#&#8203;13676](https://redirect.github.com/rubocop/rubocop/issues/13676): Allow RuboCop to inspect hidden directories if they are explicitly provided. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14080](https://redirect.github.com/rubocop/rubocop/pull/14080): Allow writing RBS::Inline annotation `#:` after end keyword in `Style/CommentedKeyword`. (\\[[@&#8203;dak2](https://redirect.github.com/dak2)]\\[])\n-   [#&#8203;14075](https://redirect.github.com/rubocop/rubocop/issues/14075): Fix an error for `Layout/EmptyLineAfterGuardClause` when calling a method on the result of a single-line `if` with `return`. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14067](https://redirect.github.com/rubocop/rubocop/pull/14067): Fix false negatives for `Style/RedundantParentheses` when using parens around singleton method body. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14070](https://redirect.github.com/rubocop/rubocop/issues/14070): Fix false positives for `EnforcedStyleForMultiline: diff_comma` of `Style/TrailingCommaInArrayLiteral` and `Style/TrailingCommaInHashLiteral` when trailing comma with comment. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14092](https://redirect.github.com/rubocop/rubocop/pull/14092): Fix false negative for `Style/RedundantParentheses` when using some operator methods with a parenthesized argument. (\\[[@&#8203;koic](https://redirect.github.com/koic)]\\[])\n-   [#&#8203;14103](https://redirect.github.com/rubocop/rubocop/pull/14103): Fix `Layout/MultilineOperationIndentation` cop error on `indexasgn` node without arguments. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14089](https://redirect.github.com/rubocop/rubocop/pull/14089): Fix redundant current directory prefix regexp. (\\[[@&#8203;sferik](https://redirect.github.com/sferik)]\\[])\n-   [#&#8203;14099](https://redirect.github.com/rubocop/rubocop/pull/14099): Fix `Style/ClassAndModuleChildren` cop error on one-liner class definition and nested enforced style. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14083](https://redirect.github.com/rubocop/rubocop/pull/14083): Fix `Style/ConditionalAssignment` cop error on one-line if-then-else. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14104](https://redirect.github.com/rubocop/rubocop/pull/14104): Fix `Style/ConditionalAssignment` cop error on indexed assignment without arguments. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14084](https://redirect.github.com/rubocop/rubocop/pull/14084): Fix `Style/RedundantLineContinuation` cop error on multiline assignment with line continuation. (\\[[@&#8203;viralpraxis](https://redirect.github.com/viralpraxis)]\\[])\n-   [#&#8203;14096](https://redirect.github.com/rubocop/rubocop/pull/14096): Fix error for `Style/SafeNavigation` with longer `&&` chain (e.g. `a && a.b && a.b.c`). (\\[[@&#8203;lovro-bikic](https://redirect.github.com/lovro-bikic)]\\[])\n-   [#&#8203;14068](https://redirect.github.com/rubocop/rubocop/pull/14068): Fix wrong autocorrection for `Style/MapIntoArray` when using `push` or `append` with hash argument without braces. (\\[[@&#8203;lovro-bikic](https://redirect.github.com/lovro-bikic)]\\[])\n\n##### Changes\n\n-   [#&#8203;14093](https://redirect.github.com/rubocop/rubocop/pull/14093): Register offenses for redundant parens around method arguments for `Style/RedundantParentheses`. (\\[[@&#8203;lovro-bikic](https://redirect.github.com/lovro-bikic)]\\[])\n-   [#&#8203;14064](https://redirect.github.com/rubocop/rubocop/pull/14064): Prefer `References` over `Reference` in cop configs. (\\[[@&#8203;sambostock](https://redirect.github.com/sambostock)]\\[])\n\n</details>\n\n<details>\n<summary>rubocop/rubocop-rspec (rubocop-rspec)</summary>\n\n### [`v3.6.0`](https://redirect.github.com/rubocop/rubocop-rspec/blob/HEAD/CHANGELOG.md#360-2025-04-18)\n\n[Compare Source](https://redirect.github.com/rubocop/rubocop-rspec/compare/v3.5.0...v3.6.0)\n\n-   Fix false positive in `RSpec/Pending`, where it would mark the default block `it` as an offense. (\\[[@&#8203;bquorning](https://redirect.github.com/bquorning)])\n-   Fix issue when `Style/ContextWording` is configured with a Prefix being interpreted as a boolean, like `on`. (\\[[@&#8203;sakuro](https://redirect.github.com/sakuro)])\n-   Add new `RSpec/IncludeExamples` cop to enforce using `it_behaves_like` over `include_examples`. (\\[[@&#8203;dvandersluis](https://redirect.github.com/dvandersluis)])\n-   Change `RSpec/ScatteredSetup` to allow `around` hooks to be scattered. (\\[[@&#8203;ydah](https://redirect.github.com/ydah)])\n-   Fix an error `RSpec/ChangeByZero` cop when without expect block. (\\[[@&#8203;lee266](https://redirect.github.com/lee266)])\n-   Fix a false positive for `RSpec/DescribedClass` when `SkipBlocks` is true and numblocks are used. (\\[[@&#8203;earlopain](https://redirect.github.com/earlopain)])\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about these updates again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNDguNCIsInVwZGF0ZWRJblZlciI6IjM5LjI0OC40IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\napp/controllers/concerns/web_app_controller_concern.rb\n@@ -8,6 +8,7 @@ module WebAppControllerConcern\n \n     before_action :redirect_unauthenticated_to_permalinks!\n     before_action :set_referer_header\n+    before_action :redirect_to_tos_interstitial!\n \n     content_security_policy do |p|\n       policy = ContentSecurityPolicy.new\n@@ -45,6 +46,13 @@ def redirect_unauthenticated_to_permalinks!\n \n   protected\n \n+  def redirect_to_tos_interstitial!\n+    return unless current_user&.require_tos_interstitial?\n+\n+    @terms_of_service = TermsOfService.published.first\n+    render 'terms_of_service_interstitial/show', layout: 'auth'\n+  end\n+\n   def set_referer_header\n     response.set_header('Referrer-Policy', Setting.allow_referrer_origin ? 'strict-origin-when-cross-origin' : 'same-origin')\n   end\n---\napp/controllers/terms_of_service_controller.rb\n@@ -4,8 +4,19 @@ class TermsOfServiceController < ApplicationController\n   include WebAppControllerConcern\n \n   skip_before_action :require_functional!\n+  skip_before_action :redirect_to_tos_interstitial!\n+\n+  before_action :clear_redirect_interstitial!\n \n   def show\n     expires_in(15.seconds, public: true, stale_while_revalidate: 30.seconds, stale_if_error: 1.day) unless user_signed_in?\n   end\n+\n+  private\n+\n+  def clear_redirect_interstitial!\n+    return unless user_signed_in?\n+\n+    current_user.update(require_tos_interstitial: false)\n+  end\n end\n---\napp/models/terms_of_service.rb\n@@ -23,6 +23,8 @@ class TermsOfService < ApplicationRecord\n \n   validate :effective_date_cannot_be_in_the_past\n \n+  NOTIFICATION_ACTIVITY_CUTOFF = 1.year.freeze\n+\n   def published?\n     published_at.present?\n   end\n@@ -39,8 +41,20 @@ def notification_sent?\n     notification_sent_at.present?\n   end\n \n+  def base_user_scope\n+    User.confirmed.where(created_at: ..published_at).joins(:account)\n+  end\n+\n+  def email_notification_cutoff\n+    published_at - NOTIFICATION_ACTIVITY_CUTOFF\n+  end\n+\n+  def scope_for_interstitial\n+    base_user_scope.merge(Account.suspended).or(base_user_scope.where(current_sign_in_at: [nil, ...email_notification_cutoff]))\n+  end\n+\n   def scope_for_notification\n-    User.confirmed.joins(:account).merge(Account.without_suspended).where(created_at: (..published_at))\n+    base_user_scope.merge(Account.without_suspended).where(current_sign_in_at: email_notification_cutoff...)\n   end\n \n   private\n---\napp/models/user.rb\n@@ -25,6 +25,7 @@\n #  otp_backup_codes          :string           is an Array\n #  otp_required_for_login    :boolean          default(FALSE), not null\n #  otp_secret                :string\n+#  require_tos_interstitial  :boolean          default(FALSE), not null\n #  reset_password_sent_at    :datetime\n #  reset_password_token      :string\n #  settings                  :text\n---\napp/views/terms_of_service_interstitial/show.html.haml\n@@ -0,0 +1,15 @@\n+- content_for :header_tags do\n+  %meta{ name: 'robots', content: 'noindex, noarchive' }/\n+\n+- content_for :body_classes, 'app-body'\n+\n+.simple_form\n+  %h1.title= t('terms_of_service_interstitial.title', domain: site_hostname)\n+\n+  - effective_date = @terms_of_service.effective_date || Time.zone.today\n+  %p.lead= effective_date.past? ? t('terms_of_service_interstitial.past_preamble_html') : t('terms_of_service_interstitial.future_preamble_html', date: l(effective_date))\n+\n+  %p.lead= t('user_mailer.terms_of_service_changed.agreement', domain: site_hostname)\n+\n+  .stacked-actions\n+    = link_to t('terms_of_service_interstitial.review_link'), terms_of_service_path, class: 'button'\n---\napp/workers/admin/distribute_terms_of_service_notification_worker.rb\n@@ -6,6 +6,8 @@ class Admin::DistributeTermsOfServiceNotificationWorker\n   def perform(terms_of_service_id)\n     terms_of_service = TermsOfService.find(terms_of_service_id)\n \n+    terms_of_service.scope_for_interstitial.in_batches.update_all(require_tos_interstitial: true)\n+\n     terms_of_service.scope_for_notification.find_each do |user|\n       UserMailer.terms_of_service_changed(user, terms_of_service).deliver_later!\n     end\n---\nconfig/locales/en.yml\n@@ -1916,6 +1916,11 @@ en:\n     does_not_match_previous_name: does not match the previous name\n   terms_of_service:\n     title: Terms of Service\n+  terms_of_service_interstitial:\n+    future_preamble_html: We're making some changes to our terms of service, which will be effective on <strong>%{date}</strong>. We encourage you to review the updated terms.\n+    past_preamble_html: We have changed our terms of service since your last visit. We encourage you to review the updated terms.\n+    review_link: Review terms of service\n+    title: The terms of service of %{domain} are changing\n   themes:\n     contrast: Mastodon (High contrast)\n     default: Mastodon (Dark)\n---\ndb/migrate/20250428104538_add_require_tos_interstitial_to_users.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddRequireTosInterstitialToUsers < ActiveRecord::Migration[8.0]\n+  def change\n+    add_column :users, :require_tos_interstitial, :boolean, null: false, default: false\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_28_095029) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_28_104538) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -1222,6 +1222,7 @@\n     t.string \"time_zone\"\n     t.string \"otp_secret\"\n     t.datetime \"age_verified_at\"\n+    t.boolean \"require_tos_interstitial\", default: false, null: false\n     t.index [\"account_id\"], name: \"index_users_on_account_id\"\n     t.index [\"confirmation_token\"], name: \"index_users_on_confirmation_token\", unique: true\n     t.index [\"created_by_application_id\"], name: \"index_users_on_created_by_application_id\", where: \"(created_by_application_id IS NOT NULL)\"\n---\nspec/workers/admin/distribute_terms_of_service_notification_worker_spec.rb\n@@ -14,9 +14,10 @@\n \n     context 'with valid terms' do\n       let(:terms) { Fabricate(:terms_of_service) }\n-      let!(:user) { Fabricate :user, confirmed_at: 3.days.ago }\n+      let!(:user) { Fabricate(:user, confirmed_at: 3.days.ago) }\n+      let!(:old_user) { Fabricate(:user, confirmed_at: 2.years.ago, current_sign_in_at: 2.years.ago) }\n \n-      it 'sends the terms update via email', :inline_jobs do\n+      it 'sends the terms update via email and change the old user to require an interstitial', :inline_jobs do\n         emails = capture_emails { worker.perform(terms.id) }\n \n         expect(emails.size)\n@@ -26,6 +27,9 @@\n             to: [user.email],\n             subject: I18n.t('user_mailer.terms_of_service_changed.subject')\n           )\n+\n+        expect(user.reload.require_tos_interstitial?).to be false\n+        expect(old_user.reload.require_tos_interstitial?).to be true\n       end\n     end\n   end\n---\n\n\n---\n\nChoice B:\napp/lib/status_filter.rb\n@@ -38,7 +38,7 @@ def muting_account?\n   end\n \n   def silenced_account?\n-    !account&.silenced? && status_account_silenced? && !account_following_status_account?\n+    status_account_silenced? && !account_following_status_account?\n   end\n \n   def status_account_silenced?\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.2)\n-    rubocop (1.75.2)\n+    rubocop (1.75.3)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n@@ -773,7 +773,7 @@ GEM\n       rack (>= 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n       rubocop-ast (>= 1.38.0, < 2.0)\n-    rubocop-rspec (3.5.0)\n+    rubocop-rspec (3.6.0)\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n     rubocop-rspec_rails (2.31.0)\n---\n\n\n---\n\nChoice D:\nlib/chewy/index_extensions.rb\n@@ -12,6 +12,13 @@ def index_preset(base_options = {})\n         base_options.merge(number_of_replicas: 1, number_of_shards: (base_options[:number_of_shards] || 1) * 2)\n       end\n     end\n+\n+    def update_specification\n+      client.indices.close index: index_name\n+      client.indices.put_settings index: index_name, body: { settings: { analysis: settings_hash[:settings][:analysis] } }\n+      client.indices.put_mapping index: index_name, body: root.mappings_hash\n+      client.indices.open index: index_name\n+    end\n   end\n end\n \n---\nlib/mastodon/cli/search.rb\n@@ -56,7 +56,7 @@ def deploy\n       if options[:only_mapping]\n         indices.select { |index| index.specification.changed? }.each do |index|\n           progress.title = \"Updating mapping for #{index} \"\n-          index.update_mapping\n+          index.update_specification\n           index.specification.lock!\n         end\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [sass](https://redirect.github.com/sass/dart-sass) | [`1.86.3` -> `1.87.0`](https://renovatebot.com/diffs/npm/sass/1.86.3/1.87.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/sass/1.87.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/sass/1.87.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/sass/1.86.3/1.87.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/sass/1.86.3/1.87.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>sass/dart-sass (sass)</summary>\n\n### [`v1.87.0`](https://redirect.github.com/sass/dart-sass/blob/HEAD/CHANGELOG.md#1870)\n\n[Compare Source](https://redirect.github.com/sass/dart-sass/compare/1.86.3...1.87.0)\n\n-   **Potentially breaking bug fix:** When a plain CSS file with a top-level\n    nesting selector `&` is loaded into a nested Sass context via\n    `meta.load-css()` or `@import`, Sass now emits plain CSS nesting rather than\n    incorrectly combining it with the parent selector using a descendant\n    combinator.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNDguNCIsInVwZGF0ZWRJblZlciI6IjM5LjI0OC40IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\napp/javascript/styles/mastodon/components.scss\n@@ -11053,6 +11053,8 @@ noscript {\n   &__slide {\n     flex: 0 0 auto;\n     flex-basis: 100%;\n+    width: 100%;\n+    overflow: hidden;\n   }\n \n   .status {\n---\n\n\n---\n\nChoice B:\napp/models/featured_tag.rb\n@@ -26,6 +26,8 @@ class FeaturedTag < ApplicationRecord\n \n   normalizes :name, with: ->(name) { name.strip.delete_prefix('#') }\n \n+  scope :by_name, ->(name) { joins(:tag).where(tag: { name: HashtagNormalizer.new.normalize(name) }) }\n+\n   before_validation :set_tag\n \n   before_create :reset_data\n---\nspec/lib/activitypub/activity/remove_spec.rb\n@@ -4,29 +4,60 @@\n \n RSpec.describe ActivityPub::Activity::Remove do\n   let(:sender) { Fabricate(:account, featured_collection_url: 'https://example.com/featured') }\n-  let(:status) { Fabricate(:status, account: sender) }\n-\n-  let(:json) do\n-    {\n-      '@context': 'https://www.w3.org/ns/activitystreams',\n-      id: 'foo',\n-      type: 'Add',\n-      actor: ActivityPub::TagManager.instance.uri_for(sender),\n-      object: ActivityPub::TagManager.instance.uri_for(status),\n-      target: sender.featured_collection_url,\n-    }.with_indifferent_access\n-  end\n \n   describe '#perform' do\n     subject { described_class.new(json, sender) }\n \n-    before do\n-      StatusPin.create!(account: sender, status: status)\n-      subject.perform\n+    context 'when removing a pinned status' do\n+      let(:status) { Fabricate(:status, account: sender) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: ActivityPub::TagManager.instance.uri_for(status),\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        StatusPin.create!(account: sender, status: status)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.pinned?(status) }.to(false)\n+      end\n     end\n \n-    it 'removes a pin' do\n-      expect(sender.pinned?(status)).to be false\n+    context 'when removing a featured tag' do\n+      let(:tag) { Fabricate(:tag) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: {\n+            type: 'Hashtag',\n+            name: \"##{tag.display_name}\",\n+            href: \"https://example.com/tags/#{tag.name}\",\n+          },\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        sender.featured_tags.find_or_create_by!(tag: tag)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.featured_tags.exists?(tag: tag) }.to(false)\n+      end\n     end\n   end\n end\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -15737,8 +15737,8 @@ __metadata:\n   linkType: hard\n \n \"sass@npm:^1.62.1\":\n-  version: 1.86.3\n-  resolution: \"sass@npm:1.86.3\"\n+  version: 1.87.0\n+  resolution: \"sass@npm:1.87.0\"\n   dependencies:\n     \"@parcel/watcher\": \"npm:^2.4.1\"\n     chokidar: \"npm:^4.0.0\"\n@@ -15749,7 +15749,7 @@ __metadata:\n       optional: true\n   bin:\n     sass: sass.js\n-  checksum: 10c0/ba819a0828f732adf7a94cd8ca017bce92bc299ffb878836ed1da80a30612bfbbf56a5e42d6dff3ad80d919c2025afb42948fc7b54a7bc61a9a2d58e1e0c558a\n+  checksum: 10c0/bd245faf14e4783dc547765350cf05817edaac0d6d6f6e4da8ab751f3eb3cc3873afd563c0ce416a24aa6c9c4e9023b05096447fc006660a01f76adffb54fbc6\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\n.github/renovate.json5\n@@ -28,6 +28,9 @@\n         // react-router: Requires manual upgrade\n         'history',\n         'react-router-dom',\n+\n+        // react-spring: Requires manual upgrade when upgrading react\n+        '@react-spring/web',\n       ],\n       matchUpdateTypes: ['major'],\n       dependencyDashboardApproval: true,\n---\napp/javascript/mastodon/features/video/components/hotkey_indicator.tsx\n@@ -24,9 +24,7 @@ export const HotkeyIndicator: React.FC<{\n     enter: [{ opacity: 1 }],\n     leave: [{ opacity: 0 }],\n     onRest: (_result, _ctrl, item) => {\n-      if (item) {\n-        onDismiss(item);\n-      }\n+      onDismiss(item);\n     },\n   });\n \n---\npackage.json\n@@ -44,7 +44,7 @@\n     \"@github/webauthn-json\": \"^2.1.1\",\n     \"@optimize-lodash/rollup-plugin\": \"^5.0.2\",\n     \"@rails/ujs\": \"7.1.501\",\n-    \"@react-spring/web\": \"^10.0.0\",\n+    \"@react-spring/web\": \"^9.7.5\",\n     \"@reduxjs/toolkit\": \"^2.0.1\",\n     \"@use-gesture/react\": \"^10.3.1\",\n     \"@vitejs/plugin-legacy\": \"^6.1.1\",\n---\nyarn.lock\n@@ -2460,7 +2460,7 @@ __metadata:\n     \"@github/webauthn-json\": \"npm:^2.1.1\"\n     \"@optimize-lodash/rollup-plugin\": \"npm:^5.0.2\"\n     \"@rails/ujs\": \"npm:7.1.501\"\n-    \"@react-spring/web\": \"npm:^10.0.0\"\n+    \"@react-spring/web\": \"npm:^9.7.5\"\n     \"@reduxjs/toolkit\": \"npm:^2.0.1\"\n     \"@testing-library/dom\": \"npm:^10.2.0\"\n     \"@testing-library/react\": \"npm:^16.0.0\"\n@@ -2887,69 +2887,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/animated@npm:10.0.1\"\n+\"@react-spring/animated@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/animated@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/shared\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/aaccd4a8b0280ac846d463b253ad8f092ee4afc9dbedc8e77616adf5399ffec755344f09fdd8487cadaf815840dff84d354d1143579c27c2fcd6937549b5fc40\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/f8c2473c60f39a878c7dd0fdfcfcdbc720521e1506aa3f63c9de64780694a0a73d5ccc535a5ccec3520ddb70a71cf43b038b32c18e99531522da5388c510ecd7\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/core@npm:10.0.1\"\n+\"@react-spring/core@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/core@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.1\"\n-    \"@react-spring/shared\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/animated\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/059b122dda4138e5e7e461abd49350921e326735ca9a1d8aa19b1fdbae0937661b5f71af6fe82fd8f59e8db5549627849b38cc3f7ef2ec7ee9c93c3d6225174f\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/5bfd83dfe248cd91889f215f015d908c7714ef445740fd5afa054b27ebc7d5a456abf6c309e2459d9b5b436e78d6fda16b62b9601f96352e9130552c02270830\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/rafz@npm:10.0.1\"\n-  checksum: 10c0/cba76f143d3a06f79dd0c09f7aefd17df9cca9b2c1ef7f9103255e5351326f4a42a5a1366f731a78f74380d96ba683bcc2a49312ed1e4b9e9e249e72c9ff68cb\n+\"@react-spring/rafz@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/rafz@npm:9.7.5\"\n+  checksum: 10c0/8bdad180feaa9a0e870a513043a5e98a4e9b7292a9f887575b7e6fadab2677825bc894b7ff16c38511b35bfe6cc1072df5851c5fee64448d67551559578ca759\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/shared@npm:10.0.1\"\n+\"@react-spring/shared@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/shared@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/rafz\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/f056aaa018b3744afd8244e8eea24534d32f92fad9ace815b80e159b296fb5db148e2c9bd840ad9a5188e7a3c0778fd564b8af9ae02cd500e019a228398fb3cf\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/0207eacccdedd918a2fc55e78356ce937f445ce27ad9abd5d3accba8f9701a39349b55115641dc2b39bb9d3a155b058c185b411d292dc8cc5686bfa56f73b94f\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~10.0.1\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/types@npm:10.0.1\"\n-  checksum: 10c0/260890f9c156dc69b77c846510017156d8c0a07cce70edc7c108e57b0cf4122b26a15e724b191481a51b2c914296de9e81d56618b2c339339d4b221930691baa\n+\"@react-spring/types@npm:~9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/types@npm:9.7.5\"\n+  checksum: 10c0/85c05121853cacb64f7cf63a4855e9044635e1231f70371cd7b8c78bc10be6f4dd7c68f592f92a2607e8bb68051540989b4677a2ccb525dba937f5cd95dc8bc1\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/web@npm:^10.0.0\":\n-  version: 10.0.1\n-  resolution: \"@react-spring/web@npm:10.0.1\"\n+\"@react-spring/web@npm:^9.7.5\":\n+  version: 9.7.5\n+  resolution: \"@react-spring/web@npm:9.7.5\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.1\"\n-    \"@react-spring/core\": \"npm:~10.0.1\"\n-    \"@react-spring/shared\": \"npm:~10.0.1\"\n-    \"@react-spring/types\": \"npm:~10.0.1\"\n+    \"@react-spring/animated\": \"npm:~9.7.5\"\n+    \"@react-spring/core\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~9.7.5\"\n+    \"@react-spring/types\": \"npm:~9.7.5\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/a0c788c9fd881ccb834feb22fc0694e74e59f7b76e498f0096f5b65e2c9812513955bf45ee27d7c5348f56a7bba7c5a6961d4be663728bb2172fe5aa6b6bdfc4\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n+    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0\n+  checksum: 10c0/bcd1e052e1b16341a12a19bf4515f153ca09d1fa86ff7752a5d02d7c4db58e8baf80e6283e64411f1e388c65340dce2254b013083426806b5dbae38bd151e53e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes preloaded relationships lookup in status serializer.\r\n\r\nI had confused the purpose of `Account#relations_map` and `StatusRelationshipsPresenter`, passing the second to `StatusFilter` while it was expecting the first.\r\n\r\n`StatusRelationshipsPresenter` fetches interaction status with a a batch of `Status` objects, while `Account#relations_map` fetches following/blocking/muting relations with a batch of `Account` objects. The former is exposed whenever we fetch one or more statuses, the second is only used in specific cases.\r\n\r\nSince quote posts, and only quote posts, require an `Account#relationships_map` that can be computed from the information contained in `StatusRelationshipsPresenter`, add a memoized `StatusRelationshipsPresenter#preloaded_account_relations` for that purpose.\r\n\r\nI also reordered the instance variable initialization so that they are in the same order in the two branches, leading to the same Ruby object shape.\r\n\r\n---\r\n\r\nFixes MAS-410\n\n---\n\nChoice A:\nGemfile\n@@ -64,7 +64,7 @@ gem 'kaminari', '~> 1.2'\n gem 'link_header', '~> 0.0'\n gem 'linzer', '~> 0.6.1'\n gem 'mario-redis-lock', '~> 1.2', require: 'redis_lock'\n-gem 'mime-types', '~> 3.6.0', require: 'mime/types/columnar'\n+gem 'mime-types', '~> 3.7.0', require: 'mime/types/columnar'\n gem 'mutex_m'\n gem 'nokogiri', '~> 1.15'\n gem 'oj', '~> 3.14'\n---\nGemfile.lock\n@@ -423,10 +423,10 @@ GEM\n       redis (>= 3.0.5)\n     matrix (0.4.2)\n     memory_profiler (1.1.0)\n-    mime-types (3.6.2)\n+    mime-types (3.7.0)\n       logger\n-      mime-types-data (~> 3.2015)\n-    mime-types-data (3.2025.0408)\n+      mime-types-data (~> 3.2025, >= 3.2025.0507)\n+    mime-types-data (3.2025.0507)\n     mini_mime (1.1.5)\n     mini_portile2 (2.8.8)\n     minitest (5.25.5)\n@@ -996,7 +996,7 @@ DEPENDENCIES\n   mail (~> 2.8)\n   mario-redis-lock (~> 1.2)\n   memory_profiler\n-  mime-types (~> 3.6.0)\n+  mime-types (~> 3.7.0)\n   mutex_m\n   net-http (~> 0.6.0)\n   net-ldap (~> 0.18)\n---\n\n\n---\n\nChoice B:\nspec/lib/activitypub/activity/remove_spec.rb\n@@ -4,29 +4,60 @@\n \n RSpec.describe ActivityPub::Activity::Remove do\n   let(:sender) { Fabricate(:account, featured_collection_url: 'https://example.com/featured') }\n-  let(:status) { Fabricate(:status, account: sender) }\n-\n-  let(:json) do\n-    {\n-      '@context': 'https://www.w3.org/ns/activitystreams',\n-      id: 'foo',\n-      type: 'Add',\n-      actor: ActivityPub::TagManager.instance.uri_for(sender),\n-      object: ActivityPub::TagManager.instance.uri_for(status),\n-      target: sender.featured_collection_url,\n-    }.with_indifferent_access\n-  end\n \n   describe '#perform' do\n     subject { described_class.new(json, sender) }\n \n-    before do\n-      StatusPin.create!(account: sender, status: status)\n-      subject.perform\n+    context 'when removing a pinned status' do\n+      let(:status) { Fabricate(:status, account: sender) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: ActivityPub::TagManager.instance.uri_for(status),\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        StatusPin.create!(account: sender, status: status)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.pinned?(status) }.to(false)\n+      end\n     end\n \n-    it 'removes a pin' do\n-      expect(sender.pinned?(status)).to be false\n+    context 'when removing a featured tag' do\n+      let(:tag) { Fabricate(:tag) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: {\n+            type: 'Hashtag',\n+            name: \"##{tag.display_name}\",\n+            href: \"https://example.com/tags/#{tag.name}\",\n+          },\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        sender.featured_tags.find_or_create_by!(name: tag.name)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.featured_tags.exists?(tag: tag) }.to(false)\n+      end\n     end\n   end\n end\n---\n\n\n---\n\nChoice C:\napp/presenters/status_relationships_presenter.rb\n@@ -7,14 +7,24 @@ class StatusRelationshipsPresenter\n               :bookmarks_map, :filters_map, :attributes_map\n \n   def initialize(statuses, current_account_id = nil, **options)\n+    @current_account_id = current_account_id\n+\n+    # Keeping a reference to @statuses is ok since `StatusRelationshipsPresenter`\n+    # basically never outlives the statuses collection it is passed\n+    @statuses = statuses\n+\n     if current_account_id.nil?\n-      @reblogs_map    = {}\n-      @favourites_map = {}\n-      @bookmarks_map  = {}\n-      @mutes_map      = {}\n-      @pins_map       = {}\n-      @filters_map    = {}\n+      @preloaded_account_relations = {}\n+      @filters_map     = {}\n+      @reblogs_map     = {}\n+      @favourites_map  = {}\n+      @bookmarks_map   = {}\n+      @mutes_map       = {}\n+      @pins_map        = {}\n+      @attributes_map  = {}\n     else\n+      @preloaded_account_relations = nil\n+\n       statuses            = statuses.compact\n       status_ids          = statuses.flat_map { |s| [s.id, s.reblog_of_id, s.proper.quote&.quoted_status_id] }.uniq.compact\n       conversation_ids    = statuses.flat_map { |s| [s.proper.conversation_id, s.proper.quote&.quoted_status&.conversation_id] }.uniq.compact\n@@ -30,6 +40,17 @@ def initialize(statuses, current_account_id = nil, **options)\n     end\n   end\n \n+  # This one is currently on-demand as it is only used for quote posts\n+  def preloaded_account_relations\n+    @preloaded_account_relations ||= begin\n+      accounts = @statuses.compact.flat_map { |s| [s.account, s.proper.account, s.proper.quote&.quoted_account] }.uniq.compact\n+\n+      account_ids = accounts.pluck(:id)\n+      account_domains = accounts.pluck(:domain).uniq\n+      Account.find(@current_account_id).relations_map(account_ids, account_domains)\n+    end\n+  end\n+\n   private\n \n   def build_filters_map(statuses, current_account_id)\n---\napp/serializers/rest/base_quote_serializer.rb\n@@ -20,6 +20,6 @@ def quoted_status\n   private\n \n   def status_filter\n-    @status_filter ||= StatusFilter.new(object.quoted_status, current_user&.account, instance_options[:relationships] || {})\n+    @status_filter ||= StatusFilter.new(object.quoted_status, current_user&.account, instance_options[:relationships]&.preloaded_account_relations || {})\n   end\n end\n---\nspec/requests/api/v1/timelines/home_spec.rb\n@@ -26,8 +26,13 @@\n       before do\n         user.account.follow!(bob)\n         user.account.follow!(ana)\n-        PostStatusService.new.call(bob, text: 'New toot from bob.')\n+        quoted = PostStatusService.new.call(bob, text: 'New toot from bob.')\n         PostStatusService.new.call(tim, text: 'New toot from tim.')\n+        reblogged = PostStatusService.new.call(tim, text: 'New toot from tim, which will end up boosted.')\n+        ReblogService.new.call(bob, reblogged)\n+        # TODO: use PostStatusService argument when available rather than manually creating quote\n+        quoting = PostStatusService.new.call(bob, text: 'Self-quote from bob.')\n+        Quote.create!(status: quoting, quoted_status: quoted, state: :accepted)\n         PostStatusService.new.call(ana, text: 'New toot from ana.')\n       end\n \n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/account_featured/components/featured_tag.tsx\n@@ -42,6 +42,7 @@ export const FeaturedTag: React.FC<FeaturedTagProps> = ({ tag, account }) => {\n               date: intl.formatDate(tag.get('last_status_at') ?? '', {\n                 month: 'short',\n                 day: '2-digit',\n+                year: 'numeric',\n               }),\n             })\n           : intl.formatMessage(messages.empty)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| nokogiri | `1.18.7` -> `1.18.8` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/nokogiri/1.18.8?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/nokogiri/1.18.8?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/nokogiri/1.18.7/1.18.8?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/nokogiri/1.18.7/1.18.8?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNDguNCIsInVwZGF0ZWRJblZlciI6IjM5LjI0OC40IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\napp/javascript/mastodon/components/hover_card_account.tsx\n@@ -45,6 +45,19 @@ export const HoverCardAccount = forwardRef<\n \n   const { familiarFollowers } = useFetchFamiliarFollowers({ accountId });\n \n+  const relationship = useAppSelector((state) =>\n+    accountId ? state.relationships.get(accountId) : undefined,\n+  );\n+  const isMutual = relationship?.followed_by && relationship.following;\n+  const isFollower = relationship?.followed_by;\n+  const hasRelationshipLoaded = !!relationship;\n+\n+  const shouldDisplayFamiliarFollowers =\n+    familiarFollowers.length > 0 &&\n+    hasRelationshipLoaded &&\n+    !isMutual &&\n+    !isFollower;\n+\n   return (\n     <div\n       ref={ref}\n@@ -85,7 +98,7 @@ export const HoverCardAccount = forwardRef<\n               value={account.followers_count}\n               renderer={FollowersCounter}\n             />\n-            {familiarFollowers.length > 0 && (\n+            {shouldDisplayFamiliarFollowers && (\n               <>\n                 &middot;\n                 <div className='hover-card__familiar-followers'>\n@@ -101,6 +114,22 @@ export const HoverCardAccount = forwardRef<\n                 </div>\n               </>\n             )}\n+            {(isMutual || isFollower) && (\n+              <>\n+                &middot;\n+                {isMutual ? (\n+                  <FormattedMessage\n+                    id='account.mutual'\n+                    defaultMessage='You follow each other'\n+                  />\n+                ) : (\n+                  <FormattedMessage\n+                    id='account.follows_you'\n+                    defaultMessage='Follows you'\n+                  />\n+                )}\n+              </>\n+            )}\n           </div>\n \n           <FollowButton accountId={accountId} />\n---\napp/javascript/styles/mastodon/components.scss\n@@ -10766,7 +10766,7 @@ noscript {\n     display: flex;\n     align-items: center;\n     flex-wrap: wrap;\n-    gap: 10px;\n+    gap: 2px 10px;\n   }\n \n   &__numbers {\n---\n\n\n---\n\nChoice B:\napp/helpers/context_helper.rb\n@@ -25,6 +25,7 @@ module ContextHelper\n     voters_count: { 'toot' => 'http://joinmastodon.org/ns#', 'votersCount' => 'toot:votersCount' },\n     suspended: { 'toot' => 'http://joinmastodon.org/ns#', 'suspended' => 'toot:suspended' },\n     attribution_domains: { 'toot' => 'http://joinmastodon.org/ns#', 'attributionDomains' => { '@id' => 'toot:attributionDomains', '@type' => '@id' } },\n+    quote_requests: { 'QuoteRequest' => 'https://w3id.org/fep/044f#QuoteRequest' },\n   }.freeze\n \n   def full_context\n---\napp/lib/activitypub/activity.rb\n@@ -57,6 +57,8 @@ def klass\n         ActivityPub::Activity::Remove\n       when 'Move'\n         ActivityPub::Activity::Move\n+      when 'QuoteRequest'\n+        ActivityPub::Activity::QuoteRequest\n       end\n     end\n   end\n---\napp/lib/activitypub/activity/quote_request.rb\n@@ -0,0 +1,30 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::Activity::QuoteRequest < ActivityPub::Activity\n+  include Payloadable\n+\n+  def perform\n+    return unless Mastodon::Feature.inbound_quotes_enabled?\n+    return if non_matching_uri_hosts?(@account.uri, @json['id'])\n+\n+    quoted_status = status_from_uri(object_uri)\n+    return if quoted_status.nil? || !quoted_status.account.local? || !quoted_status.distributable?\n+\n+    # For now, we don't support being quoted by external servers\n+    reject_quote_request!(quoted_status)\n+  end\n+\n+  private\n+\n+  def reject_quote_request!(quoted_status)\n+    quote = Quote.new(\n+      quoted_status: quoted_status,\n+      quoted_account: quoted_status.account,\n+      status: Status.new(account: @account, uri: @json['instrument']),\n+      account: @account,\n+      activity_uri: @json['id']\n+    )\n+    json = Oj.dump(serialize_payload(quote, ActivityPub::RejectQuoteRequestSerializer))\n+    ActivityPub::DeliveryWorker.perform_async(json, quoted_status.account_id, @account.inbox_url)\n+  end\n+end\n---\napp/serializers/activitypub/quote_request_serializer.rb\n@@ -0,0 +1,28 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::QuoteRequestSerializer < ActivityPub::Serializer\n+  context_extensions :quote_requests\n+\n+  attributes :id, :type, :actor, :instrument\n+  attribute :virtual_object, key: :object\n+\n+  def id\n+    object.activity_uri || [ActivityPub::TagManager.instance.uri_for(object.target_account), '#quote_requests/', object.id].join\n+  end\n+\n+  def type\n+    'QuoteRequest'\n+  end\n+\n+  def actor\n+    ActivityPub::TagManager.instance.uri_for(object.account)\n+  end\n+\n+  def virtual_object\n+    ActivityPub::TagManager.instance.uri_for(object.quoted_status)\n+  end\n+\n+  def instrument\n+    ActivityPub::TagManager.instance.uri_for(object.status)\n+  end\n+end\n---\napp/serializers/activitypub/reject_quote_request_serializer.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::RejectQuoteRequestSerializer < ActivityPub::Serializer\n+  attributes :id, :type, :actor\n+\n+  has_one :object, serializer: ActivityPub::QuoteRequestSerializer\n+\n+  def id\n+    [ActivityPub::TagManager.instance.uri_for(object.quoted_account), '#rejects/quote_requests/', object.id].join\n+  end\n+\n+  def type\n+    'Reject'\n+  end\n+\n+  def actor\n+    ActivityPub::TagManager.instance.uri_for(object.quoted_account)\n+  end\n+end\n---\nspec/lib/activitypub/activity/quote_request_spec.rb\n@@ -0,0 +1,51 @@\n+# frozen_string_literal: true\n+\n+require 'rails_helper'\n+\n+RSpec.describe ActivityPub::Activity::QuoteRequest, feature: :inbound_quotes do\n+  let(:sender)    { Fabricate(:account, domain: 'example.com') }\n+  let(:recipient) { Fabricate(:account) }\n+  let(:quoted_post) { Fabricate(:status, account: recipient) }\n+  let(:request_uri) { 'https://example.com/missing-ui' }\n+  let(:quoted_uri) { ActivityPub::TagManager.instance.uri_for(quoted_post) }\n+\n+  let(:json) do\n+    {\n+      '@context': [\n+        'https://www.w3.org/ns/activitystreams',\n+        {\n+          QuoteRequest: 'https://w3id.org/fep/044f#QuoteRequest',\n+        },\n+      ],\n+      id: request_uri,\n+      type: 'QuoteRequest',\n+      actor: ActivityPub::TagManager.instance.uri_for(sender),\n+      object: quoted_uri,\n+      instrument: 'https://example.com/unknown-status',\n+    }.with_indifferent_access\n+  end\n+\n+  describe '#perform' do\n+    subject { described_class.new(json, sender) }\n+\n+    context 'when trying to quote an unknown status' do\n+      let(:quoted_uri) { 'https://example.com/statuses/1234' }\n+\n+      it 'does not send anything' do\n+        expect { subject.perform }\n+          .to_not enqueue_sidekiq_job(ActivityPub::DeliveryWorker)\n+      end\n+    end\n+\n+    context 'when trying to quote an unquotable local status' do\n+      it 'sends a Reject activity' do\n+        expect { subject.perform }\n+          .to enqueue_sidekiq_job(ActivityPub::DeliveryWorker)\n+          .with(satisfying do |body|\n+            outgoing_json = Oj.load(body)\n+            outgoing_json['type'] == 'Reject' && %w(type id actor object instrument).all? { |key| json[key] == outgoing_json['object'][key] }\n+          end, recipient.id, sender.inbox_url)\n+      end\n+    end\n+  end\n+end\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -7274,10 +7274,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"decimal.js@npm:^10.4.2, decimal.js@npm:^10.4.3\":\n-  version: 10.4.3\n-  resolution: \"decimal.js@npm:10.4.3\"\n-  checksum: 10c0/6d60206689ff0911f0ce968d40f163304a6c1bc739927758e6efc7921cfa630130388966f16bf6ef6b838cb33679fbe8e7a78a2f3c478afce841fd55ac8fb8ee\n+\"decimal.js@npm:^10.4.2, decimal.js@npm:^10.4.3, decimal.js@npm:^10.5.0\":\n+  version: 10.5.0\n+  resolution: \"decimal.js@npm:10.5.0\"\n+  checksum: 10c0/785c35279df32762143914668df35948920b6c1c259b933e0519a69b7003fc0a5ed2a766b1e1dda02574450c566b21738a45f15e274b47c2ac02072c0d1f3ac3\n   languageName: node\n   linkType: hard\n \n@@ -8996,7 +8996,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"form-data@npm:^4.0.0, form-data@npm:^4.0.1\":\n+\"form-data@npm:^4.0.0\":\n   version: 4.0.1\n   resolution: \"form-data@npm:4.0.1\"\n   dependencies:\n@@ -11373,13 +11373,12 @@ __metadata:\n   linkType: hard\n \n \"jsdom@npm:^26.0.0\":\n-  version: 26.0.0\n-  resolution: \"jsdom@npm:26.0.0\"\n+  version: 26.1.0\n+  resolution: \"jsdom@npm:26.1.0\"\n   dependencies:\n     cssstyle: \"npm:^4.2.1\"\n     data-urls: \"npm:^5.0.0\"\n-    decimal.js: \"npm:^10.4.3\"\n-    form-data: \"npm:^4.0.1\"\n+    decimal.js: \"npm:^10.5.0\"\n     html-encoding-sniffer: \"npm:^4.0.0\"\n     http-proxy-agent: \"npm:^7.0.2\"\n     https-proxy-agent: \"npm:^7.0.6\"\n@@ -11389,20 +11388,20 @@ __metadata:\n     rrweb-cssom: \"npm:^0.8.0\"\n     saxes: \"npm:^6.0.0\"\n     symbol-tree: \"npm:^3.2.4\"\n-    tough-cookie: \"npm:^5.0.0\"\n+    tough-cookie: \"npm:^5.1.1\"\n     w3c-xmlserializer: \"npm:^5.0.0\"\n     webidl-conversions: \"npm:^7.0.0\"\n     whatwg-encoding: \"npm:^3.1.1\"\n     whatwg-mimetype: \"npm:^4.0.0\"\n-    whatwg-url: \"npm:^14.1.0\"\n+    whatwg-url: \"npm:^14.1.1\"\n     ws: \"npm:^8.18.0\"\n     xml-name-validator: \"npm:^5.0.0\"\n   peerDependencies:\n     canvas: ^3.0.0\n   peerDependenciesMeta:\n     canvas:\n       optional: true\n-  checksum: 10c0/e48725ba4027edcfc9bca5799eaec72c6561ecffe3675a8ff87fe9c3541ca4ff9f82b4eff5b3d9c527302da0d859b2f60e9364347a5d42b77f5c76c436c569dc\n+  checksum: 10c0/5b14a5bc32ce077a06fb42d1ab95b1191afa5cbbce8859e3b96831c5143becbbcbf0511d4d4934e922d2901443ced2cdc3b734c1cf30b5f73b3e067ce457d0f4\n   languageName: node\n   linkType: hard\n \n@@ -17446,12 +17445,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"tough-cookie@npm:^5.0.0\":\n-  version: 5.0.0\n-  resolution: \"tough-cookie@npm:5.0.0\"\n+\"tough-cookie@npm:^5.1.1\":\n+  version: 5.1.2\n+  resolution: \"tough-cookie@npm:5.1.2\"\n   dependencies:\n     tldts: \"npm:^6.1.32\"\n-  checksum: 10c0/4a69c885bf6f45c5a64e60262af99e8c0d58a33bd3d0ce5da62121eeb9c00996d0128a72df8fc4614cbde59cc8b70aa3e21e4c3c98c2bbde137d7aba7fa00124\n+  checksum: 10c0/5f95023a47de0f30a902bba951664b359725597d8adeabc66a0b93a931c3af801e1e697dae4b8c21a012056c0ea88bd2bf4dfe66b2adcf8e2f42cd9796fe0626\n   languageName: node\n   linkType: hard\n \n@@ -17480,12 +17479,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"tr46@npm:^5.0.0\":\n-  version: 5.0.0\n-  resolution: \"tr46@npm:5.0.0\"\n+\"tr46@npm:^5.1.0\":\n+  version: 5.1.0\n+  resolution: \"tr46@npm:5.1.0\"\n   dependencies:\n     punycode: \"npm:^2.3.1\"\n-  checksum: 10c0/1521b6e7bbc8adc825c4561480f9fe48eb2276c81335eed9fa610aa4c44a48a3221f78b10e5f18b875769eb3413e30efbf209ed556a17a42aa8d690df44b7bee\n+  checksum: 10c0/d761f7144e0cb296187674ef245c74f761e334d7cf25ca73ef60e4c72c097c75051031c093fa1a2fee04b904977b316716a7915854bcae8fb1a371746513cbe8\n   languageName: node\n   linkType: hard\n \n@@ -18520,13 +18519,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"whatwg-url@npm:^14.0.0, whatwg-url@npm:^14.1.0\":\n-  version: 14.1.0\n-  resolution: \"whatwg-url@npm:14.1.0\"\n+\"whatwg-url@npm:^14.0.0, whatwg-url@npm:^14.1.1\":\n+  version: 14.2.0\n+  resolution: \"whatwg-url@npm:14.2.0\"\n   dependencies:\n-    tr46: \"npm:^5.0.0\"\n+    tr46: \"npm:^5.1.0\"\n     webidl-conversions: \"npm:^7.0.0\"\n-  checksum: 10c0/f00104f1c67ce086ba8ffedab529cbbd9aefd8c0a6555320026de7aeff31f91c38680f95818b140a7c9cc657cde3781e567835dda552ddb1e2b8faaba0ac3cb6\n+  checksum: 10c0/f746fc2f4c906607d09537de1227b13f9494c171141e5427ed7d2c0dd0b6a48b43d8e71abaae57d368d0c06b673fd8ec63550b32ad5ed64990c7b0266c2b4272\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -446,7 +446,7 @@ GEM\n     net-smtp (0.5.1)\n       net-protocol\n     nio4r (2.7.4)\n-    nokogiri (1.18.7)\n+    nokogiri (1.18.8)\n       mini_portile2 (~> 2.8.2)\n       racc (~> 1.4)\n     oj (3.16.10)\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [react-intl](https://formatjs.github.io/docs/react-intl) ([source](https://redirect.github.com/formatjs/formatjs)) | [`7.1.10` -> `7.1.11`](https://renovatebot.com/diffs/npm/react-intl/7.1.10/7.1.11) | [![age](https://developer.mend.io/api/mc/badges/age/npm/react-intl/7.1.11?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/react-intl/7.1.11?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/react-intl/7.1.10/7.1.11?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/react-intl/7.1.10/7.1.11?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>formatjs/formatjs (react-intl)</summary>\n\n### [`v7.1.11`](https://redirect.github.com/formatjs/formatjs/compare/react-intl@7.1.10...773d6ebf881357f6e4c2dd7e8984b1bd0f69b4ca)\n\n[Compare Source](https://redirect.github.com/formatjs/formatjs/compare/react-intl@7.1.10...react-intl@7.1.11)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNDguNCIsInVwZGF0ZWRJblZlciI6IjM5LjI0OC40IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -807,7 +807,7 @@ GEM\n       rubyzip (>= 1.2.2, < 3.0)\n       websocket (~> 1.0)\n     semantic_range (3.1.0)\n-    shoulda-matchers (6.4.0)\n+    shoulda-matchers (6.5.0)\n       activesupport (>= 5.2.0)\n     sidekiq (6.5.12)\n       connection_pool (>= 2.2.5, < 3)\n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -9187,23 +9187,23 @@ __metadata:\n   linkType: hard\n \n \"pino@npm:^9.0.0\":\n-  version: 9.6.0\n-  resolution: \"pino@npm:9.6.0\"\n+  version: 9.7.0\n+  resolution: \"pino@npm:9.7.0\"\n   dependencies:\n     atomic-sleep: \"npm:^1.0.0\"\n     fast-redact: \"npm:^3.1.1\"\n     on-exit-leak-free: \"npm:^2.1.0\"\n     pino-abstract-transport: \"npm:^2.0.0\"\n     pino-std-serializers: \"npm:^7.0.0\"\n-    process-warning: \"npm:^4.0.0\"\n+    process-warning: \"npm:^5.0.0\"\n     quick-format-unescaped: \"npm:^4.0.3\"\n     real-require: \"npm:^0.2.0\"\n     safe-stable-stringify: \"npm:^2.3.1\"\n     sonic-boom: \"npm:^4.0.1\"\n     thread-stream: \"npm:^3.0.0\"\n   bin:\n     pino: bin.js\n-  checksum: 10c0/bcd1e9d9b301bea13b95689ca9ad7105ae9451928fb6c0b67b3e58c5fe37cea1d40665f3d6641e3da00be0bbc17b89031e67abbc8ea6aac6164f399309fd78e7\n+  checksum: 10c0/c7f8a83a9a9d728b4eff6d0f4b9367f031c91bcaa5806fbf0eedcc8e77faba593d59baf11a8fba0dd1c778bb17ca7ed01418ac1df4ec129faeedd4f3ecaff66f\n   languageName: node\n   linkType: hard\n \n@@ -9759,6 +9759,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"process-warning@npm:^5.0.0\":\n+  version: 5.0.0\n+  resolution: \"process-warning@npm:5.0.0\"\n+  checksum: 10c0/941f48863d368ec161e0b5890ba0c6af94170078f3d6b5e915c19b36fb59edb0dc2f8e834d25e0d375a8bf368a49d490f080508842168832b93489d17843ec29\n+  languageName: node\n+  linkType: hard\n+\n \"prom-client@npm:^15.0.0\":\n   version: 15.1.3\n   resolution: \"prom-client@npm:15.1.3\"\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -14795,8 +14795,8 @@ __metadata:\n   linkType: hard\n \n \"react-intl@npm:^7.1.10\":\n-  version: 7.1.10\n-  resolution: \"react-intl@npm:7.1.10\"\n+  version: 7.1.11\n+  resolution: \"react-intl@npm:7.1.11\"\n   dependencies:\n     \"@formatjs/ecma402-abstract\": \"npm:2.3.4\"\n     \"@formatjs/icu-messageformat-parser\": \"npm:2.11.2\"\n@@ -14812,7 +14812,7 @@ __metadata:\n   peerDependenciesMeta:\n     typescript:\n       optional: true\n-  checksum: 10c0/7d47ac7e2284eb6d920d26d5cdcfee33f54805eb27284dab969ac931139c5eacb2b24f60c8e7645a623b768d0fdfa5dfc4df63a9270301d57aa356ddf231c484\n+  checksum: 10c0/f20770fb7bcce7a67acec70b9183f5320b7f3f9bbcb263ca8f4787817297674d1be158687f94d1e2803a9c8696d4f93dd86a28898aba8bc5197e858313e3dd06\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nGemfile.lock\n@@ -455,7 +455,7 @@ GEM\n     nokogiri (1.18.8)\n       mini_portile2 (~> 2.8.2)\n       racc (~> 1.4)\n-    oj (3.16.10)\n+    oj (3.16.11)\n       bigdecimal (>= 3.0)\n       ostruct (>= 0.2)\n     omniauth (2.1.3)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nI can't see when we would ever use HTTP Basic Authentication given all of our session stuff happens through forms with params. The only details for why this was enabled was \"support PAM\"\r\n\r\nEdit: See the comments below for the full history.\n\n---\n\nChoice A:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.222.3', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1088.0)\n+    aws-sdk-core (3.222.2)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -931,7 +933,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.222.3)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice B:\n.nvmrc\n@@ -1 +1 @@\n-22.15\n+22.16\n---\n\n\n---\n\nChoice C:\nconfig/initializers/devise.rb\n@@ -158,13 +158,15 @@ def session_cookie\n   # given strategies, for example, `config.params_authenticatable = [:database]` will\n   # enable it only for database (email + password) authentication.\n   # config.params_authenticatable = true\n+  config.params_authenticatable = true\n \n   # Tell if authentication through HTTP Auth is enabled. False by default.\n   # It can be set to an array that will enable http authentication only for the\n   # given strategies, for example, `config.http_authenticatable = [:database]` will\n   # enable it only for database authentication. The supported strategies are:\n   # :database      = Support basic authentication with authentication key + password\n-  config.http_authenticatable = [:pam, :database]\n+  # config.http_authenticatable = [:pam, :database]\n+  config.http_authenticatable = false\n \n   # If 401 status code should be returned for AJAX requests. True by default.\n   # config.http_authenticatable_on_xhr = true\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/account_featured/components/featured_tag.tsx\n@@ -42,6 +42,7 @@ export const FeaturedTag: React.FC<FeaturedTagProps> = ({ tag, account }) => {\n               date: intl.formatDate(tag.get('last_status_at') ?? '', {\n                 month: 'short',\n                 day: '2-digit',\n+                year: 'numeric',\n               }),\n             })\n           : intl.formatMessage(messages.empty)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nLooking at the code, those have no reason to ever be `nil`, and creation sites should always pass the relevant token and user.\r\n\r\nTherefore, add validations and database constraints, and remove fallback token creation code.\n\n---\n\nChoice A:\napp/javascript/styles/mastodon/basics.scss\n@@ -17,7 +17,12 @@ body {\n   font-weight: 400;\n   color: $primary-text-color;\n   text-rendering: optimizelegibility;\n-  font-feature-settings: 'kern';\n+\n+  // Disable kerning for Japanese text to preserve monospaced alignment for readability\n+  &:not(:lang(ja)) {\n+    font-feature-settings: 'kern';\n+  }\n+\n   text-size-adjust: none;\n   -webkit-tap-highlight-color: rgba(0, 0, 0, 0%);\n   -webkit-tap-highlight-color: transparent;\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/components/status_quoted.tsx\n@@ -68,15 +68,15 @@ type QuoteMap = ImmutableMap<'state' | 'quoted_status', string | null>;\n \n export const QuotedStatus: React.FC<{\n   quote: QuoteMap;\n+  contextType?: string;\n   variant?: 'full' | 'link';\n   nestingLevel?: number;\n-}> = ({ quote, nestingLevel = 1, variant = 'full' }) => {\n+}> = ({ quote, contextType, nestingLevel = 1, variant = 'full' }) => {\n   const quotedStatusId = quote.get('quoted_status');\n   const state = quote.get('state');\n   const status = useAppSelector((state) =>\n     quotedStatusId ? state.statuses.get(quotedStatusId) : undefined,\n   );\n-\n   let quoteError: React.ReactNode = null;\n \n   if (state === 'deleted') {\n@@ -131,10 +131,16 @@ export const QuotedStatus: React.FC<{\n   return (\n     <QuoteWrapper>\n       {/* @ts-expect-error Status is not yet typed */}\n-      <StatusContainer isQuotedPost id={quotedStatusId} avatarSize={40}>\n+      <StatusContainer\n+        isQuotedPost\n+        id={quotedStatusId}\n+        contextType={contextType}\n+        avatarSize={40}\n+      >\n         {canRenderChildQuote && (\n           <QuotedStatus\n             quote={childQuote}\n+            contextType={contextType}\n             variant={\n               nestingLevel === MAX_QUOTE_POSTS_NESTING_LEVEL ? 'link' : 'full'\n             }\n@@ -148,6 +154,7 @@ export const QuotedStatus: React.FC<{\n \n interface StatusQuoteManagerProps {\n   id: string;\n+  contextType?: string;\n   [key: string]: unknown;\n }\n \n@@ -168,7 +175,7 @@ export const StatusQuoteManager = (props: StatusQuoteManagerProps) => {\n   if (quote) {\n     return (\n       <StatusContainer {...props}>\n-        <QuotedStatus quote={quote} />\n+        <QuotedStatus quote={quote} contextType={props.contextType} />\n       </StatusContainer>\n     );\n   }\n---\n\n\n---\n\nChoice C:\napp/models/web/push_subscription.rb\n@@ -12,13 +12,13 @@\n #  standard        :boolean          default(FALSE), not null\n #  created_at      :datetime         not null\n #  updated_at      :datetime         not null\n-#  access_token_id :bigint(8)\n-#  user_id         :bigint(8)\n+#  access_token_id :bigint(8)        not null\n+#  user_id         :bigint(8)        not null\n #\n \n class Web::PushSubscription < ApplicationRecord\n-  belongs_to :user, optional: true\n-  belongs_to :access_token, class_name: 'Doorkeeper::AccessToken', optional: true\n+  belongs_to :user\n+  belongs_to :access_token, class_name: 'Doorkeeper::AccessToken'\n \n   has_one :session_activation, foreign_key: 'web_push_subscription_id', inverse_of: :web_push_subscription, dependent: nil\n \n@@ -28,32 +28,16 @@ class Web::PushSubscription < ApplicationRecord\n \n   validates_with WebPushKeyValidator\n \n-  delegate :locale, to: :associated_user\n+  delegate :locale, to: :user\n \n   generates_token_for :unsubscribe, expires_in: Web::PushNotificationWorker::TTL\n \n   def pushable?(notification)\n     policy_allows_notification?(notification) && alert_enabled_for_notification_type?(notification)\n   end\n \n-  def associated_user\n-    return @associated_user if defined?(@associated_user)\n-\n-    @associated_user = if user_id.nil?\n-                         session_activation.user\n-                       else\n-                         user\n-                       end\n-  end\n-\n   def associated_access_token\n-    return @associated_access_token if defined?(@associated_access_token)\n-\n-    @associated_access_token = if access_token_id.nil?\n-                                 find_or_create_access_token.token\n-                               else\n-                                 access_token.token\n-                               end\n+    access_token.token\n   end\n \n   class << self\n@@ -65,16 +49,6 @@ def unsubscribe_for(application_id, resource_owner)\n \n   private\n \n-  def find_or_create_access_token\n-    Doorkeeper::AccessToken.find_or_create_for(\n-      application: Doorkeeper::Application.find_by(superapp: true),\n-      resource_owner: user_id || session_activation.user_id,\n-      scopes: Doorkeeper::OAuth::Scopes.from_string('read write follow push'),\n-      expires_in: Doorkeeper.configuration.access_token_expires_in,\n-      use_refresh_token: Doorkeeper.configuration.refresh_token_enabled?\n-    )\n-  end\n-\n   def alert_enabled_for_notification_type?(notification)\n     truthy?(data&.dig('alerts', notification.type.to_s))\n   end\n---\napp/serializers/web/notification_serializer.rb\n@@ -13,7 +13,7 @@ def access_token\n   end\n \n   def preferred_locale\n-    current_push_subscription.associated_user&.locale || I18n.default_locale\n+    current_push_subscription.user&.locale || I18n.default_locale\n   end\n \n   def notification_id\n---\ndb/migrate/20250422083912_add_not_null_to_web_push_subscription_user.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddNotNullToWebPushSubscriptionUser < ActiveRecord::Migration[8.0]\n+  def change\n+    add_check_constraint :web_push_subscriptions, 'user_id IS NOT NULL', name: 'web_push_subscriptions_user_id_null', validate: false\n+  end\n+end\n---\ndb/migrate/20250422084214_validate_add_not_null_to_web_push_subscription_user.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ValidateAddNotNullToWebPushSubscriptionUser < ActiveRecord::Migration[8.0]\n+  def up\n+    connection.execute(<<~SQL.squish)\n+      DELETE FROM web_push_subscriptions\n+      WHERE user_id IS NULL\n+    SQL\n+\n+    validate_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_user_id_null'\n+    change_column_null :web_push_subscriptions, :user_id, false\n+    remove_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_user_id_null'\n+  end\n+\n+  def down\n+    add_check_constraint :web_push_subscriptions, 'user_id IS NOT NULL', name: 'web_push_subscriptions_user_id_null', validate: false\n+    change_column_null :web_push_subscriptions, :user_id, true\n+  end\n+end\n---\ndb/migrate/20250422085027_add_not_null_to_web_push_subscription_access_token.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddNotNullToWebPushSubscriptionAccessToken < ActiveRecord::Migration[8.0]\n+  def change\n+    add_check_constraint :web_push_subscriptions, 'access_token_id IS NOT NULL', name: 'web_push_subscriptions_access_token_id_null', validate: false\n+  end\n+end\n---\ndb/migrate/20250422085303_validate_add_not_null_to_web_push_subscription_access_token.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ValidateAddNotNullToWebPushSubscriptionAccessToken < ActiveRecord::Migration[8.0]\n+  def up\n+    connection.execute(<<~SQL.squish)\n+      DELETE FROM web_push_subscriptions\n+      WHERE access_token_id IS NULL\n+    SQL\n+\n+    validate_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_access_token_id_null'\n+    change_column_null :web_push_subscriptions, :access_token_id, false\n+    remove_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_access_token_id_null'\n+  end\n+\n+  def down\n+    add_check_constraint :web_push_subscriptions, 'access_token_id IS NOT NULL', name: 'web_push_subscriptions_access_token_id_null', validate: false\n+    change_column_null :web_push_subscriptions, :access_token_id, true\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_11_095859) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_22_085303) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -1237,8 +1237,8 @@\n     t.json \"data\"\n     t.datetime \"created_at\", precision: nil, null: false\n     t.datetime \"updated_at\", precision: nil, null: false\n-    t.bigint \"access_token_id\"\n-    t.bigint \"user_id\"\n+    t.bigint \"access_token_id\", null: false\n+    t.bigint \"user_id\", null: false\n     t.boolean \"standard\", default: false, null: false\n     t.index [\"access_token_id\"], name: \"index_web_push_subscriptions_on_access_token_id\", where: \"(access_token_id IS NOT NULL)\"\n     t.index [\"user_id\"], name: \"index_web_push_subscriptions_on_user_id\"\n---\nspec/fabricators/web_push_subscription_fabricator.rb\n@@ -8,4 +8,6 @@\n     Base64.urlsafe_encode64(ecdh_key)\n   end\n   key_auth { Base64.urlsafe_encode64(Random.new.bytes(16)) }\n+  user { Fabricate(:user) }\n+  access_token { |attrs| Fabricate.build(:accessible_access_token, resource_owner_id: attrs[:user].id) }\n end\n---\nspec/requests/api/v1/push/subscriptions_spec.rb\n@@ -207,7 +207,8 @@ def create_subscription_with_token\n     Fabricate(\n       :web_push_subscription,\n       endpoint: create_payload[:subscription][:endpoint],\n-      access_token_id: token.id\n+      access_token: token,\n+      user: user\n     )\n   end\n end\n---\n\n\n---\n\nChoice D:\napp/lib/entity_cache.rb\n@@ -26,7 +26,9 @@ def emoji(shortcodes, domain)\n       uncached_ids << shortcode unless cached.key?(to_key(:emoji, shortcode, domain))\n     end\n \n-    unless uncached_ids.empty?\n+    if uncached_ids.empty?\n+      uncached = {}\n+    else\n       uncached = CustomEmoji.enabled.where(shortcode: shortcodes, domain: domain).index_by(&:shortcode)\n       uncached.each_value { |item| Rails.cache.write(to_key(:emoji, item.shortcode, domain), item, expires_in: MAX_EXPIRATION) }\n     end\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [rubocop-rspec](https://redirect.github.com/rubocop/rubocop-rspec) ([changelog](https://redirect.github.com/rubocop/rubocop-rspec/blob/master/CHANGELOG.md)) | `3.5.0` -> `3.6.0` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/rubocop-rspec/3.6.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/rubocop-rspec/3.6.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/rubocop-rspec/3.5.0/3.6.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/rubocop-rspec/3.5.0/3.6.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>rubocop/rubocop-rspec (rubocop-rspec)</summary>\n\n### [`v3.6.0`](https://redirect.github.com/rubocop/rubocop-rspec/blob/HEAD/CHANGELOG.md#360-2025-04-18)\n\n[Compare Source](https://redirect.github.com/rubocop/rubocop-rspec/compare/v3.5.0...v3.6.0)\n\n-   Fix false positive in `RSpec/Pending`, where it would mark the default block `it` as an offense. (\\[[@&#8203;bquorning](https://redirect.github.com/bquorning)])\n-   Fix issue when `Style/ContextWording` is configured with a Prefix being interpreted as a boolean, like `on`. (\\[[@&#8203;sakuro](https://redirect.github.com/sakuro)])\n-   Add new `RSpec/IncludeExamples` cop to enforce using `it_behaves_like` over `include_examples`. (\\[[@&#8203;dvandersluis](https://redirect.github.com/dvandersluis)])\n-   Change `RSpec/ScatteredSetup` to allow `around` hooks to be scattered. (\\[[@&#8203;ydah](https://redirect.github.com/ydah)])\n-   Fix an error `RSpec/ChangeByZero` cop when without expect block. (\\[[@&#8203;lee266](https://redirect.github.com/lee266)])\n-   Fix a false positive for `RSpec/DescribedClass` when `SkipBlocks` is true and numblocks are used. (\\[[@&#8203;earlopain](https://redirect.github.com/earlopain)])\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yNDguNCIsInVwZGF0ZWRJblZlciI6IjM5LjI0OC40IiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\napp/views/auth/registrations/new.html.haml\n@@ -56,7 +56,7 @@\n     .fields-group\n       = f.input :date_of_birth,\n                 as: :date_of_birth,\n-                hint: t('simple_form.hints.user.date_of_birth', age: Setting.min_age.to_i),\n+                hint: t('simple_form.hints.user.date_of_birth', count: Setting.min_age.to_i),\n                 required: true,\n                 wrapper: :with_block_label\n \n---\nconfig/locales/simple_form.en.yml\n@@ -148,7 +148,9 @@ en:\n         min_age: Should not be below the minimum age required by the laws of your jurisdiction.\n       user:\n         chosen_languages: When checked, only posts in selected languages will be displayed in public timelines\n-        date_of_birth: We have to make sure you're at least %{age} to use Mastodon. We won't store this.\n+        date_of_birth:\n+          one: We have to make sure you're at least %{count} to use Mastodon. We won't store this.\n+          other: We have to make sure you're at least %{count} to use Mastodon. We won't store this.\n         role: The role controls which permissions the user has.\n       user_role:\n         color: Color to be used for the role throughout the UI, as RGB in hex format\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -773,7 +773,7 @@ GEM\n       rack (>= 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n       rubocop-ast (>= 1.38.0, < 2.0)\n-    rubocop-rspec (3.5.0)\n+    rubocop-rspec (3.6.0)\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n     rubocop-rspec_rails (2.31.0)\n---\n\n\n---\n\nChoice C:\napp/views/layouts/application.html.haml\n@@ -28,6 +28,7 @@\n     = theme_style_tags current_theme\n     = vite_client_tag\n     = vite_react_refresh_tag\n+    = vite_polyfill_tag crossorigin: 'anonymous'\n     -# Needed for the wicg-inert polyfill. It needs to be on it's own <style> tag, with this `id`\n     = vite_stylesheet_tag 'styles/entrypoints/inert.scss', media: 'all', id: 'inert-style'\n     = vite_typescript_tag 'common.ts', crossorigin: 'anonymous'\n---\napp/views/layouts/embedded.html.haml\n@@ -13,6 +13,7 @@\n \n     = vite_client_tag\n     = vite_react_refresh_tag\n+    = vite_polyfill_tag crossorigin: 'anonymous'\n     = theme_style_tags 'mastodon-light'\n     = vite_preload_file_tag \"mastodon/locales/#{I18n.locale}.json\"\n     = render_initial_state\n---\napp/views/layouts/error.html.haml\n@@ -7,6 +7,7 @@\n     %meta{ content: 'width=device-width,initial-scale=1', name: 'viewport' }/\n     = vite_client_tag\n     = vite_react_refresh_tag\n+    = vite_polyfill_tag crossorigin: 'anonymous'\n     = theme_style_tags Setting.default_settings['theme']\n     = vite_typescript_tag 'error.ts', crossorigin: 'anonymous'\n   %body.error\n---\nlib/vite_ruby/sri_extensions.rb\n@@ -119,6 +119,12 @@ def vite_preload_file_tag(name,\n   rescue ViteRuby::MissingEntrypointError\n     # Ignore this error, it is not critical if the file is not preloaded\n   end\n+\n+  def vite_polyfill_tag(**)\n+    entry = vite_manifest.path_and_integrity_for('polyfill', type: :virtual)\n+\n+    javascript_include_tag(type: 'module', src: entry[:path], integrity: entry[:integrity], **)\n+  end\n end\n \n ViteRails::TagHelpers.prepend ViteRails::TagHelpers::IntegrityExtension\n---\npackage.json\n@@ -47,6 +47,7 @@\n     \"@react-spring/web\": \"^10.0.0\",\n     \"@reduxjs/toolkit\": \"^2.0.1\",\n     \"@use-gesture/react\": \"^10.3.1\",\n+    \"@vitejs/plugin-legacy\": \"^6.1.1\",\n     \"@vitejs/plugin-react\": \"^4.2.1\",\n     \"arrow-key-navigation\": \"^1.2.0\",\n     \"async-mutex\": \"^0.5.0\",\n---\nvite.config.mts\n@@ -10,6 +10,7 @@ import RailsPlugin from 'vite-plugin-rails';\n import { VitePWA } from 'vite-plugin-pwa';\n import tsconfigPaths from 'vite-tsconfig-paths';\n import yaml from 'js-yaml';\n+import legacy from '@vitejs/plugin-legacy';\n \n import { defineConfig, UserConfigFnPromise, UserConfig } from 'vite';\n import postcssPresetEnv from 'postcss-preset-env';\n@@ -119,6 +120,10 @@ export const config: UserConfigFnPromise = async ({ mode, command }) => {\n       }),\n       MastodonServiceWorkerLocales(),\n       MastodonEmojiCompressed(),\n+      legacy({\n+        renderLegacyChunks: false,\n+        modernPolyfills: true,\n+      }),\n       VitePWA({\n         srcDir: 'mastodon/service_worker',\n         // We need to use injectManifest because we use our own service worker\n---\nyarn.lock\n@@ -1029,7 +1029,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@babel/preset-env@npm:^7.11.0\":\n+\"@babel/preset-env@npm:^7.11.0, @babel/preset-env@npm:^7.26.9\":\n   version: 7.27.2\n   resolution: \"@babel/preset-env@npm:7.27.2\"\n   dependencies:\n@@ -2488,6 +2488,7 @@ __metadata:\n     \"@types/redux-immutable\": \"npm:^4.0.3\"\n     \"@types/requestidlecallback\": \"npm:^0.3.5\"\n     \"@use-gesture/react\": \"npm:^10.3.1\"\n+    \"@vitejs/plugin-legacy\": \"npm:^6.1.1\"\n     \"@vitejs/plugin-react\": \"npm:^4.2.1\"\n     arrow-key-navigation: \"npm:^1.2.0\"\n     async-mutex: \"npm:^0.5.0\"\n@@ -4159,6 +4160,25 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"@vitejs/plugin-legacy@npm:^6.1.1\":\n+  version: 6.1.1\n+  resolution: \"@vitejs/plugin-legacy@npm:6.1.1\"\n+  dependencies:\n+    \"@babel/core\": \"npm:^7.26.10\"\n+    \"@babel/preset-env\": \"npm:^7.26.9\"\n+    browserslist: \"npm:^4.24.4\"\n+    browserslist-to-esbuild: \"npm:^2.1.1\"\n+    core-js: \"npm:^3.41.0\"\n+    magic-string: \"npm:^0.30.17\"\n+    regenerator-runtime: \"npm:^0.14.1\"\n+    systemjs: \"npm:^6.15.1\"\n+  peerDependencies:\n+    terser: ^5.16.0\n+    vite: ^6.0.0\n+  checksum: 10c0/3a41098e422246d7ddbb6add678c1317474679a5e82e011947898cea5336fa8da9bb8fa625ab1284265f6ba123278fc2bf7c5b0b9b87febaaf865f14ac8e6ece\n+  languageName: node\n+  linkType: hard\n+\n \"@vitejs/plugin-react@npm:^4.2.1\":\n   version: 4.4.1\n   resolution: \"@vitejs/plugin-react@npm:4.4.1\"\n@@ -4805,6 +4825,19 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"browserslist-to-esbuild@npm:^2.1.1\":\n+  version: 2.1.1\n+  resolution: \"browserslist-to-esbuild@npm:2.1.1\"\n+  dependencies:\n+    meow: \"npm:^13.0.0\"\n+  peerDependencies:\n+    browserslist: \"*\"\n+  bin:\n+    browserslist-to-esbuild: cli/index.js\n+  checksum: 10c0/4d1968efd72850949d5dfa355f4663c695a8fd7b259b19cc81ecd0ed33dd37bbd327475c644de3f2beb53e737c6e511c6e84ed3e97a2ff49f117505a7707c72d\n+  languageName: node\n+  linkType: hard\n+\n \"browserslist@npm:^4.24.0, browserslist@npm:^4.24.4\":\n   version: 4.24.4\n   resolution: \"browserslist@npm:4.24.4\"\n@@ -5202,7 +5235,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"core-js@npm:^3.30.2\":\n+\"core-js@npm:^3.30.2, core-js@npm:^3.41.0\":\n   version: 3.42.0\n   resolution: \"core-js@npm:3.42.0\"\n   checksum: 10c0/2913d3d5452d54ad92f058d66046782d608c05e037bcc523aab79c04454fe640998f94e6011292969d66dfa472f398b085ce843dcb362056532a5799c627184e\n@@ -8327,7 +8360,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"meow@npm:^13.2.0\":\n+\"meow@npm:^13.0.0, meow@npm:^13.2.0\":\n   version: 13.2.0\n   resolution: \"meow@npm:13.2.0\"\n   checksum: 10c0/d5b339ae314715bcd0b619dd2f8a266891928e21526b4800d49b4fba1cc3fff7e2c1ff5edd3344149fac841bc2306157f858e8c4d5eaee4d52ce52ad925664ce\n@@ -10405,7 +10438,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"regenerator-runtime@npm:^0.14.0\":\n+\"regenerator-runtime@npm:^0.14.0, regenerator-runtime@npm:^0.14.1\":\n   version: 0.14.1\n   resolution: \"regenerator-runtime@npm:0.14.1\"\n   checksum: 10c0/1b16eb2c4bceb1665c89de70dcb64126a22bc8eb958feef3cd68fe11ac6d2a4899b5cd1b80b0774c7c03591dc57d16631a7f69d2daa2ec98100e2f29f7ec4cc4\n@@ -11689,6 +11722,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"systemjs@npm:^6.15.1\":\n+  version: 6.15.1\n+  resolution: \"systemjs@npm:6.15.1\"\n+  checksum: 10c0/106e5751a49dbe4acb17fa1474a43b27fd26efbee1b322c00c04c08f3e95de756adfba828d743af89bef7fa10888da8a5c5ceb55dae5c42e4909b151168ad192\n+  languageName: node\n+  linkType: hard\n+\n \"table@npm:^6.9.0\":\n   version: 6.9.0\n   resolution: \"table@npm:6.9.0\"\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/components/account.tsx\n@@ -11,9 +11,12 @@ import {\n   unblockAccount,\n   muteAccount,\n   unmuteAccount,\n+  followAccountSuccess,\n } from 'mastodon/actions/accounts';\n+import { showAlertForError } from 'mastodon/actions/alerts';\n import { openModal } from 'mastodon/actions/modal';\n import { initMuteModal } from 'mastodon/actions/mutes';\n+import { apiFollowAccount } from 'mastodon/api/accounts';\n import { Avatar } from 'mastodon/components/avatar';\n import { Button } from 'mastodon/components/button';\n import { FollowersCounter } from 'mastodon/components/counters';\n@@ -24,6 +27,7 @@ import { RelativeTimestamp } from 'mastodon/components/relative_timestamp';\n import { ShortNumber } from 'mastodon/components/short_number';\n import { Skeleton } from 'mastodon/components/skeleton';\n import { VerifiedBadge } from 'mastodon/components/verified_badge';\n+import { me } from 'mastodon/initial_state';\n import type { MenuItem } from 'mastodon/models/dropdown_menu';\n import { useAppSelector, useAppDispatch } from 'mastodon/store';\n \n@@ -113,14 +117,43 @@ export const Account: React.FC<{\n       ];\n     } else if (defaultAction !== 'block') {\n       const handleAddToLists = () => {\n-        dispatch(\n-          openModal({\n-            modalType: 'LIST_ADDER',\n-            modalProps: {\n-              accountId: id,\n-            },\n-          }),\n-        );\n+        const openAddToListModal = () => {\n+          dispatch(\n+            openModal({\n+              modalType: 'LIST_ADDER',\n+              modalProps: {\n+                accountId: id,\n+              },\n+            }),\n+          );\n+        };\n+        if (relationship?.following || relationship?.requested || id === me) {\n+          openAddToListModal();\n+        } else {\n+          dispatch(\n+            openModal({\n+              modalType: 'CONFIRM_FOLLOW_TO_LIST',\n+              modalProps: {\n+                accountId: id,\n+                onConfirm: () => {\n+                  apiFollowAccount(id)\n+                    .then((relationship) => {\n+                      dispatch(\n+                        followAccountSuccess({\n+                          relationship,\n+                          alreadyFollowing: false,\n+                        }),\n+                      );\n+                      openAddToListModal();\n+                    })\n+                    .catch((err: unknown) => {\n+                      dispatch(showAlertForError(err));\n+                    });\n+                },\n+              },\n+            }),\n+          );\n+        }\n       };\n \n       arr = [\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes MAS-406\n\n---\n\nChoice A:\npackage.json\n@@ -99,7 +99,7 @@\n     \"redux-immutable\": \"^4.0.0\",\n     \"regenerator-runtime\": \"^0.14.0\",\n     \"requestidlecallback\": \"^0.3.0\",\n-    \"rollup-plugin-visualizer\": \"^5.14.0\",\n+    \"rollup-plugin-visualizer\": \"^6.0.0\",\n     \"sass\": \"^1.62.1\",\n     \"stacktrace-js\": \"^2.0.2\",\n     \"stringz\": \"^2.1.0\",\n---\nyarn.lock\n@@ -2554,7 +2554,7 @@ __metadata:\n     redux-immutable: \"npm:^4.0.0\"\n     regenerator-runtime: \"npm:^0.14.0\"\n     requestidlecallback: \"npm:^0.3.0\"\n-    rollup-plugin-visualizer: \"npm:^5.14.0\"\n+    rollup-plugin-visualizer: \"npm:^6.0.0\"\n     sass: \"npm:^1.62.1\"\n     stacktrace-js: \"npm:^2.0.2\"\n     stringz: \"npm:^2.1.0\"\n@@ -4887,6 +4887,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"bundle-name@npm:^4.1.0\":\n+  version: 4.1.0\n+  resolution: \"bundle-name@npm:4.1.0\"\n+  dependencies:\n+    run-applescript: \"npm:^7.0.0\"\n+  checksum: 10c0/8e575981e79c2bcf14d8b1c027a3775c095d362d1382312f444a7c861b0e21513c0bd8db5bd2b16e50ba0709fa622d4eab6b53192d222120305e68359daece29\n+  languageName: node\n+  linkType: hard\n+\n \"bytes@npm:3.1.2\":\n   version: 3.1.2\n   resolution: \"bytes@npm:3.1.2\"\n@@ -5535,6 +5544,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"default-browser-id@npm:^5.0.0\":\n+  version: 5.0.0\n+  resolution: \"default-browser-id@npm:5.0.0\"\n+  checksum: 10c0/957fb886502594c8e645e812dfe93dba30ed82e8460d20ce39c53c5b0f3e2afb6ceaec2249083b90bdfbb4cb0f34e1f73fde3d68cac00becdbcfd894156b5ead\n+  languageName: node\n+  linkType: hard\n+\n+\"default-browser@npm:^5.2.1\":\n+  version: 5.2.1\n+  resolution: \"default-browser@npm:5.2.1\"\n+  dependencies:\n+    bundle-name: \"npm:^4.1.0\"\n+    default-browser-id: \"npm:^5.0.0\"\n+  checksum: 10c0/73f17dc3c58026c55bb5538749597db31f9561c0193cd98604144b704a981c95a466f8ecc3c2db63d8bfd04fb0d426904834cfc91ae510c6aeb97e13c5167c4d\n+  languageName: node\n+  linkType: hard\n+\n \"define-data-property@npm:^1.0.1, define-data-property@npm:^1.1.4\":\n   version: 1.1.4\n   resolution: \"define-data-property@npm:1.1.4\"\n@@ -5546,10 +5572,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"define-lazy-prop@npm:^2.0.0\":\n-  version: 2.0.0\n-  resolution: \"define-lazy-prop@npm:2.0.0\"\n-  checksum: 10c0/db6c63864a9d3b7dc9def55d52764968a5af296de87c1b2cc71d8be8142e445208071953649e0386a8cc37cfcf9a2067a47207f1eb9ff250c2a269658fdae422\n+\"define-lazy-prop@npm:^3.0.0\":\n+  version: 3.0.0\n+  resolution: \"define-lazy-prop@npm:3.0.0\"\n+  checksum: 10c0/5ab0b2bf3fa58b3a443140bbd4cd3db1f91b985cc8a246d330b9ac3fc0b6a325a6d82bddc0b055123d745b3f9931afeea74a5ec545439a1630b9c8512b0eeb49\n   languageName: node\n   linkType: hard\n \n@@ -7506,12 +7532,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-docker@npm:^2.0.0, is-docker@npm:^2.1.1\":\n-  version: 2.2.1\n-  resolution: \"is-docker@npm:2.2.1\"\n+\"is-docker@npm:^3.0.0\":\n+  version: 3.0.0\n+  resolution: \"is-docker@npm:3.0.0\"\n   bin:\n     is-docker: cli.js\n-  checksum: 10c0/e828365958d155f90c409cdbe958f64051d99e8aedc2c8c4cd7c89dcf35329daed42f7b99346f7828df013e27deb8f721cf9408ba878c76eb9e8290235fbcdcc\n+  checksum: 10c0/d2c4f8e6d3e34df75a5defd44991b6068afad4835bb783b902fa12d13ebdb8f41b2a199dcb0b5ed2cb78bfee9e4c0bbdb69c2d9646f4106464674d3e697a5856\n   languageName: node\n   linkType: hard\n \n@@ -7572,6 +7598,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"is-inside-container@npm:^1.0.0\":\n+  version: 1.0.0\n+  resolution: \"is-inside-container@npm:1.0.0\"\n+  dependencies:\n+    is-docker: \"npm:^3.0.0\"\n+  bin:\n+    is-inside-container: cli.js\n+  checksum: 10c0/a8efb0e84f6197e6ff5c64c52890fa9acb49b7b74fed4da7c95383965da6f0fa592b4dbd5e38a79f87fc108196937acdbcd758fcefc9b140e479b39ce1fcd1cd\n+  languageName: node\n+  linkType: hard\n+\n \"is-lambda@npm:^1.0.1\":\n   version: 1.0.1\n   resolution: \"is-lambda@npm:1.0.1\"\n@@ -7736,12 +7773,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"is-wsl@npm:^2.2.0\":\n-  version: 2.2.0\n-  resolution: \"is-wsl@npm:2.2.0\"\n+\"is-wsl@npm:^3.1.0\":\n+  version: 3.1.0\n+  resolution: \"is-wsl@npm:3.1.0\"\n   dependencies:\n-    is-docker: \"npm:^2.0.0\"\n-  checksum: 10c0/a6fa2d370d21be487c0165c7a440d567274fbba1a817f2f0bfa41cc5e3af25041d84267baa22df66696956038a43973e72fca117918c91431920bdef490fa25e\n+    is-inside-container: \"npm:^1.0.0\"\n+  checksum: 10c0/d3317c11995690a32c362100225e22ba793678fe8732660c6de511ae71a0ff05b06980cf21f98a6bf40d7be0e9e9506f859abe00a1118287d63e53d0a3d06947\n   languageName: node\n   linkType: hard\n \n@@ -8841,14 +8878,15 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"open@npm:^8.4.0\":\n-  version: 8.4.2\n-  resolution: \"open@npm:8.4.2\"\n+\"open@npm:^10.1.2\":\n+  version: 10.1.2\n+  resolution: \"open@npm:10.1.2\"\n   dependencies:\n-    define-lazy-prop: \"npm:^2.0.0\"\n-    is-docker: \"npm:^2.1.1\"\n-    is-wsl: \"npm:^2.2.0\"\n-  checksum: 10c0/bb6b3a58401dacdb0aad14360626faf3fb7fba4b77816b373495988b724fb48941cad80c1b65d62bb31a17609b2cd91c41a181602caea597ca80dfbcc27e84c9\n+    default-browser: \"npm:^5.2.1\"\n+    define-lazy-prop: \"npm:^3.0.0\"\n+    is-inside-container: \"npm:^1.0.0\"\n+    is-wsl: \"npm:^3.1.0\"\n+  checksum: 10c0/1bee796f06e549ce764f693272100323fbc04da8fa3c5b0402d6c2d11b3d76fa0aac0be7535e710015ff035326638e3b9a563f3b0e7ac3266473ed5663caae6d\n   languageName: node\n   linkType: hard\n \n@@ -10647,11 +10685,11 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"rollup-plugin-visualizer@npm:^5.14.0\":\n-  version: 5.14.0\n-  resolution: \"rollup-plugin-visualizer@npm:5.14.0\"\n+\"rollup-plugin-visualizer@npm:^6.0.0\":\n+  version: 6.0.0\n+  resolution: \"rollup-plugin-visualizer@npm:6.0.0\"\n   dependencies:\n-    open: \"npm:^8.4.0\"\n+    open: \"npm:^10.1.2\"\n     picomatch: \"npm:^4.0.2\"\n     source-map: \"npm:^0.7.4\"\n     yargs: \"npm:^17.5.1\"\n@@ -10665,7 +10703,7 @@ __metadata:\n       optional: true\n   bin:\n     rollup-plugin-visualizer: dist/bin/cli.js\n-  checksum: 10c0/ec6ca9ed125bce9994ba49a340bda730661d8e8dc5c5dc014dc757185182e1eda49c6708f990cb059095e71a3741a5248f1e6ba0ced7056020692888e06b1ddf\n+  checksum: 10c0/803b7a93692824c31c4eb6595367717591123dbdc6be3402403bba633bb81ccfdbd16827e852af9da03fd7e8211a974717492e4032d14897c37c130f0cb86222\n   languageName: node\n   linkType: hard\n \n@@ -10765,6 +10803,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"run-applescript@npm:^7.0.0\":\n+  version: 7.0.0\n+  resolution: \"run-applescript@npm:7.0.0\"\n+  checksum: 10c0/bd821bbf154b8e6c8ecffeaf0c33cebbb78eb2987476c3f6b420d67ab4c5301faa905dec99ded76ebb3a7042b4e440189ae6d85bbbd3fc6e8d493347ecda8bfe\n+  languageName: node\n+  linkType: hard\n+\n \"run-parallel@npm:^1.1.9\":\n   version: 1.2.0\n   resolution: \"run-parallel@npm:1.2.0\"\n---\n\n\n---\n\nChoice B:\n.rubocop/naming.yml\n@@ -1,3 +1,6 @@\n ---\n Naming/BlockForwarding:\n   EnforcedStyle: explicit\n+\n+Naming/PredicateMethod:\n+  Enabled: false\n---\n.rubocop_todo.yml\n@@ -1,6 +1,6 @@\n # This configuration was generated by\n # `rubocop --auto-gen-config --auto-gen-only-exclude --no-offense-counts --no-auto-gen-timestamp`\n-# using RuboCop version 1.75.8.\n+# using RuboCop version 1.76.0.\n # The point is for the user to remove these configuration records\n # one by one as the offenses are removed from the code base.\n # Note that changes in the inspected code, or installation of new\n---\nGemfile.lock\n@@ -751,18 +751,18 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.3)\n-    rubocop (1.75.8)\n+    rubocop (1.76.0)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n       parallel (~> 1.10)\n       parser (>= 3.3.0.2)\n       rainbow (>= 2.2.2, < 4.0)\n       regexp_parser (>= 2.9.3, < 3.0)\n-      rubocop-ast (>= 1.44.0, < 2.0)\n+      rubocop-ast (>= 1.45.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.1)\n+    rubocop-ast (1.45.0)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n---\napp/controllers/auth/registrations_controller.rb\n@@ -138,7 +138,7 @@ def require_rules_acceptance!\n     set_locale { render :rules }\n   end\n \n-  def is_flashing_format? # rubocop:disable Naming/PredicateName\n+  def is_flashing_format? # rubocop:disable Naming/PredicatePrefix\n     if params[:action] == 'create'\n       false # Disable flash messages for sign-up\n     else\n---\napp/models/concerns/attachmentable.rb\n@@ -22,7 +22,7 @@ module Attachmentable\n   ).freeze\n \n   included do\n-    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicateName\n+    def self.has_attached_file(name, options = {}) # rubocop:disable Naming/PredicatePrefix\n       super\n \n       send(:\"before_#{name}_validate\", prepend: true) do\n---\napp/models/user_settings/glue.rb\n@@ -17,7 +17,7 @@ def type_for_attribute(key)\n     self.class.definition_for(key)&.type\n   end\n \n-  def has_attribute?(key) # rubocop:disable Naming/PredicateName\n+  def has_attribute?(key) # rubocop:disable Naming/PredicatePrefix\n     self.class.definition_for?(key)\n   end\n end\n---\nconfig/initializers/1_hosts.rb\n@@ -21,7 +21,7 @@\n \n   config.x.streaming_api_base_url = ENV.fetch('STREAMING_API_BASE_URL') do\n     if Rails.env.production?\n-      \"ws#{https ? 's' : ''}://#{web_host}\"\n+      \"ws#{'s' if https}://#{web_host}\"\n     else\n       \"ws://#{host.split(':').first}:4000\"\n     end\n---\nconfig/initializers/content_security_policy.rb\n@@ -32,7 +32,7 @@\n \n   if Rails.env.development?\n     vite_public_host = ENV.fetch('VITE_DEV_SERVER_PUBLIC', \"localhost:#{ViteRuby.config.port}\")\n-    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{ViteRuby.config.https ? 's' : ''}://#{vite_public_host}\" }\n+    front_end_build_urls = %w(ws http).map { |protocol| \"#{protocol}#{'s' if ViteRuby.config.https}://#{vite_public_host}\" }\n \n     p.connect_src :self, :data, :blob, *media_hosts, Rails.configuration.x.streaming_api_base_url, *front_end_build_urls\n     p.script_src  :self, :unsafe_inline, :unsafe_eval, assets_host\n---\nlib/mastodon/migration_warning.rb\n@@ -23,7 +23,7 @@ def migration_duration_warning(explanation = nil)\n \n     def announce_countdown\n       WARNING_SECONDS.downto(1) do |i|\n-        say \"Continuing in #{i} second#{i == 1 ? '' : 's'}...\", true\n+        say \"Continuing in #{i} second#{'s' unless i == 1}...\", true\n         sleep 1\n       end\n     end\n---\nlib/mastodon/version.rb\n@@ -75,7 +75,7 @@ def source_commit\n     end\n \n     def user_agent\n-      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{Rails.configuration.x.use_https ? 's' : ''}://#{Rails.configuration.x.web_domain}/)\"\n+      @user_agent ||= \"Mastodon/#{Version} (#{HTTP::Request::USER_AGENT}; +http#{'s' if Rails.configuration.x.use_https}://#{Rails.configuration.x.web_domain}/)\"\n     end\n \n     def version_configuration\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/components/status.jsx\n@@ -403,14 +403,7 @@ class Status extends ImmutablePureComponent {\n     const connectReply = nextInReplyToId && nextInReplyToId === status.get('id');\n     const matchedFilters = status.get('matched_filters');\n \n-    if (featured) {\n-      prepend = (\n-        <div className='status__prepend'>\n-          <div className='status__prepend__icon'><Icon id='thumb-tack' icon={PushPinIcon} /></div>\n-          <FormattedMessage id='status.pinned' defaultMessage='Pinned post' />\n-        </div>\n-      );\n-    } else if (status.get('reblog', null) !== null && typeof status.get('reblog') === 'object') {\n+    if (status.get('reblog', null) !== null && typeof status.get('reblog') === 'object') {\n       const display_name_html = { __html: status.getIn(['account', 'display_name_html']) };\n \n       prepend = (\n---\napp/javascript/mastodon/locales/en.json\n@@ -168,7 +168,7 @@\n   \"column.lists\": \"Lists\",\n   \"column.mutes\": \"Muted users\",\n   \"column.notifications\": \"Notifications\",\n-  \"column.pins\": \"Pinned posts\",\n+  \"column.pins\": \"Featured posts\",\n   \"column.public\": \"Federated timeline\",\n   \"column_back_button.label\": \"Back\",\n   \"column_header.hide_settings\": \"Hide settings\",\n@@ -477,7 +477,7 @@\n   \"keyboard_shortcuts.my_profile\": \"Open your profile\",\n   \"keyboard_shortcuts.notifications\": \"Open notifications column\",\n   \"keyboard_shortcuts.open_media\": \"Open media\",\n-  \"keyboard_shortcuts.pinned\": \"Open pinned posts list\",\n+  \"keyboard_shortcuts.pinned\": \"Open featured posts list\",\n   \"keyboard_shortcuts.profile\": \"Open author's profile\",\n   \"keyboard_shortcuts.reply\": \"Reply to post\",\n   \"keyboard_shortcuts.requests\": \"Open follow requests list\",\n@@ -561,7 +561,7 @@\n   \"navigation_bar.mutes\": \"Muted users\",\n   \"navigation_bar.opened_in_classic_interface\": \"Posts, accounts, and other specific pages are opened by default in the classic web interface.\",\n   \"navigation_bar.personal\": \"Personal\",\n-  \"navigation_bar.pins\": \"Pinned posts\",\n+  \"navigation_bar.pins\": \"Featured posts\",\n   \"navigation_bar.preferences\": \"Preferences\",\n   \"navigation_bar.public_timeline\": \"Federated timeline\",\n   \"navigation_bar.search\": \"Search\",\n@@ -857,8 +857,7 @@\n   \"status.mute\": \"Mute @{name}\",\n   \"status.mute_conversation\": \"Mute conversation\",\n   \"status.open\": \"Expand this post\",\n-  \"status.pin\": \"Pin on profile\",\n-  \"status.pinned\": \"Pinned post\",\n+  \"status.pin\": \"Feature on profile\",\n   \"status.read_more\": \"Read more\",\n   \"status.reblog\": \"Boost\",\n   \"status.reblog_private\": \"Boost with original visibility\",\n@@ -883,7 +882,7 @@\n   \"status.translated_from_with\": \"Translated from {lang} using {provider}\",\n   \"status.uncached_media_warning\": \"Preview not available\",\n   \"status.unmute_conversation\": \"Unmute conversation\",\n-  \"status.unpin\": \"Unpin from profile\",\n+  \"status.unpin\": \"Don't feature on profile\",\n   \"subscribed_languages.lead\": \"Only posts in selected languages will appear on your home and list timelines after the change. Select none to receive posts in all languages.\",\n   \"subscribed_languages.save\": \"Save changes\",\n   \"subscribed_languages.target\": \"Change subscribed languages for {target}\",\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -5448,13 +5448,13 @@ __metadata:\n   linkType: hard\n \n \"axios@npm:^1.4.0\":\n-  version: 1.8.4\n-  resolution: \"axios@npm:1.8.4\"\n+  version: 1.9.0\n+  resolution: \"axios@npm:1.9.0\"\n   dependencies:\n     follow-redirects: \"npm:^1.15.6\"\n     form-data: \"npm:^4.0.0\"\n     proxy-from-env: \"npm:^1.1.0\"\n-  checksum: 10c0/450993c2ba975ffccaf0d480b68839a3b2435a5469a71fa2fb0b8a55cdb2c2ae47e609360b9c1e2b2534b73dfd69e2733a1cf9f8215bee0bcd729b72f801b0ce\n+  checksum: 10c0/9371a56886c2e43e4ff5647b5c2c3c046ed0a3d13482ef1d0135b994a628c41fbad459796f101c655e62f0c161d03883454474d2e435b2e021b1924d9f24994c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes MAS-406\n\n---\n\nChoice A:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.223.1', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1096.0)\n+    aws-sdk-core (3.223.0)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.223.1)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice B:\napp/models/media_attachment.rb\n@@ -122,6 +122,7 @@ class MediaAttachment < ApplicationRecord\n         output: {\n           'loglevel' => 'fatal',\n           'map_metadata' => '-1',\n+          'movflags' => 'faststart', # Move metadata to start of file so playback can begin before download finishes\n           'c:v' => 'copy',\n           'c:a' => 'copy',\n         }.freeze,\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -5448,13 +5448,13 @@ __metadata:\n   linkType: hard\n \n \"axios@npm:^1.4.0\":\n-  version: 1.8.4\n-  resolution: \"axios@npm:1.8.4\"\n+  version: 1.9.0\n+  resolution: \"axios@npm:1.9.0\"\n   dependencies:\n     follow-redirects: \"npm:^1.15.6\"\n     form-data: \"npm:^4.0.0\"\n     proxy-from-env: \"npm:^1.1.0\"\n-  checksum: 10c0/450993c2ba975ffccaf0d480b68839a3b2435a5469a71fa2fb0b8a55cdb2c2ae47e609360b9c1e2b2534b73dfd69e2733a1cf9f8215bee0bcd729b72f801b0ce\n+  checksum: 10c0/9371a56886c2e43e4ff5647b5c2c3c046ed0a3d13482ef1d0135b994a628c41fbad459796f101c655e62f0c161d03883454474d2e435b2e021b1924d9f24994c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/account_featured/components/featured_tag.tsx\n@@ -42,6 +42,7 @@ export const FeaturedTag: React.FC<FeaturedTagProps> = ({ tag, account }) => {\n               date: intl.formatDate(tag.get('last_status_at') ?? '', {\n                 month: 'short',\n                 day: '2-digit',\n+                year: 'numeric',\n               }),\n             })\n           : intl.formatMessage(messages.empty)\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nRequires #34489.\r\n\r\n![grafik](https://github.com/user-attachments/assets/8645c0b0-d5c8-47a2-bc1c-2030991a13e5)\r\n\r\n___\r\n\r\nFixes MAS-408\n\n---\n\nChoice A:\nlib/premailer_bundled_asset_strategy.rb\n@@ -15,7 +15,9 @@ def load(url)\n         headers\n       ).presence\n     else\n-      path = Rails.public_path.join(url.delete_prefix('/'))\n+      url = url.delete_prefix(Rails.configuration.action_controller.asset_host) if Rails.configuration.action_controller.asset_host.present?\n+      url = url.delete_prefix('/')\n+      path = Rails.public_path.join(url)\n       return unless path.exist?\n \n       path.read\n---\n\n\n---\n\nChoice B:\napp/lib/admin/system_check/elasticsearch_check.rb\n@@ -38,6 +38,11 @@ def message\n         :elasticsearch_index_mismatch,\n         mismatched_indexes.join(' ')\n       )\n+    elsif !specifications_match?\n+      Admin::SystemCheck::Message.new(\n+        :elasticsearch_analysis_mismatch,\n+        mismatched_specifications_indexes.join(' ')\n+      )\n     elsif cluster_health['status'] == 'red'\n       Admin::SystemCheck::Message.new(:elasticsearch_health_red)\n     elsif cluster_health['number_of_nodes'] < 2 && es_preset != 'single_node_cluster'\n@@ -111,10 +116,20 @@ def mismatched_indexes\n     end\n   end\n \n+  def mismatched_specifications_indexes\n+    @mismatched_specifications_indexes ||= INDEXES.filter_map do |klass|\n+      klass.base_name if klass.specification.changed?\n+    end\n+  end\n+\n   def indexes_match?\n     mismatched_indexes.empty?\n   end\n \n+  def specifications_match?\n+    mismatched_specifications_indexes.empty?\n+  end\n+\n   def es_preset\n     ENV.fetch('ES_PRESET', 'single_node_cluster')\n   end\n---\nconfig/locales/en.yml\n@@ -903,6 +903,8 @@ en:\n     system_checks:\n       database_schema_check:\n         message_html: There are pending database migrations. Please run them to ensure the application behaves as expected\n+      elasticsearch_analysis_index_mismatch:\n+        message_html: Elasticsearch index analyzer settings are outdated. Please run <code>tootctl search deploy --only-mapping --only=%{value}</code>\n       elasticsearch_health_red:\n         message_html: Elasticsearch cluster is unhealthy (red status), search features are unavailable\n       elasticsearch_health_yellow:\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/actions/tags_typed.ts\n@@ -1,4 +1,10 @@\n-import { apiGetTag, apiFollowTag, apiUnfollowTag } from 'mastodon/api/tags';\n+import {\n+  apiGetTag,\n+  apiFollowTag,\n+  apiUnfollowTag,\n+  apiFeatureTag,\n+  apiUnfeatureTag,\n+} from 'mastodon/api/tags';\n import { createDataLoadingThunk } from 'mastodon/store/typed_functions';\n \n export const fetchHashtag = createDataLoadingThunk(\n@@ -15,3 +21,13 @@ export const unfollowHashtag = createDataLoadingThunk(\n   'tags/unfollow',\n   ({ tagId }: { tagId: string }) => apiUnfollowTag(tagId),\n );\n+\n+export const featureHashtag = createDataLoadingThunk(\n+  'tags/feature',\n+  ({ tagId }: { tagId: string }) => apiFeatureTag(tagId),\n+);\n+\n+export const unfeatureHashtag = createDataLoadingThunk(\n+  'tags/unfeature',\n+  ({ tagId }: { tagId: string }) => apiUnfeatureTag(tagId),\n+);\n---\napp/javascript/mastodon/api/tags.ts\n@@ -10,6 +10,12 @@ export const apiFollowTag = (tagId: string) =>\n export const apiUnfollowTag = (tagId: string) =>\n   apiRequestPost<ApiHashtagJSON>(`v1/tags/${tagId}/unfollow`);\n \n+export const apiFeatureTag = (tagId: string) =>\n+  apiRequestPost<ApiHashtagJSON>(`v1/tags/${tagId}/feature`);\n+\n+export const apiUnfeatureTag = (tagId: string) =>\n+  apiRequestPost<ApiHashtagJSON>(`v1/tags/${tagId}/unfeature`);\n+\n export const apiGetFollowedTags = async (url?: string) => {\n   const response = await api().request<ApiHashtagJSON[]>({\n     method: 'GET',\n---\napp/javascript/mastodon/api_types/tags.ts\n@@ -10,4 +10,5 @@ export interface ApiHashtagJSON {\n   url: string;\n   history: [ApiHistoryJSON, ...ApiHistoryJSON[]];\n   following?: boolean;\n+  featuring?: boolean;\n }\n---\napp/javascript/mastodon/features/hashtag_timeline/components/hashtag_header.tsx\n@@ -9,6 +9,8 @@ import {\n   fetchHashtag,\n   followHashtag,\n   unfollowHashtag,\n+  featureHashtag,\n+  unfeatureHashtag,\n } from 'mastodon/actions/tags_typed';\n import type { ApiHashtagJSON } from 'mastodon/api_types/tags';\n import { Button } from 'mastodon/components/button';\n@@ -28,6 +30,11 @@ const messages = defineMessages({\n     id: 'hashtag.admin_moderation',\n     defaultMessage: 'Open moderation interface for #{name}',\n   },\n+  feature: { id: 'hashtag.feature', defaultMessage: 'Feature on profile' },\n+  unfeature: {\n+    id: 'hashtag.unfeature',\n+    defaultMessage: \"Don't feature on profile\",\n+  },\n });\n \n const usesRenderer = (displayNumber: React.ReactNode, pluralReady: number) => (\n@@ -88,22 +95,51 @@ export const HashtagHeader: React.FC<{\n   }, [dispatch, tagId, setTag]);\n \n   const menu = useMemo(() => {\n-    const tmp = [];\n+    const arr = [];\n+\n+    if (tag && signedIn) {\n+      const handleFeature = () => {\n+        if (tag.featuring) {\n+          void dispatch(unfeatureHashtag({ tagId })).then((result) => {\n+            if (isFulfilled(result)) {\n+              setTag(result.payload);\n+            }\n+\n+            return '';\n+          });\n+        } else {\n+          void dispatch(featureHashtag({ tagId })).then((result) => {\n+            if (isFulfilled(result)) {\n+              setTag(result.payload);\n+            }\n+\n+            return '';\n+          });\n+        }\n+      };\n \n-    if (\n-      tag &&\n-      signedIn &&\n-      (permissions & PERMISSION_MANAGE_TAXONOMIES) ===\n-        PERMISSION_MANAGE_TAXONOMIES\n-    ) {\n-      tmp.push({\n-        text: intl.formatMessage(messages.adminModeration, { name: tag.id }),\n-        href: `/admin/tags/${tag.id}`,\n+      arr.push({\n+        text: intl.formatMessage(\n+          tag.featuring ? messages.unfeature : messages.feature,\n+        ),\n+        action: handleFeature,\n       });\n+\n+      arr.push(null);\n+\n+      if (\n+        (permissions & PERMISSION_MANAGE_TAXONOMIES) ===\n+        PERMISSION_MANAGE_TAXONOMIES\n+      ) {\n+        arr.push({\n+          text: intl.formatMessage(messages.adminModeration, { name: tagId }),\n+          href: `/admin/tags/${tag.id}`,\n+        });\n+      }\n     }\n \n-    return tmp;\n-  }, [signedIn, permissions, intl, tag]);\n+    return arr;\n+  }, [setTag, dispatch, tagId, signedIn, permissions, intl, tag]);\n \n   const handleFollow = useCallback(() => {\n     if (!signedIn || !tag) {\n---\napp/javascript/mastodon/locales/en.json\n@@ -401,8 +401,10 @@\n   \"hashtag.counter_by_accounts\": \"{count, plural, one {{counter} participant} other {{counter} participants}}\",\n   \"hashtag.counter_by_uses\": \"{count, plural, one {{counter} post} other {{counter} posts}}\",\n   \"hashtag.counter_by_uses_today\": \"{count, plural, one {{counter} post} other {{counter} posts}} today\",\n+  \"hashtag.feature\": \"Feature on profile\",\n   \"hashtag.follow\": \"Follow hashtag\",\n   \"hashtag.mute\": \"Mute #{hashtag}\",\n+  \"hashtag.unfeature\": \"Don't feature on profile\",\n   \"hashtag.unfollow\": \"Unfollow hashtag\",\n   \"hashtags.and_other\": \"\u2026and {count, plural, other {# more}}\",\n   \"hints.profiles.followers_may_be_missing\": \"Followers for this profile may be missing.\",\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.222.3', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1088.0)\n+    aws-sdk-core (3.222.2)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -931,7 +933,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.222.3)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFixes MAS-409, fixes #34473\n\n---\n\nChoice A:\napp/javascript/mastodon/actions/accounts_typed.ts\n@@ -1,7 +1,9 @@\n import { createAction } from '@reduxjs/toolkit';\n \n+import { apiRemoveAccountFromFollowers } from 'mastodon/api/accounts';\n import type { ApiAccountJSON } from 'mastodon/api_types/accounts';\n import type { ApiRelationshipJSON } from 'mastodon/api_types/relationships';\n+import { createDataLoadingThunk } from 'mastodon/store/typed_functions';\n \n export const revealAccount = createAction<{\n   id: string;\n@@ -95,3 +97,10 @@ export const fetchRelationshipsSuccess = createAction(\n   'relationships/fetch/SUCCESS',\n   actionWithSkipLoadingTrue<{ relationships: ApiRelationshipJSON[] }>,\n );\n+\n+export const removeAccountFromFollowers = createDataLoadingThunk(\n+  'accounts/remove_from_followers',\n+  ({ accountId }: { accountId: string }) =>\n+    apiRemoveAccountFromFollowers(accountId),\n+  (relationship) => ({ relationship }),\n+);\n---\napp/javascript/mastodon/api/accounts.ts\n@@ -18,3 +18,8 @@ export const apiFollowAccount = (\n \n export const apiUnfollowAccount = (id: string) =>\n   apiRequestPost<ApiRelationshipJSON>(`v1/accounts/${id}/unfollow`);\n+\n+export const apiRemoveAccountFromFollowers = (id: string) =>\n+  apiRequestPost<ApiRelationshipJSON>(\n+    `v1/accounts/${id}/remove_from_followers`,\n+  );\n---\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -18,6 +18,7 @@ import {\n   unmuteAccount,\n   pinAccount,\n   unpinAccount,\n+  removeAccountFromFollowers,\n } from 'mastodon/actions/accounts';\n import { initBlockModal } from 'mastodon/actions/blocks';\n import { mentionCompose, directCompose } from 'mastodon/actions/compose';\n@@ -152,6 +153,23 @@ const messages = defineMessages({\n     id: 'account.open_original_page',\n     defaultMessage: 'Open original page',\n   },\n+  removeFromFollowers: {\n+    id: 'account.remove_from_followers',\n+    defaultMessage: 'Remove {name} from followers',\n+  },\n+  confirmRemoveFromFollowersTitle: {\n+    id: 'confirmations.remove_from_followers.title',\n+    defaultMessage: 'Remove follower?',\n+  },\n+  confirmRemoveFromFollowersMessage: {\n+    id: 'confirmations.remove_from_followers.message',\n+    defaultMessage:\n+      '{name} will stop following you. Are you sure you want to proceed?',\n+  },\n+  confirmRemoveFromFollowersButton: {\n+    id: 'confirmations.remove_from_followers.confirm',\n+    defaultMessage: 'Remove follower',\n+  },\n });\n \n const titleFromAccount = (account: Account) => {\n@@ -494,6 +512,39 @@ export const AccountHeader: React.FC<{\n         arr.push(null);\n       }\n \n+      if (relationship?.followed_by) {\n+        const handleRemoveFromFollowers = () => {\n+          dispatch(\n+            openModal({\n+              modalType: 'CONFIRM',\n+              modalProps: {\n+                title: intl.formatMessage(\n+                  messages.confirmRemoveFromFollowersTitle,\n+                ),\n+                message: intl.formatMessage(\n+                  messages.confirmRemoveFromFollowersMessage,\n+                  { name: <strong>{account.acct}</strong> },\n+                ),\n+                confirm: intl.formatMessage(\n+                  messages.confirmRemoveFromFollowersButton,\n+                ),\n+                onConfirm: () => {\n+                  void dispatch(removeAccountFromFollowers({ accountId }));\n+                },\n+              },\n+            }),\n+          );\n+        };\n+\n+        arr.push({\n+          text: intl.formatMessage(messages.removeFromFollowers, {\n+            name: account.username,\n+          }),\n+          action: handleRemoveFromFollowers,\n+          dangerous: true,\n+        });\n+      }\n+\n       if (relationship?.muting) {\n         arr.push({\n           text: intl.formatMessage(messages.unmute, {\n@@ -592,6 +643,8 @@ export const AccountHeader: React.FC<{\n \n     return arr;\n   }, [\n+    dispatch,\n+    accountId,\n     account,\n     relationship,\n     permissions,\n---\napp/javascript/mastodon/locales/en.json\n@@ -62,6 +62,7 @@\n   \"account.open_original_page\": \"Open original page\",\n   \"account.posts\": \"Posts\",\n   \"account.posts_with_replies\": \"Posts and replies\",\n+  \"account.remove_from_followers\": \"Remove {name} from followers\",\n   \"account.report\": \"Report @{name}\",\n   \"account.requested\": \"Awaiting approval. Click to cancel follow request\",\n   \"account.requested_follow\": \"{name} has requested to follow you\",\n@@ -233,6 +234,9 @@\n   \"confirmations.redraft.confirm\": \"Delete & redraft\",\n   \"confirmations.redraft.message\": \"Are you sure you want to delete this post and re-draft it? Favorites and boosts will be lost, and replies to the original post will be orphaned.\",\n   \"confirmations.redraft.title\": \"Delete & redraft post?\",\n+  \"confirmations.remove_from_followers.confirm\": \"Remove follower\",\n+  \"confirmations.remove_from_followers.message\": \"{name} will stop following you. Are you sure you want to proceed?\",\n+  \"confirmations.remove_from_followers.title\": \"Remove follower?\",\n   \"confirmations.reply.confirm\": \"Reply\",\n   \"confirmations.reply.message\": \"Replying now will overwrite the message you are currently composing. Are you sure you want to proceed?\",\n   \"confirmations.reply.title\": \"Overwrite post?\",\n---\napp/javascript/mastodon/reducers/relationships.ts\n@@ -24,6 +24,7 @@ import {\n   pinAccountSuccess,\n   unpinAccountSuccess,\n   fetchRelationshipsSuccess,\n+  removeAccountFromFollowers,\n } from '../actions/accounts_typed';\n import {\n   blockDomainSuccess,\n@@ -109,7 +110,8 @@ export const relationshipsReducer: Reducer<State> = (\n     unmuteAccountSuccess.match(action) ||\n     pinAccountSuccess.match(action) ||\n     unpinAccountSuccess.match(action) ||\n-    isFulfilled(submitAccountNote)(action)\n+    isFulfilled(submitAccountNote)(action) ||\n+    isFulfilled(removeAccountFromFollowers)(action)\n   )\n     return normalizeRelationship(state, action.payload.relationship);\n   else if (fetchRelationshipsSuccess.match(action))\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -160,7 +160,7 @@ GEM\n     cocoon (1.2.15)\n     color_diff (0.1)\n     concurrent-ruby (1.3.5)\n-    connection_pool (2.5.2)\n+    connection_pool (2.5.3)\n     cose (1.3.1)\n       cbor (~> 0.5.9)\n       openssl-signature_algorithm (~> 1.0)\n---\n\n\n---\n\nChoice C:\napp/lib/activitypub/parser/status_parser.rb\n@@ -95,11 +95,11 @@ def language\n   end\n \n   def favourites_count\n-    @object.dig(:likes, :totalItems)\n+    @object.dig('likes', 'totalItems')\n   end\n \n   def reblogs_count\n-    @object.dig(:shares, :totalItems)\n+    @object.dig('shares', 'totalItems')\n   end\n \n   def quote_policy\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -64,7 +64,7 @@ gem 'kaminari', '~> 1.2'\n gem 'link_header', '~> 0.0'\n gem 'linzer', '~> 0.6.1'\n gem 'mario-redis-lock', '~> 1.2', require: 'redis_lock'\n-gem 'mime-types', '~> 3.6.0', require: 'mime/types/columnar'\n+gem 'mime-types', '~> 3.7.0', require: 'mime/types/columnar'\n gem 'mutex_m'\n gem 'nokogiri', '~> 1.15'\n gem 'oj', '~> 3.14'\n---\nGemfile.lock\n@@ -423,10 +423,10 @@ GEM\n       redis (>= 3.0.5)\n     matrix (0.4.2)\n     memory_profiler (1.1.0)\n-    mime-types (3.6.2)\n+    mime-types (3.7.0)\n       logger\n-      mime-types-data (~> 3.2015)\n-    mime-types-data (3.2025.0408)\n+      mime-types-data (~> 3.2025, >= 3.2025.0507)\n+    mime-types-data (3.2025.0507)\n     mini_mime (1.1.5)\n     mini_portile2 (2.8.8)\n     minitest (5.25.5)\n@@ -996,7 +996,7 @@ DEPENDENCIES\n   mail (~> 2.8)\n   mario-redis-lock (~> 1.2)\n   memory_profiler\n-  mime-types (~> 3.6.0)\n+  mime-types (~> 3.7.0)\n   mutex_m\n   net-http (~> 0.6.0)\n   net-ldap (~> 0.18)\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nPart of #34463.\r\n\r\n![Screenshot 2025-04-17 at 11 20 40](https://github.com/user-attachments/assets/8448c65d-e439-48c3-baab-0ee089ee1c64)\r\n![Screenshot 2025-04-17 at 11 23 00](https://github.com/user-attachments/assets/80651f2d-5650-4bfa-889a-acb5c7cae36e)\r\n\n\n---\n\nChoice A:\n.rubocop_todo.yml\n@@ -33,7 +33,6 @@ Style/FetchEnvVar:\n   Exclude:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/paperclip.rb'\n-    - 'lib/tasks/repo.rake'\n \n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: MinBodyLength, AllowConsecutiveConditionals.\n---\nlib/tasks/repo.rake\n@@ -57,7 +57,7 @@ namespace :repo do\n                 response = nil\n \n                 loop do\n-                  response = HTTP.headers('Authorization' => \"token #{ENV['GITHUB_API_TOKEN']}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n+                  response = HTTP.headers('Authorization' => \"token #{ENV.fetch('GITHUB_API_TOKEN')}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n \n                   if response.code == 403\n                     sleep_for = (response.headers['X-RateLimit-Reset'].to_i - Time.now.to_i).abs\n---\n\n\n---\n\nChoice B:\napp/lib/entity_cache.rb\n@@ -26,7 +26,9 @@ def emoji(shortcodes, domain)\n       uncached_ids << shortcode unless cached.key?(to_key(:emoji, shortcode, domain))\n     end\n \n-    unless uncached_ids.empty?\n+    if uncached_ids.empty?\n+      uncached = {}\n+    else\n       uncached = CustomEmoji.enabled.where(shortcode: shortcodes, domain: domain).index_by(&:shortcode)\n       uncached.each_value { |item| Rails.cache.write(to_key(:emoji, item.shortcode, domain), item, expires_in: MAX_EXPIRATION) }\n     end\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -52,6 +52,7 @@ gem 'faraday-httpclient'\n gem 'fast_blank', '~> 1.0'\n gem 'fastimage'\n gem 'hiredis', '~> 0.6'\n+gem 'hiredis-client'\n gem 'htmlentities', '~> 4.3'\n gem 'http', '~> 5.2.0'\n gem 'http_accept_language', '~> 2.1'\n@@ -82,10 +83,10 @@ gem 'rqrcode', '~> 3.0'\n gem 'ruby-progressbar', '~> 1.13'\n gem 'sanitize', '~> 7.0'\n gem 'scenic', '~> 1.7'\n-gem 'sidekiq', '~> 6.5'\n+gem 'sidekiq', '< 8'\n gem 'sidekiq-bulk', '~> 0.2.0'\n gem 'sidekiq-scheduler', '~> 5.0'\n-gem 'sidekiq-unique-jobs', '~> 7.1'\n+gem 'sidekiq-unique-jobs', '> 8'\n gem 'simple_form', '~> 5.2'\n gem 'simple-navigation', '~> 4.4'\n gem 'stoplight', '~> 4.1'\n---\nGemfile.lock\n@@ -129,9 +129,6 @@ GEM\n     brakeman (7.0.2)\n       racc\n     browser (6.2.0)\n-    brpoplpush-redis_script (0.1.3)\n-      concurrent-ruby (~> 1.0, >= 1.0.5)\n-      redis (>= 1.0, < 6)\n     builder (3.3.0)\n     bundler-audit (0.9.2)\n       bundler (>= 1.2.0, < 3)\n@@ -294,6 +291,8 @@ GEM\n     highline (3.1.2)\n       reline\n     hiredis (0.6.3)\n+    hiredis-client (0.24.0)\n+      redis-client (= 0.24.0)\n     hkdf (0.3.0)\n     htmlentities (4.3.4)\n     http (5.2.0)\n@@ -696,6 +695,8 @@ GEM\n       psych (>= 4.0.0)\n     redcarpet (3.6.1)\n     redis (4.8.1)\n+    redis-client (0.24.0)\n+      connection_pool\n     redlock (1.3.2)\n       redis (>= 3.0.0, < 6.0)\n     regexp_parser (2.10.0)\n@@ -808,22 +809,22 @@ GEM\n       websocket (~> 1.0)\n     shoulda-matchers (6.5.0)\n       activesupport (>= 5.2.0)\n-    sidekiq (6.5.12)\n-      connection_pool (>= 2.2.5, < 3)\n-      rack (~> 2.0)\n-      redis (>= 4.5.0, < 5)\n+    sidekiq (7.3.9)\n+      base64\n+      connection_pool (>= 2.3.0)\n+      logger\n+      rack (>= 2.2.4)\n+      redis-client (>= 0.22.2)\n     sidekiq-bulk (0.2.0)\n       sidekiq\n     sidekiq-scheduler (5.0.6)\n       rufus-scheduler (~> 3.2)\n       sidekiq (>= 6, < 8)\n       tilt (>= 1.4.0, < 3)\n-    sidekiq-unique-jobs (7.1.33)\n-      brpoplpush-redis_script (> 0.1.1, <= 2.0.0)\n+    sidekiq-unique-jobs (8.0.10)\n       concurrent-ruby (~> 1.0, >= 1.0.5)\n-      redis (< 5.0)\n-      sidekiq (>= 5.0, < 7.0)\n-      thor (>= 0.20, < 3.0)\n+      sidekiq (>= 7.0.0, < 8.0.0)\n+      thor (>= 1.0, < 3.0)\n     simple-navigation (4.4.0)\n       activesupport (>= 2.3.2)\n     simple_form (5.3.1)\n@@ -976,6 +977,7 @@ DEPENDENCIES\n   haml_lint\n   hcaptcha (~> 7.1)\n   hiredis (~> 0.6)\n+  hiredis-client\n   htmlentities (~> 4.3)\n   http (~> 5.2.0)\n   http_accept_language (~> 2.1)\n@@ -1064,10 +1066,10 @@ DEPENDENCIES\n   scenic (~> 1.7)\n   selenium-webdriver\n   shoulda-matchers\n-  sidekiq (~> 6.5)\n+  sidekiq (< 8)\n   sidekiq-bulk (~> 0.2.0)\n   sidekiq-scheduler (~> 5.0)\n-  sidekiq-unique-jobs (~> 7.1)\n+  sidekiq-unique-jobs (> 8)\n   simple-navigation (~> 4.4)\n   simple_form (~> 5.2)\n   simplecov (~> 0.22)\n---\napp/lib/redis_connection.rb\n@@ -15,7 +15,7 @@ def pool\n \n     def pool_size\n       if Sidekiq.server?\n-        Sidekiq[:concurrency]\n+        Sidekiq.default_configuration[:concurrency]\n       else\n         ENV['MAX_THREADS'] || 5\n       end\n---\napp/workers/scheduler/self_destruct_scheduler.rb\n@@ -20,7 +20,7 @@ def perform\n   private\n \n   def sidekiq_overwhelmed?\n-    redis_mem_info = Sidekiq.redis_info\n+    redis_mem_info = Sidekiq.default_configuration.redis_info\n \n     Sidekiq::Stats.new.enqueued > MAX_ENQUEUED || redis_mem_info['used_memory'].to_f > redis_mem_info['total_system_memory'].to_f * MAX_REDIS_MEM_USAGE\n   end\n---\nconfig/database.yml\n@@ -1,6 +1,6 @@\n default: &default\n   adapter: postgresql\n-  pool: <%= ENV[\"DB_POOL\"] || (if Sidekiq.server? then Sidekiq[:concurrency] else ENV['MAX_THREADS'] end) || 5 %>\n+  pool: <%= ENV[\"DB_POOL\"] || (if Sidekiq.server? then Sidekiq.default_configuration[:concurrency] else ENV['MAX_THREADS'] end) || 5 %>\n   timeout: 5000\n   connect_timeout: 15\n   encoding: unicode\n---\nconfig/initializers/sidekiq.rb\n@@ -89,6 +89,8 @@\n     end\n   end\n \n+  config.logger.level = Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+\n   SidekiqUniqueJobs::Server.configure(config)\n end\n \n@@ -98,9 +100,9 @@\n   config.client_middleware do |chain|\n     chain.add SidekiqUniqueJobs::Middleware::Client\n   end\n-end\n \n-Sidekiq.logger.level = ::Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+  config.logger.level = Logger.const_get(ENV.fetch('RAILS_LOG_LEVEL', 'info').upcase.to_s)\n+end\n \n SidekiqUniqueJobs.configure do |config|\n   config.enabled         = !Rails.env.test?\n---\nlib/mastodon/redis_configuration.rb\n@@ -9,7 +9,6 @@ class Mastodon::RedisConfiguration\n \n   def base\n     @base ||= setup_config(prefix: nil, defaults: DEFAULTS)\n-              .merge(namespace: nil)\n   end\n \n   def sidekiq\n@@ -23,7 +22,7 @@ def cache\n                  expires_in: 10.minutes,\n                  connect_timeout: 5,\n                  pool: {\n-                   size: Sidekiq.server? ? Sidekiq[:concurrency] : Integer(ENV['MAX_THREADS'] || 5),\n+                   size: Sidekiq.server? ? Sidekiq.default_configuration[:concurrency] : Integer(ENV['MAX_THREADS'] || 5),\n                    timeout: 5,\n                  },\n                })\n---\nspec/lib/mastodon/redis_configuration_spec.rb\n@@ -156,7 +156,6 @@\n         expect(subject).to eq({\n           url: 'redis://localhost:6379/0',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n@@ -172,7 +171,6 @@\n         expect(subject).to eq({\n           url: 'redis::/user@example.com/2',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n@@ -188,7 +186,6 @@\n         expect(subject).to eq({\n           url: 'redis://:testpass@redis.example.com:3333/3',\n           driver: :hiredis,\n-          namespace: nil,\n         })\n       end\n     end\n---\nspec/rails_helper.rb\n@@ -53,7 +53,7 @@\n   allow_localhost: true,\n   allow: Chewy.settings[:host]\n )\n-Sidekiq.logger = nil\n+Sidekiq.default_configuration.logger = nil\n \n DatabaseCleaner.strategy = [:deletion]\n \n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/account_featured/components/empty_message.tsx\n@@ -1,6 +1,9 @@\n import { FormattedMessage } from 'react-intl';\n \n+import { useParams } from 'react-router';\n+\n import { LimitedAccountHint } from 'mastodon/features/account_timeline/components/limited_account_hint';\n+import { me } from 'mastodon/initial_state';\n \n interface EmptyMessageProps {\n   suspended: boolean;\n@@ -15,13 +18,21 @@ export const EmptyMessage: React.FC<EmptyMessageProps> = ({\n   hidden,\n   blockedBy,\n }) => {\n+  const { acct } = useParams<{ acct?: string }>();\n   if (!accountId) {\n     return null;\n   }\n \n   let message: React.ReactNode = null;\n \n-  if (suspended) {\n+  if (me === accountId) {\n+    message = (\n+      <FormattedMessage\n+        id='empty_column.account_featured.me'\n+        defaultMessage='You have not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?'\n+      />\n+    );\n+  } else if (suspended) {\n     message = (\n       <FormattedMessage\n         id='empty_column.account_suspended'\n@@ -37,11 +48,19 @@ export const EmptyMessage: React.FC<EmptyMessageProps> = ({\n         defaultMessage='Profile unavailable'\n       />\n     );\n+  } else if (acct) {\n+    message = (\n+      <FormattedMessage\n+        id='empty_column.account_featured.other'\n+        defaultMessage='{acct} has not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?'\n+        values={{ acct }}\n+      />\n+    );\n   } else {\n     message = (\n       <FormattedMessage\n-        id='empty_column.account_featured'\n-        defaultMessage='This list is empty'\n+        id='empty_column.account_featured_other.unknown'\n+        defaultMessage='This account has not featured anything yet.'\n       />\n     );\n   }\n---\napp/javascript/mastodon/locales/en.json\n@@ -300,7 +300,9 @@\n   \"emoji_button.search_results\": \"Search results\",\n   \"emoji_button.symbols\": \"Symbols\",\n   \"emoji_button.travel\": \"Travel & Places\",\n-  \"empty_column.account_featured\": \"This list is empty\",\n+  \"empty_column.account_featured.me\": \"You have not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?\",\n+  \"empty_column.account_featured.other\": \"{acct} has not featured anything yet. Did you know that you can feature your posts, hashtags you use the most, and even your friend\u2019s accounts on your profile?\",\n+  \"empty_column.account_featured_other.unknown\": \"This account has not featured anything yet.\",\n   \"empty_column.account_hides_collections\": \"This user has chosen to not make this information available\",\n   \"empty_column.account_suspended\": \"Account suspended\",\n   \"empty_column.account_timeline\": \"No posts here!\",\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThe last FEP update introduced an inconsistency, but the aim was to move everything new to the FEP namespace, as will be done by the pending PR: https://codeberg.org/fediverse/fep/pulls/559\n\n---\n\nChoice A:\napp/javascript/mastodon/features/account_featured/components/featured_tag.tsx\n@@ -42,6 +42,7 @@ export const FeaturedTag: React.FC<FeaturedTagProps> = ({ tag, account }) => {\n               date: intl.formatDate(tag.get('last_status_at') ?? '', {\n                 month: 'short',\n                 day: '2-digit',\n+                year: 'numeric',\n               }),\n             })\n           : intl.formatMessage(messages.empty)\n---\n\n\n---\n\nChoice B:\npackage.json\n@@ -107,7 +107,7 @@\n     \"react-overlays\": \"^5.2.1\",\n     \"react-redux\": \"^9.0.4\",\n     \"react-redux-loading-bar\": \"^5.0.8\",\n-    \"react-router\": \"^5.3.4\",\n+    \"react-router\": \"^7.0.0\",\n     \"react-router-dom\": \"^5.3.4\",\n     \"react-router-scroll-4\": \"^1.0.0-beta.1\",\n     \"react-select\": \"^5.7.3\",\n---\nyarn.lock\n@@ -2936,7 +2936,7 @@ __metadata:\n     react-overlays: \"npm:^5.2.1\"\n     react-redux: \"npm:^9.0.4\"\n     react-redux-loading-bar: \"npm:^5.0.8\"\n-    react-router: \"npm:^5.3.4\"\n+    react-router: \"npm:^7.0.0\"\n     react-router-dom: \"npm:^5.3.4\"\n     react-router-scroll-4: \"npm:^1.0.0-beta.1\"\n     react-select: \"npm:^5.7.3\"\n@@ -6662,6 +6662,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"cookie@npm:^1.0.1\":\n+  version: 1.0.2\n+  resolution: \"cookie@npm:1.0.2\"\n+  checksum: 10c0/fd25fe79e8fbcfcaf6aa61cd081c55d144eeeba755206c058682257cb38c4bd6795c6620de3f064c740695bb65b7949ebb1db7a95e4636efb8357a335ad3f54b\n+  languageName: node\n+  linkType: hard\n+\n \"copy-descriptor@npm:^0.1.0\":\n   version: 0.1.1\n   resolution: \"copy-descriptor@npm:0.1.1\"\n@@ -14929,7 +14936,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"react-router@npm:5.3.4, react-router@npm:^5.3.4\":\n+\"react-router@npm:5.3.4\":\n   version: 5.3.4\n   resolution: \"react-router@npm:5.3.4\"\n   dependencies:\n@@ -14948,6 +14955,23 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"react-router@npm:^7.0.0\":\n+  version: 7.5.2\n+  resolution: \"react-router@npm:7.5.2\"\n+  dependencies:\n+    cookie: \"npm:^1.0.1\"\n+    set-cookie-parser: \"npm:^2.6.0\"\n+    turbo-stream: \"npm:2.4.0\"\n+  peerDependencies:\n+    react: \">=18\"\n+    react-dom: \">=18\"\n+  peerDependenciesMeta:\n+    react-dom:\n+      optional: true\n+  checksum: 10c0/5972ecb783e0ac0512c500b84bd4ff475665ba49c67b69e13b79dc24c7ee0496d523858058bb43c70147367688e0cc0d6d6d0f51cabfdebfbc5556d559bff457\n+  languageName: node\n+  linkType: hard\n+\n \"react-select@npm:^5.7.3\":\n   version: 5.10.1\n   resolution: \"react-select@npm:5.10.1\"\n@@ -15944,6 +15968,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"set-cookie-parser@npm:^2.6.0\":\n+  version: 2.7.1\n+  resolution: \"set-cookie-parser@npm:2.7.1\"\n+  checksum: 10c0/060c198c4c92547ac15988256f445eae523f57f2ceefeccf52d30d75dedf6bff22b9c26f756bd44e8e560d44ff4ab2130b178bd2e52ef5571bf7be3bd7632d9a\n+  languageName: node\n+  linkType: hard\n+\n \"set-function-length@npm:^1.2.2\":\n   version: 1.2.2\n   resolution: \"set-function-length@npm:1.2.2\"\n@@ -17530,6 +17561,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n+\"turbo-stream@npm:2.4.0\":\n+  version: 2.4.0\n+  resolution: \"turbo-stream@npm:2.4.0\"\n+  checksum: 10c0/e68b2569f1f16e6e9633d090c6024b2ae9f0e97bfeacb572451ca3732e120ebbb546f3bc4afc717c46cb57b5aea6104e04ef497f9912eef6a7641e809518e98a\n+  languageName: node\n+  linkType: hard\n+\n \"twemoji-parser@npm:^11.0.2\":\n   version: 11.0.2\n   resolution: \"twemoji-parser@npm:11.0.2\"\n---\n\n\n---\n\nChoice C:\nspec/lib/activitypub/activity/create_spec.rb\n@@ -958,8 +958,7 @@ def activity_for_object(json)\n             '@context': [\n               'https://www.w3.org/ns/activitystreams',\n               {\n-                toot: 'http://joinmastodon.org/ns#',\n-                QuoteAuthorization: 'toot:QuoteAuthorization',\n+                QuoteAuthorization: 'https://w3id.org/fep/044f#QuoteAuthorization',\n                 gts: 'https://gotosocial.org/ns#',\n                 interactionPolicy: {\n                   '@id': 'gts:interactionPolicy',\n---\nspec/services/activitypub/process_status_update_service_spec.rb\n@@ -469,8 +469,7 @@\n         '@context': [\n           'https://www.w3.org/ns/activitystreams',\n           {\n-            toot: 'http://joinmastodon.org/ns#',\n-            QuoteAuthorization: 'toot:QuoteAuthorization',\n+            QuoteAuthorization: 'https://w3id.org/fep/044f#QuoteAuthorization',\n             gts: 'https://gotosocial.org/ns#',\n             interactionPolicy: {\n               '@id': 'gts:interactionPolicy',\n@@ -569,8 +568,7 @@\n         '@context': [\n           'https://www.w3.org/ns/activitystreams',\n           {\n-            toot: 'http://joinmastodon.org/ns#',\n-            QuoteAuthorization: 'toot:QuoteAuthorization',\n+            QuoteAuthorization: 'https://w3id.org/fep/044f#QuoteAuthorization',\n             gts: 'https://gotosocial.org/ns#',\n             interactionPolicy: {\n               '@id': 'gts:interactionPolicy',\n@@ -721,8 +719,7 @@\n         '@context': [\n           'https://www.w3.org/ns/activitystreams',\n           {\n-            toot: 'http://joinmastodon.org/ns#',\n-            QuoteAuthorization: 'toot:QuoteAuthorization',\n+            QuoteAuthorization: 'https://w3id.org/fep/044f#QuoteAuthorization',\n             gts: 'https://gotosocial.org/ns#',\n             interactionPolicy: {\n               '@id': 'gts:interactionPolicy',\n@@ -792,8 +789,7 @@\n         '@context': [\n           'https://www.w3.org/ns/activitystreams',\n           {\n-            toot: 'http://joinmastodon.org/ns#',\n-            QuoteAuthorization: 'toot:QuoteAuthorization',\n+            QuoteAuthorization: 'https://w3id.org/fep/044f#QuoteAuthorization',\n             gts: 'https://gotosocial.org/ns#',\n             interactionPolicy: {\n               '@id': 'gts:interactionPolicy',\n---\nspec/services/activitypub/verify_quote_service_spec.rb\n@@ -50,8 +50,7 @@\n         '@context': [\n           'https://www.w3.org/ns/activitystreams',\n           {\n-            toot: 'http://joinmastodon.org/ns#',\n-            QuoteAuthorization: 'toot:QuoteAuthorization',\n+            QuoteAuthorization: 'https://w3id.org/fep/044f#QuoteAuthorization',\n             gts: 'https://gotosocial.org/ns#',\n             interactionPolicy: {\n               '@id': 'gts:interactionPolicy',\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/components/status.jsx\n@@ -403,14 +403,7 @@ class Status extends ImmutablePureComponent {\n     const connectReply = nextInReplyToId && nextInReplyToId === status.get('id');\n     const matchedFilters = status.get('matched_filters');\n \n-    if (featured) {\n-      prepend = (\n-        <div className='status__prepend'>\n-          <div className='status__prepend__icon'><Icon id='thumb-tack' icon={PushPinIcon} /></div>\n-          <FormattedMessage id='status.pinned' defaultMessage='Pinned post' />\n-        </div>\n-      );\n-    } else if (status.get('reblog', null) !== null && typeof status.get('reblog') === 'object') {\n+    if (status.get('reblog', null) !== null && typeof status.get('reblog') === 'object') {\n       const display_name_html = { __html: status.getIn(['account', 'display_name_html']) };\n \n       prepend = (\n---\napp/javascript/mastodon/locales/en.json\n@@ -168,7 +168,7 @@\n   \"column.lists\": \"Lists\",\n   \"column.mutes\": \"Muted users\",\n   \"column.notifications\": \"Notifications\",\n-  \"column.pins\": \"Pinned posts\",\n+  \"column.pins\": \"Featured posts\",\n   \"column.public\": \"Federated timeline\",\n   \"column_back_button.label\": \"Back\",\n   \"column_header.hide_settings\": \"Hide settings\",\n@@ -477,7 +477,7 @@\n   \"keyboard_shortcuts.my_profile\": \"Open your profile\",\n   \"keyboard_shortcuts.notifications\": \"Open notifications column\",\n   \"keyboard_shortcuts.open_media\": \"Open media\",\n-  \"keyboard_shortcuts.pinned\": \"Open pinned posts list\",\n+  \"keyboard_shortcuts.pinned\": \"Open featured posts list\",\n   \"keyboard_shortcuts.profile\": \"Open author's profile\",\n   \"keyboard_shortcuts.reply\": \"Reply to post\",\n   \"keyboard_shortcuts.requests\": \"Open follow requests list\",\n@@ -561,7 +561,7 @@\n   \"navigation_bar.mutes\": \"Muted users\",\n   \"navigation_bar.opened_in_classic_interface\": \"Posts, accounts, and other specific pages are opened by default in the classic web interface.\",\n   \"navigation_bar.personal\": \"Personal\",\n-  \"navigation_bar.pins\": \"Pinned posts\",\n+  \"navigation_bar.pins\": \"Featured posts\",\n   \"navigation_bar.preferences\": \"Preferences\",\n   \"navigation_bar.public_timeline\": \"Federated timeline\",\n   \"navigation_bar.search\": \"Search\",\n@@ -857,8 +857,7 @@\n   \"status.mute\": \"Mute @{name}\",\n   \"status.mute_conversation\": \"Mute conversation\",\n   \"status.open\": \"Expand this post\",\n-  \"status.pin\": \"Pin on profile\",\n-  \"status.pinned\": \"Pinned post\",\n+  \"status.pin\": \"Feature on profile\",\n   \"status.read_more\": \"Read more\",\n   \"status.reblog\": \"Boost\",\n   \"status.reblog_private\": \"Boost with original visibility\",\n@@ -883,7 +882,7 @@\n   \"status.translated_from_with\": \"Translated from {lang} using {provider}\",\n   \"status.uncached_media_warning\": \"Preview not available\",\n   \"status.unmute_conversation\": \"Unmute conversation\",\n-  \"status.unpin\": \"Unpin from profile\",\n+  \"status.unpin\": \"Don't feature on profile\",\n   \"subscribed_languages.lead\": \"Only posts in selected languages will appear on your home and list timelines after the change. Select none to receive posts in all languages.\",\n   \"subscribed_languages.save\": \"Save changes\",\n   \"subscribed_languages.target\": \"Change subscribed languages for {target}\",\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nImplement rejection of incoming `QuoteRequest` activities according to https://codeberg.org/fediverse/fep/src/branch/main/fep/044f/fep-044f.md\r\n\r\nThis is optional, and more of a placeholder for further development when we will actually approve some of the quotes.\r\n\r\nTODO:\r\n- [x] double-check context of serialized activity\n\n---\n\nChoice A:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.222.4', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1093.0)\n+    aws-sdk-core (3.222.3)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -934,7 +936,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.222.4)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\nChoice B:\napp/helpers/json_ld_helper.rb\n@@ -72,6 +72,18 @@ def non_matching_uri_hosts?(base_url, comparison_url)\n     !haystack.casecmp(needle).zero?\n   end\n \n+  def safe_prefetched_embed(account, object, context)\n+    return unless object.is_a?(Hash)\n+\n+    # NOTE: Replacing the object's context by that of the parent activity is\n+    # not sound, but it's consistent with the rest of the codebase\n+    object = object.merge({ '@context' => context })\n+\n+    return if value_or_id(first_of_value(object['attributedTo'])) != account.uri || non_matching_uri_hosts?(account.uri, object['id'])\n+\n+    object\n+  end\n+\n   def canonicalize(json)\n     graph = RDF::Graph.new << JSON::LD::API.toRdf(json, documentLoader: method(:load_jsonld_context))\n     graph.dump(:normalize)\n---\napp/lib/activitypub/activity/create.rb\n@@ -204,7 +204,9 @@ def attach_quote(status)\n \n     @quote.status = status\n     @quote.save\n-    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, request_id: @options[:request_id])\n+\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(@quote, fetchable_quoted_uri: @quote_uri, prefetched_quoted_object: embedded_quote, request_id: @options[:request_id])\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n     ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, @quote.id, @quote_uri, { 'request_id' => @options[:request_id] })\n   end\n---\napp/lib/activitypub/parser/status_parser.rb\n@@ -120,6 +120,11 @@ def quote_uri\n     end.first\n   end\n \n+  # The inlined quote; out of the attributes we support, only `https://w3id.org/fep/044f#quote` explicitly supports inlined objects\n+  def quoted_object\n+    as_array(@object['quote']).first\n+  end\n+\n   def quote_approval_uri\n     as_array(@object['quoteAuthorization']).first\n   end\n---\napp/services/activitypub/process_status_update_service.rb\n@@ -273,7 +273,6 @@ def update_emojis!\n   def update_quote!\n     return unless Mastodon::Feature.inbound_quotes_enabled?\n \n-    quote = nil\n     quote_uri = @status_parser.quote_uri\n \n     if quote_uri.present?\n@@ -294,21 +293,23 @@ def update_quote!\n         quote = Quote.create(status: @status, approval_uri: approval_uri)\n         @quote_changed = true\n       end\n-    end\n \n-    if quote.present?\n-      begin\n-        quote.save\n-        ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, request_id: @request_id)\n-      rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n-        ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n-      end\n+      quote.save\n+\n+      fetch_and_verify_quote!(quote, quote_uri)\n     elsif @status.quote.present?\n       @status.quote.destroy!\n       @quote_changed = true\n     end\n   end\n \n+  def fetch_and_verify_quote!(quote, quote_uri)\n+    embedded_quote = safe_prefetched_embed(@account, @status_parser.quoted_object, @activity_json['context'])\n+    ActivityPub::VerifyQuoteService.new.call(quote, fetchable_quoted_uri: quote_uri, prefetched_quoted_object: embedded_quote, request_id: @request_id)\n+  rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS\n+    ActivityPub::RefetchAndVerifyQuoteWorker.perform_in(rand(30..600).seconds, quote.id, quote_uri, { 'request_id' => @request_id })\n+  end\n+\n   def update_counts!\n     likes = @status_parser.favourites_count\n     shares =  @status_parser.reblogs_count\n---\napp/services/activitypub/verify_quote_service.rb\n@@ -4,15 +4,15 @@ class ActivityPub::VerifyQuoteService < BaseService\n   include JsonLdHelper\n \n   # Optionally fetch quoted post, and verify the quote is authorized\n-  def call(quote, fetchable_quoted_uri: nil, prefetched_body: nil, request_id: nil)\n+  def call(quote, fetchable_quoted_uri: nil, prefetched_quoted_object: nil, prefetched_approval: nil, request_id: nil)\n     @request_id = request_id\n     @quote = quote\n     @fetching_error = nil\n \n-    fetch_quoted_post_if_needed!(fetchable_quoted_uri)\n+    fetch_quoted_post_if_needed!(fetchable_quoted_uri, prefetched_body: prefetched_quoted_object)\n     return if fast_track_approval! || quote.approval_uri.blank?\n \n-    @json = fetch_approval_object(quote.approval_uri, prefetched_body:)\n+    @json = fetch_approval_object(quote.approval_uri, prefetched_body: prefetched_approval)\n     return quote.reject! if @json.nil?\n \n     return if non_matching_uri_hosts?(quote.approval_uri, value_or_id(@json['attributedTo']))\n@@ -68,11 +68,11 @@ def matching_quote_uri?\n     ActivityPub::TagManager.instance.uri_for(@quote.status) == value_or_id(@json['interactingObject'])\n   end\n \n-  def fetch_quoted_post_if_needed!(uri)\n+  def fetch_quoted_post_if_needed!(uri, prefetched_body: nil)\n     return if uri.nil? || @quote.quoted_status.present?\n \n     status = ActivityPub::TagManager.instance.uri_to_resource(uri, Status)\n-    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, request_id: @request_id)\n+    status ||= ActivityPub::FetchRemoteStatusService.new.call(uri, on_behalf_of: @quote.account.followers.local.first, prefetched_body:, request_id: @request_id)\n \n     @quote.update(quoted_status: status) if status.present?\n   rescue Mastodon::UnexpectedResponseError, *Mastodon::HTTP_CONNECTION_ERRORS => e\n---\nspec/services/activitypub/verify_quote_service_spec.rb\n@@ -89,6 +89,37 @@\n       end\n     end\n \n+    context 'with a valid activity for a post that cannot be fetched but is passed as fetched_quoted_object' do\n+      let(:quoted_status) { nil }\n+\n+      let(:approval_interaction_target) { 'https://b.example.com/unknown-quoted' }\n+      let(:prefetched_object) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          type: 'Note',\n+          id: 'https://b.example.com/unknown-quoted',\n+          to: 'https://www.w3.org/ns/activitystreams#Public',\n+          attributedTo: ActivityPub::TagManager.instance.uri_for(quoted_account),\n+          content: 'previously unknown post',\n+        }.with_indifferent_access\n+      end\n+\n+      before do\n+        stub_request(:get, 'https://b.example.com/unknown-quoted')\n+          .to_return(status: 404)\n+      end\n+\n+      it 'updates the status' do\n+        expect { subject.call(quote, fetchable_quoted_uri: 'https://b.example.com/unknown-quoted', prefetched_quoted_object: prefetched_object) }\n+          .to change(quote, :state).to('accepted')\n+\n+        expect(a_request(:get, approval_uri))\n+          .to have_been_made.once\n+\n+        expect(quote.reload.quoted_status.content).to eq 'previously unknown post'\n+      end\n+    end\n+\n     context 'with a valid activity for a post that cannot be fetched but is inlined' do\n       let(:quoted_status) { nil }\n \n@@ -148,7 +179,7 @@\n \n     context 'with a valid activity for already-fetched posts, with a pre-fetched approval' do\n       it 'updates the status without fetching the activity' do\n-        expect { subject.call(quote, prefetched_body: Oj.dump(json)) }\n+        expect { subject.call(quote, prefetched_approval: Oj.dump(json)) }\n           .to change(quote, :state).to('accepted')\n \n         expect(a_request(:get, approval_uri))\n---\n\n\n---\n\nChoice C:\nCONTRIBUTING.md\n@@ -23,6 +23,11 @@ Bug reports and feature suggestions must use descriptive and concise titles and\n be submitted to [GitHub Issues]. Please use the search function to make sure\n there are not duplicate bug reports or feature requests.\n \n+## Security Issues\n+\n+If you believe you have identified a security issue in Mastodon or our own apps,\n+check [SECURITY].\n+\n ## Translations\n \n Translations are community contributed via [Crowdin]. They are periodically\n@@ -83,3 +88,4 @@ and API docs. Improvements are made via PRs to the [documentation repository].\n [GitHub Issues]: https://github.com/mastodon/mastodon/issues\n [keepachangelog]: https://keepachangelog.com/en/1.0.0/\n [Mastodon documentation]: https://docs.joinmastodon.org\n+[SECURITY]: SECURITY.md\n---\nREADME.md\n@@ -77,12 +77,12 @@ accepted into Mastodon, you can request to be paid through our [OpenCollective].\n \n ## License\n \n-Copyright (c) 2016-2024 Eugen Rochko (+ [`mastodon authors`](AUTHORS.md))\n+Copyright (c) 2016-2025 Eugen Rochko (+ [`mastodon authors`](AUTHORS.md))\n \n Licensed under GNU Affero General Public License as stated in the [LICENSE](LICENSE):\n \n ```\n-Copyright (c) 2016-2024 Eugen Rochko & other Mastodon contributors\n+Copyright (c) 2016-2025 Eugen Rochko & other Mastodon contributors\n \n This program is free software: you can redistribute it and/or modify it under\n the terms of the GNU Affero General Public License as published by the Free\n---\n\n\n---\n\nChoice D:\napp/helpers/context_helper.rb\n@@ -25,6 +25,7 @@ module ContextHelper\n     voters_count: { 'toot' => 'http://joinmastodon.org/ns#', 'votersCount' => 'toot:votersCount' },\n     suspended: { 'toot' => 'http://joinmastodon.org/ns#', 'suspended' => 'toot:suspended' },\n     attribution_domains: { 'toot' => 'http://joinmastodon.org/ns#', 'attributionDomains' => { '@id' => 'toot:attributionDomains', '@type' => '@id' } },\n+    quote_requests: { 'QuoteRequest' => 'https://w3id.org/fep/044f#QuoteRequest' },\n   }.freeze\n \n   def full_context\n---\napp/lib/activitypub/activity.rb\n@@ -57,6 +57,8 @@ def klass\n         ActivityPub::Activity::Remove\n       when 'Move'\n         ActivityPub::Activity::Move\n+      when 'QuoteRequest'\n+        ActivityPub::Activity::QuoteRequest\n       end\n     end\n   end\n---\napp/lib/activitypub/activity/quote_request.rb\n@@ -0,0 +1,30 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::Activity::QuoteRequest < ActivityPub::Activity\n+  include Payloadable\n+\n+  def perform\n+    return unless Mastodon::Feature.inbound_quotes_enabled?\n+    return if non_matching_uri_hosts?(@account.uri, @json['id'])\n+\n+    quoted_status = status_from_uri(object_uri)\n+    return if quoted_status.nil? || !quoted_status.account.local? || !quoted_status.distributable?\n+\n+    # For now, we don't support being quoted by external servers\n+    reject_quote_request!(quoted_status)\n+  end\n+\n+  private\n+\n+  def reject_quote_request!(quoted_status)\n+    quote = Quote.new(\n+      quoted_status: quoted_status,\n+      quoted_account: quoted_status.account,\n+      status: Status.new(account: @account, uri: @json['instrument']),\n+      account: @account,\n+      activity_uri: @json['id']\n+    )\n+    json = Oj.dump(serialize_payload(quote, ActivityPub::RejectQuoteRequestSerializer))\n+    ActivityPub::DeliveryWorker.perform_async(json, quoted_status.account_id, @account.inbox_url)\n+  end\n+end\n---\napp/serializers/activitypub/quote_request_serializer.rb\n@@ -0,0 +1,28 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::QuoteRequestSerializer < ActivityPub::Serializer\n+  context_extensions :quote_requests\n+\n+  attributes :id, :type, :actor, :instrument\n+  attribute :virtual_object, key: :object\n+\n+  def id\n+    object.activity_uri || [ActivityPub::TagManager.instance.uri_for(object.target_account), '#quote_requests/', object.id].join\n+  end\n+\n+  def type\n+    'QuoteRequest'\n+  end\n+\n+  def actor\n+    ActivityPub::TagManager.instance.uri_for(object.account)\n+  end\n+\n+  def virtual_object\n+    ActivityPub::TagManager.instance.uri_for(object.quoted_status)\n+  end\n+\n+  def instrument\n+    ActivityPub::TagManager.instance.uri_for(object.status)\n+  end\n+end\n---\napp/serializers/activitypub/reject_quote_request_serializer.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ActivityPub::RejectQuoteRequestSerializer < ActivityPub::Serializer\n+  attributes :id, :type, :actor\n+\n+  has_one :object, serializer: ActivityPub::QuoteRequestSerializer\n+\n+  def id\n+    [ActivityPub::TagManager.instance.uri_for(object.quoted_account), '#rejects/quote_requests/', object.id].join\n+  end\n+\n+  def type\n+    'Reject'\n+  end\n+\n+  def actor\n+    ActivityPub::TagManager.instance.uri_for(object.quoted_account)\n+  end\n+end\n---\nspec/lib/activitypub/activity/quote_request_spec.rb\n@@ -0,0 +1,51 @@\n+# frozen_string_literal: true\n+\n+require 'rails_helper'\n+\n+RSpec.describe ActivityPub::Activity::QuoteRequest, feature: :inbound_quotes do\n+  let(:sender)    { Fabricate(:account, domain: 'example.com') }\n+  let(:recipient) { Fabricate(:account) }\n+  let(:quoted_post) { Fabricate(:status, account: recipient) }\n+  let(:request_uri) { 'https://example.com/missing-ui' }\n+  let(:quoted_uri) { ActivityPub::TagManager.instance.uri_for(quoted_post) }\n+\n+  let(:json) do\n+    {\n+      '@context': [\n+        'https://www.w3.org/ns/activitystreams',\n+        {\n+          QuoteRequest: 'https://w3id.org/fep/044f#QuoteRequest',\n+        },\n+      ],\n+      id: request_uri,\n+      type: 'QuoteRequest',\n+      actor: ActivityPub::TagManager.instance.uri_for(sender),\n+      object: quoted_uri,\n+      instrument: 'https://example.com/unknown-status',\n+    }.with_indifferent_access\n+  end\n+\n+  describe '#perform' do\n+    subject { described_class.new(json, sender) }\n+\n+    context 'when trying to quote an unknown status' do\n+      let(:quoted_uri) { 'https://example.com/statuses/1234' }\n+\n+      it 'does not send anything' do\n+        expect { subject.perform }\n+          .to_not enqueue_sidekiq_job(ActivityPub::DeliveryWorker)\n+      end\n+    end\n+\n+    context 'when trying to quote an unquotable local status' do\n+      it 'sends a Reject activity' do\n+        expect { subject.perform }\n+          .to enqueue_sidekiq_job(ActivityPub::DeliveryWorker)\n+          .with(satisfying do |body|\n+            outgoing_json = Oj.load(body)\n+            outgoing_json['type'] == 'Reject' && %w(type id actor object instrument).all? { |key| json[key] == outgoing_json['object'][key] }\n+          end, recipient.id, sender.inbox_url)\n+      end\n+    end\n+  end\n+end\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [aws-sdk-core](https://redirect.github.com/aws/aws-sdk-ruby) ([source](https://redirect.github.com/aws/aws-sdk-ruby/tree/HEAD/gems/aws-sdk-core), [changelog](https://redirect.github.com/aws/aws-sdk-ruby/tree/version-3/gems/aws-sdk-core/CHANGELOG.md)) | `'< 3.216.0'` -> `'< 3.222.3'` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/aws-sdk-core/3.222.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/aws-sdk-core/3.222.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/aws-sdk-core/3.215.1/3.222.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/aws-sdk-core/3.215.1/3.222.2?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>aws/aws-sdk-ruby (aws-sdk-core)</summary>\n\n### [`v3.222.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32222-2025-04-16)\n\n-   Issue - Additional metrics collection for credentials in the User-Agent plugin.\n\n### [`v3.222.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32221-2025-03-28)\n\n-   Issue - Allow explicit modeled headers to override prefixed headers for `rest` protocols.\n\n### [`v3.222.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32220-2025-03-27)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - This release adds AwsAdditionalDetails in the CreateTokenWithIAM API response.\n\n### [`v3.221.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32210-2025-03-24)\n\n-   Feature - Add `logger` as an explicit dependency for Ruby 3.5.\n-   Issue - Enable ALPN over TLS for H2 Connection by default.\n-   Issue - Fix HTTP-2 connections to properly use config values configured on the client.\n\n### [`v3.220.2`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32202-2025-03-20)\n\n-   Issue - Enable ALPN over TLS for H2 by default.\n\n### [`v3.220.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32201-2025-03-06)\n\n-   Issue - Convert stubs at request time.\n\n### [`v3.220.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32200-2025-03-04)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n### [`v3.219.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32190-2025-02-18)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.218.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32181-2025-02-07)\n\n-   Issue - Add handling of block in ExtendedSession delegation ([#&#8203;3178](https://redirect.github.com/aws/aws-sdk-ruby/issues/3178)).\n\n### [`v3.218.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32180-2025-02-06)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n### [`v3.217.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32171-2025-01-30)\n\n-   Issue - Add `transfer-encoding` and `connection` to list of unsigned sigv4 headers.\n\n### [`v3.217.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32170-2025-01-24)\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Fixed typos in the descriptions.\n\n### [`v3.216.1`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32161-2025-01-22)\n\n-   Issue - Use epoch seconds instead of milliseconds in cbor encode/decode.\n\n-   Issue - Add handling of block in response delegation ([#&#8203;3169](https://redirect.github.com/aws/aws-sdk-ruby/issues/3169)).\n\n### [`v3.216.0`](https://redirect.github.com/aws/aws-sdk-ruby/blob/HEAD/gems/aws-sdk-core/CHANGELOG.md#32160-2025-01-15)\n\n-   Feature - Updated Aws::STS::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSOOIDC::Client with the latest API changes.\n\n-   Feature - Updated Aws::SSO::Client with the latest API changes.\n\n-   Feature - Always calculate request checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:request_checksum_calculation`, in the shared config file as `request_checksum_calculation`, and in the ENV as `ENV['AWS_REQUEST_CHECKSUM_CALCULATION']`.\n\n-   Feature - Always validate response checksums for operations that support or require it. Supported config options are `when_supported` and `when_required`. The default value is `when_supported`. This option is configured in code with `:response_checksum_validation`, in the shared config file as `response_checksum_validation`, and in the ENV as `ENV['AWS_RESPONSE_CHECKSUM_VALIDATION']`.\n\n-   Feature - Support CRC64NVME checksums through the `aws-crt` gem.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yMzguMCIsInVwZGF0ZWRJblZlciI6IjM5LjIzOC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nconfig/environments/production.rb\n@@ -52,17 +52,14 @@\n     },\n   }\n \n-  # Log to STDOUT by default\n-  config.logger = ActiveSupport::Logger.new($stdout)\n-                                       .tap  { |logger| logger.formatter = ::Logger::Formatter.new }\n-                                       .then { |logger| ActiveSupport::TaggedLogging.new(logger) }\n+  # Use default logging formatter so that PID and timestamp are not suppressed.\n+  config.log_formatter = Logger::Formatter.new\n \n-  # Prepend all log lines with the following tags.\n+  # Log to STDOUT with the current request id as a default log tag.\n   config.log_tags = [:request_id]\n+  config.logger = ActiveSupport::TaggedLogging.logger($stdout, formatter: config.log_formatter)\n \n-  # \"info\" includes generic and useful information about system operation, but avoids logging too much\n-  # information to avoid inadvertent exposure of personally identifiable information (PII). If you\n-  # want to log everything, set the level to \"debug\".\n+  # Change to \"debug\" to log everything (including potentially personally-identifiable information!)\n   config.log_level = ENV.fetch('RAILS_LOG_LEVEL', 'info')\n \n   # Use a different cache store in production.\n@@ -90,9 +87,6 @@\n   # Don't log any deprecations.\n   config.active_support.report_deprecations = false\n \n-  # Use default logging formatter so that PID and timestamp are not suppressed.\n-  config.log_formatter = ::Logger::Formatter.new\n-\n   # Better log formatting\n   config.lograge.enabled = true\n \n---\n\n\n---\n\nChoice B:\napp/javascript/styles/mastodon/admin.scss\n@@ -3,7 +3,7 @@\n @use 'variables' as *;\n \n $no-columns-breakpoint: 890px;\n-$sidebar-width: 300px;\n+$sidebar-width: 360px;\n $content-width: 840px;\n \n .admin-wrapper {\n@@ -180,8 +180,8 @@ $content-width: 840px;\n   .content {\n     padding-top: 55px;\n     padding-bottom: 20px;\n-    padding-inline-start: 25px;\n-    padding-inline-end: 15px;\n+    padding-inline-start: 15px;\n+    padding-inline-end: 5px;\n \n     @media screen and (max-width: $no-columns-breakpoint) {\n       max-width: none;\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -469,7 +469,7 @@ GEM\n     omniauth-rails_csrf_protection (1.0.2)\n       actionpack (>= 4.2)\n       omniauth (~> 2.0)\n-    omniauth-saml (2.2.3)\n+    omniauth-saml (2.2.4)\n       omniauth (~> 2.1)\n       ruby-saml (~> 1.18)\n     omniauth_openid_connect (0.8.0)\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -14,7 +14,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.222.3', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -94,12 +94,14 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n-    aws-sdk-core (3.215.1)\n+    aws-partitions (1.1088.0)\n+    aws-sdk-core (3.222.2)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n@@ -931,7 +933,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.222.3)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [connection_pool](https://redirect.github.com/mperham/connection_pool) ([changelog](https://redirect.github.com/mperham/connection_pool/blob/main/Changes.md)) | `2.5.0` -> `2.5.1` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/connection_pool/2.5.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/connection_pool/2.5.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/connection_pool/2.5.0/2.5.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/connection_pool/2.5.0/2.5.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>mperham/connection_pool (connection_pool)</summary>\n\n### [`v2.5.1`](https://redirect.github.com/mperham/connection_pool/blob/HEAD/Changes.md#251)\n\n[Compare Source](https://redirect.github.com/mperham/connection_pool/compare/v2.5.0...v2.5.1)\n\n-   Pass options to TimedStack in `checkout` \\[[#&#8203;195](https://redirect.github.com/mperham/connection_pool/issues/195)]\n-   Optimize connection lookup \\[[#&#8203;196](https://redirect.github.com/mperham/connection_pool/issues/196)]\n-   Fixes for use with Ractors\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yMzguMCIsInVwZGF0ZWRJblZlciI6IjM5LjIzOC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\napp/javascript/mastodon/api.ts\n@@ -83,6 +83,7 @@ export default function api(withAuthorization = true) {\n   return instance;\n }\n \n+type ApiUrl = `v${1 | 2}/${string}`;\n type RequestParamsOrData = Record<string, unknown>;\n \n export async function apiRequest<ApiResponse = unknown>(\n@@ -105,28 +106,28 @@ export async function apiRequest<ApiResponse = unknown>(\n }\n \n export async function apiRequestGet<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   params?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('GET', url, { params });\n }\n \n export async function apiRequestPost<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   data?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('POST', url, { data });\n }\n \n export async function apiRequestPut<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   data?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('PUT', url, { data });\n }\n \n export async function apiRequestDelete<ApiResponse = unknown>(\n-  url: string,\n+  url: ApiUrl,\n   params?: RequestParamsOrData,\n ) {\n   return apiRequest<ApiResponse>('DELETE', url, { params });\n---\napp/javascript/mastodon/api/accounts.ts\n@@ -36,6 +36,6 @@ export const apiGetEndorsedAccounts = (id: string) =>\n   apiRequestGet<ApiAccountJSON>(`v1/accounts/${id}/endorsements`);\n \n export const apiGetFamiliarFollowers = (id: string) =>\n-  apiRequestGet<ApiFamiliarFollowersJSON>('/v1/accounts/familiar_followers', {\n+  apiRequestGet<ApiFamiliarFollowersJSON>('v1/accounts/familiar_followers', {\n     id,\n   });\n---\napp/javascript/mastodon/api/polls.ts\n@@ -2,9 +2,9 @@ import { apiRequestGet, apiRequestPost } from 'mastodon/api';\n import type { ApiPollJSON } from 'mastodon/api_types/polls';\n \n export const apiGetPoll = (pollId: string) =>\n-  apiRequestGet<ApiPollJSON>(`/v1/polls/${pollId}`);\n+  apiRequestGet<ApiPollJSON>(`v1/polls/${pollId}`);\n \n export const apiPollVote = (pollId: string, choices: string[]) =>\n-  apiRequestPost<ApiPollJSON>(`/v1/polls/${pollId}/votes`, {\n+  apiRequestPost<ApiPollJSON>(`v1/polls/${pollId}/votes`, {\n     choices,\n   });\n---\n\n\n---\n\nChoice B:\nGemfile\n@@ -201,7 +201,7 @@ group :development, :test do\n   gem 'faker', '~> 3.2'\n \n   # Generate factory objects\n-  gem 'fabrication', '~> 2.30'\n+  gem 'fabrication'\n \n   # Profiling tools\n   gem 'memory_profiler', require: false\n---\nGemfile.lock\n@@ -223,7 +223,7 @@ GEM\n       tzinfo\n     excon (1.2.5)\n       logger\n-    fabrication (2.31.0)\n+    fabrication (3.0.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n     faraday (2.13.1)\n@@ -972,7 +972,7 @@ DEPENDENCIES\n   doorkeeper (~> 5.6)\n   dotenv\n   email_spec\n-  fabrication (~> 2.30)\n+  fabrication\n   faker (~> 3.2)\n   faraday-httpclient\n   fast_blank (~> 1.0)\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -160,7 +160,7 @@ GEM\n     cocoon (1.2.15)\n     color_diff (0.1)\n     concurrent-ruby (1.3.5)\n-    connection_pool (2.5.0)\n+    connection_pool (2.5.1)\n     cose (1.3.1)\n       cbor (~> 0.5.9)\n       openssl-signature_algorithm (~> 1.0)\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -1023,7 +1023,7 @@ export const AccountHeader: React.FC<{\n                   />\n                 </NavLink>\n               </div>\n-              <FamiliarFollowers accountId={accountId} />\n+              {signedIn && <FamiliarFollowers accountId={accountId} />}\n             </div>\n           )}\n         </div>\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [opentelemetry-instrumentation-pg](https://redirect.github.com/open-telemetry/opentelemetry-ruby-contrib) ([source](https://redirect.github.com/open-telemetry/opentelemetry-ruby-contrib/tree/HEAD/instrumentation/pg), [changelog](https://rubydoc.info/gems/opentelemetry-instrumentation-pg/0.30.1/file/CHANGELOG.md)) | `0.30.0` -> `0.30.1` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/opentelemetry-instrumentation-pg/0.30.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/opentelemetry-instrumentation-pg/0.30.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/opentelemetry-instrumentation-pg/0.30.0/0.30.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/opentelemetry-instrumentation-pg/0.30.0/0.30.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>open-telemetry/opentelemetry-ruby-contrib (opentelemetry-instrumentation-pg)</summary>\n\n### [`v0.30.1`](https://redirect.github.com/open-telemetry/opentelemetry-ruby-contrib/blob/HEAD/instrumentation/pg/CHANGELOG.md#v0301--2025-04-16)\n\n-   refactor: Use SQL helpers for context attributes [#&#8203;1271](https://redirect.github.com/open-telemetry/opentelemetry-ruby-contrib/issues/1271)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yMzguMCIsInVwZGF0ZWRJblZlciI6IjM5LjIzOC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -495,6 +495,8 @@ GEM\n       opentelemetry-common (~> 0.20)\n       opentelemetry-sdk (~> 1.2)\n       opentelemetry-semantic_conventions\n+    opentelemetry-helpers-sql (0.1.1)\n+      opentelemetry-api (~> 1.0)\n     opentelemetry-helpers-sql-obfuscation (0.3.0)\n       opentelemetry-common (~> 0.21)\n     opentelemetry-instrumentation-action_mailer (0.4.0)\n@@ -548,8 +550,9 @@ GEM\n     opentelemetry-instrumentation-net_http (0.23.0)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-pg (0.30.0)\n+    opentelemetry-instrumentation-pg (0.30.1)\n       opentelemetry-api (~> 1.0)\n+      opentelemetry-helpers-sql\n       opentelemetry-helpers-sql-obfuscation\n       opentelemetry-instrumentation-base (~> 0.23.0)\n     opentelemetry-instrumentation-rack (0.26.0)\n---\n\n\n---\n\nChoice B:\napp/javascript/styles/mastodon/basics.scss\n@@ -17,7 +17,12 @@ body {\n   font-weight: 400;\n   color: $primary-text-color;\n   text-rendering: optimizelegibility;\n-  font-feature-settings: 'kern';\n+\n+  // Disable kerning for Japanese text to preserve monospaced alignment for readability\n+  &:not(:lang(ja)) {\n+    font-feature-settings: 'kern';\n+  }\n+\n   text-size-adjust: none;\n   -webkit-tap-highlight-color: rgba(0, 0, 0, 0%);\n   -webkit-tap-highlight-color: transparent;\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -5448,13 +5448,13 @@ __metadata:\n   linkType: hard\n \n \"axios@npm:^1.4.0\":\n-  version: 1.8.4\n-  resolution: \"axios@npm:1.8.4\"\n+  version: 1.9.0\n+  resolution: \"axios@npm:1.9.0\"\n   dependencies:\n     follow-redirects: \"npm:^1.15.6\"\n     form-data: \"npm:^4.0.0\"\n     proxy-from-env: \"npm:^1.1.0\"\n-  checksum: 10c0/450993c2ba975ffccaf0d480b68839a3b2435a5469a71fa2fb0b8a55cdb2c2ae47e609360b9c1e2b2534b73dfd69e2733a1cf9f8215bee0bcd729b72f801b0ce\n+  checksum: 10c0/9371a56886c2e43e4ff5647b5c2c3c046ed0a3d13482ef1d0135b994a628c41fbad459796f101c655e62f0c161d03883454474d2e435b2e021b1924d9f24994c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -13,7 +13,7 @@ gem 'haml-rails', '~>2.0'\n gem 'pg', '~> 1.5'\n gem 'pghero'\n \n-gem 'aws-sdk-core', '< 3.216.0', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n+gem 'aws-sdk-core', '< 3.225.2', require: false # TODO: https://github.com/mastodon/mastodon/pull/34173#issuecomment-2733378873\n gem 'aws-sdk-s3', '~> 1.123', require: false\n gem 'blurhash', '~> 0.1'\n gem 'fog-core', '<= 2.6.0'\n---\nGemfile.lock\n@@ -93,21 +93,23 @@ GEM\n     annotaterb (4.15.0)\n     ast (2.4.3)\n     attr_required (1.0.2)\n-    aws-eventstream (1.3.2)\n-    aws-partitions (1.1103.0)\n-    aws-sdk-core (3.215.1)\n+    aws-eventstream (1.4.0)\n+    aws-partitions (1.1112.0)\n+    aws-sdk-core (3.225.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n       aws-sigv4 (~> 1.9)\n+      base64\n       jmespath (~> 1, >= 1.6.1)\n+      logger\n     aws-sdk-kms (1.96.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sigv4 (~> 1.5)\n     aws-sdk-s3 (1.177.0)\n       aws-sdk-core (~> 3, >= 3.210.0)\n       aws-sdk-kms (~> 1)\n       aws-sigv4 (~> 1.5)\n-    aws-sigv4 (1.11.0)\n+    aws-sigv4 (1.12.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n     azure-blob (0.5.8)\n       rexml\n@@ -946,7 +948,7 @@ DEPENDENCIES\n   active_model_serializers (~> 0.10)\n   addressable (~> 2.8)\n   annotaterb (~> 4.13)\n-  aws-sdk-core (< 3.216.0)\n+  aws-sdk-core (< 3.225.2)\n   aws-sdk-s3 (~> 1.123)\n   better_errors (~> 2.9)\n   binding_of_caller (~> 1.0)\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nNormally, `tootctl search deploy` will delete and re-create an index if its specification has changed. With `--only-mapping`, the index will be updated in-place, and no data will be re-indexed.\r\n\r\nSee also #34455\n\n---\n\nChoice A:\nyarn.lock\n@@ -4860,17 +4860,17 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"browserslist@npm:^4.24.0, browserslist@npm:^4.24.4, browserslist@npm:^4.24.5\":\n-  version: 4.24.5\n-  resolution: \"browserslist@npm:4.24.5\"\n+\"browserslist@npm:^4.24.0, browserslist@npm:^4.24.4, browserslist@npm:^4.25.0\":\n+  version: 4.25.0\n+  resolution: \"browserslist@npm:4.25.0\"\n   dependencies:\n-    caniuse-lite: \"npm:^1.0.30001716\"\n-    electron-to-chromium: \"npm:^1.5.149\"\n+    caniuse-lite: \"npm:^1.0.30001718\"\n+    electron-to-chromium: \"npm:^1.5.160\"\n     node-releases: \"npm:^2.0.19\"\n     update-browserslist-db: \"npm:^1.1.3\"\n   bin:\n     browserslist: cli.js\n-  checksum: 10c0/f4c1ce1a7d8fdfab5e5b88bb6e93d09e8a883c393f86801537a252da0362dbdcde4dbd97b318246c5d84c6607b2f6b47af732c1b000d6a8a881ee024bad29204\n+  checksum: 10c0/cc16c55b4468b18684a0e1ca303592b38635b1155d6724f172407192737a2f405b8030d87a05813729592793445b3d15e737b0055f901cdecccb29b1e580a1c5\n   languageName: node\n   linkType: hard\n \n@@ -4991,10 +4991,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"caniuse-lite@npm:^1.0.30001702, caniuse-lite@npm:^1.0.30001716\":\n-  version: 1.0.30001718\n-  resolution: \"caniuse-lite@npm:1.0.30001718\"\n-  checksum: 10c0/67f9ad09bc16443e28d14f265d6e468480cd8dc1900d0d8b982222de80c699c4f2306599c3da8a3fa7139f110d4b30d49dbac78f215470f479abb6ffe141d5d3\n+\"caniuse-lite@npm:^1.0.30001702, caniuse-lite@npm:^1.0.30001718\":\n+  version: 1.0.30001721\n+  resolution: \"caniuse-lite@npm:1.0.30001721\"\n+  checksum: 10c0/fa3a8926899824b385279f1f886fe34c5efb1321c9ece1b9df25c8d567a2706db8450cc5b4d969e769e641593e08ea644909324aba93636a43e4949a75f81c4c\n   languageName: node\n   linkType: hard\n \n@@ -5735,10 +5735,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"electron-to-chromium@npm:^1.5.149\":\n-  version: 1.5.159\n-  resolution: \"electron-to-chromium@npm:1.5.159\"\n-  checksum: 10c0/dc5b60a235ad04b1637b3b2af4914ac900c42813b02262a91a41d950223316f7b12de715697cf9c2d9f572f716f9422bf259ee65d86599cd2cc66e92c499ebd1\n+\"electron-to-chromium@npm:^1.5.160\":\n+  version: 1.5.165\n+  resolution: \"electron-to-chromium@npm:1.5.165\"\n+  checksum: 10c0/20b91e67e7a8829a358c4a488e9b59b0e5f8d4cb075a70b9757bb21acf0fc751ca58ca7d9c6018bec74ac4bd42f7859e4ef37421c252a2275f642e12a32271d6\n   languageName: node\n   linkType: hard\n \n@@ -9321,9 +9321,9 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"postcss-custom-properties@npm:^14.0.5\":\n-  version: 14.0.5\n-  resolution: \"postcss-custom-properties@npm:14.0.5\"\n+\"postcss-custom-properties@npm:^14.0.6\":\n+  version: 14.0.6\n+  resolution: \"postcss-custom-properties@npm:14.0.6\"\n   dependencies:\n     \"@csstools/cascade-layer-name-parser\": \"npm:^2.0.5\"\n     \"@csstools/css-parser-algorithms\": \"npm:^3.0.5\"\n@@ -9332,7 +9332,7 @@ __metadata:\n     postcss-value-parser: \"npm:^4.2.0\"\n   peerDependencies:\n     postcss: ^8.4\n-  checksum: 10c0/ddee0545075dc0888cd54a9bb5791a98719a5d4f31d1de33823841efb540fa79f65e48b7c4aaba753d3214102e419536c5bc46c72e6e1579e5352da4e042ef3b\n+  checksum: 10c0/0eeef77bc713551f5cb8fa5982d24da4e854075f3af020f1c94366c47a23a4cc225ebfecc978bdb17f00ee0bdee9d2c784e0d01adc64a447321e408abbe2c83b\n   languageName: node\n   linkType: hard\n \n@@ -9513,8 +9513,8 @@ __metadata:\n   linkType: hard\n \n \"postcss-preset-env@npm:^10.1.5\":\n-  version: 10.2.0\n-  resolution: \"postcss-preset-env@npm:10.2.0\"\n+  version: 10.2.1\n+  resolution: \"postcss-preset-env@npm:10.2.1\"\n   dependencies:\n     \"@csstools/postcss-cascade-layers\": \"npm:^5.0.1\"\n     \"@csstools/postcss-color-function\": \"npm:^4.0.10\"\n@@ -9550,7 +9550,7 @@ __metadata:\n     \"@csstools/postcss-trigonometric-functions\": \"npm:^4.0.9\"\n     \"@csstools/postcss-unset-value\": \"npm:^4.0.0\"\n     autoprefixer: \"npm:^10.4.21\"\n-    browserslist: \"npm:^4.24.5\"\n+    browserslist: \"npm:^4.25.0\"\n     css-blank-pseudo: \"npm:^7.0.1\"\n     css-has-pseudo: \"npm:^7.0.2\"\n     css-prefers-color-scheme: \"npm:^10.0.0\"\n@@ -9561,7 +9561,7 @@ __metadata:\n     postcss-color-hex-alpha: \"npm:^10.0.0\"\n     postcss-color-rebeccapurple: \"npm:^10.0.0\"\n     postcss-custom-media: \"npm:^11.0.6\"\n-    postcss-custom-properties: \"npm:^14.0.5\"\n+    postcss-custom-properties: \"npm:^14.0.6\"\n     postcss-custom-selectors: \"npm:^8.0.5\"\n     postcss-dir-pseudo-class: \"npm:^9.0.1\"\n     postcss-double-position-gradients: \"npm:^6.0.2\"\n@@ -9582,7 +9582,7 @@ __metadata:\n     postcss-selector-not: \"npm:^8.0.1\"\n   peerDependencies:\n     postcss: ^8.4\n-  checksum: 10c0/33406dcdd1d63fd3810f12cd97bf0d6a09a51917943ee7d75e2ccaf1d8cbce363abcb90ee68f14509d287d00de4afd6664dbdecaa4f4b95509e3578e27f54a24\n+  checksum: 10c0/1a78eb86bca8f7c2bf7686ee9ed354b21d1316a7d12ae9aec2ce4b4810f6d32e23d0787d7450e55145f14f76b715df758bb54af0ea6a151858b045bd429f596e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\napp/lib/status_filter.rb\n@@ -38,7 +38,7 @@ def muting_account?\n   end\n \n   def silenced_account?\n-    !account&.silenced? && status_account_silenced? && !account_following_status_account?\n+    status_account_silenced? && !account_following_status_account?\n   end\n \n   def status_account_silenced?\n---\n\n\n---\n\nChoice C:\nlib/mastodon/cli/search.rb\n@@ -20,6 +20,7 @@ class Search < Base\n     option :import, type: :boolean, default: true, desc: 'Import data from the database to the index'\n     option :clean, type: :boolean, default: true, desc: 'Remove outdated documents from the index'\n     option :reset_chewy, type: :boolean, default: false, desc: \"Reset Chewy's internal index\"\n+    option :only_mapping, type: :boolean, default: false, desc: 'Update the index specification without re-index'\n     desc 'deploy', 'Create or upgrade Elasticsearch indices and populate them'\n     long_desc <<~LONG_DESC\n       If Elasticsearch is empty, this command will create the necessary indices\n@@ -52,6 +53,20 @@ def deploy\n \n       Chewy::Stash::Specification.reset! if options[:reset_chewy]\n \n+      if options[:only_mapping]\n+        indices.select { |index| index.specification.changed? }.each do |index|\n+          progress.title = \"Updating mapping for #{index} \"\n+          index.update_mapping\n+          index.specification.lock!\n+        end\n+\n+        progress.title = 'Done! '\n+        progress.finish\n+\n+        say('Updated index mappings', :green, true)\n+        return\n+      end\n+\n       # First, ensure all indices are created and have the correct\n       # structure, so that live data can already be written\n       indices.select { |index| index.specification.changed? }.each do |index|\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -9177,14 +9177,14 @@ __metadata:\n   linkType: hard\n \n \"pino-http@npm:^10.0.0\":\n-  version: 10.4.0\n-  resolution: \"pino-http@npm:10.4.0\"\n+  version: 10.5.0\n+  resolution: \"pino-http@npm:10.5.0\"\n   dependencies:\n     get-caller-file: \"npm:^2.0.5\"\n     pino: \"npm:^9.0.0\"\n     pino-std-serializers: \"npm:^7.0.0\"\n-    process-warning: \"npm:^4.0.0\"\n-  checksum: 10c0/64144e2c94e939070f56ad82dfb012b6a98d21582e0660cf821e7cee64d4e06f7724aa40bc5bf9cd1254d58ab7cbd972dec287b7989eba647d384f6edd8d95fd\n+    process-warning: \"npm:^5.0.0\"\n+  checksum: 10c0/17597d653a4088f7faed4d58500a5ef51d4d05247307696760006313c33c1d23177af98fb902e15b8e2cd92d81306c884673f841ba5b9bf0c064802f3c0bd775\n   languageName: node\n   linkType: hard\n \n@@ -9748,13 +9748,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"process-warning@npm:^4.0.0\":\n-  version: 4.0.0\n-  resolution: \"process-warning@npm:4.0.0\"\n-  checksum: 10c0/5312a72b69d37a1b82ad03f3dfa0090dab3804a8fd995d06c28e3c002852bd82f5584217d9f4a3f197892bb2afc22d57e2c662c7e906b5abb48c0380c7b0880d\n-  languageName: node\n-  linkType: hard\n-\n \"process-warning@npm:^5.0.0\":\n   version: 5.0.0\n   resolution: \"process-warning@npm:5.0.0\"\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Type | Update | Change |\n|---|---|---|---|\n| docker.io/ruby |  | patch | `3.4.2` -> `3.4.3` |\n| docker.io/ruby | final | patch | `3.4.2-slim-bookworm` -> `3.4.3-slim-bookworm` |\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about these updates again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yMzguMCIsInVwZGF0ZWRJblZlciI6IjM5LjIzOC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJkb2NrZXIiXX0=-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -807,7 +807,7 @@ GEM\n       rubyzip (>= 1.2.2, < 3.0)\n       websocket (~> 1.0)\n     semantic_range (3.1.0)\n-    shoulda-matchers (6.4.0)\n+    shoulda-matchers (6.5.0)\n       activesupport (>= 5.2.0)\n     sidekiq (6.5.12)\n       connection_pool (>= 2.2.5, < 3)\n---\n\n\n---\n\nChoice B:\n.nvmrc\n@@ -1 +1 @@\n-22.14\n+22.15\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -592,7 +592,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n     orm_adapter (0.5.0)\n     ostruct (0.6.1)\n-    ox (2.14.22)\n+    ox (2.14.23)\n       bigdecimal (>= 3.0)\n     parallel (1.27.0)\n     parser (3.3.8.0)\n---\n\n\n---\n\nChoice D:\nDockerfile\n@@ -13,7 +13,7 @@ ARG BASE_REGISTRY=\"docker.io\"\n \n # Ruby image to use for base image, change with [--build-arg RUBY_VERSION=\"3.4.x\"]\n # renovate: datasource=docker depName=docker.io/ruby\n-ARG RUBY_VERSION=\"3.4.2\"\n+ARG RUBY_VERSION=\"3.4.3\"\n # # Node.js version to use in base image, change with [--build-arg NODE_MAJOR_VERSION=\"20\"]\n # renovate: datasource=node-version depName=node\n ARG NODE_MAJOR_VERSION=\"22\"\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Update | Change |\n|---|---|---|\n| [ruby](https://www.ruby-lang.org) ([source](https://redirect.github.com/ruby/ruby)) | patch | `3.4.2` -> `3.4.3` |\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yMzguMCIsInVwZGF0ZWRJblZlciI6IjM5LjIzOC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\napp/javascript/styles/mastodon/components.scss\n@@ -7068,18 +7068,19 @@ a.status-card {\n }\n \n .audio-player {\n-  overflow: hidden;\n   box-sizing: border-box;\n+  container: audio-player / inline-size;\n   position: relative;\n-  background: var(--player-background-color, var(--background-color));\n+  overflow: hidden;\n+  display: flex;\n+  flex-direction: column;\n+  width: 100%;\n+  aspect-ratio: 16 / 9;\n   color: var(--player-foreground-color);\n+  background: var(--player-background-color, var(--background-color));\n   border-radius: 8px;\n-  padding-bottom: 44px;\n-  width: 100%;\n   outline: 1px solid var(--media-outline-color);\n   outline-offset: -1px;\n-  aspect-ratio: 16 / 9;\n-  container: audio-player / inline-size;\n \n   &__controls {\n     display: grid;\n@@ -7128,9 +7129,17 @@ a.status-card {\n   }\n \n   &__visualizer {\n+    width: 100%;\n     max-width: 200px;\n   }\n \n+  .video-player__seek {\n+    position: absolute;\n+    inset: 0 0 auto;\n+    height: 24px;\n+    z-index: 1; /* Ensure this renders on top of audio player controls */\n+  }\n+\n   &.inactive {\n     .video-player__seek,\n     .audio-player__controls,\n---\n\n\n---\n\nChoice B:\napp/javascript/entrypoints/sign_up.ts\n@@ -4,9 +4,12 @@ import axios from 'axios';\n import ready from '../mastodon/ready';\n \n async function checkConfirmation() {\n-  const response = await axios.get('/api/v1/emails/check_confirmation');\n+  const response = await axios.get('/api/v1/emails/check_confirmation', {\n+    headers: { Accept: 'application/json' },\n+    withCredentials: true,\n+  });\n \n-  if (response.data) {\n+  if (response.status === 200 && response.data === true) {\n     window.location.href = '/start';\n   }\n }\n---\n\n\n---\n\nChoice C:\n.ruby-version\n@@ -1 +1 @@\n-3.4.2\n+3.4.3\n---\n\n\n---\n\nChoice D:\nGemfile\n@@ -74,7 +74,7 @@ gem 'premailer-rails'\n gem 'public_suffix', '~> 6.0'\n gem 'pundit', '~> 2.3'\n gem 'rack-attack', '~> 6.6'\n-gem 'rack-cors', '~> 2.0', require: 'rack/cors'\n+gem 'rack-cors', require: 'rack/cors'\n gem 'rails-i18n', '~> 8.0'\n gem 'redcarpet', '~> 3.6'\n gem 'redis', '~> 4.5', require: ['redis', 'redis/connection/hiredis']\n---\nGemfile.lock\n@@ -636,8 +636,9 @@ GEM\n     rack (3.1.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n-    rack-cors (2.0.2)\n-      rack (>= 2.0.0)\n+    rack-cors (3.0.0)\n+      logger\n+      rack (>= 3.0.14)\n     rack-oauth2 (2.2.1)\n       activesupport\n       attr_required\n@@ -1046,7 +1047,7 @@ DEPENDENCIES\n   puma (~> 6.3)\n   pundit (~> 2.3)\n   rack-attack (~> 6.6)\n-  rack-cors (~> 2.0)\n+  rack-cors\n   rack-test (~> 2.1)\n   rails (~> 8.0)\n   rails-i18n (~> 8.0)\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nNew Crowdin translations, automated with GitHub Actions\n\nSee `.github/workflows/crowdin-download.yml`\n\nThis PR will be updated every day with new translations.\n\nDue to a limitation in GitHub Actions, checks are not running on this PR without manual action.\nIf you want to run the checks, then close and re-open it.\n\n---\n\nChoice A:\nconfig/environments/production.rb\n@@ -52,17 +52,14 @@\n     },\n   }\n \n-  # Log to STDOUT by default\n-  config.logger = ActiveSupport::Logger.new($stdout)\n-                                       .tap  { |logger| logger.formatter = ::Logger::Formatter.new }\n-                                       .then { |logger| ActiveSupport::TaggedLogging.new(logger) }\n+  # Use default logging formatter so that PID and timestamp are not suppressed.\n+  config.log_formatter = Logger::Formatter.new\n \n-  # Prepend all log lines with the following tags.\n+  # Log to STDOUT with the current request id as a default log tag.\n   config.log_tags = [:request_id]\n+  config.logger = ActiveSupport::TaggedLogging.logger($stdout, formatter: config.log_formatter)\n \n-  # \"info\" includes generic and useful information about system operation, but avoids logging too much\n-  # information to avoid inadvertent exposure of personally identifiable information (PII). If you\n-  # want to log everything, set the level to \"debug\".\n+  # Change to \"debug\" to log everything (including potentially personally-identifiable information!)\n   config.log_level = ENV.fetch('RAILS_LOG_LEVEL', 'info')\n \n   # Use a different cache store in production.\n@@ -90,9 +87,6 @@\n   # Don't log any deprecations.\n   config.active_support.report_deprecations = false\n \n-  # Use default logging formatter so that PID and timestamp are not suppressed.\n-  config.log_formatter = ::Logger::Formatter.new\n-\n   # Better log formatting\n   config.lograge.enabled = true\n \n---\n\n\n---\n\nChoice B:\nconfig/locales/ko.yml\n@@ -316,6 +316,7 @@ ko:\n         create: \uacf5\uc9c0\uc0ac\ud56d \uc0dd\uc131\n         title: \uc0c8 \uacf5\uc9c0\uc0ac\ud56d\n       preview:\n+        disclaimer: \uc0ac\uc6a9\uc790\ub4e4\uc740 \uc218\uc2e0\uc124\uc815\uc744 \ub04c \uc218 \uc5c6\uae30 \ub54c\ubb38\uc5d0 \uc774\uba54\uc77c \uc54c\ub9bc\uc740 \uac1c\uc778\uc815\ubcf4 \uc720\ucd9c\uc774\ub098 \uc11c\ubc84 \uc885\ub8cc\uc640 \uac19\uc740 \uc911\uc694\ud55c \uacf5\uc9c0\uc0ac\ud56d\uc5d0\ub9cc \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4.\n         explanation_html: \"<strong>%{display_count} \uba85\uc758 \uc0ac\uc6a9\uc790</strong>\uc5d0\uac8c \uc774\uba54\uc77c\uc774 \ubc1c\uc1a1\ub429\ub2c8\ub2e4. \ub2e4\uc74c \ub0b4\uc6a9\uc774 \uc774\uba54\uc77c\uc5d0 \ud3ec\ud568\ub429\ub2c8\ub2e4:\"\n         title: \uacf5\uc9c0\uc0ac\ud56d \uc54c\ub9bc \ubbf8\ub9ac\ubcf4\uae30\n       publish: \uac8c\uc2dc\n---\nconfig/locales/simple_form.ko.yml\n@@ -146,6 +146,7 @@ ko:\n         min_age: \uad00\ud560\uc9c0\uc5ed\uc758 \ubc95\ub960\uc5d0\uc11c \uc694\uad6c\ud558\ub294 \ucd5c\uc800 \uc5f0\ub839\ubcf4\ub2e4 \uc791\uc73c\uba74 \uc548 \ub429\ub2c8\ub2e4.\n       user:\n         chosen_languages: \uccb4\ud06c\ud558\uba74, \uc120\ud0dd \ub41c \uc5b8\uc5b4\ub85c \uc791\uc131\ub41c \uac8c\uc2dc\ubb3c\ub4e4\ub9cc \uacf5\uac1c \ud0c0\uc784\ub77c\uc778\uc5d0 \ubcf4\uc5ec\uc9d1\ub2c8\ub2e4\n+        date_of_birth: \ub9c8\uc2a4\ud1a0\ub3c8\uc744 \uc0ac\uc6a9\ud558\ub824\uba74 %{age}\uc138 \uc774\uc0c1\uc784\uc744 \ud655\uc778\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774 \uc815\ubcf4\ub294 \uc800\uc7a5\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.\n         role: \uc5ed\ud560\uc740 \uc0ac\uc6a9\uc790\uac00 \uc5b4\ub5a4 \uad8c\ud55c\uc744 \uac00\uc9c0\uac8c \ub420 \uc9c0 \uacb0\uc815\ud569\ub2c8\ub2e4.\n       user_role:\n         color: \uc0c9\uc0c1\uc740 \uc0ac\uc6a9\uc790 \uc778\ud130\ud398\uc774\uc2a4\uc5d0\uc11c \uc5ed\ud560\uc744 \ub098\ud0c0\ub0b4\uae30 \uc704\ud574 \uc0ac\uc6a9\ub418\uba70, RGB 16\uc9c4\uc218 \ud615\uc2dd\uc785\ub2c8\ub2e4\n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -2886,69 +2886,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/animated@npm:10.0.0\"\n+\"@react-spring/animated@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/animated@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/a8c40aff22def6dbe964b1f79fa4a7774c44bf5eb47c2ef969c8ecb2a426b4c972b147bf18635d6972dbec3fb95e70dd84f22b43c904c32dfc7a57ad144a0879\n+  checksum: 10c0/aaccd4a8b0280ac846d463b253ad8f092ee4afc9dbedc8e77616adf5399ffec755344f09fdd8487cadaf815840dff84d354d1143579c27c2fcd6937549b5fc40\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/core@npm:10.0.0\"\n+\"@react-spring/core@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/core@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.0\"\n-    \"@react-spring/shared\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/animated\": \"npm:~10.0.1\"\n+    \"@react-spring/shared\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/39036a153dbd973443e23d90cb8e7be83201b1f0e4105f8427ddb4c9e9e50e590e1b46282829e0bb6f3deebfab004e30dcb4eec0e34c5ebb234d5060c06ecae5\n+  checksum: 10c0/059b122dda4138e5e7e461abd49350921e326735ca9a1d8aa19b1fdbae0937661b5f71af6fe82fd8f59e8db5549627849b38cc3f7ef2ec7ee9c93c3d6225174f\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/rafz@npm:10.0.0\"\n-  checksum: 10c0/8d92bc553172fa883ec2121b9cc62bfb43ff5d6c4e76363c8ce100fb6c3dd67c3dd629931786f9d1d63ac95a5d6996e4a08693cd56dda685bdbaf39b60e97f66\n+\"@react-spring/rafz@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/rafz@npm:10.0.1\"\n+  checksum: 10c0/cba76f143d3a06f79dd0c09f7aefd17df9cca9b2c1ef7f9103255e5351326f4a42a5a1366f731a78f74380d96ba683bcc2a49312ed1e4b9e9e249e72c9ff68cb\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/shared@npm:10.0.0\"\n+\"@react-spring/shared@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/shared@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/rafz\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/833c3f42d35d22ac47a2f756ac47d85a81bc1decc5e7915f46013823344374378f883135754de94d5b43d8fff3c55fc4a359044c9a44f9095bd1ef1f11a20d4d\n+  checksum: 10c0/f056aaa018b3744afd8244e8eea24534d32f92fad9ace815b80e159b296fb5db148e2c9bd840ad9a5188e7a3c0778fd564b8af9ae02cd500e019a228398fb3cf\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/types@npm:10.0.0\"\n-  checksum: 10c0/ce1b959eaa8964f4004481d1e7c6eca0a8d636eb9f35ca654bdf77a78a860c0ff9eaa6bdc0cab84fc8a16be5c5fbb22b114249a2721bfc16191666670c0f44b3\n+\"@react-spring/types@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/types@npm:10.0.1\"\n+  checksum: 10c0/260890f9c156dc69b77c846510017156d8c0a07cce70edc7c108e57b0cf4122b26a15e724b191481a51b2c914296de9e81d56618b2c339339d4b221930691baa\n   languageName: node\n   linkType: hard\n \n \"@react-spring/web@npm:^10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/web@npm:10.0.0\"\n+  version: 10.0.1\n+  resolution: \"@react-spring/web@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.0\"\n-    \"@react-spring/core\": \"npm:~10.0.0\"\n-    \"@react-spring/shared\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/animated\": \"npm:~10.0.1\"\n+    \"@react-spring/core\": \"npm:~10.0.1\"\n+    \"@react-spring/shared\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n     react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/2218c87d9bfafab78b3079d94ea89ab9b95cb174910be5682fd8f5fc73e326ca956e9b844e5b255d1e3402138ad26981fae2fc1091d682a78359044a63b6421e\n+  checksum: 10c0/a0c788c9fd881ccb834feb22fc0694e74e59f7b76e498f0096f5b65e2c9812513955bf45ee27d7c5348f56a7bba7c5a6961d4be663728bb2172fe5aa6b6bdfc4\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -6678,9 +6678,9 @@ __metadata:\n   linkType: hard\n \n \"core-js@npm:^3.30.2\":\n-  version: 3.41.0\n-  resolution: \"core-js@npm:3.41.0\"\n-  checksum: 10c0/a29ed0b7fe81acf49d04ce5c17a1947166b1c15197327a5d12f95bbe84b46d60c3c13de701d808f41da06fa316285f3f55ce5903abc8d5642afc1eac4457afc8\n+  version: 3.42.0\n+  resolution: \"core-js@npm:3.42.0\"\n+  checksum: 10c0/2913d3d5452d54ad92f058d66046782d608c05e037bcc523aab79c04454fe640998f94e6011292969d66dfa472f398b085ce843dcb362056532a5799c627184e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nExample queries that were not possible before:\r\n\r\n|Username|Display name|Query|Possible before|Possible after|\r\n|--|--|--|--|--|\r\n|mike|Mike McCue|mikemccue|**No**|Yes|\r\n|||Mike M|**No**|Yes|\r\n|||mike mc cue|**No**|Yes|\r\n|||mike mccue mike|Yes|Yes|\r\n|||mccue|Yes|Yes|\r\n|gargron|Eugen Rochko|eugenrochko|**No**|Yes|\r\n|||Eugen Rochko gargron|**No**|Yes|\r\n|||Eugen gargron|**No**|Yes|\r\n|||gar gron|**No**|Yes|\r\n|||rochko|Yes|Yes|\r\n\r\nNote: This adds a new analyzer to the index, however, the analyzer is used during query-time, not indexing-time, so technically re-indexing all documents is not necessary.\r\n\r\n___ \r\n\r\nFixes MAS-348\n\n---\n\nChoice A:\nGemfile.lock\n@@ -743,7 +743,7 @@ GEM\n       rspec-mocks (~> 3.0)\n       sidekiq (>= 5, < 9)\n     rspec-support (3.13.2)\n-    rubocop (1.75.2)\n+    rubocop (1.75.3)\n       json (~> 2.3)\n       language_server-protocol (~> 3.17.0.2)\n       lint_roller (~> 1.1.0)\n@@ -773,7 +773,7 @@ GEM\n       rack (>= 1.1)\n       rubocop (>= 1.75.0, < 2.0)\n       rubocop-ast (>= 1.38.0, < 2.0)\n-    rubocop-rspec (3.5.0)\n+    rubocop-rspec (3.6.0)\n       lint_roller (~> 1.1)\n       rubocop (~> 1.72, >= 1.72.1)\n     rubocop-rspec_rails (2.31.0)\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -620,7 +620,7 @@ GEM\n     psych (5.2.3)\n       date\n       stringio\n-    public_suffix (6.0.1)\n+    public_suffix (6.0.2)\n     puma (6.6.0)\n       nio4r (~> 2.0)\n     pundit (2.5.0)\n---\n\n\n---\n\nChoice C:\nlib/mastodon/cli/search.rb\n@@ -20,6 +20,7 @@ class Search < Base\n     option :import, type: :boolean, default: true, desc: 'Import data from the database to the index'\n     option :clean, type: :boolean, default: true, desc: 'Remove outdated documents from the index'\n     option :reset_chewy, type: :boolean, default: false, desc: \"Reset Chewy's internal index\"\n+    option :only_mapping, type: :boolean, default: false, desc: 'Update the index specification without re-index'\n     desc 'deploy', 'Create or upgrade Elasticsearch indices and populate them'\n     long_desc <<~LONG_DESC\n       If Elasticsearch is empty, this command will create the necessary indices\n@@ -52,6 +53,20 @@ def deploy\n \n       Chewy::Stash::Specification.reset! if options[:reset_chewy]\n \n+      if options[:only_mapping]\n+        indices.select { |index| index.specification.changed? }.each do |index|\n+          progress.title = \"Updating mapping for #{index} \"\n+          index.update_mapping\n+          index.specification.lock!\n+        end\n+\n+        progress.title = 'Done! '\n+        progress.finish\n+\n+        say('Updated index mappings', :green, true)\n+        return\n+      end\n+\n       # First, ensure all indices are created and have the correct\n       # structure, so that live data can already be written\n       indices.select { |index| index.specification.changed? }.each do |index|\n---\n\n\n---\n\nChoice D:\napp/chewy/accounts_index.rb\n@@ -19,9 +19,16 @@ class AccountsIndex < Chewy::Index\n         type: 'stemmer',\n         language: 'possessive_english',\n       },\n+\n+      word_joiner: {\n+        type: 'shingle',\n+        output_unigrams: true,\n+        token_separator: '',\n+      },\n     },\n \n     analyzer: {\n+      # \"The FOOING's bar\" becomes \"foo bar\"\n       natural: {\n         tokenizer: 'standard',\n         filter: %w(\n@@ -35,11 +42,20 @@ class AccountsIndex < Chewy::Index\n         ),\n       },\n \n+      # \"FOO bar\" becomes \"foo bar\"\n       verbatim: {\n         tokenizer: 'standard',\n         filter: %w(lowercase asciifolding cjk_width),\n       },\n \n+      # \"Foo bar\" becomes \"foo bar foobar\"\n+      word_join_analyzer: {\n+        type: 'custom',\n+        tokenizer: 'standard',\n+        filter: %w(lowercase asciifolding cjk_width word_joiner),\n+      },\n+\n+      # \"Foo bar\" becomes \"f fo foo b ba bar\"\n       edge_ngram: {\n         tokenizer: 'edge_ngram',\n         filter: %w(lowercase asciifolding cjk_width),\n---\napp/services/account_search_service.rb\n@@ -128,11 +128,37 @@ class FullQueryBuilder < QueryBuilder\n \n     def core_query\n       {\n-        multi_match: {\n-          query: @query,\n-          type: 'best_fields',\n-          fields: %w(username^2 display_name^2 text text.*),\n-          operator: 'and',\n+        dis_max: {\n+          queries: [\n+            {\n+              match: {\n+                username: {\n+                  query: @query,\n+                  analyzer: 'word_join_analyzer',\n+                },\n+              },\n+            },\n+\n+            {\n+              match: {\n+                display_name: {\n+                  query: @query,\n+                  analyzer: 'word_join_analyzer',\n+                },\n+              },\n+            },\n+\n+            {\n+              multi_match: {\n+                query: @query,\n+                type: 'best_fields',\n+                fields: %w(text text.*),\n+                operator: 'and',\n+              },\n+            },\n+          ],\n+\n+          tie_breaker: 0.5,\n         },\n       }\n     end\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nIncludes misc other bumps\n\n---\n\nChoice A:\napp/javascript/mastodon/features/account_timeline/components/account_header.tsx\n@@ -1023,7 +1023,7 @@ export const AccountHeader: React.FC<{\n                   />\n                 </NavLink>\n               </div>\n-              <FamiliarFollowers accountId={accountId} />\n+              {signedIn && <FamiliarFollowers accountId={accountId} />}\n             </div>\n           )}\n         </div>\n---\n\n\n---\n\nChoice B:\nconfig/locales/ko.yml\n@@ -316,6 +316,7 @@ ko:\n         create: \uacf5\uc9c0\uc0ac\ud56d \uc0dd\uc131\n         title: \uc0c8 \uacf5\uc9c0\uc0ac\ud56d\n       preview:\n+        disclaimer: \uc0ac\uc6a9\uc790\ub4e4\uc740 \uc218\uc2e0\uc124\uc815\uc744 \ub04c \uc218 \uc5c6\uae30 \ub54c\ubb38\uc5d0 \uc774\uba54\uc77c \uc54c\ub9bc\uc740 \uac1c\uc778\uc815\ubcf4 \uc720\ucd9c\uc774\ub098 \uc11c\ubc84 \uc885\ub8cc\uc640 \uac19\uc740 \uc911\uc694\ud55c \uacf5\uc9c0\uc0ac\ud56d\uc5d0\ub9cc \uc0ac\uc6a9\ud574\uc57c \ud569\ub2c8\ub2e4.\n         explanation_html: \"<strong>%{display_count} \uba85\uc758 \uc0ac\uc6a9\uc790</strong>\uc5d0\uac8c \uc774\uba54\uc77c\uc774 \ubc1c\uc1a1\ub429\ub2c8\ub2e4. \ub2e4\uc74c \ub0b4\uc6a9\uc774 \uc774\uba54\uc77c\uc5d0 \ud3ec\ud568\ub429\ub2c8\ub2e4:\"\n         title: \uacf5\uc9c0\uc0ac\ud56d \uc54c\ub9bc \ubbf8\ub9ac\ubcf4\uae30\n       publish: \uac8c\uc2dc\n---\nconfig/locales/simple_form.ko.yml\n@@ -146,6 +146,7 @@ ko:\n         min_age: \uad00\ud560\uc9c0\uc5ed\uc758 \ubc95\ub960\uc5d0\uc11c \uc694\uad6c\ud558\ub294 \ucd5c\uc800 \uc5f0\ub839\ubcf4\ub2e4 \uc791\uc73c\uba74 \uc548 \ub429\ub2c8\ub2e4.\n       user:\n         chosen_languages: \uccb4\ud06c\ud558\uba74, \uc120\ud0dd \ub41c \uc5b8\uc5b4\ub85c \uc791\uc131\ub41c \uac8c\uc2dc\ubb3c\ub4e4\ub9cc \uacf5\uac1c \ud0c0\uc784\ub77c\uc778\uc5d0 \ubcf4\uc5ec\uc9d1\ub2c8\ub2e4\n+        date_of_birth: \ub9c8\uc2a4\ud1a0\ub3c8\uc744 \uc0ac\uc6a9\ud558\ub824\uba74 %{age}\uc138 \uc774\uc0c1\uc784\uc744 \ud655\uc778\ud574\uc57c \ud569\ub2c8\ub2e4. \uc774 \uc815\ubcf4\ub294 \uc800\uc7a5\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.\n         role: \uc5ed\ud560\uc740 \uc0ac\uc6a9\uc790\uac00 \uc5b4\ub5a4 \uad8c\ud55c\uc744 \uac00\uc9c0\uac8c \ub420 \uc9c0 \uacb0\uc815\ud569\ub2c8\ub2e4.\n       user_role:\n         color: \uc0c9\uc0c1\uc740 \uc0ac\uc6a9\uc790 \uc778\ud130\ud398\uc774\uc2a4\uc5d0\uc11c \uc5ed\ud560\uc744 \ub098\ud0c0\ub0b4\uae30 \uc704\ud574 \uc0ac\uc6a9\ub418\uba70, RGB 16\uc9c4\uc218 \ud615\uc2dd\uc785\ub2c8\ub2e4\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -94,7 +94,7 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1080.0)\n+    aws-partitions (1.1087.0)\n     aws-sdk-core (3.215.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n@@ -120,7 +120,7 @@ GEM\n       rack (>= 0.9.0)\n       rouge (>= 1.0.0)\n     bigdecimal (3.1.9)\n-    bindata (2.5.0)\n+    bindata (2.5.1)\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n@@ -227,7 +227,7 @@ GEM\n     fabrication (2.31.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n-    faraday (2.12.2)\n+    faraday (2.13.0)\n       faraday-net_http (>= 2.0, < 3.5)\n       json\n       logger\n@@ -239,7 +239,7 @@ GEM\n       net-http (>= 0.5.0)\n     fast_blank (1.0.1)\n     fastimage (2.4.0)\n-    ffi (1.17.1)\n+    ffi (1.17.2)\n     ffi-compiler (1.3.2)\n       ffi (>= 1.15.5)\n       rake\n@@ -426,7 +426,7 @@ GEM\n     mime-types (3.6.2)\n       logger\n       mime-types-data (~> 3.2015)\n-    mime-types-data (3.2025.0402)\n+    mime-types-data (3.2025.0408)\n     mini_mime (1.1.5)\n     mini_portile2 (2.8.8)\n     minitest (5.25.5)\n@@ -585,8 +585,8 @@ GEM\n     ostruct (0.6.1)\n     ox (2.14.22)\n       bigdecimal (>= 3.0)\n-    parallel (1.26.3)\n-    parser (3.3.7.4)\n+    parallel (1.27.0)\n+    parser (3.3.8.0)\n       ast (~> 2.4.1)\n       racc\n     parslet (2.0.0)\n@@ -751,7 +751,7 @@ GEM\n       rubocop-ast (>= 1.44.0, < 2.0)\n       ruby-progressbar (~> 1.7)\n       unicode-display_width (>= 2.4.0, < 4.0)\n-    rubocop-ast (1.44.0)\n+    rubocop-ast (1.44.1)\n       parser (>= 3.3.7.2)\n       prism (~> 1.4)\n     rubocop-capybara (2.22.1)\n@@ -1085,4 +1085,4 @@ RUBY VERSION\n    ruby 3.4.1p0\n \n BUNDLED WITH\n-   2.6.7\n+   2.6.8\n---\n\n\n---\n\nChoice D:\nspec/lib/activitypub/activity/remove_spec.rb\n@@ -4,29 +4,60 @@\n \n RSpec.describe ActivityPub::Activity::Remove do\n   let(:sender) { Fabricate(:account, featured_collection_url: 'https://example.com/featured') }\n-  let(:status) { Fabricate(:status, account: sender) }\n-\n-  let(:json) do\n-    {\n-      '@context': 'https://www.w3.org/ns/activitystreams',\n-      id: 'foo',\n-      type: 'Add',\n-      actor: ActivityPub::TagManager.instance.uri_for(sender),\n-      object: ActivityPub::TagManager.instance.uri_for(status),\n-      target: sender.featured_collection_url,\n-    }.with_indifferent_access\n-  end\n \n   describe '#perform' do\n     subject { described_class.new(json, sender) }\n \n-    before do\n-      StatusPin.create!(account: sender, status: status)\n-      subject.perform\n+    context 'when removing a pinned status' do\n+      let(:status) { Fabricate(:status, account: sender) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: ActivityPub::TagManager.instance.uri_for(status),\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        StatusPin.create!(account: sender, status: status)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.pinned?(status) }.to(false)\n+      end\n     end\n \n-    it 'removes a pin' do\n-      expect(sender.pinned?(status)).to be false\n+    context 'when removing a featured tag' do\n+      let(:tag) { Fabricate(:tag) }\n+\n+      let(:json) do\n+        {\n+          '@context': 'https://www.w3.org/ns/activitystreams',\n+          id: 'foo',\n+          type: 'Remove',\n+          actor: ActivityPub::TagManager.instance.uri_for(sender),\n+          object: {\n+            type: 'Hashtag',\n+            name: \"##{tag.display_name}\",\n+            href: \"https://example.com/tags/#{tag.name}\",\n+          },\n+          target: sender.featured_collection_url,\n+        }.deep_stringify_keys\n+      end\n+\n+      before do\n+        sender.featured_tags.find_or_create_by!(name: tag.name)\n+      end\n+\n+      it 'removes a pin' do\n+        expect { subject.perform }\n+          .to change { sender.featured_tags.exists?(tag: tag) }.to(false)\n+      end\n     end\n   end\n end\n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nBackground: https://github.com/mastodon/mastodon/pull/34434\n\n---\n\nChoice A:\napp/controllers/api/v1/lists_controller.rb\n@@ -7,10 +7,6 @@ class Api::V1::ListsController < Api::BaseController\n   before_action :require_user!\n   before_action :set_list, except: [:index, :create]\n \n-  rescue_from ArgumentError do |e|\n-    render json: { error: e.to_s }, status: 422\n-  end\n-\n   def index\n     @lists = List.where(account: current_account).all\n     render json: @lists, each_serializer: REST::ListSerializer\n---\napp/models/list.rb\n@@ -18,7 +18,7 @@ class List < ApplicationRecord\n \n   PER_ACCOUNT_LIMIT = 50\n \n-  enum :replies_policy, { list: 0, followed: 1, none: 2 }, prefix: :show\n+  enum :replies_policy, { list: 0, followed: 1, none: 2 }, prefix: :show, validate: true\n \n   belongs_to :account\n \n---\nspec/requests/api/v1/lists_spec.rb\n@@ -132,9 +132,12 @@\n       it 'returns http unprocessable entity' do\n         subject\n \n-        expect(response).to have_http_status(422)\n+        expect(response)\n+          .to have_http_status(422)\n         expect(response.content_type)\n           .to start_with('application/json')\n+        expect(response.parsed_body)\n+          .to include(error: /Replies policy is not included/)\n       end\n     end\n   end\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/home_timeline/components/column_settings.tsx\n@@ -40,6 +40,19 @@ export const ColumnSettings: React.FC = () => {\n             }\n           />\n \n+          <SettingToggle\n+            prefix='home_timeline'\n+            settings={settings}\n+            settingPath={['shows', 'quote']}\n+            onChange={onChange}\n+            label={\n+              <FormattedMessage\n+                id='home.column_settings.show_quotes'\n+                defaultMessage='Show quotes'\n+              />\n+            }\n+          />\n+\n           <SettingToggle\n             prefix='home_timeline'\n             settings={settings}\n---\napp/javascript/mastodon/features/ui/containers/status_list_container.js\n@@ -17,19 +17,22 @@ const makeGetStatusIds = (pending = false) => createSelector([\n     if (id === null || id === 'inline-follow-suggestions') return true;\n \n     const statusForId = statuses.get(id);\n-    let showStatus    = true;\n \n     if (statusForId.get('account') === me) return true;\n \n-    if (columnSettings.getIn(['shows', 'reblog']) === false) {\n-      showStatus = showStatus && statusForId.get('reblog') === null;\n+    if (columnSettings.getIn(['shows', 'reblog']) === false && statusForId.get('reblog') !== null) {\n+      return false;\n     }\n \n-    if (columnSettings.getIn(['shows', 'reply']) === false) {\n-      showStatus = showStatus && (statusForId.get('in_reply_to_id') === null || statusForId.get('in_reply_to_account_id') === me);\n+    if (columnSettings.getIn(['shows', 'reply']) === false && statusForId.get('in_reply_to_id') !== null && statusForId.get('in_reply_to_account_id') !== me) {\n+      return false;\n     }\n \n-    return showStatus;\n+    if (columnSettings.getIn(['shows', 'quote']) === false && statusForId.get('quote') !== null) {\n+      return false;\n+    }\n+\n+    return true;\n   });\n });\n \n---\napp/javascript/mastodon/locales/en.json\n@@ -430,6 +430,7 @@\n   \"hints.profiles.see_more_posts\": \"See more posts on {domain}\",\n   \"hints.threads.replies_may_be_missing\": \"Replies from other servers may be missing.\",\n   \"hints.threads.see_more\": \"See more replies on {domain}\",\n+  \"home.column_settings.show_quotes\": \"Show quotes\",\n   \"home.column_settings.show_reblogs\": \"Show boosts\",\n   \"home.column_settings.show_replies\": \"Show replies\",\n   \"home.hide_announcements\": \"Hide announcements\",\n---\napp/javascript/mastodon/reducers/settings.js\n@@ -20,6 +20,7 @@ const initialState = ImmutableMap({\n \n   home: ImmutableMap({\n     shows: ImmutableMap({\n+      quote: true,\n       reblog: true,\n       reply: true,\n     }),\n---\n\n\n---\n\nChoice C:\nGemfile\n@@ -62,7 +62,7 @@ gem 'inline_svg'\n gem 'irb', '~> 1.8'\n gem 'kaminari', '~> 1.2'\n gem 'link_header', '~> 0.0'\n-gem 'linzer', '~> 0.6.1'\n+gem 'linzer', '~> 0.7.0'\n gem 'mario-redis-lock', '~> 1.2', require: 'redis_lock'\n gem 'mime-types', '~> 3.7.0', require: 'mime/types/columnar'\n gem 'mutex_m'\n---\nGemfile.lock\n@@ -148,6 +148,7 @@ GEM\n     case_transform (0.2)\n       activesupport\n     cbor (0.5.9.8)\n+    cgi (0.4.2)\n     charlock_holmes (0.7.9)\n     chewy (7.6.0)\n       activesupport (>= 5.2)\n@@ -262,6 +263,7 @@ GEM\n       fog-core (~> 2.1)\n       fog-json (>= 1.0)\n     formatador (1.1.0)\n+    forwardable (1.3.3)\n     fugit (1.11.1)\n       et-orbi (~> 1, >= 1.2.11)\n       raabro (~> 1.4)\n@@ -396,7 +398,11 @@ GEM\n       rexml\n     link_header (0.0.8)\n     lint_roller (1.1.0)\n-    linzer (0.6.5)\n+    linzer (0.7.0)\n+      cgi (~> 0.4.2)\n+      forwardable (~> 1.3, >= 1.3.3)\n+      logger (~> 1.7, >= 1.7.0)\n+      net-http (~> 0.6.0)\n       openssl (~> 3.0, >= 3.0.0)\n       rack (>= 2.2, < 4.0)\n       starry (~> 0.2)\n@@ -628,7 +634,7 @@ GEM\n       activesupport (>= 3.0.0)\n     raabro (1.4.0)\n     racc (1.8.1)\n-    rack (2.2.14)\n+    rack (2.2.15)\n     rack-attack (6.7.0)\n       rack (>= 1.0, < 4)\n     rack-cors (2.0.2)\n@@ -995,7 +1001,7 @@ DEPENDENCIES\n   letter_opener (~> 1.8)\n   letter_opener_web (~> 3.0)\n   link_header (~> 0.0)\n-  linzer (~> 0.6.1)\n+  linzer (~> 0.7.0)\n   lograge (~> 0.12)\n   mail (~> 2.8)\n   mario-redis-lock (~> 1.2)\n---\n\n\n---\n\nChoice D:\n.rubocop_todo.yml\n@@ -1,6 +1,6 @@\n # This configuration was generated by\n # `rubocop --auto-gen-config --auto-gen-only-exclude --no-offense-counts --no-auto-gen-timestamp`\n-# using RuboCop version 1.75.7.\n+# using RuboCop version 1.75.8.\n # The point is for the user to remove these configuration records\n # one by one as the offenses are removed from the code base.\n # Note that changes in the inspected code, or installation of new\n@@ -37,7 +37,6 @@ Style/FetchEnvVar:\n   Exclude:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/3_omniauth.rb'\n-    - 'config/initializers/cache_buster.rb'\n     - 'config/initializers/paperclip.rb'\n     - 'lib/tasks/repo.rake'\n \n---\napp/models/media_attachment.rb\n@@ -417,7 +417,7 @@ def reset_parent_cache\n \n   # Record the cache keys to burst before the file get actually deleted\n   def prepare_cache_bust!\n-    return unless Rails.configuration.x.cache_buster_enabled\n+    return unless Rails.configuration.x.cache_buster.enabled\n \n     @paths_to_cache_bust = MediaAttachment.attachment_definitions.keys.flat_map do |attachment_name|\n       attachment = public_send(attachment_name)\n@@ -434,7 +434,7 @@ def prepare_cache_bust!\n   # Once Paperclip has deleted the files, we can't recover the cache keys,\n   # so use the previously-saved ones\n   def bust_cache!\n-    return unless Rails.configuration.x.cache_buster_enabled\n+    return unless Rails.configuration.x.cache_buster.enabled\n \n     CacheBusterWorker.push_bulk(@paths_to_cache_bust) { |path| [path] }\n   rescue => e\n---\napp/services/suspend_account_service.rb\n@@ -95,7 +95,7 @@ def privatize_media_attachments!\n             end\n           end\n \n-          CacheBusterWorker.perform_async(attachment.url(style)) if Rails.configuration.x.cache_buster_enabled\n+          CacheBusterWorker.perform_async(attachment.url(style)) if Rails.configuration.x.cache_buster.enabled\n         end\n       end\n     end\n---\napp/services/unsuspend_account_service.rb\n@@ -91,7 +91,7 @@ def publish_media_attachments!\n             end\n           end\n \n-          CacheBusterWorker.perform_async(attachment.url(style)) if Rails.configuration.x.cache_buster_enabled\n+          CacheBusterWorker.perform_async(attachment.url(style)) if Rails.configuration.x.cache_buster.enabled\n         end\n       end\n     end\n---\nconfig/application.rb\n@@ -103,6 +103,7 @@ class Application < Rails::Application\n       end\n     end\n \n+    config.x.cache_buster = config_for(:cache_buster)\n     config.x.captcha = config_for(:captcha)\n     config.x.mastodon = config_for(:mastodon)\n     config.x.translation = config_for(:translation)\n---\nconfig/cache_buster.yml\n@@ -0,0 +1,5 @@\n+shared:\n+  enabled: <%= ENV.fetch('CACHE_BUSTER_ENABLED', 'false') == 'true' %>\n+  secret_header: <%= ENV.fetch('CACHE_BUSTER_SECRET_HEADER', nil) %>\n+  secret: <%= ENV.fetch('CACHE_BUSTER_SECRET', nil) %>\n+  http_method: <%= ENV.fetch('CACHE_BUSTER_HTTP_METHOD', 'GET') %>\n---\nconfig/initializers/cache_buster.rb\n@@ -1,11 +0,0 @@\n-# frozen_string_literal: true\n-\n-Rails.application.configure do\n-  config.x.cache_buster_enabled = ENV['CACHE_BUSTER_ENABLED'] == 'true'\n-\n-  config.x.cache_buster = {\n-    secret_header: ENV['CACHE_BUSTER_SECRET_HEADER'],\n-    secret: ENV['CACHE_BUSTER_SECRET'],\n-    http_method: ENV['CACHE_BUSTER_HTTP_METHOD'] || 'GET',\n-  }\n-end\n---\nspec/models/media_attachment_spec.rb\n@@ -291,7 +291,7 @@\n     let(:media) { Fabricate(:media_attachment) }\n \n     before do\n-      allow(Rails.configuration.x).to receive(:cache_buster_enabled).and_return(true)\n+      allow(Rails.configuration.x.cache_buster).to receive(:enabled).and_return(true)\n     end\n \n     it 'queues CacheBusterWorker jobs' do\n---\nspec/services/suspend_account_service_spec.rb\n@@ -11,7 +11,7 @@\n \n     before do\n       allow(FeedManager.instance).to receive_messages(unmerge_from_home: nil, unmerge_from_list: nil)\n-      allow(Rails.configuration.x).to receive(:cache_buster_enabled).and_return(true)\n+      allow(Rails.configuration.x.cache_buster).to receive(:enabled).and_return(true)\n \n       local_follower.follow!(account)\n       list.accounts << account\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [yarn](https://redirect.github.com/yarnpkg/berry) ([source](https://redirect.github.com/yarnpkg/berry/tree/HEAD/packages/yarnpkg-cli)) | [`4.9.0` -> `4.9.1`](https://renovatebot.com/diffs/npm/yarn/4.9.0/4.9.1) | [![age](https://developer.mend.io/api/mc/badges/age/npm/@yarnpkg%2fcli/4.9.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/@yarnpkg%2fcli/4.9.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/@yarnpkg%2fcli/4.9.0/4.9.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/@yarnpkg%2fcli/4.9.0/4.9.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>yarnpkg/berry (yarn)</summary>\n\n### [`v4.9.1`](https://redirect.github.com/yarnpkg/berry/compare/2b26e3dff6fae778931445e8aca469e4bc2abac2...1908ee79fdf80fc8397d8ff928f3bfe25f30e715)\n\n[Compare Source](https://redirect.github.com/yarnpkg/berry/compare/2b26e3dff6fae778931445e8aca469e4bc2abac2...1908ee79fdf80fc8397d8ff928f3bfe25f30e715)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yMzguMCIsInVwZGF0ZWRJblZlciI6IjM5LjIzOC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nCONTRIBUTING.md\n@@ -23,6 +23,11 @@ Bug reports and feature suggestions must use descriptive and concise titles and\n be submitted to [GitHub Issues]. Please use the search function to make sure\n there are not duplicate bug reports or feature requests.\n \n+## Security Issues\n+\n+If you believe you have identified a security issue in Mastodon or our own apps,\n+check [SECURITY].\n+\n ## Translations\n \n Translations are community contributed via [Crowdin]. They are periodically\n@@ -83,3 +88,4 @@ and API docs. Improvements are made via PRs to the [documentation repository].\n [GitHub Issues]: https://github.com/mastodon/mastodon/issues\n [keepachangelog]: https://keepachangelog.com/en/1.0.0/\n [Mastodon documentation]: https://docs.joinmastodon.org\n+[SECURITY]: SECURITY.md\n---\nREADME.md\n@@ -77,12 +77,12 @@ accepted into Mastodon, you can request to be paid through our [OpenCollective].\n \n ## License\n \n-Copyright (c) 2016-2024 Eugen Rochko (+ [`mastodon authors`](AUTHORS.md))\n+Copyright (c) 2016-2025 Eugen Rochko (+ [`mastodon authors`](AUTHORS.md))\n \n Licensed under GNU Affero General Public License as stated in the [LICENSE](LICENSE):\n \n ```\n-Copyright (c) 2016-2024 Eugen Rochko & other Mastodon contributors\n+Copyright (c) 2016-2025 Eugen Rochko & other Mastodon contributors\n \n This program is free software: you can redistribute it and/or modify it under\n the terms of the GNU Affero General Public License as published by the Free\n---\n\n\n---\n\nChoice B:\napp/javascript/mastodon/features/video/components/hotkey_indicator.tsx\n@@ -24,7 +24,9 @@ export const HotkeyIndicator: React.FC<{\n     enter: [{ opacity: 1 }],\n     leave: [{ opacity: 0 }],\n     onRest: (_result, _ctrl, item) => {\n-      onDismiss(item);\n+      if (item) {\n+        onDismiss(item);\n+      }\n     },\n   });\n \n---\npackage.json\n@@ -44,7 +44,7 @@\n     \"@github/webauthn-json\": \"^2.1.1\",\n     \"@optimize-lodash/rollup-plugin\": \"^5.0.2\",\n     \"@rails/ujs\": \"7.1.501\",\n-    \"@react-spring/web\": \"^9.7.5\",\n+    \"@react-spring/web\": \"^10.0.0\",\n     \"@reduxjs/toolkit\": \"^2.0.1\",\n     \"@use-gesture/react\": \"^10.3.1\",\n     \"@vitejs/plugin-react\": \"^4.2.1\",\n---\nyarn.lock\n@@ -2451,7 +2451,7 @@ __metadata:\n     \"@github/webauthn-json\": \"npm:^2.1.1\"\n     \"@optimize-lodash/rollup-plugin\": \"npm:^5.0.2\"\n     \"@rails/ujs\": \"npm:7.1.501\"\n-    \"@react-spring/web\": \"npm:^9.7.5\"\n+    \"@react-spring/web\": \"npm:^10.0.0\"\n     \"@reduxjs/toolkit\": \"npm:^2.0.1\"\n     \"@testing-library/dom\": \"npm:^10.2.0\"\n     \"@testing-library/react\": \"npm:^16.0.0\"\n@@ -2877,69 +2877,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/animated@npm:9.7.5\"\n+\"@react-spring/animated@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/animated@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/f8c2473c60f39a878c7dd0fdfcfcdbc720521e1506aa3f63c9de64780694a0a73d5ccc535a5ccec3520ddb70a71cf43b038b32c18e99531522da5388c510ecd7\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/a8c40aff22def6dbe964b1f79fa4a7774c44bf5eb47c2ef969c8ecb2a426b4c972b147bf18635d6972dbec3fb95e70dd84f22b43c904c32dfc7a57ad144a0879\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/core@npm:9.7.5\"\n+\"@react-spring/core@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/core@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~9.7.5\"\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/animated\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/5bfd83dfe248cd91889f215f015d908c7714ef445740fd5afa054b27ebc7d5a456abf6c309e2459d9b5b436e78d6fda16b62b9601f96352e9130552c02270830\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/39036a153dbd973443e23d90cb8e7be83201b1f0e4105f8427ddb4c9e9e50e590e1b46282829e0bb6f3deebfab004e30dcb4eec0e34c5ebb234d5060c06ecae5\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/rafz@npm:9.7.5\"\n-  checksum: 10c0/8bdad180feaa9a0e870a513043a5e98a4e9b7292a9f887575b7e6fadab2677825bc894b7ff16c38511b35bfe6cc1072df5851c5fee64448d67551559578ca759\n+\"@react-spring/rafz@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/rafz@npm:10.0.0\"\n+  checksum: 10c0/8d92bc553172fa883ec2121b9cc62bfb43ff5d6c4e76363c8ce100fb6c3dd67c3dd629931786f9d1d63ac95a5d6996e4a08693cd56dda685bdbaf39b60e97f66\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/shared@npm:9.7.5\"\n+\"@react-spring/shared@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/shared@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/rafz\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/0207eacccdedd918a2fc55e78356ce937f445ce27ad9abd5d3accba8f9701a39349b55115641dc2b39bb9d3a155b058c185b411d292dc8cc5686bfa56f73b94f\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/833c3f42d35d22ac47a2f756ac47d85a81bc1decc5e7915f46013823344374378f883135754de94d5b43d8fff3c55fc4a359044c9a44f9095bd1ef1f11a20d4d\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/types@npm:9.7.5\"\n-  checksum: 10c0/85c05121853cacb64f7cf63a4855e9044635e1231f70371cd7b8c78bc10be6f4dd7c68f592f92a2607e8bb68051540989b4677a2ccb525dba937f5cd95dc8bc1\n+\"@react-spring/types@npm:~10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/types@npm:10.0.0\"\n+  checksum: 10c0/ce1b959eaa8964f4004481d1e7c6eca0a8d636eb9f35ca654bdf77a78a860c0ff9eaa6bdc0cab84fc8a16be5c5fbb22b114249a2721bfc16191666670c0f44b3\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/web@npm:^9.7.5\":\n-  version: 9.7.5\n-  resolution: \"@react-spring/web@npm:9.7.5\"\n+\"@react-spring/web@npm:^10.0.0\":\n+  version: 10.0.0\n+  resolution: \"@react-spring/web@npm:10.0.0\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~9.7.5\"\n-    \"@react-spring/core\": \"npm:~9.7.5\"\n-    \"@react-spring/shared\": \"npm:~9.7.5\"\n-    \"@react-spring/types\": \"npm:~9.7.5\"\n+    \"@react-spring/animated\": \"npm:~10.0.0\"\n+    \"@react-spring/core\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.0\"\n+    \"@react-spring/types\": \"npm:~10.0.0\"\n   peerDependencies:\n-    react: ^16.8.0 || ^17.0.0 || ^18.0.0\n-    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0\n-  checksum: 10c0/bcd1e052e1b16341a12a19bf4515f153ca09d1fa86ff7752a5d02d7c4db58e8baf80e6283e64411f1e388c65340dce2254b013083426806b5dbae38bd151e53e\n+    react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+    react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n+  checksum: 10c0/2218c87d9bfafab78b3079d94ea89ab9b95cb174910be5682fd8f5fc73e326ca956e9b844e5b255d1e3402138ad26981fae2fc1091d682a78359044a63b6421e\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -10845,8 +10845,8 @@ __metadata:\n   linkType: hard\n \n \"sass@npm:^1.62.1\":\n-  version: 1.89.0\n-  resolution: \"sass@npm:1.89.0\"\n+  version: 1.89.1\n+  resolution: \"sass@npm:1.89.1\"\n   dependencies:\n     \"@parcel/watcher\": \"npm:^2.4.1\"\n     chokidar: \"npm:^4.0.0\"\n@@ -10857,7 +10857,7 @@ __metadata:\n       optional: true\n   bin:\n     sass: sass.js\n-  checksum: 10c0/8e31b48c5e0abd9d437edb201919a82863f605ace1c1536ccdc6b3133937a70fe29b92ad536af632ecae2f140733931e4ec971e1bfbf8b835c54d392b28331df\n+  checksum: 10c0/4406c441f71f5e0ec056345e6091cef51fd1786dac6e5b3eb1e87df464c40b3278219cc51df98309c36794503787ab0fe88fd45f2b0464f22000b68e755883ee\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice D:\npackage.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/mastodon\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.0\",\n+  \"packageManager\": \"yarn@4.9.1\",\n   \"engines\": {\n     \"node\": \">=18\"\n   },\n---\nstreaming/package.json\n@@ -1,7 +1,7 @@\n {\n   \"name\": \"@mastodon/streaming\",\n   \"license\": \"AGPL-3.0-or-later\",\n-  \"packageManager\": \"yarn@4.9.0\",\n+  \"packageManager\": \"yarn@4.9.1\",\n   \"engines\": {\n     \"node\": \">=18\"\n   },\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [marky](https://redirect.github.com/nolanlawson/marky) | [`1.2.5` -> `1.3.0`](https://renovatebot.com/diffs/npm/marky/1.2.5/1.3.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/marky/1.3.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/marky/1.3.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/marky/1.2.5/1.3.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/marky/1.2.5/1.3.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>nolanlawson/marky (marky)</summary>\n\n### [`v1.3.0`](https://redirect.github.com/nolanlawson/marky/compare/v1.2.5...v1.3.0)\n\n[Compare Source](https://redirect.github.com/nolanlawson/marky/compare/v1.2.5...v1.3.0)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yMzguMCIsInVwZGF0ZWRJblZlciI6IjM5LjIzOC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -12001,9 +12001,9 @@ __metadata:\n   linkType: hard\n \n \"marky@npm:^1.2.5\":\n-  version: 1.2.5\n-  resolution: \"marky@npm:1.2.5\"\n-  checksum: 10c0/ca8a011f287dab1ac3291df720fc32b366c4cd767347b63722966650405ce71ec6566f71d1e22e1768bf6461a7fd689b9038e7df0fcfb62eacf3a5a6dcac249e\n+  version: 1.3.0\n+  resolution: \"marky@npm:1.3.0\"\n+  checksum: 10c0/6619cdb132fdc4f7cd3e2bed6eebf81a38e50ff4b426bbfb354db68731e4adfebf35ebfd7c8e5a6e846cbf9b872588c4f76db25782caee8c1529ec9d483bf98b\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -94,7 +94,7 @@ GEM\n     ast (2.4.3)\n     attr_required (1.0.2)\n     aws-eventstream (1.3.2)\n-    aws-partitions (1.1087.0)\n+    aws-partitions (1.1103.0)\n     aws-sdk-core (3.215.1)\n       aws-eventstream (~> 1, >= 1.3.0)\n       aws-partitions (~> 1, >= 1.992.0)\n@@ -109,7 +109,7 @@ GEM\n       aws-sigv4 (~> 1.5)\n     aws-sigv4 (1.11.0)\n       aws-eventstream (~> 1, >= 1.0.2)\n-    azure-blob (0.5.7)\n+    azure-blob (0.5.8)\n       rexml\n     base64 (0.2.0)\n     bcp47_spec (0.2.1)\n@@ -124,7 +124,7 @@ GEM\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n-    bootsnap (1.18.5)\n+    bootsnap (1.18.6)\n       msgpack (~> 1.2)\n     brakeman (7.0.2)\n       racc\n@@ -194,7 +194,7 @@ GEM\n     devise_pam_authenticatable2 (9.2.0)\n       devise (>= 4.0.0)\n       rpam2 (~> 4.0)\n-    diff-lcs (1.6.1)\n+    diff-lcs (1.6.2)\n     discard (1.4.0)\n       activerecord (>= 4.2, < 9.0)\n     docile (1.4.1)\n@@ -228,7 +228,7 @@ GEM\n     fabrication (2.31.0)\n     faker (3.5.1)\n       i18n (>= 1.8.11, < 2)\n-    faraday (2.13.0)\n+    faraday (2.13.1)\n       faraday-net_http (>= 2.0, < 3.5)\n       json\n       logger\n@@ -267,10 +267,10 @@ GEM\n       raabro (~> 1.4)\n     globalid (1.2.1)\n       activesupport (>= 6.1)\n-    google-protobuf (4.30.2)\n+    google-protobuf (4.31.0)\n       bigdecimal\n       rake (>= 13)\n-    googleapis-common-protos-types (1.19.0)\n+    googleapis-common-protos-types (1.20.0)\n       google-protobuf (>= 3.18, < 5.a)\n     haml (6.3.0)\n       temple (>= 0.8.2)\n@@ -338,7 +338,7 @@ GEM\n       azure-blob (~> 0.5.2)\n       hashie (~> 5.0)\n     jmespath (1.6.2)\n-    json (2.10.2)\n+    json (2.12.0)\n     json-canonicalization (1.0.0)\n     json-jwt (1.16.7)\n       activesupport (>= 4.2)\n@@ -411,7 +411,7 @@ GEM\n       activesupport (>= 4)\n       railties (>= 4)\n       request_store (~> 1.0)\n-    loofah (2.24.0)\n+    loofah (2.24.1)\n       crass (~> 1.0.2)\n       nokogiri (>= 1.12.0)\n     mail (2.8.1)\n@@ -427,9 +427,9 @@ GEM\n     mime-types (3.7.0)\n       logger\n       mime-types-data (~> 3.2025, >= 3.2025.0507)\n-    mime-types-data (3.2025.0507)\n+    mime-types-data (3.2025.0514)\n     mini_mime (1.1.5)\n-    mini_portile2 (2.8.8)\n+    mini_portile2 (2.8.9)\n     minitest (5.25.5)\n     msgpack (1.8.0)\n     multi_json (1.15.0)\n@@ -504,7 +504,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-active_support (~> 0.7)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n-    opentelemetry-instrumentation-action_pack (0.12.0)\n+    opentelemetry-instrumentation-action_pack (0.12.1)\n       opentelemetry-api (~> 1.0)\n       opentelemetry-instrumentation-base (~> 0.23.0)\n       opentelemetry-instrumentation-rack (~> 0.21)\n@@ -618,7 +618,7 @@ GEM\n       activesupport (>= 7.0.0)\n       rack\n       railties (>= 7.0.0)\n-    psych (5.2.3)\n+    psych (5.2.6)\n       date\n       stringio\n     public_suffix (6.0.2)\n@@ -710,7 +710,7 @@ GEM\n       railties (>= 5.2)\n     rexml (3.4.1)\n     rotp (6.3.0)\n-    rouge (4.5.1)\n+    rouge (4.5.2)\n     rpam2 (4.0.2)\n     rqrcode (3.1.0)\n       chunky_png (~> 1.0)\n@@ -727,7 +727,7 @@ GEM\n       rspec-support (~> 3.13.0)\n     rspec-github (3.0.0)\n       rspec-core (~> 3.0)\n-    rspec-mocks (3.13.3)\n+    rspec-mocks (3.13.4)\n       diff-lcs (>= 1.2.0, < 2.0)\n       rspec-support (~> 3.13.0)\n     rspec-rails (8.0.0)\n@@ -1092,4 +1092,4 @@ RUBY VERSION\n    ruby 3.4.1p0\n \n BUNDLED WITH\n-   2.6.8\n+   2.6.9\n---\n\n\n---\n\nChoice C:\napp/chewy/accounts_index.rb\n@@ -19,9 +19,16 @@ class AccountsIndex < Chewy::Index\n         type: 'stemmer',\n         language: 'possessive_english',\n       },\n+\n+      word_joiner: {\n+        type: 'shingle',\n+        output_unigrams: true,\n+        token_separator: '',\n+      },\n     },\n \n     analyzer: {\n+      # \"The FOOING's bar\" becomes \"foo bar\"\n       natural: {\n         tokenizer: 'standard',\n         filter: %w(\n@@ -35,11 +42,20 @@ class AccountsIndex < Chewy::Index\n         ),\n       },\n \n+      # \"FOO bar\" becomes \"foo bar\"\n       verbatim: {\n         tokenizer: 'standard',\n         filter: %w(lowercase asciifolding cjk_width),\n       },\n \n+      # \"Foo bar\" becomes \"foo bar foobar\"\n+      word_join_analyzer: {\n+        type: 'custom',\n+        tokenizer: 'standard',\n+        filter: %w(lowercase asciifolding cjk_width word_joiner),\n+      },\n+\n+      # \"Foo bar\" becomes \"f fo foo b ba bar\"\n       edge_ngram: {\n         tokenizer: 'edge_ngram',\n         filter: %w(lowercase asciifolding cjk_width),\n---\napp/services/account_search_service.rb\n@@ -128,11 +128,37 @@ class FullQueryBuilder < QueryBuilder\n \n     def core_query\n       {\n-        multi_match: {\n-          query: @query,\n-          type: 'best_fields',\n-          fields: %w(username^2 display_name^2 text text.*),\n-          operator: 'and',\n+        dis_max: {\n+          queries: [\n+            {\n+              match: {\n+                username: {\n+                  query: @query,\n+                  analyzer: 'word_join_analyzer',\n+                },\n+              },\n+            },\n+\n+            {\n+              match: {\n+                display_name: {\n+                  query: @query,\n+                  analyzer: 'word_join_analyzer',\n+                },\n+              },\n+            },\n+\n+            {\n+              multi_match: {\n+                query: @query,\n+                type: 'best_fields',\n+                fields: %w(text text.*),\n+                operator: 'and',\n+              },\n+            },\n+          ],\n+\n+          tie_breaker: 0.5,\n         },\n       }\n     end\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/locales/cy.json\n@@ -29,6 +29,7 @@\n   \"account.enable_notifications\": \"Rhowch wybod i fi pan fydd @{name} yn postio\",\n   \"account.endorse\": \"Dangos ar fy mhroffil\",\n   \"account.featured\": \"Nodwedd\",\n+  \"account.featured.accounts\": \"Proffilau\",\n   \"account.featured.hashtags\": \"Hashnodau\",\n   \"account.featured.posts\": \"Postiadau\",\n   \"account.featured_tags.last_status_at\": \"Y postiad olaf ar {date}\",\n@@ -405,8 +406,10 @@\n   \"hashtag.counter_by_accounts\": \"{count, plural, one {{counter} cyfranogwr} other {{counter} cyfranogwr}}\",\n   \"hashtag.counter_by_uses\": \"{count, plural, one {postiad {counter}} other {postiad {counter}}}\",\n   \"hashtag.counter_by_uses_today\": \"{count, plural, one {{counter} postiad} other {{counter} postiad}} heddiw\",\n+  \"hashtag.feature\": \"Nodwedd ar y proffil\",\n   \"hashtag.follow\": \"Dilyn hashnod\",\n   \"hashtag.mute\": \"Tewi #{hashtag}\",\n+  \"hashtag.unfeature\": \"Peidio a'i gynnwys ar y proffil\",\n   \"hashtag.unfollow\": \"Dad-ddilyn hashnod\",\n   \"hashtags.and_other\": \"\u2026a {count, plural, other {# arall}}\",\n   \"hints.profiles.followers_may_be_missing\": \"Mae'n bosibl bod dilynwyr y proffil hwn ar goll.\",\n---\napp/javascript/mastodon/locales/ko.json\n@@ -58,7 +58,7 @@\n   \"account.mute_short\": \"\ubba4\ud2b8\",\n   \"account.muted\": \"\ubba4\ud2b8\ub428\",\n   \"account.muting\": \"\ubba4\ud2b8\ud568\",\n-  \"account.mutual\": \"\uc11c\ub85c \ud314\ub85c\uc6b0\",\n+  \"account.mutual\": \"\ub9de\ud314\ub85c\uc6b0 \uc911\uc785\ub2c8\ub2e4\",\n   \"account.no_bio\": \"\uc81c\uacf5\ub41c \uc124\uba85\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.\",\n   \"account.open_original_page\": \"\uc6d0\ubcf8 \ud398\uc774\uc9c0 \uc5f4\uae30\",\n   \"account.posts\": \"\uac8c\uc2dc\ubb3c\",\n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nFix #34436\r\n\r\n## Overview\r\nThis PR disables kerning for Japanese text (content with lang='ja' attribute) to preserve monospaced alignment and improve readability.\r\n\r\n## Screenshots\r\n### English text (content with lang='en' attribute, unchanged):\r\n<img width=\"1512\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2025-04-14 16 29 13\" src=\"https://github.com/user-attachments/assets/177a0e68-1725-4ad5-975a-b5853a9d026a\" />\r\n\r\n\r\n### Japanese text (content with lang='ja' attribute, kerning disabled):\r\n<img width=\"1512\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2025-04-14 16 28 52\" src=\"https://github.com/user-attachments/assets/94c5a7f8-7d83-497a-85b8-8c4030f8e40a\" />\r\n\r\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -397,7 +397,7 @@ GEM\n       rexml\n     link_header (0.0.8)\n     lint_roller (1.1.0)\n-    linzer (0.7.2)\n+    linzer (0.7.3)\n       cgi (~> 0.4.2)\n       forwardable (~> 1.3, >= 1.3.3)\n       logger (~> 1.7, >= 1.7.0)\n---\n\n\n---\n\nChoice B:\napp/models/web/push_subscription.rb\n@@ -12,13 +12,13 @@\n #  standard        :boolean          default(FALSE), not null\n #  created_at      :datetime         not null\n #  updated_at      :datetime         not null\n-#  access_token_id :bigint(8)\n-#  user_id         :bigint(8)\n+#  access_token_id :bigint(8)        not null\n+#  user_id         :bigint(8)        not null\n #\n \n class Web::PushSubscription < ApplicationRecord\n-  belongs_to :user, optional: true\n-  belongs_to :access_token, class_name: 'Doorkeeper::AccessToken', optional: true\n+  belongs_to :user\n+  belongs_to :access_token, class_name: 'Doorkeeper::AccessToken'\n \n   has_one :session_activation, foreign_key: 'web_push_subscription_id', inverse_of: :web_push_subscription, dependent: nil\n \n@@ -28,32 +28,16 @@ class Web::PushSubscription < ApplicationRecord\n \n   validates_with WebPushKeyValidator\n \n-  delegate :locale, to: :associated_user\n+  delegate :locale, to: :user\n \n   generates_token_for :unsubscribe, expires_in: Web::PushNotificationWorker::TTL\n \n   def pushable?(notification)\n     policy_allows_notification?(notification) && alert_enabled_for_notification_type?(notification)\n   end\n \n-  def associated_user\n-    return @associated_user if defined?(@associated_user)\n-\n-    @associated_user = if user_id.nil?\n-                         session_activation.user\n-                       else\n-                         user\n-                       end\n-  end\n-\n   def associated_access_token\n-    return @associated_access_token if defined?(@associated_access_token)\n-\n-    @associated_access_token = if access_token_id.nil?\n-                                 find_or_create_access_token.token\n-                               else\n-                                 access_token.token\n-                               end\n+    access_token.token\n   end\n \n   class << self\n@@ -65,16 +49,6 @@ def unsubscribe_for(application_id, resource_owner)\n \n   private\n \n-  def find_or_create_access_token\n-    Doorkeeper::AccessToken.find_or_create_for(\n-      application: Doorkeeper::Application.find_by(superapp: true),\n-      resource_owner: user_id || session_activation.user_id,\n-      scopes: Doorkeeper::OAuth::Scopes.from_string('read write follow push'),\n-      expires_in: Doorkeeper.configuration.access_token_expires_in,\n-      use_refresh_token: Doorkeeper.configuration.refresh_token_enabled?\n-    )\n-  end\n-\n   def alert_enabled_for_notification_type?(notification)\n     truthy?(data&.dig('alerts', notification.type.to_s))\n   end\n---\napp/serializers/web/notification_serializer.rb\n@@ -13,7 +13,7 @@ def access_token\n   end\n \n   def preferred_locale\n-    current_push_subscription.associated_user&.locale || I18n.default_locale\n+    current_push_subscription.user&.locale || I18n.default_locale\n   end\n \n   def notification_id\n---\ndb/migrate/20250422083912_add_not_null_to_web_push_subscription_user.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddNotNullToWebPushSubscriptionUser < ActiveRecord::Migration[8.0]\n+  def change\n+    add_check_constraint :web_push_subscriptions, 'user_id IS NOT NULL', name: 'web_push_subscriptions_user_id_null', validate: false\n+  end\n+end\n---\ndb/migrate/20250422084214_validate_add_not_null_to_web_push_subscription_user.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ValidateAddNotNullToWebPushSubscriptionUser < ActiveRecord::Migration[8.0]\n+  def up\n+    connection.execute(<<~SQL.squish)\n+      DELETE FROM web_push_subscriptions\n+      WHERE user_id IS NULL\n+    SQL\n+\n+    validate_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_user_id_null'\n+    change_column_null :web_push_subscriptions, :user_id, false\n+    remove_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_user_id_null'\n+  end\n+\n+  def down\n+    add_check_constraint :web_push_subscriptions, 'user_id IS NOT NULL', name: 'web_push_subscriptions_user_id_null', validate: false\n+    change_column_null :web_push_subscriptions, :user_id, true\n+  end\n+end\n---\ndb/migrate/20250422085027_add_not_null_to_web_push_subscription_access_token.rb\n@@ -0,0 +1,7 @@\n+# frozen_string_literal: true\n+\n+class AddNotNullToWebPushSubscriptionAccessToken < ActiveRecord::Migration[8.0]\n+  def change\n+    add_check_constraint :web_push_subscriptions, 'access_token_id IS NOT NULL', name: 'web_push_subscriptions_access_token_id_null', validate: false\n+  end\n+end\n---\ndb/migrate/20250422085303_validate_add_not_null_to_web_push_subscription_access_token.rb\n@@ -0,0 +1,19 @@\n+# frozen_string_literal: true\n+\n+class ValidateAddNotNullToWebPushSubscriptionAccessToken < ActiveRecord::Migration[8.0]\n+  def up\n+    connection.execute(<<~SQL.squish)\n+      DELETE FROM web_push_subscriptions\n+      WHERE access_token_id IS NULL\n+    SQL\n+\n+    validate_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_access_token_id_null'\n+    change_column_null :web_push_subscriptions, :access_token_id, false\n+    remove_check_constraint :web_push_subscriptions, name: 'web_push_subscriptions_access_token_id_null'\n+  end\n+\n+  def down\n+    add_check_constraint :web_push_subscriptions, 'access_token_id IS NOT NULL', name: 'web_push_subscriptions_access_token_id_null', validate: false\n+    change_column_null :web_push_subscriptions, :access_token_id, true\n+  end\n+end\n---\ndb/schema.rb\n@@ -10,7 +10,7 @@\n #\n # It's strongly recommended that you check this file into your version control system.\n \n-ActiveRecord::Schema[8.0].define(version: 2025_04_11_095859) do\n+ActiveRecord::Schema[8.0].define(version: 2025_04_22_085303) do\n   # These are extensions that must be enabled in order to support this database\n   enable_extension \"pg_catalog.plpgsql\"\n \n@@ -1237,8 +1237,8 @@\n     t.json \"data\"\n     t.datetime \"created_at\", precision: nil, null: false\n     t.datetime \"updated_at\", precision: nil, null: false\n-    t.bigint \"access_token_id\"\n-    t.bigint \"user_id\"\n+    t.bigint \"access_token_id\", null: false\n+    t.bigint \"user_id\", null: false\n     t.boolean \"standard\", default: false, null: false\n     t.index [\"access_token_id\"], name: \"index_web_push_subscriptions_on_access_token_id\", where: \"(access_token_id IS NOT NULL)\"\n     t.index [\"user_id\"], name: \"index_web_push_subscriptions_on_user_id\"\n---\nspec/fabricators/web_push_subscription_fabricator.rb\n@@ -8,4 +8,6 @@\n     Base64.urlsafe_encode64(ecdh_key)\n   end\n   key_auth { Base64.urlsafe_encode64(Random.new.bytes(16)) }\n+  user { Fabricate(:user) }\n+  access_token { |attrs| Fabricate.build(:accessible_access_token, resource_owner_id: attrs[:user].id) }\n end\n---\nspec/requests/api/v1/push/subscriptions_spec.rb\n@@ -207,7 +207,8 @@ def create_subscription_with_token\n     Fabricate(\n       :web_push_subscription,\n       endpoint: create_payload[:subscription][:endpoint],\n-      access_token_id: token.id\n+      access_token: token,\n+      user: user\n     )\n   end\n end\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/locales/en-GB.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Moderated servers\",\n   \"about.contact\": \"Contact:\",\n+  \"about.default_locale\": \"Default\",\n   \"about.disclaimer\": \"Mastodon is free, open-source software, and a trademark of Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Reason not available\",\n   \"about.domain_blocks.preamble\": \"Mastodon generally allows you to view content from and interact with users from any other server in the Fediverse. These are the exceptions that have been made on this particular server.\",\n   \"about.domain_blocks.silenced.explanation\": \"You will generally not see profiles and content from this server, unless you explicitly look it up or opt into it by following.\",\n   \"about.domain_blocks.silenced.title\": \"Limited\",\n   \"about.domain_blocks.suspended.explanation\": \"No data from this server will be processed, stored or exchanged, making any interaction or communication with users from this server impossible.\",\n   \"about.domain_blocks.suspended.title\": \"Suspended\",\n+  \"about.language_label\": \"Language\",\n   \"about.not_available\": \"This information has not been made available on this server.\",\n   \"about.powered_by\": \"Decentralised social media powered by {mastodon}\",\n   \"about.rules\": \"Server rules\",\n@@ -19,10 +21,12 @@\n   \"account.block_domain\": \"Block domain {domain}\",\n   \"account.block_short\": \"Block\",\n   \"account.blocked\": \"Blocked\",\n+  \"account.blocking\": \"Blocking\",\n   \"account.cancel_follow_request\": \"Cancel follow\",\n   \"account.copy\": \"Copy link to profile\",\n   \"account.direct\": \"Privately mention @{name}\",\n   \"account.disable_notifications\": \"Stop notifying me when @{name} posts\",\n+  \"account.domain_blocking\": \"Blocking domain\",\n   \"account.edit_profile\": \"Edit profile\",\n   \"account.enable_notifications\": \"Notify me when @{name} posts\",\n   \"account.endorse\": \"Feature on profile\",\n---\napp/javascript/mastodon/locales/pt-PT.json\n@@ -1,13 +1,15 @@\n {\n   \"about.blocks\": \"Servidores moderados\",\n   \"about.contact\": \"Contacto:\",\n+  \"about.default_locale\": \"Padr\u00e3o\",\n   \"about.disclaimer\": \"O Mastodon \u00e9 um software livre, de c\u00f3digo aberto e uma marca registada de Mastodon gGmbH.\",\n   \"about.domain_blocks.no_reason_available\": \"Motivo n\u00e3o dispon\u00edvel\",\n   \"about.domain_blocks.preamble\": \"O Mastodon geralmente permite ver e interagir com o conte\u00fado de utilizadores de qualquer outra inst\u00e2ncia no fediverso. Estas s\u00e3o as exce\u00e7\u00f5es desta inst\u00e2ncia em espec\u00edfico.\",\n   \"about.domain_blocks.silenced.explanation\": \"Normalmente n\u00e3o ver\u00e1s perfis e conte\u00fados deste servidor, a n\u00e3o ser que os procures explicitamente ou optes por segui-los.\",\n   \"about.domain_blocks.silenced.title\": \"Limitados\",\n   \"about.domain_blocks.suspended.explanation\": \"Nenhum dado deste servidor ser\u00e1 processado, armazenado ou trocado, tornando imposs\u00edvel qualquer intera\u00e7\u00e3o ou comunica\u00e7\u00e3o com os utilizadores a partir deste servidor.\",\n   \"about.domain_blocks.suspended.title\": \"Suspensos\",\n+  \"about.language_label\": \"Idioma\",\n   \"about.not_available\": \"Esta informa\u00e7\u00e3o n\u00e3o foi disponibilizada neste servidor.\",\n   \"about.powered_by\": \"Rede social descentralizada baseada no {mastodon}\",\n   \"about.rules\": \"Regras do servidor\",\n@@ -308,6 +310,8 @@\n   \"emoji_button.search_results\": \"Resultados da pesquisa\",\n   \"emoji_button.symbols\": \"S\u00edmbolos\",\n   \"emoji_button.travel\": \"Viagens e lugares\",\n+  \"empty_column.account_featured.me\": \"Ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n+  \"empty_column.account_featured.other\": \"{acct} ainda n\u00e3o colocou nada em destaque. Sabia que pode destacar as etiquetas que mais utiliza e at\u00e9 as contas dos seus amigos no seu perfil?\",\n   \"empty_column.account_featured_other.unknown\": \"Esta conta ainda n\u00e3o colocou nada em destaque.\",\n   \"empty_column.account_hides_collections\": \"Este utilizador escolheu n\u00e3o disponibilizar esta informa\u00e7\u00e3o\",\n   \"empty_column.account_suspended\": \"Conta suspensa\",\n@@ -341,6 +345,11 @@\n   \"explore.trending_links\": \"Not\u00edcias\",\n   \"explore.trending_statuses\": \"Publica\u00e7\u00f5es\",\n   \"explore.trending_tags\": \"#Etiquetas\",\n+  \"featured_carousel.header\": \"{count, plural, one {Publica\u00e7\u00e3o Afixada} other {Publica\u00e7\u00f5es Afixadas}}\",\n+  \"featured_carousel.next\": \"Seguinte\",\n+  \"featured_carousel.post\": \"Publica\u00e7\u00e3o\",\n+  \"featured_carousel.previous\": \"Anterior\",\n+  \"featured_carousel.slide\": \"{index} de {total}\",\n   \"filter_modal.added.context_mismatch_explanation\": \"Esta categoria de filtro n\u00e3o se aplica ao contexto em que acedeste a esta publica\u00e7\u00e3o. Se pretenderes que esta publica\u00e7\u00e3o seja filtrada tamb\u00e9m neste contexto, ter\u00e1s que editar o filtro.\",\n   \"filter_modal.added.context_mismatch_title\": \"O contexto n\u00e3o coincide!\",\n   \"filter_modal.added.expired_explanation\": \"Esta categoria de filtro expirou, tens de alterar a data de validade para que ele seja aplicado.\",\n---\n\n\n---\n\nChoice D:\napp/javascript/styles/mastodon/basics.scss\n@@ -17,7 +17,12 @@ body {\n   font-weight: 400;\n   color: $primary-text-color;\n   text-rendering: optimizelegibility;\n-  font-feature-settings: 'kern';\n+\n+  // Disable kerning for Japanese text to preserve monospaced alignment for readability\n+  &:not(:lang(ja)) {\n+    font-feature-settings: 'kern';\n+  }\n+\n   text-size-adjust: none;\n   -webkit-tap-highlight-color: rgba(0, 0, 0, 0%);\n   -webkit-tap-highlight-color: transparent;\n---\n\n\n---\n\n"}], "ideal": "D"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [jsdom](https://redirect.github.com/jsdom/jsdom) | [`26.0.0` -> `26.1.0`](https://renovatebot.com/diffs/npm/jsdom/26.0.0/26.1.0) | [![age](https://developer.mend.io/api/mc/badges/age/npm/jsdom/26.1.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/jsdom/26.1.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/jsdom/26.0.0/26.1.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/jsdom/26.0.0/26.1.0?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>jsdom/jsdom (jsdom)</summary>\n\n### [`v26.1.0`](https://redirect.github.com/jsdom/jsdom/blob/HEAD/Changelog.md#2610)\n\n[Compare Source](https://redirect.github.com/jsdom/jsdom/compare/26.0.0...26.1.0)\n\n-   Added at least partial support for various SVG elements and their classes: `<defs>` (`SVGDefsElement`), `<desc>` (`SVGDescElement`), `<g>` (`SVGGElement`), `<metadata>` (`SVGMetadataElement`), `<switch>` (`SVGSwitchElement`), and `<symbol>` (`SVGSymbolElement`).\n-   Added `SVGAnimatedPreserveAspectRatio` and `SVGAnimatedRect`, including support in the reflection layer.\n-   Added the `SVGSVGElement` `createSVGRect()` method, and the `SVGRect` type (which is distinct from `DOMRect`.)\n-   Added indexed property support to `HTMLFormElement`.\n-   Updated the `SVGElement` `viewportElement()` method to correctly establish the viewport based on ancestor elements.\n-   Removed the now-bloated `form-data` dependency in favor of our own smaller implementation of `multipart/form-data` serialization. No functional changes are expected.\n-   Various performance improvements, caches, microoptimizations, and deferred object creation.\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yMzguMCIsInVwZGF0ZWRJblZlciI6IjM5LjIzOC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -7274,10 +7274,10 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"decimal.js@npm:^10.4.2, decimal.js@npm:^10.4.3\":\n-  version: 10.4.3\n-  resolution: \"decimal.js@npm:10.4.3\"\n-  checksum: 10c0/6d60206689ff0911f0ce968d40f163304a6c1bc739927758e6efc7921cfa630130388966f16bf6ef6b838cb33679fbe8e7a78a2f3c478afce841fd55ac8fb8ee\n+\"decimal.js@npm:^10.4.2, decimal.js@npm:^10.4.3, decimal.js@npm:^10.5.0\":\n+  version: 10.5.0\n+  resolution: \"decimal.js@npm:10.5.0\"\n+  checksum: 10c0/785c35279df32762143914668df35948920b6c1c259b933e0519a69b7003fc0a5ed2a766b1e1dda02574450c566b21738a45f15e274b47c2ac02072c0d1f3ac3\n   languageName: node\n   linkType: hard\n \n@@ -8996,7 +8996,7 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"form-data@npm:^4.0.0, form-data@npm:^4.0.1\":\n+\"form-data@npm:^4.0.0\":\n   version: 4.0.1\n   resolution: \"form-data@npm:4.0.1\"\n   dependencies:\n@@ -11373,13 +11373,12 @@ __metadata:\n   linkType: hard\n \n \"jsdom@npm:^26.0.0\":\n-  version: 26.0.0\n-  resolution: \"jsdom@npm:26.0.0\"\n+  version: 26.1.0\n+  resolution: \"jsdom@npm:26.1.0\"\n   dependencies:\n     cssstyle: \"npm:^4.2.1\"\n     data-urls: \"npm:^5.0.0\"\n-    decimal.js: \"npm:^10.4.3\"\n-    form-data: \"npm:^4.0.1\"\n+    decimal.js: \"npm:^10.5.0\"\n     html-encoding-sniffer: \"npm:^4.0.0\"\n     http-proxy-agent: \"npm:^7.0.2\"\n     https-proxy-agent: \"npm:^7.0.6\"\n@@ -11389,20 +11388,20 @@ __metadata:\n     rrweb-cssom: \"npm:^0.8.0\"\n     saxes: \"npm:^6.0.0\"\n     symbol-tree: \"npm:^3.2.4\"\n-    tough-cookie: \"npm:^5.0.0\"\n+    tough-cookie: \"npm:^5.1.1\"\n     w3c-xmlserializer: \"npm:^5.0.0\"\n     webidl-conversions: \"npm:^7.0.0\"\n     whatwg-encoding: \"npm:^3.1.1\"\n     whatwg-mimetype: \"npm:^4.0.0\"\n-    whatwg-url: \"npm:^14.1.0\"\n+    whatwg-url: \"npm:^14.1.1\"\n     ws: \"npm:^8.18.0\"\n     xml-name-validator: \"npm:^5.0.0\"\n   peerDependencies:\n     canvas: ^3.0.0\n   peerDependenciesMeta:\n     canvas:\n       optional: true\n-  checksum: 10c0/e48725ba4027edcfc9bca5799eaec72c6561ecffe3675a8ff87fe9c3541ca4ff9f82b4eff5b3d9c527302da0d859b2f60e9364347a5d42b77f5c76c436c569dc\n+  checksum: 10c0/5b14a5bc32ce077a06fb42d1ab95b1191afa5cbbce8859e3b96831c5143becbbcbf0511d4d4934e922d2901443ced2cdc3b734c1cf30b5f73b3e067ce457d0f4\n   languageName: node\n   linkType: hard\n \n@@ -17446,12 +17445,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"tough-cookie@npm:^5.0.0\":\n-  version: 5.0.0\n-  resolution: \"tough-cookie@npm:5.0.0\"\n+\"tough-cookie@npm:^5.1.1\":\n+  version: 5.1.2\n+  resolution: \"tough-cookie@npm:5.1.2\"\n   dependencies:\n     tldts: \"npm:^6.1.32\"\n-  checksum: 10c0/4a69c885bf6f45c5a64e60262af99e8c0d58a33bd3d0ce5da62121eeb9c00996d0128a72df8fc4614cbde59cc8b70aa3e21e4c3c98c2bbde137d7aba7fa00124\n+  checksum: 10c0/5f95023a47de0f30a902bba951664b359725597d8adeabc66a0b93a931c3af801e1e697dae4b8c21a012056c0ea88bd2bf4dfe66b2adcf8e2f42cd9796fe0626\n   languageName: node\n   linkType: hard\n \n@@ -17480,12 +17479,12 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"tr46@npm:^5.0.0\":\n-  version: 5.0.0\n-  resolution: \"tr46@npm:5.0.0\"\n+\"tr46@npm:^5.1.0\":\n+  version: 5.1.0\n+  resolution: \"tr46@npm:5.1.0\"\n   dependencies:\n     punycode: \"npm:^2.3.1\"\n-  checksum: 10c0/1521b6e7bbc8adc825c4561480f9fe48eb2276c81335eed9fa610aa4c44a48a3221f78b10e5f18b875769eb3413e30efbf209ed556a17a42aa8d690df44b7bee\n+  checksum: 10c0/d761f7144e0cb296187674ef245c74f761e334d7cf25ca73ef60e4c72c097c75051031c093fa1a2fee04b904977b316716a7915854bcae8fb1a371746513cbe8\n   languageName: node\n   linkType: hard\n \n@@ -18520,13 +18519,13 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"whatwg-url@npm:^14.0.0, whatwg-url@npm:^14.1.0\":\n-  version: 14.1.0\n-  resolution: \"whatwg-url@npm:14.1.0\"\n+\"whatwg-url@npm:^14.0.0, whatwg-url@npm:^14.1.1\":\n+  version: 14.2.0\n+  resolution: \"whatwg-url@npm:14.2.0\"\n   dependencies:\n-    tr46: \"npm:^5.0.0\"\n+    tr46: \"npm:^5.1.0\"\n     webidl-conversions: \"npm:^7.0.0\"\n-  checksum: 10c0/f00104f1c67ce086ba8ffedab529cbbd9aefd8c0a6555320026de7aeff31f91c38680f95818b140a7c9cc657cde3781e567835dda552ddb1e2b8faaba0ac3cb6\n+  checksum: 10c0/f746fc2f4c906607d09537de1227b13f9494c171141e5427ed7d2c0dd0b6a48b43d8e71abaae57d368d0c06b673fd8ec63550b32ad5ed64990c7b0266c2b4272\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -592,7 +592,7 @@ GEM\n       opentelemetry-api (~> 1.0)\n     orm_adapter (0.5.0)\n     ostruct (0.6.1)\n-    ox (2.14.22)\n+    ox (2.14.23)\n       bigdecimal (>= 3.0)\n     parallel (1.27.0)\n     parser (3.3.8.0)\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -124,7 +124,7 @@ GEM\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n-    bootsnap (1.18.4)\n+    bootsnap (1.18.5)\n       msgpack (~> 1.2)\n     brakeman (7.0.2)\n       racc\n---\n\n\n---\n\nChoice D:\nspec/helpers/theme_helper_spec.rb\n@@ -6,10 +6,10 @@\n   describe 'theme_style_tags' do\n     let(:result) { helper.theme_style_tags(theme) }\n \n-    context 'when using system theme' do\n+    context 'when using \"system\" theme' do\n       let(:theme) { 'system' }\n \n-      it 'returns the mastodon-light and default stylesheets with correct color schemes' do\n+      it 'returns the mastodon-light and application stylesheets with correct color schemes' do\n         expect(html_links.first.attributes.symbolize_keys)\n           .to include(\n             href: have_attributes(value: match(/mastodon-light/)),\n@@ -23,6 +23,17 @@\n       end\n     end\n \n+    context 'when using \"default\" theme' do\n+      let(:theme) { 'default' }\n+\n+      it 'returns the application stylesheet' do\n+        expect(html_links.last.attributes.symbolize_keys)\n+          .to include(\n+            href: have_attributes(value: match(/application/))\n+          )\n+      end\n+    end\n+\n     context 'when using other theme' do\n       let(:theme) { 'contrast' }\n \n---\n\n\n---\n\n"}], "ideal": "A"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [csv](https://redirect.github.com/ruby/csv) ([changelog](https://redirect.github.com/ruby/csv/releases/tag/v3.3.4)) | `3.3.3` -> `3.3.4` | [![age](https://developer.mend.io/api/mc/badges/age/rubygems/csv/3.3.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/rubygems/csv/3.3.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/rubygems/csv/3.3.3/3.3.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/rubygems/csv/3.3.3/3.3.4?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>ruby/csv (csv)</summary>\n\n### [`v3.3.4`](https://redirect.github.com/ruby/csv/releases/tag/v3.3.4): csv 3.3.4 - 2025-04-13\n\n[Compare Source](https://redirect.github.com/ruby/csv/compare/v3.3.3...v3.3.4)\n\n##### Improvements\n\n-   `csv-filter`: Removed an experimental command line tool.\n    -   [GH-341](https://redirect.github.com/ruby/csv/issues/341)\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yMzguMCIsInVwZGF0ZWRJblZlciI6IjM5LjIzOC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJydWJ5Il19-->\n\n\n---\n\nChoice A:\nGemfile.lock\n@@ -827,9 +827,9 @@ GEM\n       rufus-scheduler (~> 3.2)\n       sidekiq (>= 6, < 8)\n       tilt (>= 1.4.0, < 3)\n-    sidekiq-unique-jobs (8.0.10)\n+    sidekiq-unique-jobs (8.0.11)\n       concurrent-ruby (~> 1.0, >= 1.0.5)\n-      sidekiq (>= 7.0.0, < 8.0.0)\n+      sidekiq (>= 7.0.0, < 9.0.0)\n       thor (>= 1.0, < 3.0)\n     simple-navigation (4.4.0)\n       activesupport (>= 2.3.2)\n---\n\n\n---\n\nChoice B:\nGemfile.lock\n@@ -124,7 +124,7 @@ GEM\n     binding_of_caller (1.0.1)\n       debug_inspector (>= 1.2.0)\n     blurhash (0.1.8)\n-    bootsnap (1.18.5)\n+    bootsnap (1.18.6)\n       msgpack (~> 1.2)\n     brakeman (7.0.2)\n       racc\n---\n\n\n---\n\nChoice C:\nGemfile.lock\n@@ -170,7 +170,7 @@ GEM\n     crass (1.0.6)\n     css_parser (1.21.1)\n       addressable\n-    csv (3.3.3)\n+    csv (3.3.4)\n     database_cleaner-active_record (2.2.0)\n       activerecord (>= 5.a)\n       database_cleaner-core (~> 2.0.0)\n---\n\n\n---\n\nChoice D:\napp/javascript/mastodon/actions/accounts.js\n@@ -2,6 +2,7 @@ import { browserHistory } from 'mastodon/components/router';\n import { debounceWithDispatchAndArguments } from 'mastodon/utils/debounce';\n \n import api, { getLinks } from '../api';\n+import { me } from '../initial_state';\n \n import {\n   followAccountSuccess, unfollowAccountSuccess,\n@@ -12,6 +13,7 @@ import {\n   blockAccountSuccess, unblockAccountSuccess,\n   pinAccountSuccess, unpinAccountSuccess,\n   fetchRelationshipsSuccess,\n+  fetchEndorsedAccounts,\n } from './accounts_typed';\n import { importFetchedAccount, importFetchedAccounts } from './importer';\n \n@@ -634,6 +636,7 @@ export function pinAccount(id) {\n \n     api().post(`/api/v1/accounts/${id}/pin`).then(response => {\n       dispatch(pinAccountSuccess({ relationship: response.data }));\n+      dispatch(fetchEndorsedAccounts({ accountId: me }));\n     }).catch(error => {\n       dispatch(pinAccountFail(error));\n     });\n@@ -646,6 +649,7 @@ export function unpinAccount(id) {\n \n     api().post(`/api/v1/accounts/${id}/unpin`).then(response => {\n       dispatch(unpinAccountSuccess({ relationship: response.data }));\n+      dispatch(fetchEndorsedAccounts({ accountId: me }));\n     }).catch(error => {\n       dispatch(unpinAccountFail(error));\n     });\n---\napp/javascript/mastodon/components/account.tsx\n@@ -12,6 +12,8 @@ import {\n   muteAccount,\n   unmuteAccount,\n   followAccountSuccess,\n+  unpinAccount,\n+  pinAccount,\n } from 'mastodon/actions/accounts';\n import { showAlertForError } from 'mastodon/actions/alerts';\n import { openModal } from 'mastodon/actions/modal';\n@@ -62,14 +64,23 @@ const messages = defineMessages({\n   },\n });\n \n-export const Account: React.FC<{\n+interface AccountProps {\n   size?: number;\n   id: string;\n   hidden?: boolean;\n   minimal?: boolean;\n   defaultAction?: 'block' | 'mute';\n   withBio?: boolean;\n-}> = ({ id, size = 46, hidden, minimal, defaultAction, withBio }) => {\n+}\n+\n+export const Account: React.FC<AccountProps> = ({\n+  id,\n+  size = 46,\n+  hidden,\n+  minimal,\n+  defaultAction,\n+  withBio,\n+}) => {\n   const intl = useIntl();\n   const { signedIn } = useIdentity();\n   const account = useAppSelector((state) => state.accounts.get(id));\n@@ -119,8 +130,6 @@ export const Account: React.FC<{\n         },\n       ];\n     } else if (defaultAction !== 'block') {\n-      arr = [];\n-\n       if (isRemote && accountUrl) {\n         arr.push({\n           text: intl.formatMessage(messages.openOriginalPage),\n@@ -173,6 +182,25 @@ export const Account: React.FC<{\n           text: intl.formatMessage(messages.addToLists),\n           action: handleAddToLists,\n         });\n+\n+        if (id !== me && (relationship?.following || relationship?.requested)) {\n+          const handleEndorseToggle = () => {\n+            if (relationship.endorsed) {\n+              dispatch(unpinAccount(id));\n+            } else {\n+              dispatch(pinAccount(id));\n+            }\n+          };\n+          arr.push({\n+            text: intl.formatMessage(\n+              // Defined in features/account_timeline/components/account_header.tsx\n+              relationship.endorsed\n+                ? { id: 'account.unendorse' }\n+                : { id: 'account.endorse' },\n+            ),\n+            action: handleEndorseToggle,\n+          });\n+        }\n       }\n     }\n \n---\n\n\n---\n\n"}], "ideal": "C"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nThis PR contains the following updates:\n\n| Package | Change | Age | Adoption | Passing | Confidence |\n|---|---|---|---|---|---|\n| [ioredis](https://redirect.github.com/luin/ioredis) | [`5.6.0` -> `5.6.1`](https://renovatebot.com/diffs/npm/ioredis/5.6.0/5.6.1) | [![age](https://developer.mend.io/api/mc/badges/age/npm/ioredis/5.6.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![adoption](https://developer.mend.io/api/mc/badges/adoption/npm/ioredis/5.6.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![passing](https://developer.mend.io/api/mc/badges/compatibility/npm/ioredis/5.6.0/5.6.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) | [![confidence](https://developer.mend.io/api/mc/badges/confidence/npm/ioredis/5.6.0/5.6.1?slim=true)](https://docs.renovatebot.com/merge-confidence/) |\n\n---\n\n### Release Notes\n\n<details>\n<summary>luin/ioredis (ioredis)</summary>\n\n### [`v5.6.1`](https://redirect.github.com/luin/ioredis/blob/HEAD/CHANGELOG.md#561-2025-04-11)\n\n[Compare Source](https://redirect.github.com/luin/ioredis/compare/v5.6.0...v5.6.1)\n\n##### Bug Fixes\n\n-   adding debug log on cluster.slots initial connection error ([bedcfb5](https://redirect.github.com/luin/ioredis/commit/bedcfb5d4b462c3f0a804ab32152d80029e72710))\n\n</details>\n\n---\n\n### Configuration\n\n\ud83d\udcc5 **Schedule**: Branch creation - At any time (no schedule defined), Automerge - At any time (no schedule defined).\n\n\ud83d\udea6 **Automerge**: Disabled by config. Please merge this manually once you are satisfied.\n\n\u267b **Rebasing**: Whenever PR becomes conflicted, or you tick the rebase/retry checkbox.\n\n\ud83d\udd15 **Ignore**: Close this PR and you won't be reminded about this update again.\n\n---\n\n - [ ] <!-- rebase-check -->If you want to rebase/retry this PR, check this box\n\n---\n\nThis PR was generated by [Mend Renovate](https://mend.io/renovate/). View the [repository job log](https://developer.mend.io/github/mastodon/mastodon).\n<!--renovate-debug:eyJjcmVhdGVkSW5WZXIiOiIzOS4yMzguMCIsInVwZGF0ZWRJblZlciI6IjM5LjIzOC4wIiwidGFyZ2V0QnJhbmNoIjoibWFpbiIsImxhYmVscyI6WyJkZXBlbmRlbmNpZXMiLCJqYXZhc2NyaXB0Il19-->\n\n\n---\n\nChoice A:\nyarn.lock\n@@ -5448,13 +5448,13 @@ __metadata:\n   linkType: hard\n \n \"axios@npm:^1.4.0\":\n-  version: 1.8.4\n-  resolution: \"axios@npm:1.8.4\"\n+  version: 1.9.0\n+  resolution: \"axios@npm:1.9.0\"\n   dependencies:\n     follow-redirects: \"npm:^1.15.6\"\n     form-data: \"npm:^4.0.0\"\n     proxy-from-env: \"npm:^1.1.0\"\n-  checksum: 10c0/450993c2ba975ffccaf0d480b68839a3b2435a5469a71fa2fb0b8a55cdb2c2ae47e609360b9c1e2b2534b73dfd69e2733a1cf9f8215bee0bcd729b72f801b0ce\n+  checksum: 10c0/9371a56886c2e43e4ff5647b5c2c3c046ed0a3d13482ef1d0135b994a628c41fbad459796f101c655e62f0c161d03883454474d2e435b2e021b1924d9f24994c\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice B:\nyarn.lock\n@@ -10092,8 +10092,8 @@ __metadata:\n   linkType: hard\n \n \"ioredis@npm:^5.3.2\":\n-  version: 5.6.0\n-  resolution: \"ioredis@npm:5.6.0\"\n+  version: 5.6.1\n+  resolution: \"ioredis@npm:5.6.1\"\n   dependencies:\n     \"@ioredis/commands\": \"npm:^1.1.1\"\n     cluster-key-slot: \"npm:^1.1.0\"\n@@ -10104,7 +10104,7 @@ __metadata:\n     redis-errors: \"npm:^1.2.0\"\n     redis-parser: \"npm:^3.0.0\"\n     standard-as-callback: \"npm:^2.1.0\"\n-  checksum: 10c0/a885e5146640fc448706871290ef424ffa39af561f7ee3cf1590085209a509f85e99082bdaaf3cd32fa66758aea3fc2055d1109648ddca96fac4944bf2092c30\n+  checksum: 10c0/26ae49cf448e807e454a9bdea5a9dfdcf669e2fdbf2df341900a0fb693c5662fea7e39db3227ce8972d1bda0ba7da9b7410e5163b12d8878a579548d847220ac\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\nChoice C:\nyarn.lock\n@@ -9177,14 +9177,14 @@ __metadata:\n   linkType: hard\n \n \"pino-http@npm:^10.0.0\":\n-  version: 10.4.0\n-  resolution: \"pino-http@npm:10.4.0\"\n+  version: 10.5.0\n+  resolution: \"pino-http@npm:10.5.0\"\n   dependencies:\n     get-caller-file: \"npm:^2.0.5\"\n     pino: \"npm:^9.0.0\"\n     pino-std-serializers: \"npm:^7.0.0\"\n-    process-warning: \"npm:^4.0.0\"\n-  checksum: 10c0/64144e2c94e939070f56ad82dfb012b6a98d21582e0660cf821e7cee64d4e06f7724aa40bc5bf9cd1254d58ab7cbd972dec287b7989eba647d384f6edd8d95fd\n+    process-warning: \"npm:^5.0.0\"\n+  checksum: 10c0/17597d653a4088f7faed4d58500a5ef51d4d05247307696760006313c33c1d23177af98fb902e15b8e2cd92d81306c884673f841ba5b9bf0c064802f3c0bd775\n   languageName: node\n   linkType: hard\n \n@@ -9748,13 +9748,6 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"process-warning@npm:^4.0.0\":\n-  version: 4.0.0\n-  resolution: \"process-warning@npm:4.0.0\"\n-  checksum: 10c0/5312a72b69d37a1b82ad03f3dfa0090dab3804a8fd995d06c28e3c002852bd82f5584217d9f4a3f197892bb2afc22d57e2c662c7e906b5abb48c0380c7b0880d\n-  languageName: node\n-  linkType: hard\n-\n \"process-warning@npm:^5.0.0\":\n   version: 5.0.0\n   resolution: \"process-warning@npm:5.0.0\"\n---\n\n\n---\n\nChoice D:\n.rubocop_todo.yml\n@@ -33,7 +33,6 @@ Style/FetchEnvVar:\n   Exclude:\n     - 'config/initializers/2_limited_federation_mode.rb'\n     - 'config/initializers/paperclip.rb'\n-    - 'lib/tasks/repo.rake'\n \n # This cop supports safe autocorrection (--autocorrect).\n # Configuration parameters: MinBodyLength, AllowConsecutiveConditionals.\n---\nlib/tasks/repo.rake\n@@ -57,7 +57,7 @@ namespace :repo do\n                 response = nil\n \n                 loop do\n-                  response = HTTP.headers('Authorization' => \"token #{ENV['GITHUB_API_TOKEN']}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n+                  response = HTTP.headers('Authorization' => \"token #{ENV.fetch('GITHUB_API_TOKEN')}\").get(\"https://api.github.com/repos/#{REPOSITORY_NAME}/pulls/#{pull_request_number}\")\n \n                   if response.code == 403\n                     sleep_for = (response.headers['X-RateLimit-Reset'].to_i - Time.now.to_i).abs\n---\n\n\n---\n\n"}], "ideal": "B"}
{"input": [{"role": "system", "content": "The user will ask which of the following 4 choices (A, B, C or D) is the best solution to the following GitHub pull request. Even the correct answer may have some irrelevant code inside of it. Only respond with a single letter A, B, C or D in uppercase. "}, {"role": "user", "content": "Task Description:\nAlternate approach to https://github.com/mastodon/mastodon/pull/34419\r\n\r\nIf we like this way better -- a) do we need a migration here to handle previous invalid data edge case? (seems unlikely there'd be any); b) is this approach also better for the `List` case borrowed in other PR (which is catching `ArgumentError`, and possibly masking other issues)\r\n\n\n---\n\nChoice A:\napp/models/custom_filter.rb\n@@ -33,7 +33,7 @@ class CustomFilter < ApplicationRecord\n   include Expireable\n   include Redisable\n \n-  enum :action, { warn: 0, hide: 1, blur: 2 }, suffix: :action\n+  enum :action, { warn: 0, hide: 1, blur: 2 }, suffix: :action, validate: true\n \n   belongs_to :account\n   has_many :keywords, class_name: 'CustomFilterKeyword', inverse_of: :custom_filter, dependent: :destroy\n---\nspec/requests/api/v2/filters_spec.rb\n@@ -115,6 +115,21 @@\n           .to start_with('application/json')\n       end\n     end\n+\n+    context 'when the given filter_action value is invalid' do\n+      let(:params) { { title: 'magic', filter_action: 'imaginary_value', keywords_attributes: [keyword: 'magic'] } }\n+\n+      it 'returns http unprocessable entity' do\n+        subject\n+\n+        expect(response)\n+          .to have_http_status(422)\n+        expect(response.content_type)\n+          .to start_with('application/json')\n+        expect(response.parsed_body)\n+          .to include(error: /Action is not included/)\n+      end\n+    end\n   end\n \n   describe 'GET /api/v2/filters/:id' do\n---\n\n\n---\n\nChoice B:\nconfig/environments/development.rb\n@@ -37,10 +37,8 @@\n \n   config.action_controller.forgery_protection_origin_check = ENV['DISABLE_FORGERY_REQUEST_PROTECTION'].nil?\n \n-  ActiveSupport::Logger.new($stdout).tap do |logger|\n-    logger.formatter = config.log_formatter\n-    config.logger = ActiveSupport::TaggedLogging.new(logger)\n-  end\n+  # Override default file logging in favor of STDOUT logging in dev environment\n+  config.logger = ActiveSupport::TaggedLogging.logger($stdout, formatter: config.log_formatter)\n \n   # Generate random VAPID keys\n   Webpush.generate_key.tap do |vapid_key|\n---\n\n\n---\n\nChoice C:\napp/javascript/mastodon/features/account_timeline/hooks/familiar_followers.ts\n@@ -1,6 +1,7 @@\n import { useEffect } from 'react';\n \n import { fetchAccountsFamiliarFollowers } from '@/mastodon/actions/accounts_familiar_followers';\n+import { useIdentity } from '@/mastodon/identity_context';\n import { getAccountFamiliarFollowers } from '@/mastodon/selectors/accounts';\n import { useAppDispatch, useAppSelector } from '@/mastodon/store';\n import { me } from 'mastodon/initial_state';\n@@ -14,14 +15,15 @@ export const useFetchFamiliarFollowers = ({\n   const familiarFollowers = useAppSelector((state) =>\n     accountId ? getAccountFamiliarFollowers(state, accountId) : null,\n   );\n+  const { signedIn } = useIdentity();\n \n   const hasNoData = familiarFollowers === null;\n \n   useEffect(() => {\n-    if (hasNoData && accountId && accountId !== me) {\n+    if (hasNoData && signedIn && accountId && accountId !== me) {\n       void dispatch(fetchAccountsFamiliarFollowers({ id: accountId }));\n     }\n-  }, [dispatch, accountId, hasNoData]);\n+  }, [dispatch, accountId, hasNoData, signedIn]);\n \n   return {\n     familiarFollowers: hasNoData ? [] : familiarFollowers,\n---\n\n\n---\n\nChoice D:\nyarn.lock\n@@ -2886,69 +2886,69 @@ __metadata:\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/animated@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/animated@npm:10.0.0\"\n+\"@react-spring/animated@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/animated@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/shared\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/shared\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/a8c40aff22def6dbe964b1f79fa4a7774c44bf5eb47c2ef969c8ecb2a426b4c972b147bf18635d6972dbec3fb95e70dd84f22b43c904c32dfc7a57ad144a0879\n+  checksum: 10c0/aaccd4a8b0280ac846d463b253ad8f092ee4afc9dbedc8e77616adf5399ffec755344f09fdd8487cadaf815840dff84d354d1143579c27c2fcd6937549b5fc40\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/core@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/core@npm:10.0.0\"\n+\"@react-spring/core@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/core@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.0\"\n-    \"@react-spring/shared\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/animated\": \"npm:~10.0.1\"\n+    \"@react-spring/shared\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/39036a153dbd973443e23d90cb8e7be83201b1f0e4105f8427ddb4c9e9e50e590e1b46282829e0bb6f3deebfab004e30dcb4eec0e34c5ebb234d5060c06ecae5\n+  checksum: 10c0/059b122dda4138e5e7e461abd49350921e326735ca9a1d8aa19b1fdbae0937661b5f71af6fe82fd8f59e8db5549627849b38cc3f7ef2ec7ee9c93c3d6225174f\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/rafz@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/rafz@npm:10.0.0\"\n-  checksum: 10c0/8d92bc553172fa883ec2121b9cc62bfb43ff5d6c4e76363c8ce100fb6c3dd67c3dd629931786f9d1d63ac95a5d6996e4a08693cd56dda685bdbaf39b60e97f66\n+\"@react-spring/rafz@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/rafz@npm:10.0.1\"\n+  checksum: 10c0/cba76f143d3a06f79dd0c09f7aefd17df9cca9b2c1ef7f9103255e5351326f4a42a5a1366f731a78f74380d96ba683bcc2a49312ed1e4b9e9e249e72c9ff68cb\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/shared@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/shared@npm:10.0.0\"\n+\"@react-spring/shared@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/shared@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/rafz\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/rafz\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/833c3f42d35d22ac47a2f756ac47d85a81bc1decc5e7915f46013823344374378f883135754de94d5b43d8fff3c55fc4a359044c9a44f9095bd1ef1f11a20d4d\n+  checksum: 10c0/f056aaa018b3744afd8244e8eea24534d32f92fad9ace815b80e159b296fb5db148e2c9bd840ad9a5188e7a3c0778fd564b8af9ae02cd500e019a228398fb3cf\n   languageName: node\n   linkType: hard\n \n-\"@react-spring/types@npm:~10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/types@npm:10.0.0\"\n-  checksum: 10c0/ce1b959eaa8964f4004481d1e7c6eca0a8d636eb9f35ca654bdf77a78a860c0ff9eaa6bdc0cab84fc8a16be5c5fbb22b114249a2721bfc16191666670c0f44b3\n+\"@react-spring/types@npm:~10.0.1\":\n+  version: 10.0.1\n+  resolution: \"@react-spring/types@npm:10.0.1\"\n+  checksum: 10c0/260890f9c156dc69b77c846510017156d8c0a07cce70edc7c108e57b0cf4122b26a15e724b191481a51b2c914296de9e81d56618b2c339339d4b221930691baa\n   languageName: node\n   linkType: hard\n \n \"@react-spring/web@npm:^10.0.0\":\n-  version: 10.0.0\n-  resolution: \"@react-spring/web@npm:10.0.0\"\n+  version: 10.0.1\n+  resolution: \"@react-spring/web@npm:10.0.1\"\n   dependencies:\n-    \"@react-spring/animated\": \"npm:~10.0.0\"\n-    \"@react-spring/core\": \"npm:~10.0.0\"\n-    \"@react-spring/shared\": \"npm:~10.0.0\"\n-    \"@react-spring/types\": \"npm:~10.0.0\"\n+    \"@react-spring/animated\": \"npm:~10.0.1\"\n+    \"@react-spring/core\": \"npm:~10.0.1\"\n+    \"@react-spring/shared\": \"npm:~10.0.1\"\n+    \"@react-spring/types\": \"npm:~10.0.1\"\n   peerDependencies:\n     react: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n     react-dom: ^16.8.0 || ^17.0.0 || ^18.0.0 || ^19.0.0\n-  checksum: 10c0/2218c87d9bfafab78b3079d94ea89ab9b95cb174910be5682fd8f5fc73e326ca956e9b844e5b255d1e3402138ad26981fae2fc1091d682a78359044a63b6421e\n+  checksum: 10c0/a0c788c9fd881ccb834feb22fc0694e74e59f7b76e498f0096f5b65e2c9812513955bf45ee27d7c5348f56a7bba7c5a6961d4be663728bb2172fe5aa6b6bdfc4\n   languageName: node\n   linkType: hard\n \n---\n\n\n---\n\n"}], "ideal": "A"}
